<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>HttpçŠ¶æ€ç åŠå«ä¹‰</title>
    <url>/wiki/Http%E7%8A%B6%E6%80%81%E7%A0%81%E5%8F%8A%E5%90%AB%E4%B9%89/</url>
    <content><![CDATA[<blockquote>
<p>httpçŠ¶æ€ç ç”±3ä¸ªåè¿›åˆ¶æ•°å­—ç»„æˆã€‚ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçŠ¶æ€ç çš„åˆ†ç±»ï¼Œåé¢çš„ä¸¤ä½è¡¨ç¤ºè¯¥åˆ†ç±»ä¸‹ä¸åŒçš„çŠ¶æ€ã€‚<br>åˆ†ä¸º5ä¸ªå¤§ç±»ã€‚</p>
</blockquote>
<h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><ul>
<li>1**    ä¿¡æ¯ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œè¯·ç»§ç»­æ‰§è¡Œè¯·æ±‚</li>
<li>2**    æˆåŠŸã€‚è¯·æ±‚è¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†</li>
<li>3**    é‡å®šå‘ã€‚éœ€è¦è¿›ä¸€æ­¥æ“ä½œæ¥å®Œæˆè¯·æ±‚</li>
<li>4**    å®¢æˆ·ç«¯é”™è¯¯ã€‚æ— æ³•å®Œæˆè¯·æ±‚ï¼Œæˆ–è¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯</li>
<li>5**    æœåŠ¡å™¨é”™è¯¯ã€‚æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘æˆé”™è¯¯</li>
</ul>
<h2 id="å„ä¸ªçŠ¶æ€è¯´æ˜"><a href="#å„ä¸ªçŠ¶æ€è¯´æ˜" class="headerlink" title="å„ä¸ªçŠ¶æ€è¯´æ˜"></a>å„ä¸ªçŠ¶æ€è¯´æ˜</h2><ul>
<li>100ï¼š ç»§ç»­è¯·æ±‚è€…åº”å½“ç»§ç»­æå‡ºè¯·æ±‚ã€‚æœåŠ¡å™¨å·²æ”¶åˆ°è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œæ­£åœ¨ç­‰å¾…å…¶ä½™éƒ¨åˆ†ã€‚</li>
<li>101ï¼š åˆ‡æ¢åè®®è¯·æ±‚è€…å·²è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ï¼ŒæœåŠ¡å™¨å·²ç¡®è®¤å¹¶å‡†å¤‡åˆ‡æ¢ã€‚</li>
<li>200ï¼š æˆåŠŸæœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ã€‚</li>
<li>201ï¼š å·²åˆ›å»ºè¯·æ±‚æˆåŠŸå¹¶ä¸”æœåŠ¡å™¨åˆ›å»ºäº†æ–°çš„èµ„æºã€‚</li>
<li>202ï¼š å·²æ¥å—æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†ã€‚</li>
<li>203ï¼š éæˆæƒä¿¡æ¯æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€æ¥æºã€‚</li>
<li>204ï¼š æ— å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚</li>
<li>205ï¼š é‡ç½®å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œå†…å®¹è¢«é‡ç½®ã€‚</li>
<li>206ï¼š éƒ¨åˆ†å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†è¯·æ±‚ã€‚</li>
<li>300ï¼š å¤šç§é€‰æ‹©é’ˆå¯¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯æ‰§è¡Œå¤šç§æ“ä½œã€‚</li>
<li>301ï¼š æ°¸ä¹…ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼Œå³æ°¸ä¹…é‡å®šå‘ã€‚</li>
<li>302ï¼š ä¸´æ—¶ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µæš‚æ—¶è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œå³æš‚æ—¶é‡å®šå‘ã€‚</li>
<li>303ï¼š æŸ¥çœ‹å…¶ä»–ä½ç½®å¦‚æœåŸæ¥çš„è¯·æ±‚æ˜¯ POSTï¼Œé‡å®šå‘ç›®æ ‡æ–‡æ¡£åº”è¯¥é€šè¿‡ GET æå–ã€‚</li>
<li>304ï¼š æœªä¿®æ”¹æ­¤æ¬¡è¯·æ±‚è¿”å›çš„ç½‘é¡µæœªä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨ä¸Šæ¬¡çš„èµ„æºã€‚</li>
<li>305ï¼š ä½¿ç”¨ä»£ç†è¯·æ±‚è€…åº”è¯¥ä½¿ç”¨ä»£ç†è®¿é—®è¯¥ç½‘é¡µã€‚</li>
<li>307ï¼š ä¸´æ—¶é‡å®šå‘è¯·æ±‚çš„èµ„æºä¸´æ—¶ä»å…¶ä»–ä½ç½®å“åº”ã€‚</li>
<li>400ï¼š é”™è¯¯è¯·æ±‚æœåŠ¡å™¨æ— æ³•è§£æè¯¥è¯·æ±‚ã€‚</li>
<li>401ï¼š æœªæˆæƒè¯·æ±‚æ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯æˆ–éªŒè¯æœªé€šè¿‡ã€‚</li>
<li>403ï¼š ç¦æ­¢è®¿é—®æœåŠ¡å™¨æ‹’ç»æ­¤è¯·æ±‚ã€‚</li>
<li>404ï¼š æœªæ‰¾åˆ°æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„ç½‘é¡µã€‚</li>
<li>405ï¼š æ–¹æ³•ç¦ç”¨æœåŠ¡å™¨ç¦ç”¨äº†è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ã€‚</li>
<li>406ï¼š ä¸æ¥å—æ— æ³•ä½¿ç”¨è¯·æ±‚çš„å†…å®¹å“åº”è¯·æ±‚çš„ç½‘é¡µã€‚</li>
<li>407ï¼š éœ€è¦ä»£ç†æˆæƒè¯·æ±‚è€…éœ€è¦ä½¿ç”¨ä»£ç†æˆæƒã€‚</li>
<li>408ï¼š è¯·æ±‚è¶…æ—¶æœåŠ¡å™¨è¯·æ±‚è¶…æ—¶ã€‚</li>
<li>409ï¼š å†²çªæœåŠ¡å™¨åœ¨å®Œæˆè¯·æ±‚æ—¶å‘ç”Ÿå†²çªã€‚</li>
<li>410ï¼š å·²åˆ é™¤è¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…åˆ é™¤ã€‚</li>
<li>411ï¼š éœ€è¦æœ‰æ•ˆé•¿åº¦æœåŠ¡å™¨ä¸æ¥å—ä¸å«æœ‰æ•ˆå†…å®¹é•¿åº¦æ ‡å¤´å­—æ®µçš„è¯·æ±‚ã€‚</li>
<li>412ï¼š æœªæ»¡è¶³å‰ææ¡ä»¶æœåŠ¡å™¨æœªæ»¡è¶³è¯·æ±‚è€…åœ¨è¯·æ±‚ä¸­è®¾ç½®çš„å…¶ä¸­ä¸€ä¸ªå‰ææ¡ä»¶ã€‚</li>
<li>413ï¼š è¯·æ±‚å®ä½“è¿‡å¤§è¯·æ±‚å®ä½“è¿‡å¤§ï¼Œè¶…å‡ºæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€‚</li>
<li>414ï¼š è¯·æ±‚ URI è¿‡é•¿è¯·æ±‚ç½‘å€è¿‡é•¿ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚</li>
<li>415ï¼š ä¸æ”¯æŒç±»å‹è¯·æ±‚çš„æ ¼å¼ä¸å—è¯·æ±‚é¡µé¢çš„æ”¯æŒã€‚</li>
<li>416ï¼š è¯·æ±‚èŒƒå›´ä¸ç¬¦é¡µé¢æ— æ³•æä¾›è¯·æ±‚çš„èŒƒå›´ã€‚</li>
<li>417ï¼š æœªæ»¡è¶³æœŸæœ›å€¼æœåŠ¡å™¨æœªæ»¡è¶³æœŸæœ›è¯·æ±‚æ ‡å¤´å­—æ®µçš„è¦æ±‚ã€‚</li>
<li>500ï¼š æœåŠ¡å™¨å†…éƒ¨é”™è¯¯æœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚</li>
<li>501ï¼š æœªå®ç°æœåŠ¡å™¨ä¸å…·å¤‡å®Œæˆè¯·æ±‚çš„åŠŸèƒ½ã€‚</li>
<li>502ï¼š é”™è¯¯ç½‘å…³æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº”ã€‚</li>
<li>503ï¼š æœåŠ¡ä¸å¯ç”¨æœåŠ¡å™¨ç›®å‰æ— æ³•ä½¿ç”¨ã€‚</li>
<li>504ï¼š ç½‘å…³è¶…æ—¶æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ã€‚</li>
<li>505ï¼š HTTP ç‰ˆæœ¬ä¸æ”¯æŒæœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æ‰€ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-jmap</title>
    <url>/wiki/JVM-jmap/</url>
    <content><![CDATA[<h1 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h1><p>å‘½ä»¤jmapæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å‘½ä»¤ã€‚å®ƒå¯ä»¥ç”Ÿæˆ java ç¨‹åºçš„ dump æ–‡ä»¶ï¼Œ ä¹Ÿå¯ä»¥æŸ¥çœ‹å †å†…å¯¹è±¡ç¤ºä¾‹çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ ClassLoader çš„ä¿¡æ¯ä»¥åŠ finalizer é˜Ÿåˆ—ã€‚</p>
<h2 id="jmap-heap-pid"><a href="#jmap-heap-pid" class="headerlink" title="jmap -heap pid"></a>jmap -heap pid</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Attaching to process ID <span class="number">7183</span>, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is <span class="number">25.242</span>-b08</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with <span class="number">4</span> thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = <span class="number">0</span></span><br><span class="line">   MaxHeapFreeRatio         = <span class="number">100</span></span><br><span class="line">   MaxHeapSize              = <span class="number">2051014656</span> (<span class="number">1956.</span>0MB)</span><br><span class="line">   NewSize                  = <span class="number">42991616</span> (<span class="number">41.</span>0MB)</span><br><span class="line">   MaxNewSize               = <span class="number">683671552</span> (<span class="number">652.</span>0MB)</span><br><span class="line">   OldSize                  = <span class="number">87031808</span> (<span class="number">83.</span>0MB)</span><br><span class="line">   NewRatio                 = <span class="number">2</span></span><br><span class="line">   SurvivorRatio            = <span class="number">8</span></span><br><span class="line">   MetaspaceSize            = <span class="number">21807104</span> (<span class="number">20.</span>796875MB)</span><br><span class="line">   CompressedClassSpaceSize = <span class="number">1073741824</span> (<span class="number">1024.</span>0MB)</span><br><span class="line">   MaxMetaspaceSize         = <span class="number">17592186044415</span> MB</span><br><span class="line">   G1HeapRegionSize         = <span class="number">0</span> (<span class="number">0.</span>0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = <span class="number">233308160</span> (<span class="number">222.</span>5MB)</span><br><span class="line">   used     = <span class="number">161611280</span> (<span class="number">154.</span>12452697753906MB)</span><br><span class="line">   free     = <span class="number">71696880</span> (<span class="number">68.</span>37547302246094MB)</span><br><span class="line">   <span class="number">69.26945032698384</span>% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = <span class="number">1572864</span> (<span class="number">1.</span>5MB)</span><br><span class="line">   used     = <span class="number">899896</span> (<span class="number">0.</span>8582077026367188MB)</span><br><span class="line">   free     = <span class="number">672968</span> (<span class="number">0.</span>6417922973632812MB)</span><br><span class="line">   <span class="number">57.213846842447914</span>% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = <span class="number">1572864</span> (<span class="number">1.</span>5MB)</span><br><span class="line">   used     = <span class="number">0</span> (<span class="number">0.</span>0MB)</span><br><span class="line">   free     = <span class="number">1572864</span> (<span class="number">1.</span>5MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   capacity = <span class="number">223346688</span> (<span class="number">213.</span>0MB)</span><br><span class="line">   used     = <span class="number">115841432</span> (<span class="number">110.</span>4749984741211MB)</span><br><span class="line">   free     = <span class="number">107505256</span> (<span class="number">102.</span>5250015258789MB)</span><br><span class="line">   <span class="number">51.866196466723515</span>% used</span><br><span class="line"></span><br><span class="line"><span class="number">41772</span> interned Strings occupying <span class="number">4324472</span> bytes.</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.jianshu.com/p/a4ad53179df3">jvm æ€§èƒ½è°ƒä¼˜å·¥å…·ä¹‹ jmap</a><br><a href="https://pandora.blog.csdn.net/article/details/108705081">JVMè°ƒè¯•å·¥å…·-jmap</a><br><a href="https://blog.csdn.net/lengyue309/article/details/80590119">é€šè¿‡jstackä¸jmapåˆ†æä¸€æ¬¡çº¿ä¸Šæ•…éšœ</a>                 
  </p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-Xms,Xmxå’ŒXss</title>
    <url>/wiki/JVM-Xms-Xmx%E5%92%8CXss/</url>
    <content><![CDATA[<h1 id="æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰"><a href="#æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰" class="headerlink" title="æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰"></a>æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰</h1><blockquote>
<p>-Xss</p>
</blockquote>
<p>è§„å®šäº†æ¯ä¸ªçº¿ç¨‹è™šæ‹Ÿæœºæ ˆåŠå †æ ˆçš„å¤§å°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ256kæ˜¯è¶³å¤Ÿçš„ï¼Œæ­¤é…ç½®å°†ä¼šå½±å“æ­¤è¿›ç¨‹ä¸­å¹¶å‘çº¿ç¨‹æ•°çš„å¤§å°ã€‚</p>
<blockquote>
<p>-Xms</p>
</blockquote>
<p>è¡¨ç¤ºåˆå§‹åŒ–JAVAå †çš„å¤§å°åŠè¯¥è¿›ç¨‹åˆšåˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œä»–çš„ä¸“å±JAVAå †çš„å¤§å°ï¼Œä¸€æ—¦å¯¹è±¡å®¹é‡è¶…è¿‡äº†JAVAå †çš„åˆå§‹å®¹é‡ï¼ŒJAVAå †å°†ä¼šè‡ªåŠ¨æ‰©å®¹åˆ°-Xmxå¤§å°ã€‚</p>
<blockquote>
<p>-Xmx</p>
</blockquote>
<p>è¡¨ç¤ºjavaå †å¯ä»¥æ‰©å±•åˆ°çš„æœ€å¤§å€¼ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé€šå¸¸å°†-Xmså’Œ-Xmxè®¾ç½®æˆä¸€æ ·çš„ï¼Œå› ä¸ºå½“å †ä¸å¤Ÿç”¨è€Œå‘ç”Ÿæ‰©å®¹æ—¶ï¼Œä¼šå‘ç”Ÿå†…å­˜æŠ–åŠ¨å½±å“ç¨‹åºè¿è¡Œæ—¶çš„ç¨³å®šæ€§ã€‚</p>
<blockquote>
<p>å †å†…å­˜åˆ†é…ï¼š</p>
</blockquote>
<p>JVMåˆå§‹åˆ†é…çš„å†…å­˜ç”±-XmsæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64<br>JVMæœ€å¤§åˆ†é…çš„å†…å­˜ç”±-XmxæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4<br>é»˜è®¤ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶ï¼›ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ã€‚<br>å› æ­¤æœåŠ¡å™¨ä¸€èˆ¬è®¾ç½®-Xmsã€-Xmxç›¸ç­‰ä»¥é¿å…åœ¨æ¯æ¬¡GC åè°ƒæ•´å †çš„å¤§å°ã€‚å¯¹è±¡çš„å †å†…å­˜ç”±ç§°ä¸ºåƒåœ¾å›æ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿå›æ”¶ã€‚<br>éå †å†…å­˜åˆ†é…ï¼š<br>JVMä½¿ç”¨-XX:PermSizeè®¾ç½®éå †å†…å­˜åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼›<br>ç”±XX:MaxPermSizeè®¾ç½®æœ€å¤§éå †å†…å­˜çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚<br>-Xmn2Gï¼šè®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2Gã€‚<br>-XX:SurvivorRatioï¼Œè®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„æ¯”å€¼ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://blog.csdn.net/a1439775520/article/details/97787160">ç±»ä¼¼-Xmsã€-Xmnè¿™äº›å‚æ•°çš„å«ä¹‰ï¼š</a><br>2ã€<a href="https://baijiahao.baidu.com/s?id=1671253445384660292&wfr=spider&for=pc">JVMä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰ï¼Œä½ åˆçŸ¥é“å¤šå°‘å‘¢</a></p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-jstack</title>
    <url>/wiki/JVM-jstack/</url>
    <content><![CDATA[<h1 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h1><h2 id="jstack-åŠŸèƒ½"><a href="#jstack-åŠŸèƒ½" class="headerlink" title="jstack åŠŸèƒ½"></a>jstack åŠŸèƒ½</h2><p>ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªåŠŸèƒ½ï¼š</p>
<p>aï¼Â  é’ˆå¯¹æ´»ç€çš„è¿›ç¨‹åšæœ¬åœ°çš„æˆ–è¿œç¨‹çš„çº¿ç¨‹dumpï¼›</p>
<p>bï¼Â  é’ˆå¯¹coreæ–‡ä»¶åšçº¿ç¨‹dumpã€‚</p>
<p>jstackç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰javaè™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰ã€‚ çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<h2 id="jstack-æ“ä½œæ–¹å¼"><a href="#jstack-æ“ä½œæ–¹å¼" class="headerlink" title="jstack æ“ä½œæ–¹å¼"></a>jstack æ“ä½œæ–¹å¼</h2><blockquote>
<p>jps -l | grep keyword -&gt; pid<br>jstack pid</p>
</blockquote>
<p>jstackç»“æœå¦‚ä¸‹ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;lettuce-nioEventLoop-4-1&quot; #639 daemon prio=5 os_prio=0 tid=0x00007ff27025d800 nid=0x258f runnable [0x00007ff262af7000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">	at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)</span><br><span class="line">	at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)</span><br><span class="line">	at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)</span><br><span class="line">	at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)</span><br><span class="line">	- locked &lt;0x000000008988d6a8&gt; (a io.netty.channel.nio.SelectedSelectionKeySet)</span><br><span class="line">	- locked &lt;0x000000008988d770&gt; (a java.util.Collections$UnmodifiableSet)</span><br><span class="line">	- locked &lt;0x000000008988d600&gt; (a sun.nio.ch.EPollSelectorImpl)</span><br><span class="line">	at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)</span><br><span class="line">	at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:101)</span><br><span class="line">	at io.netty.channel.nio.SelectedSelectionKeySetSelector.select(SelectedSelectionKeySetSelector.java:68)</span><br><span class="line">	at io.netty.channel.nio.NioEventLoop.select(NioEventLoop.java:803)</span><br><span class="line">	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:457)</span><br><span class="line">	at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)</span><br><span class="line">	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)</span><br><span class="line">	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>


<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_30013175/article/details/113901522">https://blog.csdn.net/weixin_30013175/article/details/113901522</a></p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-jstat</title>
    <url>/wiki/JVM-jstat/</url>
    <content><![CDATA[<h1 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h1><p>jstatæ˜¯ä¸€ä¸ªç®€å•çš„å®ç”¨å·¥å…·ï¼Œåœ¨JDKä¸­å­˜åœ¨ï¼Œç”¨äºæä¾›ä¸JVMæ€§èƒ½ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚åƒåœ¾æ”¶é›†ï¼Œç¼–è¯‘æ´»åŠ¨ã€‚ jstatçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒJVMä¸”æ— éœ€ä»»ä½•å…ˆå†³æ¡ä»¶çš„æƒ…å†µä¸‹åŠ¨æ€æ•è·è¿™äº›æŒ‡æ ‡ã€‚ è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä¾‹å¦‚ï¼Œå¦‚æœè¦æ•è·ä¸åƒåœ¾å›æ”¶ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåˆ™éœ€è¦åœ¨å¯åŠ¨JVMä¹‹å‰ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š</p>
<blockquote>
<p> -Xlog:gc*:file={file-path} </p>
</blockquote>
<p>æ­¤å‚æ•°å°†å¯ç”¨GCæ—¥å¿—å¹¶å°†å…¶æ‰“å°åœ¨æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ä¸­ã€‚ å‡è®¾æ‚¨å°šæœªä¼ é€’æ­¤å‚æ•°ï¼Œé‚£ä¹ˆå°†ä¸ä¼šç”Ÿæˆä¸GCç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ è¿™æ˜¯jstatå¯ä»¥æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚ æ‚¨å¯ä»¥åŠ¨æ€åœ°è¿æ¥åˆ°JVMå¹¶æ•è·GCï¼Œç¼–è¯‘ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h2 id="jstatæ“ä½œ"><a href="#jstatæ“ä½œ" class="headerlink" title="jstatæ“ä½œ"></a>jstatæ“ä½œ</h2><p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jstat -gc -t 11656 10000 30 </span><br></pre></td></tr></table></figure>
<p>-gc ï¼šå°†æ˜¾ç¤ºä¸åƒåœ¾æ”¶é›†ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯</p>
<p>è‡ªJVMå¯åŠ¨ä»¥æ¥çš„-tæ—¶é—´æˆ³å°†è¢«æ‰“å°</p>
<p>11656ï¼šç›®æ ‡JVMè¿›ç¨‹ID</p>
<p>10000ï¼šæ¯10,000æ¯«ç§’ï¼ˆå³10ç§’ï¼‰å°†æ‰“å°ä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>30 ï¼šå°†æ‰“å°30æ¬¡è¿­ä»£çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ å› æ­¤ï¼Œä»¥ä¸Šé€‰é¡¹å°†å¯¼è‡´JVMæ‰“å°æŒ‡æ ‡300ç§’ï¼ˆå³10ç§’x 30æ¬¡è¿­ä»£ï¼‰ã€‚</p>
<p>ï¼ˆè¯·æ³¨æ„ï¼Œé™¤äº†-gcä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¼ é€’å…¶ä»–å„ç§é€‰é¡¹æ¥ç”Ÿæˆä¸åŒçš„æ•°æ®é›†ã€‚æœ‰å…³ä¸åŒé€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ­¤å¤„ ã€‚ï¼‰<br>æ‰“å°ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Timestamp        S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">        34486.1 1536.0 1536.0  0.0   878.8  226816.0 132809.2  218112.0   113086.4  120664.0 111284.9 14464.0 12928.3    355    3.523   6      1.126    4.649</span><br><span class="line">        34496.3 1536.0 1536.0  0.0   878.8  226816.0 138030.9  218112.0   113086.4  120664.0 111284.9 14464.0 12928.3    355    3.523   6      1.126    4.649</span><br><span class="line">        34506.3 1536.0 1536.0  0.0   878.8  226816.0 195648.1  218112.0   113086.4  120664.0 111284.9 14464.0 12928.3    355    3.523   6      1.126    4.649</span><br></pre></td></tr></table></figure>

<h3 id="å­—æ®µè§£è¯»"><a href="#å­—æ®µè§£è¯»" class="headerlink" title="å­—æ®µè§£è¯»"></a>å­—æ®µè§£è¯»</h3><p>S0C â€“å¹¸å­˜è€…0åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½</p>
<p>S1C â€“å¹¸å­˜è€…1åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½</p>
<p>S0U â€“å¹¸å­˜è€…0åŒºåŸŸä½¿ç”¨çš„ç©ºé—´ä»¥KBä¸ºå•ä½</p>
<p>S1U â€“å¹¸å­˜è€…1åŒºåŸŸä»¥KBä¸ºå•ä½ä½¿ç”¨ç©ºé—´</p>
<p>EC â€“ä¼Šç”¸å›­åœ°åŒºå®¹é‡ï¼ˆKBï¼‰</p>
<p>æ¬§ç›Ÿâ€“ä¼Šç”¸å›­åœ°åŒºçš„å·²åˆ©ç”¨ç©ºé—´ï¼ˆä»¥KBä¸ºå•ä½ï¼‰</p>
<p>OC â€“æ—§åŒºåŸŸå®¹é‡ï¼ˆKBï¼‰</p>
<p>OU â€“æ—§åŒºåŸŸçš„å·²åˆ©ç”¨ç©ºé—´ï¼Œä»¥KBä¸ºå•ä½</p>
<p>MC â€“å…ƒç©ºé—´åŒºåŸŸå®¹é‡ï¼Œä»¥KBä¸ºå•ä½</p>
<p>MU â€“å…ƒç©ºé—´åŒºåŸŸä½¿ç”¨çš„ç©ºé—´ä»¥KBä¸ºå•ä½</p>
<p>CCSC â€“å‹ç¼©ç±»ç©ºé—´åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½</p>
<p>CCSU â€“å‹ç¼©ç±»ç©ºé—´åŒºåŸŸä»¥KBä¸ºå•ä½ä½¿ç”¨ç©ºé—´</p>
<p>YGC â€“è¿„ä»Šä¸ºæ­¢å‘ç”Ÿçš„å¹´è½»GCäº‹ä»¶çš„æ•°é‡</p>
<p>YGCT â€“åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¹´è½»GCèŠ±è´¹çš„æ—¶é—´</p>
<p>FGC â€“è¿„ä»Šä¸ºæ­¢å·²å‘ç”Ÿçš„å®Œå…¨GCäº‹ä»¶çš„æ•°é‡</p>
<p>FGCT â€“åˆ°ç›®å‰ä¸ºæ­¢å·²èŠ±è´¹çš„å®Œæ•´GCæ—¶é—´</p>
<p>GCT â€“åˆ°ç›®å‰ä¸ºæ­¢æ‰€èŠ±è´¹çš„GCæ—¶é—´æ€»é‡ï¼ˆåŸºæœ¬ä¸Šæ˜¯YGCT + FGCTï¼‰</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/dnc8371/article/details/107255359">jstatåˆ†æ_jstat â€“åˆ†æ</a> </p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-strace</title>
    <url>/wiki/JVM-strace/</url>
    <content><![CDATA[<h1 id="strace-å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—"><a href="#strace-å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—" class="headerlink" title="strace å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—"></a>strace å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—</h1><p><code>strace -ff -o out java ***.class</code></p>
<p>-ff : è·Ÿè¸ªè¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹ç”¨åˆ°çš„ç³»ç»Ÿå‘½ä»¤<br>-o : å°†è·Ÿè¸ªçš„æ“ä½œç³»ç»Ÿæ—¥å¿—è¾“å‡º</p>
<blockquote>
<p>ä¸‹é¢æŸ¥çœ‹JDK1.8ä¸‹ï¼ŒBIOæ¨¡å¼éƒ½æœ‰å“ªäº›ç³»ç»Ÿå‘½ä»¤çš„æ‰§è¡Œ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ibli.javaBase.io.bio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> gaolei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/4/3 2:55 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SockerIo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9090</span>);</span><br><span class="line">        <span class="comment">// é˜»å¡</span></span><br><span class="line">        Socket client = serverSocket.accept();</span><br><span class="line"></span><br><span class="line">        InputStream inputStream = client.getInputStream();</span><br><span class="line"></span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        <span class="comment">// è¯»é˜»å¡</span></span><br><span class="line">        System.err.println(bufferedReader.readLine());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœåŠ¡ç«¯</p>
</blockquote>
<p>1ã€<code>javac SockerIo.java</code> å¾—åˆ°SockerIo.class<br>ç„¶åï¼Œä½¿ç”¨straceå¯åŠ¨javaç¨‹åºğŸ‘‡ï¼š<br>2ã€<code>strace -ff -0 out java SockerIo</code><br>å¾—åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-924f13a6df8c2ce97e13019329008fb4a84.png"></p>
<blockquote>
<p>å®¢æˆ·ç«¯ä½¿ç”¨ncè¿æ¥9090ç«¯å£ï¼Œç„¶åè¯·æ±‚æ•°æ®</p>
</blockquote>
<p><code>nc 127.0.0.1 9090</code>  å‘é€å¦‚ä¸‹æ•°æ®</p>
<img src="https://oscimg.oschina.net/oscnet/up-4b7b364f021786bd9bdf4f40135da3b4a8d.png">

<blockquote>
<p>straceæŸ¥çœ‹æ—¥å¿—</p>
</blockquote>
<p>æŸ¥çœ‹ä¸»çº¿ç¨‹æ—¥å¿—ï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-291f9a1018a2d288b88a5c2e43666d5d47e.png"><br>å¦‚ä¸Šå›¾ï¼ŒğŸ‘†æ–‡ä»¶æœ€å¤§çš„æ˜¯ä¸»çº¿ç¨‹æ—¥å¿—ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-c306b9f94e3d0a3582b049d3c4769b4f5ec.png">

<p>æ ¹æ®ä¸Šé¢ğŸ‘†straceå‘½ä»¤è·Ÿè¸ªçš„æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼ŒJDK1.8ä¸‹çš„BIOçš„å¤šè·¯å¤ç”¨å™¨æ˜¯ä½¿ç”¨çš„ã€Œpollã€</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-ç±»åŠ è½½æœºåˆ¶</title>
    <url>/wiki/JVM-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/</url>
    <content><![CDATA[<h1 id="ç±»åŠ è½½æœºåˆ¶"><a href="#ç±»åŠ è½½æœºåˆ¶" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶"></a>ç±»åŠ è½½æœºåˆ¶</h1><h2 id="ç±»åŠ è½½æœºåˆ¶å…·ä½“æµç¨‹"><a href="#ç±»åŠ è½½æœºåˆ¶å…·ä½“æµç¨‹" class="headerlink" title="ç±»åŠ è½½æœºåˆ¶å…·ä½“æµç¨‹"></a>ç±»åŠ è½½æœºåˆ¶å…·ä½“æµç¨‹</h2><p>Java çš„ç±»åŠ è½½è¿‡ç¨‹å¯ä»¥åˆ†ä¸º 5 ä¸ªé˜¶æ®µï¼šè½½å…¥ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–ã€‚è¿™ 5 ä¸ªé˜¶æ®µä¸€èˆ¬æ˜¯é¡ºåºå‘ç”Ÿçš„ï¼Œä½†åœ¨åŠ¨æ€ç»‘å®šçš„æƒ…å†µä¸‹ï¼Œè§£æé˜¶æ®µå‘ç”Ÿåœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åã€‚</p>
<p>1ï¼‰Loadingï¼ˆè½½å…¥ï¼‰</p>
<p>JVM åœ¨è¯¥é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯å°†å­—èŠ‚ç ä»ä¸åŒçš„æ•°æ®æºï¼ˆå¯èƒ½æ˜¯ class æ–‡ä»¶ã€ä¹Ÿå¯èƒ½æ˜¯ jar åŒ…ï¼Œç”šè‡³ç½‘ç»œï¼‰è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡ã€‚</p>
<p>2ï¼‰Verificationï¼ˆéªŒè¯ï¼‰</p>
<p>JVM ä¼šåœ¨è¯¥é˜¶æ®µå¯¹äºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œæ ¡éªŒï¼Œåªæœ‰ç¬¦åˆ JVM å­—èŠ‚ç è§„èŒƒçš„æ‰èƒ½è¢« JVM æ­£ç¡®æ‰§è¡Œã€‚è¯¥é˜¶æ®µæ˜¯ä¿è¯ JVM å®‰å…¨çš„é‡è¦å±éšœï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„æ£€æŸ¥ã€‚</p>
<p>ç¡®ä¿äºŒè¿›åˆ¶å­—èŠ‚æµæ ¼å¼ç¬¦åˆé¢„æœŸï¼ˆæ¯”å¦‚è¯´æ˜¯å¦ä»¥ cafe bene å¼€å¤´ï¼‰ã€‚<br>æ˜¯å¦æ‰€æœ‰æ–¹æ³•éƒ½éµå®ˆè®¿é—®æ§åˆ¶å…³é”®å­—çš„é™å®šã€‚<br>æ–¹æ³•è°ƒç”¨çš„å‚æ•°ä¸ªæ•°å’Œç±»å‹æ˜¯å¦æ­£ç¡®ã€‚<br>ç¡®ä¿å˜é‡åœ¨ä½¿ç”¨ä¹‹å‰è¢«æ­£ç¡®åˆå§‹åŒ–äº†ã€‚<br>æ£€æŸ¥å˜é‡æ˜¯å¦è¢«èµ‹äºˆæ°å½“ç±»å‹çš„å€¼ã€‚<br>3ï¼‰Preparationï¼ˆå‡†å¤‡ï¼‰</p>
<p>JVM ä¼šåœ¨è¯¥é˜¶æ®µå¯¹ç±»å˜é‡ï¼ˆä¹Ÿç§°ä¸ºé™æ€å˜é‡ï¼Œstatic å…³é”®å­—ä¿®é¥°çš„ï¼‰åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ï¼ˆå¯¹åº”æ•°æ®ç±»å‹çš„é»˜è®¤åˆå§‹å€¼ï¼Œå¦‚ 0ã€0Lã€nullã€false ç­‰ï¼‰ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<p>public String chenmo = â€œæ²‰é»˜â€;<br>public static String wanger = â€œç‹äºŒâ€;<br>public static final String cmower = â€œæ²‰é»˜ç‹äºŒâ€;<br>chenmo ä¸ä¼šè¢«åˆ†é…å†…å­˜ï¼Œè€Œ wanger ä¼šï¼›ä½† wanger çš„åˆå§‹å€¼ä¸æ˜¯â€œç‹äºŒâ€è€Œæ˜¯ nullã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstatic final ä¿®é¥°çš„å˜é‡è¢«ç§°ä½œä¸ºå¸¸é‡ï¼Œå’Œç±»å˜é‡ä¸åŒã€‚å¸¸é‡ä¸€æ—¦èµ‹å€¼å°±ä¸ä¼šæ”¹å˜äº†ï¼Œæ‰€ä»¥ cmower åœ¨å‡†å¤‡é˜¶æ®µçš„å€¼ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€è€Œä¸æ˜¯ nullã€‚</p>
<p>4ï¼‰Resolutionï¼ˆè§£æï¼‰</p>
<p>è¯¥é˜¶æ®µå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚</p>
<p>whatï¼Ÿç¬¦å·å¼•ç”¨ï¼Œç›´æ¥å¼•ç”¨ï¼Ÿ</p>
<p>ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·ï¼ˆä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦åœ¨ä½¿ç”¨æ—¶èƒ½å¤Ÿæ— æ­§ä¹‰çš„å®šä½åˆ°ç›®æ ‡å³å¯ï¼‰æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚</p>
<p>åœ¨ç¼–è¯‘æ—¶ï¼ŒJava ç±»å¹¶ä¸çŸ¥é“æ‰€å¼•ç”¨çš„ç±»çš„å®é™…åœ°å€ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ç¬¦å·å¼•ç”¨æ¥ä»£æ›¿ã€‚æ¯”å¦‚ com.Wanger ç±»å¼•ç”¨äº† com.Chenmo ç±»ï¼Œç¼–è¯‘æ—¶ Wanger ç±»å¹¶ä¸çŸ¥é“ Chenmo ç±»çš„å®é™…å†…å­˜åœ°å€ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ç¬¦å· com.Chenmoã€‚</p>
<p>ç›´æ¥å¼•ç”¨é€šè¿‡å¯¹ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æï¼Œæ‰¾åˆ°å¼•ç”¨çš„å®é™…å†…å­˜åœ°å€ã€‚</p>
<p>5ï¼‰Initializationï¼ˆåˆå§‹åŒ–ï¼‰</p>
<p>è¯¥é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»è¢«èµ‹è¿‡é»˜è®¤åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œç±»å˜é‡å°†è¢«èµ‹å€¼ä¸ºä»£ç æœŸæœ›èµ‹çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•çš„è¿‡ç¨‹ã€‚</p>
<p>ohï¼Œnoï¼Œä¸Šé¢è¿™æ®µè¯è¯´å¾—å¾ˆæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯¹ä¸å¯¹ï¼Œæˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>String cmower = new String(â€œæ²‰é»˜ç‹äºŒâ€);<br>ä¸Šé¢è¿™æ®µä»£ç ä½¿ç”¨äº† new å…³é”®å­—æ¥å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ String ç±»çš„æ„é€ æ–¹æ³•å¯¹ cmower è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾"><a href="#ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾"></a>ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾</h2><p>èŠå®Œç±»åŠ è½½è¿‡ç¨‹ï¼Œå°±ä¸å¾—ä¸èŠèŠç±»åŠ è½½å™¨ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒJava ç¨‹åºå‘˜å¹¶ä¸éœ€è¦ç›´æ¥åŒç±»åŠ è½½å™¨è¿›è¡Œäº¤äº’ã€‚JVM é»˜è®¤çš„è¡Œä¸ºå°±å·²ç»è¶³å¤Ÿæ»¡è¶³å¤§å¤šæ•°æƒ…å†µçš„éœ€æ±‚äº†ã€‚ä¸è¿‡ï¼Œå¦‚æœé‡åˆ°äº†éœ€è¦å’Œç±»åŠ è½½å™¨è¿›è¡Œäº¤äº’çš„æƒ…å†µï¼Œè€Œå¯¹ç±»åŠ è½½å™¨çš„æœºåˆ¶åˆä¸æ˜¯å¾ˆäº†è§£çš„è¯ï¼Œå°±ä¸å¾—ä¸èŠ±å¤§é‡çš„æ—¶é—´å»è°ƒè¯•<br>ClassNotFoundException å’Œ NoClassDefFoundError ç­‰å¼‚å¸¸ã€‚</p>
<p>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®å®šå…¶åœ¨ JVM ä¸­çš„å”¯ä¸€æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªç±»çš„åŠ è½½å™¨ä¸åŒï¼Œå³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ï¼ˆæ¯”å¦‚ä¸¤ä¸ªç±»çš„ Class å¯¹è±¡ä¸ equalsï¼‰ã€‚</p>
<p>ç«™åœ¨ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒJava ç±»åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä¸‰ç§ã€‚</p>
<p>1ï¼‰å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap Class-Loaderï¼‰ï¼ŒåŠ è½½ jre/lib åŒ…ä¸‹é¢çš„ jar æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´å¸¸è§çš„ rt.jarã€‚</p>
<p>2ï¼‰æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension or Ext Class-Loaderï¼‰ï¼ŒåŠ è½½ jre/lib/ext åŒ…ä¸‹é¢çš„ jar æ–‡ä»¶ã€‚</p>
<p>3ï¼‰åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication or App Clas-Loaderï¼‰ï¼Œæ ¹æ®ç¨‹åºçš„ç±»è·¯å¾„ï¼ˆclasspathï¼‰æ¥åŠ è½½ Java ç±»ã€‚</p>
<p>æ¥æ¥æ¥ï¼Œé€šè¿‡ä¸€æ®µç®€å•çš„ä»£ç äº†è§£ä¸‹ã€‚</p>
<pre><code class="java">public class Test &#123;

    public static void main(String[] args) &#123;
        ClassLoader loader = Test.class.getClassLoader();
        while (loader != null) &#123;
            System.out.println(loader.toString());
            loader = loader.getParent();
        &#125;
    &#125;

&#125;
</code></pre>
<p>æ¯ä¸ª Java ç±»éƒ½ç»´æŠ¤ç€ä¸€ä¸ªæŒ‡å‘å®šä¹‰å®ƒçš„ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œé€šè¿‡ ç±»å.class.getClassLoader() å¯ä»¥è·å–åˆ°æ­¤å¼•ç”¨ï¼›ç„¶åé€šè¿‡ loader.getParent() å¯ä»¥è·å–ç±»åŠ è½½å™¨çš„ä¸Šå±‚ç±»åŠ è½½å™¨ã€‚</p>
<p>è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p>sun.misc.Launcher$AppClassLoader@73d16e93<br>sun.misc.Launcher$ExtClassLoader@15db9742<br>ç¬¬ä¸€è¡Œè¾“å‡ºä¸º Test çš„ç±»åŠ è½½å™¨ï¼Œå³åº”ç”¨ç±»åŠ è½½å™¨ï¼Œå®ƒæ˜¯ sun.misc.Launcher$AppClassLoader ç±»çš„å®ä¾‹ï¼›ç¬¬äºŒè¡Œè¾“å‡ºä¸ºæ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ˜¯ sun.misc.Launcher$ExtClassLoader ç±»çš„å®ä¾‹ã€‚é‚£å¯åŠ¨ç±»åŠ è½½å™¨å‘¢ï¼Ÿ</p>
<p>æŒ‰ç†è¯´ï¼Œæ‰©å±•ç±»åŠ è½½å™¨çš„ä¸Šå±‚ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä½†åœ¨æˆ‘è¿™ä¸ªç‰ˆæœ¬çš„ JDK ä¸­ï¼Œ æ‰©å±•ç±»åŠ è½½å™¨çš„ getParent() è¿”å› nullã€‚æ‰€ä»¥æ²¡æœ‰è¾“å‡ºã€‚</p>
<hr>
<p>åŒäº²å§”æ´¾æœºåˆ¶ï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-5314cbdba627f795c147f27e03270d392c7.png" width=400 height=450></p>
<h2 id="åŒäº²å§”æ´¾å¦‚ä½•ç ´å"><a href="#åŒäº²å§”æ´¾å¦‚ä½•ç ´å" class="headerlink" title="åŒäº²å§”æ´¾å¦‚ä½•ç ´å"></a>åŒäº²å§”æ´¾å¦‚ä½•ç ´å</h2><p>çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://blog.csdn.net/weixin_40236948/article/details/88072698">Javaç±»åŠ è½½æœºåˆ¶</a><br>2ã€<a href="https://blog.csdn.net/codeyanbao/article/details/82875064">é€šä¿—æ˜“æ‡‚çš„åŒäº²å§”æ´¾æœºåˆ¶</a>  </p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM-è‡ªå®šä¹‰ç±»åŠ è½½å™¨</title>
    <url>/wiki/JVM-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h1><p>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰åŠ è½½å™¨</p>
<p>åŸå› ï¼š<br>1ã€å­˜æ”¾åœ¨è‡ªå®šä¹‰è·¯å¾„ä¸Šçš„ç±»ï¼Œéœ€è¦é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»åŠ è½½ã€‚ã€æ³¨æ„ï¼šAppClassLoaderåŠ è½½classpathä¸‹çš„ç±»ã€‘<br>2ã€ç±»ä¸ä¸€å®šä»æ–‡ä»¶ä¸­åŠ è½½ï¼Œä¹Ÿå¯èƒ½ä»ç½‘ç»œä¸­çš„æµä¸­åŠ è½½ï¼Œè¿™å°±éœ€è¦è‡ªå®šä¹‰åŠ è½½å™¨å»å®ç°åŠ å¯†è§£å¯†ã€‚<br>3ã€å¯ä»¥å®šä¹‰ç±»çš„å®ç°æœºåˆ¶ï¼Œå®ç°ç±»çš„çƒ­éƒ¨ç½²,<br>å¦‚OSGiä¸­çš„bundleæ¨¡å—å°±æ˜¯é€šè¿‡å®ç°è‡ªå·±çš„ClassLoaderå®ç°çš„ï¼Œ<br>å¦‚tomcatå®ç°çš„è‡ªå®šä¹‰ç±»åŠ è½½æ¨¡å‹ã€‚</p>
<p>å¦‚ä½•å®ç°è‡ªå®šä¹‰åŠ è½½å™¨</p>
<blockquote>
<p>å®ç°è‡ªå®šä¹‰ç±»åŠ è½½æœ‰ä»¥ä¸‹ä¸¤æ­¥ï¼š<br>1ã€ç»§æ‰¿ClassLoader<br>2ã€é‡å†™findClassï¼Œåœ¨findClassé‡Œè·å–ç±»çš„å­—èŠ‚ç ï¼Œå¹¶è°ƒç”¨ClassLoaderä¸­çš„defineClassæ–¹æ³•æ¥åŠ è½½ç±»ï¼Œè·å–classå¯¹è±¡ã€‚<br>æ³¨æ„ï¼šå¦‚æœè¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œéœ€è¦é‡å†™loadClassæ–¹æ³•ã€‚<br>å¦‚ä¸‹ï¼šæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ çš„ç±»åŠ è½½å™¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span>  <span class="keyword">extends</span>  <span class="title">ClassLoader</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] data=<span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                 data= loadByte(name);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.defineClass(data,<span class="number">0</span>,data.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">byte</span>[] loadByte(String name) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;/Users/admin/test/&quot;</span>+name);</span><br><span class="line">            FileInputStream fi = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            <span class="keyword">int</span> len = fi.available();</span><br><span class="line">            <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[len];</span><br><span class="line">            fi.read(b);</span><br><span class="line">            <span class="keyword">return</span> b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>ä¸‹é¢æ˜¯è¦åŠ è½½çš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span></span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥ç±»ç¼–è¯‘åçš„class æ–‡ä»¶æ”¾ç½®åœ¨/Users/admin/test/ä¸‹,ç„¶åæ‰§è¡Œå¦‚ä¸‹ä»£ç å»åŠ è½½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MyClassLoader classLoader = <span class="keyword">new</span> MyClassLoader();</span><br><span class="line">        Class clazz = classLoader.loadClass(<span class="string">&quot;Demo.class&quot;</span>);</span><br><span class="line">        Object o=clazz.newInstance();</span><br><span class="line">        Method method = clazz.getMethod(<span class="string">&quot;say&quot;</span>);</span><br><span class="line">        method.invoke(o);</span><br><span class="line"></span><br><span class="line">è¾“å‡º:hello</span><br></pre></td></tr></table></figure>

<p>èƒ½ä¸èƒ½è‡ªå·±å†™ä¸€ä¸ªjava.lang.String</p>
<p>1ã€ä»£ç ä¹¦å†™åå¯ä»¥ç¼–è¯‘ä¸ä¼šæŠ¥é”™<br>2ã€åœ¨å¦ä¸€ä¸ªç±»ä¸­åŠ è½½java.lang.Stringï¼Œé€šè¿‡åå°„è°ƒç”¨è‡ªå·±å†™çš„Stringç±»é‡Œçš„æ–¹æ³•ï¼Œå¾—åˆ°ç»“æœNoSuchMethodï¼Œè¯´æ˜åŠ è½½çš„è¿˜æ˜¯åŸæ¥çš„Stringï¼Œå› ä¸ºé€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¼šæŠŠjava.lang.Stringä¸€ç›´æäº¤ç»™å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œé€šè¿‡ä»–åŠ è½½ï¼ŒåŠ è½½åˆ°çš„æ°¸è¿œæ˜¯/libä¸‹é¢çš„java.lang.String<br>3ã€åœ¨è¿™ä¸ªè‡ªå·±å†™çš„ç±»ä¸­å†™ä¸Šmainæ–¹æ³•<br>public static void main(String[] args)<br>æ‰§è¡Œmainæ–¹æ³•æŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªStringå¹¶ä¸æ˜¯ç³»ç»Ÿçš„java.lang.Stringï¼Œæ‰€ä»¥JVMæ‰¾ä¸åˆ°mainæ–¹æ³•çš„ç­¾å</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/qq_28605513/article/details/85014451">JVM:å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Ÿ</a><br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_28605513/article/details/85014451">https://blog.csdn.net/qq_28605513/article/details/85014451</a></p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-CASåŸç†å’Œåº•å±‚å®ç°</title>
    <url>/wiki/Java-CAS%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="CASåŸç†å’Œåº•å±‚å®ç°"><a href="#CASåŸç†å’Œåº•å±‚å®ç°" class="headerlink" title="CASåŸç†å’Œåº•å±‚å®ç°"></a>CASåŸç†å’Œåº•å±‚å®ç°</h1><img src="https://oscimg.oschina.net/oscnet/up-0ed0dcb929342035287eb09818f33416baa.png" width=550 height=400>

<h2 id="ä»€ä¹ˆæ˜¯CAS"><a href="#ä»€ä¹ˆæ˜¯CAS" class="headerlink" title="ä»€ä¹ˆæ˜¯CAS"></a>ä»€ä¹ˆæ˜¯CAS</h2><p>CASæ˜¯ï¼ˆcompare and swapï¼‰ çš„ç¼©å†™ï¼Œå®ƒèƒ½åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œä¿è¯å¤šçº¿ç¨‹ä¸€è‡´æ€§çš„æ”¹åŠ¨æŸä¸€å€¼ï¼›</p>
<h2 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h2><p>ABAé—®é¢˜æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨CASæ¯”è¾ƒå€¼å’ŒåŸæ¥æ˜¯å¦ç›¸ç­‰çš„è¿‡ç¨‹ä¸­ï¼Œåˆ«çš„çº¿ç¨‹ä¿®æ”¹è¿‡è¿™ä¸ªå€¼ï¼Œä½†æ˜¯åˆæ”¹å›å»äº†ï¼Œå€’ç½®å½“å‰çº¿ç¨‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå‘ç°æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯ï¼Œä¸­é—´æ˜¯è¢«ä¿®æ”¹è¿‡çš„ï¼›  </p>
<p>æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯”è¾ƒå€¼çš„æ—¶å€™åŒæ—¶æ¯”è¾ƒç‰ˆæœ¬å·</p>
<h2 id="CASåº•å±‚åŸç†"><a href="#CASåº•å±‚åŸç†" class="headerlink" title="CASåº•å±‚åŸç†"></a>CASåº•å±‚åŸç†</h2><h3 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger:"></a>AtomicInteger:</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">incrementAndGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> current = get();</span><br><span class="line">            <span class="keyword">int</span> next = current + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSet(current, next))</span><br><span class="line">                <span class="keyword">return</span> next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, valueOffset, expect, update);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Unsafe"><a href="#Unsafe" class="headerlink" title="Unsafe:"></a>Unsafe:</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">compareAndSwapInt</span><span class="params">(Object var1, <span class="keyword">long</span> var2, <span class="keyword">int</span> var4, <span class="keyword">int</span> var5)</span></span>;</span><br></pre></td></tr></table></figure>

<p>è¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mashibing.jol;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.Unsafe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T02_TestUnsafe</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> T02_TestUnsafe t = <span class="keyword">new</span> T02_TestUnsafe();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//Unsafe unsafe = Unsafe.getUnsafe();</span></span><br><span class="line"></span><br><span class="line">        Field unsafeField = Unsafe.class.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">        unsafeField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Unsafe unsafe = (Unsafe) unsafeField.get(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        Field f = T02_TestUnsafe.class.getDeclaredField(<span class="string">&quot;i&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> offset = unsafe.objectFieldOffset(f);</span><br><span class="line">        System.out.println(offset);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> success = unsafe.compareAndSwapInt(t, offset, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(success);</span><br><span class="line">        System.out.println(t.i);</span><br><span class="line">        <span class="comment">//unsafe.compareAndSwapInt()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jdk8u: unsafe.cpp:</p>
<p>cmpxchg = compare and exchange</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">UNSAFE_ENTRY</span>(jboolean, <span class="built_in">Unsafe_CompareAndSwapInt</span>(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x))</span><br><span class="line">  <span class="built_in">UnsafeWrapper</span>(<span class="string">&quot;Unsafe_CompareAndSwapInt&quot;</span>);</span><br><span class="line">  oop p = JNIHandles::<span class="built_in">resolve</span>(obj);</span><br><span class="line">  jint* addr = (jint *) <span class="built_in">index_oop_from_field_offset_long</span>(p, offset);</span><br><span class="line">  <span class="keyword">return</span> (jint)(Atomic::<span class="built_in">cmpxchg</span>(x, addr, e)) == e;</span><br><span class="line">UNSAFE_END</span><br></pre></td></tr></table></figure>

<h3 id="jdk8u-atomic-linux-x86-inline-hpp-93è¡Œ"><a href="#jdk8u-atomic-linux-x86-inline-hpp-93è¡Œ" class="headerlink" title="jdk8u: atomic_linux_x86.inline.hpp 93è¡Œ"></a>jdk8u: atomic_linux_x86.inline.hpp <strong>93è¡Œ</strong></h3><p>is_MP = Multi Processor  </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> jint     <span class="title">Atomic::cmpxchg</span>    <span class="params">(jint     exchange_value, <span class="keyword">volatile</span> jint*     dest, jint     compare_value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> mp = os::<span class="built_in">is_MP</span>();</span><br><span class="line">  <span class="function">__asm__ <span class="title">volatile</span> <span class="params">(LOCK_IF_MP(%<span class="number">4</span>) <span class="string">&quot;cmpxchgl %1,(%3)&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;=a&quot;</span> (exchange_value)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;r&quot;</span> (exchange_value), <span class="string">&quot;a&quot;</span> (compare_value), <span class="string">&quot;r&quot;</span> (dest), <span class="string">&quot;r&quot;</span> (mp)</span></span></span><br><span class="line"><span class="params"><span class="function">                    : <span class="string">&quot;cc&quot;</span>, <span class="string">&quot;memory&quot;</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> exchange_value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jdk8u: os.hpp is_MP()</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_MP</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// During bootstrap if _processor_count is not yet initialized</span></span><br><span class="line">  <span class="comment">// we claim to be MP as that is safest. If any platform has a</span></span><br><span class="line">  <span class="comment">// stub generator that might be triggered in this phase and for</span></span><br><span class="line">  <span class="comment">// which being declared MP when in fact not, is a problem - then</span></span><br><span class="line">  <span class="comment">// the bootstrap routine for the stub generator needs to check</span></span><br><span class="line">  <span class="comment">// the processor count directly and leave the bootstrap routine</span></span><br><span class="line">  <span class="comment">// in place until called after initialization has ocurred.</span></span><br><span class="line">  <span class="keyword">return</span> (_processor_count != <span class="number">1</span>) || AssumeMP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>jdk8u: atomic_linux_x86.inline.hpp</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOCK_IF_MP(mp) <span class="meta-string">&quot;cmp $0, &quot;</span> #mp <span class="meta-string">&quot;; je 1f; lock; 1: &quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="æœ€ç»ˆå®ç°ï¼š"><a href="#æœ€ç»ˆå®ç°ï¼š" class="headerlink" title="æœ€ç»ˆå®ç°ï¼š"></a>æœ€ç»ˆå®ç°ï¼š</h3><p>åº•å±‚å¯¹åº”ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤ã€Œlock comxchgã€ï¼Œä½†æ˜¯comxchgè¿™æ¡æŒ‡ä»¤ä¸æ˜¯åŸå­æ€§çš„ï¼Œä»–ä¸èƒ½ä¿è¯åœ¨æ¯”è¾ƒçš„æ—¶å€™ï¼Œåˆ«çš„çº¿ç¨‹ä¼šä¸ä¼šæ”¹å˜å€¼ï¼›è€Œä¿è¯çº¿ç¨‹å®‰å…¨çš„åˆ™æ˜¯lockè¿™æ¡æŒ‡ä»¤ï¼Œlockè¿™æ¡æŒ‡ä»¤åœ¨æ‰§è¡Œåé¢æ‰§è¡Œçš„æ—¶å€™é”å®šä¸€ä¸ªã€ŒåŒ—æ¡¥ä¿¡å·ã€ï¼Œè€Œä¸æ˜¯é‡‡ç”¨çºµçº¿é”çš„æ–¹å¼ï¼›</p>
<h2 id="CASåœ¨JDKä¸­çš„å®ç°"><a href="#CASåœ¨JDKä¸­çš„å®ç°" class="headerlink" title="CASåœ¨JDKä¸­çš„å®ç°"></a>CASåœ¨JDKä¸­çš„å®ç°</h2><p>1ã€AtomitInteger<br>2ã€ConcurrentHashMap</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-FutureTaskåŸç†</title>
    <url>/wiki/Java-FutureTask%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h1><h3 id="Futureæ–¹æ³•ä»‹ç»"><a href="#Futureæ–¹æ³•ä»‹ç»" class="headerlink" title="Futureæ–¹æ³•ä»‹ç»"></a>Futureæ–¹æ³•ä»‹ç»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å–æ¶ˆä»»åŠ¡ å¯ä¸­æ–­çš„æ–¹å¼å–æ¶ˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å¤„äºå–æ¶ˆçŠ¶æ€ </span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ¤æ–­å¼‚æ­¥ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ      ==è¿™é‡Œä½¿ç”¨è½®è®­çš„æ–¹å¼ç›‘å¬==</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å¼‚æ­¥çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™ä¸€ç›´é˜»å¡åˆ°æœ‰ç»“æœè¿”å›ï¼›</span></span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å¼‚æ­¥çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™ä¸€ç›´é˜»å¡åˆ°è®¾ç½®çš„æ—¶é—´ï¼Œæœ‰ç»“æœè¿”å›ï¼Œæ²¡æœ‰ç»“æœåˆ™æŠ›å‡ºå¼‚å¸¸ï¼›</span></span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç®€å•ç¤ºèŒƒCallable-amp-Future"><a href="#ç®€å•ç¤ºèŒƒCallable-amp-Future" class="headerlink" title="ç®€å•ç¤ºèŒƒCallable&amp;Future"></a>ç®€å•ç¤ºèŒƒCallable&amp;Future</h3><p>ï¼ˆ1ï¼‰å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡çš„submitæ–¹æ³•ä¸æ˜¯é˜»å¡æ–¹æ³•ï¼Œè€ŒFuture.getæ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•<br>ï¼ˆ2ï¼‰submitæäº¤å¤šä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰èƒ½ä½¿ç”¨getæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºå¾—åˆ°è¿”å›ç»“æœï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦ä½¿ç”¨future.isDoneå…ˆåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œå®Œæˆåå†ä½¿ç”¨future.getå¾—åˆ°ç»“æœã€‚ï¼ˆä¹Ÿå¯ä»¥ç”¨get (long timeout, TimeUnit unit)æ–¹æ³•å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢æ— é™æ—¶é—´çš„ç­‰å¾…ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTest</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Computes a result, or throws an exception if unable to do so.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> computed result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception if unable to compute a result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;start call method...&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1111</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;main method start....&quot;</span>);</span><br><span class="line">        FutureTest futureTest = <span class="keyword">new</span> FutureTest();</span><br><span class="line">        Future1Test future1Test = <span class="keyword">new</span> Future1Test();</span><br><span class="line">        <span class="keyword">long</span> time = System.currentTimeMillis();</span><br><span class="line">        ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">        Future&lt;String&gt; future = executorService.submit(future1Test);</span><br><span class="line">        <span class="keyword">if</span> (!future.isDone()) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;future not done !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Future&lt;Integer&gt; future1 = executorService.submit(futureTest);</span><br><span class="line">        <span class="comment">// submitæäº¤å¤šä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰èƒ½ä½¿ç”¨getæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºå¾—åˆ°è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå…ˆæäº¤äº†future1Testï¼Œä¼‘çœ äº†4s, futureTestä¼‘çœ äº†3sï¼Œä½†æ˜¯ç­‰æˆ‘ä»¬getåˆ°ç»“æœçš„æ—¶å€™ï¼Œæ˜¯æ¶ˆè€—çš„4sæ—¶é—´çš„ï¼›</span></span><br><span class="line">        System.err.println(<span class="string">&quot;cost time: &quot;</span> + (System.currentTimeMillis() - time));</span><br><span class="line">        System.err.println(<span class="string">&quot;future: &quot;</span> + future.get());</span><br><span class="line">        System.err.println(<span class="string">&quot;future1: &quot;</span> + future1.get());</span><br><span class="line">        System.err.println(<span class="string">&quot;main method end....&quot;</span>);</span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">main method start....</span><br><span class="line">future not done !</span><br><span class="line"><span class="comment">// è¯´æ˜äº†ç¬¬ä¸€ get()æ–¹æ³•æ˜¯é˜»å¡ï¼Œç¬¬äºŒçº¿ç¨‹æ± ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼ŒæŒ‰æäº¤ä»»åŠ¡é¡ºåºgetç»“æœè¿”å›å€¼</span></span><br><span class="line">cost time: <span class="number">4</span></span><br><span class="line">start call method...</span><br><span class="line">future: future <span class="number">2</span> test</span><br><span class="line">future1: <span class="number">1111</span></span><br><span class="line">main method end....</span><br></pre></td></tr></table></figure>

<h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><ul>
<li>çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼executeå’Œsubmitï¼Œexecuteæ˜¯ä¸å¸¦è¿”å›å€¼çš„ï¼Œsubmitæ˜¯æœ‰è¿”å›å€¼çš„;</li>
<li>mainæ–¹æ³•ä¸­å¯ä»¥ä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨startæ–¹æ³•å°±å¯ä»¥ï¼Œåˆ‡è®°åªæœ‰åœ¨æ¼”ç¤ºä»£ç çš„æ—¶å€™åã€‚æ‰‹åŠ¨ç›´æ¥åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼è¿˜æ˜¯ä¸è¦ç”¨ï¼Œå› ä¸ºä¸€æ—¦è¯·æ±‚å˜å¤šï¼Œåˆ™ä¼šåˆ›å»ºæ— æ•°çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ•°å¤§äºCPUæ ¸æ•°ï¼Œè¿›è€Œå¯¼è‡´CPUé¢‘ç¹åˆ‡æ¢ä¸Šä¸‹åˆ†è¿›è¡Œè°ƒåº¦ï¼Œæ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚</li>
<li>è€Œä¸”çº¿ç¨‹çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ï¼Œå¢åŠ åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚ä¸¥é‡çš„ä¼šå‘ç”ŸOOM;</li>
<li>å¼‚å¸¸mainæ–¹æ³•ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Future<String> futureæ¥æ”¶å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„æ”¾å›ç»“æœï¼Œä½†å®é™…ä¸ŠFutureå…¶å®æ˜¯ä¸€ä¸ªinterfaceï¼Œå¹¶ä¸èƒ½æ¥æ”¶è¿”å›ç»“æœçš„ï¼Œé‚£å®é™…æˆ‘ä»¬è°ƒç”¨future.get()æ˜¯ï¼Œæ˜¯å®ä¾‹äº†ä¸€ä¸ªFutureTaskå¯¹è±¡æ¥æ¥å—çš„ï¼›</li>
</ul>
<h3 id="FutureTaskè®²è§£"><a href="#FutureTaskè®²è§£" class="headerlink" title="FutureTaskè®²è§£"></a>FutureTaskè®²è§£</h3><p>ä¸‹é¢ä¸»è¦é’ˆå¯¹Futureçš„å®ç°ç±»FutureTaskçš„å‡ ä¸ªé‡è¦æ–¹æ³•å±•å¼€</p>
<h4 id="FutureTaskç»§æ‰¿å…³ç³»"><a href="#FutureTaskç»§æ‰¿å…³ç³»" class="headerlink" title="FutureTaskç»§æ‰¿å…³ç³»"></a>FutureTaskç»§æ‰¿å…³ç³»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTask</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; </span>&#123;...&#125;</span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯RunnableFutureæ¥å£çš„ç»§æ‰¿å…³ç³»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RunnableFuture</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Runnable</span>, <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets this Future to the result of its computation</span></span><br><span class="line"><span class="comment">     * unless it has been cancelled.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>FutureTask é‡è¦çš„æˆå‘˜å˜é‡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** The underlying callable; nulled out after running */</span></span><br><span class="line"><span class="keyword">private</span> Callable&lt;V&gt; callable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The result to return or exception to throw from get() */</span></span><br><span class="line"><span class="comment">//ä»»åŠ¡æ‰§è¡Œç»“æœæˆ–è€…ä»»åŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">private</span> Object outcome; <span class="comment">// non-volatile, protected by state reads/writes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** The thread running the callable; CASed during run() */</span></span><br><span class="line"><span class="comment">//æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> Thread runner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Treiber stack of waiting threads */</span></span><br><span class="line"><span class="comment">//ç­‰å¾…èŠ‚ç‚¹ï¼Œå…³è”ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> WaitNode waiters;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.Unsafe UNSAFE;</span><br><span class="line"><span class="comment">//stateå­—æ®µçš„å†…å­˜åç§»é‡     è¿™ä¸ªåœ¨çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™è¿›è¡ŒçŠ¶æ€åˆ¤æ–­çš„æ—¶å€™ä¼šç”¨åˆ°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> stateOffset;</span><br><span class="line"><span class="comment">//runnerå­—æ®µçš„å†…å­˜åç§»é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> runnerOffset;</span><br><span class="line"><span class="comment">//waiterså­—æ®µçš„å†…å­˜åç§»é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> waitersOffset;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®šä¹‰ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NEW          = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> COMPLETING   = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NORMAL       = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXCEPTIONAL  = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED    = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTING = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INTERRUPTED  = <span class="number">6</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>NORMAL:æŒ‡çš„æ˜¯ä»»åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡ŒçŠ¶æ€  </li>
<li>EXCEPTIONALï¼šè¡¨ç¤ºä»»åŠ¡æ‰§è¡Œå¼‚å¸¸  </li>
<li>CANCELLEDï¼šå–æ¶ˆçŠ¶æ€ï¼Œä¹‹åçš„çŠ¶æ€éƒ½è¡¨ç¤ºä»»åŠ¡å–æ¶ˆæˆ–ç»ˆç«¯  </li>
</ul>
<p>ä¸‹é¢çœ‹ä¸€ä¸‹FutureTaskä¸­å‡ ä¸ªé‡è¦çš„æ–¹æ³•</p>
<h4 id="æ‰§è¡Œç»“æœ-reportæ–¹æ³•"><a href="#æ‰§è¡Œç»“æœ-reportæ–¹æ³•" class="headerlink" title="æ‰§è¡Œç»“æœ | reportæ–¹æ³•"></a>æ‰§è¡Œç»“æœ | reportæ–¹æ³•</h4><blockquote>
<p>Returns result or throws exception for completed task.<br>ä¸»è¦æ˜¯ä¸ŠæŠ¥å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–è¿”å›ä»»åŠ¡æ‰§è¡Œå‘ç”Ÿçš„å¼‚å¸¸</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Returns result or throws exception for completed task.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> s completed state value</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> V <span class="title">report</span><span class="params">(<span class="keyword">int</span> s)</span> <span class="keyword">throws</span> ExecutionException </span>&#123;</span><br><span class="line">       Object x = outcome;</span><br><span class="line">       <span class="keyword">if</span> (s == NORMAL)</span><br><span class="line">           <span class="keyword">return</span> (V)x;</span><br><span class="line">       <span class="keyword">if</span> (s &gt;= CANCELLED)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> CancellationException();</span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> ExecutionException((Throwable)x);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­é€»è¾‘å°±æ˜¯æ ¹æ®å‚æ•°ï¼Œä¹Ÿæ˜¯æ˜¯ä»»åŠ¡çŠ¶æ€ï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€å¤„ç†ç›¸åº”çš„é€»è¾‘ã€‚æ¯”å¦‚NORNALçŠ¶æ€ï¼Œè¡¨ç¤ºä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œç›´æ¥è¿”å›ç»“æœå°±å¯ä»¥ã€‚å¦‚æœçŠ¶æ€å¤§äºCANCELLEDï¼Œè¯´æ˜ä»»åŠ¡è¢«å–æ¶ˆæˆ–ç»ˆç«¯ï¼Œä¼šæŠ›å‡ºCancellationException()ï¼›å¦‚æœä¸æ˜¯å¼‚å¸¸çŠ¶æ€ï¼Œåˆ™æŠ›å‡ºExecutionExceptionï¼›</p>
<h4 id="ä»»åŠ¡æ‰§è¡Œ-run"><a href="#ä»»åŠ¡æ‰§è¡Œ-run" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œ |   run()"></a>ä»»åŠ¡æ‰§è¡Œ |   run()</h4><blockquote>
<p>æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// å¦‚æœçŠ¶æ€ state ä¸æ˜¯ NEWï¼Œæˆ–è€…è®¾ç½® runner å€¼å¤±è´¥</span></span><br><span class="line">     <span class="comment">// è¡¨ç¤ºæœ‰åˆ«çš„çº¿ç¨‹åœ¨æ­¤ä¹‹å‰è°ƒç”¨ run æ–¹æ³•ï¼Œå¹¶æˆåŠŸè®¾ç½®äº† runner å€¼</span></span><br><span class="line">     <span class="comment">// ä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œ try ä»£ç å—ä¸­çš„ä»£ç ã€‚</span></span><br><span class="line">     <span class="keyword">if</span> (state != NEW ||</span><br><span class="line">             !UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, runnerOffset,</span><br><span class="line">                     <span class="keyword">null</span>, Thread.currentThread()))</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     <span class="comment">//ä»¥ä¸Šstateå€¼å˜æ›´çš„ç”±CASæ“ä½œä¿è¯åŸå­æ€§</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         Callable&lt;V&gt; c = callable;</span><br><span class="line">         <span class="comment">//åªæœ‰cä¸ä¸ºnullä¸”çŠ¶æ€stateä¸ºNEWçš„æƒ…å†µ</span></span><br><span class="line">         <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class="line">             V result;</span><br><span class="line">             <span class="keyword">boolean</span> ran;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 <span class="comment">//è°ƒç”¨callableçš„callæ–¹æ³•ï¼Œå¹¶è·å¾—è¿”å›ç»“æœ</span></span><br><span class="line">                 result = c.call();</span><br><span class="line">                 <span class="comment">//è¿è¡ŒæˆåŠŸ</span></span><br><span class="line">                 ran = <span class="keyword">true</span>;</span><br><span class="line">             &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                 result = <span class="keyword">null</span>;</span><br><span class="line">                 ran = <span class="keyword">false</span>;</span><br><span class="line">                 setException(ex);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">if</span> (ran)</span><br><span class="line">                 <span class="comment">//è®¾ç½®ç»“æœ</span></span><br><span class="line">                 set(result);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="comment">// runner must be non-null until state is settled to</span></span><br><span class="line">         <span class="comment">// prevent concurrent calls to run()</span></span><br><span class="line">         runner = <span class="keyword">null</span>;</span><br><span class="line">         <span class="comment">// state must be re-read after nulling runner to prevent</span></span><br><span class="line">         <span class="comment">// leaked interrupts</span></span><br><span class="line">         <span class="keyword">int</span> s = state;</span><br><span class="line">         <span class="keyword">if</span> (s &gt;= INTERRUPTING)</span><br><span class="line">             handlePossibleCancellationInterrupt(s);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ ¸å¿ƒé€»è¾‘å°±æ˜¯è°ƒç”¨Callableçš„callæ–¹æ³•ï¼Œ==result=c.call();== å¹¶ä¸”å¯¹ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼›</p>
<h4 id="è·å–ç»“æœ-get-throws-InterruptedException-ExecutionException"><a href="#è·å–ç»“æœ-get-throws-InterruptedException-ExecutionException" class="headerlink" title="è·å–ç»“æœ | get() throws InterruptedException, ExecutionException"></a>è·å–ç»“æœ | get() throws InterruptedException, ExecutionException</h4><blockquote>
<p>è·å–å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–å¼‚å¸¸ä¿¡æ¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = state;</span><br><span class="line">    <span class="keyword">if</span> (s &lt;= COMPLETING)</span><br><span class="line">        s = awaitDone(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">    <span class="keyword">return</span> report(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getæ–¹æ³•æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š  </p>
<ul>
<li>åˆ¤æ–­ä»»åŠ¡çš„çŠ¶æ€,å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œè°ƒç”¨awaitDoneæ–¹æ³•</li>
<li>ä»»åŠ¡å®Œæˆï¼Œè°ƒç”¨æˆ‘ä»¬ä¸Šé¢è¯´çš„reportæ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœ</li>
</ul>
<h4 id="ä»»åŠ¡é˜»å¡-awaitDone-boolean-timed-long-nanos"><a href="#ä»»åŠ¡é˜»å¡-awaitDone-boolean-timed-long-nanos" class="headerlink" title="ä»»åŠ¡é˜»å¡ | awaitDone(boolean timed, long nanos)"></a>ä»»åŠ¡é˜»å¡ | awaitDone(boolean timed, long nanos)</h4><blockquote>
<p>ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆ ä¹Ÿæ˜¯getæ–¹æ³•é˜»å¡ç‰¹æ€§çš„å…³é”®æ‰€åœ¨</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">awaitDone</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> deadline = timed ? System.nanoTime() + nanos : <span class="number">0L</span>;</span><br><span class="line">        WaitNode q = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> queued = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// CPUè½®è½¬</span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœçº¿ç¨‹ä¸­æ–­äº†ï¼Œå°†çº¿ç¨‹ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ï¼ŒæŠ›å‡ºä¸­æ–­å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">                removeWaiter(q);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> s = state;</span><br><span class="line">            <span class="comment">// å¦‚æœä»»åŠ¡çŠ¶æ€å¤§äºå®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ï¼›</span></span><br><span class="line">            <span class="keyword">if</span> (s &gt; COMPLETING) &#123;</span><br><span class="line">                <span class="keyword">if</span> (q != <span class="keyword">null</span>)</span><br><span class="line">                    q.thread = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">return</span> s;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯è¿”å›å€¼outcomeè¿˜æ²¡æœ‰è®¾ç½®ï¼Œå¯ä»¥å…ˆè®©å‡ºçº¿ç¨‹æ‰§è¡Œæƒï¼Œè®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (s == COMPLETING) <span class="comment">// cannot time out yet</span></span><br><span class="line">                Thread.yield();</span><br><span class="line">            <span class="comment">// ä¸‹é¢æ˜¯ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„çŠ¶æ€ï¼Œå°†çº¿ç¨‹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (q == <span class="keyword">null</span>)</span><br><span class="line">                q = <span class="keyword">new</span> WaitNode();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!queued)</span><br><span class="line">                queued = UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset,</span><br><span class="line">                                                     q.next = waiters, q);</span><br><span class="line">            <span class="comment">// åˆ¤æ–­getæ–¹æ³•æ˜¯å¦è®¾ç½®äº†è¶…æ—¶æ—¶é—´</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (timed) &#123;</span><br><span class="line">                nanos = deadline - System.nanoTime();</span><br><span class="line">                <span class="comment">// å¦‚æœè¶…å‡ºè®¾ç½®çš„æ—¶é—´ï¼Œçº¿ç¨‹ç§»é™¤ç­‰åˆ°é˜Ÿåˆ—</span></span><br><span class="line">                <span class="keyword">if</span> (nanos &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                    removeWaiter(q);</span><br><span class="line">                    <span class="keyword">return</span> state;</span><br><span class="line">                &#125;</span><br><span class="line">                LockSupport.parkNanos(<span class="keyword">this</span>, nanos);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œçº¿ç¨‹ç›´æ¥é˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>ä¸»è¦æ‰§è¡Œæ­¥éª¤ï¼š</p>
<ul>
<li>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¦‚æœè¢«ä¸­æ–­äº†ï¼Œå°±ä»ç­‰å¾…çš„çº¿ç¨‹æ ˆä¸­ç§»é™¤è¯¥ç­‰å¾…èŠ‚ç‚¹ï¼Œç„¶åæŠ›å‡ºä¸­æ–­å¼‚å¸¸ </li>
<li>è¯»å–state,åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¦‚æœå·²ç»å®Œæˆæˆ–è€…ä»»åŠ¡å·²ç»å–æ¶ˆï¼Œæ­¤æ—¶è°ƒç”¨getæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œä¼šç›´æ¥è·å–åˆ°ç»“æœæˆ–è€…æ‹¿åˆ°å¼‚å¸¸ä¿¡æ¯ï¼›  </li>
<li>å¦‚æœs == COMPLETINGï¼Œè¯´æ˜ä»»åŠ¡å·²ç»ç»“æŸï¼Œä½†æ˜¯ç»“æœè¿˜æ²¡æœ‰ä¿å­˜åˆ°outcomeä¸­ï¼Œ==æ­¤æ—¶çº¿ç¨‹è®©å‡ºæ‰§è¡Œæƒï¼Œç»™å…¶ä»–çº¿ç¨‹å…ˆæ‰§è¡Œï¼›==   </li>
<li>å¦‚æœä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™éœ€è¦åˆ›å»ºç­‰å¾…èŠ‚ç‚¹ï¼Œç­‰å¾…æ’å…¥åˆ°é˜»å¡é˜Ÿåˆ—  </li>
<li>åˆ¤æ–­queuedï¼Œè¿™é‡Œæ˜¯å°†cä¸­åˆ›å»ºèŠ‚ç‚¹qåŠ å…¥é˜Ÿåˆ—å¤´ã€‚ä½¿ç”¨Unsafeçš„CASæ–¹æ³•ï¼Œå¯¹waitersè¿›è¡Œèµ‹å€¼ï¼Œwaitersä¹Ÿæ˜¯ä¸€ä¸ªWaitNodeèŠ‚ç‚¹ï¼Œç›¸å½“äºé˜Ÿåˆ—å¤´ï¼Œæˆ–è€…ç†è§£ä¸ºé˜Ÿåˆ—çš„å¤´æŒ‡é’ˆã€‚é€šè¿‡WaitNodeå¯ä»¥éå†æ•´ä¸ªé˜»å¡é˜Ÿåˆ—  </li>
<li>ç„¶ååˆ¤æ–­è¶…æ—¶æ—¶é—´ï¼Œæ—¶é—´æ˜¯åœ¨è°ƒç”¨getæ–¹æ³•çš„æ—¶å€™ä¼ è¾“è¿›æ¥çš„ï¼Œå¦‚æœæœ‰è¶…æ—¶æ—¶é—´ï¼Œåˆ™è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…å‡ºæ—¶é—´ï¼Œåˆ™å°†çº¿ç¨‹ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®æ—¶é—´ï¼Œåˆ™ç›´æ¥é˜»å¡çº¿ç¨‹ï¼›  </li>
</ul>
<h4 id="å–æ¶ˆä»»åŠ¡-cancel-boolean-mayInterruptIfRunning"><a href="#å–æ¶ˆä»»åŠ¡-cancel-boolean-mayInterruptIfRunning" class="headerlink" title="å–æ¶ˆä»»åŠ¡ |  cancel(boolean mayInterruptIfRunning)"></a>å–æ¶ˆä»»åŠ¡ |  cancel(boolean mayInterruptIfRunning)</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Param</span> mayInterruptIfRunning æ˜¯å¦ä¸­æ–­</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åœ¨çŠ¶æ€è¿˜ä¸ºNEWçš„æ—¶å€™ï¼Œæ ¹æ®å‚æ•°ä¸­çš„æ˜¯å¦å…è®¸ä¼ é€’ï¼Œ</span></span><br><span class="line"><span class="comment">     * å°†çŠ¶æ€æµè½¬åˆ°INTERRUPTINGæˆ–è€…CANCELLEDã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">        <span class="keyword">if</span> (!(state == NEW &amp;&amp;</span><br><span class="line">              UNSAFE.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, NEW,</span><br><span class="line">                  mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;    <span class="comment">// in case call to interrupt throws exception</span></span><br><span class="line">            <span class="keyword">if</span> (mayInterruptIfRunning) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread t = runner;</span><br><span class="line">                    <span class="keyword">if</span> (t != <span class="keyword">null</span>)</span><br><span class="line">                        t.interrupt();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123; <span class="comment">// final state</span></span><br><span class="line">                    UNSAFE.putOrderedInt(<span class="keyword">this</span>, stateOffset, INTERRUPTED);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            finishCompletion();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">finishCompletion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (WaitNode q; (q = waiters) != <span class="keyword">null</span>;) &#123;</span><br><span class="line">        <span class="comment">// å¿…é¡»å°†æ ˆé¡¶CASä¸ºnullï¼Œå¦åˆ™é‡è¯»æ ˆé¡¶å¹¶é‡è¯•ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset, q, <span class="keyword">null</span>)) &#123;</span><br><span class="line">            <span class="comment">// éå†å¹¶å”¤é†’æ ˆä¸­èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ã€‚</span></span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                Thread t = q.thread;</span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    q.thread = <span class="keyword">null</span>;</span><br><span class="line">                    LockSupport.unpark(t);</span><br><span class="line">                &#125;</span><br><span class="line">                WaitNode next = q.next;</span><br><span class="line">                <span class="keyword">if</span> (next == <span class="keyword">null</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">// å°†nextåŸŸç½®ä¸ºnullï¼Œè¿™æ ·å¯¹GCå‹å¥½ã€‚</span></span><br><span class="line">                q.next = <span class="keyword">null</span>; </span><br><span class="line">                q = next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * doneæ–¹æ³•æ˜¯æš´éœ²ç»™å­ç±»çš„ä¸€ä¸ªé’©å­æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–¹æ³•åœ¨ExecutorCompletionService.QueueingFutureä¸­çš„overrideå®ç°æ˜¯æŠŠç»“æœåŠ åˆ°é˜»å¡é˜Ÿåˆ—é‡Œã€‚</span></span><br><span class="line"><span class="comment">     * CompletionServiceè°ç”¨è°çŸ¥é“ï¼Œå¥¥ç§˜å…¨åœ¨è¿™ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    done();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * callableç½®ä¸ºnullä¸»è¦ä¸ºäº†å‡å°‘å†…å­˜å¼€é”€,</span></span><br><span class="line"><span class="comment">     * æ›´å¤šå¯ä»¥äº†è§£JVM memory footprintç›¸å…³èµ„æ–™ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    callable = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="Callable-amp-Futureä½¿ç”¨åœºæ™¯"><a href="#Callable-amp-Futureä½¿ç”¨åœºæ™¯" class="headerlink" title="Callable&amp;Futureä½¿ç”¨åœºæ™¯"></a>Callable&amp;Futureä½¿ç”¨åœºæ™¯</h3><ul>
<li>å¼‚æ­¥ä»»åŠ¡éœ€è¦æ‹¿åˆ°è¿”å›å€¼</li>
<li>å¤šçº¿ç¨‹å¹¶å‘è°ƒç”¨ï¼Œé¡ºåºç»„è£…è¿”å›å€¼ï¼Œä¸€äº›å¹¶å‘æ¡†æ¶ä¸­ä¼šçœ‹åˆ°ç›¸åº”ä½“ç°</li>
<li>è¿˜æœ‰ä¸€äº›åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„åœºæ™¯ï¼Œè¿œç¨‹è°ƒç”¨éœ€è¦å›å¡«æ‰§è¡Œç»“æœ</li>
<li>è¿˜æœ‰å¾ˆå¤šé€šä¿¡æ¡†æ¶ä¸­éƒ½æœ‰ä½“ç°</li>
</ul>
<hr>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><blockquote>
<p>(1) <a href="https://blog.csdn.net/qq_34562093/article/details/90209520">future.getæ–¹æ³•é˜»å¡é—®é¢˜çš„è§£å†³ï¼Œå®ç°æŒ‰ç…§ä»»åŠ¡å®Œæˆçš„å…ˆåé¡ºåºè·å–ä»»åŠ¡çš„ç»“æœ</a><br>(2) <a href="https://blog.csdn.net/luofenghan/article/details/78596950#%E6%97%A0%E9%99%90%E5%88%B6%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B">Javaå¤šçº¿ç¨‹å¼•å‘çš„æ€§èƒ½é—®é¢˜ä»¥åŠè°ƒä¼˜ç­–ç•¥</a><br>(3) <a href="https://www.jianshu.com/p/55221d045f39">å¯å–æ¶ˆçš„å¼‚æ­¥ä»»åŠ¡â€”â€”FutureTaskç”¨æ³•åŠè§£æ</a><br>(4) <a href="https://www.cnblogs.com/micrari/p/7374513.html">FutureTaskæºç è§£è¯»</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-NIO</title>
    <url>/wiki/Java-NIO/</url>
    <content><![CDATA[<h1 id="Java-NIO"><a href="#Java-NIO" class="headerlink" title="Java NIO"></a>Java NIO</h1><blockquote>
<p>Java NIO å¯¹äºJava BIOçš„ä¼˜åŒ–</p>
</blockquote>
<h2 id="Java-éé˜»å¡IO"><a href="#Java-éé˜»å¡IO" class="headerlink" title="Java éé˜»å¡IO"></a>Java éé˜»å¡IO</h2><blockquote>
<p>åŠæ—¶ä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä¹Ÿå¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">    LinkedList&lt;SocketChannel&gt; clients = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    ServerSocketChannel ss = ServerSocketChannel.open();</span><br><span class="line">    ss.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9090</span>));</span><br><span class="line">    ss.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">        <span class="comment">// éé˜»å¡</span></span><br><span class="line">        SocketChannel client = ss.accept();</span><br><span class="line">        <span class="keyword">if</span> (client == <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;client is null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            client.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">int</span> port = client.socket().getPort();</span><br><span class="line">            System.err.println(<span class="string">&quot;client port &quot;</span> + port);</span><br><span class="line">            clients.add(client);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocateDirect(<span class="number">4096</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸²å‹è¯</span></span><br><span class="line">        <span class="comment">// çœŸå®åœºæ™¯ä¸‹ æ¯ä¸€ä¸ªclientä¸€ä¸ªç‹¬è‡ªçš„buffer</span></span><br><span class="line">        <span class="keyword">for</span> (SocketChannel c : clients) &#123;</span><br><span class="line">            <span class="comment">// -1 å‡ºç°ç©ºè½®è®­ </span></span><br><span class="line">            <span class="keyword">int</span> num = c.read(byteBuffer);</span><br><span class="line">            <span class="keyword">if</span> (num &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                byteBuffer.flip();</span><br><span class="line">                <span class="keyword">byte</span>[] aaa = <span class="keyword">new</span> <span class="keyword">byte</span>[byteBuffer.limit()];</span><br><span class="line">                byteBuffer.get(aaa);</span><br><span class="line"></span><br><span class="line">                String b = <span class="keyword">new</span> String(aaa);</span><br><span class="line">                System.err.println(c.socket().getPort() + <span class="string">&quot; :   &quot;</span> + b);</span><br><span class="line">                <span class="comment">// æ¸…ç©º å¾ªç¯ä¸‹ä¸€æ¬¡clientåœ¨ä½¿ç”¨</span></span><br><span class="line">                byteBuffer.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä»¥ä¸Šå¯ä»¥å®ç°ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯é“¾æ¥ï¼ŒæœåŠ¡ç«¯éé˜»å¡æ¥æ”¶ï¼Œæ¥æ”¶ä¹‹åï¼Œè¯»å–æ•°æ®ä¹Ÿæ˜¯éé˜»å¡çš„ï¼›</p>
</blockquote>
<blockquote>
<p>NIOçš„éé˜»å¡æ˜¯æ“ä½œç³»ç»Ÿå†…éƒ¨å®ç°çš„ï¼Œåº•å±‚è°ƒç”¨äº†linuxå†…æ ¸çš„acceptå‡½æ•°</p>
</blockquote>
<blockquote>
<p>d Javaçš„NIOæœ‰ä»€ä¹ˆå¼Šç«¯</p>
</blockquote>
<ul>
<li>æœåŠ¡ç«¯è¿˜æ˜¯ä¼šè¿›è¡Œç©ºè½¬</li>
<li>ä¸ç®¡æœ‰æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡ç«¯éƒ½è¦ä¸æ–­æ‰§è¡Œacceptæ–¹æ³•</li>
<li>ä¸ç®¡å®¢æˆ·ç«¯è¿æ¥æœ‰æ²¡æœ‰ä¼ è¾“æ•°æ®ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€éreadæ“ä½œ</li>
</ul>
<blockquote>
<p>èµ„æºæµªè´¹é—®é¢˜</p>
</blockquote>
<p>è¿˜æ˜¯ä¼šå­˜åœ¨C10kçš„é—®é¢˜</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-NIOæ ¸å¿ƒç»„ä»¶--buffer</title>
    <url>/wiki/Java-NIO%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6-buffer/</url>
    <content><![CDATA[<h1 id="Buffer-è¯»å†™"><a href="#Buffer-è¯»å†™" class="headerlink" title="Buffer è¯»å†™"></a>Buffer è¯»å†™</h1><h2 id="NIOä¹‹Buffer"><a href="#NIOä¹‹Buffer" class="headerlink" title="NIOä¹‹Buffer"></a>NIOä¹‹Buffer</h2><p>Bufferä½œä¸ºNIOä¸‰å¤§æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œä»¥åŠä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªbyte[]æ•°æ®,åªæ˜¯åœ¨NIOä¸­è¢«å°è£…æˆäº†NIO Bufferå¯¹è±¡<br>å¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•æ¥è®¿é—®è¿™ä¸ªå†…å­˜å—ã€‚</p>
<h3 id="ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Demo"><a href="#ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Demo" class="headerlink" title="ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Demo"></a>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Demo</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯»å–ä¸€ä¸ªtext.txtæ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„text1.txtæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstNioDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/Users/gaolei/Desktop/text.txt&quot;</span>);</span><br><span class="line">        FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/Users/gaolei/Desktop/text1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        FileChannel inChannel = fileInputStream.getChannel();</span><br><span class="line">        FileChannel outChannel = fileOutputStream.getChannel();</span><br><span class="line">        <span class="comment">// å£°æ˜ç¼“å†²åŒºå¤§å°ä¸º1024å­—èŠ‚</span></span><br><span class="line">        ByteBuffer byteBuffer =  ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">// ä»é€šé“ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        inChannel.read(byteBuffer);</span><br><span class="line">        <span class="comment">// è¯»æ¨¡å¼åˆ‡æ¢ä¸ºå†™æ¨¡å¼</span></span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        <span class="comment">//æŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“</span></span><br><span class="line">        outChannel.write(byteBuffer);</span><br><span class="line">        <span class="comment">// æ•°æ®å†™å®Œä¹‹åæ¸…ç©ºå…¨éƒ¨ç¼“å†²åŒº</span></span><br><span class="line">        byteBuffer.clear();</span><br><span class="line">        <span class="comment">//å…³é—­æ–‡ä»¶æµ</span></span><br><span class="line">        fileInputStream.close();</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">&gt; æ‰§è¡Œç»“æœï¼šç”Ÿæˆ/Users/gaolei/Desktop/text1.txtæ–‡ä»¶  </span><br><span class="line"></span><br><span class="line">**Bufferè¿›è¡Œæ•°æ®è¯»å†™æ“ä½œçš„ä¸€èˆ¬æ­¥éª¤**  </span><br><span class="line"><span class="number">1</span>ã€å†™å…¥æ•°æ®åˆ°Buffer  </span><br><span class="line"><span class="number">2</span>ã€è°ƒç”¨flip()æ–¹æ³•  </span><br><span class="line"><span class="number">3</span>ã€ä»Bufferä¸­è¯»å–æ•°æ®  </span><br><span class="line"><span class="number">4</span>ã€è°ƒç”¨clear()æ–¹æ³•æˆ–è€…compact()æ–¹æ³•  </span><br><span class="line"></span><br><span class="line">&gt; clear()æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚compact()æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ·å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">### Bufferä¸‰ä¸ªæ ¸å¿ƒçš„å±æ€§  </span><br><span class="line">- capacity å®¹é‡ ä¸bufferå¤„åœ¨ä»€ä¹ˆæ¨¡å¼æ— å…³</span><br><span class="line">- position æ¸¸æ ‡ä½ç½® æŒ‡å‘ä¸‹ä¸€ä¸ªå­˜æ”¾/è¯»å–æ•°æ®çš„ä½ç½® èŒƒå›´ï¼ˆ<span class="number">0</span> ï½ capacityâ€“<span class="number">1</span>ï¼‰</span><br><span class="line">- limit </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### è¯»å†™æ“ä½œä¸­Bufferä¸‰å¤§å±æ€§çš„å˜åŒ–</span><br><span class="line">åˆå§‹çŠ¶æ€  </span><br><span class="line">&lt;img src=<span class="string">&quot;https://oscimg.oschina.net/oscnet/up-71f90dfd671f80eb9f6142f135b7c2dfc92.png&quot;</span>  height=<span class="string">&quot;230&quot;</span> width=<span class="string">&quot;395&quot;</span>&gt;    </span><br><span class="line">ç¬¬ä¸€æ¬¡è¯»å–æ•°æ®  </span><br><span class="line">positionå¤„äºèµ·å§‹ä½ç½®ï¼Œlimitå’Œcapacityéƒ½å¤„äºç»“å°¾  </span><br><span class="line">&lt;img src=<span class="string">&quot;https://oscimg.oschina.net/oscnet/up-41b47d9e54d58c7b39caf9e514fc9b5261f.png&quot;</span>  height=<span class="string">&quot;230&quot;</span> width=<span class="string">&quot;395&quot;</span>&gt;  </span><br><span class="line">ç¬¬äºŒæ¬¡è¯»å–æ•°æ®  </span><br><span class="line">&lt;img src=<span class="string">&quot;https://oscimg.oschina.net/oscnet/up-07f3d1aa1f886b592b386cd4d846810911d.png&quot;</span>  height=<span class="string">&quot;230&quot;</span> width=<span class="string">&quot;395&quot;</span>&gt;  </span><br><span class="line">å½“å†™æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨flipæ–¹æ³•ï¼š </span><br><span class="line">å½“å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œpositionä¼šè¢«é‡ç½®ä¸º<span class="number">0.</span> å½“ä»Bufferçš„positionå¤„è¯»å–æ•°æ®æ—¶ï¼Œpositionå‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯è¯»çš„ä½ç½®ã€‚  </span><br><span class="line">å½“åˆ‡æ¢Bufferåˆ°è¯»æ¨¡å¼æ—¶ï¼Œ limitè¡¨ç¤ºä½ æœ€å¤šèƒ½è¯»åˆ°å¤šå°‘æ•°æ®ã€‚å› æ­¤ï¼Œå½“åˆ‡æ¢Bufferåˆ°è¯»æ¨¡å¼æ—¶ï¼Œlimitä¼šè¢«è®¾ç½®æˆå†™æ¨¡å¼ä¸‹çš„positionå€¼ã€‚æ¢å¥è¯è¯´ï¼Œä½ èƒ½è¯»åˆ°ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimitè¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯positionï¼‰     </span><br><span class="line">&lt;img src=<span class="string">&quot;https://oscimg.oschina.net/oscnet/up-b9323701bbb34a6c12f61d5ac2652ab7eeb.png&quot;</span>  height=<span class="string">&quot;230&quot;</span> width=<span class="string">&quot;395&quot;</span>&gt;  </span><br><span class="line">Clearæ–¹æ³•  </span><br><span class="line">&lt;img src=<span class="string">&quot;https://oscimg.oschina.net/oscnet/up-71f90dfd671f80eb9f6142f135b7c2dfc92.png&quot;</span>  height=<span class="string">&quot;230&quot;</span> width=<span class="string">&quot;395&quot;</span>&gt;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### JAVA NIOä¸‹çš„Bufferåˆ†ç±»</span><br><span class="line">- ByteBuffer</span><br><span class="line">- MappedByteBuffer</span><br><span class="line">- CharBuffer</span><br><span class="line">- DoubleBuffer</span><br><span class="line">- FloatBuffer</span><br><span class="line">- IntBuffer</span><br><span class="line">- LongBuffer</span><br><span class="line">- ShortBuffer</span><br><span class="line">&gt; JavaåŸºæœ¬ç±»å‹é™¤äº†å¸ƒå°”ç±»å‹ï¼Œéƒ½æœ‰å…¶å¯¹åº”çš„Buffer </span><br><span class="line"></span><br><span class="line">### ByteBufferä½¿ç”¨</span><br><span class="line">&gt; ä¸‹é¢ä»¥ByteBufferä¸ºä¾‹å­çœ‹ä¸€ä¸‹Bufferå¦‚ä½•ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªbyteBufferï¼Œè®¾ç½®å®¹é‡ä¸º1024å­—èŠ‚</span></span><br><span class="line">ByteBuffer byteBuffer =  ByteBuffer.allocate(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure>
<p>1ã€å¦‚ä¸‹ä»£ç ï¼Œå…¶å®è°ƒç”¨äº†new HeapByteBuffer(capacity, capacity)æ¥åˆ›å»ºä¸€ä¸ªbuffer  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteBuffer <span class="title">allocate</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (capacity &lt; <span class="number">0</span>)</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> HeapByteBuffer(capacity, capacity);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>2ã€åˆ›å»ºäº†bufferä¹‹åè¦å¾€é‡Œé¢å†™æ•°æ®ï¼Œé™¤äº†ä¸Šé¢ä»channelä¸­è¯»å–æ•°æ®ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨putæ–¹æ³•,å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">byteBuffer.put(<span class="string">&quot;hello world&quot;</span>.getBytes());</span><br></pre></td></tr></table></figure>

<p>3ã€å¦‚æœå†™å°†bufferä¸­çš„æ•°æ®å†™å‡ºå»ï¼Œå¿…é¡»å…ˆè°ƒç”¨flapæ–¹æ³•</p>
<blockquote>
<p>flipæ–¹æ³•å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚è°ƒç”¨flip()æ–¹æ³•ä¼šå°†positionè®¾å›0ï¼Œå¹¶å°†limitè®¾ç½®æˆä¹‹å‰positionçš„å€¼ã€‚</p>
</blockquote>
<p>4ã€å°†æ•°æ®å†™åˆ°é€šé“ä¸­ inChannel.write(buf);</p>
<p>5ã€æ•°æ®å†™å‡ºåˆ°é€šé“ä¹‹åï¼Œè¦å°†ç¼“å­˜æ¸…ç©ºï¼Œä¸€èˆ¬è°ƒç”¨clearæ–¹æ³•<br><strong>clearæ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Buffer <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">//positionå°†è¢«è®¾å›0</span></span><br><span class="line">       position = <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//limitè¢«è®¾ç½®æˆ capacityçš„å€¼</span></span><br><span class="line">       limit = capacity;</span><br><span class="line">       mark = -<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Bufferä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œå¼€å§‹å¾€Bufferé‡Œå†™æ•°æ®ã€‚<br><strong>compactæ–¹æ³•</strong><br>å¦‚æœBufferä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨compact()æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ByteBuffer <span class="title">compact</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferèµ·å§‹å¤„ã€‚</span></span><br><span class="line">        System.arraycopy(hb, ix(position()), hb, ix(<span class="number">0</span>), remaining());</span><br><span class="line">        <span class="comment">//positionè®¾åˆ°æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ æ­£åé¢</span></span><br><span class="line">        position(remaining());</span><br><span class="line">        <span class="comment">//limitå±æ€§è®¾ç½®æˆcapacity</span></span><br><span class="line">        limit(capacity());</span><br><span class="line">        discardMark();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">ç°åœ¨Bufferå‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ® </span><br></pre></td></tr></table></figure>
<h3 id="é›¶æ‹·è´åŸç†"><a href="#é›¶æ‹·è´åŸç†" class="headerlink" title="é›¶æ‹·è´åŸç†"></a>é›¶æ‹·è´åŸç†</h3><p>â€“ é›¶æ‹·è´ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦é›¶æ‹·è´æ˜¯åœ¨kafkaçš„æ•°æ®å­˜å‚¨éƒ¨åˆ†â€“<br>IOæµç¨‹ï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-f5a9accbd021cfe41414ca72391b3889049.png"  height="230" width="395"><br>å†…å­˜æ˜ å°„ç¼“å†²åŒº<br><img src="https://oscimg.oschina.net/oscnet/up-a7a80d3426d1497bcaa69f30789718db0ee.png"  height="230" width="395"><br>æ¯”æ™®é€šIOæ“ä½œæ–‡ä»¶å¿«å¾ˆå¤šï¼Œç”šè‡³æ¯”channelè¿˜è¦å¿«å¾ˆå¤šã€‚<br>å› ä¸ºé¿å…äº†å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ï¼ˆSystem.read System.writeï¼‰ã€‚å‡å°‘äº†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      FileChannel in = FileChannel.open(Paths.get(<span class="string">&quot;/Users/gaolei/Desktop/text.txt&quot;</span>), StandardOpenOption.READ);</span><br><span class="line">      FileChannel out = FileChannel.open(Paths.get(<span class="string">&quot;/Users/gaolei/Desktop/text1.txt&quot;</span>), StandardOpenOption.READ, StandardOpenOption.CREATE, StandardOpenOption.WRITE);</span><br><span class="line">      MappedByteBuffer inBuffer = in.map(FileChannel.MapMode.READ_ONLY, <span class="number">0</span>, in.size());</span><br><span class="line">      MappedByteBuffer outBuffer = out.map(FileChannel.MapMode.READ_WRITE, <span class="number">0</span>, in.size());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[inBuffer.limit()];</span><br><span class="line">      inBuffer.get(bytes);</span><br><span class="line">      outBuffer.put(bytes);</span><br><span class="line">      in.close();</span><br><span class="line">      out.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/up-ec7269566091c2f389749849ad734972de6.png"><br>æ™®é€šçš„ç½‘ç»œIOæ‹·è´æµç¨‹<br>1ã€é¦–å…ˆç³»ç»Ÿä»ç£ç›˜ä¸Šæ‹·è´æ–‡ä»¶åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒº<br>2ã€ç„¶ååœ¨å†…æ ¸ç©ºé—´æ‹·è´æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´<br>3ã€ç¬¬ä¸‰æ¬¡ï¼Œç”¨æˆ·ç¼“å†²åŒºå†å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸éƒ¨åˆ†çš„socketç¼“å†²<br>4ã€å†…æ ¸åœ¨å°†å­˜å‚¨åœ¨socketç¼“å†²åŒºçš„æ•°æ®æ‹·è´å¹¶å‘é€åˆ°ç½‘å¡ç¼“å†²åŒº<br>ä»¥ä¸Šä¸€ä¸ªå¸¸è§„çš„ç½‘ç»œIOç»å†äº†4æ¬¡æ•°æ®æ‹·è´ï¼›  </p>
<p>è®¾ç½®ç¼“å†²åŒºçš„æ„ä¹‰åœ¨äºæå‡æ€§èƒ½ï¼Œå½“ç”¨æˆ·ç©ºé—´ä»…ä»…éœ€è¦ä¸€å°éƒ¨åˆ†æ•°æ®çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ç£ç›˜ä¸Šè¯»å–ä¸€å—æ•°æ®æ–¹æ³•å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¸ªå«åšå±€éƒ¨æ€§åŸç†ã€‚</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-6209218a39ae427544247f1b3937b4043cc.png"><br>é›¶æ‹·è´å‡å»äº†å†…æ ¸ç©ºé—´æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´æ•°æ®çš„æ‹·è´ï¼Œä»è€Œæå‡IOæ€§èƒ½ã€‚å‡è®¾è¯»å–çš„æ–‡ä»¶å¾ˆå¤§ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è¯»å–ç£ç›˜å¤§é‡æ•°æ®åˆ°å†…æ ¸ç©ºé—´ï¼Œ<br>è¿™æ—¶å€™å†…æ ¸ç¼“å†²åŒºçš„ä½œç”¨æ˜¯å¾ˆéš¾ä½“ç°çš„ã€‚å› ä¸ºå¦‚æœç”¨æˆ·ç©ºé—´éœ€è¦å°‘é‡æ•°æ®çš„æ—¶å€™æ˜¯å¯ä»¥ç›´æ¥åœ¨å†…æ ¸ç©ºé—´è·å–çš„ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰ã€‚æ­£å¼å› ä¸ºæœ‰äº†é›¶æ‹·è´ï¼Œ<br>æ“ä½œç³»ç»Ÿåœ¨ç£ç›˜è¯»å–æ•°æ®ä¹‹åï¼Œå¯ä»¥ç›´æ¥å‘é€åˆ°ç½‘å¡ç¼“å†²åŒºï¼Œä»è€Œå¤§å¤§æå‡IOæ€§èƒ½ã€‚</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-NIOæ ¸å¿ƒç»„ä»¶--channel</title>
    <url>/wiki/Java-NIO%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6-channel/</url>
    <content><![CDATA[<h1 id="NIOæ ¸å¿ƒç»„ä»¶-Channel"><a href="#NIOæ ¸å¿ƒç»„ä»¶-Channel" class="headerlink" title="NIOæ ¸å¿ƒç»„ä»¶ - Channel"></a>NIOæ ¸å¿ƒç»„ä»¶ - Channel</h1><h2 id="SocketChannel-å’Œ-ServerSocketChannel"><a href="#SocketChannel-å’Œ-ServerSocketChannel" class="headerlink" title="SocketChannel å’Œ ServerSocketChannel"></a>SocketChannel å’Œ ServerSocketChannel</h2><p>å­¦ä¹ æ­¤éƒ¨åˆ†å¯ä»¥å¯¹æ¯”Socketå’ŒServerSocket</p>
<p>æœåŠ¡ç«¯ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NioSocketServer01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ServerSocketChannel æ”¯æŒé˜»å¡/éé˜»å¡</span></span><br><span class="line">            ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">            <span class="comment">// è®¾ç½®æˆéé˜»å¡ã€‚é»˜è®¤é˜»å¡true</span></span><br><span class="line">            serverSocketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            serverSocketChannel.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8080</span>));</span><br><span class="line">            <span class="comment">// å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªsocketChannelå®ä¾‹ï¼Œå¦åˆ™socketChannel=null</span></span><br><span class="line">                SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">                <span class="comment">// ä»£ç æ‰§è¡Œåˆ°æ­¤å¤„ï¼Œè¯´æ˜æœ‰å®¢æˆ·ç«¯é“¾æ¥</span></span><br><span class="line">                <span class="keyword">if</span> (socketChannel != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶è¾“å‡º</span></span><br><span class="line">                    ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                    socketChannel.read(buffer);</span><br><span class="line">                    System.err.println(<span class="keyword">new</span> String(buffer.array()));</span><br><span class="line">                    <span class="comment">// å°†æ•°æ®åœ¨å†™ä¼šå®¢æˆ·ç«¯</span></span><br><span class="line">                    buffer.flip();</span><br><span class="line">                    socketChannel.write(buffer);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//éªŒè¯å®¢æˆ·ç«¯ socketChannelè®¾ç½®æˆfalseæ—¶ï¼Œä»æœåŠ¡ç«¯readæ•°æ®çš„æ“ä½œå˜æˆéé˜»å¡çš„</span></span><br><span class="line">                    <span class="comment">//ByteBuffer buffer = ByteBuffer.allocate(1024);</span></span><br><span class="line">                    <span class="comment">//buffer.put(&quot;this is server!&quot;);</span></span><br><span class="line">                    <span class="comment">//buffer.flip();</span></span><br><span class="line">                    <span class="comment">//socketChannel.write(buffer);</span></span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">                    System.err.println(<span class="string">&quot;no client&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NioSocketClient1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            </span><br><span class="line">            SocketChannel socketChannel = SocketChannel.open();</span><br><span class="line">            <span class="comment">// é»˜è®¤é˜»å¡IO true</span></span><br><span class="line">            socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">            socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>));</span><br><span class="line">            <span class="comment">// finishConnectçš„ä¸»è¦ä½œç”¨å°±æ˜¯ç¡®è®¤é€šé“è¿æ¥å·²å»ºç«‹ï¼Œæ–¹ä¾¿åç»­IOæ“ä½œï¼ˆè¯»å†™ï¼‰ä¸ä¼šå› è¿æ¥æ²¡å»ºç«‹è€Œå¯¼è‡´NotYetConnectedExceptionå¼‚å¸¸ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (socketChannel.isConnectionPending()) &#123;</span><br><span class="line">                <span class="comment">// finishConnectä¸€ç›´é˜»å¡åˆ°connectå»ºç«‹å®Œæˆ</span></span><br><span class="line">                socketChannel.finishConnect();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">            byteBuffer.put(<span class="string">&quot;hello world&quot;</span>.getBytes());</span><br><span class="line">            byteBuffer.flip();</span><br><span class="line">            socketChannel.write(byteBuffer);</span><br><span class="line">            </span><br><span class="line">            byteBuffer.clear();</span><br><span class="line">            <span class="keyword">int</span> r = socketChannel.read(byteBuffer); <span class="comment">// éé˜»å¡æ–¹æ³• byteBufferçš„æ•°æ®è¿˜æ˜¯ä¸Šé¢putçš„</span></span><br><span class="line">            <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;get msg:&#123;&#125;&quot;</span> + <span class="keyword">new</span> String(byteBuffer.array()));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;server no back&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-NIOæ ¸å¿ƒç»„ä»¶--selector</title>
    <url>/wiki/Java-NIO%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6-selector/</url>
    <content><![CDATA[<h1 id="å¤šè·¯å¤ç”¨å™¨"><a href="#å¤šè·¯å¤ç”¨å™¨" class="headerlink" title="å¤šè·¯å¤ç”¨å™¨"></a>å¤šè·¯å¤ç”¨å™¨</h1><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><p>1ã€selecté€‰æ‹©å™¨ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å“ªäº›è¿æ¥æœ‰æ•°æ®è¦è¯»å–ï¼Œä½†æ˜¯è¯»å–çš„æ“ä½œè¿˜æ˜¯ç”¨æˆ·è‡ªå·±è§¦å‘çš„ï¼Œè¿™ç§å«åšã€ŒåŒæ­¥ã€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ibli.javaBase.nio;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> gaolei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/4/3 4:09 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectMultiple</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServerSocketChannel server = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Selector selector = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> port = <span class="number">9090</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initServer</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        server = ServerSocketChannel.open();</span><br><span class="line">        server.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        server.bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">        server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        initServer();</span><br><span class="line">        System.err.println(<span class="string">&quot;server started ....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="comment">// selector.select() è°ƒç”¨ç³»ç»Ÿå†…æ ¸çš„select</span></span><br><span class="line">            <span class="keyword">while</span> (selector.select() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// ä»å¤šè·¯å¤ç”¨å™¨ä¸­é€‰æ‹©æœ‰æ•ˆçš„key</span></span><br><span class="line">                Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">                Iterator&lt;SelectionKey&gt; iter = selectionKeys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">                    SelectionKey key = iter.next();</span><br><span class="line">                    <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                        acceptHandle(key);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                        readHandle(key);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">acceptHandle</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocketChannel ssc = (ServerSocketChannel) key.channel();</span><br><span class="line">        SocketChannel client = ssc.accept();</span><br><span class="line">        client.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br><span class="line">        client.register(selector, SelectionKey.OP_READ, byteBuffer);</span><br><span class="line">        System.err.println(<span class="string">&quot;client arrived &quot;</span> + client.getRemoteAddress());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readHandle</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel client = (SocketChannel) key.channel();</span><br><span class="line">        ByteBuffer buffer = (ByteBuffer) key.attachment();</span><br><span class="line">        buffer.clear();</span><br><span class="line">        <span class="keyword">int</span> read = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            read = client.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (read &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// æœåŠ¡ç«¯è¯»åˆ°çš„æ•°æ®ï¼Œå†å†™ä¸€éç»™åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">                    client.write(buffer);</span><br><span class="line">                &#125;</span><br><span class="line">                buffer.clear();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (read == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// client å‘ç”Ÿé”™è¯¯ æˆ–è€…æ–­å¼€ read == -1</span></span><br><span class="line">                <span class="comment">// å¯¼è‡´ç©ºè½¬ æœ€ç»ˆCPUè¾¾åˆ°100%</span></span><br><span class="line">                client.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢çš„å†™æ³•æ˜¯ä¸€ä¸ªselectoræ—¢æ‹…ä»»bossåˆæ‹…ä»»worker </p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-joinæ–¹æ³•åŸç†è§£æ</title>
    <url>/wiki/Java-join%E6%96%B9%E6%B3%95%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h1 id="joinæ–¹æ³•"><a href="#joinæ–¹æ³•" class="headerlink" title="joinæ–¹æ³•"></a>joinæ–¹æ³•</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">joiné‡è½½æ–¹æ³•</span><br><span class="line"></span><br><span class="line"><span class="number">1</span> join()</span><br><span class="line"><span class="number">2</span> join(<span class="keyword">long</span> millis)     <span class="comment">//å‚æ•°ä¸ºæ¯«ç§’</span></span><br><span class="line"><span class="number">3</span> join(<span class="keyword">long</span> millis,<span class="keyword">int</span> nanoseconds)    <span class="comment">//ç¬¬ä¸€å‚æ•°ä¸ºæ¯«ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’</span></span><br></pre></td></tr></table></figure>
<h3 id="åŠŸèƒ½æ¼”ç¤º"><a href="#åŠŸèƒ½æ¼”ç¤º" class="headerlink" title="åŠŸèƒ½æ¼”ç¤º"></a>åŠŸèƒ½æ¼”ç¤º</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;join thread demo &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;main thread start... &quot;</span>);</span><br><span class="line">        Runnable r = <span class="keyword">new</span> JoinDemo();</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        t.setName(<span class="string">&quot;ibli joinTest ...&quot;</span>);</span><br><span class="line">        t.start();</span><br><span class="line"><span class="comment">//        t.join();</span></span><br><span class="line">        System.err.println(<span class="string">&quot;main thread end... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°†t.join();æ³¨é‡Šæ‰ï¼Œæ‰§è¡Œçš„ä¸€ç§å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main thread start... </span><br><span class="line">main thread end... </span><br><span class="line">join thread demo</span><br><span class="line"></span><br><span class="line">è¿˜æœ‰å¯èƒ½æ˜¯è¿™ç§ç»“æœï¼š</span><br><span class="line">main thread start... </span><br><span class="line">join thread demo</span><br><span class="line">main thread end... </span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æŠŠæ³¨é‡Šå»æ‰ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main thread start... </span><br><span class="line">join thread demo </span><br><span class="line">main thread end... </span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„demo,æ•ˆæœæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å½“mainçº¿ç¨‹å»è°ƒç”¨t.join()æ˜¯ï¼Œä¼šå°†è‡ªå·±å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰åˆ°tçº¿ç¨‹æ‰§è¡Œå®Œæˆåˆ°è¾¾å®Œç»“çŠ¶æ€ï¼Œmainçº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚  </p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹join()è®¾ç½®è¶…æ—¶æ—¶é—´çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinDemo</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;join thread demo &quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// çº¿ç¨‹ç¡çœ 4s</span></span><br><span class="line">            Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;String&gt; strings = <span class="keyword">null</span>;</span><br><span class="line">        System.err.println(strings.get(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;main thread start... &quot;</span>);</span><br><span class="line">        Runnable r = <span class="keyword">new</span> JoinDemo();</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">        t.setName(<span class="string">&quot;ibli joinTest ...&quot;</span>);</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">// ä½†æ˜¯ä¸»çº¿ç¨‹joinçš„è¶…æ—¶æ—¶é—´æ˜¯1s</span></span><br><span class="line">        t.join(<span class="number">1000</span>);</span><br><span class="line">        System.err.println(<span class="string">&quot;main thread end... &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ•ˆæœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">main thread start... </span><br><span class="line">join thread demo </span><br><span class="line">main thread end... </span><br><span class="line">Exception in thread <span class="string">&quot;ibli joinTest ...&quot;</span> java.lang.NullPointerException</span><br><span class="line">	at com.ibli.threadTest.api.JoinDemo.run(JoinDemo.java:<span class="number">14</span>)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:<span class="number">748</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå­çº¿ç¨‹è®¾ç½®äº†4sçš„è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹åœ¨1ç§’è¶…æ—¶åï¼Œå¹¶æ²¡æœ‰ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå°±è¢«å”¤é†’æ‰§è¡Œåç»­æ“ä½œäº†ï¼›è¿™æ ·çš„é¢„æœŸæ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸå‘¢ï¼Ÿ<br>ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§joinçš„æºç å»åˆ†æå§ï¼</p>
</blockquote>
<h3 id="joinæ–¹æ³•åŸç†"><a href="#joinæ–¹æ³•åŸç†" class="headerlink" title="joinæ–¹æ³•åŸç†"></a>joinæ–¹æ³•åŸç†</h3><p>ä¸‹é¢æ˜¯joinçš„åŸç†å›¾</p>
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5386b2aaabd43cab4b0f042e0270118~tplv-k3u1fbpfcp-zoom-1.image?imageView2/2/w/480/h/480/q/85/interlace/1" width = "400" height = "500" div align=right />




<blockquote>
<p>join()æºç </p>
</blockquote>
<p>é¦–å…ˆä¼šè°ƒç”¨join(0)æ–¹æ³•ï¼Œå…¶å®æ˜¯joinçš„é‡è½½æ–¹æ³•ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        join(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯joinçš„æ ¸å¿ƒå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">(<span class="keyword">long</span> millis)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> base = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> now = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é¦–å…ˆæ ¡éªŒå‚æ•°æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;timeout value is negative&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœjoinæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œåˆ™ç›¸å½“äºç›´æ¥è°ƒç”¨waitæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                wait(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (isAlive()) &#123;</span><br><span class="line">                <span class="keyword">long</span> delay = millis - now;</span><br><span class="line">                <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                wait(delay);</span><br><span class="line">                now = System.currentTimeMillis() - base;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯isAliveæ–¹æ³•çš„æºç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isAlive</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œä½œç”¨æ˜¯åˆ¤æ–­å½“å‰çš„çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ä»€ä¹ˆæ˜¯æ´»åŠ¨çŠ¶æ€å‘¢ï¼Ÿæ´»åŠ¨çŠ¶æ€å°±æ˜¯çº¿ç¨‹å·²ç»å¯åŠ¨ä¸”å°šæœªç»ˆæ­¢ã€‚çº¿ç¨‹å¤„äºæ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡å¼€å§‹è¿è¡Œçš„çŠ¶æ€ï¼Œå°±è®¤ä¸ºçº¿ç¨‹æ˜¯â€œå­˜æ´»â€çš„ã€‚</p>
<ul>
<li><p>è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹è¦æ³¨æ„ï¼Œjoinä¸ºä»€ä¹ˆé˜»å¡çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œè€Œä¸æ˜¯å­çº¿ç¨‹å‘¢ï¼Ÿ  </p>
</li>
<li><p>ä¸ç†è§£çš„åŸå› æ˜¯é˜»å¡ä¸»çº¿ç¨‹çš„æ–¹æ³•æ˜¯æ”¾åœ¨previousThreadè¿™ä¸ªå®ä¾‹ä½œç”¨ï¼Œè®©å¤§å®¶è¯¯ä»¥ä¸ºåº”è¯¥é˜»å¡previousThreadçº¿ç¨‹ã€‚å®é™…ä¸Šä¸»çº¿ç¨‹ä¼šæŒæœ‰previousThreadè¿™ä¸ªå¯¹è±¡çš„é”ï¼Œç„¶åè°ƒç”¨waitæ–¹æ³•å»é˜»å¡ï¼Œè€Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­çš„ã€‚æ‰€ä»¥é€ æˆä¸»çº¿ç¨‹é˜»å¡ã€‚</p>
</li>
<li><p>å…¶å®join()æ–¹æ³•çš„æ ¸å¿ƒåœ¨äºwait(),åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨t.join()ç›¸å½“äºåœ¨mainæ–¹æ³•ä¸­æ·»åŠ  new JoinDemo().wait();æ˜¯ä¸€æ ·çš„æ•ˆæœï¼›åœ¨è¿™é‡Œåªä¸è¿‡æ˜¯waitæ–¹æ³•å†™åœ¨äº†å­çº¿ç¨‹çš„æ–¹æ³•ä¸­ã€‚  </p>
</li>
<li><p>å†æ¬¡é‡ç”³ä¸€éï¼Œjoinæ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨ä¸»çº¿ç¨‹é˜»å¡ï¼Œç­‰åœ¨å­çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œç”±å­çº¿ç¨‹å”¤é†’ä¸»çº¿ç¨‹ï¼Œå†ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹è°ƒç”¨t.join()æ–¹æ³•ä¹‹åçš„é€»è¾‘ã€‚</p>
</li>
</ul>
<blockquote>
<p>é‚£ä¹ˆä¸»çº¿ç¨‹æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹çŸ¥é“è¦ç»§ç»­æ‰§è¡Œå‘¢ï¼Ÿå°±æ˜¯ä¸Šé¢è¯´çš„ï¼Œä¸»çº¿ç¨‹å…¶å®æ˜¯ç”±joinçš„å­çº¿ç¨‹åœ¨æ‰§è¡Œå®Œæˆä¹‹åè°ƒç”¨çš„notifyAll()æ–¹æ³•ï¼Œæ¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚æ€ä¹ˆè¯æ˜å‘¢ï¼Ÿ</p>
</blockquote>
<p>å…¶å®å¤§å®¶å¯ä»¥å»ç¿»çœ‹JVMçš„æºç å®ç°ï¼ŒThread.cppæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> JavaThread::exit(bool destroy_vm, ExitType exit_type) &#123;</span><br><span class="line">  <span class="comment">// Notify waiters on thread object. This has to be done after exit() is called</span></span><br><span class="line">  <span class="comment">// on the thread (if the thread is the last thread in a daemon ThreadGroup the</span></span><br><span class="line">  <span class="comment">// group should have the destroyed bit set before waiters are notified).</span></span><br><span class="line">  ensure_join(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­è°ƒç”¨ensure_joinæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ensure_join</span><span class="params">(JavaThread* thread)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// We do not need to grap the Threads_lock, since we are operating on ourself.</span></span><br><span class="line">  <span class="function">Handle <span class="title">threadObj</span><span class="params">(thread, thread-&gt;threadObj()</span>)</span>;</span><br><span class="line">  <span class="keyword">assert</span>(threadObj.not_null(), <span class="string">&quot;java thread object must exist&quot;</span>);</span><br><span class="line">  <span class="function">ObjectLocker <span class="title">lock</span><span class="params">(threadObj, thread)</span></span>;</span><br><span class="line">  <span class="comment">// Ignore pending exception (ThreadDeath), since we are exiting anyway</span></span><br><span class="line">  thread-&gt;clear_pending_exception();</span><br><span class="line">  <span class="comment">// Thread is exiting. So set thread_status field in  java.lang.Thread class to TERMINATED.</span></span><br><span class="line">  java_lang_Thread::set_thread_status(threadObj(), java_lang_Thread::TERMINATED);</span><br><span class="line">  <span class="comment">// Clear the native thread instance - this makes isAlive return false and allows the join()</span></span><br><span class="line">  <span class="comment">// to complete once we&#x27;ve done the notify_all below</span></span><br><span class="line">  <span class="comment">//è¿™é‡Œæ˜¯æ¸…é™¤nativeçº¿ç¨‹ï¼Œè¿™ä¸ªæ“ä½œä¼šå¯¼è‡´isAlive()æ–¹æ³•è¿”å›false</span></span><br><span class="line">  java_lang_Thread::set_thread(threadObj(), NULL);</span><br><span class="line">  <span class="comment">// åœ¨è¿™é‡Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">  lock.notify_all(thread);</span><br><span class="line">  <span class="comment">// Ignore pending exception (ThreadDeath), since we are exiting anyway</span></span><br><span class="line">  thread-&gt;clear_pending_exception();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨JVMçš„ä»£ç ä¸­ï¼Œçº¿ç¨‹æ‰§è¡Œç»“æŸçš„æœ€ç»ˆè°ƒç”¨äº†lock.notify_all(thread)æ–¹æ³•æ¥å”¤é†’æ‰€æœ‰å¤„äºç­‰åˆ°çš„çº¿ç¨‹</p>
<h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ul>
<li>æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨Callableæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œéœ€è¦åœ¨ä¸»çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„è¿”å›å€¼æ—¶ï¼Œå¯ä»¥è°ƒç”¨joinæ–¹æ³•ï¼›</li>
<li>è¿˜æœ‰ä¸€äº›åœºæ™¯å¸Œæœ›çº¿ç¨‹ä¹‹é—´é¡ºåºæ‰§è¡Œçš„ï¼›</li>
</ul>
<h2 id="join-æ–¹æ³•ä¸sleep-çš„æ¯”è¾ƒ"><a href="#join-æ–¹æ³•ä¸sleep-çš„æ¯”è¾ƒ" class="headerlink" title="join()æ–¹æ³•ä¸sleep()çš„æ¯”è¾ƒ"></a>join()æ–¹æ³•ä¸sleep()çš„æ¯”è¾ƒ</h2><p>æˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹sleepæ–¹æ³•ï¼š</p>
<ul>
<li>è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ã€‚</li>
<li>ä¼‘çœ æ—¶é—´çš„å‡†ç¡®æ€§ä¾èµ–äºç³»ç»Ÿæ—¶é’Ÿå’ŒCPUè°ƒåº¦æœºåˆ¶ã€‚</li>
<li>ä¸é‡Šæ”¾å·²è·å–çš„é”èµ„æºï¼Œå¦‚æœsleepæ–¹æ³•åœ¨åŒæ­¥ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹æ˜¯æ— æ³•è¿›- å…¥åˆ°å½“å‰åŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­çš„ã€‚</li>
<li>å¯é€šè¿‡è°ƒç”¨interrupt()æ–¹æ³•æ¥å”¤é†’ä¼‘çœ çº¿ç¨‹ã€‚</li>
<li>sleepæ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨</li>
</ul>
<p>ç›¸æ¯”ä¸sleepæ–¹æ³•<br>sleepæ˜¯é™æ€æ–¹æ³•ï¼Œè€Œä¸”sleepçš„çº¿ç¨‹ä¸æ˜¯æ”¾é”èµ„æºï¼Œè€Œjoinæ–¹æ³•æ˜¯å¯¹è±¡æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ä¼šé‡Šæ”¾æ‰å¯¹è±¡é”ï¼›</p>
<blockquote>
<p>å…³äºjoinæ–¹æ³•ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œé‚£åˆ°åº•æ˜¯é‡Šæ”¾çš„é‚£ä¸ªå¯¹è±¡çš„é”å‘¢ï¼Œå¯ä»¥å‚ç…§ <a href="https://www.cnblogs.com/lwmp/p/11805440.html">å…³äºjoin() æ˜¯å¦ä¼šé‡Šæ”¾é”çš„ä¸€äº›æ€è€ƒ</a> </p>
</blockquote>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p><a href="https://www.iteye.com/blog/uule-1101994">1ã€Javaå¤šçº¿ç¨‹ä¸­joinæ–¹æ³•çš„ç†è§£</a><br><a href="https://blog.csdn.net/weichi7549/article/details/108449618">2ã€Thread.joinçš„ä½œç”¨å’ŒåŸç†</a><br><a href="https://www.jianshu.com/p/fc51be7e5bc0">3ã€Thread.joinçš„ä½œç”¨å’ŒåŸç†</a></p>
</blockquote>
<blockquote>
<p>d <p align="middle">å±±è„šå¤ªæ‹¥æŒ¤ æˆ‘ä»¬æ›´é«˜å¤„è§ã€‚</p></p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-synchronziedåº•å±‚åŸç†</title>
    <url>/wiki/Java-synchronzied%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="synchronziedåº•å±‚åŸç†"><a href="#synchronziedåº•å±‚åŸç†" class="headerlink" title="synchronziedåº•å±‚åŸç†"></a>synchronziedåº•å±‚åŸç†</h1><h2 id="synchronziedå››ä¸ªå±‚çº§å®ç°"><a href="#synchronziedå››ä¸ªå±‚çº§å®ç°" class="headerlink" title="synchronziedå››ä¸ªå±‚çº§å®ç°"></a>synchronziedå››ä¸ªå±‚çº§å®ç°</h2><ul>
<li>Javaä»£ç  é€šè¿‡æ·»åŠ synchronziedç»™å¯¹è±¡æˆ–è€…æ–¹æ³•æˆ–è€…ä»£ç å—</li>
<li>å­—èŠ‚ç å±‚çº§é€šè¿‡ä¸€ç»„ MONITORENTER/MONITOREXITæŒ‡ä»¤</li>
<li>JVMå±‚çº§ï¼šé”å‡çº§è¿‡ç¨‹</li>
<li>æ±‡ç¼–æ‰§è¡Œé€šè¿‡ lock comxchgæŒ‡ä»¤ä¿è¯åŸå­æ“ä½œ</li>
</ul>
<p>JDKæ—©æœŸï¼Œsynchronized å«åšé‡é‡çº§é”ï¼Œ å› ä¸ºç”³è¯·é”èµ„æºå¿…é¡»é€šè¿‡kernel, ç³»ç»Ÿè°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">;hello.asm</span><br><span class="line">;write(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buffer, size_t nbytes)</span><br><span class="line"></span><br><span class="line">section data</span><br><span class="line">    msg db <span class="string">&quot;Hello&quot;</span>, <span class="number">0xA</span></span><br><span class="line">    len equ $ - msg</span><br><span class="line"></span><br><span class="line">section .text</span><br><span class="line">global _start</span><br><span class="line">_start:</span><br><span class="line"></span><br><span class="line">    mov edx, len</span><br><span class="line">    mov ecx, msg</span><br><span class="line">    mov ebx, <span class="number">1</span> ;æ–‡ä»¶æè¿°ç¬¦<span class="number">1</span> std_out</span><br><span class="line">    mov eax, <span class="number">4</span> ;writeå‡½æ•°ç³»ç»Ÿè°ƒç”¨å· <span class="number">4</span></span><br><span class="line">    <span class="keyword">int</span> <span class="number">0x80</span></span><br><span class="line"></span><br><span class="line">    mov ebx, <span class="number">0</span></span><br><span class="line">    mov eax, <span class="number">1</span> ;exitå‡½æ•°ç³»ç»Ÿè°ƒç”¨å·</span><br><span class="line">    <span class="keyword">int</span> <span class="number">0x80</span></span><br></pre></td></tr></table></figure>

<p>ä¼˜åŒ–åçš„synchronizedå¦‚ä¸‹ğŸ‘‡ï¼š</p>
<h2 id="Javaå±‚çº§"><a href="#Javaå±‚çº§" class="headerlink" title="Javaå±‚çº§"></a>Javaå±‚çº§</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Object object = <span class="keyword">new</span> Object();</span><br><span class="line">      System.out.println(ClassLayout.parseInstance(object).toPrintable());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">synchronized</span> (object)&#123;</span><br><span class="line">          System.out.println(ClassLayout.parseInstance(object).toPrintable());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="å­—èŠ‚ç å±‚çº§"><a href="#å­—èŠ‚ç å±‚çº§" class="headerlink" title="å­—èŠ‚ç å±‚çº§"></a>å­—èŠ‚ç å±‚çº§</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// access flags 0x9</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="title">main</span><span class="params">([Ljava/lang/String;)</span>V</span></span><br><span class="line"><span class="function">    <span class="comment">// parameter  args</span></span></span><br><span class="line"><span class="function">    TRYCATCHBLOCK L0 L1 L2 <span class="keyword">null</span></span></span><br><span class="line"><span class="function">    TRYCATCHBLOCK L2 L3 L2 <span class="keyword">null</span></span></span><br><span class="line"><span class="function">   L4</span></span><br><span class="line"><span class="function">    LINENUMBER 13 L4</span></span><br><span class="line"><span class="function">    NEW java/lang/Object</span></span><br><span class="line"><span class="function">    DUP</span></span><br><span class="line"><span class="function">    INVOKESPECIAL java/lang/Object.&lt;init&gt; <span class="params">()</span>V</span></span><br><span class="line"><span class="function">    ASTORE 1</span></span><br><span class="line"><span class="function">   L5</span></span><br><span class="line"><span class="function">    LINENUMBER 14 L5</span></span><br><span class="line"><span class="function">    GETSTATIC java/lang/System.out : Ljava/io/PrintStream</span>;</span><br><span class="line">    ALOAD <span class="number">1</span></span><br><span class="line">    INVOKESTATIC org/openjdk/jol/info/ClassLayout.parseInstance (Ljava/lang/Object;)Lorg/openjdk/jol/info/ClassLayout;</span><br><span class="line">    INVOKEVIRTUAL org/openjdk/jol/info/ClassLayout.toPrintable ()Ljava/lang/String;</span><br><span class="line">    INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V</span><br><span class="line">   L6</span><br><span class="line">    LINENUMBER <span class="number">16</span> L6</span><br><span class="line">    ALOAD <span class="number">1</span></span><br><span class="line">    DUP</span><br><span class="line">    ASTORE <span class="number">2</span></span><br><span class="line">    MONITORENTER</span><br><span class="line">   L0</span><br><span class="line">    LINENUMBER <span class="number">17</span> L0</span><br><span class="line">    GETSTATIC java/lang/System.out : Ljava/io/PrintStream;</span><br><span class="line">    ALOAD <span class="number">1</span></span><br><span class="line">    INVOKESTATIC org/openjdk/jol/info/ClassLayout.parseInstance (Ljava/lang/Object;)Lorg/openjdk/jol/info/ClassLayout;</span><br><span class="line">    INVOKEVIRTUAL org/openjdk/jol/info/ClassLayout.toPrintable ()Ljava/lang/String;</span><br><span class="line">    INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V</span><br><span class="line">   L7</span><br><span class="line">    LINENUMBER <span class="number">18</span> L7</span><br><span class="line">    ALOAD <span class="number">2</span></span><br><span class="line">    MONITOREXIT</span><br><span class="line">   L1</span><br><span class="line">    GOTO L8</span><br><span class="line">   L2</span><br><span class="line">   FRAME FULL [[Ljava/lang/String; java/lang/Object java/lang/Object] [java/lang/Throwable]</span><br><span class="line">    ASTORE <span class="number">3</span></span><br><span class="line">    ALOAD <span class="number">2</span></span><br><span class="line">    MONITOREXIT</span><br><span class="line">   L3</span><br><span class="line">    ALOAD <span class="number">3</span></span><br><span class="line">    ATHROW</span><br><span class="line">   L8</span><br><span class="line">    LINENUMBER <span class="number">19</span> L8</span><br><span class="line">   FRAME CHOP <span class="number">1</span></span><br><span class="line">    RETURN</span><br><span class="line">   L9</span><br><span class="line">    LOCALVARIABLE args [Ljava/lang/String; L4 L9 <span class="number">0</span></span><br><span class="line">    LOCALVARIABLE object Ljava/lang/Object; L5 L9 <span class="number">1</span></span><br><span class="line">    MAXSTACK = <span class="number">2</span></span><br><span class="line">    MAXLOCALS = <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸»è¦é€šè¿‡MONITORENTER å’Œ MONITOREXIT ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤æ§åˆ¶åŠ é”è¿‡ç¨‹</p>
</blockquote>
<h2 id="JVMå±‚çº§"><a href="#JVMå±‚çº§" class="headerlink" title="JVMå±‚çº§"></a>JVMå±‚çº§</h2><p>é€šè¿‡é”å‡çº§è¿‡ç¨‹å®ç°åŠ é”ï¼›<br>æ— é” -&gt; åå‘é” -&gt; è‡ªæ—‹é”ï¼ˆè½»é‡çº§é” è‡ªé€‚åº”é”ï¼‰-&gt; é‡é‡çº§é”<br>é”å‡çº§è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹ <a href="doc:rjG4EIhi">é”å‡çº§è¿‡ç¨‹</a>  å¤åˆ¶ç†è§£</p>
<h2 id="æ±‡ç¼–æŒ‡ä»¤çº§åˆ«"><a href="#æ±‡ç¼–æŒ‡ä»¤çº§åˆ«" class="headerlink" title="æ±‡ç¼–æŒ‡ä»¤çº§åˆ«"></a>æ±‡ç¼–æŒ‡ä»¤çº§åˆ«</h2><p>linuxæ“ä½œç³»ç»Ÿå®‰è£…hsdisæ’ä»¶ï¼ŒæŸ¥çœ‹javaä»£ç çš„æ±‡ç¼–æŒ‡ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class T &#123;</span><br><span class="line">    static volatile int i = 0;</span><br><span class="line">    </span><br><span class="line">    public static void n() &#123; i++; &#125;</span><br><span class="line">    </span><br><span class="line">    public static synchronized void m() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    publics static void main(String[] args) &#123;</span><br><span class="line">        for(int j=0; j&lt;1000_000; j++) &#123;</span><br><span class="line">            m();</span><br><span class="line">            n();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly T</span><br></pre></td></tr></table></figure>
<ul>
<li>C1 Compile Level 1 (ä¸€çº§ä¼˜åŒ–)</li>
<li>C2 Compile Level 2 (äºŒçº§ä¼˜åŒ–)</li>
</ul>
<blockquote>
<p>æ‰¾åˆ°m() n()æ–¹æ³•çš„æ±‡ç¼–ç ï¼Œä¼šçœ‹åˆ° lock comxchg â€¦..æŒ‡ä»¤</p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-ä¸ºä»€ä¹ˆç¦æ­¢æŠŠSimpleDateFormatå®šä¹‰æˆstaticå˜é‡?</title>
    <url>/wiki/Java-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%A6%81%E6%AD%A2%E6%8A%8ASimpleDateFormat%E5%AE%9A%E4%B9%89%E6%88%90static%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<blockquote>
<p>æœ¬æ–‡å‚ç…§ ã€ŠJavaæŠ€æœ¯çµé­‚15é—®ã€‹</p>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°æ—¶é—´ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šåŠæ³•åœ¨ Java ä»£ç ä¸­è·å–æ—¶ é—´ã€‚ä½†æ˜¯ä¸åŒçš„æ–¹æ³•è·å–åˆ°çš„æ—¶é—´çš„æ ¼å¼éƒ½ä¸å°½ç›¸åŒï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ç§æ ¼å¼åŒ–å·¥ å…·ï¼ŒæŠŠæ—¶é—´æ˜¾ç¤ºæˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚</p>
<p>æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ SimpleDateFormat ç±»ã€‚è¿™æ˜¯ä¸€ä¸ªçœ‹ä¸Šå»åŠŸèƒ½æ¯”è¾ƒç®€å• çš„ç±»ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦ä½¿ç”¨ä¸å½“ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´å¾ˆå¤§çš„é—®é¢˜ã€‚<br>åœ¨ Java å¼€å‘æ‰‹å†Œä¸­ï¼Œæœ‰å¦‚ä¸‹æ˜ç¡®è§„å®š:</p>
<img src="https://oscimg.oschina.net/oscnet/up-8b016ecefbdfc6ea675aaf7f2a0511bbc6a.png">

<p>é‚£ä¹ˆï¼Œæœ¬æ–‡å°±å›´ç»• SimpleDateFormat çš„ç”¨æ³•ã€åŸç†ç­‰æ¥æ·±å…¥åˆ†æä¸‹å¦‚ä½•ä»¥æ­£ ç¡®çš„å§¿åŠ¿ä½¿ç”¨å®ƒã€‚</p>
<p>SimpleDateFormat æ˜¯ Java æä¾›çš„ä¸€ä¸ªæ ¼å¼åŒ–å’Œè§£ææ—¥æœŸçš„å·¥å…·ç±»ã€‚å®ƒå…è®¸è¿› è¡Œæ ¼å¼åŒ–(æ—¥æœŸ -&gt; æ–‡æœ¬)ã€è§£æ(æ–‡æœ¬ -&gt; æ—¥æœŸ)å’Œè§„èŒƒåŒ–ã€‚SimpleDateFormat ä½¿ å¾—å¯ä»¥é€‰æ‹©ä»»ä½•ç”¨æˆ·å®šä¹‰çš„æ—¥æœŸ - æ—¶é—´æ ¼å¼çš„æ¨¡å¼ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ SimpleDateFormat çš„ format æ–¹æ³•ï¼Œå°†ä¸€ä¸ª Date ç±»å‹ è½¬åŒ–æˆ String ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šè¾“å‡ºæ ¼å¼ã€‚</p>
<h2 id="SimpleDateFormat-ç”¨æ³•"><a href="#SimpleDateFormat-ç”¨æ³•" class="headerlink" title="SimpleDateFormat ç”¨æ³•"></a>SimpleDateFormat ç”¨æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// Dateè½¬String</span></span><br><span class="line">Date data = <span class="keyword">new</span> Date();</span><br><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">String dataStr = sdf.format(data);</span><br><span class="line">System.out.println(dataStr);</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ï¼Œè½¬æ¢çš„ç»“æœæ˜¯:2018-11-25 13:00:00ï¼Œæ—¥æœŸå’Œæ—¶é—´æ ¼å¼ç”±â€æ—¥æœŸ å’Œæ—¶é—´æ¨¡å¼â€å­—ç¬¦ä¸²æŒ‡å®šã€‚å¦‚æœä½ æƒ³è¦è½¬æ¢æˆå…¶ä»–æ ¼å¼ï¼Œåªè¦æŒ‡å®šä¸åŒçš„æ—¶é—´æ¨¡å¼å°± è¡Œäº†ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ SimpleDateFormat çš„ parse æ–¹æ³•ï¼Œå°†ä¸€ä¸ª String ç±»å‹ è½¬åŒ–æˆ Date ç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Stringè½¬Data </span></span><br><span class="line">System.out.println(sdf.parse(dataStr));</span><br></pre></td></tr></table></figure>


<h2 id="æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼è¡¨è¾¾æ–¹æ³•"><a href="#æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼è¡¨è¾¾æ–¹æ³•" class="headerlink" title="æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼è¡¨è¾¾æ–¹æ³•"></a>æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼è¡¨è¾¾æ–¹æ³•</h2><p>åœ¨ä½¿ç”¨ SimpleDateFormat çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡å­—æ¯æ¥æè¿°æ—¶é—´å…ƒç´ ï¼Œå¹¶ç»„è£…æˆ æƒ³è¦çš„æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼ã€‚å¸¸ç”¨çš„æ—¶é—´å…ƒç´ å’Œå­—æ¯çš„å¯¹åº”è¡¨å¦‚ä¸‹:</p>
<img src='https://oscimg.oschina.net/oscnet/up-80bd4dd81e9c6fb2f0fe9c3b5eae1cef2b8.png'>

<p>æ¨¡å¼å­—æ¯é€šå¸¸æ˜¯é‡å¤çš„ï¼Œå…¶æ•°é‡ç¡®å®šå…¶ç²¾ç¡®è¡¨ç¤ºã€‚å¦‚ä¸‹è¡¨æ˜¯å¸¸ç”¨çš„è¾“å‡ºæ ¼å¼çš„è¡¨ ç¤ºæ–¹æ³•ã€‚</p>
<img src="https://oscimg.oschina.net/oscnet/up-0c95fadb15ae4ca6aedb2e8cb68ce7ec50b.png">


<h2 id="è¾“å‡ºä¸åŒæ—¶åŒºçš„æ—¶é—´"><a href="#è¾“å‡ºä¸åŒæ—¶åŒºçš„æ—¶é—´" class="headerlink" title="è¾“å‡ºä¸åŒæ—¶åŒºçš„æ—¶é—´"></a>è¾“å‡ºä¸åŒæ—¶åŒºçš„æ—¶é—´</h2><p>æ—¶åŒºæ˜¯åœ°çƒä¸Šçš„åŒºåŸŸä½¿ç”¨åŒä¸€ä¸ªæ—¶é—´å®šä¹‰ã€‚ä»¥å‰ï¼Œäººä»¬é€šè¿‡è§‚å¯Ÿå¤ªé˜³çš„ä½ç½®(æ—¶ è§’)å†³å®šæ—¶é—´ï¼Œè¿™å°±ä½¿å¾—ä¸åŒç»åº¦çš„åœ°æ–¹çš„æ—¶é—´æœ‰æ‰€ä¸åŒ(åœ°æ–¹æ—¶)ã€‚1863 å¹´ï¼Œé¦–æ¬¡ ä½¿ç”¨æ—¶åŒºçš„æ¦‚å¿µã€‚æ—¶åŒºé€šè¿‡è®¾ç«‹ä¸€ä¸ªåŒºåŸŸçš„æ ‡å‡†æ—¶é—´éƒ¨åˆ†åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä¸–ç•Œå„ä¸ªå›½å®¶ä½äºåœ°çƒä¸åŒä½ç½®ä¸Šï¼Œå› æ­¤ä¸åŒå›½å®¶ï¼Œç‰¹åˆ«æ˜¯ä¸œè¥¿è·¨åº¦å¤§çš„å›½å®¶æ—¥ å‡ºã€æ—¥è½æ—¶é—´å¿…å®šæœ‰æ‰€åå·®ã€‚è¿™äº›åå·®å°±æ˜¯æ‰€è°“çš„æ—¶å·®ã€‚</p>
<p>ç°ä»Šå…¨çƒå…±åˆ†ä¸º 24 ä¸ªæ—¶åŒºã€‚ç”±äºå®ç”¨ä¸Šå¸¸å¸¸ 1 ä¸ªå›½å®¶ï¼Œæˆ– 1 ä¸ªçœä»½åŒæ—¶è·¨ç€ 2 ä¸ªæˆ–æ›´å¤šæ—¶åŒºï¼Œä¸ºäº†ç…§é¡¾åˆ°è¡Œæ”¿ä¸Šçš„æ–¹ä¾¿ï¼Œå¸¸å°† 1 ä¸ªå›½å®¶æˆ– 1 ä¸ªçœä»½åˆ’åœ¨ä¸€èµ·ã€‚æ‰€ä»¥ æ—¶åŒºå¹¶ä¸ä¸¥æ ¼æŒ‰å—åŒ—ç›´çº¿æ¥åˆ’åˆ†ï¼Œè€Œæ˜¯æŒ‰è‡ªç„¶æ¡ä»¶æ¥åˆ’åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸­å›½å¹…å‘˜å®½å¹¿ï¼Œå·® ä¸å¤šè·¨ 5 ä¸ªæ—¶åŒºï¼Œä½†ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ç®€å•ï¼Œå®é™…ä¸Šåœ¨åªç”¨ä¸œå…«æ—¶åŒºçš„æ ‡å‡†æ—¶å³åŒ—äº¬æ—¶é—´ ä¸ºå‡†ã€‚</p>
<p>ç”±äºä¸åŒçš„æ—¶åŒºçš„æ—¶é—´æ˜¯ä¸ä¸€æ ·çš„ï¼Œç”šè‡³åŒä¸€ä¸ªå›½å®¶çš„ä¸åŒåŸå¸‚æ—¶é—´éƒ½å¯èƒ½ä¸ä¸€ æ ·ï¼Œæ‰€ä»¥ï¼Œåœ¨ Java ä¸­æƒ³è¦è·å–æ—¶é—´çš„æ—¶å€™ï¼Œè¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹æ—¶åŒºé—®é¢˜ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æŒ‡æ˜ï¼Œåœ¨åˆ›å»ºæ—¥æœŸçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å½“å‰è®¡ç®—æœºæ‰€åœ¨çš„æ—¶åŒºä½œä¸ºé»˜è®¤æ—¶åŒºï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šè¿‡åªè¦ä½¿ç”¨new Date()å°±å¯ä»¥è·å–ä¸­å›½çš„å½“å‰ æ—¶é—´çš„åŸå› ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ Java ä»£ç ä¸­è·å–ä¸åŒæ—¶åŒºçš„æ—¶é—´å‘¢? SimpleDateFormat å¯ä»¥ å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>); </span><br><span class="line">sdf.setTimeZone(TimeZone.getTimeZone(<span class="string">&quot;America/Los_Angeles&quot;</span>)); </span><br><span class="line">System.out.println(sdf.format(Calendar.getInstance().getTime()));</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç ï¼Œè½¬æ¢çš„ç»“æœæ˜¯:2018-11-24 21:00:00 ã€‚æ—¢ä¸­å›½çš„æ—¶é—´æ˜¯ 11 æœˆ 25 æ—¥çš„ 13 ç‚¹ï¼Œè€Œç¾å›½æ´›æ‰çŸ¶æ—¶é—´æ¯”ä¸­å›½åŒ—äº¬æ—¶é—´æ…¢äº† 16 ä¸ªå°æ—¶(è¿™è¿˜å’Œå†¬å¤ä»¤æ—¶æœ‰å…³ ç³»ï¼Œå°±ä¸è¯¦ç»†å±•å¼€äº†)ã€‚</p>
<p>å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ è¿˜å¯ä»¥å°è¯•æ‰“å°ä¸€ä¸‹ç¾å›½çº½çº¦æ—¶é—´(America/New_York)ã€‚ çº½çº¦æ—¶é—´æ˜¯ 2018-11-25 00:00:00ã€‚çº½çº¦æ—¶é—´æ¯”ä¸­å›½åŒ—äº¬æ—¶é—´æ—©äº† 13 ä¸ªå°æ—¶ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸æ˜¯æ˜¾ç¤ºå…¶ä»–æ—¶åŒºçš„å”¯ä¸€æ–¹æ³•ï¼Œä¸è¿‡æœ¬æ–‡ä¸»è¦ä¸ºäº†ä»‹ç» SimpleDate-Formatï¼Œå…¶ä»–æ–¹æ³•æš‚ä¸ä»‹ç»äº†ã€‚</p>
<h2 id="SimpleDateFormat-çº¿ç¨‹å®‰å…¨æ€§"><a href="#SimpleDateFormat-çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="SimpleDateFormat çº¿ç¨‹å®‰å…¨æ€§"></a>SimpleDateFormat çº¿ç¨‹å®‰å…¨æ€§</h2><p>ç”±äº SimpleDateFormat æ¯”è¾ƒå¸¸ç”¨ï¼Œè€Œä¸”åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ä¸­çš„æ—¶é—´æ˜¾ ç¤ºæ¨¡å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¾ˆå¤šäººæ„¿æ„ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰ SimpleDateFormat:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            simpleDateFormat.setTimeZone(TimeZone.getTimeZone(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">            System.out.println(simpleDateFormat.format(Calendar.getInstance().</span><br><span class="line">                    getTime()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸ è¿™ç§å®šä¹‰æ–¹å¼ï¼Œå­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼Œä»¥ä¸‹ä»£ç ä½¿ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œæ—¶é—´è¾“å‡ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å®šä¹‰ä¸€ä¸ªå…¨å±€çš„SimpleDateFormat</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä½¿ç”¨ThreadFactoryBuilderå®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ThreadFactory namedThreadFactory = <span class="keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="string">&quot;demo-pool-%d&quot;</span>).build();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">200</span>, <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">1024</span>), namedThreadFactory, <span class="keyword">new</span></span><br><span class="line">                ThreadPoolExecutor.AbortPolicy());</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å®šä¹‰ä¸€ä¸ªCountDownLatchï¼Œä¿è¯æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åä¸»çº¿ç¨‹å†æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ HashSet</span></span><br><span class="line">            Set&lt;String&gt; dates = Collections.synchronizedSet(<span class="keyword">new</span> HashSet&lt;String&gt;());</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">                Calendar calendar = Calendar.getInstance();</span><br><span class="line">                <span class="keyword">int</span> finalI = i;</span><br><span class="line">                pool.execute(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ—¶é—´å¢åŠ </span></span><br><span class="line">                    calendar.add(Calendar.DATE, finalI);</span><br><span class="line">        <span class="comment">// é€šè¿‡ simpleDateFormat æŠŠæ—¶é—´è½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                    String dateString = simpleDateFormat.format(calendar.</span><br><span class="line">                            getTime());</span><br><span class="line">                    <span class="comment">// æŠŠå­—ç¬¦ä¸²æ”¾å…¥ Set ä¸­</span></span><br><span class="line">                    dates.add(dateString); </span><br><span class="line">                    <span class="comment">//countDown countDownLatch.countDown();</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// é˜»å¡ï¼Œç›´åˆ° countDown æ•°é‡ä¸º 0 countDownLatch.await();</span></span><br><span class="line">        <span class="comment">// è¾“å‡ºå»é‡åçš„æ—¶é—´ä¸ªæ•° System.out.println(dates.size());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>ä»¥ä¸Šä»£ç ï¼Œå…¶å®æ¯”è¾ƒç®€å•ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚å°±æ˜¯å¾ªç¯ä¸€ç™¾æ¬¡ï¼Œæ¯æ¬¡å¾ªç¯çš„æ—¶å€™éƒ½åœ¨ å½“å‰æ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªå¤©æ•°(è¿™ä¸ªå¤©æ•°éšç€å¾ªç¯æ¬¡æ•°è€Œå˜åŒ–)ï¼Œç„¶åæŠŠæ‰€æœ‰æ—¥æœŸæ”¾å…¥ ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€å¸¦æœ‰å»é‡åŠŸèƒ½çš„ Set ä¸­ï¼Œç„¶åè¾“å‡º Set ä¸­å…ƒç´ ä¸ªæ•°ã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœåº”è¯¥æ˜¯ 100ã€‚ä½†æ˜¯å®é™…æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ªå°äº 100 çš„æ•°å­—ã€‚</p>
<p>åŸå› å°±æ˜¯å› ä¸º SimpleDateFormat ä½œä¸ºä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œè¢«å½“åšäº†å…±äº«å˜ é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¿›è¡Œä½¿ç”¨ï¼Œè¿™å°±å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<h2 id="çº¿ç¨‹ä¸å®‰å…¨åŸå› "><a href="#çº¿ç¨‹ä¸å®‰å…¨åŸå› " class="headerlink" title="çº¿ç¨‹ä¸å®‰å…¨åŸå› "></a>çº¿ç¨‹ä¸å®‰å…¨åŸå› </h2><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å‘ç°äº†åœ¨å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨ SimpleDateFormat ä¼šæœ‰çº¿ç¨‹å®‰ å…¨é—®é¢˜ã€‚å…¶å®ï¼ŒJDK æ–‡æ¡£ä¸­å·²ç»æ˜ç¡®è¡¨æ˜äº† SimpleDateFormat ä¸åº”è¯¥ç”¨åœ¨å¤šçº¿ç¨‹ åœºæ™¯ä¸­:</p>
<blockquote>
<p>Date formats are not synchronized. It is recommended to create separate format instances for each thread. If multiple threads access a format concurrently, it must be synchronized externally.</p>
</blockquote>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥åˆ†æä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼ŒSimpleDateFormat åº•å±‚åˆ°åº•æ˜¯æ€ ä¹ˆå®ç°çš„?<br>æˆ‘ä»¬è·Ÿä¸€ä¸‹ SimpleDateFormat ç±»ä¸­ format æ–¹æ³•çš„å®ç°å…¶å®å°±èƒ½å‘ç°ç«¯å€ªã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Called from Format after creating a FieldDelegate</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> StringBuffer <span class="title">format</span><span class="params">(Date date, StringBuffer toAppendTo,</span></span></span><br><span class="line"><span class="params"><span class="function">                                FieldDelegate delegate)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Convert input date to time field list</span></span><br><span class="line">        calendar.setTime(date);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> useDateFormatSymbols = useDateFormatSymbols();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; compiledPattern.length; ) &#123;</span><br><span class="line">            <span class="keyword">int</span> tag = compiledPattern[i] &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">            <span class="keyword">int</span> count = compiledPattern[i++] &amp; <span class="number">0xff</span>;</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">255</span>) &#123;</span><br><span class="line">                count = compiledPattern[i++] &lt;&lt; <span class="number">16</span>;</span><br><span class="line">                count |= compiledPattern[i++];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (tag) &#123;</span><br><span class="line">            <span class="keyword">case</span> TAG_QUOTE_ASCII_CHAR:</span><br><span class="line">                toAppendTo.append((<span class="keyword">char</span>)count);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> TAG_QUOTE_CHARS:</span><br><span class="line">                toAppendTo.append(compiledPattern, i, count);</span><br><span class="line">                i += count;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                subFormat(tag, count, delegate, toAppendTo, useDateFormatSymbols);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> toAppendTo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>SimpleDateFormat ä¸­çš„ format æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªæˆå‘˜å˜é‡ calendar æ¥ä¿å­˜æ—¶é—´ã€‚è¿™å…¶å®å°±æ˜¯é—®é¢˜çš„å…³é”®ã€‚</p>
<p>ç”±äºæˆ‘ä»¬åœ¨å£°æ˜ SimpleDateFormat çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ static å®šä¹‰çš„ã€‚é‚£ä¹ˆ è¿™ ä¸ª SimpleDateFormatå°±æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œ éš ä¹‹ï¼ŒSimpleDateFormat ä¸­ çš„ calendar ä¹Ÿå°±å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®åˆ°ã€‚</p>
<p>å‡è®¾çº¿ç¨‹ 1 åˆšåˆšæ‰§è¡Œå®Œ calendar.setTime æŠŠæ—¶é—´è®¾ç½®æˆ 2018-11-11ï¼Œè¿˜ æ²¡ç­‰æ‰§è¡Œå®Œï¼Œçº¿ç¨‹ 2 åˆæ‰§è¡Œäº† calendar.setTime æŠŠæ—¶é—´æ”¹æˆäº† 2018-12-12ã€‚ è¿™æ—¶å€™çº¿ç¨‹ 1 ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‹¿åˆ°çš„ calendar.getTime å¾—åˆ°çš„æ—¶é—´å°±æ˜¯çº¿ç¨‹ 2 æ”¹ è¿‡ä¹‹åçš„ã€‚</p>
<p>é™¤äº† format æ–¹æ³•ä»¥å¤–ï¼ŒSimpleDateFormat çš„ parse æ–¹æ³•ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œä¸è¦æŠŠ SimpleDateFormat ä½œä¸ºä¸€ä¸ªå…±äº«å˜é‡ä½¿ç”¨ã€‚</p>
<h2 id="å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><ul>
<li>ä½¿ç”¨å±€éƒ¨å˜é‡<br> ä¸è¦ä½¿ç”¨static</li>
<li>åŠ åŒæ­¥é”<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123; <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line">           Calendar calendar = Calendar.getInstance();</span><br><span class="line">           <span class="keyword">int</span> finalI = i;</span><br><span class="line">           pool.execute(() -&gt; &#123;</span><br><span class="line">               <span class="comment">// åŠ é”</span></span><br><span class="line">               <span class="keyword">synchronized</span> (simpleDateFormat) &#123;</span><br><span class="line">                   <span class="comment">// æ—¶é—´å¢åŠ </span></span><br><span class="line">                   calendar.add(Calendar.DATE, finalI);</span><br><span class="line">                   <span class="comment">// é€šè¿‡ simpleDateFormat æŠŠæ—¶é—´è½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                   String dateString = simpleDateFormat.format(calendar.getTime()); <span class="comment">// æŠŠå­—ç¬¦ä¸²æ”¾å…¥ Set ä¸­</span></span><br><span class="line">                   dates.add(dateString);</span><br><span class="line">                   <span class="comment">//countDown</span></span><br><span class="line">                   countDownLatch.countDown();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>å…¶å®ä»¥ä¸Šä»£ç è¿˜æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œå°±æ˜¯å¯ä»¥æŠŠé”çš„ç²’åº¦å†è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œå¯ä»¥ åªå¯¹ simpleDateFormat.format è¿™ä¸€è¡ŒåŠ é”ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ä¸€äº›ã€‚</p>
<ul>
<li>ä½¿ç”¨ ThreadLocal<br> ç¬¬ä¸‰ç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ ThreadLocalã€‚ ThreadLocal å¯ä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ å¾—åˆ°å•ç‹¬çš„ä¸€ä¸ª SimpleDateFormat çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ç«äº‰é—®é¢˜äº†ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">        * ä½¿ç”¨ThreadLocalå®šä¹‰ä¸€ä¸ªå…¨å±€çš„SimpleDateFormat */</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;SimpleDateFormat&gt; simpleDateFormatThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;SimpleDateFormat&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">protected</span> SimpleDateFormat <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="comment">// ç”¨æ³•</span></span><br><span class="line">       String dateString = simpleDateFormatThreadLocal.get().format(calendar.getTime());</span><br></pre></td></tr></table></figure>

<p>ç”¨ ThreadLocal æ¥å®ç°å…¶å®æ˜¯æœ‰ç‚¹ç±»ä¼¼äºç¼“å­˜çš„æ€è·¯ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬äº« çš„å¯¹è±¡ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿé¿å…äº†å¤šçº¿ç¨‹çš„ç«äº‰ã€‚</p>
<p>å½“ç„¶ï¼Œä»¥ä¸Šä»£ç ä¹Ÿæœ‰æ”¹è¿›ç©ºé—´ï¼Œå°±æ˜¯ï¼Œå…¶å® SimpleDateFormat çš„åˆ›å»ºè¿‡ç¨‹å¯ ä»¥æ”¹ä¸ºå»¶è¿ŸåŠ è½½ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚</p>
<h2 id="ä½¿ç”¨-DateTimeFormatter"><a href="#ä½¿ç”¨-DateTimeFormatter" class="headerlink" title="ä½¿ç”¨ DateTimeFormatter"></a>ä½¿ç”¨ DateTimeFormatter</h2><p>å¦‚æœæ˜¯ Java8 åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ DateTimeFormatter ä»£æ›¿ SimpleDateFormatï¼Œ è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ ¼å¼åŒ–å·¥å…·ç±»ã€‚å°±åƒå®˜æ–¹æ–‡æ¡£ä¸­è¯´çš„ï¼Œè¿™ä¸ªç±» simple beautiful strong immutable thread-safeã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è§£ææ—¥æœŸ</span></span><br><span class="line">String dateStr = <span class="string">&quot;2016å¹´10æœˆ25æ—¥&quot;</span>;</span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyå¹´MMæœˆddæ—¥&quot;</span>);</span><br><span class="line">LocalDate date = LocalDate.parse(dateStr, formatter);</span><br><span class="line"><span class="comment">// æ—¥æœŸè½¬æ¢ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">DateTimeFormatter format = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyyå¹´MMæœˆddæ—¥ hh:mm a&quot;</span>);</span><br><span class="line">String nowStr = now.format(format);</span><br><span class="line">System.out.println(nowStr);</span><br></pre></td></tr></table></figure>


<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬ æ–‡ ä»‹ ç» äº† SimpleDateFormat çš„ ç”¨ æ³•ï¼ŒSimpleDateFormat ä¸» è¦ å¯ ä»¥ åœ¨ String å’Œ Date ä¹‹é—´åšè½¬æ¢ï¼Œè¿˜å¯ä»¥å°†æ—¶é—´è½¬æ¢æˆä¸åŒæ—¶åŒºè¾“å‡ºã€‚åŒæ—¶æåˆ°åœ¨å¹¶å‘åœº æ™¯ä¸­ SimpleDateFormat æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±æ¥ä¿è¯å…¶å®‰å…¨æ€§ã€‚</p>
<p>ä¸»è¦çš„å‡ ä¸ªæ‰‹æ®µæœ‰æ”¹ä¸ºå±€éƒ¨å˜é‡ã€ä½¿ç”¨ synchronized åŠ é”ã€ä½¿ç”¨ Threadlocal ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹å•ç‹¬åˆ›å»ºä¸€ä¸ªç­‰ã€‚</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-ä¼ ç»Ÿçš„BIO</title>
    <url>/wiki/Java-%E4%BC%A0%E7%BB%9F%E7%9A%84BIO/</url>
    <content><![CDATA[<h1 id="ä¼ ç»Ÿçš„BIO"><a href="#ä¼ ç»Ÿçš„BIO" class="headerlink" title="ä¼ ç»Ÿçš„BIO"></a>ä¼ ç»Ÿçš„BIO</h1><h2 id="Socket-å’Œ-ServerSocket"><a href="#Socket-å’Œ-ServerSocket" class="headerlink" title="Socket å’Œ ServerSocket"></a>Socket å’Œ ServerSocket</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">       ServerSocket serverSocket = <span class="keyword">new</span> ServerSocket(<span class="number">9090</span>);</span><br><span class="line">       <span class="comment">// é˜»å¡</span></span><br><span class="line">       Socket client = serverSocket.accept();</span><br><span class="line"></span><br><span class="line">       InputStream inputStream = client.getInputStream();</span><br><span class="line"></span><br><span class="line">       BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">       <span class="comment">// è¯»é˜»å¡</span></span><br><span class="line">       System.err.println(bufferedReader.readLine());</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>new ServerSocket(9090);</p>
</blockquote>
<p>è¿™ä¸ªjavaç¨‹åºåˆ›å»ºnew ServerSocket(9090);ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œ<br>æ¯”å¦‚linuxæ“ä½œç³»ç»Ÿï¼Œåº”ç”¨è¿›ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaè¿›ç¨‹ï¼Œä¼šè°ƒç”¨linuxçš„å†…æ ¸æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªsocketï¼Œåœ¨linuxç³»ç»Ÿä¸­å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦fdï¼Œæœ€ç»ˆå¯¹å¾—åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">socket() = XXfd</span><br><span class="line">bind(XXfd,9090)</span><br><span class="line">listen(XXfd)</span><br></pre></td></tr></table></figure>

<p><img src="https://sjwx.easydoc.xyz/47754217/files/kn1ecf3d.png" alt="image.png"></p>
<ul>
<li>socket çš„readæ–¹æ³• ï¼Œè¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸€ç›´é˜»å¡</li>
<li>serverSocketçš„acceptæ–¹æ³•ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„é“¾æ¥ï¼Œå¦‚æœæ²¡æœ‰é“¾æ¥ï¼Œåˆ™ä¸€ç›´é˜»å¡ç­‰å¾…</li>
<li>serverSocket ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚</li>
</ul>
<h2 id="BIOç¨‹åºæœ‰å“ªäº›å¼Šç«¯ï¼Ÿ"><a href="#BIOç¨‹åºæœ‰å“ªäº›å¼Šç«¯ï¼Ÿ" class="headerlink" title="BIOç¨‹åºæœ‰å“ªäº›å¼Šç«¯ï¼Ÿ"></a>BIOç¨‹åºæœ‰å“ªäº›å¼Šç«¯ï¼Ÿ</h2><ul>
<li>æœåŠ¡ç«¯ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å‘éå¸¸ä½</li>
<li>æ²¡æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸€ç›´é˜»å¡ï¼Œå ç”¨èµ„æº</li>
</ul>
<h2 id="å¦‚æœåœ¨bioçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Ÿ"><a href="#å¦‚æœåœ¨bioçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Ÿ" class="headerlink" title="å¦‚æœåœ¨bioçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Ÿ"></a>å¦‚æœåœ¨bioçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Ÿ</h2><blockquote>
<p>d C10Ké—®é¢˜ </p>
</blockquote>
<p><font color=red>æ¥ä¸€ä¸ªé“¾æ¥ï¼ŒæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹</font> ï¼Œå»å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ç»§ç»­ç›‘å¬å®¢æˆ·ç«¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¢åŠ å¹¶å‘ï¼Ÿ<br>æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<ul>
<li>çº¿ç¨‹æ¶ˆè€—å†…å­˜èµ„æº</li>
</ul>
<p>å¦‚æœä¸€ä¸‹å­è¿‡æ¥10ä¸‡ä¸ªè¯·æ±‚å‘¢ï¼Ÿ<br>æœåŠ¡å™¨è¦åˆ›å»º10ä¸‡ä¸ªçº¿ç¨‹ï¼Œå†…å­˜å°±å´©äº†ã€‚</p>
<p>å¦‚æœæä¸€ä¸ªçº¿ç¨‹æ± å‘¢ï¼Ÿ å¹¶å‘åº¦æœ€å¤§ä¸ºæœ€å¤§çº¿ç¨‹æ•°ï¼Ÿ å¹¶å‘åº¦å·²ç»å®šæ­»äº†ï¼Ÿ</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-é”å‡çº§è¿‡ç¨‹</title>
    <url>/wiki/Java-%E9%94%81%E5%8D%87%E7%BA%A7%E8%BF%87%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="é”å‡çº§"><a href="#é”å‡çº§" class="headerlink" title="é”å‡çº§"></a>é”å‡çº§</h1><h2 id="ä½¿ç”¨JOLæŸ¥çœ‹åŠ é”ä¹‹åçš„å¯¹è±¡ä¿¡æ¯"><a href="#ä½¿ç”¨JOLæŸ¥çœ‹åŠ é”ä¹‹åçš„å¯¹è±¡ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨JOLæŸ¥çœ‹åŠ é”ä¹‹åçš„å¯¹è±¡ä¿¡æ¯"></a>ä½¿ç”¨JOLæŸ¥çœ‹åŠ é”ä¹‹åçš„å¯¹è±¡ä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object object = <span class="keyword">new</span> Object();</span><br><span class="line">        System.out.println(ClassLayout.parseInstance(object).toPrintable());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">synchronized</span> (object)&#123;</span><br><span class="line">            System.out.println(ClassLayout.parseInstance(object).toPrintable());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æ‰“å°ç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.Object object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      <span class="number">0</span>     <span class="number">4</span>        (object header)                           <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> (<span class="number">00000001</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>) (<span class="number">1</span>)</span><br><span class="line">      <span class="number">4</span>     <span class="number">4</span>        (object header)                           <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> (<span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span>) (<span class="number">0</span>)</span><br><span class="line">      <span class="number">8</span>     <span class="number">4</span>        (object header)                           e5 <span class="number">01</span> <span class="number">00</span> f8 (<span class="number">11100101</span> <span class="number">00000001</span> <span class="number">00000000</span> <span class="number">11111000</span>) (-<span class="number">134217243</span>)</span><br><span class="line">     <span class="number">12</span>     <span class="number">4</span>        (loss due to the next object alignment)</span><br><span class="line">Instance size: <span class="number">16</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br><span class="line"></span><br><span class="line">java.lang.Object object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      <span class="number">0</span>     <span class="number">4</span>        (object header)                           f0 b8 d0 <span class="number">0f</span> (<span class="number">11110000</span> <span class="number">10111000</span> <span class="number">11010000</span> <span class="number">00001111</span>) (<span class="number">265337072</span>)</span><br><span class="line">      <span class="number">4</span>     <span class="number">4</span>        (object header)                           <span class="number">00</span> <span class="number">70</span> <span class="number">00</span> <span class="number">00</span> (<span class="number">00000000</span> <span class="number">01110000</span> <span class="number">00000000</span> <span class="number">00000000</span>) (<span class="number">28672</span>)</span><br><span class="line">      <span class="number">8</span>     <span class="number">4</span>        (object header)                           e5 <span class="number">01</span> <span class="number">00</span> f8 (<span class="number">11100101</span> <span class="number">00000001</span> <span class="number">00000000</span> <span class="number">11111000</span>) (-<span class="number">134217243</span>)</span><br><span class="line">     <span class="number">12</span>     <span class="number">4</span>        (loss due to the next object alignment)</span><br><span class="line">Instance size: <span class="number">16</span> bytes</span><br><span class="line">Space losses: <span class="number">0</span> bytes internal + <span class="number">4</span> bytes external = <span class="number">4</span> bytes total</span><br></pre></td></tr></table></figure>


<h2 id="é”å‡çº§è¿‡ç¨‹"><a href="#é”å‡çº§è¿‡ç¨‹" class="headerlink" title="é”å‡çº§è¿‡ç¨‹"></a>é”å‡çº§è¿‡ç¨‹</h2><blockquote>
<p>é”å‡çº§è¿‡ç¨‹ï¼š new - åå‘é” - è½»é‡çº§é” ï¼ˆæ— é”, è‡ªæ—‹é”ï¼Œè‡ªé€‚åº”è‡ªæ—‹ï¼‰- é‡é‡çº§é”</p>
</blockquote>
<image src="https://oscimg.oschina.net/oscnet/up-2f555289640d34755ca4288ab080906554b.png" width=750 height=450> 

<p><strong>è‡ªæ—‹é”ä»€ä¹ˆæ—¶å€™å‡çº§ä¸ºé‡é‡çº§é”ï¼Ÿ</strong></p>
<p><strong>ä¸ºä»€ä¹ˆæœ‰è‡ªæ—‹é”è¿˜éœ€è¦é‡é‡çº§é”ï¼Ÿ</strong></p>
<blockquote>
<p>è‡ªæ—‹æ˜¯æ¶ˆè€—CPUèµ„æºçš„ï¼Œå¦‚æœé”çš„æ—¶é—´é•¿ï¼Œæˆ–è€…è‡ªæ—‹çº¿ç¨‹å¤šï¼ŒCPUä¼šè¢«å¤§é‡æ¶ˆè€—<br>é‡é‡çº§é”æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œæ‰€æœ‰æ‹¿ä¸åˆ°é”çš„è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸éœ€è¦æ¶ˆè€—CPUèµ„æº</p>
</blockquote>
<p><strong>åå‘é”æ˜¯å¦ä¸€å®šæ¯”è‡ªæ—‹é”æ•ˆç‡é«˜ï¼Ÿ</strong></p>
<blockquote>
<p>ä¸ä¸€å®šï¼Œåœ¨æ˜ç¡®çŸ¥é“ä¼šæœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œåå‘é”è‚¯å®šä¼šæ¶‰åŠé”æ’¤é”€ï¼Œè¿™æ—¶å€™ç›´æ¥ä½¿ç”¨è‡ªæ—‹é”<br>JVMå¯åŠ¨è¿‡ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹ç«äº‰ï¼ˆæ˜ç¡®ï¼‰ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µå¯åŠ¨æ—¶ä¸æ‰“å¼€åå‘é”ï¼Œè¿‡ä¸€æ®µå„¿æ—¶é—´å†æ‰“å¼€</p>
</blockquote>
<h3 id="synchronizedä¼˜åŒ–çš„è¿‡ç¨‹å’Œmarkwordæ¯æ¯ç›¸å…³"><a href="#synchronizedä¼˜åŒ–çš„è¿‡ç¨‹å’Œmarkwordæ¯æ¯ç›¸å…³" class="headerlink" title="synchronizedä¼˜åŒ–çš„è¿‡ç¨‹å’Œmarkwordæ¯æ¯ç›¸å…³"></a>synchronizedä¼˜åŒ–çš„è¿‡ç¨‹å’Œmarkwordæ¯æ¯ç›¸å…³</h3><p>ç”¨markwordä¸­æœ€ä½çš„ä¸‰ä½ä»£è¡¨é”çŠ¶æ€ å…¶ä¸­1ä½æ˜¯åå‘é”ä½ ä¸¤ä½æ˜¯æ™®é€šé”ä½</p>
<ol>
<li><p>Object o = new Object()<br>é” = 0 01 æ— é”æ€<br>æ³¨æ„ï¼šå¦‚æœåå‘é”æ‰“å¼€ï¼Œé»˜è®¤æ˜¯åŒ¿ååå‘çŠ¶æ€</p>
</li>
<li><p>o.hashCode()<br>001 + hashcode</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">00000001</span> <span class="number">10101101</span> <span class="number">00110100</span> <span class="number">00110110</span></span><br><span class="line"><span class="number">01011001</span> <span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000000</span></span><br></pre></td></tr></table></figure>

<p>little endian big endian </p>
<p>00000000 00000000 00000000 01011001 00110110 00110100 10101101 00000000</p>
</li>
<li><p>é»˜è®¤synchronized(o)<br>00 -&gt; è½»é‡çº§é”<br>é»˜è®¤æƒ…å†µ åå‘é”æœ‰ä¸ªæ—¶å»¶ï¼Œé»˜è®¤æ˜¯4ç§’<br>why? å› ä¸ºJVMè™šæ‹Ÿæœºè‡ªå·±æœ‰ä¸€äº›é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹ï¼Œé‡Œé¢æœ‰å¥½å¤šsyncä»£ç ï¼Œè¿™äº›syncä»£ç å¯åŠ¨æ—¶å°±çŸ¥é“è‚¯å®šä¼šæœ‰ç«äº‰ï¼Œå¦‚æœä½¿ç”¨åå‘é”ï¼Œå°±ä¼šé€ æˆåå‘é”ä¸æ–­çš„è¿›è¡Œé”æ’¤é”€å’Œé”å‡çº§çš„æ“ä½œï¼Œæ•ˆç‡è¾ƒä½ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-XX:BiasedLockingStartupDelay=0</span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚æœè®¾å®šä¸Šè¿°å‚æ•°<br>new Object () - &gt; 101 åå‘é” -&gt;çº¿ç¨‹IDä¸º0 -&gt; Anonymous BiasedLock<br>æ‰“å¼€åå‘é”ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œé»˜è®¤å°±æ˜¯ä¸€ä¸ªå¯åå‘åŒ¿åå¯¹è±¡101</p>
</li>
<li><p>å¦‚æœæœ‰çº¿ç¨‹ä¸Šé”<br>ä¸Šåå‘é”ï¼ŒæŒ‡çš„å°±æ˜¯ï¼ŒæŠŠmarkwordçš„çº¿ç¨‹IDæ”¹ä¸ºè‡ªå·±çº¿ç¨‹IDçš„è¿‡ç¨‹<br>åå‘é”ä¸å¯é‡åå‘ æ‰¹é‡åå‘ æ‰¹é‡æ’¤é”€</p>
</li>
<li><p>å¦‚æœæœ‰çº¿ç¨‹ç«äº‰<br>æ’¤é”€åå‘é”ï¼Œå‡çº§è½»é‡çº§é”<br>çº¿ç¨‹åœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆç”ŸæˆLockRecord ï¼Œç”¨CASæ“ä½œå°†markwordè®¾ç½®ä¸ºæŒ‡å‘è‡ªå·±è¿™ä¸ªçº¿ç¨‹çš„LRçš„æŒ‡é’ˆï¼Œè®¾ç½®æˆåŠŸè€…å¾—åˆ°é”</p>
</li>
<li><p>å¦‚æœç«äº‰åŠ å‰§<br>ç«äº‰åŠ å‰§ï¼šæœ‰çº¿ç¨‹è¶…è¿‡10æ¬¡è‡ªæ—‹ï¼Œ -XX:PreBlockSpinï¼Œ æˆ–è€…è‡ªæ—‹çº¿ç¨‹æ•°è¶…è¿‡CPUæ ¸æ•°çš„ä¸€åŠï¼Œ 1.6ä¹‹åï¼ŒåŠ å…¥è‡ªé€‚åº”è‡ªæ—‹ Adapative Self Spinning ï¼Œ JVMè‡ªå·±æ§åˆ¶<br>å‡çº§é‡é‡çº§é”ï¼š-&gt; å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºï¼Œlinux mutex , CPUä»3çº§-0çº§ç³»ç»Ÿè°ƒç”¨ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ï¼Œç„¶åå†æ˜ å°„å›ç”¨æˆ·ç©ºé—´</p>
</li>
</ol>
<p>(ä»¥ä¸Šå®éªŒç¯å¢ƒæ˜¯JDK11ï¼Œæ‰“å¼€å°±æ˜¯åå‘é”ï¼Œè€ŒJDK8é»˜è®¤å¯¹è±¡å¤´æ˜¯æ— é”)<br>åå‘é”é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ—¶å»¶ï¼Œå¦‚æœè¦è§‚å¯Ÿåˆ°åå‘é”ï¼Œåº”è¯¥è®¾å®šå‚æ•°</p>
<p><strong>å¦‚æœè®¡ç®—è¿‡å¯¹è±¡çš„hashCodeï¼Œåˆ™å¯¹è±¡æ— æ³•è¿›å…¥åå‘çŠ¶æ€ï¼</strong></p>
<blockquote>
<p><strong>è½»é‡çº§é”é‡é‡çº§é”çš„hashCodeå­˜åœ¨ä¸ä»€ä¹ˆåœ°æ–¹ï¼Ÿ</strong><br>ç­”æ¡ˆï¼šçº¿ç¨‹æ ˆä¸­ï¼Œè½»é‡çº§é”çš„LRä¸­ï¼Œæˆ–æ˜¯ä»£è¡¨é‡é‡çº§é”çš„ObjectMonitorçš„æˆå‘˜ä¸­</p>
</blockquote>
<p>å…³äºepoch: (ä¸é‡è¦)</p>
<blockquote>
<p><strong>æ‰¹é‡é‡åå‘ä¸æ‰¹é‡æ’¤é”€</strong>æ¸Šæºï¼šä»åå‘é”çš„åŠ é”è§£é”è¿‡ç¨‹ä¸­å¯çœ‹å‡ºï¼Œå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåå‘é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€åŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å½“æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå°±éœ€è¦ç­‰åˆ°safe pointæ—¶ï¼Œå†å°†åå‘é”æ’¤é”€ä¸ºæ— é”çŠ¶æ€æˆ–å‡çº§ä¸ºè½»é‡çº§ï¼Œä¼šæ¶ˆè€—ä¸€å®šçš„æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç«äº‰é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œåå‘é”ä¸ä»…ä¸èƒ½æé«˜æ€§èƒ½ï¼Œè¿˜ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚äºæ˜¯ï¼Œå°±æœ‰äº†æ‰¹é‡é‡åå‘ä¸æ‰¹é‡æ’¤é”€çš„æœºåˆ¶ã€‚</p>
<p><strong>åŸç†</strong>ä»¥classä¸ºå•ä½ï¼Œä¸ºæ¯ä¸ªclassç»´æŠ¤<strong>è§£å†³åœºæ™¯</strong>æ‰¹é‡é‡åå‘ï¼ˆbulk rebiasï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¤§é‡å¯¹è±¡å¹¶æ‰§è¡Œäº†åˆå§‹çš„åŒæ­¥æ“ä½œï¼Œåæ¥å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥å°†è¿™äº›å¯¹è±¡ä½œä¸ºé”å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„åå‘é”æ’¤é”€æ“ä½œã€‚æ‰¹é‡æ’¤é”€ï¼ˆbulk revokeï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šåœ¨æ˜æ˜¾å¤šçº¿ç¨‹ç«äº‰å‰§çƒˆçš„åœºæ™¯ä¸‹ä½¿ç”¨åå‘é”æ˜¯ä¸åˆé€‚çš„ã€‚</p>
<p>ä¸€ä¸ªåå‘é”æ’¤é”€è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡è¯¥classçš„å¯¹è±¡å‘ç”Ÿåå‘æ’¤é”€æ“ä½œæ—¶ï¼Œè¯¥è®¡æ•°å™¨+1ï¼Œå½“è¿™ä¸ªå€¼è¾¾åˆ°é‡åå‘é˜ˆå€¼ï¼ˆé»˜è®¤20ï¼‰æ—¶ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„åå‘é”æœ‰é—®é¢˜ï¼Œå› æ­¤ä¼šè¿›è¡Œæ‰¹é‡é‡åå‘ã€‚æ¯ä¸ªclasså¯¹è±¡ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„epochå­—æ®µï¼Œæ¯ä¸ªå¤„äºåå‘é”çŠ¶æ€å¯¹è±¡çš„Mark Wordä¸­ä¹Ÿæœ‰è¯¥å­—æ®µï¼Œå…¶åˆå§‹å€¼ä¸ºåˆ›å»ºè¯¥å¯¹è±¡æ—¶classä¸­çš„epochçš„å€¼ã€‚æ¯æ¬¡å‘ç”Ÿæ‰¹é‡é‡åå‘æ—¶ï¼Œå°±å°†è¯¥å€¼+1ï¼ŒåŒæ—¶éå†JVMä¸­æ‰€æœ‰çº¿ç¨‹çš„æ ˆï¼Œæ‰¾åˆ°è¯¥classæ‰€æœ‰æ­£å¤„äºåŠ é”çŠ¶æ€çš„åå‘é”ï¼Œå°†å…¶epochå­—æ®µæ”¹ä¸ºæ–°å€¼ã€‚ä¸‹æ¬¡è·å¾—é”æ—¶ï¼Œå‘ç°å½“å‰å¯¹è±¡çš„epochå€¼å’Œclassçš„epochä¸ç›¸ç­‰ï¼Œé‚£å°±ç®—å½“å‰å·²ç»åå‘äº†å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡CASæ“ä½œå°†å…¶Mark Wordçš„Thread Id æ”¹æˆå½“å‰çº¿ç¨‹Idã€‚å½“è¾¾åˆ°é‡åå‘é˜ˆå€¼åï¼Œå‡è®¾è¯¥classè®¡æ•°å™¨ç»§ç»­å¢é•¿ï¼Œå½“å…¶è¾¾åˆ°æ‰¹é‡æ’¤é”€çš„é˜ˆå€¼åï¼ˆé»˜è®¤40ï¼‰ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„ä½¿ç”¨åœºæ™¯å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œä¼šæ ‡è®°è¯¥classä¸ºä¸å¯åå‘ï¼Œä¹‹åï¼Œå¯¹äºè¯¥classçš„é”ï¼Œç›´æ¥èµ°è½»é‡çº§é”çš„é€»è¾‘ã€‚</p>
</blockquote>
<p>æ²¡é”™ï¼Œæˆ‘å°±æ˜¯å•æ‰€æ‰€é•¿</p>
<p>åŠ é”ï¼ŒæŒ‡çš„æ˜¯é”å®šå¯¹è±¡</p>
<p>é”å‡çº§çš„è¿‡ç¨‹</p>
<p>JDKè¾ƒæ—©çš„ç‰ˆæœ¬ OSçš„èµ„æº äº’æ–¥é‡ ç”¨æˆ·æ€ -&gt; å†…æ ¸æ€çš„è½¬æ¢ é‡é‡çº§ æ•ˆç‡æ¯”è¾ƒä½</p>
<p>ç°ä»£ç‰ˆæœ¬è¿›è¡Œäº†ä¼˜åŒ–</p>
<p>æ— é” - åå‘é” -è½»é‡çº§é”ï¼ˆè‡ªæ—‹é”ï¼‰-é‡é‡çº§é”</p>
<p>åå‘é” - markword ä¸Šè®°å½•å½“å‰çº¿ç¨‹æŒ‡é’ˆï¼Œä¸‹æ¬¡åŒä¸€ä¸ªçº¿ç¨‹åŠ é”çš„æ—¶å€™ï¼Œä¸éœ€è¦äº‰ç”¨ï¼Œåªéœ€è¦åˆ¤æ–­çº¿ç¨‹æŒ‡é’ˆæ˜¯å¦åŒä¸€ä¸ªï¼Œæ‰€ä»¥ï¼Œåå‘é”ï¼Œåå‘åŠ é”çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ ã€‚hashCodeå¤‡ä»½åœ¨çº¿ç¨‹æ ˆä¸Š çº¿ç¨‹é”€æ¯ï¼Œé”é™çº§ä¸ºæ— é”</p>
<p>æœ‰äº‰ç”¨ - é”å‡çº§ä¸ºè½»é‡çº§é” - æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„LockRecordåœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆä¸Šï¼Œç”¨CASå»äº‰ç”¨markwordçš„LRçš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å“ªä¸ªçº¿ç¨‹çš„LRï¼Œå“ªä¸ªçº¿ç¨‹å°±æ‹¥æœ‰é”</p>
<p>è‡ªæ—‹è¶…è¿‡10æ¬¡ï¼Œå‡çº§ä¸ºé‡é‡çº§é” - å¦‚æœå¤ªå¤šçº¿ç¨‹è‡ªæ—‹ CPUæ¶ˆè€—è¿‡å¤§ï¼Œä¸å¦‚å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆä¸æ¶ˆè€—CPUï¼‰-XX:PreBlockSpin</p>
<p>è‡ªæ—‹é”åœ¨ JDK1.4.2 ä¸­å¼•å…¥ï¼Œä½¿ç”¨ -XX:+UseSpinning æ¥å¼€å¯ã€‚JDK 6 ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚</p>
<p>è‡ªé€‚åº”è‡ªæ—‹é”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚</p>
<p>åå‘é”ç”±äºæœ‰é”æ’¤é”€çš„è¿‡ç¨‹revokeï¼Œä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ï¼Œåœ¨é”äº‰ç”¨ç‰¹åˆ«æ¿€çƒˆçš„æ—¶å€™ï¼Œç”¨åå‘é”æœªå¿…æ•ˆç‡é«˜ã€‚è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨è½»é‡çº§é”ã€‚</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Java-é”æ¶ˆé™¤å’Œé”è†¨èƒ€</title>
    <url>/wiki/Java-%E9%94%81%E6%B6%88%E9%99%A4%E5%92%8C%E9%94%81%E8%86%A8%E8%83%80/</url>
    <content><![CDATA[<h1 id="é”æ¶ˆé™¤å’Œé”ç²—åŒ–"><a href="#é”æ¶ˆé™¤å’Œé”ç²—åŒ–" class="headerlink" title="é”æ¶ˆé™¤å’Œé”ç²—åŒ–"></a>é”æ¶ˆé™¤å’Œé”ç²—åŒ–</h1><h2 id="é”æ¶ˆé™¤-ï¼ˆlock-eliminateï¼‰"><a href="#é”æ¶ˆé™¤-ï¼ˆlock-eliminateï¼‰" class="headerlink" title="é”æ¶ˆé™¤ ï¼ˆlock eliminateï¼‰"></a>é”æ¶ˆé™¤ ï¼ˆlock eliminateï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String str1,String str2)</span></span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(str1).append(str2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒçš„å…³é”®æ–¹æ³•éƒ½æ˜¯è¢« synchronized ä¿®é¥°è¿‡çš„ï¼Œä½†æˆ‘ä»¬çœ‹ä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œsb è¿™ä¸ªå¼•ç”¨åªä¼šåœ¨ add æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œä¸å¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹å¼•ç”¨ï¼ˆå› ä¸ºæ˜¯å±€éƒ¨å˜é‡ï¼Œæ ˆç§æœ‰ï¼‰ï¼Œå› æ­¤ sb æ˜¯ä¸å¯èƒ½å…±äº«çš„èµ„æºï¼ŒJVM ä¼šè‡ªåŠ¨æ¶ˆé™¤ StringBuffer å¯¹è±¡å†…éƒ¨çš„é”ã€‚</p>
<h2 id="é”ç²—åŒ–-ï¼ˆlock-coarseningï¼‰"><a href="#é”ç²—åŒ–-ï¼ˆlock-coarseningï¼‰" class="headerlink" title="é”ç²—åŒ– ï¼ˆlock coarseningï¼‰"></a>é”ç²—åŒ– ï¼ˆlock coarseningï¼‰</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">       <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">       StringBuffer sb = <span class="keyword">new</span> StringBuffer():</span><br><span class="line">       <span class="keyword">while</span>(i &lt; <span class="number">100</span>)&#123;</span><br><span class="line">           sb.append(str);</span><br><span class="line">           i++;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> sb.toString():</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JVM ä¼šæ£€æµ‹åˆ°è¿™æ ·ä¸€è¿ä¸²çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼ˆwhile å¾ªç¯å†… 100 æ¬¡æ‰§è¡Œ appendï¼Œæ²¡æœ‰é”ç²—åŒ–çš„å°±è¦è¿›è¡Œ 100  æ¬¡åŠ é”/è§£é”ï¼‰ï¼Œæ­¤æ—¶ JVM å°±ä¼šå°†åŠ é”çš„èŒƒå›´ç²—åŒ–åˆ°è¿™ä¸€è¿ä¸²çš„æ“ä½œçš„å¤–éƒ¨ï¼ˆæ¯”å¦‚ while è™šå¹»ä½“å¤–ï¼‰ï¼Œä½¿å¾—è¿™ä¸€è¿ä¸²æ“ä½œåªéœ€è¦åŠ ä¸€æ¬¡é”å³å¯ã€‚</p>
<h2 id="é”é™çº§"><a href="#é”é™çº§" class="headerlink" title="é”é™çº§"></a>é”é™çº§</h2><p><a href="https://www.zhihu.com/question/63859501">https://www.zhihu.com/question/63859501</a></p>
<p>å…¶å®ï¼Œåªè¢«VMThreadè®¿é—®ï¼Œé™çº§ä¹Ÿå°±æ²¡å•¥æ„ä¹‰äº†ã€‚æ‰€ä»¥å¯ä»¥ç®€å•è®¤ä¸ºé”é™çº§ä¸å­˜åœ¨ï¼</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå†…å­˜æ¨¡å‹</title>
    <url>/wiki/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="Javaå†…å­˜æ¨¡å‹"><a href="#Javaå†…å­˜æ¨¡å‹" class="headerlink" title="Javaå†…å­˜æ¨¡å‹"></a>Javaå†…å­˜æ¨¡å‹</h1><h2 id="é¦–å…ˆéœ€è¦æ€è€ƒä»€ä¹ˆæ˜¯JMMï¼Œä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰JMMã€‚"><a href="#é¦–å…ˆéœ€è¦æ€è€ƒä»€ä¹ˆæ˜¯JMMï¼Œä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰JMMã€‚" class="headerlink" title="é¦–å…ˆéœ€è¦æ€è€ƒä»€ä¹ˆæ˜¯JMMï¼Œä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰JMMã€‚"></a>é¦–å…ˆéœ€è¦æ€è€ƒä»€ä¹ˆæ˜¯JMMï¼Œä»¥åŠä¸ºä»€ä¹ˆä¼šæœ‰JMMã€‚</h2><blockquote>
<p>Java Memory Modelç®€ç§°JMM, æ˜¯ä¸€ç³»åˆ—çš„Javaè™šæ‹Ÿæœºå¹³å°å¯¹å¼€å‘è€…æä¾›çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†…å­˜å¯è§æ€§ã€æ˜¯å¦å¯ä»¥é‡æ’åºç­‰é—®é¢˜çš„æ— å…³å…·ä½“å¹³å°çš„ç»Ÿä¸€çš„ä¿è¯ã€‚(å¯èƒ½åœ¨æœ¯è¯­ä¸Šä¸Javaè¿è¡Œæ—¶å†…å­˜åˆ†å¸ƒæœ‰æ­§ä¹‰ï¼Œåè€…æŒ‡å †ã€æ–¹æ³•åŒºã€çº¿ç¨‹æ ˆç­‰å†…å­˜åŒºåŸŸ)ã€‚</p>
</blockquote>
<p> <strong>JMMè§„èŒƒçš„å†…å®¹</strong>  </p>
<ul>
<li>1.æ‰€æœ‰å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜  </li>
<li>2.ä¸»å†…å­˜æ˜¯è™šæ‹Ÿæœºå†…å­˜çš„ä¸€éƒ¨åˆ†</li>
<li>3.æ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜</li>
<li>4.çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¿å­˜å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬</li>
<li>5.çº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œå¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ</li>
<li>6.ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡</li>
<li>7.çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ</li>
</ul>
<p>JMMå¹¶ä¸æ˜¯ä¸€ä¸ªå®¢è§‚å­˜åœ¨çš„ä¸œè¥¿ï¼Œå®ƒå®é™…æ˜¯ä¸ºäº†è§„èŒƒJavaè™šæ‹Ÿæœºåˆ¶å®šåˆ°ä¸€å¥—æ ‡å‡†ã€‚é‚£ä¸ºä»€ä¹ˆéœ€è¦è¿™å¥—æ ‡å‡†å‘¢ï¼Ÿ </p>
<p> å…¶å®æˆ‘ä»¬éƒ½çŸ¥é“JVMæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„ã€‚è€Œç›®å‰çš„æ“ä½œç³»ç»Ÿéƒ½æ˜¯åŸºäºå†¯è¯ºä¼Šæ›¼è®¾ç½®çš„è®¡ç®—æœºç³»ç»Ÿä½“ç³»æ¥çš„ã€‚CPUæ˜¯è®¡ç®—æœºä¸­ç”¨æ¥æ‰§è¡Œæ§åˆ¶å’Œè®¡ç®—çš„æ ¸å¿ƒç»„å»ºï¼Œ<br>æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡å…¨éƒ¨åœ¨CPUä¸­å®Œæˆï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ‰€æœ‰å˜é‡çš„æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚CPUåœ¨æ‰§è¡Œè®¡ç®—æ—¶ï¼Œéœ€è¦å»ä¸»å†…å­˜åŠ è½½æ•°æ®ï¼ŒCPUæ‰§è¡Œè¿ç®—çš„é€Ÿåº¦æå¿«ï¼Œ<br>è¿™å°±è®¾è®¡ä¸€ä¸ªCPUæ‰§è¡Œé€Ÿåº¦å’Œæ•°æ®åŠ è½½é€Ÿåº¦ä¸ä¸€è‡´çš„é—®é¢˜ã€‚   </p>
<img src= "https://user-gold-cdn.xitu.io/2018/2/7/1616dcd4cfc4f98c?imageView2/0/w/1280/h/960/ignore-error/1" width = "400" height = "500" />      

<p> åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯å¼•å…¥äº†CPUç¼“å­˜ã€‚æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±ç§æœ‰çš„L1ç¼“å­˜å’ŒL2ç¼“å­˜ï¼Œå½“æ‰§è¡Œè®¡ç®—æ—¶ï¼Œä¼šä¼˜å…ˆå»CPUè‡ªå·±çš„ç¼“å­˜ä¸­å¯»æ‰¾æ•°æ®ï¼Œ<br>æ²¡æœ‰çš„è¯æ‰ä¼šé‡æ–°åŠ è½½å†…å­˜æ•°æ®ã€‚è¿™ç§æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†CPUè®¡ç®—å’Œæ•°æ®åŠ è½½ä¸ä¸€è‡´çš„é—®é¢˜ã€‚    </p>
<p><strong>ä½†æ˜¯ä¹Ÿä¼šå¼•å…¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</strong>  </p>
<h2 id="ç¼“å­˜ä¸€è‡´æ€§ä¸MESIåè®®"><a href="#ç¼“å­˜ä¸€è‡´æ€§ä¸MESIåè®®" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§ä¸MESIåè®®"></a>ç¼“å­˜ä¸€è‡´æ€§ä¸MESIåè®®</h2><p><strong>é¦–å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯MESIåè®®</strong>  </p>
<blockquote>
<p>ç¼“å­˜ä¸€è‡´æ€§åè®®ç»™ç¼“å­˜è¡Œï¼ˆé€šå¸¸ä¸º64å­—èŠ‚ï¼‰å®šä¹‰äº†ä¸ªçŠ¶æ€ï¼šç‹¬å ï¼ˆexclusiveï¼‰ã€å…±äº«ï¼ˆshareï¼‰ã€ä¿®æ”¹ï¼ˆmodifiedï¼‰ã€å¤±æ•ˆï¼ˆinvalidï¼‰ï¼Œ<br>ç”¨æ¥æè¿°è¯¥ç¼“å­˜è¡Œæ˜¯å¦è¢«å¤šå¤„ç†å™¨å…±äº«ã€æ˜¯å¦ä¿®æ”¹ã€‚æ‰€ä»¥ç¼“å­˜ä¸€è‡´æ€§åè®®ä¹Ÿç§°MESIåè®®ã€‚</p>
</blockquote>
<ul>
<li>ç‹¬å ï¼ˆexclusiveï¼‰ï¼šä»…å½“å‰å¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰ä¿®æ”¹è¿‡ï¼Œæ˜¯æœ€æ–°çš„å€¼ã€‚</li>
<li>å…±äº«ï¼ˆshareï¼‰ï¼šæœ‰å¤šä¸ªå¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æ²¡æœ‰ä¿®æ”¹è¿‡ç¼“å­˜ï¼Œæ˜¯æœ€æ–°çš„å€¼ã€‚</li>
<li>ä¿®æ”¹ï¼ˆmodifiedï¼‰ï¼šä»…å½“å‰å¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œå¹¶ä¸”ç¼“å­˜è¡Œè¢«ä¿®æ”¹è¿‡äº†ï¼Œä¸€å®šæ—¶é—´å†…ä¼šå†™å›ä¸»å­˜ï¼Œä¼šå†™æˆåŠŸçŠ¶æ€ä¼šå˜ä¸ºSã€‚</li>
<li>å¤±æ•ˆï¼ˆinvalidï¼‰ï¼šç¼“å­˜è¡Œè¢«å…¶ä»–å¤„ç†å™¨ä¿®æ”¹è¿‡ï¼Œè¯¥å€¼ä¸æ˜¯æœ€æ–°çš„å€¼ï¼Œéœ€è¦è¯»å–ä¸»å­˜ä¸Šæœ€æ–°çš„å€¼ã€‚</li>
</ul>
<p>å¦‚ä½•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å‘¢ï¼Ÿ<br><img src="http://www.wowotech.net/content/uploadfile/201411/e35f2f4793d734a566d1d230d1b83b4620141114112002.gif">  </p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…±äº«å˜é‡æ˜¯å­˜å‚¨åœ¨ä¸»å†…å­˜Memoryä¸­ï¼Œåœ¨CPUè®¡ç®—æ—¶ï¼Œæ¯ä¸€ä¸ªCPUéƒ½æœ‰æ”¹å˜é‡çš„ç‹¬ç«‹æ‹·è´ï¼Œæ¯ä¸ªCPUå¯ä»¥å»è¯»å–ç”šè‡³ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œ<br>ä½†æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸€ä¸ªCPU modifyäº†å˜é‡çš„å€¼ï¼Œéœ€è¦é€šçŸ¥å…¶ä»–çš„CPUè¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼æ˜¯ä»€ä¹ˆã€‚é‚£ä¹ˆå¯ä»¥æ€ä¹ˆåšå‘¢ã€‚</p>
<ul>
<li><p>åœ¨åˆå§‹çŠ¶æ€ï¼Œæ¯ä¸ªCPUè¿˜æ²¡æœ‰åŠ è½½å…±äº«å˜é‡ï¼Œæ‰€æœ‰æ¯ä¸€ä¸ªCPUçš„ç¼“å­˜è¡Œçš„çŠ¶æ€éƒ½æ˜¯invalidï¼›  </p>
</li>
<li><p>å½“CPU0å»ä½¿ç”¨è¿™ä¸ªå…±äº«å˜é‡çš„æ—¶å€™ï¼Œé¦–å…ˆå»è‡ªå·±çš„ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œè‚¯å®šæ˜¯ç¼“å­˜ä¸å‘½ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯cache miss,è¿™ä¸ªæ—¶å€™å»ä¸»å†…å­˜Memoryä¸­å»åŠ è½½ï¼Œ<br>å½“å…±äº«å˜é‡çš„å€¼åŠ è½½åˆ°CPU0çš„ç¼“å­˜åï¼ŒCPUç¼“å­˜è¡ŒçŠ¶æ€å˜æˆshared,ä¹Ÿå°±æ˜¯å…±äº«çŠ¶æ€ï¼›  </p>
</li>
<li><p>å¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å…¶ä»–çš„CPUä¹Ÿè¯»å–äº†å…±äº«å˜é‡çš„å€¼ï¼Œå®ƒä»¬çš„cache line çš„çŠ¶æ€åŒæ ·ä¹Ÿæ˜¯sharedå…±äº«çŠ¶æ€ï¼›æ­¤æ—¶ä¸€ä¸ªCPUå¦‚æœä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œ<br>è€Œæ²¡æœ‰é€šçŸ¥å…¶ä»–çš„CPU,å°±ä¼šé€ æˆç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼›</p>
</li>
<li><p>å½“CPU0å°è¯•å»ä¿®æ”¹å…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ªread invalidateå‘½ä»¤ï¼ŒåŒæ—¶CPU0çš„ç¼“å­˜è¡ŒçŠ¶æ€è®¾ç½®ä¸ºexclusive(ç‹¬å ),<br>åŒæ—¶å°†å…¶ä»–åŠ è½½äº†è¿™ä¸ªå…±äº«å˜é‡çš„cachelineçš„çŠ¶æ€è®¾ç½®ä¸ºinvalidã€‚é€šä¿—ä¸€ç‚¹å°±æ˜¯CPU0ç‹¬å çš„è¿™ä¸ªå˜é‡çš„ç¼“å­˜è¡Œï¼Œå…¶ä»–çš„CPUç¼“å­˜çš„å…±äº«å˜é‡éƒ½å¤±æ•ˆäº†ï¼› </p>
</li>
<li><p>CPU0æ¥ä¸‹æ¥ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå®ƒä¼šå°†cachelineçš„çŠ¶æ€ä¿®æ”¹ä¸ºmodified,å…¶å®ä¹Ÿæ˜¯ç‹¬å å…±äº«å˜é‡çš„cachelineï¼Œ<br>åªä¸è¿‡æ˜¯æ­¤æ—¶ç¼“å­˜è¡Œçš„æ•°æ®å’Œä¸»å†…å­˜Memoryçš„æ•°æ®ä¸ä¸€è‡´çš„ï¼Œè€Œexclusiveè™½ç„¶ä¹Ÿæ˜¯ç‹¬å çŠ¶æ€ï¼Œä½†æ˜¯å…±äº«å˜é‡çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œ<br>modifiedçš„å€¼éœ€è¦write backåˆ°Memoryä¸­å»çš„ï¼Œè€Œexclusiveæ˜¯ä¸éœ€è¦çš„ï¼› </p>
</li>
<li><p>åœ¨cachelineæ²¡æœ‰æ›¿æ¢å‡ºCPU0çš„cacheä¹‹å‰ï¼Œå½“æœ‰å…¶ä»–CPUæ¥è¯»å–å…±äº«å˜é‡ï¼Œæ­¤æ—¶è‚¯å®šæ˜¯cache miss ,å› ä¸ºCPU0çš„modifyæ“ä½œå·²ç»å°†å®ƒçš„ç¼“å­˜å¤±æ•ˆäº†ã€‚<br>å¦‚æœCPU0çš„çŠ¶æ€æ˜¯modifiedçŠ¶æ€ï¼Œå®ƒå¿…é¡»å“åº”å…¶ä»–CPUçš„è¯»æ“ä½œï¼Œä¼šå‘ŠçŸ¥å…¶ä»–CPUä¸»å†…å­˜çš„æ•°æ®æ˜¯dirty dataã€‚æ‰€ä»¥å…¶ä»–çš„CPUçš„çŠ¶æ€å¯èƒ½ä¼šå˜æˆsharedã€‚<br>å¦‚æœCPU0è¿˜æ²¡æœ‰write backæ“ä½œï¼Œå…¶ä»–çš„CPUçŠ¶æ€è¿˜æ˜¯invalidçŠ¶æ€ã€‚</p>
</li>
</ul>
<h3 id="Store-Buffer"><a href="#Store-Buffer" class="headerlink" title="Store Buffer"></a>Store Buffer</h3><p>æ­£å¦‚ä¸Šé¢æ‰€æè¿°çš„ï¼Œåœ¨CPU0è¿›è¡Œå…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œä¼šåŒæ­¥ä¿®æ”¹å…¶ä»–CPUçš„cachelineçŠ¶æ€ä¸ºinvalidï¼Œè¿™ä¸ªæ“ä½œæ˜¯å’Œå…±äº«å˜é‡çš„å†™æ“ä½œåŒæ­¥è¿›è¡Œçš„ï¼Œå› æ­¤å…±äº«å˜é‡çš„å†™æ“ä½œçš„æ€§èƒ½æ˜¯éå¸¸å·®çš„ã€‚åœ¨ä¿®æ”¹å…¶ä»–çš„CPU cachelineçŠ¶æ€æ—¶ï¼ŒCPU0å…¶å®æ˜¯å¤„äºé˜»å¡çŠ¶æ€çš„ã€‚æ‰€ä»¥ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†Store Bufferçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="http://www.wowotech.net/content/uploadfile/201411/a872a1863fec02585bb786a5c382d3eb20141114112005.gif"></p>
<p>è¿™æ ·çš„è¯ï¼Œå†™æ“ä½œä¸å¿…ç­‰åˆ°cachelineè¢«åŠ è½½ï¼Œè€Œæ˜¯ç›´æ¥å†™åˆ°store bufferä¸­ï¼Œç„¶åå»æ‰§è¡Œåç»­çš„æ“ä½œã€‚ç”±äºæ˜¯store bufferç›¸å½“äºæ˜¯å¼‚æ­¥å¤„ç†ï¼Œ<br>åœ¨è¿™é‡Œå¯èƒ½ä¼šå‡ºç°å› ä¸ºå¹¶å‘æ‰§è¡Œå¯¼è‡´çš„æ‰§è¡Œæ‰§è¡Œäº¤å‰é—®é¢˜ï¼Œå…·ä½“è§£å†³æ–¹æ³•æ˜¯ä¾èµ–äºå†…å­˜å±éšœã€‚<br>å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.wowotech.net/kernel_synchronization/memory-barrier.html">Linuxå†…æ ¸åŒæ­¥æœºåˆ¶ä¹‹ï¼ˆä¸‰ï¼‰ï¼šmemory barrier</a>  </p>
<h3 id="Invalidate-Queue"><a href="#Invalidate-Queue" class="headerlink" title="Invalidate Queue"></a>Invalidate Queue</h3><p>å¤„ç†å¤±æ•ˆçš„ç¼“å­˜ä¹Ÿä¸æ˜¯ç®€å•çš„ï¼Œéœ€è¦è¯»å–ä¸»å­˜ã€‚å¹¶ä¸”å­˜å‚¨ç¼“å­˜ä¹Ÿä¸æ˜¯æ— é™å¤§çš„ï¼Œé‚£ä¹ˆå½“å­˜å‚¨ç¼“å­˜æ»¡çš„æ—¶å€™ï¼Œå¤„ç†å™¨è¿˜æ˜¯è¦ç­‰å¾…å¤±æ•ˆå“åº”çš„ã€‚<br>ä¸ºäº†è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œå¼•è¿›äº†å¤±æ•ˆé˜Ÿåˆ—ï¼ˆinvalidate queueï¼‰ã€‚å¤„ç†å¤±æ•ˆçš„å·¥ä½œå¦‚ä¸‹ï¼š</p>
<p><img src="http://www.wowotech.net/content/uploadfile/201411/46e1bbd0ba094941caf23050e1db2d2d20141114112008.gif"></p>
<ul>
<li>æ”¶åˆ°å¤±æ•ˆæ¶ˆæ¯æ—¶ï¼Œæ”¾åˆ°å¤±æ•ˆé˜Ÿåˆ—ä¸­å»ã€‚</li>
<li>ä¸ºäº†ä¸è®©å¤„ç†å™¨ä¹…ç­‰å¤±æ•ˆå“åº”ï¼Œæ”¶åˆ°å¤±æ•ˆæ¶ˆæ¯éœ€è¦é©¬ä¸Šå›å¤å¤±æ•ˆå“åº”ã€‚</li>
<li>ä¸ºäº†ä¸é¢‘ç¹é˜»å¡å¤„ç†å™¨ï¼Œä¸ä¼šé©¬ä¸Šè¯»ä¸»å­˜ä»¥åŠè®¾ç½®ç¼“å­˜ä¸ºinvlidï¼Œåˆé€‚çš„æ—¶å€™å†ä¸€å—å¤„ç†å¤±æ•ˆé˜Ÿåˆ—ã€‚</li>
</ul>
<h2 id="happens-beforeåŸåˆ™"><a href="#happens-beforeåŸåˆ™" class="headerlink" title="happens- beforeåŸåˆ™"></a>happens- beforeåŸåˆ™</h2><blockquote>
<p>è™½ç„¶æŒ‡ä»¤é‡æ’æé«˜äº†å¹¶å‘çš„æ€§èƒ½ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤é‡æ’åšå‡ºä¸€äº›è§„åˆ™é™åˆ¶ï¼Œå¹¶ä¸èƒ½è®©æ‰€æœ‰çš„æŒ‡ä»¤éƒ½éšæ„çš„æ”¹å˜æ‰§è¡Œä½ç½®ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š    </p>
</blockquote>
<p>1ã€å•çº¿ç¨‹æ¯ä¸ªæ“ä½œï¼Œhappen-beforeäºè¯¥çº¿ç¨‹ä¸­ä»»æ„åç»­æ“ä½œï¼›<br>2ã€volatileå†™happen-beforeä¸åç»­å¯¹è¿™ä¸ªå˜é‡çš„è¯»ï¼›<br>3ã€synchronizedè§£é”happen-beforeåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”ï¼›<br>4ã€finalå˜é‡çš„å†™happen-beforeäºfinalåŸŸå¯¹è±¡çš„è¯»ï¼Œhappen-beforeåç»­å¯¹finalå˜é‡çš„è¯»ï¼›<br>5ã€ä¼ é€’æ€§è§„åˆ™ï¼ŒAå…ˆäºBï¼ŒBå…ˆäºCï¼Œé‚£ä¹ˆAä¸€å®šå…ˆäºCå‘ç”Ÿï¼›  </p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåå°„</title>
    <url>/wiki/Java%E5%8F%8D%E5%B0%84/</url>
    <content><![CDATA[<h2 id="Javaåå°„"><a href="#Javaåå°„" class="headerlink" title="Javaåå°„"></a>Javaåå°„</h2><blockquote>
<p>åå‘æ¢çŸ¥ï¼Œåœ¨ç¨‹åºè¿è¡Œæ˜¯åŠ¨æ€çš„è·å–ç±»çš„ç›¸å…³å±æ€§<br>è¿™ç§åŠ¨æ€è·å–ç±»çš„å†…å®¹ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•å’Œè·å–å±æ€§çš„æœºåˆ¶ï¼Œå«åšjavaåå°„æœºåˆ¶ï¼›</p>
</blockquote>
<h3 id="åå°„çš„ä¼˜ç¼ºç‚¹"><a href="#åå°„çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="åå°„çš„ä¼˜ç¼ºç‚¹"></a>åå°„çš„ä¼˜ç¼ºç‚¹</h3><blockquote>
<p>ä¼˜ç‚¹<br>å¢åŠ äº†ç¨‹åºçš„çµæ´»æ€§ï¼Œé¿å…çš„å›ºæœ‰é€»è¾‘å†™æ­»åˆ°ç¨‹åºä¸­<br>ä»£ç ç®€ä»‹ï¼Œæé«˜ç¨‹åºçš„å¤ç”¨æ€§</p>
</blockquote>
<blockquote>
<p>ç¼ºç‚¹<br>ç›¸æ¯”äºç›´æ¥è°ƒç”¨ï¼Œåå°„æœ‰æ¯”è¾ƒå¤§çš„æ€§èƒ½æ¶ˆè€—<br>å†…éƒ¨æš´éœ²å’Œå®‰å…¨éšæ‚£  ï¼ˆå› ä¸ºåå°„å¯ä»¥æ“ä½œprivateæˆå‘˜å˜é‡å’Œè°ƒç”¨privateæˆå‘˜æ–¹æ³•ï¼‰</p>
</blockquote>
<h3 id="åå°„çš„åŸºæœ¬æ“ä½œ"><a href="#åå°„çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="åå°„çš„åŸºæœ¬æ“ä½œ"></a>åå°„çš„åŸºæœ¬æ“ä½œ</h3><h4 id="è·å–ç±»å¯¹è±¡çš„4ç§æ–¹å¼"><a href="#è·å–ç±»å¯¹è±¡çš„4ç§æ–¹å¼" class="headerlink" title="è·å–ç±»å¯¹è±¡çš„4ç§æ–¹å¼"></a>è·å–ç±»å¯¹è±¡çš„4ç§æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è°ƒç”¨forNameæ–¹æ³•å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹å¼</span><br><span class="line">Class&lt;?&gt; object = Class.forName(&quot;com.ibli.javaBase.reflection.User&quot;);</span><br><span class="line"></span><br><span class="line">// é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨getClassæ–¹æ³•</span><br><span class="line">Teacher teacher = new Teacher();</span><br><span class="line">Class&lt;?&gt; objectT = teacher.getClass();</span><br><span class="line"></span><br><span class="line">// é€šè¿‡ç±»åŠ è½½å™¨çš„æ–¹å¼</span><br><span class="line">Class&lt;?&gt; loader = ClassLoader.getSystemClassLoader().loadClass(&quot;com.ibli.javaBase.reflection.User&quot;);</span><br><span class="line"></span><br><span class="line">//é€šè¿‡ä¸€ä¸ªç±».class</span><br><span class="line">Class&lt;?&gt; tt = Teacher.class;</span><br></pre></td></tr></table></figure>

<h4 id="åŸºæœ¬ä¿¡æ¯æ“ä½œ"><a href="#åŸºæœ¬ä¿¡æ¯æ“ä½œ" class="headerlink" title="åŸºæœ¬ä¿¡æ¯æ“ä½œ"></a>åŸºæœ¬ä¿¡æ¯æ“ä½œ</h4><table>
<thead>
<tr>
<th align="center">ç±»ä¿®é¥°ç¬¦</th>
<th align="center">PUBLIC</th>
<th align="center">PRIVATE</th>
<th align="center">PROTECTED</th>
<th align="center">STATIC</th>
<th align="center">FINAL</th>
<th align="center">SYNCHRONIZED</th>
<th align="center">VOLATILE</th>
<th align="center">TRANSIENT</th>
<th align="center">NATIVE</th>
<th align="center">INTERFACE</th>
<th align="center">ABSTRACT</th>
</tr>
</thead>
<tbody><tr>
<td align="center">modifiers</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">16</td>
<td align="center">32</td>
<td align="center">64</td>
<td align="center">128</td>
<td align="center">256</td>
<td align="center">512</td>
<td align="center">1024</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ç±»çš„ä¿®é¥°ç¬¦ å…·ä½“çš„å€¼å¯ä»¥å‚è€ƒJDK APIæ–‡æ¡£ä¸­çš„å®šä¹‰ è¿”å›å€¼æ˜¯intç±»å‹  publicï¼š1</span><br><span class="line">System.err.println(tt.getModifiers());</span><br><span class="line">// åŒ…å</span><br><span class="line">System.err.println(tt.getPackage());</span><br><span class="line">// ç±»çš„åç§°</span><br><span class="line">System.err.println(tt.getName());</span><br><span class="line">// çˆ¶ç±»</span><br><span class="line">System.err.println(tt.getSuperclass());</span><br><span class="line">// ç±»åŠ è½½å™¨</span><br><span class="line">System.err.println(tt.getClassLoader());</span><br><span class="line">// ç®€ç§°</span><br><span class="line">System.err.println(tt.getSimpleName());</span><br><span class="line">// ç±»å®ç°çš„æ‰€æœ‰çš„æ¥å£</span><br><span class="line">System.err.println(tt.getInterfaces().length);</span><br><span class="line">// æ‰€æœ‰çš„æ³¨è§£ç±»å‹</span><br><span class="line">System.err.println(tt.getAnnotations().length);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">package com.ibli.javaBase.reflection</span><br><span class="line">com.ibli.javaBase.reflection.Teacher</span><br><span class="line">class java.lang.Object</span><br><span class="line">sun.misc.Launcher$AppClassLoader@18b4aac2</span><br><span class="line">Teacher</span><br><span class="line">0</span><br><span class="line">0</span><br></pre></td></tr></table></figure>


<h4 id="æŸ¥çœ‹ç±»çš„å˜é‡"><a href="#æŸ¥çœ‹ç±»çš„å˜é‡" class="headerlink" title="æŸ¥çœ‹ç±»çš„å˜é‡"></a>æŸ¥çœ‹ç±»çš„å˜é‡</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// User extend Person(aa,bb)</span><br><span class="line">Class&lt;User&gt; obj = User.class;</span><br><span class="line">User user = obj.newInstance();</span><br><span class="line">// èƒ½å¤Ÿæ‹¿åˆ°ç±»çš„æ‰€æœ‰çš„å˜é‡</span><br><span class="line">Field[] fields = obj.getDeclaredFields();</span><br><span class="line">for (Field field : fields)&#123;</span><br><span class="line">    System.out.println(field.getModifiers() + &quot; &quot; + field.getName());</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(&quot;    &quot;);</span><br><span class="line"></span><br><span class="line">// åªèƒ½å¤Ÿæ‹¿åˆ°ç±»çš„publicçš„å˜é‡</span><br><span class="line">Field[] fields1 = obj.getFields();</span><br><span class="line">for (Field field : fields1)&#123;</span><br><span class="line">    System.out.println(field.getModifiers() + &quot; &quot; + field.getName());</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(&quot;     &quot;);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2 age</span><br><span class="line">2 name</span><br><span class="line">1 sex</span><br><span class="line">10 height</span><br><span class="line">    </span><br><span class="line">1 sex</span><br><span class="line">1 aa</span><br><span class="line">1 bb</span><br></pre></td></tr></table></figure>
<p>ç»“è®ºï¼š  </p>
<ul>
<li>getDeclaredFields<br>ï¼ˆ1ï¼‰getDeclaredFieldsèƒ½å¤Ÿè·å–æœ¬ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œæ— è®ºæ˜¯publicè¿˜æ˜¯private;<br>ï¼ˆ2ï¼‰ä½†æ˜¯ä¸èƒ½è·å–çˆ¶ç±»çš„ä»»ä½•å±æ€§ï¼›<br>ï¼ˆ3ï¼‰å¯ä»¥è·å–staticç±»å‹çš„å±æ€§ï¼›</li>
<li>getFields<br>ï¼ˆ1ï¼‰åªèƒ½å¤Ÿè·å–æœ¬ç±»çš„publicå±æ€§ï¼›<br>ï¼ˆ2ï¼‰èƒ½å¤Ÿè·å–çˆ¶ç±»çš„publicå±æ€§ï¼›<br>ï¼ˆ3ï¼‰å¯ä»¥è·å–staticç±»å‹çš„å±æ€§ï¼›  </li>
</ul>
<h4 id="ä¿®æ”¹å±æ€§"><a href="#ä¿®æ”¹å±æ€§" class="headerlink" title="ä¿®æ”¹å±æ€§"></a>ä¿®æ”¹å±æ€§</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è®¾ç½®Personä¸­çš„å˜é‡aa</span><br><span class="line">Field aaField = obj.getField(&quot;aa&quot;);</span><br><span class="line">aaField.setInt(user,111);</span><br><span class="line">System.err.println(user.getAa());</span><br><span class="line"></span><br><span class="line">// è®¾ç½®Userç§æœ‰æˆå‘˜å˜é‡</span><br><span class="line">Field ageField = obj.getDeclaredField(&quot;age&quot;);</span><br><span class="line">// è®¾ç½®è®¿é—®æƒé™</span><br><span class="line">ageField.setAccessible(true);</span><br><span class="line">ageField.set(user,333);</span><br><span class="line">System.err.println(user.getAge());</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">111</span><br><span class="line">333</span><br></pre></td></tr></table></figure>


<h4 id="æŸ¥çœ‹æ–¹æ³•"><a href="#æŸ¥çœ‹æ–¹æ³•" class="headerlink" title="æŸ¥çœ‹æ–¹æ³•"></a>æŸ¥çœ‹æ–¹æ³•</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Class&lt;User&gt; obj = User.class;</span><br><span class="line">User user = obj.newInstance();</span><br><span class="line"></span><br><span class="line">// å¯ä»¥è·å–çˆ¶ç±»çš„æ–¹æ³•</span><br><span class="line">Method[] methods = obj.getMethods();</span><br><span class="line">for (Method method : methods) &#123;</span><br><span class="line">    System.out.println(method.getModifiers() + &quot;  &quot; + method.getName());</span><br><span class="line">&#125;</span><br><span class="line">System.err.println(&quot; -----  &quot;);</span><br><span class="line"></span><br><span class="line">// è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•</span><br><span class="line">Method[] methods1 = obj.getDeclaredMethods();</span><br><span class="line">for (Method method : methods1) &#123;</span><br><span class="line">    System.out.println(method.getModifiers() + &quot;  &quot; + method.getName());</span><br><span class="line">&#125;</span><br><span class="line">System.err.println(&quot; ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ &quot;);</span><br><span class="line">// æ‰§è¡Œç»“æœå°±ä¸å±•ç¤ºäº†</span><br></pre></td></tr></table></figure>
<p>ç»“è®ºï¼š</p>
<ul>
<li>getDeclaredMethods<br>ï¼ˆ1ï¼‰å¯ä»¥è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼›<br>ï¼ˆ2ï¼‰å¯ä»¥è·å–æœ¬ç±»çš„é™æ€æ–¹æ³•</li>
<li>getMethods<br>ï¼ˆ1ï¼‰å¯ä»¥è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰==å…¬æœ‰==æ–¹æ³•ï¼›<br>ï¼ˆ2ï¼‰å¯ä»¥è·å–çˆ¶ç±»ä¸­çš„æ‰€æœ‰==å…¬æœ‰==æ–¹æ³•ï¼›<br>ï¼ˆ3ï¼‰å¯ä»¥è·å–æœ¬ç±»å’Œçˆ¶ç±»çš„å…¬æœ‰é™æ€æ–¹æ³•ï¼›</li>
</ul>
<h4 id="è°ƒç”¨æ–¹æ³•"><a href="#è°ƒç”¨æ–¹æ³•" class="headerlink" title="è°ƒç”¨æ–¹æ³•"></a>è°ƒç”¨æ–¹æ³•</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// è®¿é—®ç§æœ‰æ–¹æ³•</span><br><span class="line">Method sleep = obj.getDeclaredMethod(&quot;sleep&quot;);</span><br><span class="line">sleep.setAccessible(true);</span><br><span class="line">sleep.invoke(user);</span><br><span class="line"></span><br><span class="line">// å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼Œinvokeç¬¬ä¸€ä¸ªå‚æ•°ä¼ nullå³å¯</span><br><span class="line">Method say = obj.getDeclaredMethod(&quot;say&quot;,String.class);</span><br><span class="line">say.setAccessible(true);</span><br><span class="line">say.invoke(null,&quot;hello java&quot;);</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Im sleeping!</span><br><span class="line">say hello java</span><br></pre></td></tr></table></figure>


<h4 id="æ„é€ å™¨çš„ä½¿ç”¨"><a href="#æ„é€ å™¨çš„ä½¿ç”¨" class="headerlink" title="æ„é€ å™¨çš„ä½¿ç”¨"></a>æ„é€ å™¨çš„ä½¿ç”¨</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Class&lt;User&gt; obj = User.class;</span><br><span class="line">// æŸ¥è¯¢å…±æœ‰çš„æ„é€ å™¨</span><br><span class="line">Constructor&lt;?&gt;[] constructors = obj.getConstructors();</span><br><span class="line">for (Constructor&lt;?&gt; constructor : constructors)&#123;</span><br><span class="line">    System.out.println(constructor.getModifiers() + &quot;   &quot; + constructor.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯ä»¥è·å–ç§æœ‰çš„æ„é€ å™¨</span><br><span class="line">Constructor&lt;?&gt;[] constructors1 = obj.getDeclaredConstructors();</span><br><span class="line">for (Constructor&lt;?&gt; constructor : constructors1)&#123;</span><br><span class="line">    System.err.println(constructor.getModifiers() + &quot;   &quot; + constructor.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1   com.ibli.javaBase.reflection.User</span><br><span class="line">1   com.ibli.javaBase.reflection.User</span><br><span class="line"></span><br><span class="line">1   com.ibli.javaBase.reflection.User</span><br><span class="line">2   com.ibli.javaBase.reflection.User</span><br><span class="line">1   com.ibli.javaBase.reflection.User</span><br></pre></td></tr></table></figure>

<p>ç»“è®ºï¼š</p>
<ul>
<li>getConstructors<br>ï¼ˆ1ï¼‰è·å¾—æœ¬ç±»æ‰€æœ‰çš„å…¬æœ‰æ„é€ å™¨  </li>
<li>getDeclaredConstructors<br>ï¼ˆ1ï¼‰è·å¾—æœ¬ç±»æ‰€æœ‰çš„æ„é€ å™¨ï¼ˆpublic&amp;privateï¼‰  </li>
</ul>
<h4 id="å®ä¾‹åŒ–å¯¹è±¡"><a href="#å®ä¾‹åŒ–å¯¹è±¡" class="headerlink" title="å®ä¾‹åŒ–å¯¹è±¡"></a>å®ä¾‹åŒ–å¯¹è±¡</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ä½¿ç”¨newInstanceåˆ›å»ºå¯¹è±¡ è°ƒç”¨æ— å‚æ„é€ å™¨</span><br><span class="line">User user = obj.newInstance();</span><br><span class="line">// è·å–æ„é€ å™¨æ¥å®ä¾‹åŒ–å¯¹è±¡</span><br><span class="line">Constructor&lt;User&gt; constructor = obj.getDeclaredConstructor(Integer.class, String.class);</span><br><span class="line">constructor.setAccessible(true);</span><br><span class="line">User temp = constructor.newInstance(22, &quot;java&quot;);</span><br><span class="line">System.err.println(temp.getAge() + &quot; &quot; + temp.getName());</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<blockquote>
<p>22 java</p>
</blockquote>
<h3 id="åå°„æ€§èƒ½ä¸ºä»€ä¹ˆå·®"><a href="#åå°„æ€§èƒ½ä¸ºä»€ä¹ˆå·®" class="headerlink" title="åå°„æ€§èƒ½ä¸ºä»€ä¹ˆå·®"></a>åå°„æ€§èƒ½ä¸ºä»€ä¹ˆå·®</h3><blockquote>
<p>å¯ä»¥ä»ä¸¤æ–¹é¢è€ƒè™‘ï¼Œç¬¬ä¸€ä¸ªæ˜¯åå°„ç”ŸæˆClasså¯¹è±¡æ—¶æ€§èƒ½å·®ï¼Œç¬¬äºŒæ˜¯é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡æ–¹å¼æ˜¯çš„æ€§èƒ½å·®ï¼›</p>
</blockquote>
<p>ï¼ˆ1ï¼‰ è°ƒç”¨forName æœ¬åœ°æ–¹æ³•<br>ï¼ˆ2ï¼‰æ¯æ¬¡newInstance éƒ½ä¼šè¿›è¡Œä¸€æ¬¡å®‰å…¨æ£€æŸ¥<br>ï¼ˆ3ï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–¹æ³•çš„åå°„è°ƒç”¨ä¸ºå§”æ´¾å®ç°ï¼Œå§”æ´¾ç»™æœ¬åœ°å®ç°æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚åœ¨è°ƒç”¨è¶…è¿‡ 15æ¬¡ä¹‹åï¼Œå§”æ´¾å®ç°ä¾¿ä¼šå°†å§”æ´¾å¯¹è±¡åˆ‡æ¢è‡³åŠ¨æ€å®ç°ã€‚è¿™ä¸ªåŠ¨æ€å®ç°çš„å­—èŠ‚ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒå°†ç›´æ¥ä½¿ç”¨ invoke æŒ‡ä»¤æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚</p>
<p>æ–¹æ³•çš„åå°„è°ƒç”¨ä¼šå¸¦æ¥ä¸å°‘æ€§èƒ½å¼€é”€ï¼ŒåŸå› ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>å˜é•¿å‚æ•°æ–¹æ³•å¯¼è‡´çš„Objectæ•°ç»„   </li>
<li>åŸºæœ¬ç±»å‹çš„è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±  (å‚è€ƒèµ„æ–™2)</li>
<li>è¿˜æœ‰æœ€é‡è¦çš„æ–¹æ³•å†…è”ã€‚</li>
</ul>
<blockquote>
<p>å‚è€ƒèµ„æ–™<br>(1)<a href="https://blog.csdn.net/xqlovetyj/article/details/82798864">åå°„ä¸ºä»€ä¹ˆæ…¢</a><br>(2)<a href="https://blog.csdn.net/Admin_Jhon/article/details/52873468?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.add_param_isCf&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.add_param_isCf">å…³äºè£…ç®±æ‹†ç®±ä¸ºä»€ä¹ˆä¼šå½±å“æ•ˆç‡</a><br>(3)<a href="https://zhuanlan.zhihu.com/p/55630861">jvmä¹‹æ–¹æ³•å†…è”ä¼˜åŒ–</a></p>
</blockquote>
<h3 id="åå°„ä½¿ç”¨çš„åœºæ™¯"><a href="#åå°„ä½¿ç”¨çš„åœºæ™¯" class="headerlink" title="åå°„ä½¿ç”¨çš„åœºæ™¯"></a>åå°„ä½¿ç”¨çš„åœºæ™¯</h3><ul>
<li>JDBCå°è£…    </li>
<li>Spring IOC</li>
<li>jdbcTemplate</li>
<li>Mybatisä½¿ç”¨å¤§é‡åå°„</li>
</ul>
<h3 id="ä½¿ç”¨åå°„æ³¨æ„ç‚¹"><a href="#ä½¿ç”¨åå°„æ³¨æ„ç‚¹" class="headerlink" title="ä½¿ç”¨åå°„æ³¨æ„ç‚¹"></a>ä½¿ç”¨åå°„æ³¨æ„ç‚¹</h3><ul>
<li>åœ¨è·å–Field,method,construtorçš„æ—¶å€™ï¼Œåº”å°½é‡é¿å…æ˜¯ç”¨getDelcaredXXX(),åº”è¯¥ä¼ è¿›å‚æ•°è·å–æŒ‡å®šçš„å­—æ®µï¼Œæ–¹æ³•å’Œæ„é€ å™¨ï¼›</li>
<li>ä½¿ç”¨ç¼“å­˜æœºåˆ¶ç¼“å­˜åå°„æ“ä½œç›¸å…³å…ƒæ•°æ®çš„åŸå› æ˜¯å› ä¸ºåå°„æ“ä½œç›¸å…³å…ƒæ•°æ®çš„å®æ—¶è·å–æ˜¯æ¯”è¾ƒè€—æ—¶çš„</li>
</ul>
<blockquote>
<p align="middle"> ---------------------   å‰é€”æµ©æµ©è¡è¡ ä¸‡äº‹å°½å¯æœŸå¾…ã€‚-----------------------  </p>
</blockquote>
<h3 id="åå°„åœ¨IOCä¸­çš„åº”ç”¨"><a href="#åå°„åœ¨IOCä¸­çš„åº”ç”¨" class="headerlink" title="åå°„åœ¨IOCä¸­çš„åº”ç”¨"></a>åå°„åœ¨IOCä¸­çš„åº”ç”¨</h3>]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¤šçº¿ç¨‹ä¹‹ThreadLocal</title>
    <url>/wiki/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B9%8BThreadLocal/</url>
    <content><![CDATA[<h2 id="ThreadLocalMapç»“æ„"><a href="#ThreadLocalMapç»“æ„" class="headerlink" title="ThreadLocalMapç»“æ„"></a>ThreadLocalMapç»“æ„</h2><img src='https://user-gold-cdn.xitu.io/2020/7/26/1738b45487065b90?imageView2/0/w/1280/h/960/ignore-error/1'>




<h2 id="ThreadLocal-setæµç¨‹"><a href="#ThreadLocal-setæµç¨‹" class="headerlink" title="ThreadLocal setæµç¨‹"></a>ThreadLocal setæµç¨‹</h2><img src='https://user-gold-cdn.xitu.io/2020/7/26/1738b454879fe57d?imageView2/0/w/1280/h/960/ignore-error/1'>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://juejin.cn/post/6854573219916021767">Javaé¢è¯•å¿…é—®ï¼šThreadLocalç»ˆæç¯‡ </a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹-å¤šçº¿ç¨‹çš„å‘å±•å’Œæ„ä¹‰</title>
    <url>/wiki/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8F%91%E5%B1%95%E5%92%8C%E6%84%8F%E4%B9%89/</url>
    <content><![CDATA[<h1 id="çº¿ç¨‹åŸºç¡€æ¦‚å¿µ"><a href="#çº¿ç¨‹åŸºç¡€æ¦‚å¿µ" class="headerlink" title="çº¿ç¨‹åŸºç¡€æ¦‚å¿µ"></a>çº¿ç¨‹åŸºç¡€æ¦‚å¿µ</h1><h2 id="ä»€ä¹ˆæ˜¯çº¿ç¨‹"><a href="#ä»€ä¹ˆæ˜¯çº¿ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯çº¿ç¨‹"></a>ä»€ä¹ˆæ˜¯çº¿ç¨‹</h2><p>çº¿ç¨‹æ˜¯CPUæ‰§è¡Œä»»åŠ¡çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç‹¬ç«‹å†…å­˜ï¼Œæ˜¯çº¿ç¨‹ä¸å…±äº«çš„ã€‚</p>
<h2 id="å¹¶è¡Œä¸å¹¶å‘"><a href="#å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="å¹¶è¡Œä¸å¹¶å‘"></a>å¹¶è¡Œä¸å¹¶å‘</h2><ul>
<li>å¹¶è¡Œ<br> åŒä¸€æ—¶åˆ»ï¼Œæ¨ªå‘æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œ</li>
<li>å¹¶å‘<br> ç³»ç»Ÿå’ŒæœåŠ¡å™¨åŒä¸€æ—¶åˆ»èƒ½å¤Ÿæ‰¿å—çš„å¹¶å‘çº¿ç¨‹</li>
</ul>
<h2 id="çº¿ç¨‹çš„ç‰¹å¾"><a href="#çº¿ç¨‹çš„ç‰¹å¾" class="headerlink" title="çº¿ç¨‹çš„ç‰¹å¾"></a>çº¿ç¨‹çš„ç‰¹å¾</h2><ul>
<li>å¼‚æ­¥ï¼ˆä¸éœ€è¦ç­‰å¾…ï¼‰<br> æ¯”å¦‚è¯´æ³¨å†Œä¹‹åå‘é€éªŒè¯ç ï¼ŒéªŒè¯ç çš„è¿‡ç¨‹å¯ä»¥å¼‚æ­¥å»åšä¸éœ€è¦å®¢æˆ·å»åœ¨æ³¨å†Œæ¥å£ç­‰å¾…è¿™ä¸ªæ—¶é—´ï¼›</li>
<li>å¹¶è¡Œï¼ˆCPUæ ¸æ•°ï¼‰   </li>
</ul>
<h2 id="Javaä¸­çº¿ç¨‹çš„ä½¿ç”¨"><a href="#Javaä¸­çº¿ç¨‹çš„ä½¿ç”¨" class="headerlink" title="Javaä¸­çº¿ç¨‹çš„ä½¿ç”¨"></a>Javaä¸­çº¿ç¨‹çš„ä½¿ç”¨</h2><ul>
<li>ç»§æ‰¿Thread</li>
<li>å®ç°Runnalbe</li>
<li>å®ç°Callable/Future</li>
</ul>
<h2 id="çº¿ç¨‹åŸç†"><a href="#çº¿ç¨‹åŸç†" class="headerlink" title="çº¿ç¨‹åŸç†"></a>çº¿ç¨‹åŸç†</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> <span class="title">extend</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">      b = a + <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œstartæ–¹æ³•ï¼Œå…¶å®æ˜¯è°ƒç”¨JVMç›¸å…³çš„æŒ‡ä»¤ï¼Œ thread.cpp</p>
<blockquote>
<p>java thread.start() -&gt; cpp thread.start() -&gt; osæŒ‡ä»¤:create.thread    start.thread<br>æ“ä½œç³»ç»Ÿå±‚é¢ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œçº¿ç¨‹åˆ›å»ºä¹‹åï¼Œçº¿ç¨‹å¯ä»¥å¯åŠ¨ï¼Œï¼ˆçº¿ç¨‹å¯åŠ¨ä¹‹åå¹¶ä¸ä¸€å®šé©¬ä¸Šæ‰§è¡Œï¼‰è¿™äº›çº¿ç¨‹ç»Ÿä¸€æœ‰CPUè°ƒåº¦ç®—æ³•æ¥å¤„ç†ï¼›å†³å®šé‚£ä¸ªçº¿ç¨‹åˆ†é…ç»™é‚£ä¸ªæ‰§è¡ŒCPUï¼›<br>CPUæ‰§è¡Œçº¿ç¨‹ä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨runæ–¹æ³• -&gt; cpp runæ–¹æ³•  -&gt; java  thread.run()</p>
</blockquote>
<img src='https://oscimg.oschina.net/oscnet/up-9147a0440e839bc9946fc87147e97b7c793.png' whith=600 height=380>

<p>âš ï¸ CompletableFuture å¼‚æ­¥å›è°ƒé€šçŸ¥ï¼ŒåŸºäºFutureçš„ä¼˜åŒ– </p>
<h1 id="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>çº¿ç¨‹åˆ›å»ºï¼Œå½“çº¿ç¨‹ä¸­çš„æŒ‡ä»¤æ‰§è¡Œå®Œæˆä¹‹åï¼Œrunï¼ˆï¼‰ç»“æŸ çº¿ç¨‹é”€æ¯<br>å…¶ä»–çº¿ç¨‹çŠ¶æ€</p>
<ul>
<li>ç­‰å¾…çŠ¶æ€ ï¼ˆsleep join waitï¼‰</li>
<li>é”é˜»å¡çŠ¶æ€ ï¼ˆblocked ç«äº‰é”å¤±è´¥ parkï¼‰</li>
</ul>
<img src="https://oscimg.oschina.net/oscnet/up-dc87c94066283689df31680050c67edd7b1.png" width=500 height=450>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadStatusDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;time waitting&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (ThreadStatusDemo.class)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ThreadStatusDemo.class.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;waitting&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> BlockDemo(),<span class="string">&quot;block demo 1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> BlockDemo(),<span class="string">&quot;block demo 2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockDemo</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (BlockDemo.class)&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        TimeUnit.SECONDS.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jps -l</span><br><span class="line">jstack pid</span><br></pre></td></tr></table></figure>

<h2 id="çº¿ç¨‹å¦‚ä½•åœæ­¢"><a href="#çº¿ç¨‹å¦‚ä½•åœæ­¢" class="headerlink" title="çº¿ç¨‹å¦‚ä½•åœæ­¢"></a>çº¿ç¨‹å¦‚ä½•åœæ­¢</h2><p>interrupt() åœæ­¢çº¿ç¨‹<br>ä¸»åŠ¨åœæ­¢æ–¹å¼ -&gt; runæ–¹æ³•æ‰§è¡Œç»“æŸ<br>è¢«åŠ¨åœæ­¢æ–¹å¼</p>
<p>ä¸€èˆ¬ä¸­æ–­çº¿ç¨‹æ˜¯åœ¨æ— æ³•æ§åˆ¶çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚çº¿ç¨‹wait ï¼Œ çº¿ç¨‹sleep ï¼Œ çº¿ç¨‹while(true)<br><code>Thread.currnetThread().isInterrupted()</code></p>
<blockquote>
<p>stopæ–¹æ³•åœæ­¢çº¿ç¨‹ ç¦æ­¢ä½¿ç”¨ ç›¸å½“äºkillçº¿ç¨‹ ä¸å‹å¥½</p>
</blockquote>
<p>interrupt åŠŸèƒ½</p>
<ul>
<li>å”¤é†’é˜»å¡çŠ¶æ€çš„çº¿ç¨‹</li>
<li>ä¿®æ”¹ä¸­æ–­æ ‡å¿—ï¼Œfalse -&gt; true</li>
</ul>
<h2 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h2>]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¯¹è±¡å¤´</title>
    <url>/wiki/Java%E5%AF%B9%E8%B1%A1%E5%A4%B4/</url>
    <content><![CDATA[<h1 id="Javaå¯¹è±¡å¤´"><a href="#Javaå¯¹è±¡å¤´" class="headerlink" title="Javaå¯¹è±¡å¤´"></a>Javaå¯¹è±¡å¤´</h1><h2 id="JOLæŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯"><a href="#JOLæŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯" class="headerlink" title="JOLæŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯"></a>JOLæŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯</h2><p>åœ¨é¡¹ç›®ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jol-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.9&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>å†™ä¸€ä¸ªmainæ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªObjectï¼Œç„¶åæ‰“å°å¯¹è±¡ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> public static void main(String[] args) &#123;</span><br><span class="line">        Object object = new Object();</span><br><span class="line">        System.out.println(ClassLayout.parseInstance(object).toPrintable());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java.lang.Object object internals:</span><br><span class="line"> OFFSET  SIZE   TYPE DESCRIPTION                               VALUE</span><br><span class="line">      0     4        (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)</span><br><span class="line">      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)</span><br><span class="line">      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)</span><br><span class="line">     12     4        (loss due to the next object alignment)</span><br><span class="line">Instance size: 16 bytes</span><br><span class="line">Space losses: 0 bytes internal + 4 bytes external = 4 bytes total</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¯çŸ¥ï¼Œnew Object()åœ¨å†…å­˜ä¸­å 16ä¸ªå­—èŠ‚ï¼Œç»„æˆéƒ¨åˆ†8å­—èŠ‚çš„markword+4å­—èŠ‚çš„class point+4å­—èŠ‚çš„å¯¹é½ï¼›</p>
<h2 id="Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€"><a href="#Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€" class="headerlink" title="Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€"></a>Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€</h2><image src="https://oscimg.oschina.net/oscnet/up-056ef14e62f5dfde1a5af579dabeb6e4c2a.png" width=250 height=420>

<ul>
<li>markword<blockquote>
<p>å­˜å‚¨syncé”æ ‡å¿—ï¼Œåˆ†ä»£å¹´é¾„ç­‰ä¸€äº›å…³é”®ä¿¡æ¯ 8å­—èŠ‚</p>
</blockquote>
</li>
<li>class pointer<blockquote>
<p>æŒ‡å‘å½“å‰å¯¹è±¡æ‰€å±ç±»ç±»å‹ 4å­—èŠ‚</p>
</blockquote>
</li>
</ul>
<p><strong>æŸ¥çœ‹javaå‘½ä»¤é»˜è®¤å¸¦çš„å‚æ•°å‘½ä»¤ï¼š</strong> java -XX:+PrintCommandLineFlags -version </p>
<blockquote>
<p>-XX:InitialHeapSize=134217728<br>-XX:MaxHeapSize=2147483648<br>-XX:+PrintCommandLineFlags<br>-XX:+UseCompressedClassPointers å‹ç¼©ç±»æŒ‡é’ˆ 4å­—èŠ‚<br>-XX:+UseCompressedOops æ™®é€šå¯¹è±¡æŒ‡é’ˆå‹ç¼© 4å­—èŠ‚<br>-XX:+UseParallelGC</p>
</blockquote>
<ul>
<li>instance data<blockquote>
<p>å¯¸å°ºå½“å‰å¯¹è±¡çš„å®ä¾‹æ•°æ®</p>
</blockquote>
</li>
<li>padding<blockquote>
<p>å¯¹é½å¡«å……ï¼Œå½“å¯¹è±¡æ‰€å å­—èŠ‚æ•°ä¸èƒ½è¢«8æ•´é™¤ä¹‹åï¼Œè¿›è¡Œå¡«å……å¯¹é½ã€‚ ç›®å‰çš„æ“ä½œç³»ç»ŸåŸºæœ¬ä¸Šéƒ½æ˜¯64ä½çš„ï¼›</p>
</blockquote>
</li>
</ul>
<h2 id="é¡ºä¸°é¢è¯•é¢˜ï¼Œnew-Object-åœ¨å†…å­˜ä¸­å å¤šå°‘ä¸ªå­—èŠ‚"><a href="#é¡ºä¸°é¢è¯•é¢˜ï¼Œnew-Object-åœ¨å†…å­˜ä¸­å å¤šå°‘ä¸ªå­—èŠ‚" class="headerlink" title="é¡ºä¸°é¢è¯•é¢˜ï¼Œnew Object()åœ¨å†…å­˜ä¸­å å¤šå°‘ä¸ªå­—èŠ‚"></a>é¡ºä¸°é¢è¯•é¢˜ï¼Œnew Object()åœ¨å†…å­˜ä¸­å å¤šå°‘ä¸ªå­—èŠ‚</h2><p>1ã€å¦‚æœåˆ›å»ºçš„æ˜¯ç©ºå¯¹è±¡ï¼Œæ²¡æœ‰å®ä¾‹æ•°æ®</p>
<ul>
<li>é»˜è®¤å¼€å¯äº†class pointeræŒ‡é’ˆå‹ç¼©<blockquote>
<p>8å­—èŠ‚markword + 4å­—èŠ‚class pointer + 4å­—èŠ‚ padding</p>
</blockquote>
</li>
<li>å¦‚æœå…³é—­äº†ç±»æŒ‡é’ˆå‹ç¼©<blockquote>
<p>8å­—èŠ‚markword + 8å­—èŠ‚class pointer</p>
</blockquote>
</li>
</ul>
<p>2ã€å¦‚æœåˆ›å»ºçš„å¯¹è±¡æœ‰å®åŠ›æ•°æ®ï¼Œå¦‚ä¸‹å¯¹è±¡ï¼š<br> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Personï¼ˆint age , String nameï¼‰</span><br></pre></td></tr></table></figure></p>
<ul>
<li>é»˜è®¤å¼€å¯äº†class pointeræŒ‡é’ˆå‹ç¼©<blockquote>
<p>8å­—èŠ‚markword + 4å­—èŠ‚class pointer + 4å­—èŠ‚int + 4å­—èŠ‚String + 4å­—èŠ‚paddingå¯¹é½</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹ä¹‹åŒæ­¥é”</title>
    <url>/wiki/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%90%8C%E6%AD%A5%E9%94%81/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaå¹¶å‘ç¼–ç¨‹-Overview</title>
    <url>/wiki/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-Overview/</url>
    <content><![CDATA[]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaæ³›å‹</title>
    <url>/wiki/Java%E6%B3%9B%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="Javaæ³›å‹"><a href="#Javaæ³›å‹" class="headerlink" title="Javaæ³›å‹"></a>Javaæ³›å‹</h2><h2 id="1ã€æ³›å‹å®šä¹‰"><a href="#1ã€æ³›å‹å®šä¹‰" class="headerlink" title="1ã€æ³›å‹å®šä¹‰"></a>1ã€æ³›å‹å®šä¹‰</h2><blockquote>
<p>ä½¿ç”¨æ³›å‹æœºåˆ¶ç¼–å†™çš„ç¨‹åºä»£ç è¦æ¯”é‚£äº›æ‚ä¹±åœ°ä½¿ç”¨Objectå˜é‡ï¼Œç„¶ååœ¨è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢çš„ä»£ç å…·æœ‰æ›´å¥½çš„å®‰å…¨æ€§å’Œå¯è¯»æ€§ã€‚  â€“ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹  </p>
</blockquote>
<p>æ³›å‹æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸä½œç”¨çš„ï¼›</p>
<p>æ³›å‹å˜é‡ä½¿ç”¨å¤§å†™å½¢å¼ï¼Œåœ¨Javaåº“ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨å˜é‡Eè¡¨ç¤ºé›†åˆçš„å…ƒç´ ç±»å‹ï¼ŒKå’ŒVè¡¨ç¤ºè¡¨çš„å…³é”®å­—ä¸å€¼çš„ç±»å‹ã€‚</p>
<h2 id="2ã€é€šé…ç¬¦"><a href="#2ã€é€šé…ç¬¦" class="headerlink" title="2ã€é€šé…ç¬¦"></a>2ã€é€šé…ç¬¦</h2><h3 id="2-1-æ— è¾¹ç•Œé€šé…ç¬¦"><a href="#2-1-æ— è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="2.1 æ— è¾¹ç•Œé€šé…ç¬¦"></a>2.1 æ— è¾¹ç•Œé€šé…ç¬¦</h3><p>æ— è¾¹ç•Œé€šé…ç¬¦åˆæˆä¸ºéé™å®šé€šé…ç¬¦</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list1.add(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        list1.add(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        list1.add(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        list1.add(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        loop(list1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">(List&lt;?&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println(list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-2-ä¸Šè¾¹ç•Œé€šé…ç¬¦"><a href="#2-2-ä¸Šè¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="2.2 ä¸Šè¾¹ç•Œé€šé…ç¬¦"></a>2.2 ä¸Šè¾¹ç•Œé€šé…ç¬¦</h3><p>ä¸Šè¾¹ç•Œé€šé…ç¬¦å’Œä¸‹è¾¹ç•Œé€šé…ç¬¦éƒ½å±äºé™å®šé€šé…ç¬¦</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Listä¸­çš„ç±»å‹å¿…é¡»æ˜¯Numberçš„å­ç±»ï¼Œä¸ç„¶ä¼šæŠ¥ç¼–è¯‘é”™è¯¯</span></span><br><span class="line">        List&lt;Integer&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list1.add(<span class="number">1</span>);</span><br><span class="line">        list1.add(<span class="number">2</span>);</span><br><span class="line">        list1.add(<span class="number">3</span>);</span><br><span class="line">        list1.add(<span class="number">4</span>);</span><br><span class="line">        loop(list1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ è¿›æ¥çš„listçš„ç±»å‹å¿…é¡»æ˜¯Numberæˆ–Numberçš„å­ç±»æ‰å¯ä»¥</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">(List&lt;? extends Number&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println(list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>? extends Number<br>å¦‚æœé™å®šçš„ç±»å‹æœ‰å¤šä¸ªï¼Œä¹‹é—´ä½¿ç”¨ &amp; è¿›è¡Œåˆ†å‰²</p>
</blockquote>
<h3 id="2-3-ä¸‹è¾¹ç•Œé€šé…ç¬¦"><a href="#2-3-ä¸‹è¾¹ç•Œé€šé…ç¬¦" class="headerlink" title="2.3 ä¸‹è¾¹ç•Œé€šé…ç¬¦"></a>2.3 ä¸‹è¾¹ç•Œé€šé…ç¬¦</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Listçš„æ³›å‹æ˜¯Number æ·»åŠ çš„å…ƒç´ åªè¦æ˜¯Numberä¸‹çš„ç±»å‹å°±å¯ä»¥</span></span><br><span class="line">        List&lt;Number&gt; list1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list1.add(<span class="number">1</span>);</span><br><span class="line">        list1.add(<span class="number">2L</span>);</span><br><span class="line">        list1.add(<span class="keyword">new</span> BigDecimal(<span class="number">22</span>));</span><br><span class="line">        list1.add(<span class="number">4</span>);</span><br><span class="line">        loop(list1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šç”¨ç±»å‹å¿…é¡»æ˜¯Numberåˆ°Objectä¹‹é—´çš„ç±»å‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">(List&lt;? <span class="keyword">super</span> Number&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            System.out.println(list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h2 id="3ã€æ³›å‹çš„ä½¿ç”¨"><a href="#3ã€æ³›å‹çš„ä½¿ç”¨" class="headerlink" title="3ã€æ³›å‹çš„ä½¿ç”¨"></a>3ã€æ³›å‹çš„ä½¿ç”¨</h2><blockquote>
<p>æ³›å‹å¿…é¡»å…ˆå£°æ˜ï¼Œå†ä½¿ç”¨ï¼Œä¸ç„¶ä¼šæœ‰ç¼–è¯‘é”™è¯¯ï¼›<br>æ³›å‹çš„å£°æ˜æ˜¯ç”¨è¿‡ä¸€å¯¹&lt;&gt;æ¥å®Œæˆï¼Œçº¦å®šä½¿ç”¨ä¸€ä¸ªå¤§å†™çš„å­—æ¯æ¥è¡¨ç¤º;<br>é€šé…ç¬¦ä¸èƒ½ç”¨ä½œè¿”å›å€¼;</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">testA</span><span class="params">(T t, Test1&lt;T&gt; test1)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿™æ˜¯ä¼ å…¥çš„T:&quot;</span> + t);</span><br><span class="line">    t = test1.t;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿™æ˜¯èµ‹å€¼åçš„T:&quot;</span> + t);</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>è¦ä»æ³›å‹ç±»å–æ•°æ®æ—¶ï¼Œç”¨extendsï¼›</li>
<li>è¦å¾€æ³›å‹ç±»å†™æ•°æ®æ—¶ï¼Œç”¨superï¼›</li>
<li>æ—¢è¦å–åˆè¦å†™ï¼Œå°±ä¸ç”¨é€šé…ç¬¦ï¼ˆå³extendsä¸superéƒ½ä¸ç”¨ï¼‰ã€‚</li>
</ul>
<h3 id="3-1-æ³›å‹ç±»"><a href="#3-1-æ³›å‹ç±»" class="headerlink" title="3.1 æ³›å‹ç±»"></a>3.1 æ³›å‹ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> &lt;K&gt; <span class="function">K <span class="title">test</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-2-æ³›å‹æ–¹æ³•"><a href="#3-2-æ³›å‹æ–¹æ³•" class="headerlink" title="3.2 æ³›å‹æ–¹æ³•"></a>3.2 æ³›å‹æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoTest4</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;T&gt; ä»£è¡¨æ³›å‹çš„å£°æ˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t   æœ¬æ–¹æ³•å£°æ˜çš„æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; æœ¬æ–¹æ³•å£°æ˜çš„æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">test</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šçš„æ³›å‹æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> k   ç±»ä¸­å®šä¹‰çš„æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;X&gt; æœ¬æ–¹æ³•ä¸­å£°æ˜çš„æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;X&gt; <span class="function">X <span class="title">aa</span><span class="params">(K k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (X) <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€æ–¹æ³•ä¸­æ˜¯æ— æ³•ä½¿ç”¨ç±»ä¸­å£°æ˜çš„æ³›å‹ç±»å‹çš„</span></span><br><span class="line"><span class="comment">     * å¯ä»¥ä½¿ç”¨åœ¨æœ¬æ–¹æ³•ä¸­å£°æ˜çš„æ³›å‹ç±»å‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;X&gt; <span class="function">X <span class="title">bb</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-æ³›å‹æ¥å£"><a href="#3-3-æ³›å‹æ¥å£" class="headerlink" title="3.3 æ³›å‹æ¥å£"></a>3.3 æ³›å‹æ¥å£</h3><p>é¦–å…ˆçœ‹ä¸€ä¸‹ä¸ä½¿ç”¨æ³›å‹æ¥å£çš„Demo</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å…ˆå®šä¹‰æ¥å£ï¼Œå£°æ˜ä¸¤ä¸ªæ–¹æ³•</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IGeneric</span> </span>&#123;</span><br><span class="line">    <span class="function">Integer <span class="title">aa</span><span class="params">(Integer a)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Integer <span class="title">bb</span><span class="params">(Integer b)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç„¶ååˆ›å»ºä¸€ä¸ªç±»æ¥å®ç°æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegerDemo</span> <span class="keyword">implements</span> <span class="title">IGeneric</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">aa</span><span class="params">(Integer a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">bb</span><span class="params">(Integer b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯æ²¡æœ‰ä½¿ç”¨æ³›å‹çš„æ¥å£è®¾è®¡ï¼Œä½†æ˜¯aaæ–¹æ³•çš„æ“ä½œç±»å‹ç›¸å½“äºåœ¨æ¥å£ä¸­å†™æ­»äº†ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªStringç±»å‹çš„aaæ–¹æ³•ï¼Œé‚£æ˜¯ä¸æ˜¯è¿˜è¦åœ¨å£°æ˜ä¸€ä¸ªStringç±»å‹çš„æ¥å£ï¼Œç„¶åå†å»å®ç°å‘¢ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ˜¾å¾—ä»£ç å¾ˆè‡ƒè‚¿ï¼Œä»£ç é‡å¤ï¼›<br>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä½¿ç”¨æ³›å‹ä¹‹åæ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">å®šä¹‰æ³›å‹æ¥å£</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IGenericInte</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">aa</span><span class="params">(T a)</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">bb</span><span class="params">(T b)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æ˜¯æ ¹æ®ä¸åŒç±»å‹çš„å®ç°ç±»</span><br><span class="line">æ³›å‹ä¼ å¦‚Integerç±»å‹</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IGenericInteger</span> <span class="keyword">implements</span> <span class="title">IGenericInte</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">aa</span><span class="params">(Integer a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">bb</span><span class="params">(Integer b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ³›å‹ä¼ å…¥Stringç±»å‹</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IGenericString</span> <span class="keyword">implements</span> <span class="title">IGenericInte</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">aa</span><span class="params">(String a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">bb</span><span class="params">(String b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="4ã€æ³›å‹æ“¦é™¤"><a href="#4ã€æ³›å‹æ“¦é™¤" class="headerlink" title="4ã€æ³›å‹æ“¦é™¤"></a>4ã€æ³›å‹æ“¦é™¤</h2><p>åœ¨è™šæ‹Ÿæœºä¸Šæ²¡æœ‰æ³›å‹ç±»å‹å¯¹è±¡ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å±äºæ™®é€šç±»ã€‚Javaåœ¨å¤„ç†æ³›å‹ç±»å‹çš„æ—¶å€™ï¼Œä¼šå¤„ç†æˆä¸€ä¸ªç›¸åº”çš„åŸå§‹ç±»å‹ã€‚  æ“¦é™¤ç±»å‹å˜é‡ï¼Œå¹¶æ›¿æ¢ä¸ºé™å®šç±»å‹ï¼Œå¦‚æœæ²¡æœ‰é™å®šç±»å‹ï¼Œé»˜è®¤ä½¿ç”¨Objectæ›¿ä»£ã€‚å¦‚æœæœ‰é™å®šç±»å‹ï¼Œå¹¶ä¸”æ˜¯å¤šä¸ªï¼Œä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªé™å®šçš„ç±»å‹æ¥æ›¿æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IGenericInte</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">aa</span><span class="params">(T a)</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">bb</span><span class="params">(T b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åƒä¸Šé¢è¿™ä¸ªTæ˜¯ä¸€ä¸ªæ— é™å®šçš„å˜é‡ï¼Œæ³›å‹æ“¦é™¤ä¹‹åä¼šç›´æ¥ä½¿ç”¨Objectæ›¿æ¢ã€‚<br>å½“ç„¶è°ƒç”¨æ³›å‹æ–¹æ³•æ—¶ï¼Œå¦‚æœæ“¦é™¤è¿”å›ç±»å‹ï¼Œç¼–è¯‘å™¨æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Pair&lt;Employee&gt; buddies = ....</span><br><span class="line">Employee buddy = buddies.getFirst();</span><br></pre></td></tr></table></figure>
<p>æ“¦é™¤getFirstçš„è¿”å›ç±»å‹åå°†è¿”å›Objectç±»å‹ã€‚ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥Employeeçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨è°ƒç”¨æ–¹æ³•æ˜¯å…¶å®æ˜¯æ‰§è¡Œäº†ä¸€ä¸‹ä¸¤ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤ï¼š</p>
<ul>
<li>å¯¹åŸå§‹æ–¹æ³•Pair.getFirst()æ–¹æ³•çš„è°ƒç”¨</li>
<li>å°†è¿”å›çš„Objectç±»å‹å¼ºåˆ¶è½¬æ¢ä¸ºEmployeeç±»å‹</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&gt; <span class="function">T <span class="title">foo</span><span class="params">(T [] args)</span></span></span><br></pre></td></tr></table></figure>
<p>åœ¨æ“¦é™¤ç±»å‹ä¹‹åå˜æˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Comparable T <span class="title">foo</span><span class="params">(Comparable [] args)</span></span></span><br></pre></td></tr></table></figure>
<p>å‚æ•°ç±»å‹Tå·²ç»è¢«æ“¦é™¤ï¼Œåªç•™ä¸‹é™å®šç±»å‹Comparable;</p>
<blockquote>
<p>æ€»ä¹‹æœ‰å…³Javaæ³›å‹è½¬æ¢çš„äº‹å®ï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ²¡æœ‰æ³›å‹ï¼Œåªæœ‰æ™®é€šçš„ç±»å’Œæ–¹æ³•</li>
<li>æ‰€æœ‰çš„ç±»å‹å‚æ•°éƒ½ç”¨å®ƒä»¬çš„é™å®šç±»å‹æ›¿æ¢</li>
<li>==æ¡¥æ–¹æ³•è¢«åˆæˆæ¥ä¿è¯å¤šæ€==</li>
<li>ä¸ºäº†ä¿æŒç±»å‹å®‰å…¨å‹ï¼Œå¿…è¦æ—¶æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢</li>
</ul>
</blockquote>
<p>ç¬¬ä¸€æ¡åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰æ³›å‹æ“¦é™¤è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯å› ä¸ºJVMä¸èƒ½æ“ä½œæ³›å‹ï¼›<br>ç¬¬äºŒæ¡å°±æ˜¯è§£é‡Šæ³›å‹å¦‚ä½•è¿›è¡Œç±»å‹çš„æ“¦é™¤ï¼›<br>ç¬¬ä¸‰æ¡æ˜¯æ³›å‹æ–¹æ³•å¯èƒ½ä¸å¤šæ€çš„ç†å¿µçŸ›ç›¾ï¼Œæ‰€ä»¥ä½¿ç”¨æ¡¥æ–¹æ³•æ¥è¿‡æ¸¡æˆ–å…¼å®¹ï¼›<br>ç¬¬å››æ¡ä¸Šé¢ä¹Ÿæœ‰æåˆ°ï¼Œä¼šå‡ºç°å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æƒ…å†µï¼›  </p>
<h2 id="5ã€æ³›å‹çš„çº¦æŸä¸å±€é™æ€§"><a href="#5ã€æ³›å‹çš„çº¦æŸä¸å±€é™æ€§" class="headerlink" title="5ã€æ³›å‹çš„çº¦æŸä¸å±€é™æ€§"></a>5ã€æ³›å‹çš„çº¦æŸä¸å±€é™æ€§</h2><p>å½“ç„¶æ³›å‹çš„è®¾è®¡åœ¨javaä¸­å¹¶æ²¡æœ‰é‚£ä¹ˆå®Œç¾ï¼Œå®ƒç¡®å®å¯ä»¥è§£å†³ä»£ç ç»“æ„é‡ç”¨ç­‰é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰ä¸€äº›å±€é™æ€§ï¼Œä¸‹é¢æ˜¯æˆ‘æ ¹æ®ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹è¿›è¡Œçš„æ€»ç»“ï¼š</p>
<h3 id="5-1-ä¸èƒ½ä½¿ç”¨åŸºç¡€æ•°æ®ç±»å‹å®ä¾‹åŒ–ç±»å‹å‚æ•°"><a href="#5-1-ä¸èƒ½ä½¿ç”¨åŸºç¡€æ•°æ®ç±»å‹å®ä¾‹åŒ–ç±»å‹å‚æ•°" class="headerlink" title="5.1 ä¸èƒ½ä½¿ç”¨åŸºç¡€æ•°æ®ç±»å‹å®ä¾‹åŒ–ç±»å‹å‚æ•°"></a>5.1 ä¸èƒ½ä½¿ç”¨åŸºç¡€æ•°æ®ç±»å‹å®ä¾‹åŒ–ç±»å‹å‚æ•°</h3><p>åŸå› æ˜¯ç±»å‹æ“¦é™¤ä¹‹åï¼Œå¦‚æœä½¿ç”¨ObjectåŸå§‹ç±»å‹ï¼ŒObjectæ˜¯æ— æ³•å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡å…¶åŒ…è£…ç±»å‹å£°æ˜ï¼›</p>
<h3 id="5-2-è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹åªé€‚ç”¨ä¸åŸå§‹ç±»å‹"><a href="#5-2-è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹åªé€‚ç”¨ä¸åŸå§‹ç±»å‹" class="headerlink" title="5.2 è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹åªé€‚ç”¨ä¸åŸå§‹ç±»å‹"></a>5.2 è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹åªé€‚ç”¨ä¸åŸå§‹ç±»å‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoTest5</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DemoTest5&lt;String&gt; demoTest5 = <span class="keyword">new</span> DemoTest5&lt;&gt;();</span><br><span class="line">        DemoTest5&lt;Integer&gt; demoTest4 = <span class="keyword">new</span> DemoTest5&lt;&gt;();</span><br><span class="line">        System.err.println(demoTest4.getClass().equals(demoTest5.getClass()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>demoTest4.getClass().equals(demoTest5.getClass())å…¶å®æ¯”è¾ƒçš„æ˜¯DemoTest5è¿™ä¸ªç±»ç±»å‹ï¼Œæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹demoTest4.getClass()çš„ç»“æœçœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class com.ibli.javaBase.generics.DemoTest5</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¿™é‡Œæœ‰ä¸€é“éå¸¸ç»å…¸çš„é¢è¯•é¢˜ï¼Œ<a href="https://blog.csdn.net/IBLiplus/article/details/108672223">å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ³›å‹ä»–çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„å»æ‹¿åˆ°æ³›å‹çš„å…·ä½“ç±»å‹ï¼›</a></p>
<h3 id="5-3-ä¸èƒ½åˆ›é€ å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„"><a href="#5-3-ä¸èƒ½åˆ›é€ å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„" class="headerlink" title="5.3 ä¸èƒ½åˆ›é€ å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„"></a>5.3 ä¸èƒ½åˆ›é€ å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„</h3><p>å¯¹äºå‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ï¼Œåœ¨ç±»å‹æ“¦é™¤ä¹‹åï¼Œä¼šå˜æˆObject[]ç±»å‹ï¼Œå¦‚æœæ­¤æ—¶è¯•å›¾å­˜å‚¨ä¸€ä¸ªStringç±»å‹çš„å…ƒç´ ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªArray-StoreExceptionå¼‚å¸¸ï¼›<br>ä¸»è¦ç›®çš„è¿˜æ˜¯å¤„äºåˆ°æ•°ç»„å®‰å…¨çš„ä¿æŠ¤ï¼Œå¯ä»¥å‚è€ƒå‡ ç¯‡æ–‡ç« :  </p>
<blockquote>
<p><a href="https://cloud.tencent.com/developer/ask/195960">1ã€å¦‚æœJavaä¸æ”¯æŒå‚æ•°åŒ–ç±»å‹æ•°ç»„ï¼Œé‚£ä¹ˆArrays.asList()å¦‚ä½•å¤„ç†å®ƒä»¬ï¼Ÿ</a><br><a href="https://blog.csdn.net/qq_41286138/article/details/105250938">2ã€javaä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ³›å‹æ•°ç»„</a><br><a href="https://www.cnblogs.com/shuilangyizu/p/5916402.html">3ã€java.lang.ArrayStoreException</a></p>
</blockquote>
<h3 id="5-4-Varargsè­¦å‘Š"><a href="#5-4-Varargsè­¦å‘Š" class="headerlink" title="5.4 Varargsè­¦å‘Š"></a>5.4 Varargsè­¦å‘Š</h3><p>å‘å‚æ•°ä¸ªæ•°å¯å˜çš„æ–¹æ³•ä¼ é€’ä¸€ä¸ªæ³›å‹ç±»å‹çš„å®ä¾‹çš„åœºæ™¯ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šï¼<br>æŠ‘åˆ¶è¿™ç§è­¦å‘Šçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li>åœ¨è°ƒç”¨æ–¹æ³•ä¸Šå¢åŠ æ³¨è§£@SuppressWarnings(â€œuncheckedâ€)</li>
<li>è¿˜å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£ç›´æ¥æ ‡æ³¨æ–¹æ³•<blockquote>
<p>å‚è€ƒ <a href="https://blog.csdn.net/qq_41286138/article/details/105250938">javaä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ³›å‹æ•°ç»„</a>  </p>
</blockquote>
</li>
</ul>
<h3 id="5-5-ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡"><a href="#5-5-ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡" class="headerlink" title="5.5 ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡"></a>5.5 ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡</h3><p>ä¸èƒ½ä½¿ç”¨new T(..) æˆ–åˆ™new T[â€¦]å’ŒT.classè¿™æ ·çš„è¡¨è¾¾å¼çš„ç±»å‹å˜é‡ï¼›å› ä¸ºç±»å‹æ“¦é™¤åï¼ŒTå˜æˆObjectï¼Œæ˜¾ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œå¹¶ä¸æ˜¯æƒ³è¦åˆ›å»ºä¸€ä¸ªObjectå®ä¾‹ã€‚è§£å†³åŠæ³•æ˜¯åœ¨è°ƒç”¨è€…æä¾›ä¸€ä¸ªæ„é€ å™¨è¡¨è¾¾å¼ï¼Œä¸‹é¢æ˜¯ç”¨Supplierå‡½æ•°å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pair</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> T first;</span><br><span class="line">        <span class="keyword">private</span> T second;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">getFirst</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirst</span><span class="params">(T first)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.first = first;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">getSecond</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> second;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecond</span><span class="params">(T second)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.second = second;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pair</span><span class="params">(T first, T second)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.first = first;</span><br><span class="line">            <span class="keyword">this</span>.second = second;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">build</span><span class="params">(Supplier&lt;T&gt; constr)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;&gt;(constr.get(), constr.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Cannot infer type arguments for Pair2&lt;&gt;</span></span><br><span class="line"><span class="comment">         * å½“å‡½æ•°å¤´è¿”å›å€¼ä¸ºPairæ—¶,æ— æ³•æ¨æ–­,æ”¹ä¸ºPair2åå¯ä»¥æ¨æ–­.</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> c1</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Pair&lt;T&gt; <span class="title">build</span><span class="params">(Class&lt;T&gt; c1)</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Pair&lt;&gt;(c1.newInstance(),c1.newInstance());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Supplieræ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œè¿”å›ä¸€ä¸ªæ— å‚æ•°å¹¶ä¸”è¿”å›ç±»å‹ä¸ºTçš„å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets a result.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMakePair</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1.æ¥å—Supplier&lt;T&gt;--å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚è¡¨ç¤ºæ— å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºTçš„å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">         * å› ä¸ºä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡ï¼Œå¦‚ï¼š</span></span><br><span class="line"><span class="comment">         * public Pair() &#123;first = new T();second = new T();&#125;</span></span><br><span class="line"><span class="comment">         * æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯è®©è°ƒç”¨è€…æä¾›ä¸€ä¸ªæ„é€ å™¨è¡¨è¾¾å¼.å½¢å¼å¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> constr</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Pair&lt;String&gt; pair = Pair.build(String::<span class="keyword">new</span>);</span><br><span class="line">        System.out.println(pair.getFirst().length());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * public void buildT()&#123;</span></span><br><span class="line"><span class="comment">         2.ä¼ ç»Ÿçš„æ–¹å¼æ˜¯é€šè¿‡Class.newInstanceæ–¹æ³•æ¥æ„é€ æ³›å‹å¯¹è±¡.</span></span><br><span class="line"><span class="comment">         ä½†ç”±äºç»†èŠ‚è¿‡äºå¤æ‚,T.classæ˜¯ä¸åˆæ³•çš„.å®ƒä¼šè¢«æ“¦é™¤ä¸ºObject.class.å¦‚ä¸‹:</span></span><br><span class="line"><span class="comment">         Illegal class literal for the type parameter T</span></span><br><span class="line"><span class="comment">         T.class.newInstance();</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">         * 3.</span></span><br><span class="line"><span class="comment">         * T.classæ˜¯ä¸åˆæ³•çš„,ä½†è‹¥APIæ¶‰åŠå¦‚ä¸‹</span></span><br><span class="line"><span class="comment">         * reason:å› ä¸ºString.classæ˜¯Class&lt;String&gt;çš„ä¸€ä¸ªå®ä¾‹.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Pair&lt;String&gt; pair1 = Pair.build(String.class);</span><br><span class="line">        System.out.println(pair1.getFirst().length());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœï¼š</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>


<h3 id="5-6-ä¸èƒ½æ„é€ æ³›å‹æ•°ç»„"><a href="#5-6-ä¸èƒ½æ„é€ æ³›å‹æ•°ç»„" class="headerlink" title="5.6 ä¸èƒ½æ„é€ æ³›å‹æ•°ç»„"></a>5.6 ä¸èƒ½æ„é€ æ³›å‹æ•°ç»„</h3><p>å°±åƒä¸èƒ½å®ä¾‹åŒ–ä¸€ä¸ªæ³›å‹å®ä¾‹ä¸€æ ·ï¼Œä¹Ÿä¸èƒ½å®ä¾‹åŒ–æ•°ç»„ã€‚æ•°ç»„æœ¬èº«ä¹Ÿæœ‰ç±»å‹ï¼Œç”¨æ¥ç›‘æ§å­˜å‚¨åœ¨JVMä¸­çš„æ•°ç»„ï¼Œè¿™ä¸ªç±»å‹ä¼šè¢«æ“¦é™¤ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&gt; T[] foo(T[] a)&#123;</span><br><span class="line">    T[] mm = <span class="keyword">new</span> T[<span class="number">2</span>];</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»å‹æ“¦é™¤ï¼Œä¼šè®©è¿™ä¸ªæ–¹æ³•æ°¸è¿œæ„é€ Comparabel[2]æ•°ç»„ï¼›</p>
<h3 id="5-7-æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ"><a href="#5-7-æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ" class="headerlink" title="5.7 æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ"></a>5.7 æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆ</h3><p>è¿™ä¸ªåº”è¯¥æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œä¸Šæ–‡ä¹Ÿæåˆ°è¿‡äº†ï¼Œæ³›å‹ç±»å‹æ˜¯ä½œç”¨åœ¨æ³›å‹ç±»ä¸Šçš„ï¼Œä¸€äº›é™æ€çš„æ–¹æ³•æˆ–è¿™é™æ€çš„å±æ€§ä¸èƒ½å¤Ÿä½¿ç”¨æ³›å‹ç±»çš„å˜é‡ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼›</p>
<h3 id="5-8-ä¸èƒ½æŠ›å‡ºæˆ–è€…æ•è·æ³›å‹ç±»çš„å®ä¾‹"><a href="#5-8-ä¸èƒ½æŠ›å‡ºæˆ–è€…æ•è·æ³›å‹ç±»çš„å®ä¾‹" class="headerlink" title="5.8 ä¸èƒ½æŠ›å‡ºæˆ–è€…æ•è·æ³›å‹ç±»çš„å®ä¾‹"></a>5.8 ä¸èƒ½æŠ›å‡ºæˆ–è€…æ•è·æ³›å‹ç±»çš„å®ä¾‹</h3><p>Javaæ—¢ä¸èƒ½æŠ›å‡ºä¹Ÿä¸èƒ½æ•è·æ³›å‹ç±»å¯¹è±¡ï¼Œå®é™…ä¸Šï¼Œç”šè‡³æ³›å‹ç±»æ‰©å±•Throwableéƒ½æ˜¯ä¸åˆæ³•çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">doWork</span><span class="params">(Class&lt;T&gt; t)</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;<span class="keyword">catch</span> (T ex)&#123;  æ­¤å¤„æ— æ³•æ•è·    <span class="keyword">catch</span>å¿…é¡»æ•è·å…·ä½“çš„å¼‚å¸¸</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨å¼‚å¸¸è§„èŒƒä¸­ä½¿ç”¨ç±»å‹å˜é‡æ˜¯å…è®¸çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">doWork</span><span class="params">(Class&lt;T&gt; t)</span> <span class="keyword">throws</span> T </span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Throwable ex)&#123;  </span><br><span class="line">        t.initCause(ex);</span><br><span class="line">        <span class="keyword">throw</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-9-å¯ä»¥æ¶ˆé™¤å¯¹å—æŸ¥å¼‚å¸¸çš„æ£€æŸ¥"><a href="#5-9-å¯ä»¥æ¶ˆé™¤å¯¹å—æŸ¥å¼‚å¸¸çš„æ£€æŸ¥" class="headerlink" title="5.9 å¯ä»¥æ¶ˆé™¤å¯¹å—æŸ¥å¼‚å¸¸çš„æ£€æŸ¥"></a>5.9 å¯ä»¥æ¶ˆé™¤å¯¹å—æŸ¥å¼‚å¸¸çš„æ£€æŸ¥</h3><p>Javaå¼‚å¸¸å¤„ç†è¦æ±‚å¿…é¡»ä¸ºæ‰€æœ‰çš„å—æŸ¥å¼‚å¸¸æä¾›ä¸€ä¸ªå¤„ç†å™¨ï¼Œä½†æ˜¯ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥è§„é¿è¿™ä¸€ç‚¹ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function"><span class="keyword">void</span> <span class="title">throwAs</span><span class="params">(Throwable e)</span> <span class="keyword">throws</span> T</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> (T)e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºtæ˜¯ä¸€ä¸ªéå—æŸ¥å¼‚å¸¸;</p>
<h3 id="5-10-æ³¨æ„æ“¦é™¤åçš„å†²çª"><a href="#5-10-æ³¨æ„æ“¦é™¤åçš„å†²çª" class="headerlink" title="5.10 æ³¨æ„æ“¦é™¤åçš„å†²çª"></a>5.10 æ³¨æ„æ“¦é™¤åçš„å†²çª</h3><p>æ¯”å¦‚ä¸€ä¸ªæ³›å‹ç±»çš„equalsæ–¹æ³•ï¼Œæ“¦é™¤ä¹‹åï¼Œå’ŒObjectçš„equalså†²çªï¼›è§£å†³åŠæ³•æ˜¯é‡æ–°å‘½åå¼•å‘é”™è¯¯çš„æ–¹æ³•ï¼›</p>
<h2 id="6ã€æ³›å‹çš„ç»§æ‰¿å…³ç³»"><a href="#6ã€æ³›å‹çš„ç»§æ‰¿å…³ç³»" class="headerlink" title="6ã€æ³›å‹çš„ç»§æ‰¿å…³ç³»"></a>6ã€æ³›å‹çš„ç»§æ‰¿å…³ç³»</h2><p>å¦‚æœManage extends Employee,é‚£ä¹ˆPair&lt; Manage &gt;æ˜¯Pair&lt; Employee &gt;çš„å­ç±»å—ï¼Ÿ ä¸æ˜¯çš„ï¼<br>ä½†æ˜¯æ³›å‹ç±»å¯ä»¥æ‰©å±•æˆ–å®ç°å…¶ä»–çš„æ³›å‹ç±»ï¼Œå¾ˆå…¸å‹çš„ä¸€ä¸ªä¾‹å­ArrayList:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span><br><span class="line">        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ArrayList[E]ç»§æ‰¿äº†AbstractList[E];</p>
<h2 id="å¯¹äºJavaæ³›å‹çš„ä¸€äº›æ€è€ƒ"><a href="#å¯¹äºJavaæ³›å‹çš„ä¸€äº›æ€è€ƒ" class="headerlink" title="å¯¹äºJavaæ³›å‹çš„ä¸€äº›æ€è€ƒ"></a>å¯¹äºJavaæ³›å‹çš„ä¸€äº›æ€è€ƒ</h2><blockquote>
<p>ç¼–è¯‘å™¨å¦‚ä½•æ¨æ–­å‡ºå…·ä½“çš„ç±»å‹ï¼Ÿ å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/u011240877/article/details/53545041#%E6%93%A6%E9%99%A4%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">æ·±å…¥ç†è§£ Java æ³›å‹</a></p>
</blockquote>
<blockquote>
<p align="middle"> -------------------   ä»–æ—¥è‹¥é‚å‡Œäº‘å¿— æ•¢ç¬‘é»„å·¢ä¸ä¸ˆå¤« ------------------- </p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaæ³¨è§£</title>
    <url>/wiki/Java%E6%B3%A8%E8%A7%A3/</url>
    <content><![CDATA[<h1 id="JavaåŸºç¡€ä¹‹æ³¨è§£æœºåˆ¶è¯¦è§£"><a href="#JavaåŸºç¡€ä¹‹æ³¨è§£æœºåˆ¶è¯¦è§£" class="headerlink" title="JavaåŸºç¡€ä¹‹æ³¨è§£æœºåˆ¶è¯¦è§£"></a>JavaåŸºç¡€ä¹‹æ³¨è§£æœºåˆ¶è¯¦è§£</h1><blockquote>
<p>æ³¨è§£æ˜¯JDK1.5ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºå¯¹ä»£ç è¿›è¡Œè¯´æ˜ï¼Œå¯ä»¥å¯¹åŒ…ã€ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•å‚æ•°ã€<br>å±€éƒ¨å˜é‡ç­‰è¿›è¡Œæ³¨è§£ã€‚å®ƒæ˜¯æ¡†æ¶å­¦ä¹ å’Œè®¾è®¡è€…å¿…é¡»æŒæ¡çš„åŸºç¡€ã€‚</p>
</blockquote>
<h2 id="æ³¨è§£åŸºç¡€"><a href="#æ³¨è§£åŸºç¡€" class="headerlink" title="æ³¨è§£åŸºç¡€"></a>æ³¨è§£åŸºç¡€</h2><p>æ³¨è§£æ˜¯JDK1.5ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºå¯¹ä»£ç è¿›è¡Œè¯´æ˜ï¼Œå¯ä»¥å¯¹åŒ…ã€ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰è¿›è¡Œæ³¨è§£ã€‚å®ƒä¸»è¦çš„ä½œç”¨æœ‰ä»¥ä¸‹å››æ–¹é¢ï¼š<br>â€” ç”Ÿæˆæ–‡æ¡£ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®ç”Ÿæˆjavadocæ–‡æ¡£ã€‚<br>â€” ç¼–è¯‘æ£€æŸ¥ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¿›è¡Œæ£€æŸ¥éªŒè¯ã€‚<br>â€” ç¼–è¯‘æ—¶åŠ¨æ€å¤„ç†ï¼Œç¼–è¯‘æ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚åŠ¨æ€ç”Ÿæˆä»£ç ã€‚ </p>
<ul>
<li>è¿è¡Œæ—¶åŠ¨æ€å¤„ç†ï¼Œè¿è¡Œæ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œ ä¾‹å¦‚ä½¿ç”¨åå°„æ³¨å…¥å®ä¾‹ã€‚<br>è¿™ä¹ˆæ¥è¯´æ˜¯æ¯”è¾ƒæŠ½è±¡çš„ï¼Œæˆ‘ä»¬å…·ä½“çœ‹ä¸‹æ³¨è§£çš„å¸¸è§åˆ†ç±»ï¼š <ul>
<li><strong>Javaè‡ªå¸¦çš„æ ‡å‡†æ³¨è§£</strong>ï¼Œ åŒ…æ‹¬@Overrideã€@Deprecatedå’Œ@SuppressWarningsï¼Œåˆ†åˆ«ç”¨äºæ ‡æ˜é‡å†™æŸä¸ªæ–¹æ³•ã€æ ‡æ˜æŸä¸ªç±»æˆ–æ–¹æ³•è¿‡æ—¶ã€æ ‡æ˜è¦å¿½ç•¥çš„è­¦å‘Šï¼Œ<br>ç”¨è¿™äº›æ³¨è§£æ ‡æ˜åç¼–è¯‘å™¨å°±ä¼šè¿›è¡Œæ£€æŸ¥ã€‚   </li>
<li><strong>å…ƒæ³¨è§£</strong>ï¼Œå…ƒæ³¨è§£æ˜¯ç”¨äºå®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼ŒåŒ…æ‹¬@Retentionã€@Targetã€@Inheritedã€@Documentedï¼Œ<br>@Retentionç”¨äºæ ‡æ˜æ³¨è§£è¢«ä¿ç•™çš„é˜¶æ®µï¼Œ@Targetç”¨äºæ ‡æ˜æ³¨è§£ä½¿ç”¨çš„èŒƒå›´ï¼Œ@Inheritedç”¨äºæ ‡æ˜æ³¨è§£å¯ç»§æ‰¿ï¼Œ<br>@Documentedç”¨äºæ ‡æ˜æ˜¯å¦ç”Ÿæˆjavadocæ–‡æ¡£ã€‚ </li>
<li><strong>è‡ªå®šä¹‰æ³¨è§£</strong>ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰æ³¨è§£ï¼Œå¹¶å¯ç”¨å…ƒæ³¨è§£å¯¹è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ³¨è§£ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡è¿™ä¸ªåˆ†ç±»è§’åº¦æ¥ç†è§£æ³¨è§£ã€‚  </li>
</ul>
</li>
</ul>
<h2 id="Javaå†…ç½®æ³¨è§£"><a href="#Javaå†…ç½®æ³¨è§£" class="headerlink" title="Javaå†…ç½®æ³¨è§£"></a>Javaå†…ç½®æ³¨è§£</h2><p>æˆ‘ä»¬ä»æœ€ä¸ºå¸¸è§çš„Javaå†…ç½®çš„æ³¨è§£å¼€å§‹è¯´èµ·ï¼Œå…ˆçœ‹ä¸‹ä¸‹é¢çš„ä»£ç ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B extends A&#123;</span><br><span class="line">    /**</span><br><span class="line">        * é‡è½½çˆ¶ç±»çš„testæ–¹æ³•</span><br><span class="line">        */</span><br><span class="line">    @Override</span><br><span class="line">    public void test() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">        * è¢«å¼ƒç”¨çš„æ–¹æ³•</span><br><span class="line">        */</span><br><span class="line">    @Deprecated</span><br><span class="line">    public void oldMethod() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">        * å¿½ç•¥å‘Šè­¦</span><br><span class="line">        * </span><br><span class="line">        * @return</span><br><span class="line">        */</span><br><span class="line">    @SuppressWarnings(&quot;rawtypes&quot;)</span><br><span class="line">    public List processList() &#123;</span><br><span class="line">        List list = new ArrayList();</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Java 1.5å¼€å§‹è‡ªå¸¦çš„æ ‡å‡†æ³¨è§£ï¼ŒåŒ…æ‹¬@Overrideã€@Deprecatedå’Œ@SuppressWarningsï¼š   </p>
<ul>
<li>@Overrideï¼šè¡¨ç¤ºå½“å‰çš„æ–¹æ³•å®šä¹‰å°†è¦†ç›–çˆ¶ç±»ä¸­çš„æ–¹æ³•  </li>
<li>@Deprecatedï¼šè¡¨ç¤ºä»£ç è¢«å¼ƒç”¨ï¼Œå¦‚æœä½¿ç”¨äº†è¢«@Deprecatedæ³¨è§£çš„ä»£ç åˆ™ç¼–è¯‘å™¨å°†å‘å‡ºè­¦å‘Š  </li>
<li>@SuppressWarningsï¼šè¡¨ç¤ºå…³é—­ç¼–è¯‘å™¨è­¦å‘Šä¿¡æ¯ æˆ‘ä»¬å†å…·ä½“çœ‹ä¸‹è¿™å‡ ä¸ªå†…ç½®æ³¨è§£ï¼ŒåŒæ—¶é€šè¿‡è¿™å‡ ä¸ªå†…ç½®æ³¨è§£ä¸­çš„å…ƒæ³¨è§£çš„å®šä¹‰æ¥å¼•å‡ºå…ƒæ³¨è§£ã€‚  </li>
</ul>
<h3 id="å†…ç½®æ³¨è§£-Override"><a href="#å†…ç½®æ³¨è§£-Override" class="headerlink" title="å†…ç½®æ³¨è§£ - @Override"></a>å†…ç½®æ³¨è§£ - @Override</h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ³¨è§£ç±»å‹çš„å®šä¹‰ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(ElementType.METHOD)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">public @interface Override &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»å®ƒçš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥è¢«ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒåªåœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼Œåœ¨ç¼–è¯‘åçš„classæ–‡ä»¶ä¸­ä¾¿ä¸å†å­˜åœ¨ã€‚<br>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æˆ‘ä»¬å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œé‚£å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¢«ä¿®é¥°çš„æ–¹æ³•æ˜¯é‡å†™çš„çˆ¶ç±»çš„ä¸­çš„ç›¸åŒç­¾åçš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¯¹æ­¤åšå‡ºæ£€æŸ¥ï¼Œ<br>è‹¥å‘ç°çˆ¶ç±»ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³•æˆ–æ˜¯å­˜åœ¨çš„æ–¹æ³•ç­¾åä¸åŒï¼Œåˆ™ä¼šæŠ¥é”™ã€‚    </p>
<h3 id="å†…ç½®æ³¨è§£-Deprecated"><a href="#å†…ç½®æ³¨è§£-Deprecated" class="headerlink" title="å†…ç½®æ³¨è§£ - @Deprecated"></a>å†…ç½®æ³¨è§£ - @Deprecated</h3><p>è¿™ä¸ªæ³¨è§£çš„å®šä¹‰å¦‚ä¸‹ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"> @Documented</span><br><span class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)</span><br><span class="line">public @interface Deprecated &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»å®ƒçš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒä¼šè¢«æ–‡æ¡£åŒ–ï¼Œèƒ½å¤Ÿä¿ç•™åˆ°è¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿä¿®é¥°æ„é€ æ–¹æ³•ã€å±æ€§ã€å±€éƒ¨å˜é‡ã€æ–¹æ³•ã€åŒ…ã€å‚æ•°ã€ç±»å‹ã€‚è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¢«ä¿®é¥°çš„ç¨‹åºå…ƒç´ å·²è¢«â€œåºŸå¼ƒâ€ï¼Œä¸å†å»ºè®®ç”¨æˆ·ä½¿ç”¨ã€‚  </p>
<h3 id="å†…ç½®æ³¨è§£-SuppressWarnings"><a href="#å†…ç½®æ³¨è§£-SuppressWarnings" class="headerlink" title="å†…ç½®æ³¨è§£ - @SuppressWarnings"></a>å†…ç½®æ³¨è§£ - @SuppressWarnings</h3><p>è¿™ä¸ªæ³¨è§£æˆ‘ä»¬ä¹Ÿæ¯”è¾ƒå¸¸ç”¨åˆ°ï¼Œå…ˆæ¥çœ‹ä¸‹å®ƒçš„å®šä¹‰ï¼š   </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Target(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)</span><br><span class="line">@Retention(RetentionPolicy.SOURCE)</span><br><span class="line">public @interface SuppressWarnings &#123;</span><br><span class="line">String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒèƒ½å¤Ÿä¿®é¥°çš„ç¨‹åºå…ƒç´ åŒ…æ‹¬ç±»å‹ã€å±æ€§ã€æ–¹æ³•ã€å‚æ•°ã€æ„é€ å™¨ã€å±€éƒ¨å˜é‡ï¼Œåªèƒ½å­˜æ´»åœ¨æºç æ—¶ï¼Œå–å€¼ä¸ºString[]ã€‚<br>å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æŒ‡å®šçš„è­¦å‘Šä¿¡æ¯ï¼Œå®ƒå¯ä»¥å–çš„å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>// TODO</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™<br><a href="https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html">https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</title>
    <url>/wiki/Mysql-MVCC%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6/</url>
    <content><![CDATA[<h1 id="MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"><a href="#MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶" class="headerlink" title="MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶"></a>MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h1><p>MVCCï¼Œå…¨ç§°Multi-Version Concurrency Controlï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCCæ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚</p>
<p>MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº† ã€Œ<font color=red> æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»-å†™å†²çªï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°ä¸åŠ é”ï¼Œéé˜»å¡å¹¶å‘è¯» </font>ã€</p>
<h2 id="å½“å‰è¯»å’Œå¿«ç…§è¯»"><a href="#å½“å‰è¯»å’Œå¿«ç…§è¯»" class="headerlink" title="å½“å‰è¯»å’Œå¿«ç…§è¯»"></a>å½“å‰è¯»å’Œå¿«ç…§è¯»</h2><blockquote>
<p>å½“å‰è¯»</p>
</blockquote>
<p>åƒselect lock in share mode(å…±äº«é”), select for update ; update, insert ,delete(æ’ä»–é”)è¿™äº›æ“ä½œéƒ½æ˜¯ä¸€ç§å½“å‰è¯»ï¼Œä¸ºä»€ä¹ˆå«å½“å‰è¯»ï¼Ÿå°±æ˜¯å®ƒè¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚</p>
<blockquote>
<p>å¿«ç…§è¯»</p>
</blockquote>
<p>åƒä¸åŠ é”çš„selectæ“ä½œå°±æ˜¯å¿«ç…§è¯»ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ï¼›ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå³MVCC,å¯ä»¥è®¤ä¸ºMVCCæ˜¯è¡Œé”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ï¼›æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå³å¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬</p>
<p>è¯´ç™½äº†MVCCå°±æ˜¯ä¸ºäº†å®ç°è¯»-å†™å†²çªä¸åŠ é”ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯å¿«ç…§è¯», è€Œéå½“å‰è¯»ï¼Œå½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç°</p>
<p><font color=red >MVCCæ¨¡å‹åœ¨MySQLä¸­çš„å…·ä½“å®ç°åˆ™æ˜¯ç”± 3ä¸ªéšå¼å­—æ®µï¼Œundoæ—¥å¿— ï¼ŒRead View ç­‰å»å®Œæˆçš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„MVCCå®ç°åŸç†</font></p>
<h2 id="MVCCæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#MVCCæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="headerlink" title="MVCCæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜"></a>MVCCæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜</h2><p>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ˜¯ä¸€ç§ç”¨æ¥ã€Œ <font color=green>è§£å†³è¯»-å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶</font> ã€ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§ã€‚ æ‰€ä»¥MVCCå¯ä»¥ä¸ºæ•°æ®åº“è§£å†³ä»¥ä¸‹é—®é¢˜</p>
<ul>
<li>åœ¨å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åšåˆ°åœ¨è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œï¼Œæé«˜äº†æ•°æ®åº“å¹¶å‘è¯»å†™çš„æ€§èƒ½</li>
<li>åŒæ—¶è¿˜å¯ä»¥è§£å†³è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜</li>
</ul>
<h2 id="MVCCçš„å®ç°åŸç†"><a href="#MVCCçš„å®ç°åŸç†" class="headerlink" title="MVCCçš„å®ç°åŸç†"></a>MVCCçš„å®ç°åŸç†</h2><p>MVCCçš„ç›®çš„å°±æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œåœ¨æ•°æ®åº“ä¸­çš„å®ç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¯»å†™å†²çªï¼Œå®ƒçš„å®ç°åŸç†ä¸»è¦æ˜¯ä¾èµ–è®°å½•ä¸­çš„  <font color=red>3ä¸ªéšå¼å­—æ®µ</font>ï¼Œ<font color=red>undoæ—¥å¿—</font> ï¼Œ<font color=red>Read View</font> æ¥å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªä¸‰ä¸ªpointçš„æ¦‚å¿µ</p>
<h3 id="éšå¼å­—æ®µ"><a href="#éšå¼å­—æ®µ" class="headerlink" title="éšå¼å­—æ®µ"></a>éšå¼å­—æ®µ</h3><p>æ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„DB_TRX_ID,DB_ROLL_PTR,DB_ROW_IDç­‰å­—æ®µ</p>
<blockquote>
<p>DB_TRX_ID</p>
</blockquote>
<p>6byteï¼Œæœ€è¿‘ä¿®æ”¹(ä¿®æ”¹/æ’å…¥)äº‹åŠ¡IDï¼šè®°å½•åˆ›å»ºè¿™æ¡è®°å½•/æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID</p>
<blockquote>
<p>DB_ROLL_PTR</p>
</blockquote>
<p>7byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆå­˜å‚¨äºrollback segmenté‡Œï¼‰</p>
<blockquote>
<p>DB_ROW_ID</p>
</blockquote>
<p>6byteï¼Œéšå«çš„è‡ªå¢IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šè‡ªåŠ¨ä»¥DB_ROW_IDäº§ç”Ÿä¸€ä¸ªèšç°‡ç´¢å¼•<br>å®é™…è¿˜æœ‰ä¸€ä¸ªåˆ é™¤flagéšè—å­—æ®µ, æ—¢è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº†</p>
<h3 id="undoæ—¥å¿—"><a href="#undoæ—¥å¿—" class="headerlink" title="undoæ—¥å¿—"></a>undoæ—¥å¿—</h3><p>undo logä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p>
<blockquote>
<p>insert undo log</p>
</blockquote>
<p>ä»£è¡¨äº‹åŠ¡åœ¨insertæ–°è®°å½•æ—¶äº§ç”Ÿçš„undo log, åªåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥è¢«ç«‹å³ä¸¢å¼ƒ</p>
<blockquote>
<p>update undo log</p>
</blockquote>
<p>äº‹åŠ¡åœ¨è¿›è¡Œupdateæˆ–deleteæ—¶äº§ç”Ÿçš„undo log; ä¸ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼›æ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰åœ¨å¿«é€Ÿè¯»æˆ–äº‹åŠ¡å›æ»šä¸æ¶‰åŠè¯¥æ—¥å¿—æ—¶ï¼Œå¯¹åº”çš„æ—¥å¿—æ‰ä¼šè¢«purgeçº¿ç¨‹ç»Ÿä¸€æ¸…é™¤</p>
<h3 id="Read-View-è¯»è§†å›¾"><a href="#Read-View-è¯»è§†å›¾" class="headerlink" title="Read View(è¯»è§†å›¾)"></a>Read View(è¯»è§†å›¾)</h3><p>ä»€ä¹ˆæ˜¯Read Viewï¼Œè¯´ç™½äº†Read Viewå°±æ˜¯äº‹åŠ¡è¿›è¡Œå¿«ç…§è¯»æ“ä½œçš„æ—¶å€™ç”Ÿäº§çš„è¯»è§†å›¾(Read View)ï¼Œåœ¨è¯¥äº‹åŠ¡æ‰§è¡Œçš„å¿«ç…§è¯»çš„é‚£ä¸€åˆ»ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ID(å½“æ¯ä¸ªäº‹åŠ¡å¼€å¯æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªID, è¿™ä¸ªIDæ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥æœ€æ–°çš„äº‹åŠ¡ï¼ŒIDå€¼è¶Šå¤§)</p>
<p>æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ Read Viewä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„, å³å½“æˆ‘ä»¬æŸä¸ªäº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼Œå¯¹è¯¥è®°å½•åˆ›å»ºä¸€ä¸ªRead Viewè¯»è§†å›¾ï¼ŒæŠŠå®ƒæ¯”ä½œæ¡ä»¶ç”¨æ¥åˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæ—¢å¯èƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥è¡Œè®°å½•çš„undo logé‡Œé¢çš„æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚</p>
<p>Read Viewéµå¾ªä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œ<font color=red>ä¸»è¦æ˜¯å°†è¦è¢«ä¿®æ”¹çš„æ•°æ®çš„æœ€æ–°è®°å½•ä¸­çš„DB_TRX_IDï¼ˆå³å½“å‰äº‹åŠ¡IDï¼‰å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡çš„IDå»å¯¹æ¯”ï¼ˆç”±Read Viewç»´æŠ¤ï¼‰</font>ï¼Œå¦‚æœDB_TRX_IDè·ŸRead Viewçš„å±æ€§åšäº†æŸäº›æ¯”è¾ƒï¼Œä¸ç¬¦åˆå¯è§æ€§ï¼Œé‚£å°±é€šè¿‡DB_ROLL_PTRå›æ»šæŒ‡é’ˆå»å–å‡ºUndo Logä¸­çš„DB_TRX_IDå†æ¯”è¾ƒï¼Œå³éå†é“¾è¡¨çš„DB_TRX_IDï¼ˆä»é“¾é¦–åˆ°é“¾å°¾ï¼Œå³ä»æœ€è¿‘çš„ä¸€æ¬¡ä¿®æ”¹æŸ¥èµ·ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„DB_TRX_ID, é‚£ä¹ˆè¿™ä¸ªDB_TRX_IDæ‰€åœ¨çš„æ—§è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°è€ç‰ˆæœ¬;</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.jianshu.com/p/8845ddca3b23">1ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</a><br><a href="https://blog.csdn.net/chosen0ne/article/details/18093187">2ã€MVCCæµ…æ</a><br><a href="https://database.51cto.com/art/202010/629317.htm">3ã€ä¹è§‚é”ã€æ‚²è§‚é”å’ŒMVCCï¼Œä»Šå¤©è®©ä½ ä¸€æ¬¡ææ‡‚</a><br><a href="https://baijiahao.baidu.com/s?id=1629409989970483292&wfr=spider&for=pc">4ã€é¢è¯•å®˜ï¼šè°ˆè°ˆä½ å¯¹Mysqlçš„MVCCçš„ç†è§£ï¼Ÿ</a><br><a href="https://www.cnblogs.com/shujiying/p/11347632.html">5ã€Mysqlä¸­MVCCçš„ä½¿ç”¨åŠåŸç†è¯¦è§£</a></p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨å‘½ä»¤</title>
    <url>/wiki/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="ç”¨æˆ·ç›¸å…³"><a href="#ç”¨æˆ·ç›¸å…³" class="headerlink" title="ç”¨æˆ·ç›¸å…³"></a>ç”¨æˆ·ç›¸å…³</h2><h2 id="æ–‡ä»¶ç›¸å…³"><a href="#æ–‡ä»¶ç›¸å…³" class="headerlink" title="æ–‡ä»¶ç›¸å…³"></a>æ–‡ä»¶ç›¸å…³</h2><h2 id="æ—¥å¿—ç›¸å…³"><a href="#æ—¥å¿—ç›¸å…³" class="headerlink" title="æ—¥å¿—ç›¸å…³"></a>æ—¥å¿—ç›¸å…³</h2><ul>
<li><p>linux åœ¨æ–‡æ¡£ä¸­æŸ¥æ‰¾å…³é”®å­—ä¸ªæ•°<br><code>grep -o â€œå…³é”®å­—â€ æ–‡æ¡£å | wc -l </code><br><code>grep -o â€œå…³é”®å­—â€ æ–‡æ¡£å | sort | uniq -c</code></p>
</li>
<li><p>æ¸…é™¤historyè®°å½•<br><code>vim .bash_history</code><br>å‘½ä»¤æ¨¡å¼ä¸‹ï¼ˆEscä¹‹åè¾“å…¥:ï¼‰ è¾“å…¥ set nu æ¯è¡Œæ•°æ®å‰é¢æ˜¾ç¤ºè¡Œå·<br><code>11,20d</code> å›è½¦ 11ï½20è¡Œçš„è®°å½•å°±è¢«åˆ é™¤äº†<br>ç„¶åå‘½ä»¤æ¨¡å¼ä¸‹ wq ä¿å­˜é€€å‡ºå°±å¯ä»¥äº†<br>å¦‚æœåœ¨æ­¤æŸ¥çœ‹è¿˜æ˜¯æœ‰è®°å½•ï¼Œå¯ä»¥é€€å‡ºå½“å‰å›è¯ä¹‹åï¼Œå†è¿›å»æŸ¥çœ‹ï¼Œå°±ä¼šä¸å†æ˜¾ç¤ºåˆ é™¤çš„è®°å½•äº†</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Linux System</category>
        <category>Common commands</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql-äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†</title>
    <url>/wiki/Mysql-%E4%BA%8B%E5%8A%A1%E7%89%B9%E6%80%A7%E4%B8%8E%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†"><a href="#äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†"></a>äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†</h1><h2 id="äº‹åŠ¡ç‰¹æ€§"><a href="#äº‹åŠ¡ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§"></a>äº‹åŠ¡ç‰¹æ€§</h2><blockquote>
<p>åŸå­æ€§(Atomicity)</p>
</blockquote>
<p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“åƒåŸå­ä¸€æ ·ä¸å¯åˆ†å‰²ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p>
<blockquote>
<p>ä¸€è‡´æ€§(Consistency)</p>
</blockquote>
<p>äº‹åŠ¡çš„æ‰§è¡Œç»“æœå¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§çŠ¶æ€æ˜¯æŒ‡:1.ç³»ç»Ÿçš„çŠ¶æ€æ»¡è¶³æ•°æ®çš„å®Œæ•´æ€§çº¦æŸ(ä¸»ç ,å‚ç…§å®Œæ•´æ€§,checkçº¦æŸç­‰) 2.ç³»ç»Ÿçš„çŠ¶æ€ååº”æ•°æ®åº“æœ¬åº”æè¿°çš„ç°å®ä¸–ç•Œçš„çœŸå®çŠ¶æ€,æ¯”å¦‚è½¬è´¦å‰åä¸¤ä¸ªè´¦æˆ·çš„é‡‘é¢æ€»å’Œåº”è¯¥ä¿æŒä¸å˜ã€‚</p>
<blockquote>
<p>éš”ç¦»æ€§(Isolation)</p>
</blockquote>
<p>å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¸ä¼šç›¸äº’å½±å“,å…¶å¯¹æ•°æ®åº“çš„å½±å“å’Œå®ƒä»¬ä¸²è¡Œæ‰§è¡Œæ—¶ä¸€æ ·ã€‚æ¯”å¦‚å¤šä¸ªç”¨æˆ·åŒæ—¶å¾€ä¸€ä¸ªè´¦æˆ·è½¬è´¦,æœ€åè´¦æˆ·çš„ç»“æœåº”è¯¥å’Œä»–ä»¬æŒ‰å…ˆåæ¬¡åºè½¬è´¦çš„ç»“æœä¸€æ ·ã€‚</p>
<blockquote>
<p>æŒä¹…æ€§(Durability)</p>
</blockquote>
<p>äº‹åŠ¡ä¸€æ—¦æäº¤,å…¶å¯¹æ•°æ®åº“çš„æ›´æ–°å°±æ˜¯æŒä¹…çš„ã€‚ä»»ä½•äº‹åŠ¡æˆ–ç³»ç»Ÿæ•…éšœéƒ½ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
<p>åœ¨äº‹åŠ¡çš„ACIDç‰¹æ€§ä¸­,Cå³ä¸€è‡´æ€§æ˜¯äº‹åŠ¡çš„æ ¹æœ¬è¿½æ±‚,è€Œå¯¹æ•°æ®ä¸€è‡´æ€§çš„ç ´åä¸»è¦æ¥è‡ªä¸¤ä¸ªæ–¹é¢<br>1.äº‹åŠ¡çš„å¹¶å‘æ‰§è¡Œ<br>2.äº‹åŠ¡æ•…éšœæˆ–ç³»ç»Ÿæ•…éšœ</p>
<h2 id="äº‹åŠ¡å®ç°åŸç†"><a href="#äº‹åŠ¡å®ç°åŸç†" class="headerlink" title="äº‹åŠ¡å®ç°åŸç†"></a>äº‹åŠ¡å®ç°åŸç†</h2><img src="https://oscimg.oschina.net/oscnet/up-7b54f7847cee22930ec53a4058179a2b531.png" width=460 height=300>

<ul>
<li>å¹¶å‘æ§åˆ¶æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„éš”ç¦»æ€§,ä½¿æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› ä¸ºå¹¶å‘æ‰§è¡Œçš„æ“ä½œè¢«ç ´åã€‚</li>
<li>æ—¥å¿—æ¢å¤æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„åŸå­æ€§,ä½¿ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› äº‹åŠ¡æˆ–ç³»ç»Ÿæ•…éšœè¢«ç ´åã€‚åŒæ—¶ä½¿å·²æäº¤çš„å¯¹æ•°æ®åº“çš„ä¿®æ”¹ä¸ä¼šå› ç³»ç»Ÿå´©æºƒè€Œä¸¢å¤±,ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚</li>
</ul>
<h3 id="å›æ»šæ—¥å¿—ï¼ˆundoï¼‰"><a href="#å›æ»šæ—¥å¿—ï¼ˆundoï¼‰" class="headerlink" title="å›æ»šæ—¥å¿—ï¼ˆundoï¼‰"></a>å›æ»šæ—¥å¿—ï¼ˆundoï¼‰</h3><p>undo logå±äº ã€Œ é€»è¾‘æ—¥å¿— ã€ï¼Œå®ƒè®°å½•çš„æ˜¯sqlæ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚å½“å‘ç”Ÿå›æ»šæ—¶ï¼ŒInnoDBä¼šæ ¹æ®undo logçš„å†…å®¹åšä¸ä¹‹å‰ç›¸åçš„å·¥ä½œï¼šå¯¹äºæ¯ä¸ªinsertï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œdeleteï¼›å¯¹äºæ¯ä¸ªdeleteï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œinsertï¼›å¯¹äºæ¯ä¸ªupdateï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œä¸€ä¸ªç›¸åçš„updateï¼ŒæŠŠæ•°æ®æ”¹å›å»ã€‚</p>
<p>undo logç”¨äºå­˜æ”¾æ•°æ®è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œå¦‚æœä¿®æ”¹å‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨undoæ—¥å¿—æ¥å®ç°å›æ»šæ“ä½œï¼Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚å¦å¤–InnoDB MVCCäº‹åŠ¡ç‰¹æ€§ä¹Ÿæ˜¯åŸºäºundoæ—¥å¿—å®ç°çš„ã€‚</p>
<p>å› æ­¤ï¼Œundo logæœ‰ä¸¤ä¸ªä½œç”¨ï¼šæä¾›å›æ»šå’Œå¤šä¸ªè¡Œç‰ˆæœ¬æ§åˆ¶(MVCC)ã€‚</p>
<h3 id="é‡åšæ—¥å¿—ï¼ˆredoï¼‰"><a href="#é‡åšæ—¥å¿—ï¼ˆredoï¼‰" class="headerlink" title="é‡åšæ—¥å¿—ï¼ˆredoï¼‰"></a>é‡åšæ—¥å¿—ï¼ˆredoï¼‰</h3><p>redo logé‡åšæ—¥å¿—è®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ï¼Œå±äºç‰©ç†æ—¥å¿—ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†redo logæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯redo logå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®redo logçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚</p>
<p>redo logåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€æ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²(redo log buffer)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æ˜“å¤±æ€§çš„ï¼›äºŒæ˜¯ç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶(redo log file)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æŒä¹…çš„ã€‚</p>
<p>MySQLä¸­redo logåˆ·æ–°è§„åˆ™é‡‡ç”¨ä¸€ç§ç§°ä¸ºCheckpointçš„æœºåˆ¶ï¼ˆåˆ©ç”¨LSNå®ç°ï¼‰ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œåˆå¼•å…¥double writeæœºåˆ¶ã€‚</p>
<h2 id="äº‹åŠ¡åŸºæœ¬æ“ä½œ"><a href="#äº‹åŠ¡åŸºæœ¬æ“ä½œ" class="headerlink" title="äº‹åŠ¡åŸºæœ¬æ“ä½œ"></a>äº‹åŠ¡åŸºæœ¬æ“ä½œ</h2><p>å¼€å¯äº‹åŠ¡ï¼šstart transaction<br>å›æ»šäº‹åŠ¡ï¼šrollback<br>æäº¤äº‹åŠ¡ï¼šcommit</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.cnblogs.com/f-ck-need-u/archive/2018/05/08/9010872.html">1ã€è¯¦ç»†åˆ†æMySQLäº‹åŠ¡æ—¥å¿—(redo logå’Œundo log)</a><br><a href="https://www.cnblogs.com/takumicx/p/9998844.html">2ã€æ•°æ®åº“äº‹åŠ¡çš„æ¦‚å¿µåŠå…¶å®ç°åŸç†</a><br><a href="https://zhuanlan.zhihu.com/p/281927963">3ã€æ•°æ®åº“äº‹åŠ¡å®ç°åŸç†</a></p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Parameter index out of range (1 &gt; number of parameters, which is 0).</title>
    <url>/wiki/Parameter-index-out-of-range-1-number-of-parameters-which-is-0/</url>
    <content><![CDATA[<h2 id="é—®é¢˜è®°å½•"><a href="#é—®é¢˜è®°å½•" class="headerlink" title="é—®é¢˜è®°å½•"></a>é—®é¢˜è®°å½•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2021-07-06 12:39:31.179 [http-nio-8081-exec-2] INFO  c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member</span><br><span class="line">2021-07-06 12:39:31.186 [http-nio-8081-exec-2] ERROR com.alibaba.otter.canal.client.adapter.support.Util - sqlRs has error, sql: SELECT COUNT(1) FROM ( select t.redtom_id as id, t.username, t.nickname, t.avatar, t.status, t.mobile, t.mobile_region_no, t.email, t.gender, t.password,t.salt,t.birthday,t.introduce,t.country,t.region,t.level,t.is_vip,t.follows    ,t.fans,t.likes_num, t.collects_num, t.instagram_account, t.youtube_account, t.facebook_account, t.twitter_account,t.create_ip, t.create_time,t.update_time from rd_member r where t.create_time&gt;=&#x27;&#123;0&#125;&#x27;) _CNT</span><br><span class="line">2021-07-06 12:39:31.188 [http-nio-8081-exec-2] ERROR c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - java.sql.SQLException: Parameter index out of range (1 &gt; number of parameters, which is 0).</span><br><span class="line">java.lang.RuntimeException: java.sql.SQLException: Parameter index out of range (1 &gt; number of parameters, which is 0).</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.support.Util.sqlRS(Util.java:65) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.support.AbstractEtlService.importData(AbstractEtlService.java:62) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.importData(ESEtlService.java:56) [client-adapter.es7x-1.1.5-SNAPSHOT-jar-with-dependencies.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.etl(ES7xAdapter.java:79) [client-adapter.es7x-1.1.5-SNAPSHOT-jar-with-dependencies.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:100) [client-adapter.launcher-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:123) [client-adapter.launcher-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_292]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_292]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_292]</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•è§£å†³"><a href="#å¦‚ä½•è§£å†³" class="headerlink" title="å¦‚ä½•è§£å†³"></a>å¦‚ä½•è§£å†³</h2><p>æˆ‘æ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹ï¼šğŸ‘‡<br><code>curl http://127.0.0.1:8081/etl/es7/customer.yml -X POST -d &quot;params=2019-08-31 00:00:00&quot;</code></p>
<p>ä½†æ˜¯æˆ‘çš„ es7/rd_member.ymlçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p><code>etlCondition:&quot;where a.c_time&gt;=&#39;&#123;0&#125;&#39;&quot; # etl çš„æ¡ä»¶å‚æ•°</code></p>
<p>åº”è¯¥æ”¹æˆï¼š<br><code>etlCondition:&quot;where a.c_time&gt;=&#123;&#125;&quot; # etl çš„æ¡ä»¶å‚æ•°</code></p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Other Question</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql-äº‹åŠ¡éš”ç¦»çº§åˆ«</title>
    <url>/wiki/Mysql-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/</url>
    <content><![CDATA[<h1 id="æ•°æ®åº“éš”ç¦»çº§åˆ«"><a href="#æ•°æ®åº“éš”ç¦»çº§åˆ«" class="headerlink" title="æ•°æ®åº“éš”ç¦»çº§åˆ«"></a>æ•°æ®åº“éš”ç¦»çº§åˆ«</h1><p>SQLæ ‡å‡†å®šä¹‰äº†4ç±»éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å…·ä½“è§„åˆ™ï¼Œç”¨æ¥é™å®šäº‹åŠ¡å†…å¤–çš„å“ªäº›æ”¹å˜æ˜¯å¯è§çš„ï¼Œå“ªäº›æ˜¯ä¸å¯è§çš„ã€‚ä½çº§åˆ«çš„éš”ç¦»çº§ä¸€èˆ¬æ”¯æŒæ›´é«˜çš„å¹¶å‘å¤„ç†ï¼Œå¹¶æ‹¥æœ‰æ›´ä½çš„ç³»ç»Ÿå¼€é”€ã€‚å¦å¤–ï¼Œè¿™ç¯‡åˆ†å¸ƒå¼äº‹åŠ¡ä¸ç†è§£ï¼Ÿä¸€æ¬¡ç»™ä½ è®²æ¸…æ¥šï¼æ¨èå¤§å®¶é˜…è¯»ã€‚</p>
<blockquote>
<p>Read Uncommittedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰</p>
</blockquote>
<p>åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ã€‚è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè„è¯»ï¼ˆDirty Readï¼‰ã€‚</p>
<blockquote>
<p>Read Committedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰</p>
</blockquote>
<p>è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ« ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ï¼Œå› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶ä»–å®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†å…¶é—´å¯èƒ½ä¼šæœ‰æ–°çš„commitï¼Œæ‰€ä»¥åŒä¸€selectå¯èƒ½è¿”å›ä¸åŒç»“æœã€‚</p>
<blockquote>
<p>Repeatable Readï¼ˆå¯é‡è¯»ï¼‰</p>
</blockquote>
<p>è¿™æ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚ä¸è¿‡ç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå¹»è¯»æŒ‡å½“ç”¨æˆ·è¯»å–æŸä¸€èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è¡Œï¼Œå½“ç”¨æˆ·å†è¯»å–è¯¥èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œä¼šå‘ç°æœ‰æ–°çš„â€œå¹»å½±â€ è¡Œã€‚InnoDBå’ŒFalconå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion Concurrency Controlï¼‰æœºåˆ¶è§£å†³äº†è¯¥é—®é¢˜ã€‚</p>
<blockquote>
<p>Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</p>
</blockquote>
<p>è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚ç®€è¨€ä¹‹ï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªè¯»çš„æ•°æ®è¡Œä¸ŠåŠ ä¸Šå…±äº«é”ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ã€‚</p>
<h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«äº§ç”Ÿçš„é—®é¢˜"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«äº§ç”Ÿçš„é—®é¢˜" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«äº§ç”Ÿçš„é—®é¢˜"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«äº§ç”Ÿçš„é—®é¢˜</h2><img src="https://oscimg.oschina.net/oscnet/up-ee3cb778a32220ff81103f9163d22f774b2.png"> 


<blockquote>
<p>è„è¯»(Drity Read)</p>
</blockquote>
<p>æŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100</span><br><span class="line">åŒæ—¶äº‹åŠ¡Bæ›´æ–°update price=120ï¼Œä½†æ˜¯æ­¤æ—¶çš„äº‹åŠ¡Bè¿˜æœªcommit</span><br><span class="line">äº‹åŠ¡Aè¯»å–çš„price=120</span><br><span class="line">äº‹åŠ¡B-&gt;rollbackæ“ä½œ</span><br><span class="line">äº‹åŠ¡Aè¯»å–åˆ°çš„æ˜¯è„æ•°æ®</span><br></pre></td></tr></table></figure>


<blockquote>
<p>ä¸å¯é‡å¤è¯»(Non-repeatable read)</p>
</blockquote>
<p>åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100</span><br><span class="line">åŒæ—¶äº‹åŠ¡Bæ›´æ–°update price=120ï¼Œå¹¶commit</span><br><span class="line">äº‹åŠ¡Aè¯»å–çš„price=120</span><br><span class="line">äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¹»è¯»(Phantom Read) </p>
</blockquote>
<p><font color=red >å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«åœ¨äºï¼Œå¹»è¯»ä¸»è¦è¡¨ç°åœ¨æ•°æ®çš„åˆ é™¤å’Œæ’å…¥ï¼Œè€Œä¸å¯é‡å¤è¯»è¡¨ç°åœ¨æ•°æ®çš„æ›´æ–°ã€‚</font></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100</span><br><span class="line">åŒæ—¶äº‹åŠ¡Bæ›´æ–°delete price=100 è¿™æ¡è®°å½•ï¼Œå¹¶commit</span><br><span class="line">äº‹åŠ¡Aè¯»å–çš„price=100</span><br><span class="line">priceè¿™æ¡è®°å½•å·²ç»ä¸å­˜åœ¨ï¼Œä½†æ˜¯äº‹åŠ¡Aè¿˜æ˜¯å¯ä»¥è¯»å–åˆ°</span><br></pre></td></tr></table></figure>

<p>1ã€åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šæŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ï¼Œå¹»è¯»åªåœ¨å½“å‰è¯»ä¸‹æ‰ä¼šå‡ºç°ã€‚<br>ã€€ã€€2ã€å¹»è¯»ä¸“æŒ‡æ–°æ’å…¥çš„è¡Œï¼Œè¯»åˆ°åŸæœ¬å­˜åœ¨è¡Œçš„æ›´æ–°ç»“æœä¸ç®—ã€‚å› ä¸ºå½“å‰è¯»çš„ä½œç”¨å°±æ˜¯èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤è®°å½•çš„æœ€æ–°å€¼ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/xiewenfeng520/article/details/99407038">1ã€mysqlæ•°æ®åº“çš„éš”ç¦»çº§åˆ«</a><br><a href="https://blog.csdn.net/sinat_15805929/article/details/91127491">2ã€MYSQLæ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«</a><br><a href="https://www.jianshu.com/p/c53c8ab650b5">3ã€MySQLå¹»è¯»
</a></p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
  </entry>
  <entry>
    <title>Redis-liståº•å±‚å®ç°</title>
    <url>/wiki/Redis-list%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="Redis-List-åº•å±‚å®ç°"><a href="#Redis-List-åº•å±‚å®ç°" class="headerlink" title="Redis List åº•å±‚å®ç°"></a>Redis List åº•å±‚å®ç°</h1><p><img src="https://oscimg.oschina.net/oscnet/up-c8da12582edb1a4320e17096efc9b9103a2.png">   </p>
<h2 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h2><blockquote>
<p>è¿é”æ›´æ–°é—®é¢˜ | quicklist | ziplist | linkedlist </p>
</blockquote>
<h2 id="Liståº•å±‚æ•°æ®ç»“æ„"><a href="#Liståº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="Liståº•å±‚æ•°æ®ç»“æ„"></a>Liståº•å±‚æ•°æ®ç»“æ„</h2><p>åœ¨ 3.0 ç‰ˆæœ¬çš„ Redis ä¸­ï¼ŒList ç±»å‹æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š<br>æ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚<br>å½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚</p>
<h3 id="ziplistè½¬æ¢æˆlinkedlistçš„æ¡ä»¶"><a href="#ziplistè½¬æ¢æˆlinkedlistçš„æ¡ä»¶" class="headerlink" title="ziplistè½¬æ¢æˆlinkedlistçš„æ¡ä»¶"></a>ziplistè½¬æ¢æˆlinkedlistçš„æ¡ä»¶</h3><p><strong>1ã€è§¦å‘ä¸€ä¸‹ä»»æ„ä¸€æ¡å³è¿›è¡Œè½¬æ¢ï¼š</strong></p>
<ul>
<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚  </li>
<li>åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚</li>
</ul>
<p><strong>2ã€redis.confé…ç½®æ–‡ä»¶</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">list-max-ziplist-value 64 </span><br><span class="line">list-max-ziplist-entries 512 </span><br></pre></td></tr></table></figure>
<p><strong>3ã€ziplistå’Œlinkedliståº•å±‚å®ç°</strong><br><a href="">1ã€ä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰å®ç°çš„åˆ—è¡¨å¯¹è±¡ã€‚</a><br><a href="">2ã€ä½¿ç”¨åŒç«¯é“¾è¡¨ï¼ˆlinkedlistï¼‰å®ç°çš„åˆ—è¡¨å¯¹è±¡ã€‚</a>  </p>
<p>åœ¨ 3.2 ç‰ˆæœ¬åæ–°å¢äº† quicklist æ•°æ®ç»“æ„å®ç°äº† listï¼Œç°åœ¨å°±æ¥åˆ†æä¸‹ quicklist çš„ç»“æ„ã€‚    </p>
<h2 id="quicklist"><a href="#quicklist" class="headerlink" title="quicklist"></a>quicklist</h2><p><img src="https://oscimg.oschina.net/oscnet/up-558f859ac71d40fd122bae2ebdb0a9eb055.png"><br>ziplistä¼šå¼•å…¥é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œè€Œlinkedlistç”±äºæŒ‡é’ˆä¹Ÿä¼šé€ æˆå†…å­˜çš„æµªè´¹ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹æ˜¯å•ç‹¬å­˜åœ¨çš„ï¼Œä¼šé€ æˆå¾ˆå¤šå†…å­˜ç¢ç‰‡ï¼Œ<br>æ‰€ä»¥ç»“åˆä¸¤ä¸ªç»“æ„çš„ç‰¹ç‚¹ï¼Œè®¾è®¡äº†quickListã€‚<br>quickList æ˜¯ä¸€ä¸ª ziplist ç»„æˆçš„åŒå‘é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ ziplist æ¥ä¿å­˜æ•°æ®ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œ quicklist é‡Œé¢ä¿å­˜ç€ä¸€ä¸ªä¸€ä¸ªå°çš„ ziplistã€‚</p>
<h3 id="quicklistè¡¨å¤´ç»“æ„"><a href="#quicklistè¡¨å¤´ç»“æ„" class="headerlink" title="quicklistè¡¨å¤´ç»“æ„"></a>quicklistè¡¨å¤´ç»“æ„</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">quicklist</span> &#123;</span></span><br><span class="line">    <span class="comment">//æŒ‡å‘å¤´éƒ¨(æœ€å·¦è¾¹)quicklistèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">    quicklistNode *head;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æŒ‡å‘å°¾éƒ¨(æœ€å³è¾¹)quicklistèŠ‚ç‚¹çš„æŒ‡é’ˆ</span></span><br><span class="line">    quicklistNode *tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ziplistä¸­çš„entryèŠ‚ç‚¹è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> count;        <span class="comment">/* total count of all entries in all ziplists */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//quicklistçš„quicklistNodeèŠ‚ç‚¹è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> len;           <span class="comment">/* number of quicklistNodes */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿å­˜ziplistçš„å¤§å°ï¼Œé…ç½®æ–‡ä»¶è®¾å®šï¼Œå 16bits</span></span><br><span class="line">    <span class="keyword">int</span> fill : <span class="number">16</span>;              <span class="comment">/* fill factor for individual nodes */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿å­˜å‹ç¼©ç¨‹åº¦å€¼ï¼Œé…ç½®æ–‡ä»¶è®¾å®šï¼Œå 16bitsï¼Œ0è¡¨ç¤ºä¸å‹ç¼©</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> compress : <span class="number">16</span>; <span class="comment">/* depth of end nodes not to compress;0=off */</span></span><br><span class="line">&#125; quicklist;</span><br></pre></td></tr></table></figure>

<ul>
<li>head å’Œ tail åˆ†åˆ«æŒ‡å‘è¿™ä¸ªåŒç«¯é“¾è¡¨çš„è¡¨å¤´å’Œè¡¨å°¾, quicklist å­˜å‚¨çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå«åš quicklistNode çš„ç»“æ„, å¦‚æœè¿™ä¸ª quicklist æ˜¯ç©ºçš„,<br>é‚£ä¹ˆ head å’Œ tail ä¼šåŒæ—¶æˆä¸ºç©ºæŒ‡é’ˆ, å¦‚æœè¿™ä¸ªåŒç«¯é“¾è¡¨çš„å¤§å°ä¸º 1, é‚£ä¹ˆ head å’Œ tail ä¼šåŒæ—¶æŒ‡å‘ä¸€ä¸ªç›¸åŒçš„èŠ‚ç‚¹</li>
<li>count æ˜¯ä¸€ä¸ªè®¡æ•°å™¨, è¡¨ç¤ºå½“å‰è¿™ä¸ª list ç»“æ„ä¸€å…±å­˜å‚¨äº†å¤šå°‘ä¸ªå…ƒç´ , å®ƒçš„ç±»å‹æ˜¯ unsigned long, æ‰€ä»¥ä¸€ä¸ª list èƒ½å­˜å‚¨çš„æœ€å¤šçš„å…ƒç´ åœ¨ å­—é•¿ä¸º 64 bit çš„æœºå™¨ä¸Šæ˜¯ (1 &lt;&lt; 64) - 1, å­—é•¿ä¸º 32 bit çš„æœºå™¨ä¸Šæ˜¯ (1 &lt;&lt; 32) - 1</li>
<li>len è¡¨ç¤ºäº†è¿™ä¸ªåŒç«¯é“¾è¡¨çš„é•¿åº¦(quicklistNodes çš„æ•°é‡)</li>
<li>fill è¡¨ç¤ºäº†å•ä¸ªèŠ‚ç‚¹(quicklistNode)çš„è´Ÿè½½æ¯”ä¾‹(fill factor), è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ <blockquote>
<p>Lists ç»“æ„ä½¿ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„ç¼–ç æ–¹å¼æ¥èŠ‚çœç©ºé—´, Lists ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹æ‰€èƒ½å­˜å‚¨çš„ä¸œè¥¿å¯ä»¥é€šè¿‡æœ€å¤§é•¿åº¦æˆ–è€…ä¸€ä¸ªæœ€å¤§å­˜å‚¨çš„ç©ºé—´å¤§å°æ¥é™åˆ¶,<br>å¯¹äºæƒ³é™åˆ¶æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§å­˜å‚¨ç©ºé—´çš„ç”¨æˆ·, ç”¨ -5 åˆ° -1 æ¥è¡¨ç¤ºè¿™ä¸ªé™åˆ¶å€¼  </p>
</blockquote>
</li>
<li>5: æœ€å¤§å­˜å‚¨ç©ºé—´: 64 Kb &lt;â€“ é€šå¸¸æƒ…å†µä¸‹ä¸è¦è®¾ç½®è¿™ä¸ªå€¼    </li>
<li>4: æœ€å¤§å­˜å‚¨ç©ºé—´: 32 Kb &lt;â€“ éå¸¸ä¸æ¨è</li>
<li>3: æœ€å¤§å­˜å‚¨ç©ºé—´: 16 Kb &lt;â€“ ä¸æ¨è</li>
<li>2: æœ€å¤§å­˜å‚¨ç©ºé—´: 8 Kb &lt;â€“ æ¨è</li>
<li>1: æœ€å¤§å­˜å‚¨ç©ºé—´: 4 Kb &lt;â€“ æ¨è    </li>
</ul>
<p>å¯¹äºæ­£æ•´æ•°åˆ™è¡¨ç¤ºæœ€å¤šèƒ½å­˜å‚¨åˆ°ä½ è®¾ç½®çš„é‚£ä¸ªå€¼, å½“å‰çš„èŠ‚ç‚¹å°±è£…æ»¡äº†<br>é€šå¸¸åœ¨ -2 (8 Kb size) æˆ– -1 (4 Kb size) æ—¶, æ€§èƒ½è¡¨ç°æœ€å¥½<br>ä½†æ˜¯å¦‚æœä½ çš„ä½¿ç”¨åœºæ™¯éå¸¸ç‹¬ç‰¹çš„è¯, è°ƒæ•´åˆ°é€‚åˆä½ çš„åœºæ™¯çš„å€¼ï¼ï¼ï¼ï¼</p>
<p><strong>redis.conf, å…¶ä¸­æœ‰ä¸€ä¸ªå¯é…ç½®çš„å‚æ•°å«åš list-max-ziplist-size, é»˜è®¤å€¼ä¸º -2, å®ƒæ§åˆ¶äº† quicklist ä¸­çš„ fill å­—æ®µçš„å€¼, è´Ÿæ•°é™åˆ¶ quicklistNode ä¸­çš„ ziplist çš„å­—èŠ‚é•¿åº¦, æ­£æ•°é™åˆ¶ quicklistNode ä¸­çš„ ziplist çš„æœ€å¤§é•¿åº¦</strong>  </p>
<ul>
<li>compress åˆ™è¡¨ç¤º quicklist ä¸­çš„èŠ‚ç‚¹ quicklistNode, é™¤å¼€æœ€ä¸¤ç«¯çš„ compress ä¸ªèŠ‚ç‚¹ä¹‹å, ä¸­é—´çš„èŠ‚ç‚¹éƒ½ä¼šè¢«å‹ç¼©<blockquote>
<p>Lists åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šè¢«å‹ç¼©çš„, å‹ç¼©æ·±åº¦æ˜¯è¡¨ç¤ºé™¤å¼€ list ä¸¤ä¾§çš„è¿™ä¹ˆå¤šä¸ªèŠ‚ç‚¹ä¸ä¼šè¢«å‹ç¼©, å‰©ä¸‹çš„èŠ‚ç‚¹éƒ½ä¼šè¢«å°è¯•è¿›è¡Œå‹ç¼©, å¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹ä¸€å®šä¸ä¼šè¢«è¿›è¡Œå‹ç¼©,<br>å› ä¸ºè¦ä¿è¯ push/pop æ“ä½œçš„æ€§èƒ½, æœ‰ä»¥ä¸‹çš„å€¼å¯ä»¥è®¾ç½®:<br>0: å…³é—­å‹ç¼©åŠŸèƒ½</p>
</blockquote>
</li>
</ul>
<p> 1: æ·±åº¦ 1 è¡¨ç¤ºè‡³å°‘åœ¨ 1 ä¸ªèŠ‚ç‚¹ä»¥åæ‰ä¼šå¼€å§‹å°è¯•å‹ç¼©, æ–¹å‘ä¸ºä»å¤´åˆ°å°¾æˆ–è€…ä»å°¾åˆ°å¤´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[head]-&gt;node-&gt;node-&gt;â€¦-&gt;node-&gt;[tail]</span><br><span class="line">[head], [tail] æ°¸è¿œéƒ½æ˜¯ä¸ä¼šè¢«å‹ç¼©çš„çŠ¶æ€; ä¸­é—´çš„èŠ‚ç‚¹åˆ™ä¼šè¢«å‹ç¼©</span><br></pre></td></tr></table></figure>
<p>2 ä¸ä¼šå°è¯•å‹ç¼© head æˆ–è€… head-&gt;next æˆ–è€… tail-&gt;prev æˆ–è€… tail ä½†æ˜¯ä¼šå‹ç¼©è¿™ä¸­é—´çš„æ‰€æœ‰èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[head]-&gt;[next]-&gt;node-&gt;node-&gt;â€¦-&gt;node-&gt;[prev]-&gt;[tail]</span><br></pre></td></tr></table></figure>
<p>3: ä»¥æ­¤ç±»æ¨ï¼Œæœ€å¤§ä¸º2çš„16æ¬¡æ–¹ã€‚  </p>
<h3 id="quicklistNode-èŠ‚ç‚¹"><a href="#quicklistNode-èŠ‚ç‚¹" class="headerlink" title="quicklistNode èŠ‚ç‚¹"></a>quicklistNode èŠ‚ç‚¹</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> *<span class="title">prev</span>;</span>     <span class="comment">//å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">quicklistNode</span> *<span class="title">next</span>;</span>     <span class="comment">//åç»§èŠ‚ç‚¹æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸è®¾ç½®å‹ç¼©æ•°æ®å‚æ•°recompressæ—¶æŒ‡å‘ä¸€ä¸ªziplistç»“æ„</span></span><br><span class="line">    <span class="comment">//è®¾ç½®å‹ç¼©æ•°æ®å‚æ•°recompressæŒ‡å‘quicklistLZFç»“æ„</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> *zl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‹ç¼©åˆ—è¡¨ziplistçš„æ€»é•¿åº¦</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> sz;                  <span class="comment">/* ziplist size in bytes */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ziplistä¸­åŒ…çš„èŠ‚ç‚¹æ•°ï¼Œå 16 bitsé•¿åº¦</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> count : <span class="number">16</span>;          <span class="comment">/* count of items in ziplist */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¡¨ç¤ºæ˜¯å¦é‡‡ç”¨äº†LZFå‹ç¼©ç®—æ³•å‹ç¼©quicklistèŠ‚ç‚¹ï¼Œ1è¡¨ç¤ºå‹ç¼©è¿‡ï¼Œ2è¡¨ç¤ºæ²¡å‹ç¼©ï¼Œå 2 bitsé•¿åº¦</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> encoding : <span class="number">2</span>;        <span class="comment">/* RAW==1 or LZF==2 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¡¨ç¤ºä¸€ä¸ªquicklistNodeèŠ‚ç‚¹æ˜¯å¦é‡‡ç”¨ziplistç»“æ„ä¿å­˜æ•°æ®ï¼Œ2è¡¨ç¤ºå‹ç¼©äº†ï¼Œ1è¡¨ç¤ºæ²¡å‹ç¼©ï¼Œé»˜è®¤æ˜¯2ï¼Œå 2bitsé•¿åº¦</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> container : <span class="number">2</span>;       <span class="comment">/* NONE==1 or ZIPLIST==2 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ‡è®°quicklistèŠ‚ç‚¹çš„ziplistä¹‹å‰æ˜¯å¦è¢«è§£å‹ç¼©è¿‡ï¼Œå 1bité•¿åº¦</span></span><br><span class="line">    <span class="comment">//å¦‚æœrecompressä¸º1ï¼Œåˆ™ç­‰å¾…è¢«å†æ¬¡å‹ç¼©</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> recompress : <span class="number">1</span>; <span class="comment">/* was this node previous compressed? */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æµ‹è¯•æ—¶ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> attempted_compress : <span class="number">1</span>; <span class="comment">/* node can&#x27;t compress; too small */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¢å¤–æ‰©å±•ä½ï¼Œå 10bitsé•¿åº¦</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> extra : <span class="number">10</span>; <span class="comment">/* more bits to steal for future usage */</span></span><br><span class="line">&#125; quicklistNode;</span><br></pre></td></tr></table></figure>
<ul>
<li>prev å’Œ next åˆ†åˆ«æŒ‡å‘å½“å‰ quicklistNode çš„å‰ä¸€ä¸ªå’Œåä¸€ä¸ªèŠ‚ç‚¹</li>
<li>zl æŒ‡å‘å®é™…çš„ ziplist</li>
<li>sz å­˜å‚¨äº†å½“å‰è¿™ä¸ª ziplist çš„å ç”¨ç©ºé—´çš„å¤§å°, å•ä½æ˜¯å­—èŠ‚</li>
<li>count è¡¨ç¤ºå½“å‰æœ‰å¤šå°‘ä¸ªå…ƒç´ å­˜å‚¨åœ¨è¿™ä¸ªèŠ‚ç‚¹çš„ ziplist ä¸­, å®ƒæ˜¯ä¸€ä¸ª 16 bit å¤§å°çš„å­—æ®µ, æ‰€ä»¥ä¸€ä¸ª quicklistNode æœ€å¤šä¹Ÿåªèƒ½å­˜å‚¨ 65536 ä¸ªå…ƒç´ </li>
<li>encoding è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸­çš„ ziplist çš„ç¼–ç æ–¹å¼, 1(RAW) è¡¨ç¤ºé»˜è®¤çš„æ–¹å¼å­˜å‚¨, 2(LZF) è¡¨ç¤ºç”¨ LZF ç®—æ³•å‹ç¼©åè¿›è¡Œçš„å­˜å‚¨ </li>
<li>container è¡¨ç¤º quicklistNode å½“å‰ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨çš„, ç›®å‰æ”¯æŒçš„ä¹Ÿæ˜¯é»˜è®¤çš„å€¼ä¸º 2(ZIPLIST), æœªæ¥ä¹Ÿè®¸ä¼šå¼•å…¥æ›´å¤šå…¶ä»–çš„ç»“æ„</li>
<li>recompress æ˜¯ä¸€ä¸ª 1 bit å¤§å°çš„å¸ƒå°”å€¼, å®ƒè¡¨ç¤ºå½“å‰çš„ quicklistNode æ˜¯ä¸æ˜¯å·²ç»è¢«è§£å‹å‡ºæ¥ä½œä¸´æ—¶ä½¿ç”¨</li>
<li>attempted_compress åªåœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨</li>
<li>extra æ˜¯å‰©ä¸‹å¤šå‡ºæ¥çš„ bit, å¯ä»¥ç•™ä½œæœªæ¥ä½¿ç”¨</li>
</ul>
<h3 id="quicklistLZF-ç»“æ„å®šä¹‰"><a href="#quicklistLZF-ç»“æ„å®šä¹‰" class="headerlink" title="quicklistLZF ç»“æ„å®šä¹‰"></a>quicklistLZF ç»“æ„å®šä¹‰</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Copytypedef struct quicklistLZF &#123;</span><br><span class="line">    unsigned int sz;  //å‹ç¼©åçš„ziplistå¤§å°</span><br><span class="line">    char compressed[];//æŸ”æ€§æ•°ç»„ï¼Œå­˜æ”¾å‹ç¼©åçš„ziplistå­—èŠ‚æ•°ç»„</span><br><span class="line">&#125; quicklistLZF;</span><br></pre></td></tr></table></figure>
<p>å½“æŒ‡å®šä½¿ç”¨lzfå‹ç¼©ç®—æ³•å‹ç¼©ziplistçš„entryèŠ‚ç‚¹æ—¶ï¼ŒquicklistNodeç»“æ„çš„zlæˆå‘˜æŒ‡å‘quicklistLZFç»“æ„;   </p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://zhuanlan.zhihu.com/p/102422311">Redisåˆ—è¡¨list åº•å±‚åŸç†</a><br>2ã€<a href="https://cloud.tencent.com/developer/article/1710612">Redisä¸­stringã€listçš„åº•å±‚æ•°æ®ç»“æ„åŸç†</a><br>3ã€<a href="https://cloud.tencent.com/developer/article/1619920">ã€Šé—²æ‰¯Redisäº”ã€‹Listæ•°æ®ç±»å‹åº•å±‚ä¹‹quicklist</a><br>4ã€<a href="https://blog.csdn.net/men_wen/article/details/70229375">Redisæºç å‰–æå’Œæ³¨é‡Šï¼ˆä¸ƒï¼‰â€” å¿«é€Ÿåˆ—è¡¨(quicklist)</a><br>5ã€<a href="https://blog.csdn.net/qq_31720329/article/details/99938219">redis åˆ—è¡¨ç»“æ„ åº•å±‚å®ç°(quicklist)</a>  </p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis-å“ˆå¸Œè¡¨å®ç°</title>
    <url>/wiki/Redis-%E5%93%88%E5%B8%8C%E8%A1%A8%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="Redisä¹‹Hashè¡¨åº•å±‚å®ç°"><a href="#Redisä¹‹Hashè¡¨åº•å±‚å®ç°" class="headerlink" title="Redisä¹‹Hashè¡¨åº•å±‚å®ç°"></a>Redisä¹‹Hashè¡¨åº•å±‚å®ç°</h1><p><img src="https://oscimg.oschina.net/oscnet/up-c8da12582edb1a4320e17096efc9b9103a2.png">  </p>
<h2 id="å…³é”®è¯"><a href="#å…³é”®è¯" class="headerlink" title="å…³é”®è¯"></a>å…³é”®è¯</h2><blockquote>
<p>å­—æ®µdict | æ¸è¿›å¼å“ˆå¸Œ | ziplist |  å“ˆå¸Œè¡¨</p>
</blockquote>
<h2 id="å­—å…¸åº•å±‚ç»“æ„"><a href="#å­—å…¸åº•å±‚ç»“æ„" class="headerlink" title="å­—å…¸åº•å±‚ç»“æ„"></a>å­—å…¸åº•å±‚ç»“æ„</h2><p><img src="https://oscimg.oschina.net/oscnet/up-95f75bf34c0a82057f05be6630b16163e42.png">  </p>
<h3 id="dict-å­—å…¸ç»“æ„ä½“"><a href="#dict-å­—å…¸ç»“æ„ä½“" class="headerlink" title="dict å­—å…¸ç»“æ„ä½“"></a>dict å­—å…¸ç»“æ„ä½“</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedf struct dict&#123;</span><br><span class="line">    dictType *type;//ç±»å‹ç‰¹å®šå‡½æ•°ï¼ŒåŒ…æ‹¬ä¸€äº›è‡ªå®šä¹‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œ</span><br><span class="line">                   //valueèƒ½å¤Ÿå­˜å‚¨</span><br><span class="line">    void *private;//ç§æœ‰æ•°æ®</span><br><span class="line">    dictht ht[2];//ä¸¤å¼ hashè¡¨ </span><br><span class="line">    int rehashidx;//rehashç´¢å¼•ï¼Œå­—å…¸æ²¡æœ‰è¿›è¡Œrehashæ—¶ï¼Œæ­¤å€¼ä¸º-1</span><br><span class="line">    unsigned long iterators; //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡</span><br><span class="line">&#125;dict;</span><br></pre></td></tr></table></figure>
<ul>
<li>typeå’Œprivateè¿™ä¸¤ä¸ªå±æ€§æ˜¯ä¸ºäº†å®ç°å­—å…¸å¤šæ€è€Œè®¾ç½®çš„ï¼Œå½“å­—å…¸ä¸­å­˜æ”¾ç€ä¸åŒç±»å‹çš„å€¼ï¼Œå¯¹åº”çš„ä¸€äº›å¤åˆ¶ï¼Œæ¯”è¾ƒå‡½æ•°ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªå±æ€§é…åˆèµ·æ¥å¯ä»¥å®ç°å¤šæ€çš„æ–¹æ³•è°ƒç”¨ï¼›</li>
<li>ht[2]ï¼Œä¸¤ä¸ªhashè¡¨</li>
<li>rehashidxï¼Œè¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å˜é‡ï¼Œç”¨äºè®°å½•rehashè¿‡ç¨‹çš„è¿›åº¦ï¼Œä»¥åŠæ˜¯å¦æ­£åœ¨è¿›è¡Œrehashç­‰ä¿¡æ¯ï¼Œå½“æ­¤å€¼ä¸º-1æ—¶ï¼Œè¡¨ç¤ºè¯¥dictæ­¤æ—¶æ²¡æœ‰rehashè¿‡ç¨‹</li>
<li>iteratorsï¼Œè®°å½•æ­¤æ—¶dictæœ‰å‡ ä¸ªè¿­ä»£å™¨æ­£åœ¨è¿›è¡Œéå†è¿‡ç¨‹</li>
</ul>
<h3 id="dictht-å“ˆå¸Œè¡¨ç»“æ„ä½“"><a href="#dictht-å“ˆå¸Œè¡¨ç»“æ„ä½“" class="headerlink" title="dictht å“ˆå¸Œè¡¨ç»“æ„ä½“"></a>dictht å“ˆå¸Œè¡¨ç»“æ„ä½“</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedf struct dictht&#123;</span><br><span class="line">    dictEntry **table;//å­˜å‚¨æ•°æ®çš„æ•°ç»„ äºŒç»´</span><br><span class="line">    unsigned long size;//æ•°ç»„çš„å¤§å°</span><br><span class="line">    unsigned long sizemask;//å“ˆå¸Œè¡¨çš„å¤§å°çš„æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ï¼Œæ€»æ˜¯ç­‰äº </span><br><span class="line">                           //size-1</span><br><span class="line">    unsigned long used;//// å“ˆå¸Œè¡¨ä¸­ä¸­å…ƒç´ ä¸ªæ•°</span><br><span class="line">&#125;dictht;</span><br></pre></td></tr></table></figure>
<h3 id="dictEntry-å“ˆå¸Œæ•°ç»„ç»“æ„"><a href="#dictEntry-å“ˆå¸Œæ•°ç»„ç»“æ„" class="headerlink" title="dictEntry å“ˆå¸Œæ•°ç»„ç»“æ„"></a>dictEntry å“ˆå¸Œæ•°ç»„ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">typedf struct dictEntry&#123;</span><br><span class="line">    void *key;//é”®</span><br><span class="line">    union&#123;</span><br><span class="line">        void val;</span><br><span class="line">        unit64_t u64;</span><br><span class="line">        int64_t s64;</span><br><span class="line">        double d;</span><br><span class="line">    &#125;v;//å€¼</span><br><span class="line">    struct dictEntry *nextï¼›//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ</span><br><span class="line">&#125;dictEntry;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬çŸ¥é“å“ˆå¸Œè¡¨æœ€å¤§çš„é—®é¢˜æ˜¯å­˜åœ¨å“ˆå¸Œå†²çªï¼Œå¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Œæœ‰å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ã€‚<br>è¿™é‡Œé‡‡ç”¨çš„ä¾¿æ˜¯é“¾åœ°å€æ³•ï¼Œé€šè¿‡nextè¿™ä¸ªæŒ‡é’ˆå¯ä»¥å°†å¤šä¸ªå“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨æ¥è§£å†³å“ˆå¸Œå†²çªã€‚  </p>
<h2 id="æ‰©å®¹ä¸ç¼©å®¹"><a href="#æ‰©å®¹ä¸ç¼©å®¹" class="headerlink" title="æ‰©å®¹ä¸ç¼©å®¹"></a>æ‰©å®¹ä¸ç¼©å®¹</h2><p>å½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œå°±è¦é€šè¿‡ rerehash(é‡æ–°æ•£åˆ—ï¼‰æ¥å¯¹å“ˆå¸Œè¡¨è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–è€…æ”¶ç¼©ã€‚å…·ä½“æ­¥éª¤ï¼š</p>
<p>1ã€å¦‚æœæ‰§è¡Œæ‰©å±•æ“ä½œï¼Œä¼šåŸºäºåŸå“ˆå¸Œè¡¨åˆ›å»ºä¸€ä¸ªå¤§å°ç­‰äº ht[0].used*2n çš„å“ˆå¸Œè¡¨ï¼ˆä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰©å±•éƒ½æ˜¯æ ¹æ®åŸå“ˆå¸Œè¡¨å·²ä½¿ç”¨çš„ç©ºé—´æ‰©å¤§ä¸€å€åˆ›å»ºå¦ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼‰ã€‚<br>ç›¸åå¦‚æœæ‰§è¡Œçš„æ˜¯æ”¶ç¼©æ“ä½œï¼Œæ¯æ¬¡æ”¶ç¼©æ˜¯æ ¹æ®å·²ä½¿ç”¨ç©ºé—´ç¼©å°ä¸€å€åˆ›å»ºä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨ã€‚<br>2ã€é‡æ–°åˆ©ç”¨ä¸Šé¢çš„å“ˆå¸Œç®—æ³•ï¼Œè®¡ç®—ç´¢å¼•å€¼ï¼Œç„¶åå°†é”®å€¼å¯¹æ”¾åˆ°æ–°çš„å“ˆå¸Œè¡¨ä½ç½®ä¸Šã€‚<br>3ã€æ‰€æœ‰é”®å€¼å¯¹éƒ½è¿å¾™å®Œæ¯•åï¼Œé‡Šæ”¾åŸå“ˆå¸Œè¡¨çš„å†…å­˜ç©ºé—´ã€‚  </p>
<h3 id="è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼š"><a href="#è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼š" class="headerlink" title="è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼š"></a>è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼š</h3><ul>
<li>1ã€æœåŠ¡å™¨ç›®å‰æ²¡æœ‰æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œå¹¶ä¸”è´Ÿè½½å› å­å¤§äºç­‰äº1ã€‚</li>
<li>2ã€æœåŠ¡å™¨ç›®å‰æ­£åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œå¹¶ä¸”è´Ÿè½½å› å­å¤§äºç­‰äº5ã€‚<br>psï¼šè´Ÿè½½å› å­ = å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°ã€‚</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆæ‰©å®¹çš„æ—¶å€™è¦è€ƒè™‘BIGSAVEçš„å½±å“ï¼Œè€Œç¼©å®¹æ—¶ä¸éœ€è¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ‰©å®¹çš„æ—¶å€™è¦è€ƒè™‘BIGSAVEçš„å½±å“ï¼Œè€Œç¼©å®¹æ—¶ä¸éœ€è¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ‰©å®¹çš„æ—¶å€™è¦è€ƒè™‘BIGSAVEçš„å½±å“ï¼Œè€Œç¼©å®¹æ—¶ä¸éœ€è¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ‰©å®¹çš„æ—¶å€™è¦è€ƒè™‘BIGSAVEçš„å½±å“ï¼Œè€Œç¼©å®¹æ—¶ä¸éœ€è¦ï¼Ÿ</h3><ul>
<li>BGSAVEæ—¶ï¼Œdictè¦æ˜¯è¿›è¡Œæ‰©å®¹ï¼Œåˆ™æ­¤æ—¶å°±éœ€è¦ä¸ºdictht[1]åˆ†é…å†…å­˜ï¼Œè‹¥æ˜¯dictht[0]çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå°±ä¼šå ç”¨æ›´å¤šç³»ç»Ÿå†…å­˜ï¼Œé€ æˆå†…å­˜é¡µè¿‡å¤šåˆ†ç¦»ï¼Œ<br>æ‰€ä»¥ä¸ºäº†é¿å…ç³»ç»Ÿè€—è´¹æ›´å¤šçš„å¼€é”€å»å›æ”¶å†…å­˜ï¼Œæ­¤æ—¶æœ€å¥½ä¸è¦è¿›è¡Œæ‰©å®¹ï¼›</li>
<li>ç¼©å®¹æ—¶ï¼Œç»“åˆç¼©å®¹çš„æ¡ä»¶ï¼Œæ­¤æ—¶è´Ÿè½½å› å­&lt;0.1ï¼Œè¯´æ˜æ­¤æ—¶dictä¸­æ•°æ®å¾ˆå°‘ï¼Œå°±ç®—ä¸ºdictht[1]åˆ†é…å†…å­˜ï¼Œä¹Ÿæ¶ˆè€—ä¸äº†å¤šå°‘èµ„æºï¼›</li>
</ul>
<h2 id="æ¸è¿›å¼å“ˆå¸Œ"><a href="#æ¸è¿›å¼å“ˆå¸Œ" class="headerlink" title="æ¸è¿›å¼å“ˆå¸Œ"></a>æ¸è¿›å¼å“ˆå¸Œ</h2><p>ä»€ä¹ˆå«æ¸è¿›å¼ rehashï¼Ÿä¹Ÿå°±æ˜¯è¯´æ‰©å®¹å’Œæ”¶ç¼©æ“ä½œä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼å®Œæˆçš„ï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼å®Œæˆçš„ã€‚å¦‚æœä¿å­˜åœ¨Redisä¸­çš„é”®å€¼å¯¹åªæœ‰å‡ ä¸ªå‡ åä¸ªï¼Œé‚£ä¹ˆ rehash æ“ä½œå¯ä»¥ç¬é—´å®Œæˆï¼Œ<br>ä½†æ˜¯å¦‚æœé”®å€¼å¯¹æœ‰å‡ ç™¾ä¸‡ï¼Œå‡ åƒä¸‡ç”šè‡³å‡ äº¿ï¼Œé‚£ä¹ˆè¦ä¸€æ¬¡æ€§çš„è¿›è¡Œ rehashï¼ŒåŠ¿å¿…ä¼šé€ æˆRedisä¸€æ®µæ—¶é—´å†…ä¸èƒ½è¿›è¡Œåˆ«çš„æ“ä½œã€‚<br>æ‰€ä»¥Redisé‡‡ç”¨æ¸è¿›å¼ rehash,è¿™æ ·åœ¨è¿›è¡Œæ¸è¿›å¼rehashæœŸé—´ï¼Œå­—å…¸çš„åˆ é™¤æŸ¥æ‰¾æ›´æ–°ç­‰æ“ä½œå¯èƒ½ä¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡Œï¼Œ<br>ç¬¬ä¸€ä¸ªå“ˆå¸Œè¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šå»ç¬¬äºŒä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡ŒæŸ¥æ‰¾ã€‚ä½†æ˜¯è¿›è¡Œå¢åŠ æ“ä½œï¼Œä¸€å®šæ˜¯åœ¨æ–°çš„å“ˆå¸Œè¡¨ä¸Šè¿›è¡Œçš„ã€‚</p>
<ul>
<li>æ¸è¿›å¼å“ˆå¸Œå…¶å®å°±æ˜¯æ…¢æ…¢çš„ï¼Œä¸€æ­¥ä¸€æ­¥çš„å°†hashè¡¨çš„æ•°æ®è¿ç§»åˆ°å¦ä¸€ä¸ªhashè¡¨ä¸­</li>
<li>redisä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»æ£€æµ‹æ˜¯å¦éœ€è¦è¿›è¡Œrehash</li>
<li>rehashçš„è¿‡ç¨‹ä¸­ä¼šåœ¨å­—å…¸dictä¸­ç»´æŠ¤ä¸€ä¸ªrehashidxçš„æ ‡å¿—</li>
<li>åœ¨rehashçš„è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªhashè¡¨ä¸­éƒ½ä¼šæœ‰æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæœ‰æ•°æ®æ–°å¢ï¼Œå°†ä¼šå­˜åœ¨ht[1]ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå“ˆå¸Œè¡¨ä¸Šï¼›</li>
<li>åœ¨rehashçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰åˆ æ”¹æŸ¥ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©ç¬¬ä¸€å¼ è¡¨ï¼Œå¦‚æœç¬¬ä¸€å¼ è¡¨æ²¡æœ‰æŸ¥åˆ°æ•°æ®ï¼Œåˆ™æŸ¥æ‰¾ç¬¬äºŒç« å“ˆå¸Œè¡¨ï¼›</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://www.cnblogs.com/ysocean/p/9080942.html">Redisè¯¦è§£ï¼ˆå››ï¼‰â€”â€” redisçš„åº•å±‚æ•°æ®ç»“æ„</a><br>2ã€<a href="https://www.cnblogs.com/reecelin/p/13362104.html">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹hash</a><br>3ã€<a href="https://blog.csdn.net/mccand1234/article/details/93411326">Redis Hashæ•°æ®ç»“æ„çš„åº•å±‚å®ç°</a><br>4ã€<a href="https://baijiahao.baidu.com/s?id=1651767862408344160&wfr=spider&for=pc">å›¾è§£redisäº”ç§æ•°æ®ç»“æ„åº•å±‚å®ç°(åŠ¨å›¾å“¦)</a><br>5ã€<a href="https://www.jianshu.com/p/c63d8448a7b0">redis hashåº•å±‚æ•°æ®ç»“æ„</a><br>6ã€<a href="https://www.cnblogs.com/reecelin/p/13362104.html">Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹hash</a>  </p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis-overview</title>
    <url>/wiki/Redis-overview/</url>
    <content><![CDATA[<h1 id="Redis-ï¼ˆRemote-Dictionary-Serverï¼‰"><a href="#Redis-ï¼ˆRemote-Dictionary-Serverï¼‰" class="headerlink" title="Redis ï¼ˆRemote Dictionary Serverï¼‰"></a>Redis ï¼ˆRemote Dictionary Serverï¼‰</h1><h2 id="Redisç®€ä»‹"><a href="#Redisç®€ä»‹" class="headerlink" title="Redisç®€ä»‹"></a>Redisç®€ä»‹</h2><p>Redis æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Key-Value ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒ memcachedï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­<br>è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ® flush åˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚<br>å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„ Key-Value DBã€‚<br>Redis çš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedis æœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ª value çš„æœ€å¤§é™<br>åˆ¶æ˜¯ 1GBï¼Œä¸åƒ memcached åªèƒ½ä¿å­˜ 1MB çš„æ•°æ®ï¼Œå› æ­¤ Redis å¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚<br>æ¯”æ–¹è¯´ç”¨ä»–çš„ List æ¥åš FIFO åŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§ èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨ä»–çš„ Set å¯ä»¥åšé«˜<br>æ€§èƒ½çš„ tag ç³»ç»Ÿç­‰ç­‰ã€‚<br>å¦å¤– Redis ä¹Ÿå¯ä»¥å¯¹å­˜å…¥çš„ Key-Value è®¾ç½® expire æ—¶é—´ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«å½“ä½œä¸€ ä¸ªåŠŸèƒ½åŠ å¼ºç‰ˆçš„ memcached æ¥ç”¨ã€‚<br>Redis çš„ä¸»è¦ç¼ºç‚¹æ˜¯æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› <br>æ­¤ Redis é€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</p>
<h2 id="Redis-å¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿ"><a href="#Redis-å¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿ" class="headerlink" title="Redis å¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿ"></a>Redis å¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿ</h2><p>è®¾ç½®å¯†ç ï¼šconfig set requirepass 123456<br>æˆæƒå¯†ç ï¼šauth 123456  </p>
<h2 id="Redis-æœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿ"><a href="#Redis-æœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿ" class="headerlink" title="Redis æœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿ"></a>Redis æœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿ</h2><p>noeviction:è¿”å›é”™è¯¯å½“å†…å­˜é™åˆ¶è¾¾åˆ°å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œä¼šè®©æ›´å¤šå†…å­˜è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†çš„å†™å…¥æŒ‡ä»¤ï¼Œä½† DEL å’Œå‡ ä¸ªä¾‹å¤–ï¼‰<br>allkeys-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚<br>volatile-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚<br>allkeys-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚<br>volatile-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ã€‚<br>volatile-ttl: å›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰è¾ƒçŸ­çš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚  </p>
<h2 id="Redis-æœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ"><a href="#Redis-æœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ" class="headerlink" title="Redis æœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ"></a>Redis æœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿ</h2><h3 id="ï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession-Cacheï¼‰"><a href="#ï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession-Cacheï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰"></a>ï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰</h3><p>æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨ Redis çš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨ Redis ç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚ Mem<br>cachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedis æä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦<br>ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨ Redis æ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸º<br>äººçŸ¥çš„å•†ä¸šå¹³å° Magento ä¹Ÿæä¾› Redis çš„æ’ä»¶ã€‚</p>
<h3 id="ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰"><a href="#ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰"></a>ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰</h3><p>é™¤åŸºæœ¬çš„ä¼šè¯ token ä¹‹å¤–ï¼ŒRedis è¿˜æä¾›å¾ˆç®€ä¾¿çš„ FPC å¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº† Redis å®<br>ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼ PHP æœ¬åœ° FPCã€‚<br>å†æ¬¡ä»¥ Magento ä¸ºä¾‹ï¼ŒMagento æä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨ Redis ä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚<br>æ­¤å¤–ï¼Œå¯¹ WordPress çš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheon æœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«<br>é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚  </p>
<h3 id="ï¼ˆ3ï¼‰é˜Ÿåˆ—"><a href="#ï¼ˆ3ï¼‰é˜Ÿåˆ—" class="headerlink" title="ï¼ˆ3ï¼‰é˜Ÿåˆ—"></a>ï¼ˆ3ï¼‰é˜Ÿåˆ—</h3><p>Redis åœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾— Redis èƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿ<br>åˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redis ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚ Pythonï¼‰å¯¹ list çš„ push/pop<br>æ“ä½œã€‚<br>å¦‚æœä½ å¿«é€Ÿçš„åœ¨ Google ä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯<br>åˆ©ç”¨ Redis åˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCelery æœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨ Redis ä½œ<br>ä¸º brokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚</p>
<h3 id="ï¼ˆ4ï¼‰æ’è¡Œæ¦œ-è®¡æ•°å™¨"><a href="#ï¼ˆ4ï¼‰æ’è¡Œæ¦œ-è®¡æ•°å™¨" class="headerlink" title="ï¼ˆ4ï¼‰æ’è¡Œæ¦œ/è®¡æ•°å™¨"></a>ï¼ˆ4ï¼‰æ’è¡Œæ¦œ/è®¡æ•°å™¨</h3><p>Redis åœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿ<br>ä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedis åªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„ 10 ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹<br>é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼š<br>å½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§<br>è¡Œï¼š<br>ZRANGE user_scores 0 10 WITHSCORESAgora Games å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨ Ruby å®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨ Redis æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯<br>ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚<br>###ï¼ˆ5ï¼‰å‘å¸ƒ/è®¢é˜…<br>æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯ Redis çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ/è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§<br>äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ/è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨ Redis çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½æ¥å»º<br>ç«‹èŠå¤©ç³»ç»Ÿï¼</p>
<h3 id="Redis-å¸¸è§çš„æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#Redis-å¸¸è§çš„æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"></a>Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h3><p>1ã€master æœ€å¥½ä¸è¦åšæŒä¹…åŒ–å·¥ä½œï¼Œå¦‚ RDB å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶<br>2ã€å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ª slave å¼€å¯ AOF å¤‡ä»½ï¼Œç­–ç•¥è®¾ç½®æˆæ¯ç§’åŒæ­¥ä¸€æ¬¡<br>3ã€ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼Œmaster å’Œ Slave æœ€å¥½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…<br>4ã€å°½é‡é¿å…åœ¨å‹åŠ›å¤§å¾—ä¸»åº“ä¸Šå¢åŠ ä»åº“<br>5ã€ä¸»ä»å¤åˆ¶ä¸è¦é‡‡ç”¨ç½‘çŠ¶ç»“æ„ï¼Œå°½é‡æ˜¯çº¿æ€§ç»“æ„ï¼ŒMaster&lt;â€“Slave1&lt;â€”-Slave2 â€¦.  </p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis-å­—ç¬¦ä¸²åº•å±‚åŸç†</title>
    <url>/wiki/Redis-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="Redisåº•å±‚å®ç°åŠåŸç†"><a href="#Redisåº•å±‚å®ç°åŠåŸç†" class="headerlink" title="Redisåº•å±‚å®ç°åŠåŸç†"></a>Redisåº•å±‚å®ç°åŠåŸç†</h1><p><img src="https://oscimg.oschina.net/oscnet/up-c8da12582edb1a4320e17096efc9b9103a2.png">  </p>
<h2 id="å…³é”®è¯"><a href="#å…³é”®è¯" class="headerlink" title="å…³é”®è¯"></a>å…³é”®è¯</h2><blockquote>
<p>SDS embstr äºŒè¿›åˆ¶å®‰å…¨ ç©ºé—´é¢„åˆ†é…</p>
</blockquote>
<h2 id="Stringç±»å‹ä¸åŒçš„ç¼–ç æ–¹å¼"><a href="#Stringç±»å‹ä¸åŒçš„ç¼–ç æ–¹å¼" class="headerlink" title="Stringç±»å‹ä¸åŒçš„ç¼–ç æ–¹å¼"></a>Stringç±»å‹ä¸åŒçš„ç¼–ç æ–¹å¼</h2><ul>
<li><strong>ä½¿ç”¨æ•´æ•°å­˜å‚¨ï¼š</strong> åªå¯¹é•¿åº¦å°äºæˆ–ç­‰äº 21 å­—èŠ‚ï¼Œå¹¶ä¸”å¯ä»¥è¢«è§£é‡Šä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²è¿›è¡Œç¼–ç </li>
<li><strong>ä½¿ç”¨EMBSTR ç¼–ç ï¼š</strong> å°è¯•å°† RAW ç¼–ç çš„å­—ç¬¦ä¸²ç¼–ç ä¸º EMBSTR ç¼–ç ï¼Œ</li>
<li><strong>ä½¿ç”¨SDSç¼–ç :</strong> è¿™ä¸ªå¯¹è±¡æ²¡åŠæ³•è¿›è¡Œç¼–ç ï¼Œå°è¯•ä» SDS ä¸­ç§»é™¤æ‰€æœ‰ç©ºä½™ç©ºé—´ ä¸‹é¢ä¸¾ä¸ªä¾‹å­çœ‹ä¸€ä¸‹ğŸ‘‡</li>
</ul>
<img src="https://oscimg.oschina.net/oscnet/up-01a9f52dd08c514531b8701a47aa90aa029.png"  width="600" height="413" align="bottom" />

<h3 id="embsträ¸åŠ¨æ€å­—ç¬¦ä¸²"><a href="#embsträ¸åŠ¨æ€å­—ç¬¦ä¸²" class="headerlink" title="embsträ¸åŠ¨æ€å­—ç¬¦ä¸²"></a>embsträ¸åŠ¨æ€å­—ç¬¦ä¸²</h3><ul>
<li>embstrçš„åˆ›å»ºåªéœ€åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œè€Œrawä¸ºä¸¤æ¬¡ï¼ˆä¸€æ¬¡ä¸ºsdsåˆ†é…å¯¹è±¡ï¼Œå¦ä¸€æ¬¡ä¸ºredisObjectåˆ†é…å¯¹è±¡ï¼Œembstrçœå»äº†ç¬¬ä¸€æ¬¡ï¼‰ã€‚ ç›¸å¯¹åœ°ï¼Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°ä¹Ÿç”±ä¸¤æ¬¡å˜ä¸ºä¸€æ¬¡ã€‚</li>
<li>embstrçš„redisObjectå’Œsdsæ”¾åœ¨ä¸€èµ·ï¼Œæ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿</li>
<li>ä½†æ˜¯rediså¹¶æœªæä¾›ä»»ä½•ä¿®æ”¹embstrçš„æ–¹å¼ï¼Œå³embstræ˜¯åªè¯»çš„å½¢å¼ã€‚å¯¹embstrçš„ä¿®æ”¹å®é™…ä¸Šæ˜¯å…ˆè½¬æ¢ä¸ºrawå†è¿›è¡Œä¿®æ”¹ã€‚</li>
</ul>
<h2 id="SDS-simple-dynamic-string"><a href="#SDS-simple-dynamic-string" class="headerlink" title="SDS(simple dynamic string)"></a>SDS(simple dynamic string)</h2><h3 id="SDSå®šä¹‰"><a href="#SDSå®šä¹‰" class="headerlink" title="SDSå®šä¹‰"></a>SDSå®šä¹‰</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">struct sdshdr&#123;</span><br><span class="line">     //è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span><br><span class="line">     //ç­‰äº SDS ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦</span><br><span class="line">     int len;</span><br><span class="line">     //è®°å½• buf æ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡</span><br><span class="line">     int free;</span><br><span class="line">     //å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²</span><br><span class="line">     char buf[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹"><a href="#SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹" class="headerlink" title="SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹"></a>SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹</h3><h4 id="1ã€å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦"><a href="#1ã€å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦" class="headerlink" title="1ã€å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦"></a><strong>1ã€å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</strong></h4><p>sdshdr ä¸­ç”±äº len å±æ€§çš„å­˜åœ¨ï¼Œè·å– SDS å­—ç¬¦ä¸²çš„é•¿åº¦åªéœ€è¦è¯»å– len å±æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œè€Œå¯¹äº C è¯­è¨€æ¥è¯´ï¼Œ è·å–å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯éå†å­—ç¬¦ä¸²è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p>
<h4 id="2ã€æœç»ç¼“å†²åŒºæº¢å‡º"><a href="#2ã€æœç»ç¼“å†²åŒºæº¢å‡º" class="headerlink" title="2ã€æœç»ç¼“å†²åŒºæº¢å‡º"></a><strong>2ã€æœç»ç¼“å†²åŒºæº¢å‡º</strong></h4><p>æˆ‘ä»¬çŸ¥é“åœ¨ C è¯­è¨€ä¸­ä½¿ç”¨ strcat å‡½æ•°æ¥è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚è€Œå¯¹äº SDS æ•°æ®ç±»å‹ï¼Œåœ¨è¿›è¡Œå­—ç¬¦ä¿®æ”¹çš„æ—¶å€™ï¼Œ ä¼šé¦–å…ˆæ ¹æ®è®°å½•çš„ len<br>å±æ€§æ£€æŸ¥å†…å­˜ç©ºé—´æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œä¼šè¿›è¡Œç›¸åº”çš„ç©ºé—´æ‰©å±•ï¼Œç„¶ååœ¨è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºã€‚</p>
<h4 id="3ã€å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°"><a href="#3ã€å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°" class="headerlink" title="3ã€å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°"></a><strong>3ã€å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°</strong></h4><p>Cè¯­è¨€ç”±äºä¸è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆå…ˆé‡Šæ”¾å†ç”³è¯·ï¼‰ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é‡æ–°åˆ†é…ï¼Œå­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶ä¼šé€ æˆå†…å­˜ç¼“å†²åŒºæº¢å‡ºï¼Œ<br>å­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚è€Œå¯¹äºSDSï¼Œç”±äºlenå±æ€§å’Œfreeå±æ€§çš„å­˜åœ¨ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ä¸²SDSå®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ç­–ç•¥ï¼š</p>
<p>3.1 å­—ç¬¦ä¸²é•¿åº¦å¢åŠ æ“ä½œæ—¶ï¼Œè¿›è¡Œç©ºé—´é¢„åˆ†é…</p>
<blockquote>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œæ‰©å±•çš„å†…å­˜æ¯”å®é™…éœ€è¦çš„å¤šï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚</p>
</blockquote>
<p>3.2 å­—ç¬¦ä¸²é•¿åº¦å‡å°‘æ“ä½œæ—¶ï¼Œæƒ°æ€§ç©ºé—´é‡Šæ”¾</p>
<blockquote>
<p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡æ–°åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šä½™çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨ free å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚<br>ï¼ˆå½“ç„¶SDSä¹Ÿæä¾›äº†ç›¸åº”çš„APIï¼Œå½“æˆ‘ä»¬æœ‰éœ€è¦æ—¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡Šæ”¾è¿™äº›æœªä½¿ç”¨çš„ç©ºé—´ã€‚</p>
</blockquote>
<h4 id="4ã€äºŒè¿›åˆ¶å®‰å…¨"><a href="#4ã€äºŒè¿›åˆ¶å®‰å…¨" class="headerlink" title="4ã€äºŒè¿›åˆ¶å®‰å…¨"></a><strong>4ã€äºŒè¿›åˆ¶å®‰å…¨</strong></h4><p>å› ä¸ºCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè€Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œå†…å®¹å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤Cå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®å­˜å–ï¼› è€Œæ‰€æœ‰ SDS çš„API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† buf é‡Œé¢çš„å…ƒç´ ï¼Œå¹¶ä¸” SDS<br>ä¸æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œè€Œæ˜¯ä»¥ len å±æ€§è¡¨ç¤ºçš„é•¿åº¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸã€‚</p>
<h4 id="5ã€å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°"><a href="#5ã€å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="5ã€å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°"></a><strong>5ã€å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°</strong></h4><p>è™½ç„¶ SDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸€æ ·éµä»æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²ç»“å°¾çš„æƒ¯ä¾‹ï¼Œè¿™æ ·å¯ä»¥é‡ç”¨ C è¯­è¨€åº“&lt;string.h&gt; ä¸­çš„ä¸€éƒ¨åˆ†å‡½æ•°ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å¤§äº44å°±æ˜¯ç”¨rawæ–¹å¼ç¼–ç "><a href="#ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å¤§äº44å°±æ˜¯ç”¨rawæ–¹å¼ç¼–ç " class="headerlink" title="ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å¤§äº44å°±æ˜¯ç”¨rawæ–¹å¼ç¼–ç "></a>ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å¤§äº44å°±æ˜¯ç”¨rawæ–¹å¼ç¼–ç </h3><p>è¿™ä¸ªæ˜¯å› ä¸ºCè¯­è¨€å‡½æ•°åº“åˆ†é…å†…å­˜çš„é•¿åº¦åªèƒ½æ˜¯2/4/8/16/32/64ï¼›æœ€å¤§åˆ†é…64ä½çš„é•¿åº¦ï¼›<br>ä½†æ˜¯redisObjçš„é•¿åº¦åŠ ä¸Šå­—ç¬¦ä¸²å¯¹è±¡å¤´çš„é•¿åº¦ï¼Œå ç”¨20ä½ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²é•¿åº¦æœ€å¤šæ˜¯44ä½ï¼Œè¶…è¿‡è¿™ä¸ªé•¿åº¦ï¼Œå°±æ˜¯ç”¨rawæ–¹å¼è¿›è¡Œç¼–ç ï¼›  â€“ ã€ŠRedisæ·±åº¦å†é™©-Stringæ•°æ®ç»“æ„ã€‹  </p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1ã€<a href="https://cloud.tencent.com/developer/article/1606944">ã€Šé—²æ‰¯RedisäºŒã€‹Stringæ•°æ®ç±»å‹ä¹‹åº•å±‚è§£æ</a><br>2ã€<a href="https://baijiahao.baidu.com/s?id=1660571063765620837&wfr=spider&for=pc">æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„RedisçŸ¥è¯† - Stringåº•å±‚åŸç†</a><br>3ã€<a href="https://www.cnblogs.com/ysocean/p/9080942.html">Redisè¯¦è§£ï¼ˆå››ï¼‰â€”â€” redisçš„åº•å±‚æ•°æ®ç»“æ„</a><br>4ã€<a href="https://yq.aliyun.com/articles/666402">redis stringåº•å±‚æ•°æ®ç»“æ„</a>  </p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis-ç¼“å­˜ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©</title>
    <url>/wiki/Redis-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E3%80%81%E5%87%BB%E7%A9%BF%E5%92%8C%E9%9B%AA%E5%B4%A9/</url>
    <content><![CDATA[<h1 id="ç¼“å­˜å‡»ç©¿ï¼Œç©¿é€å’Œé›ªå´©"><a href="#ç¼“å­˜å‡»ç©¿ï¼Œç©¿é€å’Œé›ªå´©" class="headerlink" title="ç¼“å­˜å‡»ç©¿ï¼Œç©¿é€å’Œé›ªå´©"></a>ç¼“å­˜å‡»ç©¿ï¼Œç©¿é€å’Œé›ªå´©</h1><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>é¦–å…ˆè¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå†™è¿™ç‰‡æ–‡ç« ï¼Œå› ä¸ºè¿™ä¸ªå¯¹æˆ‘æ¥è¯´æ˜¯å°è±¡éå¸¸æ·±åˆ»çš„ï¼Œé‚£æ˜¯è¿˜åœ¨å®ä¹ çš„æ—¶å€™ï¼Œå½“æ—¶æ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼ˆå…¶å®å°±æ˜¯ç»ƒæ‰‹çš„ï¼‰ï¼Œå¤§è‡´éœ€æ±‚æ˜¯å†™ä¸€ä¸ªç™½åå•ï¼Œç„¶åæœ‰ä¸€ä¸ªåŠŸèƒ½å¯¹ç™½åå•å¼€æ”¾ã€‚å› ä¸ºæ˜¯æ–°åŠŸèƒ½ï¼Œéœ€è¦åœ¨éƒ¨åˆ†åœ°åŒºè¯•ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜æ‰ä¼šæ”¾å¼€åˆ°å…¨å›½åŸå¸‚è¿è¡Œã€‚å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œè®©å½“æ—¶çš„æˆ‘ï¼Œå‘µå‘µã€‚æˆ‘è®°å¾—é‚£æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨Redis,æ ¹æœ¬ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©å•Šï¼Œç¼“å­˜å‡»ç©¿å•Šï¼Œç©¿é€å‘€è¿™äº›ï¼Œè¿˜æœ‰æ›´å¯æ€•çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼ˆTODO ä¸‹æœŸå†è¯´ï¼‰ã€‚          å½“æ—¶å›¢é˜Ÿåå‡ ä½å¤§ä½¬reviewæˆ‘çš„ä»£ç ï¼Œå“¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°è±¡ä¼šæ·±åˆ»ä¸€äº›å§ï¼Œå…³é”®é‚£æ˜¯æˆ‘ç¬¬ä¸€ä¸ªreviewä»£ç ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨redisï¼Œæ•´ä¸ªreviewå°±åƒæ˜¯åå‡ ä¸ªå¤§ä½¬åœ¨é¢è¯•æˆ‘ã€‚çœŸæ˜¯æ€€ç–‘äººç”Ÿäº†ã€‚ã€‚æˆ‘æ˜¯åºŸç‰©ï¼Œåˆ«ç¬‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤§è‡´ä¼ªä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPermit</span><span class="params">(String cityCode)</span></span>&#123;</span><br><span class="line">    <span class="comment">// å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    String tmpCity = getCache(cityCode);</span><br><span class="line">    <span class="keyword">if</span>(StringUtil.isNotBlank(tmpCity))&#123;</span><br><span class="line">        reture Boolean.TRUE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸­æ²¡æœ‰åœ¨å»æŸ¥æ•°æ®åº“</span></span><br><span class="line">    <span class="function">reture <span class="title">judgeForDb</span><span class="params">(cityCode)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä¸Šé¢çš„ä¾‹å­å…¶å®å°±æ˜¯å…¸å‹çš„ç¼“å­˜ç©¿é€çš„é—®é¢˜ã€‚å› ä¸ºä»…ä»…æ˜¯å¼€æ”¾äº†åå‡ ä¸ªåŸå¸‚æ¥è¯•ç‚¹åŠŸèƒ½ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„æŸ¥è¯¢éƒ½æ˜¯ç¼“å­˜ä¸å‘½ä¸­çš„ã€‚</p>
<p>ä¸‹é¢å¼•å‡ºä»Šå¤©æˆ‘ä»¬çš„ä¸‰ä¸ªå…³é”®è¯ï¼š</p>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><blockquote>
<p>è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œç¼“å­˜ä¸­åŸºæœ¬ä¸Šæ²¡æœ‰ï¼Œæ‰€ä»¥å¤§æ¦‚ç‡æƒ…å†µä¸‹ç¼“å­˜æ˜¯ä¸å‘½ä¸­çš„ï¼Œè€Œæ˜¯å»æ•°æ®åº“ä¸­å»æŸ¥è¯¢æ•°æ®ï¼Œå¯¼è‡´ç¼“å­˜ç›¸å½“äºæ˜¯ä¸€ä¸ªæ‘†è®¾ã€‚å¦‚æœKeyä¸æ˜¯çƒ­ç‚¹è®¿é—®è¿˜å¯ä»¥ï¼Œå¦‚æœæ˜¯çƒ­ç‚¹Keyï¼Œè€Œä¸”å¹¶å‘é‡ä¹Ÿä¼šå¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œç»å¤§å¤šæ•°çš„è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¾ˆå®¹æ˜“é€ æˆæ•°æ®åº“å®•æœºã€‚</p>
</blockquote>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1ã€å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œbloom filterå…¸å‹åº”ç”¨åœºæ™¯ï¼ˆç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œé»‘åå•æœºåˆ¶ï¼Œå•è¯é”™è¯¯æ£€æµ‹ï¼‰<br>2ã€ç¼“å­˜ç©ºå€¼æ–¹æ³•ï¼Œè¿™ä¸ªç½‘ä¸Šä¹Ÿæ˜¯è¯´çš„æ¯”è¾ƒå¤šçš„ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„  </p>
<h5 id="åœ¨æ­¤æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š"><a href="#åœ¨æ­¤æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="åœ¨æ­¤æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š"></a>åœ¨æ­¤æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š</h5><p>1ã€æ ¡éªŒä¸€ä¸ªåŸå¸‚æ˜¯å¦æ˜¯åŸå¸‚ç™½åå•çš„åŸå¸‚æ—¶ï¼Œç›´æ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯ä½¿ç”¨çš„hashï¼›<br>2ã€å¦‚æœæ²¡æœ‰æŸ¥åˆ°è¿™ä¸ªåŸå¸‚ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªåŸå¸‚ä¸åœ¨ç™½åå•ä¸­ï¼Œå› ä¸ºæˆ‘æ˜¯å…ˆæŸ¥çš„hashï¼Œç„¶ååœ¨æŸ¥è¯¢hashä¸­çš„å…·ä½“åŸå¸‚ã€‚å¦‚æœhashçš„å€¼éƒ½æ²¡æœ‰æŸ¥åˆ°ï¼Œé‚£è¯´æ˜ç¼“å­˜å¤±æ•ˆäº†ï¼›<br>3ã€é’ˆå¯¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼Œå¯ä»¥å†æŸ¥DBæ¥æ›´æ–°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™æœ‰äººè¦è¾ƒçœŸäº†ï¼Œä¼šä¸ä¼šå‡ºçº¿ç¼“å­˜å‡»ç©¿çš„æƒ…å†µå‘€ï¼Œè¿™ä¸ªçœ‹å…·ä½“åœºæ™¯ï¼Œå› ä¸ºæˆ‘çš„ä¸šåŠ¡æ˜¯ä¸éœ€è¦çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥æŸ¥åº“æ›´æ–°ç¼“å­˜äº†ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œé‚£å¯ä»¥ä¸Šç¼“å­˜å‡»ç©¿çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…çœ‹çœ‹ä¸Šé¢ä¸¤ç§è§£å†³æ–¹æ¡ˆæœ‰æ²¡æœ‰åˆé€‚çš„ï¼Œå“ˆå“ˆå“ˆï¼›<br>4ã€å› ä¸ºåŸå¸‚æ˜¯åœ¨åå°è¿›è¡Œé…ç½®çš„ï¼Œæ‰€ä»¥æˆ‘æ˜¯åœ¨å¢åˆ æ”¹çš„æ“ä½œæ—¶ï¼Œä¿è¯äº†ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œæ‰é€‰æ‹©ç›¸ä¿¡ç¼“å­˜çš„ã€‚è¿™æ˜¯æˆ‘å½“æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><blockquote>
<p>æŸä¸ªçƒ­ç‚¹Keyåœ¨ä¸€æ®µæ—¶é—´å†…å¤±æ•ˆäº†ï¼Œæ­¤æ—¶æœ‰å¤§é‡è¯·æ±‚ç¬æ—¶æŠµè¾¾ï¼Œä¼šä¸¥é‡å¢åŠ æ•°æ®åº“çš„å‹åŠ›ã€‚å› ä¸ºæˆ‘ä»¬çš„ç¼“å­˜æ•°æ®ä¸€èˆ¬éƒ½æ˜¯è¦è®¾ç½®è¿‡æœŸæ—¶é—´çš„ï¼Œå½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå»æŸ¥è¯¢æ•°æ®åº“åŒæ—¶æ›´æ–°ç¼“å­˜æ•°æ®ã€‚</p>
</blockquote>
<h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1ã€å¯ä»¥åŠ é”ï¼Œæ¥ä¿è¯åªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥æ—¶è¾¾åˆ°æ•°æ®åº“ä¸Šï¼Œç„¶åæ›´æ–°ç¼“å­˜ï¼Œç¬¬äºŒä¸ªè¯·æ±‚è¿›æ¥æ˜¯å°±ä¼šå‘½ä¸­ç¼“å­˜ï¼Œå½“ç„¶å¦‚æœæ˜¯åˆ†å¸ƒå¼æœåŠ¡ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”äº†ã€‚<br>2ã€åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œå¯ä»¥å°†çƒ­ç‚¹Keyæ—¶é—´è®¾ç½®é•¿ä¸€äº›ï¼Œæˆ–è€…æ ¹æ®ä¸šåŠ¡å°†å¤±æ•ˆæ—¶é—´è®¾ç½®åœ¨ä¸šåŠ¡é‡æ¯”è¾ƒå°çš„æ³¢æ®µï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚æœ‰çš„è§£å†³æ–¹æ¡ˆä¼šä¸è®¾ç½®Keyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªï¼Œçœ‹æƒ…å†µå§ï¼Œä¸å»ºè®®è¿™æ ·ã€‚ å¦‚æœå¤§é‡çš„keyä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™é•¿æœŸå ç”¨å†…å­˜ä¹Ÿæ˜¯ä¸å¥½çš„ã€‚</p>
<h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><blockquote>
<p>ç¼“å­˜é›ªå´©é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¤§é‡Keyåœ¨ä¸€æ®µæ—¶é—´æˆ–è€…ç¬æ—¶å¤±æ•ˆï¼Œæˆ–è€…RedisæœåŠ¡é‡å¯ï¼ˆæ‰€æœ‰Keyå¤±æ•ˆï¼Œå› ä¸ºæ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼‰ï¼Œä»è€Œå¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¢åŠ æ•°æ®åº“å‹åŠ›</p>
</blockquote>
<h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1ã€å°†çƒ­ç‚¹keyè®¾ç½®ä¸åŒæ³¢æ®µçš„è¿‡æœŸæ—¶é—´ï¼ŒæŠŠè¿‡æœŸæ—¶é—´æ•£åˆ—å¼€ã€‚<br>2ã€ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥é™åˆ¶é«˜å¹¶å‘çš„è¯·æ±‚ï¼Œå’Œç¼“å­˜å‡»ç©¿çš„è§£å†³æ–¹æ¡ˆåŒç†ã€‚<br>3ã€å¯¹äºRedisé‡å¯æˆ–å®•æœºçš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘é›†ç¾¤éƒ¨ç½²ï¼Œå¹¶ä¿è¯æ•°æ®çš„åŒæ­¥å’Œä¸€è‡´æ€§ï¼›</p>
<blockquote>
 <p align="middle" > ç”Ÿæ´»è¿œä¸æ­¢çœ¼å‰çš„è‹Ÿä¸” </p></blockquote>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/wiki/Spring-Overview/</url>
    <content><![CDATA[<hr>
<p>title: Spring-Overview<br>toc: true<br>date: 2021-07-28 17:32:41<br>tags: Spring<br>categories: [Spring Family , Spring Framework]</p>
<hr>
<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><p>The Spring Framework provides a comprehensive<br> programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform.</p>
<p>A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.</p>
<h2 id="å­¦ä¹ æ–¹æ³•"><a href="#å­¦ä¹ æ–¹æ³•" class="headerlink" title="å­¦ä¹ æ–¹æ³•"></a>å­¦ä¹ æ–¹æ³•</h2><ul>
<li>å…ˆæ¢³ç†è„‰ç»œï¼Œå…ˆå®è§‚ï¼Œå†ç»†èŠ‚</li>
<li>Springæºç æ³¨é‡Šå¾ˆé‡è¦</li>
<li>è§åçŸ¥æ„ å­¦ä¹ springçš„å‘½åè§„èŒƒ</li>
<li>çŒœæµ‹å’ŒéªŒè¯</li>
<li>åšæŒçœ‹ ä¸è¦ä¸‰åˆ†é’Ÿçƒ­åº¦</li>
</ul>
<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><blockquote>
<p>Springæ¡†æ¶å®˜æ–¹ç½‘ç«™</p>
</blockquote>
<p><a href="https://spring.io/projects/spring-framework#overview">ã€å®˜ç½‘ã€‘</a>å¯ä»¥ä¸‹è½½Spirngæºç åœ¨æœ¬åœ°æŸ¥çœ‹æ›´èˆ’æœï¼ æºç è¯·æˆ³    ğŸ‘‰ğŸ‘‰ <a href="https://spring.io/projects/spring-framework#overview">ã€æºç ã€‘</a> ğŸ‘ˆğŸ‘ˆ</p>
<blockquote>
<p>Spring5æœ€æ–°å®Œæ•´æ•™ç¨‹IDEAç‰ˆé€šä¿—æ˜“æ‡‚ </p>
</blockquote>
<p>è§†é¢‘æ•™ç¨‹ ç‹‚ç¥è¯´ ï¼ˆè¿™ä¸ªå¤§ä½¬åœ¨Bç«™å¾ˆç«çš„ï¼‰åŸé“¾æ¥è¯·ç‚¹å‡»ğŸ‘‰ <a href="https://www.bilibili.com/video/BV1WE411d7Dv?p=20">ã€ä¼ é€ã€‘</a></p>
<blockquote>
<p>24é›†å½»åº•ææ‡‚aop ioc mvcåº•å±‚åŸç†</p>
</blockquote>
<p>è§†é¢‘ç›®å½•æ¯”è¾ƒå¥½ ğŸ‘‰ <a href="https://www.bilibili.com/video/BV1Bt4y1S7nW?p=7">ã€2020å¹´å²ä¸Šæœ€æ–°Springæºç åˆé›†ï¼Œ24é›†å½»åº•ææ‡‚aop ioc mvcåº•å±‚åŸç†ã€‚ã€‘</a></p>
<blockquote>
<p>æ‰‹æ’•SpringIOCæºç </p>
</blockquote>
<p>é©¬å£«å…µæ•™è‚² <a href="https://www.bilibili.com/video/BV1CT4y1P7tK?p=1">ã€400åˆ†é’Ÿå­¦å®ŒSpringæºç è®¾è®¡åŠåŸç†ï¼Œæ‰‹æ’•SpringIOCæºç ï¼Œä»æˆ‘åšèµ·ã€‘</a></p>
<blockquote>
<p>å›¾çµå­¦é™¢å…¬å¼€è¯¾ </p>
</blockquote>
<p>è¯¾ç¨‹ç›®å½•è¿˜ä¸é”™ 5ä¸ªå°æ—¶ 21å¹´å½•åˆ¶æ¯”è¾ƒæ–° <a href="https://www.bilibili.com/video/BV1Ya411F73A?from=search&seid=11823196289005055636">ã€2021å¹´æ–°ç‰ˆJava-Springåº•å±‚åŸç†ï¼Œé˜¿é‡ŒP8å¤§ä½¬å…¨å¥—è®²è§£ã€‘</a></p>
<blockquote>
<p>Mybatis + Spring æºç è§£è¯» VIPå…¬å¼€è¯¾<br><a href="https://www.bilibili.com/video/BV1Gv411s7hL?p=1">ã€ç»ˆäºæœ‰å­—èŠ‚è·³åŠ¨æŠ€æœ¯å¤§ç‰›æŠŠã€mybatisåº•å±‚åŸç†ï¼šspringæ•´ç†mybatisã€‘è®²æ˜ç™½äº†ã€‘</a></p>
</blockquote>
]]></content>
  </entry>
  <entry>
    <title>SpringBeanå¾ªç¯ä¾èµ–</title>
    <url>/wiki/SpringBean%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/</url>
    <content><![CDATA[<h1 id="Spring-Bean-å¾ªç¯ä¾èµ–"><a href="#Spring-Bean-å¾ªç¯ä¾èµ–" class="headerlink" title="Spring Bean å¾ªç¯ä¾èµ–"></a>Spring Bean å¾ªç¯ä¾èµ–</h1><h2 id="ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¾ªç¯ä¾èµ–"><a href="#ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¾ªç¯ä¾èµ–" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¾ªç¯ä¾èµ–"></a>ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¾ªç¯ä¾èµ–</h2><img src="https://oscimg.oschina.net/oscnet/up-4ac2f1ac005d007a18a0823719edb29abf7.png" width=300 height=168>

<p>å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼ŒAå¯¹è±¡çš„ä¸€ä¸ªå±æ€§æ˜¯B,Bå¯¹è±¡çš„ä¸€ä¸ªå±æ€§æ˜¯A,è€ŒSpringä¸­çš„beané»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªBeanå°±äº§ç”Ÿäº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼</p>
<blockquote>
<p>é‚£ä¹ˆå¾ªç¯ä¾èµ–çš„é—®é¢˜å‡ºç°åœ¨ä»€ä¹ˆæƒ…å†µå‘¢</p>
</blockquote>
<p>æƒ³ä¸€ä¸‹å±æ€§èµ‹å€¼çš„æ–¹å¼æœ‰å‡ ç§å‘¢ï¼Ÿ</p>
<ul>
<li>æ„é€ å™¨èµ‹å€¼<blockquote>
<p>è¿™ç§å½¢å¼å¾ªç¯ä¾èµ–é—®é¢˜æ— æ³•è§£å†³</p>
</blockquote>
</li>
<li>GET/SETæ–¹æ³•<blockquote>
<p>è°ƒç”¨SETæ–¹æ³•è¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ä¸‰çº§ç¼“å­˜çš„ç­–ç•¥æ¥è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜</p>
</blockquote>
</li>
</ul>
<p>æ‰€ä»¥ï¼Œä¸‰çº§ç¼“å­˜çš„ç­–ç•¥æ˜¯é’ˆå¯¹äºä½¿ç”¨SETæ–¹æ³•å¯¹å±æ€§èµ‹å€¼çš„åœºæ™¯ä¸‹çš„ï¼</p>
<h2 id="å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³"><a href="#å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³" class="headerlink" title="å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³"></a>å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³</h2><img src="https://oscimg.oschina.net/oscnet/up-eabac6749e665ea36856dce17c2119658a7.png">

<p>åœ¨å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå°†å¤„äºåŠæˆå“çš„å¯¹è±¡å…¨éƒ¨æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œæ–¹ä¾¿åç»­æ¥è¿›è¡Œè°ƒç”¨ï¼›<br>åªè¦æœ‰äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œé‚£ä¹ˆåç»­æ¥è¿›è¡Œèµ‹å€¼å³å¯ï¼›</p>
<blockquote>
<p>d èƒ½ä¸èƒ½å°†åˆ›å»ºå¥½çš„å¯¹è±¡ä¹Ÿæ”¾åˆ°ç¼“å­˜ä¸­å‘¢ï¼Ÿ</p>
</blockquote>
<p>ä¸èƒ½ï¼Œå¦‚æœæ”¾åœ¨ä¸€èµ·å°†æ— æ³•åŒºåˆ†å¯¹è±¡æ˜¯æˆå“å¯¹è±¡è¿˜æ˜¯åŠæˆå“å¯¹è±¡äº†<br>æ‰€ä»¥å†æ¬¡å¼•å‡ºå¤šçº§ç¼“å­˜çš„æ¦‚å¿µï¼Œå¯ä»¥åˆ›å»ºä¸¤ä¸ªç¼“å­˜å¯¹è±¡ï¼Œä¸€ä¸ªç”¨æ¥å­˜æ”¾å·²ç»å®ä¾‹åŒ–çš„åŠæˆå“å¯¹è±¡ï¼Œå¦ä¸€ä¸ªå­˜æ”¾å®Œæˆå®ä¾‹åŒ–å¹¶ä¸”å®Œæˆåˆå§‹åŒ–çš„æˆå“å¯¹è±¡ï¼Œè¿™ä¸ªåº”è¯¥æ¯”è¾ƒå¥½ç†è§£å§ï¼</p>
<blockquote>
<p>æ€è€ƒä¸€ä¸‹ä»¥ä¸Šçš„è®¾è®¡æœ‰æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿ</p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</h3><p>Springåœ¨è§£å†³å¯¹è±¡Beanå¾ªç¯ä¾èµ–çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº†ã€Œä¸‰çº§ç¼“å­˜ã€ï¼›<br>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªMapå¯¹è±¡ï¼›</p>
<blockquote>
<p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸€çº§ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> ConcurrentHashMap(<span class="number">256</span>);</span><br><span class="line"><span class="comment">// äºŒçº§ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> HashMap(<span class="number">16</span>);</span><br><span class="line"><span class="comment">// ä¸‰çº§ç¼“å­˜</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> HashMap(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>







<blockquote>
<p>ä¸‰çº§ç¼“å­˜ä¸­åˆ†åˆ«ä¿å­˜çš„æ˜¯ä»€ä¹ˆå†…å®¹</p>
</blockquote>
<ul>
<li>ä¸€çº§ç¼“å­˜ï¼š æˆå“å¯¹è±¡</li>
<li>äºŒçº§ç¼“å­˜ï¼š åŠæˆå“å¯¹è±¡</li>
<li>ä¸‰çº§ç¼“å­˜ï¼› lambdaè¡¨è¾¾å¼</li>
</ul>
<blockquote>
<p>å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜å¯ä¸å¯è¡Œ</p>
</blockquote>
<p>åœ¨Springæºç ä¸­ï¼Œåªæœ‰addSingletonæ–¹æ³•å’ŒdoCreateBeanæ–¹æ³•ä¸­å‘ä¸‰çº§ç¼“å­˜ä¸­æ·»åŠ ä¸œè¥¿çš„ï¼›</p>
<p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#addSingletonFactory</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addSingleton</span><span class="params">(String beanName, Object singletonObject)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">synchronized</span>(<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">           <span class="keyword">this</span>.singletonObjects.put(beanName, singletonObject);</span><br><span class="line">           <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">           <span class="keyword">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">           <span class="keyword">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String, boolean)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> Object <span class="title">getSingleton</span><span class="params">(String beanName, <span class="keyword">boolean</span> allowEarlyReference)</span> </span>&#123;</span><br><span class="line">       Object singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">       <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">           <span class="keyword">synchronized</span>(<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">               singletonObject = <span class="keyword">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">               <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                   ObjectFactory&lt;?&gt; singletonFactory = (ObjectFactory)<span class="keyword">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                   <span class="keyword">if</span> (singletonFactory != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       singletonObject = singletonFactory.getObject();</span><br><span class="line">                       <span class="keyword">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                       <span class="keyword">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> singletonObject;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getSingleton</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> </span>&#123;</span><br><span class="line">       Assert.notNull(beanName, <span class="string">&quot;Bean name must not be null&quot;</span>);</span><br><span class="line">       <span class="keyword">synchronized</span>(<span class="keyword">this</span>.singletonObjects) &#123;</span><br><span class="line">           Object singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">           <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (<span class="keyword">this</span>.singletonsCurrentlyInDestruction) &#123;</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationNotAllowedException(beanName, <span class="string">&quot;Singleton bean creation not allowed while singletons of this factory are in destruction (Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">                   <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Creating shared instance of singleton bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">this</span>.beforeSingletonCreation(beanName);</span><br><span class="line">               <span class="keyword">boolean</span> newSingleton = <span class="keyword">false</span>;</span><br><span class="line">               <span class="keyword">boolean</span> recordSuppressedExceptions = <span class="keyword">this</span>.suppressedExceptions == <span class="keyword">null</span>;</span><br><span class="line">               <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                   <span class="keyword">this</span>.suppressedExceptions = <span class="keyword">new</span> LinkedHashSet();</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   singletonObject = singletonFactory.getObject();</span><br><span class="line">                   newSingleton = <span class="keyword">true</span>;</span><br><span class="line">               &#125; <span class="keyword">catch</span> (IllegalStateException var16) &#123;</span><br><span class="line">                   singletonObject = <span class="keyword">this</span>.singletonObjects.get(beanName);</span><br><span class="line">                   <span class="keyword">if</span> (singletonObject == <span class="keyword">null</span>) &#123;</span><br><span class="line">                       <span class="keyword">throw</span> var16;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">catch</span> (BeanCreationException var17) &#123;</span><br><span class="line">                   BeanCreationException ex = var17;</span><br><span class="line">                   <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                       Iterator var8 = <span class="keyword">this</span>.suppressedExceptions.iterator();</span><br><span class="line"></span><br><span class="line">                       <span class="keyword">while</span>(var8.hasNext()) &#123;</span><br><span class="line">                           Exception suppressedException = (Exception)var8.next();</span><br><span class="line">                           ex.addRelatedCause(suppressedException);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">throw</span> ex;</span><br><span class="line">               &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                   <span class="keyword">if</span> (recordSuppressedExceptions) &#123;</span><br><span class="line">                       <span class="keyword">this</span>.suppressedExceptions = <span class="keyword">null</span>;</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">this</span>.afterSingletonCreation(beanName);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (newSingleton) &#123;</span><br><span class="line">                   <span class="keyword">this</span>.addSingleton(beanName, singletonObject);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> singletonObject;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Spring Family</category>
        <category>Spring Framework</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringåŠ è½½é…ç½®æ–‡ä»¶åŸç†</title>
    <url>/wiki/Spring%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="Springå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åº"><a href="#Springå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åº" class="headerlink" title="Springå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åº"></a>Springå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åº</h1><h2 id="åŠ è½½Xmlæ–‡ä»¶é…ç½®ï¼Œè·å–å¯¹è±¡"><a href="#åŠ è½½Xmlæ–‡ä»¶é…ç½®ï¼Œè·å–å¯¹è±¡" class="headerlink" title="åŠ è½½Xmlæ–‡ä»¶é…ç½®ï¼Œè·å–å¯¹è±¡"></a>åŠ è½½Xmlæ–‡ä»¶é…ç½®ï¼Œè·å–å¯¹è±¡</h2><blockquote>
<p>xmlæ–‡ä»¶</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.ibli.javaBase.reflection.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;12&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;gaolei&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æµ‹è¯•ç±»</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IocDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring-ioc.xml&quot;</span>);</span><br><span class="line">        User user = (User) ac.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Spring-åŠ è½½Xmlæ–‡ä»¶æµç¨‹"><a href="#Spring-åŠ è½½Xmlæ–‡ä»¶æµç¨‹" class="headerlink" title="Spring åŠ è½½Xmlæ–‡ä»¶æµç¨‹"></a>Spring åŠ è½½Xmlæ–‡ä»¶æµç¨‹</h2><blockquote>
<p>é¦–å…ˆçŒœæƒ³ä¸€ä¸‹å®è§‚çš„æµç¨‹</p>
</blockquote>
<img src="https://oscimg.oschina.net/oscnet/up-6aaea943c32e32e44e672c1850975bd40ae.png">

<p>æˆ‘ä»¬å¯ä»¥å¤§ä½“çŒœæƒ³æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå¦‚ä¸‹ğŸ‘‡</p>
<img src="https://oscimg.oschina.net/oscnet/up-992d3c9c618a021852b873f08b756824901.png">

<p>æ¥ä¸‹æ¥debugæºç çœ‹ä¸€ä¸‹å…·ä½“æµç¨‹ï¼š</p>
<blockquote>
<p>ClassPathXmlApplicationContextè°ƒç”¨refreshæ–¹æ³•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(String[] configLocations, <span class="keyword">boolean</span> refresh, ApplicationContext parent)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(parent);</span><br><span class="line">        <span class="keyword">this</span>.setConfigLocations(configLocations);</span><br><span class="line">        <span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">            <span class="comment">// Spring å¯åŠ¨å…¥å£</span></span><br><span class="line">            <span class="keyword">this</span>.refresh();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>   Spring å¯åŠ¨å…¥å£ this.refresh(); ğŸ‘†</p>
<blockquote>
<p>è°ƒç”¨AbstractRefreshableApplicationContextä¸‹çš„refreshBeanFactory</p>
</blockquote>
<p>org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">refreshBeanFactory</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.hasBeanFactory()) &#123;</span><br><span class="line">           <span class="keyword">this</span>.destroyBeans();</span><br><span class="line">           <span class="keyword">this</span>.closeBeanFactory();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           DefaultListableBeanFactory beanFactory = <span class="keyword">this</span>.createBeanFactory();</span><br><span class="line">           beanFactory.setSerializationId(<span class="keyword">this</span>.getId());</span><br><span class="line">           <span class="keyword">this</span>.customizeBeanFactory(beanFactory);</span><br><span class="line">           <span class="comment">// ä»è¿™é‡Œè¿›å…¥ä¸‹ä¸€æ­¥ ğŸ‘‡</span></span><br><span class="line">           <span class="keyword">this</span>.loadBeanDefinitions(beanFactory);</span><br><span class="line">           <span class="keyword">synchronized</span>(<span class="keyword">this</span>.beanFactoryMonitor) &#123;</span><br><span class="line">               <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (IOException var5) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;I/O error parsing bean definition source for &quot;</span> + <span class="keyword">this</span>.getDisplayName(), var5);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><font color=red>å…³é”®æ–¹æ³•æ˜¯this.loadBeanDefinitions(beanFactory);</font></p>
<blockquote>
<p> æ‰¾åˆ°XmlBeanDefinitionReader è¿™æ˜¯è¯»å–é…ç½®çš„å…³é”®æ‰€åœ¨</p>
</blockquote>
<p>å…³é”®å¯¹è±¡ <font color=red>XmlBeanDefinitionReader</font> è¿™ä¸ªåœ¨ ã€Œæ¢³ç†Springå¯åŠ¨è„‰ç»œã€ä¸­æåˆ°äº†ï¼ŒSpringæä¾›çš„æŠ½è±¡æ¥å£ï¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">loadBeanDefinitions</span><span class="params">(DefaultListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException, IOException </span>&#123;</span><br><span class="line">       XmlBeanDefinitionReader beanDefinitionReader = <span class="keyword">new</span> XmlBeanDefinitionReader(beanFactory);</span><br><span class="line">       beanDefinitionReader.setEnvironment(<span class="keyword">this</span>.getEnvironment());</span><br><span class="line">       beanDefinitionReader.setResourceLoader(<span class="keyword">this</span>);</span><br><span class="line">       beanDefinitionReader.setEntityResolver(<span class="keyword">new</span> ResourceEntityResolver(<span class="keyword">this</span>));</span><br><span class="line">       <span class="comment">// åˆå§‹åŒ–beanDefinitionReaderå¯¹è±¡</span></span><br><span class="line">       <span class="keyword">this</span>.initBeanDefinitionReader(beanDefinitionReader);</span><br><span class="line">       <span class="comment">// åŠ è½½é…ç½®æ–‡ä»¶ è·å¾—BeanDefinitions</span></span><br><span class="line">       <span class="keyword">this</span>.loadBeanDefinitions(beanDefinitionReader);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç»§ç»­è°ƒç”¨ loadBeanDefinitions è¿™ä¸ªæœ‰å¾ˆå¤šé‡è½½æ–¹æ³•ï¼Œä¸€ç›´ç‚¹ä¸‹å»å°±è¡Œï¼</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">loadBeanDefinitions</span><span class="params">(XmlBeanDefinitionReader reader)</span> <span class="keyword">throws</span> BeansException, IOException </span>&#123;</span><br><span class="line">        Resource[] configResources = <span class="keyword">this</span>.getConfigResources();</span><br><span class="line">        <span class="keyword">if</span> (configResources != <span class="keyword">null</span>) &#123;</span><br><span class="line">            reader.loadBeanDefinitions(configResources);</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        String[] configLocations = <span class="keyword">this</span>.getConfigLocations();</span><br><span class="line">         <span class="comment">//spring-ioc.xml</span></span><br><span class="line">        <span class="keyword">if</span> (configLocations != <span class="keyword">null</span>) &#123;</span><br><span class="line">            reader.loadBeanDefinitions(configLocations);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>configLocations å°±æ˜¯æˆ‘ä»¬Xmlé…ç½®æ–‡ä»¶çš„è·¯å¾„</p>
<blockquote>
<p>æ¥ä¸‹æ¥ä¸€ç›´è°ƒç”¨loadBeanDefinitionsæ–¹æ³• ç›´åˆ°è¿™ä¸€æ­¥ ğŸ‘‡</p>
</blockquote>
<p>org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">                InputStream inputStream = encodedResource.getResource().getInputStream();</span><br><span class="line">                Throwable var4 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    InputSource inputSource = <span class="keyword">new</span> InputSource(inputStream);</span><br><span class="line">                    <span class="keyword">if</span> (encodedResource.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        inputSource.setEncoding(encodedResource.getEncoding());</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    var6 = <span class="keyword">this</span>.doLoadBeanDefinitions(inputSource, encodedResource.getResource());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var24) &#123;</span><br><span class="line">                    var4 = var24;</span><br><span class="line">                    <span class="keyword">throw</span> var24;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (inputStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (var4 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                inputStream.close();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Throwable var23) &#123;</span><br><span class="line">                                var4.addSuppressed(var23);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            inputStream.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ° <font color=red >nputStream</font> å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæ˜¯é€šè¿‡IOæµè¯»å–åˆ¶å®šä½ç½®çš„æ–‡ä»¶çš„ !</p>
<blockquote>
<p> è·å–åˆ°æ–‡ä»¶è¾“å…¥æµä¹‹åï¼Œå°†è¾“å…¥æµè½¬æ¢æˆDocumentæ–‡ä»¶å»è§£æ</p>
</blockquote>
<p>protected int doLoadBeanDefinitions(InputSource inputSource, Resource resource) throws BeanDefinitionStoreException </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢æˆDocumentçš„å…³é”®æ–¹æ³•</span></span><br><span class="line">Document doc = <span class="keyword">this</span>.doLoadDocument(inputSource, resource);</span><br></pre></td></tr></table></figure>


<blockquote>
<p>è°ƒç”¨doRegisterBeanDefinitionsæ–¹æ³•</p>
</blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitions<br>è°ƒç”¨parseBeanDefinitionsæ–¹æ³•å»è§£ææ•°æ®</p>
<blockquote>
<p>è°ƒç”¨DefaultBeanDefinitionDocumentReaderçš„parseBeanDefinitionsæ–¹æ³• æ¥è§£æElement</p>
</blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseBeanDefinitions</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">parseBeanDefinitions</span><span class="params">(Element root, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">           NodeList nl = root.getChildNodes();</span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nl.getLength(); ++i) &#123;</span><br><span class="line">               Node node = nl.item(i);</span><br><span class="line">               <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">                   Element ele = (Element)node;</span><br><span class="line">                   <span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line">                       <span class="keyword">this</span>.parseDefaultElement(ele, delegate);</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       delegate.parseCustomElement(ele);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           delegate.parseCustomElement(root);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è°ƒç”¨parseDefaultElementæ–¹æ³•</p>
</blockquote>
<p>org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;import&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">this</span>.importBeanDefinitionResource(ele);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;alias&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">this</span>.processAliasRegistration(ele);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;bean&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">this</span>.processBeanDefinition(ele, delegate);</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, <span class="string">&quot;beans&quot;</span>)) &#123;</span><br><span class="line">           <span class="keyword">this</span>.doRegisterBeanDefinitions(ele);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçœ‹åˆ°<code>if (delegate.nodeNameEquals(ele, &quot;bean&quot;))</code> ä¼šä¸ä¼šå¾ˆå…´å¥‹å‘¢ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§£æçš„æ–¹æ³•äº†ğŸ‘‡ </p>
<blockquote>
<p> è·³è½¬åˆ° processBeanDefinition(ele, delegate);</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processBeanDefinition</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ˜¯çš„ å°±æ˜¯è¿™ä¸ªæ–¹æ³•äº† ğŸ‘‰</span></span><br><span class="line">        BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele);</span><br><span class="line">        <span class="keyword">if</span> (bdHolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">            bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, <span class="keyword">this</span>.getReaderContext().getRegistry());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BeanDefinitionStoreException var5) &#123;</span><br><span class="line">                <span class="keyword">this</span>.getReaderContext().error(<span class="string">&quot;Failed to register bean definition with name &#x27;&quot;</span> + bdHolder.getBeanName() + <span class="string">&quot;&#x27;&quot;</span>, ele, var5);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.getReaderContext().fireComponentRegistered(<span class="keyword">new</span> BeanComponentDefinition(bdHolder));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>parseBeanDefinitionElement å°†å…ƒç´ æ•°æ®è§£æåˆ°beanDefinition</p>
</blockquote>
<p>org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanDefinitionHolder <span class="title">parseBeanDefinitionElement</span><span class="params">(Element ele, <span class="meta">@Nullable</span> BeanDefinition containingBean)</span> </span>&#123;</span><br><span class="line">        String id = ele.getAttribute(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        String nameAttr = ele.getAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        List&lt;String&gt; aliases = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasLength(nameAttr)) &#123;</span><br><span class="line">            String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, <span class="string">&quot;,; &quot;</span>);</span><br><span class="line">            aliases.addAll(Arrays.asList(nameArr));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String beanName = id;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(id) &amp;&amp; !aliases.isEmpty()) &#123;</span><br><span class="line">            beanName = (String)aliases.remove(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.trace(<span class="string">&quot;No XML &#x27;id&#x27; specified - using &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; as bean name and &quot;</span> + aliases + <span class="string">&quot; as aliases&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (containingBean == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.checkNameUniqueness(beanName, aliases, ele);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å°†elementæ•°æ®æœ€ç»ˆè½¬æ¢æˆä¸€ä¸ªbeanDefinitionå¯¹è±¡ æ˜¯ä¸æ˜¯å¾ˆæƒŠå¥‡ å“ˆå“ˆå“ˆ</span></span><br><span class="line">     ğŸ‘‰ AbstractBeanDefinition beanDefinition = <span class="keyword">this</span>.parseBeanDefinitionElement(ele, beanName, containingBean);</span><br><span class="line">        <span class="keyword">if</span> (beanDefinition != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!StringUtils.hasText(beanName)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (containingBean != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        beanName = BeanDefinitionReaderUtils.generateBeanName(beanDefinition, <span class="keyword">this</span>.readerContext.getRegistry(), <span class="keyword">true</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        beanName = <span class="keyword">this</span>.readerContext.generateBeanName(beanDefinition);</span><br><span class="line">                        String beanClassName = beanDefinition.getBeanClassName();</span><br><span class="line">                        <span class="keyword">if</span> (beanClassName != <span class="keyword">null</span> &amp;&amp; beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp; !<span class="keyword">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123;</span><br><span class="line">                            aliases.add(beanClassName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.logger.trace(<span class="string">&quot;Neither XML &#x27;id&#x27; nor &#x27;name&#x27; specified - using generated bean name [&quot;</span> + beanName + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception var9) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.error(var9.getMessage(), ele);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String[] aliasesArray = StringUtils.toStringArray(aliases);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BeanDefinitionHolder(beanDefinition, beanName, aliasesArray);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Spring Family</category>
        <category>Spring Framework</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Springæ¢³ç†å¯åŠ¨è„‰ç»œ</title>
    <url>/wiki/Spring%E6%A2%B3%E7%90%86%E5%90%AF%E5%8A%A8%E8%84%89%E7%BB%9C/</url>
    <content><![CDATA[<h1 id="Springæ˜¯å¦‚ä½•å¯åŠ¨çš„"><a href="#Springæ˜¯å¦‚ä½•å¯åŠ¨çš„" class="headerlink" title="Springæ˜¯å¦‚ä½•å¯åŠ¨çš„"></a>Springæ˜¯å¦‚ä½•å¯åŠ¨çš„</h1><p>Springæœ€å¤§çš„æ ¸å¿ƒå°±æ˜¯Beanå®¹å™¨ï¼›<br>å®¹å™¨ï¼š ä»å¯¹è±¡åˆ›å»ºï¼Œä½¿ç”¨å’Œé”€æ¯å…¨éƒ¨ç”±å®¹å™¨å¸®æˆ‘ä»¬æ§åˆ¶ï¼Œç”¨æˆ·ä»…ä»…ä½¿ç”¨å°±å¯ä»¥ã€‚</p>
<h2 id="ä¸¤å¤§æ ¸å¿ƒ"><a href="#ä¸¤å¤§æ ¸å¿ƒ" class="headerlink" title="ä¸¤å¤§æ ¸å¿ƒ"></a>ä¸¤å¤§æ ¸å¿ƒ</h2><ul>
<li>IOC æ§åˆ¶åè½¬</li>
<li>AOP é¢å‘åˆ‡é¢ç¼–ç¨‹</li>
</ul>
<p>æ€è€ƒï¼šæˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨Springçš„å‘¢ï¼Ÿ</p>
<blockquote>
<p> åŠ å…¥ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½bean æˆ‘ä»¬çŒœæƒ³ä¸€ä¸‹å¤§è‡´æµç¨‹æ˜¯æ€æ ·çš„</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">getPerson</span> <span class="attr">class</span>=<span class="string">com.ibli.Person</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">id</span> <span class="attr">value</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">age</span> <span class="attr">value</span>=<span class="string">20</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶å¦‚ä¸ŠğŸ‘†ï¼Œè¿™é‡Œæ˜¯ä¼ªä»£ç ï¼</p>
<p>å…ˆçŒœæƒ³å¤§è‡´æµç¨‹ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-c5313f104a205f008fde4f4b729507c80e7.png">


<p>é€šè¿‡ä¸Šé¢çŒœæƒ³åˆ›å»ºçš„å¯¹è±¡æµç¨‹ï¼Œåˆ›å»ºå‡ºå¯¹è±¡ï¼Œå¯¹è±¡å·²ç»å¥½äº†ï¼Œå°±æ˜¯ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œå†™ä¸€ä¸‹ä¼ªä»£ç å§ğŸ‘‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºä¸€ä¸ªApplicationContextå¯¹è±¡</span><br><span class="line">Object obj = applicationContext.getBean(<span class="string">&quot;bean name); </span></span><br></pre></td></tr></table></figure>

<p>æ€è€ƒï¼Œåˆ›å»ºçš„å¯¹è±¡å¦‚ä½•å­˜å‚¨ï¼Ÿ æˆ–è€…å®¹å™¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åº”è¯¥å¯ä»¥çŒœåˆ°æ˜¯Mapç»“æ„ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆMap,å…ˆä¸ç®¡ï¼›</p>
<img src="https://oscimg.oschina.net/oscnet/up-baea159953c9590bba80022b251df95a255.png" >

<blockquote>
<p>1ã€é¦–å…ˆå®¹å™¨æ˜¯åˆ›å»ºå¥½çš„ï¼Œå®¹å™¨åˆ›å»ºå¥½ä¹‹åï¼Œæ‰å¯ä»¥åŠ è½½é…ç½®æ–‡ä»¶</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬çŒœæƒ³çš„Map</p>
<blockquote>
<p>2ã€åŠ è½½é…ç½®æ–‡ä»¶</p>
</blockquote>
<p>é…ç½®æ–‡ä»¶å¯èƒ½ä¼šæœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚XMLæ ¼å¼ï¼Œpropertyæ ¼å¼ï¼Œyamlæ ¼å¼ï¼Œæ³¨è§£æ ¼å¼ï¼Œè¿™ä¸ªæ ¼å¼å„ä¸ç›¸åŒï¼Œåˆæ˜¯å¦‚ä½•åŠ è½½çš„å‘¢ï¼Ÿ<br>Springæä¾›äº†ä¸€ä¸ªæ¥å£ï¼ŒBeanDefinitionReader,å®ƒæœ‰ä¸€ä¸ªæŠ½è±¡å®ç°ç±»AbstractBeanDefinitionReaderï¼Œä¸åŒé…ç½®æ–‡ä»¶çš„Readeræ¥ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°å®ƒä»¬è‡ªå·±çš„é€»è¾‘ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesBeanDefinitionReader</span> <span class="keyword">extends</span> <span class="title">AbstractBeanDefinitionReader</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">GroovyBeanDefinitionReader</span> <span class="keyword">extends</span> <span class="title">AbstractBeanDefinitionReader</span> <span class="keyword">implements</span> <span class="title">GroovyObject</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">XmlBeanDefinitionReader</span> <span class="keyword">extends</span> <span class="title">AbstractBeanDefinitionReader</span></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>3ã€è¯»å–çš„é…ç½®æ–‡ä»¶ä¼šè½¬æ¢æˆSpringå®šä¹‰çš„æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯BeanDefinitionï¼›</p>
</blockquote>
<p>BeanDefinitionå®šä¹‰äº†ç±»çš„æ‰€æœ‰ç›¸å…³çš„æ•°æ®ï¼› æ­¤æ—¶å¾—åˆ°çš„BeanDefinitionçš„å±æ€§å€¼åªæ˜¯ã€Œç¬¦å·ç±»å‹ã€,å¹¶ä¸æ˜¯çœŸæ­£çš„å±æ€§å€¼ï¼›</p>
<p>æˆ‘ä»¬å¯èƒ½ä¼šè§è¿‡è¿™ä¸­åŠ è½½æ•°æ®æºçš„æ–¹å¼ğŸ‘‡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">dataSource</span> <span class="attr">class</span>=<span class="string">com.alibab.durid.pool.DruidDataSource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">url</span> <span class="attr">value</span>=<span class="string">$&#123;jdbc.url&#125;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">username</span> <span class="attr">value</span>=<span class="string">$&#123;jdbc.username&#125;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">password</span> <span class="attr">value</span>=<span class="string">$&#123;jdbc.password&#125;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<p>æ•°æ®æºçš„å…·ä½“é…ç½®æ˜¯æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ï¼Œå½“é€šè¿‡XmlBeanDefinitionReaderè¯»å–å¹¶è§£æåˆ°çš„BeanDefinitionï¼Œä»…ä»…æ˜¯å°†Xmlä¸­çš„æ–‡ä»¶æ•°æ®å­˜æ”¾åˆ°BeanDefinitionä¸­ï¼Œå±æ€§çš„å€¼æ˜¯${jdbc.url}è€Œä¸æ˜¯çœŸæ­£çš„æˆ‘ä»¬æ•°æ®æºçš„åœ°å€ï¼›</p>
<blockquote>
<p>4ã€å¾—åˆ°æ‰€æœ‰çš„BeanDefinitionä¹‹åï¼Œé€šè¿‡BeanFactoryPostProcessoræ¥å¤„ç†ä¸Šä¸€æ­¥éª¤ä¸­ï¼Œå±æ€§valueä¸æ˜¯çœŸå®æ•°æ®çš„é—®é¢˜</p>
</blockquote>
<p>æ¯”å¦‚PlaceHolderConfigurerSupport(å ä½ç¬¦å¤„ç†) ç»è¿‡å·¥å‚åç½®å¤„ç†å™¨å¤„ç†ä¹‹åï¼ŒBeanDefinitionçš„å±æ€§å€¼å°±æ˜¯çœŸå®éœ€è¦çš„æ•°æ®äº†ï¼›</p>
<blockquote>
<p>5ã€BeanDefinitionæ•°æ®å‡†å¤‡å®Œæˆä¹‹åï¼Œç”±BeanFactoryæ¥å®ŒæˆBeançš„åˆ›å»º</p>
</blockquote>
<ul>
<li>å®ä¾‹åŒ– å¯¹è±¡ä¸­åˆ†é…å †å†…å­˜ç­‰æ“ä½œ<blockquote>
<p>åå°„è°ƒç”¨æ— å‚æ„é€ å‡½æ•° åˆ›å»ºå¯¹è±¡ ä½†æ˜¯å±æ€§æ˜¯ç©ºçš„</p>
</blockquote>
</li>
<li>åˆå§‹åŒ–</li>
</ul>
<blockquote>
<p>6ã€åˆå§‹åŒ–ä¹‹å‰éœ€è¦å‡†å¤‡çš„å·¥ä½œ </p>
</blockquote>
<p>1ã€å‡†å¤‡BeanPostProcessors<br>2ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå‡†å¤‡ç›‘å¬å™¨ äº‹ä»¶ å¹¿æ’­å™¨</p>
<blockquote>
<p>7ã€åˆå§‹åŒ–ç¯èŠ‚æœ‰å¾ˆå¤šæ­¥éª¤</p>
</blockquote>
<ul>
<li><p>å¯¹è±¡çš„å¡«å……</p>
<blockquote>
<p>å…¶å®å°±æ˜¯è°ƒç”¨get/setæ–¹æ³•å¯¹å±æ€§èµ‹å€¼</p>
</blockquote>
</li>
<li><p>è°ƒç”¨awareæ–¹æ³•</p>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬çš„å¯¹è±¡ä¸­çš„å±æ€§æ˜¯BeanFactory æˆ‘ä»¬ä¸ç”¨è‡ªå·±å»å®ŒæˆsetBeanFactoryæ–¹æ³•ï¼Œåªéœ€è¦å½“å‰ç±»å®ç°BeanFactoryAwareæ–¹æ³•å³å¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactoryAware</span> <span class="keyword">extends</span> <span class="title">Aware</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory var1)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>å¤„ç†beforeæ“ä½œ</p>
</li>
<li><p>è°ƒç”¨initæ–¹æ³•</p>
</li>
<li><p>æ‰§è¡Œafteræ–¹æ³•</p>
<blockquote>
<p>beforeå’Œafteræ­¤å¤„æ˜¯è°ƒç”¨çš„BeanPostProcessorçš„æ–¹æ³•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å‰ç½®æ–¹æ³•</span><br><span class="line">postProcessBeforeInitialization</span><br><span class="line">// åç½®æ–¹æ³•</span><br><span class="line">postProcessAfterInitialization</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>8ã€æ‰§è¡Œåˆ°æ­¤ï¼Œå®Œæˆå¯¹è±¡çš„åˆ›å»ºï¼Œå¾—åˆ°ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„å¯¹è±¡</p>
</blockquote>
]]></content>
      <categories>
        <category>Spring Family</category>
        <category>Spring Framework</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-RTOé‡ä¼ è®¡æ•°å™¨çš„è®¡ç®—</title>
    <url>/wiki/TCP-RTO%E9%87%8D%E4%BC%A0%E8%AE%A1%E6%95%B0%E5%99%A8%E7%9A%84%E8%AE%A1%E7%AE%97/</url>
    <content><![CDATA[<blockquote>
<p>ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»äº†TCPè¶…æ—¶é‡ä¼ çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å®šæ—¶å™¨çš„ç­–ç•¥ï¼Œå½“å®šæ—¶å™¨è§„å®šæ—¶é—´å†…æœªæ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå°±ä¼šè§¦å‘æŠ¥æ–‡çš„é‡ä¼ ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼›é‚£ä¹ˆå®šæ—¶å™¨è¶…æ—¶æ—¶é—´ï¼ˆRTO Retramission Timeoutï¼‰æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ</p>
</blockquote>
<h2 id="ä»€ä¹ˆæ˜¯RTTï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RTTï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RTTï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RTTï¼Ÿ</h2><p>äº†è§£RTOå¦‚ä½•è®¡ç®—ä¹‹å‰ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µã€Œ <strong>RTT</strong> ã€ï¼›</p>
<image src="https://oscimg.oschina.net/oscnet/up-9b45623a3b0652d842ffa3eecea13e92183.png" width=550 height=400>   

<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»clientå‘é€ç¬¬ä¸€ä¸ªã€ŒSYNã€æŠ¥æ–‡ï¼Œåˆ°Serveræ¥å—åˆ°æŠ¥æ–‡ï¼Œå¹¶ä¸”è¿”å›ã€ŒSYN ACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ¥å—åˆ°Serverçš„ã€ŒACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ‰€ç»å†çš„æ—¶é—´ï¼Œå«åš1ä¸ªRTTæ—¶é—´ï¼›</p>
<h2 id="å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ"><a href="#å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ"></a>å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ</h2><p><img src="https://oscimg.oschina.net/oscnet/up-6c558bfea1825bf5d3b2da74e087cdde43a.png"></p>
<p>å¦‚ä¸Šå›¾ä¸¤ç§æƒ…å†µï¼š<br>ç¬¬ä¸€ç§ï¼Œå·¦ä¾§aå›¾æ‰€ç¤ºï¼Œå½“ä¸€ç«¯å‘é€çš„æ•°æ®æŠ¥ä¸¢å¤±åè¦è¿›è¡Œé‡ä¼ ï¼Œåˆ°é‡ä¼ ä¹‹åæ¥æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿™ç§åœºæ™¯ä¸‹è¯¥å¦‚ä½•è®¡ç®—RTTå‘¢ï¼Ÿå¼€å§‹æ—¶é—´æ˜¯æŒ‰ç…§ç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ—¶é—´å‘¢è¿˜æ˜¯æŒ‰ç…§é‡ä¼ æ•°æ®æŠ¥çš„æ—¶é—´å‘¢ï¼Ÿ</p>
<blockquote>
<p>æŒ‰ç…§å¸¸ç†æ¥è¯´ï¼Œå¦‚å³ä¾§bå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT2ä¸ºå‡†ï¼›</p>
</blockquote>
<p>ç¬¬äºŒç§ï¼Œå·¦ä¾§bå›¾æ‰€ç¤ºï¼Œç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ–‡æ—¶ï¼Œç”±äºç½‘ç»œæ—¶å»¶å¯¼è‡´RTOæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ®µçš„ç¡®è®¤æŠ¥æ–‡ï¼Œå‘é€ç«¯è¿›è¡Œé‡å‘ï¼Œä½†æ˜¯åœ¨åˆšåˆšé‡å‘ä¹‹åå°±æ”¶åˆ°äº†ç¬¬ä¸€æ¬¡æŠ¥æ–‡çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£è¿™ç§æƒ…å†µRTTè¯¥å¦‚ä½•è®¡ç®—å‘¢ï¼Ÿ</p>
<blockquote>
<p>å¦‚å³ä¾§aå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT1ä¸ºå‡†ï¼›</p>
</blockquote>
<p>å°±åƒä¸Šé¢æåŠçš„ä¸¤ç§æƒ…å†µï¼Œä¸€ä¼šä»¥ç¬¬ä¸€ä¸ªRTT1ä¸ºå‡†ï¼Œä¸€ä¼šä»¥RTT2ä¸ºå‡†ï¼Œé‚£ä¹ˆTCPåè®®å¦‚ä½•æ­£ç¡®çš„è®¡ç®—å‡ºRTTå‘¢ï¼Ÿ</p>
<h2 id="ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTT"><a href="#ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTT" class="headerlink" title="ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTT"></a>ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTT</h2><p>ä¹‹å‰çš„æ–‡ç« ä¸­åœ¨ä»‹ç»TCPè¶…æ—¶ä¸é‡ä¼ çš„ç¬”è®°ä¸­æœ‰ä»‹ç»é€šè¿‡ä½¿ç”¨Timtstampçš„æ–¹å¼æ¥åŒºåˆ†ç›¸åŒSeqåºåˆ—å·çš„ä¸åŒæŠ¥æ–‡ï¼Œ<br>å…¶å®åœ¨TCPæŠ¥æ–‡é¦–éƒ¨å­˜å‚¨Timestampçš„æ—¶å€™ï¼Œä¼šå­˜å‚¨æŠ¥æ–‡çš„å‘é€æ—¶é—´å’Œç¡®è®¤æ—¶é—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><image src="https://oscimg.oschina.net/oscnet/up-ad80265bbba417c72a8d02a5c0be7be5f83.png" width=800 height=230> </p>
<h2 id="å¦‚ä½•è®¡ç®—RTOï¼Ÿ"><a href="#å¦‚ä½•è®¡ç®—RTOï¼Ÿ" class="headerlink" title="å¦‚ä½•è®¡ç®—RTOï¼Ÿ"></a>å¦‚ä½•è®¡ç®—RTOï¼Ÿ</h2><p>ä¸Šé¢ğŸ‘†è¯´åˆ°äº†RTTå¦‚ä½•è®¡ç®—ï¼Œé‚£ä¸ªRTOå’ŒRTTæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ<br><image src="https://oscimg.oschina.net/oscnet/up-e25afa62f99830eb02c4c1df0c015dbde8a.png"><br> RTOçš„å–å€¼å°†ä¼šå½±å“åˆ°TCPçš„ä¼ è¾“æ•ˆç‡ä»¥åŠç½‘ç»œçš„ååé‡ï¼›</p>
<blockquote>
<p>é€šå¸¸æ¥è¯´RTOåº”è¯¥ç•¥å¤§äºRTTï¼Œå¦‚æœRTOå°äºRTTï¼Œåˆ™ä¼šé€ æˆå‘é€ç«¯é¢‘ç¹é‡å‘ï¼Œå¯èƒ½ä¼šé€ æˆç½‘ç»œé˜»å¡ï¼›å¦‚æœRTOè®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™æ¥å—ç«¯å·²ç»æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸èƒ½å‘é€å…¶ä»–æŠ¥æ–‡ï¼Œä¼šé€ æˆä¸¤ç«¯æ€§èƒ½çš„æµªè´¹å’Œç½‘ç»œååé‡çš„ä¸‹é™ï¼›</p>
</blockquote>
<h3 id="å¹³æ»‘RTO"><a href="#å¹³æ»‘RTO" class="headerlink" title="å¹³æ»‘RTO"></a>å¹³æ»‘RTO</h3><p>ç½‘ç»œçš„RTTæ˜¯ä¸æ–­çš„å˜åŒ–çš„ï¼Œæ‰€ä»¥è®¡ç®—RTOçš„æ—¶å€™ï¼Œåº”å½“è€ƒè™‘RTOçš„å¹³æ»‘æ€§ï¼Œå°½é‡é¿å…RTTæ³¢åŠ¨å¸¦æ¥çš„å¹²æ‰°ï¼Œä»¥æŠµæŒ¡ç¬æ—¶å˜åŒ–ï¼›</p>
<p><strong>å¹³æ»‘RTOåœ¨æ–‡æ¡£RFC793å®šä¹‰ï¼Œç»™å‡ºå¦‚ä¸‹è®¡ç®—æ–¹å¼ï¼š</strong></p>
<ul>
<li>SRTT (smoothed round-trip time) = ( Î± * SRTT ) + ((1 - Î±) * RTT)<blockquote>
<p>Î± ä» 0åˆ° 1(RFC æ¨è 0.9)ï¼Œè¶Šå¤§è¶Šå¹³æ»‘</p>
</blockquote>
</li>
<li>RTO = min[ UBOUND, max[ LBOUND, (Î² * SRTT) ] ]<blockquote>
<p>å¦‚ UBOUNDä¸º1åˆ†é’Ÿï¼ŒLBOUNDä¸º 1 ç§’é’Ÿï¼Œ Î²ä» 1.3 åˆ° 2 ä¹‹é—´ </p>
</blockquote>
</li>
</ul>
<p>è¿™ç§è®¡ç®—æ–¹å¼ä¸é€‚ç”¨äº RTT æ³¢åŠ¨å¤§(æ–¹å·®å¤§)çš„åœºæ™¯,å¦‚æœç½‘ç»œçš„RTTæ³¢åŠ¨å¾ˆå¤§ï¼Œä¼šé€ æˆRTOè°ƒæ•´ä¸åŠæ—¶ï¼›</p>
<h3 id="è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO"><a href="#è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO" class="headerlink" title="è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO"></a>è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO</h3><blockquote>
<p>RFC6298(RFC2988)ï¼Œå…¶ä¸­Î± = 1/8ï¼Œ Î² = 1/4ï¼ŒK = 4ï¼ŒG ä¸ºæœ€å°æ—¶é—´é¢—ç²’:</p>
</blockquote>
<ul>
<li><strong>é¦–æ¬¡è®¡ç®— RTOï¼ŒRä¸ºç¬¬ 1 æ¬¡æµ‹é‡å‡ºçš„ RTT</strong><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SRTT(smoothed round-trip time) = R</span><br><span class="line">RTTVAR(round-trip time variation) = R/2</span><br><span class="line">RTO = SRTT + max (G, K*RTTVAR)</span><br></pre></td></tr></table></figure></li>
<li><strong>åç»­è®¡ç®— RTOï¼ŒRâ€™ä¸ºæœ€æ–°æµ‹é‡å‡ºçš„ RTT</strong><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SRTT= (1-Î±)*SRTT+Î±*Râ€™</span><br><span class="line">RTTVAR=(1-Î²)*RTTVAR+Î²*|SRTT-Râ€™|</span><br><span class="line">RTO = SRTT + max (G, K*RTTVAR)</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-å››æ¬¡æŒ¥æ‰‹/æ–­å¼€è¿æ¥</title>
    <url>/wiki/TCP-%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B-%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5/</url>
    <content><![CDATA[<h1 id="TCPæ–­å¼€è¿æ¥"><a href="#TCPæ–­å¼€è¿æ¥" class="headerlink" title="TCPæ–­å¼€è¿æ¥"></a>TCPæ–­å¼€è¿æ¥</h1><h2 id="å››æ¬¡æŒ¥æ‰‹"><a href="#å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="å››æ¬¡æŒ¥æ‰‹"></a>å››æ¬¡æŒ¥æ‰‹</h2><img src="https://oscimg.oschina.net/oscnet/up-8d9a6b405e874bc02b91e453bd277c46d46.png" width=450 height=550>

<ul>
<li>å¼€å§‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯å¤„ç†ã€establishedã€‘çŠ¶æ€</li>
<li>å®¢æˆ·ç«¯å‘é€ã€ŒFINã€æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥FIN-WAIT-1çŠ¶æ€</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„FINä¹‹åï¼Œæ¢å¤ä¸€ä¸ªACKï¼ŒåŒæ—¶è¿›å…¥CLOSE_WAITçŠ¶æ€</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶åˆ°ACKä¹‹åï¼Œè¿›å…¥åˆ°FIN-WAIT-2çŠ¶æ€</li>
<li>æœåŠ¡ç«¯æ¥ç€å‘é€FINæŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥LAST-ACKçŠ¶æ€</li>
<li>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„FINæŠ¥æ–‡ä¹‹åï¼Œå‘é€ACKæŠ¥æ–‡ï¼Œå¹¶è¿›å…¥TIME_WAITçŠ¶æ€</li>
<li>å®¢æˆ·ç«¯åœ¨ç»å†2ä¸ªMSLæ—¶é—´ä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€</li>
<li>æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€</li>
</ul>
<blockquote>
<p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„å››æ¬¡æŒ¥æ‰‹éƒ½æ˜¯ä¸Šè¿°æµç¨‹ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶å‘é€å…³é—­è¿æ¥çš„è¯·æ±‚å¦‚ä¸‹ğŸ‘‡ï¼š</p>
</blockquote>
<img src="https://oscimg.oschina.net/oscnet/up-d859884b062bda56a946ae9e3c0c148235b.png" width=450 height=550>

<p>å¯ä»¥çœ‹åˆ°åŒæ–¹éƒ½ä¸»åŠ¨å‘èµ·æ–­å¼€è¯·æ±‚æ‰€ä»¥å„è‡ªéƒ½æ˜¯ä¸»åŠ¨å‘èµ·æ–¹ï¼ŒçŠ¶æ€ä¼šä» FIN_WAIT_1 éƒ½è¿›å…¥åˆ° CLOSING è¿™ä¸ªè¿‡åº¦çŠ¶æ€ç„¶åå†åˆ° TIME_WAITã€‚</p>
<blockquote>
<p>æŒ¥æ‰‹ä¸€å®šéœ€è¦å››æ¬¡å—ï¼Ÿ</p>
</blockquote>
<p>å‡è®¾ client å·²ç»æ²¡æœ‰æ•°æ®å‘é€ç»™ server äº†ï¼Œæ‰€ä»¥å®ƒå‘é€ FIN ç»™ server è¡¨æ˜è‡ªå·±æ•°æ®å‘å®Œäº†ï¼Œä¸å†å‘äº†ï¼Œå¦‚æœè¿™æ—¶å€™ server è¿˜æ˜¯æœ‰æ•°æ®è¦å‘é€ç»™ client é‚£ä¹ˆå®ƒå°±æ˜¯å…ˆå›å¤ ack ï¼Œç„¶åç»§ç»­å‘é€æ•°æ®ã€‚<br>ç­‰ server æ•°æ®å‘é€å®Œäº†ä¹‹åå†å‘ client å‘é€ FIN è¡¨æ˜å®ƒä¹Ÿå‘å®Œäº†ï¼Œç„¶åç­‰ client çš„ ACK è¿™ç§æƒ…å†µä¸‹å°±ä¼šæœ‰å››æ¬¡æŒ¥æ‰‹ã€‚<br>é‚£ä¹ˆå‡è®¾ client å‘é€ FIN ç»™ server çš„æ—¶å€™ server ä¹Ÿæ²¡æ•°æ®ç»™ clientï¼Œé‚£ä¹ˆ server å°±å¯ä»¥å°† ACK å’Œå®ƒçš„ FIN ä¸€èµ·å‘ç»™client ï¼Œç„¶åç­‰å¾… client çš„ ACKï¼Œè¿™æ ·ä¸å°±ä¸‰æ¬¡æŒ¥æ‰‹äº†ï¼Ÿ</p>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦æœ‰ TIME_WAIT?</p>
</blockquote>
<p>æ–­å¼€è¿æ¥å‘èµ·æ–¹åœ¨æ¥å—åˆ°æ¥å—æ–¹çš„ FIN å¹¶å›å¤ ACK ä¹‹åå¹¶æ²¡æœ‰ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€æ³¢ç­‰å¾…ï¼Œç­‰å¾…æ—¶é—´ä¸º 2MSLã€‚MSL æ˜¯ Maximum Segment Lifetimeï¼Œå³æŠ¥æ–‡æœ€é•¿ç”Ÿå­˜æ—¶é—´ï¼ŒRFC 793 å®šä¹‰çš„ MSL æ—¶é—´æ˜¯ 2 åˆ†é’Ÿï¼ŒLinux å®é™…å®ç°æ˜¯ 30sï¼Œé‚£ä¹ˆ 2MSL æ˜¯ä¸€åˆ†é’Ÿã€‚</p>
<blockquote>
<p><font color=red >é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç­‰ 2MSL å‘¢ï¼Ÿ</font></p>
</blockquote>
<ul>
<li>å°±æ˜¯æ€•è¢«åŠ¨å…³é—­æ–¹æ²¡æœ‰æ”¶åˆ°æœ€åçš„ ACKï¼Œå¦‚æœè¢«åŠ¨æ–¹ç”±äºç½‘ç»œåŸå› æ²¡æœ‰åˆ°ï¼Œé‚£ä¹ˆå®ƒä¼šå†æ¬¡å‘é€ FINï¼Œ æ­¤æ—¶å¦‚æœä¸»åŠ¨å…³é—­æ–¹å·²ç» CLOSED é‚£å°±å‚»äº†ï¼Œå› æ­¤ç­‰ä¸€ä¼šå„¿ã€‚</li>
<li>å‡è®¾ç«‹é©¬æ–­å¼€è¿æ¥ï¼Œä½†æ˜¯åˆé‡ç”¨äº†è¿™ä¸ªè¿æ¥ï¼Œå°±æ˜¯äº”å…ƒç»„å®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”åºå·è¿˜åœ¨åˆé€‚çš„èŒƒå›´å†…ï¼Œè™½ç„¶æ¦‚ç‡å¾ˆä½ä½†ç†è®ºä¸Šä¹Ÿæœ‰å¯èƒ½ï¼Œé‚£ä¹ˆæ–°çš„è¿æ¥ä¼šè¢«å·²å…³é—­è¿æ¥é“¾è·¯ä¸Šçš„ä¸€äº›æ®‹ç•™æ•°æ®å¹²æ‰°ï¼Œå› æ­¤ç»™äºˆä¸€å®šçš„æ—¶é—´æ¥å¤„ç†ä¸€äº›æ®‹ç•™æ•°æ®ã€‚</li>
</ul>
<blockquote>
<p>ç­‰å¾… 2MSL ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
</blockquote>
<p>å¦‚æœæœåŠ¡å™¨ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆä¼šå‡ºç°å¤§é‡çš„èµ„æºå ç”¨ï¼Œéœ€è¦ç­‰åˆ° 2MSL æ‰ä¼šé‡Šæ”¾èµ„æºã€‚<br>å¦‚æœæ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆåœ¨ 2MSL é‡Œé¢é‚£äº›ç«¯å£éƒ½æ˜¯è¢«å ç”¨çš„ï¼Œç«¯å£åªæœ‰ 65535 ä¸ªï¼Œå¦‚æœç«¯å£è€—å°½äº†å°±æ— æ³•å‘èµ·é€çš„è¿æ¥äº†ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæ¦‚ç‡å¾ˆä½ï¼Œè¿™ä¹ˆå¤šç«¯å£ä½ è¿™æ˜¯è¦å»ºç«‹å¤šå°‘ä¸ªè¿æ¥ï¼Ÿ</p>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡</title>
    <url>/wiki/TCP-%E5%A6%82%E4%BD%95%E5%87%8F%E5%B0%91%E5%B0%8F%E6%8A%A5%E6%96%87%E6%8F%90%E5%8D%87%E7%BD%91%E7%BB%9C%E6%95%88%E7%8E%87/</url>
    <content><![CDATA[<h1 id="å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡"><a href="#å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡" class="headerlink" title="å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡"></a>å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡</h1><p>æ¯ä¸€ä¸ªTCPæŠ¥æ–‡æ®µéƒ½åŒ…å«20å­—èŠ‚çš„IPå¤´éƒ¨å’Œ20å­—èŠ‚çš„TCPé¦–éƒ¨ï¼Œå¦‚æœæŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†å¾ˆå°‘çš„è¯ï¼Œç½‘ç»œæ•ˆç‡ä¼šå¾ˆå·®ï¼›</p>
<h2 id="SWS-Silly-Window-syndrome-ç³Šæ¶‚çª—å£ç»¼åˆç—‡"><a href="#SWS-Silly-Window-syndrome-ç³Šæ¶‚çª—å£ç»¼åˆç—‡" class="headerlink" title="SWS(Silly Window syndrome) ç³Šæ¶‚çª—å£ç»¼åˆç—‡"></a>SWS(Silly Window syndrome) ç³Šæ¶‚çª—å£ç»¼åˆç—‡</h2><image src="https://oscimg.oschina.net/oscnet/up-777275434842bda3be80da2687c4556ee3b.png" width=600 height=450 >

<p>å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºåœºæ™¯ï¼Œåœ¨ä¹‹å‰çš„æ»‘åŠ¨çª—å£å·²ç»äº†è§£è¿‡ï¼Œéšç€æœåŠ¡ç«¯å¤„ç†è¿æ¥æ•°æ®èƒ½åŠ›è¶Šæ¥è¶Šä½ï¼ŒæœåŠ¡ç«¯çš„å¯ç”¨çª—å£ä¸æ–­å‹ç¼©ï¼Œæœ€ç»ˆå¯¼è‡´çª—å£å…³é—­ï¼›</p>
<h3 id="SWS-é¿å…ç®—æ³•"><a href="#SWS-é¿å…ç®—æ³•" class="headerlink" title="SWS é¿å…ç®—æ³•"></a>SWS é¿å…ç®—æ³•</h3><p>SWS é¿å…ç®—æ³•å¯¹å‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½åšå®¢</p>
<ul>
<li>æ¥æ”¶æ–¹<blockquote>
<p>David D Clark ç®—æ³•:çª—å£è¾¹ç•Œç§»åŠ¨å€¼å°äº min(MSS, ç¼“å­˜/2)æ—¶ï¼Œ<br>é€šçŸ¥çª—å£ä¸º 0</p>
</blockquote>
</li>
<li>å‘é€æ–¹<blockquote>
<p>Nagle ç®—æ³•:<br>1ã€TCP_NODELAY ç”¨äºå…³é—­ Nagle ç®—æ³•<br>2ã€æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç«‹åˆ»å‘é€æ•°æ®<br>3ã€å­˜åœ¨æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç›´åˆ°:1-æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µï¼Œæˆ–è€… 2-æ•°æ®é•¿åº¦è¾¾åˆ°MSSæ—¶å†å‘é€</p>
</blockquote>
</li>
</ul>
<h2 id="TCP-delayed-acknowledgment-å»¶è¿Ÿç¡®è®¤"><a href="#TCP-delayed-acknowledgment-å»¶è¿Ÿç¡®è®¤" class="headerlink" title="TCP delayed acknowledgment å»¶è¿Ÿç¡®è®¤"></a>TCP delayed acknowledgment å»¶è¿Ÿç¡®è®¤</h2><p>å®é™…æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æºå¸¦ä»»ä½•æ•°æ®çš„ACKæŠ¥æ–‡ä¹Ÿä¼šé€ æˆç½‘ç»œæ•ˆç‡ä½ä¸‹çš„ï¼Œå› ä¸ºç¡®è®¤æŠ¥æ–‡ä¹ŸåŒ…å«40å­—èŠ‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä½†ä»…ä»…æ˜¯ä¸ºäº†ä¼ è¾“ACK=1è¿™æ ·çš„ä¿¡æ¯ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼ŒTCPæœ‰ä¸€ç§æœºåˆ¶ï¼Œå«åšå»¶è¿Ÿç¡®è®¤ï¼Œå¦‚ä¸‹ğŸ‘‡ï¼š</p>
<ul>
<li>å½“æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶,ackä¼šéšç€å“åº”æ•°æ®ç«‹å³å‘é€ç»™å¯¹æ–¹.</li>
<li>å¦‚æœæ²¡æœ‰å“åº”æ•°æ®,ackçš„å‘é€å°†ä¼šæœ‰ä¸€ä¸ªå»¶è¿Ÿ,ä»¥ç­‰å¾…çœ‹æ˜¯å¦æœ‰å“åº”æ•°æ®å¯ä»¥ä¸€èµ·å‘é€</li>
<li>å¦‚æœåœ¨ç­‰å¾…å‘é€ackæœŸé—´,å¯¹æ–¹çš„ç¬¬äºŒä¸ªæ•°æ®æ®µåˆåˆ°è¾¾äº†,è¿™æ—¶è¦ç«‹å³å‘é€ack</li>
</ul>
<h3 id="é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ"><a href="#é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ"></a>é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ</h3><image src="https://oscimg.oschina.net/oscnet/up-5933d7b1310c191603f366eb55669a7cdc8.png" width=400 height=250>

<p>ä¸Šé¢ğŸ‘†æ˜¯Linuxæ“ä½œç³»ç»Ÿå¯¹äºTCPå»¶æ—¶çš„å®šä¹‰ã€‚</p>
<p>HZæ˜¯ä»€å‘¢ï¼Ÿå…¶å®é‚£æ˜¯å’Œæ“ä½œç³»ç»Ÿçš„æ—¶é’Ÿç›¸å…³çš„ï¼Œå…·ä½“çš„æ“ä½œç³»ç»Ÿé—´å„æœ‰å·®åˆ«ï¼›<br>å¦‚ä½•æŸ¥çœ‹Linuxæ“ä½œç³»ç»Ÿä¸‹çš„HZå¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /boot/config- `-uname -r` | grep &#x27;^GONFIG_HZ=&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="TCP-CORK"><a href="#TCP-CORK" class="headerlink" title="TCP_CORK"></a>TCP_CORK</h2><blockquote>
<p>sendfile é›¶æ‹·è´æŠ€æœ¯</p>
</blockquote>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-æ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨</title>
    <url>/wiki/TCP-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E4%B9%8B%E6%85%A2%E5%90%AF%E5%8A%A8/</url>
    <content><![CDATA[<p>ç”±äºTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ä¼ è¾“åè®®ï¼Œå¯ä»¥å‘é€ä¸å®šé•¿çš„å­—èŠ‚æµæ•°æ®ï¼ŒTCPè¿æ¥å‘é€æ•°æ®æ—¶ä¼šâ€œå…ˆå¤©æ€§â€å°è¯•å ç”¨æ•´ä¸ªå¸¦å®½ï¼Œè€Œå½“æ‰€æœ‰çš„TCPè¿æ¥éƒ½å°è¯•å ç”¨ç½‘ç»œå¸¦å®½æ—¶ï¼Œå°±ä¼šé€ æˆç½‘ç»œçš„å µå¡ï¼Œè€ŒTCPæ…¢å¯åŠ¨ç®—æ³•åˆ™æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€åœºæ™¯ï¼›</p>
<h2 id="å…¨å±€æ€è€ƒ"><a href="#å…¨å±€æ€è€ƒ" class="headerlink" title="å…¨å±€æ€è€ƒ"></a>å…¨å±€æ€è€ƒ</h2><img src="https://oscimg.oschina.net/oscnet/up-b70475e1aadd0776c54efdd5ecf26ef2606.png" width=700 height=400>

<p>æ‹¥å¡æ§åˆ¶è¦é¢å‘æ•´ä½“æ€è€ƒï¼Œå¦‚ä¸ŠğŸ‘†ç½‘ç»œæ‹“æ‰‘å›¾ï¼Œå½“å·¦è¾¹çš„ç½‘ç»œèŠ‚ç‚¹é€šè¿‡è·¯ç”±äº¤æ¢è®¾å¤‡å‘å³è¾¹çš„è®¾å¤‡ä¼ è¾“æŠ¥æ–‡çš„æ—¶å€™ï¼Œä¸­é—´çš„æŸä¸€é“¾è·¯çš„å¸¦å®½è‚¯å®šæ˜¯ä¸€å®šçš„ï¼Œè¿™é‡Œå‡è®¾1000Må¸¦å®½ï¼Œå½“å·¦è¾¹R1ä»¥700Mb/sçš„é€Ÿåº¦å‘é“¾è·¯ä¸­å‘é€æ•°æ®ï¼ŒåŒæ—¶R2ä»¥600Mb/sçš„é€Ÿç‡å‘é€æŠ¥æ–‡ï¼Œé‚£åŠ¿å¿…ä¼šæœ‰300Mbçš„æ•°æ®æŠ¥ä¸¢å¤±ï¼›ã€Œè·¯ç”±äº¤æ¢è®¾å¤‡åŸºäºå­˜å‚¨è½¬å‘æ¥å®ç°æŠ¥æ–‡çš„å‘é€ã€å¤§é‡æŠ¥æ–‡éƒ½æ˜¯æ—¶ï¼Œè·¯ç”±è®¾å¤‡çš„ç¼“å†²é˜Ÿåˆ—è‚¯å®šæ˜¯æ…¢çš„ï¼Œè¿™ä¹Ÿä¼šé€ æˆæŸäº›æ•°æ®æŠ¥åœ¨ç½‘ç»œé“¾è·¯ä¸­åœç•™æ—¶é—´è¿‡é•¿ï¼Œä»è€Œå¯¼è‡´TCPé€šè®¯å˜æ…¢ï¼Œç”šè‡³ç½‘ç»œç˜«ç—ªï¼›</p>
<p>ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå½“é“¾è·¯å¸¦å®½å æ»¡ä»¥åï¼Œé“¾è·¯ä»¥æœ€å¤§å¸¦å®½ä¼ è¾“æ•°æ®ï¼Œå½“ç„¶æ˜¾ç¤ºä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå½“å‘ç”Ÿè½»åº¦æ‹¥å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡å°±å¼€å§‹ä¸‹é™äº†ï¼Œå‘å±•åˆ°ä¸¥é‡é˜»å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡ä¼šä¸¥é‡åœ°ä¸‹é™ï¼Œç”šè‡³ç˜«ç—ªï¼›</p>
<p>é‚£ä¹ˆï¼Œæ…¢å¯åŠ¨æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„å‘¢ï¼Ÿ</p>
<h2 id="æ‹¥å¡çª—å£"><a href="#æ‹¥å¡çª—å£" class="headerlink" title="æ‹¥å¡çª—å£"></a>æ‹¥å¡çª—å£</h2><blockquote>
<p>æ‹¥å¡çª—å£cwnd(congestion window)</p>
</blockquote>
<ul>
<li>é€šå‘Šçª—å£rwnd(receiverâ€˜s advertised window) <blockquote>
<p>å…¶å®å°±æ˜¯RCV.WNDï¼Œæ ‡å¿—åœ¨TCPé¦–éƒ¨çš„Windowå­—æ®µï¼</p>
</blockquote>
</li>
<li>å‘é€çª—å£swnd = min(cwndï¼Œrwnd)<blockquote>
<p>å‰é¢å­¦ä¹ æ»‘åŠ¨çª—å£çš„æ—¶å€™æåˆ°å‘é€çª—å£å¤§è‡´ç­‰äºæ¥å—çª—å£ï¼Œå½“å¼•å…¥æ‹¥å¡çª—å£æ—¶ï¼Œå‘é€çª—å£å°±æ˜¯æ‹¥å¡çª—å£å’Œå¯¹æ–¹æ¥å—çª—å£çš„æœ€å°å€¼</p>
</blockquote>
</li>
</ul>
<img src="https://oscimg.oschina.net/oscnet/up-4fffa8af1fb99c1ce534085f112fa9f065c.png" width=360 height=360>

<blockquote>
<p>æ¯æ”¶åˆ°ä¸€ä¸ªACKï¼Œcwndæ‰©å……ä¸€å€</p>
</blockquote>
<p>æ…¢å¯åŠ¨çš„çª—å£å¤§å°å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ<br>å¦‚ä¸Šæ‰€ç¤ºï¼Œèµ·åˆæ‹¥å¡çª—å£è®¾ç½®æˆ1ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå½“å‘é€ç«¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œè°ƒæ•´æ‹¥å¡çª—å£ä¸º2ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå¦‚æœè¿˜æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…ï¼Œä¸€æ¬¡ç±»æ¨ï¼ŒçŸ¥é“å‘ç”Ÿä¸¢åŒ…åœæ­¢ï¼›å‘é€çª—å£ä»¥ã€ŒæŒ‡æ•°ã€çš„æ–¹å¼æ‰©å¤§ï¼›æ…¢å¯åŠ¨æ˜¯æ— æ³•ç¡®çŸ¥ç½‘ç»œæ‹¥å¡ç¨‹åº¦çš„æƒ…å†µä¸‹ï¼Œä»¥è¯•æ¢æ€§åœ°æ–¹å¼å¿«é€Ÿæ‰©å¤§æ‹¥å¡çª—å£ï¼›</p>
<h2 id="æ…¢å¯åŠ¨åˆå§‹çª—å£"><a href="#æ…¢å¯åŠ¨åˆå§‹çª—å£" class="headerlink" title="æ…¢å¯åŠ¨åˆå§‹çª—å£"></a>æ…¢å¯åŠ¨åˆå§‹çª—å£</h2><p>æ…¢å¯åŠ¨çš„æ‹¥å¡çª—å£çœŸçš„å°±å¦‚ä¸Šé¢æ‰€è¯´çš„ä»¥ä¸€ä¸ªæŠ¥æ–‡æ®µå¤§å°ä½œä¸ºåˆå§‹å€¼å—ï¼Ÿ  </p>
<img src="https://oscimg.oschina.net/oscnet/up-e632e6592fd276be90e5cf65a8365b3ddfb.png" width=360 height=360>  

<blockquote>
<p>æ…¢å¯åŠ¨åˆå§‹çª—å£ IW(Initial Window)çš„å˜è¿</p>
</blockquote>
<ul>
<li>1 SMSS:RFC2001(1997)</li>
<li>2 - 4 SMSS:RFC2414(1998)<blockquote>
<p>IW = min (4<em>SMSS, max (2</em>SMSS, 4380 bytes))</p>
</blockquote>
</li>
<li>10 SMSS:RFC6928(2013)<blockquote>
<p>IW = min (10<em>MSS, max (2</em>MSS, 14600))</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>å…¶å®åœ¨å®é™…æƒ…å†µä¸‹ï¼Œäº’è”ç½‘ä¸­çš„ç½‘é¡µéƒ½åœ¨10ä¸ªmsså·¦å³ï¼Œå¦‚æœè¿˜æ˜¯ä»1ä¸ªmsså¼€å§‹ï¼Œåˆ™ä¼šæµªè´¹3ä¸ªRTTçš„æ—¶é—´ï¼›  </p>
</blockquote>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP-æ»‘åŠ¨çª—å£</title>
    <url>/wiki/TCP-%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3/</url>
    <content><![CDATA[<h1 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h1><blockquote>
<p>ä¹‹å‰å­¦ä¹ äº†PARæ–¹å¼çš„TCPè¶…æ—¶å’Œé‡ä¼ ï¼Œå…¶å®åœ¨è€ƒè™‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥çš„åŒæ—¶ï¼Œä¹Ÿåº”è¯¥è€ƒè™‘æ¥æ”¶æ–¹å¯¹äºæ•°æ®çš„å¤„ç†èƒ½åŠ›ï¼Œç”±æ­¤å¼•å‡ºæœ¬æ¬¡å­¦ä¹ çš„ä¸»é¢˜ â€“ æ»‘åŠ¨çª—å£</p>
</blockquote>
<h2 id="å‘é€ç«¯çª—å£"><a href="#å‘é€ç«¯çª—å£" class="headerlink" title="å‘é€ç«¯çª—å£"></a>å‘é€ç«¯çª—å£</h2><p>æ»‘åŠ¨çª—å£æŒ‰ç…§ä¼ è¾“æ•°æ®æ–¹å‘åˆ†ä¸ºä¸¤ç§ï¼Œå‘é€ç«¯çª—å£å’Œæ¥æ”¶ç«¯çª—å£ï¼›ä¸‹é¢å…ˆçœ‹ä¸€ä¸‹å‘é€ç«¯çª—å£ğŸ‘‡ï¼š</p>
<image src="https://oscimg.oschina.net/oscnet/up-13e77c53892b884d334614e4fa9550a1113.png">

<p>ä¸Šå›¾åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>å·²å‘é€å¹¶æ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:1-31 å­—èŠ‚</li>
<li>å·²å‘é€æœªæ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:32-45 å­—èŠ‚</li>
<li>æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…:46-51 å­—èŠ‚</li>
<li>æœªå‘é€ä½†æ€»å¤§å°è¶…å‡ºæ¥æ”¶æ–¹å¤„ç†èŒƒå›´:52-å­—èŠ‚</li>
</ol>
<h3 id="å¯ç”¨çª—å£å’Œå‘é€çª—å£"><a href="#å¯ç”¨çª—å£å’Œå‘é€çª—å£" class="headerlink" title="å¯ç”¨çª—å£å’Œå‘é€çª—å£"></a>å¯ç”¨çª—å£å’Œå‘é€çª—å£</h3><image src="https://oscimg.oschina.net/oscnet/up-b8bb072922232fe6d62aec3520647d869fe.png"> 

<p>å¦‚ä¸Šå›¾è¿™é‡Œå¯ä»¥å¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼šã€Œå¯ç”¨çª—å£ã€å’Œã€Œå‘é€çª—å£ã€</p>
<blockquote>
<p>ã€ <strong>å¯ç”¨çª—å£</strong> ã€‘ï¼š å°±æ˜¯ä¸Šå›¾ä¸­çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå±äºè¿˜æœªå‘é€ï¼Œä½†æ˜¯åœ¨æ¥æ”¶ç«¯å¯ä»¥å¤„ç†èŒƒå›´å†…çš„éƒ¨åˆ†ï¼›<br>ã€ <strong>å‘é€çª—å£</strong> ã€‘ï¼š å°±æ˜¯å‘é€ç«¯å¯ä»¥å‘é€çš„æœ€å¤§æŠ¥æ–‡å¤§å°ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ç¬¬äºŒéƒ¨åˆ†+ç¬¬ä¸‰éƒ¨åˆ†åˆæˆå‘é€çª—å£ï¼›</p>
</blockquote>
<h3 id="å¯ç”¨çª—å£è€—å°½"><a href="#å¯ç”¨çª—å£è€—å°½" class="headerlink" title="å¯ç”¨çª—å£è€—å°½"></a>å¯ç”¨çª—å£è€—å°½</h3><image src="https://oscimg.oschina.net/oscnet/up-333b88e14f6fd5833fd92a9ab45894e60dd.png"> 

<p>å¯ç”¨çª—å£ä¼šåœ¨ä¸€ä¸ªçŸ­æš‚çš„åœç•™ï¼Œå½“å¤„äºæœªå‘é€å¹¶ä¸”æ¥å—ç«¯å¯ä»¥æ¥å—èŒƒå›´å†…çš„æ•°æ®ä¼ è¾“å®Œæˆä¹‹åï¼Œå¯ç”¨çª—å£è€—å°½ï¼›<br>å½“ç„¶ä¸Šé¢ä»…ä»…è¯´çš„ä¸€ç¬æ—¶çš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå·²ç»å‘é€çš„æŠ¥æ–‡æ®µè¿˜æ²¡æœ‰ç¡®è®¤ï¼Œå¹¶ä¸”å‘é€çª—å£å¤§å°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å‘é€çª—å£è¾¾åˆ°æœ€å¤§çŠ¶æ€ï¼›</p>
<h3 id="çª—å£ç§»åŠ¨"><a href="#çª—å£ç§»åŠ¨" class="headerlink" title="çª—å£ç§»åŠ¨"></a>çª—å£ç§»åŠ¨</h3><image src="https://oscimg.oschina.net/oscnet/up-4436cdb5c6720e3e4a262ec1cad64660a77.png">  

<p>å¦‚æœåœ¨å‘é€çª—å£ä¸­å·²ç»å‘é€çš„æŠ¥æ–‡æ®µå·²ç»å¾—åˆ°æ¥å—ç«¯ç¡®è®¤ä¹‹åï¼Œé‚£éƒ¨åˆ†æ•°æ®å°±ä¼šè¢«ç§»é™¤å‘é€çª—å£ï¼Œåœ¨å‘é€çª—å£å¤§å°ä¸å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå‘é€çª—å£å‘å³â¡ï¸ç§»åŠ¨5ä¸ªå­—èŠ‚ï¼Œå› ä¸ºå·¦è¾¹å·²ç»å‘é€çš„5ä¸ªå­—èŠ‚å¾—åˆ°ç¡®è®¤ä¹‹åï¼Œè¢«ç§»é™¤å‘é€çª—å£ï¼›</p>
<h3 id="å¯ç”¨çª—å£å¦‚ä½•è®¡ç®—"><a href="#å¯ç”¨çª—å£å¦‚ä½•è®¡ç®—" class="headerlink" title="å¯ç”¨çª—å£å¦‚ä½•è®¡ç®—"></a>å¯ç”¨çª—å£å¦‚ä½•è®¡ç®—</h3><image src="https://oscimg.oschina.net/oscnet/up-76f97fc92f6940c7197ff9fcad3c187fd98.png">

<p>å†æ¬¡å¼•å‡ºä¸‰ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>SND.WND<blockquote>
<p>SND æŒ‡çš„æ˜¯å‘é€ç«¯ï¼ŒWNDæŒ‡çš„æ˜¯windowï¼Œä¹Ÿå°±æ˜¯å‘é€ç«¯çª—å£çš„æ„æ€</p>
</blockquote>
</li>
<li>SND.UNA<blockquote>
<p>UNA å°±æ˜¯un ACKçš„æ„æ€ï¼ŒæŒ‡çš„æ˜¯å·²ç»å‘é€ä½†æ˜¯æ²¡æœ‰æ²¡æœ‰ç¡®è®¤ å®ƒæŒ‡å‘çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„</p>
</blockquote>
</li>
<li>SND.NXT<blockquote>
<p>NXT æ˜¯nextçš„ä½ç½®ï¼Œæ˜¯å‘é€æ–¹æ¥ä¸‹æ¥è¦å‘é€çš„ä½ç½®ï¼Œå®ƒæŒ‡å‘å¯ç”¨çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„</p>
</blockquote>
</li>
</ul>
<p><strong>é‚£å°±å¾ˆå®¹æ˜“å¾—å‡ºå¯ç”¨çª—å£çš„å¤§å°äº†ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</strong></p>
<blockquote>
<p>Usable Window Size = SND.UNA + SND.WND - SND.NXT </p>
</blockquote>
<h2 id="æ¥æ”¶ç«¯çª—å£"><a href="#æ¥æ”¶ç«¯çª—å£" class="headerlink" title="æ¥æ”¶ç«¯çª—å£"></a>æ¥æ”¶ç«¯çª—å£</h2><p>ä¸Šé¢ä»‹ç»äº†å‘é€ç«¯çª—å£çš„ä¸€äº›æ¦‚å¿µï¼Œä¸‹é¢ğŸ‘‡æ˜¯æ¥æ”¶ç«¯çª—å£çš„å­¦ä¹ ï¼š</p>
<image src="https://oscimg.oschina.net/oscnet/up-0313775eaecc790ad26b44c3daa17ced593.png">

<ol>
<li>å·²ç»æ¥æ”¶å¹¶ä¸”å·²ç»ç¡®è®¤ :28-31 å­—èŠ‚</li>
<li>è¿˜æœªæ¥æ”¶å¹¶ä¸”æ¥æ”¶ç«¯å¯ä»¥æ¥å—:32-51 å­—èŠ‚</li>
<li>è¿˜æœªæ¥æ”¶å¹¶ä¸”è¶…å‡ºæ¥æ”¶å¤„ç†èƒ½åŠ›:51-57 å­—èŠ‚</li>
</ol>
<p>è¿™é‡Œå¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>RCV.WND<blockquote>
<p>RCVæ˜¯æ¥æ”¶ç«¯çš„æ„æ€ï¼ŒWNDæ˜¯æ¥å—ç«¯çª—å£çš„å¤§å°</p>
</blockquote>
</li>
<li>RCV.NXT<blockquote>
<p>NXTè¡¨ç¤ºçš„æ˜¯æ¥å—ç«¯æ¥æ”¶çª—å£çš„å¼€å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ–¹æ¥ä¸‹æ¥å¤„ç†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼›</p>
</blockquote>
</li>
</ul>
<p>RCV.WNDçš„å¤§å°æ¥å—ç«¯çš„å†…å­˜ä»¥åŠç¼“å†²åŒºå¤§å°æœ‰å…³ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ¥å—ç«¯çš„çª—å£å¤§å°å’Œå‘é€ç«¯å¤§å°å¤§è‡´ç›¸åŒï¼›<br>æ¥å—ç«¯å¯æ¥æ”¶çš„æ•°æ®èƒ½åŠ›å¯ä»¥é€šè¿‡TCPé¦–éƒ¨çš„Windowå­—æ®µè®¾ç½®ï¼Œä½†æ˜¯æ¥å—ç«¯çš„å¤„ç†èƒ½åŠ›æ˜¯å¯èƒ½éšæ—¶å˜åŒ–çš„ï¼Œæ‰€ä»¥æ¥å—ç«¯å’ŒæœåŠ¡ç«¯çš„çª—å£å¤§å°å¤§è‡´æ˜¯ä¸€æ ·çš„ï¼›</p>
<h2 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h2><p>ä¸‹é¢ğŸ‘‡æ ¹æ®ä¸€ä¸ªä¾‹å­æ¥é˜è¿°æµé‡æ§åˆ¶ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚ä¸€ä¸ª260å­—èŠ‚çš„æ–‡ä»¶ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼Œæ¯”è¾ƒç¹çï¼š</p>
<image src="https://oscimg.oschina.net/oscnet/up-08e7b2cd9ee3ddaa44bca900a1824e08b09.png" width=900 height=480> 

<blockquote>
<p>è¿™é‡Œå‡è®¾MSSå’Œçª—å£çš„å¤§å°ä¸å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶å®¢æˆ·ç«¯å’Œå‘é€ç«¯çŠ¶æ€å¦‚ä¸‹ï¼š<br>ã€ å®¢æˆ·ç«¯ ã€‘ï¼š å‘é€çª—å£é»˜è®¤360å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š200å­—èŠ‚<br>ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€çª—å£è®¾å®š200å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š360å­—èŠ‚</p>
</blockquote>
<p>Step1ï¼š å®¢æˆ·ç«¯å‘é€140å­—èŠ‚çš„æ•°æ®åˆ°æœåŠ¡ç«¯</p>
<blockquote>
<p>ã€å®¢æˆ·ç«¯ã€‘å‘é€140å­—èŠ‚ï¼Œã€SND.NXTã€‘ä»1-&gt;141 </p>
</blockquote>
<blockquote>
<p>ã€æœåŠ¡ç«¯ã€‘çŠ¶æ€ä¸å˜ï¼Œç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“çš„140å­—èŠ‚</p>
</blockquote>
<p>Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ï¼Œå‘é€80å­—èŠ‚å“åº”ä»¥åŠACK</p>
<blockquote>
<p>ã€ å®¢æˆ·ç«¯ ã€‘å‘é€140å­—èŠ‚ä¹‹åç­‰å¾…ã€ æœåŠ¡ç«¯ ã€‘çš„ACK</p>
</blockquote>
<blockquote>
<p>ã€ æœåŠ¡ç«¯ ã€‘å¯ç”¨çª—å£å³ç§»ï¼Œã€RCV.NXTã€‘ä»1-&gt;141<br>ã€ æœåŠ¡ç«¯ ã€‘å‘é€80å­—èŠ‚æ•°æ®ï¼Œã€SND.NXTã€‘ä»241-&gt;321</p>
</blockquote>
<p>Step3: å®¢æˆ·ç«¯æ¥æ”¶å“åº”ACKï¼Œå¹¶ä¸”å‘é€ACK </p>
<blockquote>
<p>ã€ å®¢æˆ·ç«¯ ã€‘å‘å‡ºçš„140å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»140å­—èŠ‚<br>ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶80å­—èŠ‚æ•°æ®ï¼Œã€RCV.NXTã€‘å³ç§»80å­—èŠ‚ï¼Œä»241-&gt;321</p>
</blockquote>
<p>Step4: æœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ï¼Œä½†æ˜¯280å­—èŠ‚è¶…å‡ºäº†å®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åˆ†æˆä¸¤éƒ¨åˆ†ä¼ è¾“ï¼Œå…ˆä¼ è¾“120å­—èŠ‚ï¼›</p>
<blockquote>
<p>ã€ æœåŠ¡ç«¯ ã€‘å‘é€120å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨120å­—èŠ‚ï¼Œä»321-&gt;441</p>
</blockquote>
<p>Step5: å®¢æˆ·ç«¯æ¥æ”¶æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¹¶å‘é€ACK</p>
<blockquote>
<p>ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶120å­—èŠ‚ï¼Œã€RCV.NXTã€‘ä»321-&gt;441</p>
</blockquote>
<p>Step6ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬äºŒæ­¥80å­—èŠ‚çš„ACK</p>
<blockquote>
<p>[ æœåŠ¡å™¨ ] 80å­—èŠ‚å¾—åˆ°ACK ã€SND.UNAã€‘ä»241-&gt;321</p>
</blockquote>
<p>Step7: æœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬4æ­¥çš„ç¡®è®¤</p>
<blockquote>
<p>ã€ æœåŠ¡ç«¯ ã€‘ä¹‹å‰å‘é€æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†çš„120å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»åŠ¨120ï¼Œä»321-&gt;441</p>
</blockquote>
<p>Step8: æœåŠ¡ç«¯å‘é€æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„160å­—èŠ‚</p>
<blockquote>
<p>ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€160å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601</p>
</blockquote>
<p>Step9: å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†160å­—èŠ‚ï¼ŒåŒæ—¶å‘é€ACK</p>
<blockquote>
<p>ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶160å­—èŠ‚ï¼Œã€RCV.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601</p>
</blockquote>
<p>Step10: æœåŠ¡ç«¯æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„ACK</p>
<blockquote>
<p>ã€ æœåŠ¡ç«¯ ã€‘å‘é€çš„160å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å‘å³ä¸€å®š160å­—èŠ‚ï¼Œä»441-&gt;601ï¼›è‡³æ­¤å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„å®Œæ•´çš„æ–‡ä»¶ï¼›</p>
</blockquote>
<p>ä¸Šé¢é€šè¿‡è¡¨æ ¼åˆ—ä¸¾æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¯ä¸ªçŠ¶æ€åœ¨æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œå¯ä»¥çœ‹å¦‚ä¸‹ç¤ºæ„å›¾è¾…åŠ©ç†è§£ï¼š</p>
<h3 id="å®¢æˆ·ç«¯äº¤äº’æµç¨‹"><a href="#å®¢æˆ·ç«¯äº¤äº’æµç¨‹" class="headerlink" title="å®¢æˆ·ç«¯äº¤äº’æµç¨‹"></a>å®¢æˆ·ç«¯äº¤äº’æµç¨‹</h3><image src="https://oscimg.oschina.net/oscnet/up-6ee487f0677efac1a822207f45fc0a2b842.png" width=500 >

<h3 id="æœåŠ¡ç«¯äº¤äº’æµç¨‹"><a href="#æœåŠ¡ç«¯äº¤äº’æµç¨‹" class="headerlink" title="æœåŠ¡ç«¯äº¤äº’æµç¨‹"></a>æœåŠ¡ç«¯äº¤äº’æµç¨‹</h3><image src="https://oscimg.oschina.net/oscnet/up-4a0095fb6e7a82a708e4df96dfdacd956aa.png" width="500"> 

<p>ä¸Šé¢ğŸ‘†æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ç»™åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£æ˜¯200å­—èŠ‚åœºæ™¯åŠ ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ•°æ®ä¼ è¾“ä¸äº¤äº’æµç¨‹ï¼Œé€šè¿‡è¿™ä¸ªæµç¨‹æ¥å­¦ä¹ æ»‘åŠ¨çª—å£çš„ç§»åŠ¨çŠ¶æ€å’Œæµé‡æ§åˆ¶çš„å¤§è‡´æµç¨‹ï¼›</p>
<h2 id="æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒº"><a href="#æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒº" class="headerlink" title="æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒº"></a>æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒº</h2><p>ä¸Šé¢ğŸ‘†è®²è¿°çš„æ—¶å€™ï¼Œéƒ½æ˜¯å‡è®¾çª—å£å¤§å°æ˜¯ä¸å˜çš„ï¼Œè€Œå®é™…ä¸Šï¼Œå‘é€ç«¯å’Œæ¥å—ç«¯çš„æ»‘åŠ¨çª—å£çš„å­—èŠ‚æ•°éƒ½åƒå­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿç¼“å†²åŒºçš„ï¼Œæ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºå—æ“ä½œç³»ç»Ÿæ§åˆ¶ï¼Œå½“åº”ç”¨è¿›ç¨‹å¢åŠ æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…çš„å†…å­˜å‡å°‘ï¼Œç¼“å†²åŒºå‡å°‘ï¼Œåˆ†é…ç»™æ¯ä¸ªè¿æ¥çš„çª—å£å°±ä¼šå‹ç¼©ã€‚**<font color="red">è€Œä¸”æ»‘åŠ¨çª—å£çš„å¤§å°ä¹Ÿå—åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®é€Ÿåº¦æœ‰å…³</font>**ï¼›</p>
<image src="https://oscimg.oschina.net/oscnet/up-3839118daafc840e059fa6f82d283bef7a9.png" width="500">   

<h3 id="åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©"><a href="#åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©" class="headerlink" title="åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©"></a>åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©</h3><p>step1: å®¢æˆ·ç«¯å‘é€140å­—èŠ‚</p>
<blockquote>
<p>å®¢æˆ·ç«¯å‘é€åˆ°140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£æ”¶ç¼©åˆ°220å­—èŠ‚ï¼Œå‘é€çª—å£ä¸å˜</p>
</blockquote>
<p>Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ ä½†æ˜¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚</p>
<blockquote>
<p>æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚ï¼Œä»æœ‰100å­—èŠ‚å ç”¨ç¼“å†²åŒºå¤§å°ï¼Œå¯¼è‡´æ¥å—çª—å£æ”¶ç¼©ï¼ŒæœåŠ¡ç«¯å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œåœ¨é¦–éƒ¨Windowå¸¦ä¸Šæ¥æ”¶çª—å£çš„å¤§å°260</p>
</blockquote>
<p>Step3: å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå‘é€çª—å£æ”¶ç¼©åˆ°260</p>
<p>Step4: å®¢æˆ·ç«¯ç»§ç»­å‘é€180å­—èŠ‚æ•°æ®</p>
<blockquote>
<p>å®¢æˆ·ç«¯å‘é€180å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ80å­—èŠ‚</p>
</blockquote>
<p>Step5: æœåŠ¡ç«¯æ¥æ”¶åˆ°180å­—èŠ‚</p>
<blockquote>
<p>å‡è®¾åº”ç”¨ç¨‹åºä»ç„¶ä¸è¯»å–è¿™180å­—èŠ‚ï¼Œæœ€ç»ˆä¹Ÿå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å†æ¬¡æ”¶ç¼©180å­—èŠ‚ï¼Œä»…å‰©ä¸‹80å­—èŠ‚ï¼Œåœ¨å‘é€ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œè®¾ç½®é¦–éƒ¨window=80</p>
</blockquote>
<p>Step6: å®¢æˆ·ç«¯æ”¶åˆ°80å­—èŠ‚çš„çª—å£æ—¶ï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º80å­—èŠ‚ï¼Œå¯ç”¨çª—å£ä¹Ÿæ˜¯80å­—èŠ‚</p>
<p>Step7: å®¢æˆ·ç«¯ä»ç„¶å‘é€80å­—èŠ‚åˆ°æœåŠ¡ç«¯ï¼Œæ­¤æ—¶å¯ç”¨çª—å£ä¸ºç©º</p>
<p>Step8: æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ç»§ç»­ä¸è¯»åŒºè¿™80å­—èŠ‚çš„ç¼“å†²åŒºæ•°æ®ï¼Œæœ€ç»ˆå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å¤§å°ä¸º0ï¼Œä¸èƒ½å†æ¥æ”¶ä»»ä½•æ•°æ®ï¼ŒåŒæ—¶å‘é€ACKæŠ¥æ–‡ï¼›</p>
<p>Step9ï¼šå®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º0ï¼Œè¿™ä¸ªçŠ¶æ€å«åšã€Œ <strong>çª—å£å…³é—­</strong> ã€</p>
<h3 id="çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ…"><a href="#çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ…" class="headerlink" title="çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ…"></a>çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ…</h3><image src="https://oscimg.oschina.net/oscnet/up-174e19d4d8de9757707034b8271cb3c69a7.png" width="530">

<p>Step1ï¼šå®¢æˆ·ç«¯æœåŠ¡ç«¯å¼€å§‹çš„çª—å£å¤§å°éƒ½æ˜¯360å­—èŠ‚ï¼Œå®¢æˆ·ç«¯å‘é€140å­—èŠ‚æ•°æ®</p>
<blockquote>
<p>å®¢æˆ·ç«¯å‘é€140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ220å­—èŠ‚</p>
</blockquote>
<p>Step2ï¼šæœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹éª¤å¢ï¼Œè¿›ç¨‹ç¼“å­˜åŒºå¹³å‡åˆ†é…ï¼Œé€ æˆæœåŠ¡ç«¯æ¥æ”¶çª—å£å‡å°‘ï¼Œä»360å˜æˆ240å­—èŠ‚ï¼›</p>
<blockquote>
<p>å‡è®¾æ¥æ”¶äº†140å­—èŠ‚ä¹‹åï¼Œåº”ç”¨è¿›ç¨‹æ²¡æœ‰è¯»å–ï¼Œé‚£ä¸ªå¯ç”¨çª—å£è¿›ä¸€æ­¥å‹ç¼©ï¼Œå˜æˆ100å­—èŠ‚ï¼›</p>
</blockquote>
<p>Step3ï¼šå‡è®¾åŒä¸€ä¸ªè¿æ¥åœ¨æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯ç¡®è®¤ä¹‹åï¼Œåˆå‘é€äº†180ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ˆRetramissionï¼‰</p>
<blockquote>
<p>å…ˆå‘é€äº†140å­—èŠ‚ï¼Œåå‘é€äº†180å­—èŠ‚ï¼Œéƒ½æ²¡æœ‰å¾—åˆ°ç¡®è®¤ï¼Œå®¢æˆ·ç«¯å¯ç”¨çª—å£å¤§å°å˜æˆ40å­—èŠ‚</p>
</blockquote>
<p>Step4ï¼šæœåŠ¡ç«¯æ”¶åˆ°ä¸Šé¢ğŸ‘†ç¬¬ä¸‰æ­¥å‘é€çš„180å­—èŠ‚çš„æ•°æ®ï¼Œä½†æ˜¯æ¥å—çª—å£çš„å¤§å°åªæœ‰100å­—èŠ‚ï¼Œæ‰€ä»¥ä¸èƒ½æ¥æ”¶</p>
<blockquote>
<p>æœåŠ¡ç«¯æ‹’ç»æ¥æ”¶180å­—èŠ‚</p>
</blockquote>
<p>Step5ï¼šæ­¤æ—¶å®¢æˆ·ç«¯æ‰æ”¶åˆ°ä¹‹å‰140å­—èŠ‚çš„ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰çŸ¥é“æ¥æ”¶çª—å£å‘ç”Ÿäº†å˜åŒ–</p>
<blockquote>
<p>å®¢æˆ·ç«¯ç”±äºæ²¡æœ‰æ”¶åˆ°180å­—èŠ‚çš„ç¡®è®¤ï¼ŒåŠ å…¥å®¢æˆ·ç«¯æ­£åœ¨å‡†å¤‡å‘é€180å­—èŠ‚æ•°æ®ï¼Œå¾—åˆ°æ¥å—ç«¯çš„çª—å£å¤§å°æ˜¯100å­—èŠ‚ä¹‹åï¼Œé¡»å¼ºåˆ¶å°†å³ä¾§çª—å£å‘å·¦æ”¶ç¼©80å­—èŠ‚ï¼›</p>
</blockquote>
<h2 id="çª—å£å…³é—­"><a href="#çª—å£å…³é—­" class="headerlink" title="çª—å£å…³é—­"></a>çª—å£å…³é—­</h2><p>è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„ä¾‹å­éƒ½å‘ç”Ÿäº†ã€Œ <strong><font color="red">çª—å£å…³é—­</font></strong> ã€</p>
<blockquote>
<p>çª—å£å…³é—­ï¼š å‘é€ç«¯çš„å‘é€çª—å£å˜æˆ0çš„çŠ¶æ€ï¼›</p>
</blockquote>
<p>ä¸Šé¢è®²çš„ä¸¤ç§æƒ…å†µä¸€èˆ¬ä¸ä¼šå‘ç”Ÿçš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸ä¼šæ—¢æ”¶ç¼©çª—å£ï¼ŒåŒæ—¶å‡å°‘è¿æ¥ç¼“å­˜ï¼›è€Œæ˜¯ä¸€èˆ¬å…ˆä½¿ç”¨çª—å£æ”¶ç¼©ç­–ç•¥ï¼Œä¹‹ååœ¨å‹ç¼©ç¼“å†²åŒºçš„æ–¹å¼æ¥è§„é¿ä»¥ä¸Šé—®é¢˜ï¼›<br>å‘ç”Ÿçª—å£å…³é—­ä¹‹åï¼Œå‘é€ç«¯ä¸ä¼šè¢«åŠ¨çš„ç­‰å¾…æœåŠ¡ç«¯çš„é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šé‡‡ç”¨å®šæ—¶å—…æ¢çš„æ–¹å¼å»æŸ¥çœ‹æœåŠ¡ç«¯æ¥æ”¶çª—å£æ˜¯å¦å¼€æ”¾ï¼›</p>
<h2 id="Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼"><a href="#Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼" class="headerlink" title="Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼"></a>Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼</h2><ul>
<li><p>net.ipv4.tcp_rmem = 4096 87380 6291456</p>
<blockquote>
<p>è¯»ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›– net.core.rmem_max</p>
</blockquote>
</li>
<li><p>net.ipv4.tcp_wmem = 4096 16384 4194304</p>
<blockquote>
<p>å†™ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›–net.core.wmem_max</p>
</blockquote>
</li>
<li><p>net.ipv4.tcp_mem = 1541646 2055528 3083292</p>
<blockquote>
<p>ç³»ç»Ÿæ— å†…å­˜å‹åŠ›ã€å¯åŠ¨å‹åŠ›æ¨¡å¼é˜€å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½ä¸ºé¡µçš„æ•°é‡</p>
</blockquote>
</li>
<li><p>net.ipv4.tcp_moderate_rcvbuf = 1 </p>
<blockquote>
<p>å¼€å¯è‡ªåŠ¨è°ƒæ•´ç¼“å­˜æ¨¡å¼</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPä¸‰æ¬¡æ¡æ‰‹</title>
    <url>/wiki/TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B/</url>
    <content><![CDATA[<h2 id="æ¡æ‰‹ğŸ¤çš„ç›®çš„"><a href="#æ¡æ‰‹ğŸ¤çš„ç›®çš„" class="headerlink" title="æ¡æ‰‹ğŸ¤çš„ç›®çš„"></a>æ¡æ‰‹ğŸ¤çš„ç›®çš„</h2><ul>
<li>åŒæ­¥Sequenceåºåˆ—å·<blockquote>
<p>åˆå§‹åŒ–åº<br>åˆ—å·ISN ï¼ˆInital Sequence Numberï¼‰</p>
</blockquote>
</li>
<li>äº¤æ¢TCPé€šè®¯çš„å‚æ•°<blockquote>
<p>æ¯”å¦‚æœ€å¤§æŠ¥æ–‡æ®µå‚æ•°ï¼ˆMSSï¼‰ã€çª—å£æ¯”ä¾‹å› å­ï¼ˆWindowï¼‰ã€é€‰æ‹©æ€§ç¡®è®¤ï¼ˆSACKï¼‰ã€åˆ¶å®šæ ¡éªŒå’Œç®—æ³•ï¼›</p>
</blockquote>
</li>
</ul>
<h2 id="ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹"></a>ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹</h2><image src="https://oscimg.oschina.net/oscnet/up-7ee7a8388d0fc3798344cad07f585bf7961.png" width=500 height=300>

<p>TCPä¸‰æ¬¡æ¡æ‰‹çš„å¤§è‡´æµç¨‹å›¾å¦‚ä¸ŠğŸ‘†  </p>
<p>ä½¿ç”¨tcpdumpæŠ“åŒ…åˆ†æä¸‰æ¬¡ğŸ¤æ¡æ‰‹æŠ¥æ–‡ä¸­Seqå’ŒAckçš„å˜åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump  port 80 -c 3 -S</span><br></pre></td></tr></table></figure>
<p><img src="https://sjwx.easydoc.xyz/47754217/files/kmov1k44.png" alt="image.png">  </p>
<h3 id="ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤"><a href="#ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤" class="headerlink" title="ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤"></a>ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IP upay.60734 &gt; 100.100.15.23.http: Flags [S], seq 3800409106, win 29200, options [mss 1460,sackOK,TS val 839851765 ecr 0,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯upayè®¿é—®æœåŠ¡ç«¯80ç«¯å£ï¼Œå‘é€ä¸€ä¸ªã€Œ seq=3800409106 ã€ ï¼ŒåŒæ—¶æ ‡å¿—ä½SYN=1ï¼Œå£°æ˜æ­¤æ¬¡æ¡æ‰‹æ˜¯è¦å»ºç«‹è¿æ¥ï¼›</p>
<h3 id="ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤"><a href="#ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤" class="headerlink" title="ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤"></a>ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IP 100.100.15.23.http &gt; upay.60734: Flags [S.], seq 1981710286, ack 3800409107, win 14600, options [mss 1440,nop,nop,sackOK,nop,wscale 7], length 0</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç”³è¯·è¿æ¥å¼ºæ±‚ï¼ˆSYN=1ï¼‰ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯è‡ªå·±å‡†å¤‡å¥½çš„æƒ…å†µä¸‹ï¼Œç»™å®¢æˆ·ç«¯å‘é€ ã€Œ ACK=1 SYN=1 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1åŒæ ·ä¹Ÿæ˜¯å£°æ˜æ­¤æ¬¡æŠ¥æ–‡æ˜¯å»ºç«‹è¿æ¥çš„æŠ¥æ–‡è¯·æ±‚ï¼› ack= 3800409107 ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å‘ç»™æœåŠ¡ç«¯çš„seq+1ï¼ˆackæ˜¯æ¥æ”¶æ–¹ä¸‹æ¬¡æœŸæœ›æ¥å£æŠ¥æ–‡çš„å¼€å§‹ä½ç½®ï¼‰</p>
<h3 id="ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹"><a href="#ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹" class="headerlink" title="ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹"></a>ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IP upay.60734 &gt; 100.100.15.23.http: Flags [.], ack 1981710287, win 229, length 0</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ç¡®è®¤æŠ¥æ–‡ï¼Œç¡®è®¤å¯ä»¥è¿›è¡Œè¿æ¥ï¼Œå‘é€ã€Œ ack = 1981710287 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¹‹åå°±å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCPçš„è¿æ¥å°±åˆ›å»ºæˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥åŒæ–¹å°±å¯ä»¥å‘é€æ•°æ®æŠ¥äº†ï¼›</p>
<h2 id="TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´"><a href="#TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´" class="headerlink" title="TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´"></a>TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´</h2><image src="https://oscimg.oschina.net/oscnet/up-d6920a59ec1cb6a738265b6f182cbdbe2ba.png" width=550 height=400>

<ul>
<li>é¦–å…ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ã€CLOSEDã€‘çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ä¹‹åï¼Œè¿›å…¥ã€SYN-SENTã€‘çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç»´æŒçš„æ—¶é—´å¾ˆçŸ­ï¼Œæˆ‘ä»¬ä½¿ç”¨netstatå»æŸ¥çœ‹tcpè¿æ¥çŠ¶æ€çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸ä¼šçœ‹åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œè€ŒæœåŠ¡ç«¯æ˜¯åœ¨ã€LISTENã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼›</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒSYN ACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶æœåŠ¡ç«¯è¿›å…¥ã€SYN-RECEIVEDã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡ï¼›</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„åŒæ­¥ç¡®è®¤è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œå‡†å¤‡åç»­çš„æ•°æ®ä¼ è¾“ï¼›</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°ä¸‰æ¬¡æ¡æ‰‹æœ€åçš„ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªTCPè¿æ¥ç®—æ˜¯å»ºç«‹å®Œæˆäº†ï¼Œåé¢å°±æ˜¯åŒæ–¹çš„é€šä¿¡äº†ï¼›</li>
</ul>
<h2 id="TCBï¼ˆTransmission-Control-Blockï¼‰"><a href="#TCBï¼ˆTransmission-Control-Blockï¼‰" class="headerlink" title="TCBï¼ˆTransmission Control Blockï¼‰"></a>TCBï¼ˆTransmission Control Blockï¼‰</h2><blockquote>
<p>ä¿å­˜è¿æ¥ä½¿ç”¨çš„æºç«¯å£ã€ç›®çš„ç«¯å£ã€ç›®çš„ ipã€åºå·ã€ åº”ç­”åºå·ã€å¯¹æ–¹çª—å£å¤§å°ã€å·±æ–¹çª—å£å¤§å°ã€tcp çŠ¶æ€ã€tcp è¾“å…¥/è¾“å‡ºé˜Ÿåˆ—ã€åº”ç”¨å±‚è¾“å‡ºé˜Ÿ åˆ—ã€tcp çš„é‡ä¼ æœ‰å…³å˜é‡ç­‰</p>
</blockquote>
<h2 id="TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜"><a href="#TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜" class="headerlink" title="TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜"></a>TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜</h2><image src="https://oscimg.oschina.net/oscnet/up-e99592d430e1219134af66e69aee2e6ccbd.png"  width=550 height=400 >

<p>æ­£å¦‚æˆ‘ä»¬äº†è§£çš„TCPä¸‰æ¬¡æ¡æ‰‹ğŸ¤çš„æµç¨‹ï¼Œå½“æœ‰å¤§é‡SYNè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯æ—¶ï¼Œä¼šè¿›å…¥åˆ°ã€SYNé˜Ÿåˆ—ã€‘ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¬¬äºŒæ¬¡ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œä¼šè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¼šå°†è¿æ¥æ”¾å…¥åˆ°ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­ï¼Œå½“Nginxæˆ–è€…Tomcatè¿™äº›åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨acceptï¼ˆè®¿é—®å†…æ ¸ï¼‰çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥è¿›è¡Œå¤„ç†ï¼›</p>
<blockquote>
<p>ç”±æ­¤å¯è§ï¼Œã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘æ˜¯ä¼šå½±å“æœåŠ¡å™¨è¿æ¥æ€§èƒ½çš„é‡è¦å› ç´ ï¼Œæ‰€ä»¥å¯¹äºé«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—ä¸€å®šæ˜¯è¦è®¾ç½®çš„æ¯”è¾ƒå¤§çš„ï¼›</p>
</blockquote>
<h3 id="å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°"><a href="#å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°" class="headerlink" title="å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°"></a>å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°</h3><p>æœåŠ¡å™¨ç«¯ SYN_RCV çŠ¶æ€</p>
<ul>
<li>net.ipv4.tcp_max_syn_backlog:SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•°</li>
<li>net.ipv4.tcp_synack_retries:è¢«åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘SYN/ACKçš„é‡è¯•æ¬¡æ•°</li>
</ul>
<p>å®¢æˆ·ç«¯ SYN_SENT çŠ¶æ€ï¼ˆæœåŠ¡ç«¯ä½œä¸ºå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚Ngnixè½¬å‘ç­‰ï¼‰</p>
<ul>
<li>net.ipv4.tcp_syn_retries = 6 ä¸»åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘ SYN çš„é‡è¯•æ¬¡æ•°</li>
<li>net.ipv4.ip_local_port_range = 32768 60999 å»ºç«‹è¿æ¥æ—¶çš„æœ¬åœ°ç«¯å£å¯ç”¨èŒƒå›´</li>
</ul>
<h2 id="Fast-Openæœºåˆ¶"><a href="#Fast-Openæœºåˆ¶" class="headerlink" title="Fast Openæœºåˆ¶"></a>Fast Openæœºåˆ¶</h2><image src="https://oscimg.oschina.net/oscnet/up-071f997614b36eb8b4511db0f3ba0637d70.png" width=550 height=400 >

<p>TCPå¦‚ä½•å¯¹è¿æ¥çš„æ¬¡æ•°ä»¥åŠè¿æ¥æ—¶é—´è¿›è¡Œä¼˜åŒ–çš„å‘¢ï¼Ÿè¿™é‡Œæåˆ°Fast Openæœºåˆ¶ï¼›<br>æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªHttp Getè¯·æ±‚ï¼Œæ­£å¸¸çš„ä¸‰æ¬¡æ¡æ‰‹ğŸ¤åˆ°æ”¶åˆ°æœåŠ¡ç«¯æ•°æ®éœ€è¦2ä¸ªRTTçš„æ—¶é—´ï¼›FastOpenåšå‡ºå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡åˆ›å»ºè¿æ¥çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è¦ç»å†2ä¸ªRTTæ—¶é—´ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯å‘é€ç¡®è®¤æŠ¥æ–‡çš„æ—¶å€™ï¼Œåœ¨æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªcookieï¼›</li>
<li>ç­‰åˆ°ä¸‹æ¬¡å®¢æˆ·ç«¯å†éœ€è¦åˆ›å»ºè¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥å°†ã€SYNã€‘å’Œcookieä¸€å¹¶å¸¦ä¸Šï¼Œå¯ä»¥ä¸€æ¬¡å°±åˆ›å»ºè¿æ¥ï¼Œç»è¿‡ä¸€ä¸ªRTTå®¢æˆ·ç«¯å°±å¯ä»¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ•°æ®ï¼›</li>
</ul>
<h4 id="å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP-Fast-Open"><a href="#å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP-Fast-Open" class="headerlink" title="å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP Fast Open"></a>å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP Fast Open</h4><p> net.ipv4.tcp_fastopen:ç³»ç»Ÿå¼€å¯ TFO åŠŸèƒ½ </p>
<ul>
<li>0:å…³é—­</li>
<li>1:ä½œä¸ºå®¢æˆ·ç«¯æ—¶å¯ä»¥ä½¿ç”¨ TFO</li>
<li>2:ä½œä¸ºæœåŠ¡å™¨æ—¶å¯ä»¥ä½¿ç”¨ TFO</li>
<li>3:æ— è®ºä½œä¸ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ TFO</li>
</ul>
<h3 id="SYNæ”»å‡»"><a href="#SYNæ”»å‡»" class="headerlink" title="SYNæ”»å‡»"></a>SYNæ”»å‡»</h3><h4 id="ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ</h4><p>  æ­£å¸¸çš„æœåŠ¡é€šè®¯éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„è¯·æ±‚æŠ¥æ–‡æ¥åˆ›å»ºè¿æ¥çš„ï¼Œä½†æ˜¯ï¼Œå¯ä»¥äººä¸ºä¼ªé€ å¤§é‡ä¸åŒIPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ğŸ‘†çŠ¶æ€å˜æ›´å›¾ä¸­çš„SYNè¯·æ±‚ï¼Œä½†æ˜¯æ”¶åˆ°æœåŠ¡ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œå´ä¸å‘é€å¯¹äºæœåŠ¡ç«¯çš„ACKè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡å¤„äºã€SYN-RECEIVEDã€‘çŠ¶æ€çš„TCPè¿æ¥å ç”¨å¤§é‡æœåŠ¡ç«¯èµ„æºï¼Œå¯¼è‡´æ­£å¸¸çš„è¿æ¥æ— æ³•åˆ›å»ºï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿå´©åï¼›</p>
<h4 id="SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹"><a href="#SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹" class="headerlink" title="SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹"></a>SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -nap | grep SYN_RECV</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚æœå­˜åœ¨å¤§é‡ã€SYN-RECEIVEDã€‘çš„è¿æ¥ï¼Œå°±æ˜¯å‘ç”ŸSYNæ”»å‡»äº†ï¼›</p>
</blockquote>
<h4 id="å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ"><a href="#å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ"></a>å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ</h4><ul>
<li><p><strong>net.core.netdev_max_backlog</strong></p>
<blockquote>
<p>æ¥æ”¶è‡ªç½‘å¡ã€ä½†æœªè¢«å†…æ ¸åè®®æ ˆå¤„ç†çš„æŠ¥æ–‡é˜Ÿåˆ—é•¿åº¦</p>
</blockquote>
</li>
<li><p><strong>net.ipv4.tcp_max_syn_backlog</strong></p>
<blockquote>
<p>SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•°</p>
</blockquote>
</li>
<li><p><strong>net.ipv4.tcp_abort_on_overflow</strong></p>
<blockquote>
<p>è¶…å‡ºå¤„ç†èƒ½åŠ›æ—¶ï¼Œå¯¹æ–°æ¥çš„ SYN ç›´æ¥å›åŒ… RSTï¼Œä¸¢å¼ƒè¿æ¥</p>
</blockquote>
</li>
<li><p>è®¾ç½®SYN Timeout</p>
<blockquote>
<p>ç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼=SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†è¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ã€‚</p>
</blockquote>
</li>
<li><p>è®¾ç½®SYN Cookie (net.ipv4.tcp_syncookies = 1)</p>
<blockquote>
<p>å°±æ˜¯ç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œå¹¶è®°å½•åœ°å€ä¿¡æ¯ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚è¿™æ ·åšçš„ç»“æœä¹Ÿå¯èƒ½ä¼šå½±å“åˆ°æ­£å¸¸ç”¨æˆ·çš„è®¿é—®ã€‚</p>
</blockquote>
</li>
</ul>
<image src="https://oscimg.oschina.net/oscnet/up-8cce8662408ffa1f5ed678be972248b92ca.png" width=800 height=350>

<p>å½“ SYN é˜Ÿåˆ—æ»¡åï¼Œæ–°çš„ SYN ä¸è¿›å…¥é˜Ÿåˆ—ï¼Œè®¡ç®—å‡º cookie å† ä»¥ SYN+ACK ä¸­çš„åºåˆ—å·è¿”å›å®¢æˆ·ç«¯ï¼Œæ­£å¸¸å®¢æˆ·ç«¯å‘æŠ¥æ–‡æ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®æŠ¥æ–‡ä¸­æºå¸¦çš„ cookie é‡æ–°æ¢å¤è¿æ¥</p>
<blockquote>
<p>ç”±äº cookie å ç”¨åºåˆ—å·ç©ºé—´ï¼Œå¯¼è‡´æ­¤æ—¶æ‰€æœ‰ TCP å¯é€‰ åŠŸèƒ½å¤±æ•ˆï¼Œä¾‹å¦‚æ‰©å……çª—å£ã€æ—¶é—´æˆ³ç­‰</p>
</blockquote>
<h2 id="TCP-DEFER-ACCEPT"><a href="#TCP-DEFER-ACCEPT" class="headerlink" title="TCP_DEFER_ACCEPT"></a>TCP_DEFER_ACCEPT</h2><p>è¿™ä¸ªæ˜¯åšä»€ä¹ˆå‘¢ï¼Ÿ æ­£å¦‚ä¸Šé¢ğŸ‘†æ“ä½œç³»ç»Ÿå†…æ ¸å±•ç¤ºå›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¸­ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘é˜Ÿåˆ—ï¼Œåªæœ‰å½“æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œè¿æ¥ä¼šè¿›å…¥åˆ°ã€ACCEPTã€‘ï¼ŒåŒæ—¶æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯<br>ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šå»æ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼ŒçŸ¥é“æ”¶åˆ°çœŸæ­£çš„dataåˆ†ç»„ä¹‹åï¼Œæ‰ä¼šæ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸ºäº†æé«˜åº”ç”¨è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…åº”ç”¨è¿›ç¨‹çš„ç­‰å¾…ï¼›</p>
<blockquote>
<p>TCPä¸‰æ¬¡æ¡æ‰‹ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡</p>
</blockquote>
<p>å‚è§æ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/rX3A_FA19n4pI9HicIEsXg">æ•–ä¸™ç”¨è¿‘ 40 å¼ å›¾è§£è¢«é—®åƒç™¾éçš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜</a></p>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPåè®®</title>
    <url>/wiki/TCP%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h2 id="TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’"><a href="#TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’" class="headerlink" title="TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’"></a>TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’</h2><blockquote>
<p>ä¸‹é¢æ˜¯æœ¬äººåœ¨å­¦ä¹ TCPåè®®çš„è¿‡ç¨‹ä¸­ï¼Œè®°å½•çš„ç¬”è®°ï¼ŒæŒ‰ç…§å­¦ä¹ çš„è¿‡ç¨‹ä»å‰åˆ°åæ•´ç†åœ¨è¿™é‡Œï¼<br>å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„çŸ¥è¯†æ²¡æœ‰ç½—åˆ—ï¼Œåªæ˜¯è®°å½•çš„å¤§æ¦‚æ¡†æ¶ï¼Œå¦‚æœæœ‰é—®é¢˜æˆ–é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</p>
</blockquote>
<blockquote>
<p><a href="doc:RGuKLdsI">1ã€TCPæŠ¥æ–‡å¤´éƒ¨</a><br><a href="doc:OMRc4svF">2ã€TCPä¸‰æ¬¡æ¡æ‰‹</a><br><a href="doc:MpizaHTg">3ã€TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰</a><br><a href="doc:ELxUb4mv">4ã€TCPè¶…æ—¶ä¸é‡ä¼ </a><br><a href="doc:wqRVLcNo">5ã€RTOé‡ä¼ è®¡æ—¶å™¨çš„è®¡ç®—</a><br><a href="doc:IhqiYamL">6ã€æ»‘åŠ¨çª—å£</a><br><a href="doc:HoE3w3UG">7ã€æå‡ç½‘ç»œæ•ˆç‡</a><br><a href="doc:N7riiaCk">8ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨</a><br><a href="doc:GQoRKrER">9ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ‹¥å¡é¿å…</a><br><a href="doc:y4aESoPN">10ã€å¿«é€Ÿé‡ä¼ ä¸å¿«é€Ÿæ¢å¤</a><br><a href="doc:g1Onj7OR">11ã€å››æ¬¡æŒ¥æ‰‹</a></p>
</blockquote>
<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><blockquote>
<p>æ•–ä¸™Githubæ•´ç†çš„ç¬”è®° </p>
</blockquote>
<p>æœ‰å¤§æ¦‚10ç¯‡å·¦å³çš„æ–‡ç« ï¼Œéƒ½æ˜¯é«˜è´¨é‡çš„ï¼ŒåŸåœ°å€è¯·ç‚¹å‡»ç€ğŸ‘‰ <a href="https://github.com/AobingJava/JavaFamily">ã€Githubã€‘</a></p>
<blockquote>
<p>æå®¢æ—¶é—´ã€ŠWebåè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜ã€‹â€“ é™¶è¾‰è€å¸ˆ</p>
</blockquote>
<p>è¿™é—¨è¯¾ç¨‹ä¸“é—¨è®²è§£ç½‘ç»œåè®®çš„ï¼ŒåŒ…æ‹¬Http/Https,TLSåè®®ï¼ŒTCPåè®®ï¼ŒIPåè®®ç­‰ï¼›</p>
<blockquote>
<p>ã€Šè®¡ç®—æœºç½‘ç»œ è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ç¬¬7ç‰ˆ</p>
</blockquote>
<p>å¾ˆå¤šåæ ¡è®¡ç®—æœºç½‘ç»œè¯¾ç¨‹åœ¨ä½¿ç”¨çš„æ•™æï¼Œéå¸¸æƒå¨ï¼</p>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPå¤´éƒ¨</title>
    <url>/wiki/TCP%E5%A4%B4%E9%83%A8/</url>
    <content><![CDATA[<h2 id="å¸¦ç€é—®é¢˜å­¦ä¹ "><a href="#å¸¦ç€é—®é¢˜å­¦ä¹ " class="headerlink" title="å¸¦ç€é—®é¢˜å­¦ä¹ "></a>å¸¦ç€é—®é¢˜å­¦ä¹ </h2><ul>
<li>å¦‚ä½•æ ¡éªŒæŠ¥æ–‡æ®µæ˜¯å¦æŸåï¼Ÿ å¦‚ä½•CRCæ ¡éªŒ</li>
<li>seqå’Œackæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ </li>
<li>tcpæ ¡éªŒä½éƒ½æœ‰é‚£äº›ï¼Ÿ 6ä¸ª åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ</li>
<li>tcpå¦‚ä½•è®¡ç®—é¦–éƒ¨é•¿åº¦ï¼Ÿ åç§»é‡</li>
<li>TCP Retransmission é‡ä¼ ï¼Ÿ </li>
<li>tcp spurious retransmission åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ </li>
<li>tcp dup ack æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ackä¸ACKæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</li>
</ul>
<h2 id="TCPå¤´éƒ¨ç»“æ„"><a href="#TCPå¤´éƒ¨ç»“æ„" class="headerlink" title="TCPå¤´éƒ¨ç»“æ„"></a>TCPå¤´éƒ¨ç»“æ„</h2><p><img src="https://oscimg.oschina.net/oscnet/up-d3e5715ff000040a0b18b2c9374d7e55f53.png">   </p>
<p>å­¦ä¹ TCPåè®®é¦–å…ˆè¦çœ‹ä¸€ä¸‹å®ƒçš„æŠ¥æ–‡æ®µæ˜¯å¦‚ä½•ç»„æˆçš„ï¼›TCPæŠ¥æ–‡æ®µç»„æˆç”±ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ¥æ–‡å¤´éƒ¨ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ•°æ®éƒ¨åˆ†ï¼›</p>
<p>å…ˆçœ‹ä¸€ä¸‹æŠ¥æ–‡å¤´ï¼Œä¹Ÿå°±æ˜¯TCPé¦–éƒ¨çš„ç»„æˆï¼›</p>
<h3 id="16ä½ç«¯å£"><a href="#16ä½ç«¯å£" class="headerlink" title="16ä½ç«¯å£"></a>16ä½ç«¯å£</h3><p>16ä½ç«¯å£å·ï¼šå‘ŠçŸ¥ä¸»æœºè¯¥æŠ¥æ–‡æ®µæ˜¯æ¥è‡ªå“ªé‡Œï¼ˆæºç«¯å£Source Portï¼‰ä»¥åŠä¼ ç»™å“ªä¸ªä¸Šå±‚åè®®æˆ–åº”ç”¨ç¨‹åºï¼ˆç›®çš„ç«¯å£Destination Portï¼‰çš„ã€‚<br>è¿›è¡ŒTCPé€šä¿¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨çŸ¥åæœåŠ¡ç«¯å£å·ï¼ˆæ¯”å¦‚DNSåè®®å¯¹åº”ç«¯å£53ï¼ŒHTTPåè®®å¯¹åº”80ï¼Œè¿™äº›ç«¯å£å·å¯åœ¨/etc/servicesæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼‰ã€‚  </p>
<h3 id="åºåˆ—å·ï¼ˆSeqï¼‰"><a href="#åºåˆ—å·ï¼ˆSeqï¼‰" class="headerlink" title="åºåˆ—å·ï¼ˆSeqï¼‰"></a>åºåˆ—å·ï¼ˆSeqï¼‰</h3><p>å 32ä½ï¼Œä¹Ÿå°±æ˜¯4å­—èŠ‚é•¿åº¦ï¼Œåºå·èŒƒå›´è‡ªç„¶ä¹Ÿæ˜¯æ˜¯0~2^32-1ã€‚TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ŒTCPè¿æ¥ä¸­ä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ã€‚æ•´ä¸ªè¦ä¼ é€çš„å­—èŠ‚æµçš„èµ·å§‹åºå·å¿…é¡»è¦åœ¨è¿æ¥å»ºç«‹æ—¶è®¾ç½®ã€‚é¦–éƒ¨ä¸­çš„åºå·å­—æ®µå€¼æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚   </p>
<p>TCPç”¨åºåˆ—å·å¯¹æ•°æ®åŒ…è¿›è¡Œæ ‡è®°ï¼Œä»¥ä¾¿åœ¨åˆ°è¾¾ç›®çš„åœ°åé‡æ–°é‡è£…ï¼Œå‡è®¾å½“å‰çš„åºåˆ—å·ä¸º sï¼Œå‘é€æ•°æ®é•¿åº¦ä¸º lï¼Œåˆ™ä¸‹æ¬¡å‘é€æ•°æ®æ—¶çš„åºåˆ—å·ä¸º s + lã€‚åœ¨å»ºç«‹è¿æ¥æ—¶é€šå¸¸ç”±è®¡ç®—æœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºåºåˆ—å·çš„åˆå§‹å€¼ã€‚  </p>
<p>**è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç–‘é—®ï¼Œç¬¬ä¸€æ¬¡å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ï¼Œç½‘ä¸Šä¸€äº›åšå®¢ä¸Šè¯´seqæ˜¯clientéšæœºç”Ÿæˆçš„ï¼Œä¹Ÿæœ‰çš„åšå®¢è¯´æ˜¯seq=1ï¼› è¿™é‡Œç»è¿‡æˆ‘æŠ“åŒ…åï¼Œçœ‹åˆ°ç¬¬ä¸€æ¬¡åˆ›å»ºTCPè¿æ¥çš„æ—¶å€™ï¼Œç¡®å®æ˜¯1; **    </p>
<h3 id="ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰"><a href="#ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰" class="headerlink" title="ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰"></a>ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰</h3><p>Ackå 32ä½ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦ï¼Œè¡¨ç¤ºæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å€¼ã€‚ ç”¨ä½œå¯¹å¦ä¸€æ–¹å‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„å“åº”ã€‚å…¶å€¼æ˜¯æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚å‡è®¾ä¸»æœºAå’Œä¸»æœºBè¿›è¡ŒTCPé€šä¿¡ï¼Œé‚£ä¹ˆAå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¸ä»…æºå¸¦è‡ªå·±çš„åºå·ï¼Œè€Œä¸”åŒ…å«å¯¹Bå‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚åä¹‹ï¼ŒBå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¹ŸåŒæ—¶æºå¸¦è‡ªå·±çš„åºå·å’Œå¯¹Aå‘é€æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚<br>TCPçš„å¯é æ€§ï¼Œæ˜¯å»ºç«‹åœ¨ã€Œæ¯ä¸€ä¸ªæ•°æ®æŠ¥æ–‡éƒ½éœ€è¦ç¡®è®¤æ”¶åˆ°ã€çš„åŸºç¡€ä¹‹ä¸Šçš„ã€‚  </p>
<p>å°±æ˜¯è¯´ï¼Œé€šè®¯çš„ä»»ä½•ä¸€æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„ä¸€ä¸ªæŠ¥æ–‡ä¹‹åï¼Œéƒ½è¦å‘é€ä¸€ä¸ªç›¸å¯¹åº”çš„ã€Œç¡®è®¤æŠ¥æ–‡ã€ï¼Œæ¥è¡¨è¾¾ç¡®è®¤æ”¶åˆ°ã€‚ é‚£ä¹ˆï¼Œç¡®è®¤æŠ¥æ–‡ï¼Œå°±ä¼šåŒ…å«ç¡®è®¤å·ã€‚    </p>
<p>è‹¥ç¡®è®¤å·=Nï¼Œåˆ™è¡¨æ˜ï¼šåˆ°åºå·N-1ä¸ºæ­¢çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚    </p>
<h3 id="æ•°æ®åç§»-Offset"><a href="#æ•°æ®åç§»-Offset" class="headerlink" title="æ•°æ®åç§» Offset"></a>æ•°æ®åç§» Offset</h3><p>å  0.5 ä¸ªå­—èŠ‚ (4 ä½)ã€‚ è¿™ä¸ªå­—æ®µå®é™…ä¸Šæ˜¯æŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨é•¿åº¦ ï¼Œå®ƒæŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡çš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚</p>
<blockquote>
<p>æ³¨æ„æ•°æ®èµ·å§‹å¤„å’ŒæŠ¥æ–‡èµ·å§‹å¤„çš„æ„æ€ï¼Œä¸Šé¢ğŸ‘†å·²ç»å†™åˆ°ï¼ŒTCPæŠ¥æ–‡æ®µçš„ç»„æˆæœ‰ä¸¤éƒ¨åˆ†ï¼ŒTCPæŠ¥æ–‡é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œåç§»é‡è®°å½•çš„æ˜¯æŠ¥æ–‡æ®µå¼€å§‹å’Œæ•°æ®å¼€å§‹çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æŠ¥æ–‡é¦–éƒ¨çš„é•¿åº¦ï¼›  </p>
</blockquote>
<p>ä¸€ä¸ªæ•°æ®åç§»é‡ = 4 byteï¼Œç”±äº4ä½äºŒè¿›åˆ¶æ•°èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°å­—æ˜¯ 15ï¼Œå› æ­¤æ•°æ®åç§»çš„æœ€å¤§å€¼æ˜¯ 60 byteï¼Œè¿™ä¹Ÿä¾§é¢é™åˆ¶äº†TCPé¦–éƒ¨çš„æœ€å¤§é•¿åº¦ã€‚  </p>
<h3 id="ä¿ç•™Reserved"><a href="#ä¿ç•™Reserved" class="headerlink" title="ä¿ç•™Reserved"></a>ä¿ç•™Reserved</h3><p>å  0.75 ä¸ªå­—èŠ‚ (6 ä½)ã€‚ ä¿ç•™ä¸ºä»Šåä½¿ç”¨ï¼Œä½†ç›®å‰åº”ç½®ä¸º 0ã€‚</p>
<h3 id="æ ‡å¿—ä½-TCP-Flags"><a href="#æ ‡å¿—ä½-TCP-Flags" class="headerlink" title="æ ‡å¿—ä½ TCP Flags"></a>æ ‡å¿—ä½ TCP Flags</h3><p><img src="https://oscimg.oschina.net/oscnet/up-869702a0e6199a93eb3be514c04e28274a7.png"><br>æ ‡å¿—ä½ï¼Œä¸€å…±æœ‰6ä¸ªï¼Œåˆ†åˆ«å 1ä½ï¼Œå…±6ä½ã€‚ æ¯ä¸€ä½çš„å€¼åªæœ‰ 0 å’Œ 1ï¼Œåˆ†åˆ«è¡¨è¾¾ä¸åŒæ„æ€ã€‚ å¦‚ä¸Šå›¾æ˜¯ä½¿ç”¨wireshardæŠ“åŒ…å±•ç¤ºæˆªå›¾ï¼›  </p>
<h4 id="ACK-Acknowlegemt-ï¼šç¡®è®¤åºå·æœ‰æ•ˆ"><a href="#ACK-Acknowlegemt-ï¼šç¡®è®¤åºå·æœ‰æ•ˆ" class="headerlink" title="ACK(Acknowlegemt)  ï¼šç¡®è®¤åºå·æœ‰æ•ˆ"></a>ACK(Acknowlegemt)  ï¼šç¡®è®¤åºå·æœ‰æ•ˆ</h4><blockquote>
<p>å½“ ACK = 1 çš„æ—¶å€™ï¼Œç¡®è®¤å·ï¼ˆAcknowledgemt Numberï¼‰æœ‰æ•ˆã€‚ ä¸€èˆ¬ç§°æºå¸¦ ACK æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œç¡®è®¤æŠ¥æ–‡æ®µã€ã€‚ä¸º0è¡¨ç¤ºæ•°æ®æ®µä¸åŒ…å«ç¡®è®¤ä¿¡æ¯ï¼Œç¡®è®¤å·è¢«å¿½ç•¥ã€‚<br>TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK è®¾ç½®ä¸º 1ã€‚  </p>
</blockquote>
<h4 id="RST-Reset-ï¼šé‡ç½®è¿æ¥"><a href="#RST-Reset-ï¼šé‡ç½®è¿æ¥" class="headerlink" title="RST(Reset)ï¼šé‡ç½®è¿æ¥"></a>RST(Reset)ï¼šé‡ç½®è¿æ¥</h4><blockquote>
<p>å½“ RST = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°ä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é‡Šæ”¾å¹¶é‡æ–°å»ºç«‹è¿æ¥ã€‚ ä¸€èˆ¬ç§°æºå¸¦ RST æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œå¤ä½æŠ¥æ–‡æ®µã€ã€‚ </p>
</blockquote>
<h4 id="SYN-SYNchronization-ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥"><a href="#SYN-SYNchronization-ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥" class="headerlink" title="SYN(SYNchronization)ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥"></a>SYN(SYNchronization)ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥</h4><blockquote>
<p>å½“ SYN = 1 çš„æ—¶å€™ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚è¿æ¥æŠ¥æ–‡æ®µã€‚ ä¸€èˆ¬ç§°æºå¸¦ SYN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€ŒåŒæ­¥æŠ¥æ–‡æ®µã€ã€‚ åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡å°±æ˜¯åŒæ­¥æŠ¥æ–‡æ®µï¼Œåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚<br>å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”çš„æŠ¥æ–‡æ®µä¸­ä½¿ SYN = 1 å’Œ ACK = 1ã€‚</p>
</blockquote>
<h4 id="PSH-Push-æ¨é€"><a href="#PSH-Push-æ¨é€" class="headerlink" title="PSH (Push): æ¨é€"></a>PSH (Push): æ¨é€</h4><blockquote>
<p>å½“ PSH = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µé«˜ä¼˜å…ˆçº§ï¼Œæ¥æ”¶æ–¹ TCP åº”è¯¥å°½å¿«æ¨é€ç»™æ¥æ”¶åº”ç”¨ç¨‹åºï¼Œè€Œä¸ç”¨ç­‰åˆ°æ•´ä¸ª TCP ç¼“å­˜éƒ½å¡«æ»¡äº†åå†äº¤ä»˜ã€‚  </p>
</blockquote>
<h4 id="FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥"><a href="#FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥" class="headerlink" title="FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥"></a>FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥</h4><blockquote>
<p>å½“ FIN = 1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾ TCP è¿æ¥ã€‚<br>ä¸€èˆ¬ç§°æºå¸¦ FIN çš„æŠ¥æ–‡æ®µä¸ºã€Œç»“æŸæŠ¥æ–‡æ®µã€ã€‚<br>åœ¨ TCP å››æ¬¡æŒ¥æ‰‹é‡Šæ”¾è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°è¯¥æ ‡å¿—ã€‚</p>
</blockquote>
<h3 id="çª—å£å¤§å°-Window-Size"><a href="#çª—å£å¤§å°-Window-Size" class="headerlink" title="çª—å£å¤§å° Window Size"></a>çª—å£å¤§å° Window Size</h3><p>å 16ä½ã€‚<br>è¯¥å­—æ®µæ˜ç¡®æŒ‡å‡ºäº†ç°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚ çª—å£å¤§å°çš„å€¼æ˜¯æŒ‡ï¼Œä»æœ¬æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç®—èµ·ï¼Œæ¥æ”¶æ–¹ç›®å‰å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œå‡å¦‚ç¡®è®¤å·æ˜¯701ï¼Œçª—å£å­—æ®µæ˜¯ 1000ã€‚è¿™å°±è¡¨æ˜ï¼Œä» 701 å·ç®—èµ·ï¼Œå‘é€æ­¤æŠ¥æ–‡æ®µçš„ä¸€æ–¹è¿˜æœ‰æ¥æ”¶ 1000 ï¼ˆå­—èŠ‚åºå·æ˜¯ 701 ~ 1700ï¼‰ ä¸ªå­—èŠ‚çš„æ•°æ®çš„æ¥æ”¶ç¼“å­˜ç©ºé—´ã€‚  </p>
</blockquote>
<h3 id="æ ¡éªŒå’Œ-TCP-Checksum"><a href="#æ ¡éªŒå’Œ-TCP-Checksum" class="headerlink" title="æ ¡éªŒå’Œ TCP Checksum"></a>æ ¡éªŒå’Œ TCP Checksum</h3><p>å 16ä½ã€‚ ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡Œã€CRCç®—æ³•ã€‘ï¼Œä»¥æ£€éªŒTCPæŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼Œå¦‚æœæŸåè¿™ä¸¢å¼ƒã€‚</p>
<p>æ£€éªŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚</p>
<h3 id="ç´§æ€¥æŒ‡é’ˆ-Urgent-Pointer"><a href="#ç´§æ€¥æŒ‡é’ˆ-Urgent-Pointer" class="headerlink" title="ç´§æ€¥æŒ‡é’ˆ Urgent Pointer"></a>ç´§æ€¥æŒ‡é’ˆ Urgent Pointer</h3><p>å  2 ä¸ªå­—èŠ‚ã€‚ ä»…åœ¨ URG = 1 æ—¶æ‰æœ‰æ„ä¹‰ï¼Œå®ƒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚ å½“ URG = 1 æ—¶ï¼Œå‘é€æ–¹ TCP å°±æŠŠç´§æ€¥æ•°æ®æ’å…¥åˆ°æœ¬æŠ¥æ–‡æ®µæ•°æ®çš„æœ€å‰é¢ï¼Œè€Œåœ¨ç´§æ€¥æ•°æ®åé¢çš„æ•°æ®ä»æ˜¯æ™®é€šæ•°æ®ã€‚</p>
<p>å› æ­¤ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºäº†ç´§æ€¥æ•°æ®çš„æœ«å°¾åœ¨æŠ¥æ–‡æ®µä¸­çš„ä½ç½®ã€‚</p>
<h3 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h3><image src="https://oscimg.oschina.net/oscnet/up-e071765090a2bbf6a9944907b288c70cd4a.png" width="400">

<ul>
<li>æ¯ä¸ªé€‰é¡¹å¼€å§‹æ˜¯1å­—èŠ‚kindå­—æ®µï¼Œè¯´æ˜é€‰é¡¹çš„ç±»å‹</li>
<li>kindä¸º0å’Œ1çš„é€‰é¡¹ï¼Œåªå ä¸€ä¸ªå­—èŠ‚</li>
<li>å…¶ä»–kindåæœ‰ä¸€å­—èŠ‚lenï¼Œè¡¨ç¤ºè¯¥é€‰é¡¹æ€»é•¿åº¦ï¼ˆåŒ…æ‹¬kindå’Œlenï¼‰</li>
<li>kindä¸º11ï¼Œ12ï¼Œ13è¡¨ç¤ºtcpäº‹åŠ¡</li>
</ul>
<p><strong>ä¸‹é¢æ˜¯å¸¸ç”¨é€‰é¡¹ï¼š</strong><br><image src="https://oscimg.oschina.net/oscnet/up-1043e2bd27321e5ae0bc13be398e989be3e.png" width=800 height=300></p>
<h3 id="MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰"><a href="#MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰" class="headerlink" title="MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰"></a>MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰</h3><p>MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ˜¯ã€é“¾è·¯å±‚ã€‘ä¸­çš„ç½‘ç»œå¯¹æ•°æ®å¸§çš„ä¸€ä¸ªé™åˆ¶ï¼Œä»¥ä»¥å¤ªç½‘ä¸ºä¾‹ï¼ŒMTU ä¸º 1500 ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªIP æ•°æ®æŠ¥åœ¨ä»¥å¤ªç½‘ä¸­ä¼ è¾“ï¼Œå¦‚æœå®ƒçš„é•¿åº¦å¤§äºè¯¥ MTU å€¼ï¼Œå°±è¦è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œä½¿å¾—æ¯ç‰‡æ•°æ®æŠ¥çš„é•¿åº¦å°äºMTUã€‚åˆ†ç‰‡ä¼ è¾“çš„ IP æ•°æ®æŠ¥ä¸ä¸€å®šæŒ‰åºåˆ°è¾¾ï¼Œä½† IP é¦–éƒ¨ä¸­çš„ä¿¡æ¯èƒ½è®©è¿™äº›æ•°æ®æŠ¥ç‰‡æŒ‰åºç»„è£…ã€‚IP æ•°æ®æŠ¥çš„åˆ†ç‰‡ä¸é‡ç»„æ˜¯åœ¨ç½‘ç»œå±‚è¿›å®Œæˆçš„ã€‚</p>
<h3 id="MSS-ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰"><a href="#MSS-ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰" class="headerlink" title="MSS ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰"></a>MSS ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰</h3><p>MSS æ˜¯ TCP é‡Œçš„ä¸€ä¸ªæ¦‚å¿µï¼ˆé¦–éƒ¨çš„é€‰é¡¹å­—æ®µä¸­ï¼‰ã€‚MSS æ˜¯ TCP æ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åˆ†æ®µï¼ŒTCP æŠ¥æ–‡æ®µçš„é•¿åº¦å¤§äº MSS æ—¶ï¼Œè¦è¿›è¡Œåˆ†æ®µä¼ è¾“ã€‚TCP åè®®åœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰ç”¨äºé€šå‘Šå®ƒæœŸæœ›æ¥æ”¶çš„ MSS é€‰é¡¹ï¼ˆMSS é€‰é¡¹åªå‡ºç°åœ¨ SYN æŠ¥æ–‡æ®µä¸­ï¼Œå³ TCP ä¸‰æ¬¡æ¡æ‰‹çš„å‰ä¸¤æ¬¡ï¼‰ã€‚MSS çš„å€¼ä¸€èˆ¬ä¸º MTU å€¼å‡å»ä¸¤ä¸ªé¦–éƒ¨å¤§å°ï¼ˆéœ€è¦å‡å» IP æ•°æ®åŒ…åŒ…å¤´çš„å¤§å° 20Bytes å’Œ TCP æ•°æ®æ®µçš„åŒ…å¤´ 20Bytesï¼‰æ‰€ä»¥å¦‚æœç”¨é“¾è·¯å±‚ä»¥å¤ªç½‘ï¼ŒMSS çš„å€¼å¾€å¾€ä¸º 1460ã€‚è€Œ Internet ä¸Šæ ‡å‡†çš„ MTU ä¸º 576ï¼Œé‚£ä¹ˆå¦‚æœä¸è®¾ç½®ï¼Œåˆ™MSSçš„é»˜è®¤å€¼å°±ä¸º 536 ä¸ªå­—èŠ‚ã€‚TCPæŠ¥æ–‡æ®µçš„åˆ†æ®µä¸é‡ç»„æ˜¯åœ¨è¿è¾“å±‚å®Œæˆçš„ã€‚</p>
<h2 id="seqå’Œackçš„è®¡ç®—é€»è¾‘"><a href="#seqå’Œackçš„è®¡ç®—é€»è¾‘" class="headerlink" title="seqå’Œackçš„è®¡ç®—é€»è¾‘"></a>seqå’Œackçš„è®¡ç®—é€»è¾‘</h2><image src="https://oscimg.oschina.net/oscnet/up-710a22f4e6b6c961662879fe2ac6000cca9.png" width=900 height=500> 


<h2 id="CRCæ ¡éªŒ"><a href="#CRCæ ¡éªŒ" class="headerlink" title="CRCæ ¡éªŒ"></a>CRCæ ¡éªŒ</h2><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://www.jianshu.com/p/15754b4e9458">TCPåè®®ä¸­çš„seq/ackåºå·æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼Ÿ</a><br><a href="https://www.jianshu.com/p/ef892323e68f">TCPåè®®è¯¦è§£</a><br><a href="https://blog.csdn.net/baidu_17611285/article/details/80171239">TCPåè®®è¯¦è§£ï¼ˆä¸€ï¼‰ï¼šTCPå¤´éƒ¨ç»“æ„</a><br><a href="https://blog.csdn.net/zuochao_2013/article/details/80561793">TCPå’ŒUDPæŠ¥æ–‡å¤´æ ¼å¼</a><br><a href="https://juejin.cn/post/6844903685563105293">TCPåè®®è¯¦è§£</a><br><a href="https://juejin.cn/post/6844904131342123022">åƒé€TCPåè®®</a>  </p>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰</title>
    <url>/wiki/TCP%E6%9C%80%E5%A4%A7%E6%8A%A5%E6%96%87%E6%AE%B5%EF%BC%88MSS%EF%BC%89/</url>
    <content><![CDATA[<h2 id="MSSäº§ç”Ÿçš„èƒŒæ™¯"><a href="#MSSäº§ç”Ÿçš„èƒŒæ™¯" class="headerlink" title="MSSäº§ç”Ÿçš„èƒŒæ™¯"></a>MSSäº§ç”Ÿçš„èƒŒæ™¯</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“TCPåè®®æ˜¯è¿è¾“åœ¨ä¼ è¾“å±‚çš„åè®®ï¼Œå®ƒæ˜¯é¢å‘ã€å­—èŠ‚æµã€‘çš„ä¼ è¾“åè®®ï¼›<br>å®ƒçš„ä¸Šå±‚ï¼Œåº”ç”¨å±‚ä¼ è¾“çš„æ•°æ®æ˜¯æ— é™åˆ¶çš„ï¼Œä½†æ˜¯å®ƒçš„ä¸‹å±‚ä¹Ÿå°±æ˜¯ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ç”±äºè·¯ç”±ç­‰è½¬å‘è®¾å¤‡æœ‰å†…å­˜ç­‰é™åˆ¶æ˜¯ä¸å¯èƒ½æ— é™åˆ¶ä¼ è¾“ä»»ä½•å¤§å°çš„æŠ¥æ–‡çš„ï¼Œå®ƒä»¬ä¸€å®šä¼šé™åˆ¶æŠ¥æ–‡çš„é•¿åº¦ï¼Œå› æ­¤ <strong>TCPåè®®è¦å®Œæˆçš„å·¥ä½œæ˜¯å°†ä»åº”ç”¨å±‚æ¥å—åˆ°çš„ä»»æ„é•¿åº¦æ•°æ®ï¼Œåˆ‡å‰²æˆå¤šä¸ªæŠ¥æ–‡æ®µï¼ŒMSSå°±æ˜¯å¦‚ä½•åˆ‡å‰²æŠ¥æ–‡æ®µçš„ä¾æ®ã€‚</strong></p>
<image src="https://oscimg.oschina.net/oscnet/up-004bb74a9d5648d949d9549219c677f568f.png" width=450 height=300>


<h2 id="ä»€ä¹ˆæ˜¯MSS"><a href="#ä»€ä¹ˆæ˜¯MSS" class="headerlink" title="ä»€ä¹ˆæ˜¯MSS"></a>ä»€ä¹ˆæ˜¯MSS</h2><p>MSSï¼ˆMax Segment Sizeï¼‰ï¼šä»…æŒ‡ TCP æ‰¿è½½æ•°æ®ï¼Œä¸åŒ…å« TCP å¤´éƒ¨çš„å¤§å°ï¼Œå‚è§ RFC879</p>
<h2 id="MSS-é€‰æ‹©ç›®çš„"><a href="#MSS-é€‰æ‹©ç›®çš„" class="headerlink" title="MSS é€‰æ‹©ç›®çš„"></a>MSS é€‰æ‹©ç›®çš„</h2><ul>
<li>å°½é‡æ¯ä¸ª Segment æŠ¥æ–‡æ®µæºå¸¦æ›´å¤šçš„æ•°æ®ï¼Œä»¥å‡å°‘å¤´éƒ¨ç©ºé—´å ç”¨æ¯”ç‡ </li>
<li>é˜²æ­¢ Segment è¢«æŸä¸ªè®¾å¤‡çš„ IP å±‚åŸºäº MTU æ‹†åˆ†<blockquote>
<p>IPå±‚åŸºäºMTUçš„æ•°æ®æ‹†åˆ†æ˜¯æ•ˆç‡æå·®çš„ï¼Œä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œæ‰€æœ‰çš„æŠ¥æ–‡æ®µéƒ½è¦é‡ä¼ </p>
</blockquote>
</li>
</ul>
<h2 id="MSSé»˜è®¤å¤§å°"><a href="#MSSé»˜è®¤å¤§å°" class="headerlink" title="MSSé»˜è®¤å¤§å°"></a>MSSé»˜è®¤å¤§å°</h2><blockquote>
<p>é»˜è®¤ MSS:536 å­—èŠ‚(é»˜è®¤ MTU576 å­—èŠ‚ï¼Œ20 å­—èŠ‚ IP å¤´éƒ¨ï¼Œ20 å­—èŠ‚ TCP å¤´éƒ¨)</p>
</blockquote>
<h2 id="MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨"><a href="#MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨" class="headerlink" title="MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨"></a>MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨</h2><blockquote>
<p>æ¡æ‰‹é˜¶æ®µåå•† MSS è¿™ä¸ªåœ¨TCPä¸‰æ¬¡æ¡æ‰‹çš„æ–‡ç« ä¸­å·²ç»æåŠè¿‡äº†ï¼</p>
</blockquote>
<h2 id="MSS-åˆ†ç±»"><a href="#MSS-åˆ†ç±»" class="headerlink" title="MSS åˆ†ç±»"></a>MSS åˆ†ç±»</h2><ul>
<li><strong>å‘é€æ–¹æœ€å¤§æŠ¥æ–‡æ®µ:</strong> <blockquote>
<p>SMSS:SENDER MAXIMUM SEGMENT SIZE</p>
</blockquote>
</li>
<li><strong>æ¥æ”¶æ–¹æœ€å¤§æŠ¥æ–‡æ®µ:</strong> <blockquote>
<p>RMSS:RECEIVER MAXIMUM SEGMENT SIZE</p>
</blockquote>
</li>
</ul>
<h2 id="åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹"><a href="#åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹" class="headerlink" title="åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹"></a>åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹</h2><image src="https://oscimg.oschina.net/oscnet/up-c1229634eb30eaa7391516cbee75258c9e1.png" width=750 height=420>


<h2 id="TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€"><a href="#TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€" class="headerlink" title="TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€"></a>TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€</h2><image src="https://oscimg.oschina.net/oscnet/up-1a0015bf7b4d8481a4e624b0920bbb43917.png" width=450 height=620>

<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå·¦è¾¹å®¢æˆ·ç«¯åœ¨å‘é€å­—èŠ‚æµæ•°æ®ç»™åˆ°å³è¾¹å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚æµï¼Œä¼šåœ¨TCPå±‚æŒ‰ç…§MSSå¤§å°è§„å®šè¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªå°çš„æŠ¥æ–‡æ®µï¼Œåˆ†åˆ«ä¼ é€åˆ°å¦ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–è€…å…¶ä»–çš„æ¥æ”¶ç«¯ï¼›</p>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>TCPè¶…æ—¶ä¸é‡ä¼ </title>
    <url>/wiki/TCP%E8%B6%85%E6%97%B6%E4%B8%8E%E9%87%8D%E4%BC%A0/</url>
    <content><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><image src="https://oscimg.oschina.net/oscnet/up-4f1230ee04f4c197dd5c6de167991878366.png" width=680 height=300>

<p>å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼Œè®¾å¤‡Aå‘è®¾å¤‡Bå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åœ¨ç½‘ç»œä¸­ä¼šç”±äºå„ç§å„æ ·çš„é—®é¢˜å¯¼è‡´ä¸¢å¤±ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="é‡‡ç”¨å®šæ—¶å™¨é‡ä¼ "><a href="#é‡‡ç”¨å®šæ—¶å™¨é‡ä¼ " class="headerlink" title="é‡‡ç”¨å®šæ—¶å™¨é‡ä¼ "></a>é‡‡ç”¨å®šæ—¶å™¨é‡ä¼ </h2><blockquote>
<p>PARï¼šPositive Acknowledgment with Retransmission</p>
</blockquote>
<image src="https://oscimg.oschina.net/oscnet/up-17f5567e452afb45cf18d01e62bdfa33f96.png" width=680 height=330>

<p><strong>æœ€ç®€å•çš„æ€è·¯æ˜¯åœ¨å‘é€æ–¹è®¾ç½®ã€Œ å®šæ—¶å™¨ ã€ï¼š</strong></p>
<ul>
<li>å½“è®¾å¤‡Aå‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹åï¼Œåœ¨å®šæ—¶å™¨è§„å®šçš„æ—¶é—´å†…ï¼Œå¦‚æœæ”¶åˆ°è®¾å¤‡Bçš„ç¡®è®¤æŠ¥æ–‡ï¼Œåˆ™è®¾å¤‡Aç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼›</li>
<li>å¦‚æœç¬¬ä¸€æ¡æ¶ˆæ¯å‘é€æ—¶é—´è¶…å‡ºäº†å®šæ—¶å™¨è§„å®šçš„æ—¶é—´ï¼Œåˆ™è®¾å¤‡Aå°†é‡æ–°å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ŒåŒæ—¶é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼›</li>
<li>è¿™ç§æ–¹å¼æ˜¯ä¸²å‹å‘é€çš„ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸä¹‹åï¼Œæ‰å¯ä»¥å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œã€Œ <strong>æ•ˆç‡æå·®</strong> ã€ï¼›</li>
</ul>
<h2 id="å¹¶å‘èƒ½åŠ›PAR"><a href="#å¹¶å‘èƒ½åŠ›PAR" class="headerlink" title="å¹¶å‘èƒ½åŠ›PAR"></a>å¹¶å‘èƒ½åŠ›PAR</h2><blockquote>
<p>åŸºäºä¸Šè¿°PARæ•ˆç‡ä½ä¸‹çš„æ–¹å¼è¿›è¡Œæ”¹é€ ï¼Œåœ¨å‘é€ç«¯é‡‡ç”¨å¹¶å‘+å®šæ—¶å™¨çš„æ–¹å¼è¿›è¡Œæ•°æ®å‘é€ï¼›</p>
</blockquote>
<image src="https://oscimg.oschina.net/oscnet/up-96114b57ac73a41915bea1a7d11e0145102.png" width=600 height="500">

<ul>
<li>é¦–å…ˆè®¾å¤‡Aå¯ä»¥åŒæ—¶å‘é€å¤šä¸ªæ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µå…·æœ‰ä¸€ä¸ªæ ‡å¿—å­—æ®µã€#XXã€‘å»æ ‡å¿—å”¯ä¸€ï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µè¿æ¥å…·æœ‰è‡ªå·±çš„å®šæ—¶å™¨ï¼›</li>
<li>è®¾å¤‡Bè§„å®šæ—¶é—´å†…æ”¶åˆ°è®¾å¤‡Aå‘é€çš„æ•°æ®ä¹‹åå¹¶ä¸”è®¾å¤‡Aå¾—åˆ°è®¾å¤‡Bçš„ç¡®è®¤ä¹‹åï¼Œè®¾å¤‡Aå°†å®šæ—¶å™¨æ¸…é™¤</li>
<li>åŒPARä¸€æ ·ï¼Œè®¾å¤‡Bæ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å‘é€ç¡®è®¤æŠ¥æ–‡ï¼Œè®¾å¤‡Aå°†è¿™ä¸ªæŠ¥æ–‡æ‰€å¯¹åº”çš„å®šæ—¶å™¨å¤ä½ï¼Œé‡æ–°å‘é€è¿™ä¸ªæŠ¥æ–‡</li>
</ul>
<h3 id="å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜"><a href="#å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜"></a>å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜</h3><p>é‡‡ç”¨å¹¶å‘çš„æ–¹å¼å‘é€æ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µå›ºç„¶æå‡äº†å‘é€ç«¯çš„æ€§èƒ½ï¼Œä½†æ˜¯å‘é€ç«¯å‘é€çš„æ¶ˆæ¯å¯èƒ½æ¥å—ç«¯ä¸èƒ½å®Œå…¨å¤„ç†ï¼Œ<strong>è¿™æ˜¯åŒæ–¹æŠ¥æ–‡å¤„ç†é€Ÿåº¦æˆ–è€…æ•ˆç‡ä¸ä¸€è‡´çš„é—®é¢˜</strong>ï¼›</p>
<p>æ‰€ä»¥å¯¹äºæ¥æ”¶ç«¯è®¾å¤‡Bï¼Œåº”è¯¥æ˜ç¡®è‡ªå·±å¯èƒ½æ¥å—çš„æ•°æ®é‡ï¼Œå¹¶ä¸”åœ¨ç¡®è®¤æŠ¥æ–‡ä¸­åŒæ­¥åˆ°å‘é€ç«¯è®¾å¤‡Aï¼Œè®¾å¤‡Aæ ¹æ®è®¾å¤‡Bçš„å¤„ç†èƒ½åŠ›æ¥è°ƒæ•´å‘é€æ•°æ®çš„å¤§å°ï¼›ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„ã€Œ limitã€ï¼›</p>
<h2 id="ç»§ç»­å»¶ä¼¸"><a href="#ç»§ç»­å»¶ä¼¸" class="headerlink" title="ç»§ç»­å»¶ä¼¸"></a>ç»§ç»­å»¶ä¼¸</h2><p>Sequmentåºåˆ—å·å’ŒAckåºåˆ—å·çš„è®¾è®¡ç†å¿µæˆ–è€…è®¾è®¡åˆè¡·æ˜¯ã€Œ <strong>è§£å†³åº”ç”¨å±‚å­—èŠ‚æµçš„å¯é å‘é€</strong> ã€ </p>
<ul>
<li>è·Ÿè¸ªã€Œåº”ç”¨å±‚ã€çš„å‘é€ç«¯æ•°æ®æ˜¯å¦é€è¾¾</li>
<li>ç¡®å®šã€Œæ¥æ”¶ç«¯æœ‰åºçš„ã€æ¥æ”¶åˆ°ã€Œå­—èŠ‚æµã€</li>
<li><strong>åºåˆ—å·çš„å€¼é’ˆå¯¹çš„æ˜¯å­—èŠ‚è€Œä¸æ˜¯æŠ¥æ–‡</strong> âš ï¸âš ï¸âš ï¸</li>
</ul>
<blockquote>
<p>TCPçš„å®šä½å°±æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼</p>
</blockquote>
<h2 id="TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„"><a href="#TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„" class="headerlink" title="TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„"></a>TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„</h2><image src="https://oscimg.oschina.net/oscnet/up-f5f274ec300162985b9bef86ebd94f6a81e.png" width=450 height=450>

<p>é€šè¿‡TCPæŠ¥æ–‡å¤´æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒSequmentåºåˆ—å·åŒ…æ‹¬32ä½é•¿åº¦ï¼›ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªSequmentå¯ä»¥å‘é€2çš„32æ¬¡æ–¹ä¸ªå­—èŠ‚ï¼Œå¤§çº¦4Gçš„æ•°é‡ï¼ŒSequmentå°±æ— æ³•è¡¨ç¤ºäº†ï¼Œå½“ä¼ è¾“çš„æ•°æ®è¶…è¿‡â€œ4Gâ€ä¹‹åï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¾ç„¶è¦ä½¿ç”¨çš„è¯ï¼ŒSequmentä¼šé‡æ–°å¤ç”¨ï¼›Sequmentå¤ç”¨ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åºåˆ—å·å›ç»•ï¼›ğŸ‘‡</p>
<h2 id="åºåˆ—å·å›ç»•"><a href="#åºåˆ—å·å›ç»•" class="headerlink" title="åºåˆ—å·å›ç»•"></a>åºåˆ—å·å›ç»•</h2><blockquote>
<p>åºåˆ—å·å›ç»• (Protect Against Wrapped Sequence numbers)</p>
</blockquote>
<image src="https://oscimg.oschina.net/oscnet/up-4edfd2031f0ec6ebdaa23c497e18df359cd.png" width=800 height=380>


<ul>
<li>å½“ä¸€ä¸ªè¿æ¥è¦å‘é€6Gçš„æ•°æ®æ˜¯ï¼ŒAã€Bã€Cã€Dåˆ†åˆ«å‘é€1Gçš„æ•°æ®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨æ­¤è¿æ¥ï¼ŒEä¸‹ä¸€æ¬¡å‘é€æ•°æ®1Gï¼ŒSeqåºåˆ—å·å¤ç”¨ï¼ŒEæŠ¥æ–‡æ®µçš„åºåˆ—å·å’ŒAæŠ¥æ–‡æ®µçš„åºåˆ—å·è¡¨ç¤ºç›¸åŒ</li>
<li>æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ç»§ç»­å‘é€æ•°æ®ï¼ŒFæŠ¥æ–‡æ®µçš„Seqæ ‡å¿—å’ŒBæŠ¥æ–‡æ®µçš„æ˜¯ä¸€æ ·çš„ï¼›</li>
<li>åŠ å…¥BæŠ¥æ–‡æ®µåœ¨å‘é€è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ï¼Œç›´åˆ°æ¥å—ç«¯æ¥æ”¶äº†FæŠ¥æ–‡æ®µçš„åŒæ—¶BæŠ¥æ–‡æ®µåˆ°è¾¾æ¥å—ç«¯ï¼Œæ¥å—ç«¯è¯¥å¦‚ä½•åŒºåˆ†ç›¸åŒSeqåºåˆ—å·ä¸åŒæ•°æ®çš„æŠ¥æ–‡æ®µå‘¢ï¼Ÿ</li>
<li>å…¶å®TCPè§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªæŠ¥æ–‡æ®µä¸Šæ·»åŠ Tcp Timestampæ—¶é—´æˆ³ï¼Œç±»ä¼¼äºç‰ˆæœ¬å·çš„ç†å¿µï¼›</li>
<li>æ¥æ”¶ç«¯æ”¶åˆ°ç›¸åŒSeqåºåˆ—å·çš„æŠ¥æ–‡æ®µæ˜¯å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ¥è¿›è¡ŒåŒºåˆ†ï¼›</li>
</ul>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>apache-flink-overview</title>
    <url>/wiki/apache-flink-overview/</url>
    <content><![CDATA[<img src="https://flink.apache.org/img/flink-header-logo.svg" width=300 height=300>

<h2 id="å­¦ä¹ åˆè¡·"><a href="#å­¦ä¹ åˆè¡·" class="headerlink" title="å­¦ä¹ åˆè¡·"></a>å­¦ä¹ åˆè¡·</h2><p>æ¨èç³»ç»Ÿæ•°æ®éœ€è¦å®æ—¶å¤„ç†ï¼Œä½¿ç”¨Apache Flinkå®æ—¶è®¡ç®—ç”¨æˆ·æ•°æ®ï¼Œåˆ†æç”¨æˆ·è¡Œä¸ºï¼Œè¾¾åˆ°å®æ—¶ä¸šåŠ¡æ•°æ®åˆ†æå’Œå®ç°ä¸šåŠ¡ç›¸å…³æ¨èï¼›</p>
<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul>
<li><a href="https://ashiamd.github.io/docsify-notes/#/study/BigData/Flink/%E5%B0%9A%E7%A1%85%E8%B0%B7Flink%E5%85%A5%E9%97%A8%E5%88%B0%E5%AE%9E%E6%88%98-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">ashiamd.github.io</a></li>
<li><a href="https://www.bilibili.com/video/BV1qy4y1q728?p=11&spm_id_from=pageDriver">å°šç¡…è°·2021æœ€æ–°Javaç‰ˆFlink æ­¦è€å¸ˆæ¸…åç¡•å£«ï¼ŒåŸIBM-CDLè´Ÿè´£äºº</a></li>
<li><a href="https://flink.apache.org/">Apache FlinkÂ® â€” Stateful Computations over Data Streams</a></li>
<li><a href="https://flink.apache.org/zh/">Apache FlinkÂ® - æ•°æ®æµä¸Šçš„æœ‰çŠ¶æ€è®¡ç®—</a></li>
</ul>
]]></content>
      <categories>
        <category>Apache Flink</category>
      </categories>
      <tags>
        <tag>flink</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlé…ç½®binlog</title>
    <url>/wiki/binlog%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å¼€å¯binlog"><a href="#å¼€å¯binlog" class="headerlink" title="å¼€å¯binlog"></a>å¼€å¯binlog</h2><p>[mysqld]<br>log-bin=mysql-bin #æ·»åŠ è¿™ä¸€è¡Œå°±ok<br>binlog-format=ROW #é€‰æ‹©rowæ¨¡å¼<br>server_id=1 #é…ç½®mysql replactionéœ€è¦å®šä¹‰ï¼Œä¸èƒ½å’Œcanalçš„slaveIdé‡å¤  </p>
<h2 id="æŸ¥çœ‹binlogçŠ¶æ€"><a href="#æŸ¥çœ‹binlogçŠ¶æ€" class="headerlink" title="æŸ¥çœ‹binlogçŠ¶æ€"></a>æŸ¥çœ‹binlogçŠ¶æ€</h2><p>mysql&gt; show variables like â€˜binlog_formatâ€™;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>
<p>show variables like â€˜log_binâ€™;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>canalåŒæ­¥esåéƒ¨åˆ†å­—æ®µä¸ºnull</title>
    <url>/wiki/canal%E5%90%8C%E6%AD%A5es%E5%90%8E%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5%E4%B8%BAnull/</url>
    <content><![CDATA[<h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><img src="https://oscimg.oschina.net/oscnet/up-54f2fa4a9dfb35acb02b77c5c6bc8c84c0f.png" width=800 height=400>


<p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dataSourceKey: defaultDS        # æºæ•°æ®æºçš„key, å¯¹åº”ä¸Šé¢é…ç½®çš„srcDataSourcesä¸­çš„å€¼</span><br><span class="line">destination: example            # cannalçš„instanceæˆ–è€…MQçš„topic</span><br><span class="line">groupId: g1 # å¯¹åº”MQæ¨¡å¼ä¸‹çš„groupId, åªä¼šåŒæ­¥å¯¹åº”groupIdçš„æ•°æ®</span><br><span class="line">esMapping:</span><br><span class="line">  _index: rd_member_fans_info           # es çš„ç´¢å¼•åç§°</span><br><span class="line">  _type: _doc                   # es çš„docåç§°</span><br><span class="line">  _id: _id                      # es çš„_id, å¦‚æœä¸é…ç½®è¯¥é¡¹å¿…é¡»é…ç½®ä¸‹é¢çš„pké¡¹_idåˆ™ä¼šç”±esè‡ªåŠ¨åˆ†é…</span><br><span class="line">#  pk: id                       # å¦‚æœä¸éœ€è¦_id, åˆ™éœ€è¦æŒ‡å®šä¸€ä¸ªå±æ€§ä¸ºä¸»é”®å±æ€§</span><br><span class="line">#  # sqlæ˜ å°„</span><br><span class="line">  sql: &#x27;SELECT t.id as _id , t.redtom_id ,t.fans_redtom_id,t.fans_username,t.fans_introduce,t.fans_avatar,t.is_each_following,t.follow_channel,t.create_time,t.update_time,t.`status` FROM rd_member_fans_info t&#x27;</span><br><span class="line">#  objFields:</span><br><span class="line">#    _labels: array:;           # æ•°ç»„æˆ–è€…å¯¹è±¡å±æ€§, array:; ä»£è¡¨ä»¥;å­—æ®µé‡Œé¢æ˜¯ä»¥;åˆ†éš”çš„</span><br><span class="line">#    _obj: object               # jsonå¯¹è±¡</span><br><span class="line">  etlCondition: &quot;where t.update_time&gt;=&#123;&#125;&quot; # etl çš„æ¡ä»¶å‚æ•°</span><br><span class="line">  commitBatch: 3000 # æäº¤æ‰¹å¤§å°</span><br></pre></td></tr></table></figure>

<p>âš ï¸ âš ï¸<br>sqlæ‰§è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼</p>
<img src="https://oscimg.oschina.net/oscnet/up-24a77ccd81ae7be4c6d4434f3d1d28edea0.png" width=800 height=400>


<p>canal-adapter è·å–binlogæ•°æ®ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ˜¾ç¤ºæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2021-07-06 15:39:24.588 [pool-1-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:3,&quot;redtom_id&quot;:1,&quot;fans_redtom_id&quot;:1,&quot;fans_username&quot;:&quot;1&quot;,&quot;fans_introduce&quot;:&quot;1&quot;,&quot;fans_avatar&quot;:&quot;1&quot;,&quot;is_each_following&quot;:1,&quot;follow_channel&quot;:1,&quot;create_time&quot;:1625556851000,&quot;update_time&quot;:1625556851000,&quot;status&quot;:2&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625557164000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[&quot;id&quot;],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;rd_member_fans_info&quot;,&quot;ts&quot;:1625557164587,&quot;type&quot;:&quot;INSERT&quot;&#125;</span><br></pre></td></tr></table></figure>


<p>ç„¶åçœ‹ä¸€ä¸‹æˆ‘åˆ›å»ºç´¢å¼•çš„mapping<br><img src="https://oscimg.oschina.net/oscnet/up-8eac2e46423574ae04cd8694d2ac7389530.png" width=800 height=400>  </p>
<h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><p>è°ƒæ•´sqlå¦‚ä¸‹ï¼š </p>
<p><code>SELECT t.id as _id , t.redtom_id ,t.fans_redtom_id,t.fans_username,t.fans_introduce,t.fans_avatar,t.is_each_following,t.follow_channel,t.</code>status<code> as is_deleted , t.create_time,t.update_time FROM rd_member_fans_info t</code></p>
<p>è°ƒæ•´äº†é‚£äº›ä¸œè¥¿å‘¢ï¼Ÿ     <code>status</code> çš„é¡ºåºæå‰è€Œå·²ï¼</p>
<h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š<br><code>curl http://127.0.0.1:8081/etl/es7/rd_member_fans_info.yml -X POST</code></p>
<p>canal-adapter æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2021-07-06 16:21:33.519 [http-nio-8081-exec-1] INFO  c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member_fans_info</span><br><span class="line">2021-07-06 16:21:33.527 [http-nio-8081-exec-1] INFO  c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - æ•°æ®å…¨é‡å¯¼å…¥å®Œæˆ, ä¸€å…±å¯¼å…¥ 3 æ¡æ•°æ®, è€—æ—¶: 7</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹esæ•°æ®ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-69c4ac09e2b8fcd27a5b990e378664d6568.png" width=800 height=400>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>canalåŒæ­¥mysqlæ•°æ®åˆ°elasticsearch</title>
    <url>/wiki/canal%E5%90%8C%E6%AD%A5mysql%E6%95%B0%E6%8D%AE%E5%88%B0elasticsearch/</url>
    <content><![CDATA[<h2 id="é¦–å…ˆå®‰è£…elk"><a href="#é¦–å…ˆå®‰è£…elk" class="headerlink" title="é¦–å…ˆå®‰è£…elk"></a>é¦–å…ˆå®‰è£…elk</h2><p>æ¨èå¤§å®¶åˆ°elasicä¸­æ–‡ç¤¾åŒºå»ä¸‹è½½ ğŸ‘‰ <a href="https://elasticsearch.cn/">ã€ä¼ é€ã€‘</a><br>âš ï¸ elastcisearch | logstash | kibana çš„ç‰ˆæœ¬æœ€å¥½ä¿æŒä¸€ç›´ï¼Œå¦åˆ™ä¼šå‡ºç°å¾ˆå¤šå‘çš„ï¼Œåˆ‡è®°ï¼</p>
<p>å®‰è£…ELKçš„æ­¥éª¤è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œå¯ä»¥æŸ¥çœ‹ ğŸ‘‰ ã€TODOã€‘</p>
<h2 id="ä¸‹è½½å®‰è£…canal-adapter"><a href="#ä¸‹è½½å®‰è£…canal-adapter" class="headerlink" title="ä¸‹è½½å®‰è£…canal-adapter"></a>ä¸‹è½½å®‰è£…canal-adapter</h2><p>canal githubä¼ é€é—¨ ğŸ‘‰  <a href="https://github.com/alibaba/canal">ã€Alibaba Canalã€‘</a></p>
<h3 id="canal-client-æ¨¡å¼"><a href="#canal-client-æ¨¡å¼" class="headerlink" title="canal-client æ¨¡å¼"></a>canal-client æ¨¡å¼</h3><p>å¯ä»¥å‚ç…§canalç»™å‡ºçš„exampleé¡¹ç›®å’Œ<a href="https://github.com/alibaba/canal/wiki/ClientExample">å®˜æ–¹æ–‡æ¡£</a>ç»™å‡ºçš„ä¾‹å­æ¥æµ‹è¯•</p>
<h4 id="ä¾èµ–é…ç½®"><a href="#ä¾èµ–é…ç½®" class="headerlink" title="ä¾èµ–é…ç½®"></a>ä¾èµ–é…ç½®</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºmavené¡¹ç›®"><a href="#åˆ›å»ºmavené¡¹ç›®" class="headerlink" title="åˆ›å»ºmavené¡¹ç›®"></a>åˆ›å»ºmavené¡¹ç›®</h4><p>ä¿è¯canal-server å·²ç»æ­£ç¡®å¯åŠ¨ ğŸ‘ˆ  ç„¶åå¯åŠ¨ä¸‹é¢æœåŠ¡ï¼Œæ“ä½œæ•°æ®åº“å³å¯çœ‹åˆ°æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡ºï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.redtom.canal.deploy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.client.CanalConnector;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.client.CanalConnectors;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.protocol.Message;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> gaolei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/6/30 2:57 ä¸‹åˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CanalClient</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> BATCH_SIZE = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºé“¾æ¥</span></span><br><span class="line">        CanalConnector connector = CanalConnectors.newSingleConnector(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;***.***.***.***&quot;</span>, <span class="number">11111</span>),</span><br><span class="line">                <span class="string">&quot;example&quot;</span>, <span class="string">&quot;canal&quot;</span>, <span class="string">&quot;canal&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰“å¼€è¿æ¥</span></span><br><span class="line">            connector.connect();</span><br><span class="line">            <span class="comment">//è®¢é˜…æ•°æ®åº“è¡¨,å…¨éƒ¨è¡¨</span></span><br><span class="line">            connector.subscribe(<span class="string">&quot;.*\\..*&quot;</span>);</span><br><span class="line">            <span class="comment">//å›æ»šåˆ°æœªè¿›è¡Œackçš„åœ°æ–¹ï¼Œä¸‹æ¬¡fetchçš„æ—¶å€™ï¼Œå¯ä»¥ä»æœ€åä¸€ä¸ªæ²¡æœ‰ackçš„åœ°æ–¹å¼€å§‹æ‹¿</span></span><br><span class="line">            connector.rollback();</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–æŒ‡å®šæ•°é‡çš„æ•°æ®</span></span><br><span class="line">                Message message = connector.getWithoutAck(BATCH_SIZE);</span><br><span class="line">                <span class="comment">//è·å–æ‰¹é‡ID</span></span><br><span class="line">                <span class="keyword">long</span> batchId = message.getId();</span><br><span class="line">                <span class="comment">//è·å–æ‰¹é‡çš„æ•°é‡</span></span><br><span class="line">                <span class="keyword">int</span> size = message.getEntries().size();</span><br><span class="line">                <span class="comment">//å¦‚æœæ²¡æœ‰æ•°æ®</span></span><br><span class="line">                <span class="keyword">if</span> (batchId == -<span class="number">1</span> || size == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">//çº¿ç¨‹ä¼‘çœ 2ç§’</span></span><br><span class="line">                        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœæœ‰æ•°æ®,å¤„ç†æ•°æ®</span></span><br><span class="line">                    printEntry(message.getEntries());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è¿›è¡Œ batch id çš„ç¡®è®¤ã€‚ç¡®è®¤ä¹‹åï¼Œå°äºç­‰äºæ­¤ batchId çš„ Message éƒ½ä¼šè¢«ç¡®è®¤ã€‚</span></span><br><span class="line">                connector.ack(batchId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connector.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“å°canal serverè§£æbinlogè·å¾—çš„å®ä½“ç±»ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printEntry</span><span class="params">(List&lt;CanalEntry.Entry&gt; entrys)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (CanalEntry.Entry entry : entrys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONBEGIN || entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONEND) &#123;</span><br><span class="line">                <span class="comment">//å¼€å¯/å…³é—­äº‹åŠ¡çš„å®ä½“ç±»å‹ï¼Œè·³è¿‡</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//RowChangeå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€è¡Œæ•°æ®å˜åŒ–çš„æ‰€æœ‰ç‰¹å¾</span></span><br><span class="line">            <span class="comment">//æ¯”å¦‚isDdl æ˜¯å¦æ˜¯ddlå˜æ›´æ“ä½œ sql å…·ä½“çš„ddl sql beforeColumns afterColumns å˜æ›´å‰åçš„æ•°æ®å­—æ®µç­‰ç­‰</span></span><br><span class="line">            CanalEntry.RowChange rowChage;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rowChage = CanalEntry.RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;ERROR ## parser of eromanga-event has an error , data:&quot;</span> + entry.toString(), e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–æ“ä½œç±»å‹ï¼šinsert/update/deleteç±»å‹</span></span><br><span class="line">            CanalEntry.EventType eventType = rowChage.getEventType();</span><br><span class="line">            <span class="comment">//æ‰“å°Headerä¿¡æ¯</span></span><br><span class="line">            log.info(<span class="string">&quot;headers:&#123;&#125; &quot;</span>, String.format(<span class="string">&quot;================ã€‹; binlog[%s:%s] , name[%s,%s] , eventType : %s&quot;</span>,</span><br><span class="line">                    entry.getHeader().getLogfileName(), entry.getHeader().getLogfileOffset(),</span><br><span class="line">                    entry.getHeader().getSchemaName(), entry.getHeader().getTableName(),</span><br><span class="line">                    eventType));</span><br><span class="line">            <span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯DDLè¯­å¥</span></span><br><span class="line">            <span class="keyword">if</span> (rowChage.getIsDdl()) &#123;</span><br><span class="line">                log.info(<span class="string">&quot;================ã€‹;isDdl: true,sql: &#123;&#125;&quot;</span>, rowChage.getSql());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–RowChangeå¯¹è±¡é‡Œçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œæ‰“å°å‡ºæ¥</span></span><br><span class="line">            <span class="keyword">for</span> (CanalEntry.RowData rowData : rowChage.getRowDatasList()) &#123;</span><br><span class="line">                <span class="comment">//å¦‚æœæ˜¯åˆ é™¤è¯­å¥</span></span><br><span class="line">                <span class="keyword">if</span> (eventType == CanalEntry.EventType.DELETE) &#123;</span><br><span class="line">                    printColumn(rowData.getBeforeColumnsList());</span><br><span class="line">                    <span class="comment">//å¦‚æœæ˜¯æ–°å¢è¯­å¥</span></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (eventType == CanalEntry.EventType.INSERT) &#123;</span><br><span class="line">                    printColumn(rowData.getAfterColumnsList());</span><br><span class="line">                    <span class="comment">//å¦‚æœæ˜¯æ›´æ–°çš„è¯­å¥</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//å˜æ›´å‰çš„æ•°æ®</span></span><br><span class="line">                    log.info(<span class="string">&quot;-------&gt;; before&quot;</span>);</span><br><span class="line">                    printColumn(rowData.getBeforeColumnsList());</span><br><span class="line">                    <span class="comment">//å˜æ›´åçš„æ•°æ®</span></span><br><span class="line">                    log.info(<span class="string">&quot;-------&gt;; after&quot;</span>);</span><br><span class="line">                    printColumn(rowData.getAfterColumnsList());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printColumn</span><span class="params">(List&lt;CanalEntry.Column&gt; columns)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (CanalEntry.Column column : columns) &#123;</span><br><span class="line">            log.info(<span class="string">&quot; &#123;&#125; :  &#123;&#125;   update= &#123;&#125;&quot;</span>, column.getName(), column.getValue(), column.getUpdated());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="canal-adapter-æ¨¡å¼"><a href="#canal-adapter-æ¨¡å¼" class="headerlink" title="canal-adapter æ¨¡å¼"></a>canal-adapter æ¨¡å¼</h3><p>adapter é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span></span><br><span class="line"></span><br><span class="line"><span class="attr">canal.conf:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">tcp</span> <span class="comment">#tcp kafka rocketMQ rabbitMQ</span></span><br><span class="line">  <span class="attr">flatMessage:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">zookeeperHosts:</span></span><br><span class="line">  <span class="attr">syncBatchSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">batchSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">retries:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">timeout:</span></span><br><span class="line">  <span class="attr">accessKey:</span></span><br><span class="line">  <span class="attr">secretKey:</span></span><br><span class="line">  <span class="attr">consumerProperties:</span></span><br><span class="line">    <span class="comment"># canal tcp consumer</span></span><br><span class="line">    <span class="attr">canal.tcp.server.host:</span> <span class="number">172.25</span><span class="number">.101</span><span class="number">.75</span><span class="string">:11111</span></span><br><span class="line">    <span class="attr">canal.tcp.zookeeper.hosts:</span></span><br><span class="line">    <span class="attr">canal.tcp.batch.size:</span> <span class="number">500</span></span><br><span class="line">    <span class="attr">canal.tcp.username:</span></span><br><span class="line">    <span class="attr">canal.tcp.password:</span></span><br><span class="line">  <span class="attr">srcDataSources:</span></span><br><span class="line">    <span class="attr">defaultDS:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://xxxx:pppp/database?useUnicode=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">pwd</span></span><br><span class="line">  <span class="attr">canalAdapters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">instance:</span> <span class="string">example</span> <span class="comment"># canal instance Name or mq topic name</span></span><br><span class="line">    <span class="attr">groups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">groupId:</span> <span class="string">g1</span></span><br><span class="line">      <span class="attr">outerAdapters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logger</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">es7</span></span><br><span class="line">        <span class="attr">hosts:</span> <span class="number">172.25</span><span class="number">.101</span><span class="number">.75</span><span class="string">:9300</span> <span class="comment"># 127.0.0.1:9200 for rest mode</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">mode:</span> <span class="string">transport</span> <span class="comment"># or rest</span></span><br><span class="line"><span class="comment">#          # security.auth: test:123456 #  only used for rest mode</span></span><br><span class="line">          <span class="attr">cluster.name:</span> <span class="string">my-application</span></span><br><span class="line"><span class="comment">#        - name: kudu</span></span><br><span class="line"><span class="comment">#          key: kudu</span></span><br><span class="line"><span class="comment">#          properties:</span></span><br><span class="line"><span class="comment">#            kudu.master.address: 127.0.0.1 # &#x27;,&#x27; split multi address</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘çš„elasticsearchæ˜¯7.10.0ç‰ˆæœ¬çš„<br><code>application.yml  bootstrap.yml  es6  es7  hbase  kudu  logback.xml  META-INF  rdb</code><br>æ‰€ä»¥ï¼šğŸ‘‡</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd es7</span><br><span class="line">biz_order.yml  customer.yml  mytest_user.yml</span><br><span class="line">vim customer.yml</span><br></pre></td></tr></table></figure>

<p>customer.yml é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dataSourceKey:</span> <span class="string">defaultDS</span></span><br><span class="line"><span class="attr">destination:</span> <span class="string">example</span></span><br><span class="line"><span class="attr">groupId:</span> <span class="string">g1</span></span><br><span class="line"><span class="attr">esMapping:</span></span><br><span class="line">  <span class="attr">_index:</span> <span class="string">customer</span></span><br><span class="line">  <span class="attr">_id:</span> <span class="string">id</span></span><br><span class="line">  <span class="attr">relations:</span></span><br><span class="line">    <span class="attr">customer_order:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">customer</span></span><br><span class="line">  <span class="attr">sql:</span> <span class="string">&quot;select t.id, t.name, t.email from customer t&quot;</span></span><br><span class="line">  <span class="attr">etlCondition:</span> <span class="string">&quot;where t.c_time&gt;=&#123;&#125;&quot;</span></span><br><span class="line">  <span class="attr">commitBatch:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºè¡¨ç»“æ„"><a href="#åˆ›å»ºè¡¨ç»“æ„" class="headerlink" title="åˆ›å»ºè¡¨ç»“æ„"></a>åˆ›å»ºè¡¨ç»“æ„</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `customer` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `order_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `order_serial` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `order_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `customer_order` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>


<h4 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT customer</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;email&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;order_id&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;order_serial&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;order_time&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;customer_order&quot;</span>:&#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;join&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;relations&quot;</span>:&#123;</span><br><span class="line">            <span class="attr">&quot;customer&quot;</span>:<span class="string">&quot;order&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœ"><a href="#æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœ" class="headerlink" title="æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœ"></a>æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœ</h4><h5 id="åˆ›å»ºä¸€æ¡è®°å½•"><a href="#åˆ›å»ºä¸€æ¡è®°å½•" class="headerlink" title="åˆ›å»ºä¸€æ¡è®°å½•"></a>åˆ›å»ºä¸€æ¡è®°å½•</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2021-07-05 11:50:53.725 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;1&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457053000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457053724,&quot;type&quot;:&quot;INSERT&quot;&#125;</span><br><span class="line">Affected indexes: customer</span><br></pre></td></tr></table></figure>
<p>Elastcisearch æ•ˆæœ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;customer&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">1.0</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;email&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;customer_order&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;name&quot;</span> : <span class="string">&quot;customer&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2021-07-05 11:54:36.402 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457275000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:[&#123;&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;customer_order&quot;:&quot;1&quot;&#125;],&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457276401,&quot;type&quot;:&quot;UPDATE&quot;&#125;</span><br><span class="line">Affected indexes: customer</span><br></pre></td></tr></table></figure>
<p>Elastcisearch æ•ˆæœ<br><img src="https://oscimg.oschina.net/oscnet/up-afadff417c35ecb74811967d8e1da10f134.png" width=700 height=400></p>
<h5 id="åˆ é™¤ä¸€æ¡æ•°æ®"><a href="#åˆ é™¤ä¸€æ¡æ•°æ®" class="headerlink" title="åˆ é™¤ä¸€æ¡æ•°æ®"></a>åˆ é™¤ä¸€æ¡æ•°æ®</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2021-07-05 11:56:51.524 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457411000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457411523,&quot;type&quot;:&quot;DELETE&quot;&#125;</span><br><span class="line">Affected indexes: customer</span><br></pre></td></tr></table></figure>
<p>Elastcisearch æ•ˆæœ<br><img src="https://oscimg.oschina.net/oscnet/up-7f49aeda581a547bf528b55bad6d0af27de.png" width=700 height=400></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/puhaiyang/article/details/100171395">ä½¿ç”¨canal client-adapterå®Œæˆmysqlåˆ°esæ•°æ®åŒæ­¥æ•™ç¨‹(åŒ…æ‹¬å…¨é‡å’Œå¢é‡)</a></li>
<li><a href="https://github.com/alibaba/canal/issues/1514">es åŒæ­¥é—®é¢˜ #1514 Github issue</a></li>
<li><a href="https://www.bookstack.cn/read/canal-v1.1.4/f5f4adc96eefafe4.md">canal v1.1.4 æ–‡æ¡£æ‰‹å†Œ</a></li>
<li><a href="https://www.bookstack.cn/read/canal-v1.1.4/63ebbe076bc97d0f.md">Sync es</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>copy_toå‚æ•°</title>
    <url>/wiki/copy-to%E5%8F%82%E6%95%B0/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/custom-all.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» è‡ªå®šä¹‰ _all å­—æ®µ</a></li>
<li><a href="https://doc.codingdict.com/elasticsearch/319/">Docs Â» Mapping parametersï¼ˆæ˜ å°„å‚æ•°ï¼‰ Â» Mapping(æ˜ å°„) Â» copy_toï¼ˆåˆå¹¶å‚æ•°ï¼‰</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>cross-fieldsè·¨å­—æ®µæŸ¥è¯¢</title>
    <url>/wiki/cross-fields%E8%B7%A8%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_cross_fields_queries.html#_cross_fields_queries">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» cross-fields è·¨å­—æ®µæŸ¥è¯¢</a></li>
<li><a href=""></a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>dis_maxæŸ¥è¯¢</title>
    <url>/wiki/dis-max%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<p>å‡è®¾æœ‰ä¸ªç½‘ç«™å…è®¸ç”¨æˆ·æœç´¢åšå®¢çš„å†…å®¹ï¼Œä»¥ä¸‹é¢ä¸¤ç¯‡åšå®¢å†…å®¹æ–‡æ¡£ä¸ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index/my_type/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Quick brown rabbits&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body&quot;</span>:  <span class="string">&quot;Brown rabbits are commonly seen.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /my_index/my_type/<span class="number">2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Keeping pets healthy&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;body&quot;</span>:  <span class="string">&quot;My quick brown fox eats rabbits on a regular basis.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·è¾“å…¥è¯ç»„ <code>Brown fox</code> ç„¶åç‚¹å‡»æœç´¢æŒ‰é’®ã€‚äº‹å…ˆï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„æœç´¢é¡¹æ˜¯ä¼šåœ¨ title è¿˜æ˜¯åœ¨ body å­—æ®µä¸­è¢«æ‰¾åˆ°ï¼Œä½†æ˜¯ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½æ˜¯æƒ³æœç´¢ç›¸å…³çš„è¯ç»„ã€‚ç”¨è‚‰çœ¼åˆ¤æ–­ï¼Œæ–‡æ¡£ 2 çš„åŒ¹é…åº¦æ›´é«˜ï¼Œå› ä¸ºå®ƒåŒæ—¶åŒ…æ‹¬è¦æŸ¥æ‰¾çš„ä¸¤ä¸ªè¯ï¼š</p>
<p>ç°åœ¨è¿è¡Œä»¥ä¸‹ bool æŸ¥è¯¢ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;should&quot;</span>: [</span><br><span class="line">                &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Brown fox&quot;</span> &#125;&#125;,</span><br><span class="line">                &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;body&quot;</span>:  <span class="string">&quot;Brown fox&quot;</span> &#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°æŸ¥è¯¢çš„ç»“æœæ˜¯æ–‡æ¡£ 1 çš„è¯„åˆ†æ›´é«˜ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-fa805607436bd64629e31ea8ea574c330cf.png" width=920 height=450>  

<p>ä¸ºäº†ç†è§£å¯¼è‡´è¿™æ ·çš„åŸå› ï¼Œéœ€è¦å›æƒ³ä¸€ä¸‹ bool æ˜¯å¦‚ä½•è®¡ç®—è¯„åˆ†çš„ï¼š</p>
<p>å®ƒä¼šæ‰§è¡Œ should è¯­å¥ä¸­çš„ä¸¤ä¸ªæŸ¥è¯¢ã€‚<br>åŠ å’Œä¸¤ä¸ªæŸ¥è¯¢çš„è¯„åˆ†ã€‚<br>ä¹˜ä»¥åŒ¹é…è¯­å¥çš„æ€»æ•°ã€‚<br>é™¤ä»¥æ‰€æœ‰è¯­å¥æ€»æ•°ï¼ˆè¿™é‡Œä¸ºï¼š2ï¼‰ã€‚</p>
<p>æ–‡æ¡£ 1 çš„ä¸¤ä¸ªå­—æ®µéƒ½åŒ…å« <code>brown</code> è¿™ä¸ªè¯ï¼Œæ‰€ä»¥ä¸¤ä¸ª <code>match</code> è¯­å¥éƒ½èƒ½æˆåŠŸåŒ¹é…å¹¶ä¸”æœ‰ä¸€ä¸ªè¯„åˆ†ã€‚æ–‡æ¡£ 2 çš„ body å­—æ®µåŒæ—¶åŒ…å« <code>brown</code> å’Œ <code>fox</code> è¿™ä¸¤ä¸ªè¯ï¼Œä½† title å­—æ®µæ²¡æœ‰åŒ…å«ä»»ä½•è¯ã€‚è¿™æ ·ï¼Œ body æŸ¥è¯¢ç»“æœä¸­çš„é«˜åˆ†ï¼ŒåŠ ä¸Š title æŸ¥è¯¢ä¸­çš„ 0 åˆ†ï¼Œç„¶åä¹˜ä»¥äºŒåˆ†ä¹‹ä¸€ï¼Œå°±å¾—åˆ°æ¯”æ–‡æ¡£ 1 æ›´ä½çš„æ•´ä½“è¯„åˆ†ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ title å’Œ body å­—æ®µæ˜¯ç›¸äº’ç«äº‰çš„å…³ç³»ï¼Œæ‰€ä»¥å°±éœ€è¦æ‰¾åˆ°å•ä¸ª æœ€ä½³åŒ¹é… çš„å­—æ®µã€‚</p>
<p>å¦‚æœä¸æ˜¯ç®€å•å°†æ¯ä¸ªå­—æ®µçš„è¯„åˆ†ç»“æœåŠ åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯å°† <code>æœ€ä½³åŒ¹é…</code> å­—æ®µçš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„æ•´ä½“è¯„åˆ†ï¼Œç»“æœä¼šæ€æ ·ï¼Ÿè¿™æ ·è¿”å›çš„ç»“æœå¯èƒ½æ˜¯ï¼š åŒæ—¶ åŒ…å« <code>brown</code> å’Œ <code>fox</code> çš„å•ä¸ªå­—æ®µæ¯”åå¤å‡ºç°ç›¸åŒè¯è¯­çš„å¤šä¸ªä¸åŒå­—æ®µæœ‰æ›´é«˜çš„ç›¸å…³åº¦ã€‚</p>
<h2 id="dis-max-æŸ¥è¯¢"><a href="#dis-max-æŸ¥è¯¢" class="headerlink" title="dis_max æŸ¥è¯¢"></a>dis_max æŸ¥è¯¢</h2><p>ä¸ä½¿ç”¨ <code>bool</code> æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ <code>dis_max</code> å³åˆ†ç¦» æœ€å¤§åŒ–æŸ¥è¯¢ <code>ï¼ˆDisjunction Max Queryï¼‰</code> ã€‚åˆ†ç¦»ï¼ˆDisjunctionï¼‰çš„æ„æ€æ˜¯ æˆ–ï¼ˆorï¼‰ ï¼Œè¿™ä¸å¯ä»¥æŠŠç»“åˆï¼ˆconjunctionï¼‰ç†è§£æˆ ä¸ï¼ˆandï¼‰ ç›¸å¯¹åº”ã€‚åˆ†ç¦»æœ€å¤§åŒ–æŸ¥è¯¢ï¼ˆDisjunction Max Queryï¼‰æŒ‡çš„æ˜¯ï¼š å°†ä»»ä½•ä¸ä»»ä¸€æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ï¼Œä½†åªå°†æœ€ä½³åŒ¹é…çš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„è¯„åˆ†ç»“æœè¿”å› ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;dis_max&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;queries&quot;</span>: [</span><br><span class="line">                &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Brown fox&quot;</span> &#125;&#125;,</span><br><span class="line">                &#123; <span class="attr">&quot;match&quot;</span>: &#123; <span class="attr">&quot;body&quot;</span>:  <span class="string">&quot;Brown fox&quot;</span> &#125;&#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœä¸ºï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-f4e15cd66644b0031abe4757efdcfdd2886.png" width=900 height=450>  </p>
<h2 id="Top-level-parameters-for-dis-maxedit"><a href="#Top-level-parameters-for-dis-maxedit" class="headerlink" title="Top-level parameters for dis_maxedit"></a>Top-level parameters for dis_maxedit</h2><ul>
<li><code>queries</code><br>(Required, array of query objects) Contains one or more query clauses. Returned documents must match one or more of these queries. If a document matches multiple queries, Elasticsearch uses the highest relevance score.</li>
<li><code>tie_breaker</code><br>(Optional, float) Floating point number between 0 and 1.0 used to increase the relevance scores of documents matching multiple query clauses. Defaults to 0.0.</li>
</ul>
<p>You can use the tie_breaker value to assign higher relevance scores to documents that contain the same term in multiple fields than documents that contain this term in only the best of those multiple fields, without confusing this with the better case of two different terms in the multiple fields.</p>
<p>If a document matches multiple clauses, the dis_max query calculates the relevance score for the document as follows:</p>
<p>Take the relevance score from a matching clause with the highest score.<br>Multiply the score from any other matching clauses by the tie_breaker value.<br>Add the highest score to the multiplied scores.<br>If the tie_breaker value is greater than 0.0, all matching clauses count, but the clause with the highest score counts most.</p>
<p><code>dis_max</code>ï¼Œåªæ˜¯å–åˆ†æ•°æœ€é«˜çš„é‚£ä¸ªqueryçš„åˆ†æ•°è€Œå·²ï¼Œå®Œå…¨ä¸è€ƒè™‘å…¶ä»–queryçš„åˆ†æ•°ï¼Œè¿™ç§ä¸€åˆ€åˆ‡çš„åšæ³•ï¼Œå¯èƒ½å¯¼è‡´åœ¨æœ‰å…¶ä»–queryçš„å½±å“ä¸‹ï¼Œscoreä¸å‡†ç¡®çš„æƒ…å†µï¼Œè¿™æ—¶ä¸ºäº†ä½¿ç”¨ç»“æœæ›´å‡†ç¡®ï¼Œæœ€å¥½è¿˜æ˜¯è¦è€ƒè™‘åˆ°å…¶ä»–queryçš„å½±å“;<br>ä½¿ç”¨ <code>tie_breaker</code> å°†å…¶ä»–queryçš„åˆ†æ•°ä¹Ÿè€ƒè™‘è¿›å», <code>tie_breaker</code> å‚æ•°çš„æ„ä¹‰ï¼Œå°†å…¶ä»–queryçš„åˆ†æ•°ä¹˜ä»¥<code>tie_breaker</code>ï¼Œç„¶åç»¼åˆè€ƒè™‘åä¸æœ€é«˜åˆ†æ•°çš„é‚£ä¸ªqueryçš„åˆ†æ•°ç»¼åˆåœ¨ä¸€èµ·è¿›è¡Œè®¡ç®—ï¼Œè¿™æ ·åšé™¤äº†å–æœ€é«˜åˆ†ä»¥å¤–ï¼Œè¿˜ä¼šè€ƒè™‘å…¶ä»–çš„queryçš„åˆ†æ•°ã€‚<code>tie_breaker</code>çš„å€¼ï¼Œè®¾ç½®åœ¨åœ¨0~1ä¹‹é—´ï¼Œæ˜¯ä¸ªå°æ•°å°±è¡Œï¼Œæ²¡æœ‰å›ºå®šçš„å€¼</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_best_fields.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» æœ€ä½³å­—æ®µ</a></li>
<li><a href="https://learnku.com/docs/elasticsearch73/7.3">Elasticsearchä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-dis-max-query.html">Elasticsearch Guide [7.x] Â» Query DSL Â» Compound queries Â» Disjunction max query</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>docker-compostå®‰è£…mongodb</title>
    <url>/wiki/docker-compost%E5%AE%89%E8%A3%85mongodb/</url>
    <content><![CDATA[<blockquote>
<p>mongo é…ç½®æ–‡ä»¶ -&gt; <a href="https://www.cnblogs.com/xibuhaohao/p/12580331.html">https://www.cnblogs.com/xibuhaohao/p/12580331.html</a></p>
</blockquote>
<h2 id="docker-compose-é…ç½®æ–‡ä»¶"><a href="#docker-compose-é…ç½®æ–‡ä»¶" class="headerlink" title="docker-compose  é…ç½®æ–‡ä»¶"></a>docker-compose  é…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:4.4.7</span> <span class="comment">#æ ¹æ®éœ€è¦é€‰æ‹©è‡ªå·±çš„é•œåƒ</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="number">27017</span><span class="string">:27017</span> <span class="comment">#å¯¹å¤–æš´éœ²åœä¾›æœåŠ¡çš„ç«¯å£ï¼Œæ­£å¼ç”Ÿäº§çš„æ—¶å€™ç†è®ºä¸ç”¨æš´éœ²ã€‚</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./mongodb/data/db:/data/db</span> <span class="comment"># æŒ‚è½½æ•°æ®ç›®å½•</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./mongodb/data/log:/var/log/mongodb</span>  <span class="comment"># æŒ‚è½½æ—¥å¿—ç›®å½•</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./mongodb/data/config:/etc/mongo</span>  <span class="comment"># æŒ‚è½½é…ç½®ç›®å½•</span></span><br><span class="line">    <span class="comment"># command: --config /docker/mongodb/mongod.conf # é…ç½®æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h2 id="æŒ‰ç…§ä¸Šé¢ğŸ‘†é…ç½®æ–‡ä»¶è®¾ç½®ç›®å½•"><a href="#æŒ‰ç…§ä¸Šé¢ğŸ‘†é…ç½®æ–‡ä»¶è®¾ç½®ç›®å½•" class="headerlink" title="æŒ‰ç…§ä¸Šé¢ğŸ‘†é…ç½®æ–‡ä»¶è®¾ç½®ç›®å½•"></a>æŒ‰ç…§ä¸Šé¢ğŸ‘†é…ç½®æ–‡ä»¶è®¾ç½®ç›®å½•</h2><p><code>/data/db/mongodb/data</code><br><code>ls -l</code><br><code>config  db  log</code></p>
<h2 id="mongo-é…ç½®æ–‡ä»¶"><a href="#mongo-é…ç½®æ–‡ä»¶" class="headerlink" title="mongo é…ç½®æ–‡ä»¶"></a>mongo é…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Where and how to store data.</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line">  <span class="attr">dbPath:</span> <span class="string">/data/db/mongodb/data/db</span></span><br><span class="line">  <span class="attr">journal:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#  engine:</span></span><br><span class="line"><span class="comment">#  mmapv1:</span></span><br><span class="line"><span class="comment">#  wiredTiger:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># where to write logging data.</span></span><br><span class="line"><span class="attr">systemLog:</span></span><br><span class="line">  <span class="attr">destination:</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">logAppend:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/data/db/mongodb/data/log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># network interfaces</span></span><br><span class="line"><span class="attr">net:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">  <span class="attr">bindIp:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># how the process runs</span></span><br><span class="line"><span class="attr">processManagement:</span></span><br><span class="line">  <span class="attr">timeZoneInfo:</span> <span class="string">/usr/share/zoneinfo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#security:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#operationProfiling:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#replication:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#sharding:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Enterprise-Only Options:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#auditLog:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#snmp:</span></span><br></pre></td></tr></table></figure>

<p><code>bindIp: 0.0.0.0</code> å…è®¸è¿œç¨‹è®¿é—®</p>
<h2 id="docker-composeå¯åŠ¨mongo"><a href="#docker-composeå¯åŠ¨mongo" class="headerlink" title="docker-composeå¯åŠ¨mongo"></a>docker-composeå¯åŠ¨mongo</h2><p><code>docker-compose up -d</code><br><code>docker ps</code></p>
<h2 id="è¿›å…¥docker"><a href="#è¿›å…¥docker" class="headerlink" title="è¿›å…¥docker"></a>è¿›å…¥docker</h2><p><code>docker ps</code><br><code>docker exec -it xxxxxxxxxx bash</code></p>
<h2 id="mongoåˆ›å»ºæ•°æ®åº“"><a href="#mongoåˆ›å»ºæ•°æ®åº“" class="headerlink" title="mongoåˆ›å»ºæ•°æ®åº“"></a>mongoåˆ›å»ºæ•°æ®åº“</h2><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><p><code>mongo</code></p>
<h3 id="æŸ¥çœ‹æ•°æ®åº“"><a href="#æŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“"></a>æŸ¥çœ‹æ•°æ®åº“</h3><p><code>show dbs</code></p>
<h3 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h3><p><code>use wechat_spider</code>  ç„¶å <code>db</code> æŸ¥çœ‹</p>
<h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">db.createUser(</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="keyword">user</span>:&quot;wechat&quot;,</span><br><span class="line">       pwd:&quot;123456&quot;,</span><br><span class="line">       roles:[&#123;role:&quot;readWrite&quot;,db:&quot;wechat_spider&quot;&#125;]</span><br><span class="line">     &#125;</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>



<h2 id="Javaå®¢æˆ·ç«¯é“¾æ¥"><a href="#Javaå®¢æˆ·ç«¯é“¾æ¥" class="headerlink" title="Javaå®¢æˆ·ç«¯é“¾æ¥"></a>Javaå®¢æˆ·ç«¯é“¾æ¥</h2><h3 id="é…ç½®mvn"><a href="#é…ç½®mvn" class="headerlink" title="é…ç½®mvn"></a>é…ç½®mvn</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo-java-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">&#x27;wechat&#x27;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line"><span class="comment">#      port: 3333</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">wechat_spider</span></span><br><span class="line"><span class="comment">#      host: 123.56.77.177</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">39.107</span><span class="number">.117</span><span class="number">.232</span></span><br><span class="line">      <span class="attr">repositories:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">auto</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="domain"><a href="#domain" class="headerlink" title="domain"></a>domain</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> gaolei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/7/28 ä¸Šåˆ10:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Document(collection = &quot;passenger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Passenger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestContoller</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/insert&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Passenger passenger = <span class="keyword">new</span> Passenger();</span><br><span class="line">        passenger.setName(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        passenger.setPassword(<span class="string">&quot;world1&quot;</span>);</span><br><span class="line">        passenger = mongoTemplate.insert(passenger);</span><br><span class="line">        <span class="keyword">if</span> (passenger != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;false&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













]]></content>
      <categories>
        <category>DataBase</category>
        <category>MongoDB</category>
      </categories>
      <tags>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerå¸¸ç”¨æ‰‹å†Œ</title>
    <url>/wiki/docker%E5%B8%B8%E7%94%A8%E6%89%8B%E5%86%8C/</url>
    <content><![CDATA[<blockquote>
<p><b>dockerä¸­æ–‡æ–‡æ¡£</b>  <a href="http://www.dockerinfo.net/document">http://www.dockerinfo.net/document</a><br><b>docker doc</b> <a href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a><br><b>docker ä¸­æ–‡ç¤¾åŒº</b> <a href="https://www.docker.org.cn/">https://www.docker.org.cn/</a></p>
</blockquote>
<h3 id="æœç´¢å¯ç”¨é•œåƒ"><a href="#æœç´¢å¯ç”¨é•œåƒ" class="headerlink" title="æœç´¢å¯ç”¨é•œåƒ"></a>æœç´¢å¯ç”¨é•œåƒ</h3><p><code>docker search tutorial</code></p>
<h3 id="æ£€æŸ¥è¿è¡Œçš„é•œåƒ"><a href="#æ£€æŸ¥è¿è¡Œçš„é•œåƒ" class="headerlink" title="æ£€æŸ¥è¿è¡Œçš„é•œåƒ"></a>æ£€æŸ¥è¿è¡Œçš„é•œåƒ</h3><p><code>docker inspect efe</code></p>
<h3 id="å‘å¸ƒé•œåƒ"><a href="#å‘å¸ƒé•œåƒ" class="headerlink" title="å‘å¸ƒé•œåƒ"></a>å‘å¸ƒé•œåƒ</h3><p><code>docker push</code></p>
<h3 id="ä¸‹è½½é•œåƒ"><a href="#ä¸‹è½½é•œåƒ" class="headerlink" title="ä¸‹è½½é•œåƒ"></a>ä¸‹è½½é•œåƒ</h3><p><code>docker pull</code></p>
<h3 id="åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åº"><a href="#åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åº" class="headerlink" title="åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åº"></a>åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åº</h3><p><code>apt-get update</code><br><code>apt-get install vim</code></p>
<h3 id="ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹"><a href="#ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹" class="headerlink" title="ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹"></a>ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹</h3><p><code>docker commit pid</code></p>
]]></content>
      <categories>
        <category>Develop Tools</category>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>dockeræ•´ä½“æ¶æ„å›¾</title>
    <url>/wiki/docker%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84%E5%9B%BE/</url>
    <content><![CDATA[<h1 id="Dockerçš„æ€»æ¶æ„å›¾"><a href="#Dockerçš„æ€»æ¶æ„å›¾" class="headerlink" title="Dockerçš„æ€»æ¶æ„å›¾"></a>Dockerçš„æ€»æ¶æ„å›¾</h1><img src='https://cdn.zsite.com/data/upload/d/docker/202104/f_e2031050ce83ec39ca6574875e047811.png' width=500 height=600>

<p>dockeræ˜¯ä¸€ä¸ªC/Sæ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œæ¨¡å—å„å¸å…¶èŒã€‚</p>
<p>1ã€ç”¨æˆ·æ˜¯ä½¿ç”¨Docker Clientä¸Docker Daemonå»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚<br>2ã€Docker Daemonä½œä¸ºDockeræ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾›Serverçš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å—Docker Clientçš„è¯·æ±‚ï¼›<br>3ã€Engineæ‰§è¡ŒDockerå†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ªJobçš„å½¢å¼çš„å­˜åœ¨ã€‚<br>4ã€Jobçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä»Docker Registryä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨graphdriverå°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ï¼›<br>5ã€å½“éœ€è¦ä¸ºDockeråˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨networkdriveråˆ›å»ºå¹¶é…ç½®Dockerå®¹å™¨ç½‘ç»œç¯å¢ƒï¼›<br>6ã€å½“éœ€è¦é™åˆ¶Dockerå®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡execdriveræ¥å®Œæˆã€‚<br>7ã€libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼Œnetworkdriverä»¥åŠexecdriveréƒ½æ˜¯é€šè¿‡libcontaineræ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚</p>
]]></content>
      <categories>
        <category>Develop Tools</category>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearch-analyzer</title>
    <url>/wiki/elasticsearch-analyzer/</url>
    <content><![CDATA[<h2 id="æµ‹è¯•å¸¸è§åˆ†æå™¨"><a href="#æµ‹è¯•å¸¸è§åˆ†æå™¨" class="headerlink" title="æµ‹è¯•å¸¸è§åˆ†æå™¨"></a>æµ‹è¯•å¸¸è§åˆ†æå™¨</h2><p><code>GET /_analyze</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Oredr it now from Amazon  #fun #girlpower #fatscooter #Fat #Cats&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>GET /_analyze</code>  </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Oredr it now from Amazon  #fun #girlpower #fatscooter #Fat #Cats&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>GET /_analyze</code>   </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Oredr it now from Amazon  #fun #girlpower #fatscooter #Fat Cats&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>GET /_analyze</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Oredr it now from Amazon  #fun #girlpower #fatscooter #Fat Cats&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="é»˜è®¤åˆ†æå™¨"><a href="#é»˜è®¤åˆ†æå™¨" class="headerlink" title="é»˜è®¤åˆ†æå™¨"></a>é»˜è®¤åˆ†æå™¨</h2><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µå±‚çº§æŒ‡å®šåˆ†æå™¨ï¼Œä½†æ˜¯å¦‚æœè¯¥å±‚çº§æ²¡æœ‰æŒ‡å®šä»»ä½•çš„åˆ†æå™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•èƒ½ç¡®å®šè¿™ä¸ªå­—æ®µä½¿ç”¨çš„æ˜¯å“ªä¸ªåˆ†æå™¨å‘¢ï¼Ÿ  </p>
<p>åˆ†æå™¨å¯ä»¥ä»ä¸‰ä¸ªå±‚é¢è¿›è¡Œå®šä¹‰ï¼šæŒ‰å­—æ®µï¼ˆper-fieldï¼‰ã€æŒ‰ç´¢å¼•ï¼ˆper-indexï¼‰æˆ–å…¨å±€ç¼ºçœï¼ˆglobal defaultï¼‰ã€‚Elasticsearch ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºä¾æ¬¡å¤„ç†ï¼Œç›´åˆ°å®ƒæ‰¾åˆ°èƒ½å¤Ÿä½¿ç”¨çš„åˆ†æå™¨ã€‚ç´¢å¼•æ—¶çš„é¡ºåºå¦‚ä¸‹ï¼š</p>
<ul>
<li>å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ analyzer ï¼Œå¦åˆ™</li>
<li>ç´¢å¼•è®¾ç½®ä¸­åä¸º default çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º</li>
<li>standard æ ‡å‡†åˆ†æå™¨</li>
</ul>
<p>åœ¨æœç´¢æ—¶ï¼Œé¡ºåºæœ‰äº›è®¸ä¸åŒï¼š</p>
<ul>
<li>æŸ¥è¯¢è‡ªå·±å®šä¹‰çš„ analyzer ï¼Œå¦åˆ™</li>
<li>å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ analyzer ï¼Œå¦åˆ™</li>
<li>ç´¢å¼•è®¾ç½®ä¸­åä¸º default çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º</li>
<li>standard æ ‡å‡†åˆ†æå™¨</li>
</ul>
<p>æœ‰æ—¶ï¼Œåœ¨ç´¢å¼•æ—¶å’Œæœç´¢æ—¶ä½¿ç”¨ä¸åŒçš„åˆ†æå™¨æ˜¯åˆç†çš„ã€‚æˆ‘ä»¬å¯èƒ½è¦æƒ³ä¸ºåŒä¹‰è¯å»ºç´¢å¼•ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰ quick å‡ºç°çš„åœ°æ–¹ï¼ŒåŒæ—¶ä¹Ÿä¸º fast ã€ rapid å’Œ speedy åˆ›å»ºç´¢å¼•ï¼‰ã€‚ä½†åœ¨æœç´¢æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æœç´¢æ‰€æœ‰çš„åŒä¹‰è¯ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å¯»æ‰¾ç”¨æˆ·è¾“å…¥çš„å•è¯æ˜¯å¦æ˜¯ quick ã€ fast ã€ rapid æˆ– speedy ã€‚</p>
<p>ä¸ºäº†åŒºåˆ†ï¼ŒElasticsearch ä¹Ÿæ”¯æŒä¸€ä¸ªå¯é€‰çš„ <code>search_analyzer</code> æ˜ å°„ï¼Œå®ƒä»…ä¼šåº”ç”¨äºæœç´¢æ—¶ï¼ˆ <code>analyzer</code> è¿˜ç”¨äºç´¢å¼•æ—¶ï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªç­‰ä»·çš„ <code>default_search</code> æ˜ å°„ï¼Œç”¨ä»¥æŒ‡å®šç´¢å¼•å±‚çš„é»˜è®¤é…ç½®ã€‚</p>
<p>å¦‚æœè€ƒè™‘åˆ°è¿™äº›é¢å¤–å‚æ•°ï¼Œä¸€ä¸ªæœç´¢æ—¶çš„ å®Œæ•´ é¡ºåºä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<p>æŸ¥è¯¢è‡ªå·±å®šä¹‰çš„ <code>analyzer</code> ï¼Œå¦åˆ™<br>å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ <code>search_analyzer</code> ï¼Œå¦åˆ™<br>å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ <code>analyzer</code> ï¼Œå¦åˆ™<br>ç´¢å¼•è®¾ç½®ä¸­åä¸º <code>default_search</code> çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º<br>ç´¢å¼•è®¾ç½®ä¸­åä¸º <code>default</code> çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º<code>standard</code> æ ‡å‡†åˆ†æå™¨</p>
<h2 id="ä¿æŒç®€å•"><a href="#ä¿æŒç®€å•" class="headerlink" title="ä¿æŒç®€å•"></a>ä¿æŒç®€å•</h2><p>å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šæå‰çŸ¥é“æ–‡æ¡£ä¼šåŒ…æ‹¬å“ªäº›å­—æ®µã€‚æœ€ç®€å•çš„é€”å¾„å°±æ˜¯åœ¨åˆ›å»ºç´¢å¼•æˆ–è€…å¢åŠ ç±»å‹æ˜ å°„æ—¶ï¼Œä¸ºæ¯ä¸ªå…¨æ–‡å­—æ®µè®¾ç½®åˆ†æå™¨ã€‚è¿™ç§æ–¹å¼å°½ç®¡æœ‰ç‚¹éº»çƒ¦ï¼Œä½†æ˜¯å®ƒè®©æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°æ¯ä¸ªå­—æ®µæ¯ä¸ªåˆ†æå™¨æ˜¯å¦‚ä½•è®¾ç½®çš„ã€‚</p>
<p>é€šå¸¸ï¼Œå¤šæ•°å­—ç¬¦ä¸²å­—æ®µéƒ½æ˜¯ <code>not_analyzed</code> ç²¾ç¡®å€¼å­—æ®µï¼Œæ¯”å¦‚æ ‡ç­¾ï¼ˆtagï¼‰æˆ–æšä¸¾ï¼ˆenumï¼‰ï¼Œè€Œä¸”æ›´å¤šçš„å…¨æ–‡å­—æ®µä¼šä½¿ç”¨é»˜è®¤çš„ <code>standard</code> åˆ†æå™¨æˆ– <code>english</code> æˆ–å…¶ä»–æŸç§è¯­è¨€çš„åˆ†æå™¨ã€‚è¿™æ ·åªéœ€è¦ä¸ºå°‘æ•°ä¸€ä¸¤ä¸ªå­—æ®µæŒ‡å®šè‡ªå®šä¹‰åˆ†æï¼šæˆ–è®¸æ ‡é¢˜ title å­—æ®µéœ€è¦ä»¥æ”¯æŒ è¾“å…¥å³æŸ¥æ‰¾ï¼ˆfind-as-you-typeï¼‰ çš„æ–¹å¼è¿›è¡Œç´¢å¼•ã€‚</p>
<p>å¯ä»¥åœ¨ç´¢å¼•çº§åˆ«è®¾ç½®ä¸­ï¼Œä¸ºç»å¤§éƒ¨åˆ†çš„å­—æ®µè®¾ç½®ä½ æƒ³æŒ‡å®šçš„ <code>default</code> é»˜è®¤åˆ†æå™¨ã€‚ç„¶ååœ¨å­—æ®µçº§åˆ«è®¾ç½®ä¸­ï¼Œå¯¹æŸä¸€ä¸¤ä¸ªå­—æ®µé…ç½®éœ€è¦æŒ‡å®šçš„åˆ†æå™¨ã€‚</p>
<p>ğŸ“’ ğŸ“’ ğŸ“’<br>å¯¹äºå’Œæ—¶é—´ç›¸å…³çš„æ—¥å¿—æ•°æ®ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯å¤©è‡ªè¡Œåˆ›å»ºç´¢å¼•ï¼Œç”±äºè¿™ç§æ–¹å¼ä¸æ˜¯ä»å¤´åˆ›å»ºçš„ç´¢å¼•ï¼Œä»ç„¶å¯ä»¥ç”¨ ç´¢å¼•æ¨¡æ¿ï¼ˆIndex Templateï¼‰ ä¸ºæ–°å»ºçš„ç´¢å¼•æŒ‡å®šé…ç½®å’Œæ˜ å°„ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_controlling_analysis.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å…¨æ–‡æœç´¢ Â» æ§åˆ¶åˆ†æ</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearch-overview</title>
    <url>/wiki/elasticsearch-overview/</url>
    <content><![CDATA[<h2 id="å­¦ä¹ èµ„æ–™"><a href="#å­¦ä¹ èµ„æ–™" class="headerlink" title="å­¦ä¹ èµ„æ–™"></a>å­¦ä¹ èµ„æ–™</h2><ul>
<li> <a href="https://doc.codingdict.com/elasticsearch/">https://www.codingdict.com/</a></li>
<li> <a href="https://elasticsearch.cn/">https://elasticsearch.cn/</a></li>
<li> <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/indexing-buffer.html">https://www.elastic.co/guide/en/</a></li>
<li> <a href="https://elastic.blog.csdn.net/">é“­æ¯…å¤©ä¸‹</a></li>
</ul>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearch æŸ¥è¯¢å€¼å‰ç¼€ä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²</title>
    <url>/wiki/elasticsearch-%E6%9F%A5%E8%AF%A2%E5%80%BC%E5%89%8D%E7%BC%80%E4%B8%8D%E5%8C%85%E5%90%AB%E6%9F%90%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
    <content><![CDATA[<blockquote>
<p>éœ€æ±‚ æŸ¥è¯¢IPä¸æ˜¯ä»¥11.å¼€å¤´çš„æ‰€æœ‰æ–‡æ¡£ï¼Œç„¶åè·å–æ–‡æ¡£è®¿é—®é‡å‰100æ¡</p>
</blockquote>
<p><code>curl -X GET &quot;localhost:9200/yj_visit_data2,yj_visit_data3/_search?pretty&quot; -u elastic:elastic -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;bool&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;should&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;ip&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;11.&quot;</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;prefix&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;ip&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;1.&quot;</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;must&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;visitTime&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;gte&quot;</span>: <span class="number">1577808000000</span>,</span><br><span class="line">              <span class="attr">&quot;lte&quot;</span>: <span class="number">1609430399000</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;term_article&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;ip&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;min_doc_count&quot;</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">&quot;size&quot;</span>: <span class="number">10000</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchåˆ†é¡µæŸ¥è¯¢</title>
    <url>/wiki/elasticsearch%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<p>å’Œ SQL ä½¿ç”¨ LIMIT å…³é”®å­—è¿”å›å•ä¸ª page ç»“æœçš„æ–¹æ³•ç›¸åŒï¼ŒElasticsearch æ¥å— from å’Œ size å‚æ•°ï¼š</p>
<p><code>size</code><br>æ˜¾ç¤ºåº”è¯¥è¿”å›çš„ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 10<br><code>from</code><br>æ˜¾ç¤ºåº”è¯¥è·³è¿‡çš„åˆå§‹ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 0<br>å¦‚æœæ¯é¡µå±•ç¤º 5 æ¡ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢æ–¹å¼è¯·æ±‚å¾—åˆ° 1 åˆ° 3 é¡µçš„ç»“æœï¼š</p>
<p><code>GET /_search?size=5</code><br><code>GET /_search?size=5&amp;from=5</code><br><code>GET /_search?size=5&amp;from=10</code>  </p>
<p>âš ï¸ âš ï¸ âš ï¸<br>è€ƒè™‘åˆ°åˆ†é¡µè¿‡æ·±ä»¥åŠä¸€æ¬¡è¯·æ±‚å¤ªå¤šç»“æœçš„æƒ…å†µï¼Œç»“æœé›†åœ¨è¿”å›ä¹‹å‰å…ˆè¿›è¡Œæ’åºã€‚ ä½†è¯·è®°ä½ä¸€ä¸ªè¯·æ±‚ç»å¸¸è·¨è¶Šå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½äº§ç”Ÿè‡ªå·±çš„æ’åºç»“æœï¼Œè¿™äº›ç»“æœéœ€è¦è¿›è¡Œé›†ä¸­æ’åºä»¥ä¿è¯æ•´ä½“é¡ºåºæ˜¯æ­£ç¡®çš„ã€‚  </p>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ·±åº¦åˆ†é¡µ</p>
<blockquote>
<p>ç†è§£ä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µæ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨ä¸€ä¸ªæœ‰ 5 ä¸ªä¸»åˆ†ç‰‡çš„ç´¢å¼•ä¸­æœç´¢ã€‚ å½“æˆ‘ä»¬è¯·æ±‚ç»“æœçš„ç¬¬ä¸€é¡µï¼ˆç»“æœä» 1 åˆ° 10 ï¼‰ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡äº§ç”Ÿå‰ 10 çš„ç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™ åè°ƒèŠ‚ç‚¹ ï¼Œåè°ƒèŠ‚ç‚¹å¯¹ 50 ä¸ªç»“æœæ’åºå¾—åˆ°å…¨éƒ¨ç»“æœçš„å‰ 10 ä¸ªã€‚</p>
</blockquote>
<p>ç°åœ¨å‡è®¾æˆ‘ä»¬è¯·æ±‚ç¬¬ 1000 é¡µâ€”â€‹ç»“æœä» 10001 åˆ° 10010 ã€‚æ‰€æœ‰éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œé™¤äº†æ¯ä¸ªåˆ†ç‰‡ä¸å¾—ä¸äº§ç”Ÿå‰10010ä¸ªç»“æœä»¥å¤–ã€‚ ç„¶ååè°ƒèŠ‚ç‚¹å¯¹å…¨éƒ¨ 50050 ä¸ªç»“æœæ’åºæœ€åä¸¢å¼ƒæ‰è¿™äº›ç»“æœä¸­çš„ 50040 ä¸ªç»“æœã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯¹ç»“æœæ’åºçš„æˆæœ¬éšåˆ†é¡µçš„æ·±åº¦æˆæŒ‡æ•°ä¸Šå‡ã€‚è¿™å°±æ˜¯ web æœç´¢å¼•æ“å¯¹ä»»ä½•æŸ¥è¯¢éƒ½ä¸è¦è¿”å›è¶…è¿‡ 1000 ä¸ªç»“æœçš„åŸå› </p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/pagination.html">elasticsearchæƒå¨æŒ‡å—</a>  </li>
<li><a href="https://blog.csdn.net/laoyang360/article/details/116472697?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162549431316780269873046%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=162549431316780269873046&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-2-116472697.pc_v2_rank_blog_default&utm_term=%E5%88%86%E9%A1%B5&spm=1018.2226.3001.4450">å¹²è´§ | å…¨æ–¹ä½æ·±åº¦è§£è¯» Elasticsearch åˆ†é¡µæŸ¥è¯¢</a>  </li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/paginate-search-results.html">Paginate search results</a></li>
</ul>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchåŸºç¡€api</title>
    <url>/wiki/elasticsearch%E5%9F%BA%E7%A1%80cat_api/</url>
    <content><![CDATA[<h2 id="cat-API"><a href="#cat-API" class="headerlink" title="cat API"></a>cat API</h2><h3 id="é›†ç¾¤å¥åº·çŠ¶æ€"><a href="#é›†ç¾¤å¥åº·çŠ¶æ€" class="headerlink" title="é›†ç¾¤å¥åº·çŠ¶æ€"></a>é›†ç¾¤å¥åº·çŠ¶æ€</h3><p>GET _cat/health?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">epoch      timestamp cluster        status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1625489855 12:57:35  my-application yellow          1         1     35  35    0    0       23             0                  -                 60.3%</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨restæ¥å£ï¼š<br>curl -XGET â€˜localhost:9200/_cat/health?v&amp;prettyâ€™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1475247709 17:01:49  elasticsearch green           1         1      0   0    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åä¸º my-application çš„é›†ç¾¤ä¸ yellow çš„ statusã€‚</p>
<p>æ— è®ºä½•æ—¶æˆ‘ä»¬è¯·æ±‚é›†ç¾¤å¥åº·ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— greenï¼Œyellowï¼Œæˆ–è€… red çš„ statusã€‚Green è¡¨ç¤ºä¸€åˆ‡æ­£å¸¸ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œ yellow è¡¨ç¤ºæ‰€æœ‰æ•°æ®å¯ç”¨ï¼Œä½†æ˜¯æœ‰äº›å‰¯æœ¬å°šæœªåˆ†é…ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œred æ„å‘³ç€ç”±äºæŸäº›åŸå› æœ‰äº›æ•°æ®ä¸å¯ç”¨ã€‚æ³¨æ„ï¼Œé›†ç¾¤æ˜¯ redï¼Œå®ƒä»ç„¶å…·æœ‰éƒ¨åˆ†åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå®ƒå°†ç»§ç»­ä»å¯ç”¨çš„åˆ†ç‰‡ä¸­æœåŠ¡æœç´¢è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯æ‚¨å¯èƒ½éœ€è¦å°½å¿«å»ä¿®å¤å®ƒï¼Œå› ä¸ºæ‚¨å·²ç»ä¸¢å¤±æ•°æ®äº†ã€‚  </p>
<p>å¦å¤–ï¼Œä»ä¸Šé¢çš„å“åº”ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…±è®¡ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰å’Œ 0 ä¸ª shardï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ”¾å…¥æ•°æ®çš„ã€‚æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é›†ç¾¤åç§°ï¼ˆelasticsearchï¼‰ï¼Œå¹¶ä¸” Elasticsearch é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ unicast networkï¼ˆå•æ’­ç½‘ç»œï¼‰æ¥å‘ç°åŒä¸€æœºå™¨ä¸Šçš„å…¶å®ƒèŠ‚ç‚¹ã€‚æœ‰å¯èƒ½æ‚¨ä¸å°å¿ƒåœ¨æ‚¨çš„ç”µè„‘ä¸Šå¯åŠ¨äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œç„¶åå®ƒä»¬å…¨éƒ¨åŠ å…¥åˆ°äº†å•ä¸ªé›†ç¾¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨ä¸Šé¢çš„å“åº”ä¸­çœ‹åˆ°ä¸æ­¢ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰ã€‚</p>
<h3 id="æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒ"><a href="#æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒ" class="headerlink" title="æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒ"></a>æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒ</h3><p>GET _cat/nodes?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip         heap.percent ram.percent cpu load_1m load_5m load_15m node.role  master name</span><br><span class="line">172.19.0.1           20          61  15    0.02    0.04     0.29 cdhilmrstw *      redtom-es-1</span><br></pre></td></tr></table></figure>


<h3 id="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•"><a href="#æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•"></a>æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•</h3><p>GET _cat/indices?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">health status index                             uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">yellow open   rd-logstash-2021.06.19            p5iej71MQVW12s2awNv8nw   1   1      61236            0     16.3mb         16.3mb</span><br><span class="line">yellow open   demo_index                        k6VTs7tdS0ysot-rPwxG9A   1   1          1            0      5.5kb          5.5kb</span><br><span class="line">green  open   kibana_sample_data_flights        A7c5DViGSISii8FA0dNlGw   1   0      13059            0      5.6mb          5.6mb</span><br></pre></td></tr></table></figure>


<h3 id="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡"><a href="#æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡"></a>æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡</h3><p>GET _cat/count?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">epoch      timestamp count</span><br><span class="line">1625490245 13:04:05  838913</span><br></pre></td></tr></table></figure>


<h3 id="ç£ç›˜åˆ†é…æƒ…å†µ"><a href="#ç£ç›˜åˆ†é…æƒ…å†µ" class="headerlink" title="ç£ç›˜åˆ†é…æƒ…å†µ"></a>ç£ç›˜åˆ†é…æƒ…å†µ</h3><p>GET _cat/allocation?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shards disk.indices disk.used disk.avail disk.total disk.percent host       ip         node</span><br><span class="line">    35      308.7mb    20.1gb    215.9gb    236.1gb            8 172.19.0.1 172.19.0.1 redtom-es-1</span><br><span class="line">    23                                                                                 UNASSIGNED</span><br></pre></td></tr></table></figure>


<h3 id="æŸ¥çœ‹shardæƒ…å†µ"><a href="#æŸ¥çœ‹shardæƒ…å†µ" class="headerlink" title="æŸ¥çœ‹shardæƒ…å†µ"></a>æŸ¥çœ‹shardæƒ…å†µ</h3><p>GET _cat/shards?v&amp;pretty</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">index                             shard prirep state        docs   store ip         node</span><br><span class="line">yj_visit_data                     0     p      STARTED         0    208b 172.19.0.1 redtom-es-1</span><br><span class="line">yj_visit_data                     0     r      UNASSIGNED                           </span><br><span class="line">demo_index                        0     p      STARTED         1   5.5kb 172.19.0.1 redtom-es-1</span><br><span class="line">demo_index                        0     r      UNASSIGNED                           </span><br><span class="line">rbtags                            0     p      STARTED         0    208b 172.19.0.1 redtom-es-1</span><br><span class="line">.kibana_1                         0     p      STARTED       280  11.5mb 172.19.0.1 redtom-es-1</span><br><span class="line">.kibana_task_manager_1            0     p      STARTED         5   5.8mb 172.19.0.1 redtom-es-1</span><br></pre></td></tr></table></figure>
<p>yj_visit_data è®¾ç½®äº†ä¸€ä¸ªå‰¯æœ¬åˆ†åŒºï¼Œä½†æ˜¯æ²¡æœ‰å‰¯èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤ºæœªåˆ†é…ï¼›</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/cat.html">Elastic å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://doc.codingdict.com/elasticsearch/4/">codingdict.com</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchå­—ç¬¦ä¸²æŸ¥è¯¢æ±‡æ€»</title>
    <url>/wiki/elasticsearch%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E8%AF%A2%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<blockquote>
<p>filter<br>exists<br>fuzzy<br>ids<br>prefix<br>regexp<br>term<br>terms<br>terms_set<br>wildcard<br>textæœç´¢ interval<br>match<br>match_bool_prefix<br>match_phrase<br>match_phrase_prefix<br>multi_match<br>common<br>query_string<br>simple_query_string</p>
</blockquote>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/weixin_35143514/article/details/112607839">æŸ¥è¯¢æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²_åä¹ç§Elasticsearchå­—ç¬¦ä¸²æœç´¢æ–¹å¼ç»ˆæä»‹ç»</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchæ“ä½œç´¢å¼•</title>
    <url>/wiki/elasticsearch%E6%93%8D%E4%BD%9C%E7%B4%A2%E5%BC%95/</url>
    <content><![CDATA[<h2 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PUT customer</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">         &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;email&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;order_id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;order_serial&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;order_time&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;date&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;customer_order&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;join&quot;,</span><br><span class="line">          &quot;relations&quot;:&#123;</span><br><span class="line">            &quot;customer&quot;:&quot;order&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹ç´¢å¼•çš„mapping"><a href="#æŸ¥çœ‹ç´¢å¼•çš„mapping" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„mapping"></a>æŸ¥çœ‹ç´¢å¼•çš„mapping</h2><p><code>GET yj_visit_data/_mapping</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;yj_visit_data&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;_class&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;article&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥è¯¢æ‰€æœ‰"><a href="#æŸ¥è¯¢æ‰€æœ‰" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰"></a>æŸ¥è¯¢æ‰€æœ‰</h2><p><code>GET yj_visit_data/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="åˆ é™¤æ‰€æœ‰"><a href="#åˆ é™¤æ‰€æœ‰" class="headerlink" title="åˆ é™¤æ‰€æœ‰"></a>åˆ é™¤æ‰€æœ‰</h2><p><code>POST yj_visit_data/_delete_by_query</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123; </span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="é€šè¿‡æ–‡ç« åˆ é™¤"><a href="#é€šè¿‡æ–‡ç« åˆ é™¤" class="headerlink" title="é€šè¿‡æ–‡ç« åˆ é™¤"></a>é€šè¿‡æ–‡ç« åˆ é™¤</h2><p><code>POST yj_visit_data/_delete_by_query</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;article.keyword&quot;</span>: <span class="string">&quot;2019/01/3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ ¹æ®æ–‡ç« æŸ¥è¯¢"><a href="#æ ¹æ®æ–‡ç« æŸ¥è¯¢" class="headerlink" title="æ ¹æ®æ–‡ç« æŸ¥è¯¢"></a>æ ¹æ®æ–‡ç« æŸ¥è¯¢</h2><p><code>GET yj_visit_data/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;article.keyword&quot;</span>: <span class="string">&quot;2019/01/3&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="ä¿®æ”¹ç´¢å¼•"><a href="#ä¿®æ”¹ç´¢å¼•" class="headerlink" title="ä¿®æ”¹ç´¢å¼•"></a>ä¿®æ”¹ç´¢å¼•</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">POST customer/_doc/<span class="number">1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;2&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchæ˜ å°„</title>
    <url>/wiki/elasticsearch%E6%98%A0%E5%B0%84/</url>
    <content><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>Elasticsearch æ”¯æŒå¦‚ä¸‹ç®€å•åŸŸç±»å‹ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²: string ï¼ˆes7ä¹‹åç¼–ç¨‹textï¼‰</li>
<li>æ•´æ•° : byte, short, integer, long</li>
<li>æµ®ç‚¹æ•°: float, double</li>
<li>å¸ƒå°”å‹: boolean</li>
<li>æ—¥æœŸ: date</li>
</ul>
<h2 id="æŸ¥çœ‹ç´¢å¼•çš„mapping"><a href="#æŸ¥çœ‹ç´¢å¼•çš„mapping" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•çš„mapping"></a>æŸ¥çœ‹ç´¢å¼•çš„mapping</h2><p><code>GET /gb/_mapping/tweet</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;gb&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;tweet&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">               <span class="attr">&quot;date&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span>,</span><br><span class="line">                  <span class="attr">&quot;format&quot;</span>: <span class="string">&quot;strict_date_optional_time||epoch_millis&quot;</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">&quot;tweet&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">&quot;user_id&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="è‡ªå®šä¹‰åŸŸæ˜ å°„"><a href="#è‡ªå®šä¹‰åŸŸæ˜ å°„" class="headerlink" title="è‡ªå®šä¹‰åŸŸæ˜ å°„"></a>è‡ªå®šä¹‰åŸŸæ˜ å°„</h2><p>å°½ç®¡åœ¨å¾ˆå¤šæƒ…å†µä¸‹åŸºæœ¬åŸŸæ•°æ®ç±»å‹å·²ç»å¤Ÿç”¨ï¼Œä½†ä½ ç»å¸¸éœ€è¦ä¸ºå•ç‹¬åŸŸè‡ªå®šä¹‰æ˜ å°„ï¼Œç‰¹åˆ«æ˜¯å­—ç¬¦ä¸²åŸŸã€‚è‡ªå®šä¹‰æ˜ å°„å…è®¸ä½ æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š</p>
<ul>
<li>å…¨æ–‡å­—ç¬¦ä¸²åŸŸå’Œç²¾ç¡®å€¼å­—ç¬¦ä¸²åŸŸçš„åŒºåˆ«</li>
<li>ä½¿ç”¨ç‰¹å®šè¯­è¨€åˆ†æå™¨</li>
<li>ä¼˜åŒ–åŸŸä»¥é€‚åº”éƒ¨åˆ†åŒ¹é…</li>
<li>æŒ‡å®šè‡ªå®šä¹‰æ•°æ®æ ¼å¼</li>
<li>è¿˜æœ‰æ›´å¤š</li>
</ul>
<p>åŸŸæœ€é‡è¦çš„å±æ€§æ˜¯ <code>type</code> ã€‚å¯¹äºä¸æ˜¯ string çš„åŸŸï¼Œä½ ä¸€èˆ¬åªéœ€è¦è®¾ç½® type ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;number_of_clicks&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤ï¼Œ <code>string</code> (text) ç±»å‹åŸŸä¼šè¢«è®¤ä¸ºåŒ…å«å…¨æ–‡ã€‚å°±æ˜¯è¯´ï¼Œå®ƒä»¬çš„å€¼åœ¨ç´¢å¼•å‰ï¼Œä¼šé€šè¿‡ä¸€ä¸ªåˆ†æå™¨ï¼Œé’ˆå¯¹äºè¿™ä¸ªåŸŸçš„æŸ¥è¯¢åœ¨æœç´¢å‰ä¹Ÿä¼šç»è¿‡ä¸€ä¸ªåˆ†æå™¨ã€‚</p>
<p>string åŸŸæ˜ å°„çš„ä¸¤ä¸ªæœ€é‡è¦å±æ€§æ˜¯ <code>index</code> å’Œ <code>analyzer</code> ã€‚</p>
<h3 id="index"><a href="#index" class="headerlink" title="index"></a>index</h3><p>index å±æ€§æ§åˆ¶æ€æ ·ç´¢å¼•å­—ç¬¦ä¸²ã€‚å®ƒå¯ä»¥æ˜¯ä¸‹é¢ä¸‰ä¸ªå€¼ï¼š</p>
<h4 id="analyzed"><a href="#analyzed" class="headerlink" title="analyzed"></a>analyzed</h4><p>é¦–å…ˆåˆ†æå­—ç¬¦ä¸²ï¼Œç„¶åç´¢å¼•å®ƒã€‚æ¢å¥è¯è¯´ï¼Œä»¥å…¨æ–‡ç´¢å¼•è¿™ä¸ªåŸŸã€‚</p>
<h4 id="not-analyzed"><a href="#not-analyzed" class="headerlink" title="not_analyzed"></a>not_analyzed</h4><p>  ç´¢å¼•è¿™ä¸ªåŸŸï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¢«æœç´¢ï¼Œä½†ç´¢å¼•çš„æ˜¯ç²¾ç¡®å€¼ã€‚ä¸ä¼šå¯¹å®ƒè¿›è¡Œåˆ†æã€‚</p>
<h4 id="no"><a href="#no" class="headerlink" title="no"></a>no</h4><p>ä¸ç´¢å¼•è¿™ä¸ªåŸŸã€‚è¿™ä¸ªåŸŸä¸ä¼šè¢«æœç´¢åˆ°ã€‚ (æ¯”å¦‚ä¸€äº›éšç§ä¿¡æ¯)</p>
<p>string åŸŸ index å±æ€§é»˜è®¤æ˜¯ <code>analyzed</code> ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜ å°„è¿™ä¸ªå­—æ®µä¸ºä¸€ä¸ªç²¾ç¡®å€¼ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å®ƒä¸º not_analyzed ï¼š</p>
<p>âš ï¸ âš ï¸<br>å…¶ä»–ç®€å•ç±»å‹ï¼ˆä¾‹å¦‚ long ï¼Œ double ï¼Œ date ç­‰ï¼‰ä¹Ÿæ¥å— index å‚æ•°ï¼Œä½†æœ‰æ„ä¹‰çš„å€¼åªæœ‰ no å’Œ not_analyzed ï¼Œ å› ä¸ºå®ƒä»¬æ°¸è¿œä¸ä¼šè¢«åˆ†æã€‚  </p>
<h3 id="analyzer"><a href="#analyzer" class="headerlink" title="analyzer"></a>analyzer</h3><p>å¯¹äº <code>analyzed</code> å­—ç¬¦ä¸²åŸŸï¼Œç”¨ <code>analyzer</code> å±æ€§æŒ‡å®šåœ¨æœç´¢å’Œç´¢å¼•æ—¶ä½¿ç”¨çš„åˆ†æå™¨ã€‚é»˜è®¤ï¼Œ Elasticsearch ä½¿ç”¨ <code>standard</code> åˆ†æå™¨ï¼Œ ä½†ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå†…ç½®çš„åˆ†æå™¨æ›¿ä»£å®ƒï¼Œä¾‹å¦‚ <code>whitespace</code> ã€ <code>simple</code> å’Œ <code>english</code>;</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;tweet&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ–°æ˜ å°„"><a href="#æ›´æ–°æ˜ å°„" class="headerlink" title="æ›´æ–°æ˜ å°„"></a>æ›´æ–°æ˜ å°„</h2><p>å½“ä½ é¦–æ¬¡åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç±»å‹çš„æ˜ å°„ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ /_mapping ä¸ºæ–°ç±»å‹ï¼ˆæˆ–è€…ä¸ºå­˜åœ¨çš„ç±»å‹æ›´æ–°æ˜ å°„ï¼‰å¢åŠ æ˜ å°„ã€‚<br>âš ï¸ âš ï¸<br>å°½ç®¡ä½ å¯ä»¥ å¢åŠ  ä¸€ä¸ªå­˜åœ¨çš„æ˜ å°„ï¼Œä½ ä¸èƒ½ ä¿®æ”¹ å­˜åœ¨çš„åŸŸæ˜ å°„ã€‚å¦‚æœä¸€ä¸ªåŸŸçš„æ˜ å°„å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥åŸŸçš„æ•°æ®å¯èƒ½å·²ç»è¢«ç´¢å¼•ã€‚å¦‚æœä½ æ„å›¾ä¿®æ”¹è¿™ä¸ªåŸŸçš„æ˜ å°„ï¼Œç´¢å¼•çš„æ•°æ®å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸èƒ½è¢«æ­£å¸¸çš„æœç´¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ›´æ–°ä¸€ä¸ªæ˜ å°„æ¥æ·»åŠ ä¸€ä¸ªæ–°åŸŸï¼Œä½†ä¸èƒ½å°†ä¸€ä¸ªå­˜åœ¨çš„åŸŸä» analyzed æ”¹ä¸º not_analyzed ã€‚</p>
<p>ä¸ºäº†æè¿°æŒ‡å®šæ˜ å°„çš„ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ gd ç´¢å¼•ï¼š<br><code>DELETE /gb</code><br>ç„¶ååˆ›å»ºä¸€ä¸ªæ–°ç´¢å¼•ï¼ŒæŒ‡å®š tweet åŸŸä½¿ç”¨ english åˆ†æå™¨ï¼š  </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /gb </span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;tweet&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;tweet&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :    <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;date&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :   <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :   <span class="string">&quot;string&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;user_id&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> :   <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¨åï¼Œæˆ‘ä»¬å†³å®šåœ¨ tweet æ˜ å°„å¢åŠ ä¸€ä¸ªæ–°çš„åä¸º tag çš„ not_analyzed çš„æ–‡æœ¬åŸŸï¼Œä½¿ç”¨ _mapping ï¼š  </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /gb/_mapping/tweet</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;tag&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> :    <span class="string">&quot;string&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>:    <span class="string">&quot;not_analyzed&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†æ¬¡åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„åŸŸï¼Œå› ä¸ºæ— è®ºå¦‚ä½•æˆ‘ä»¬éƒ½æ— æ³•æ”¹å˜å®ƒä»¬ã€‚æ–°åŸŸå·²ç»è¢«åˆå¹¶åˆ°å­˜åœ¨çš„æ˜ å°„ä¸­</p>
<h2 id="æµ‹è¯•æ˜ å°„"><a href="#æµ‹è¯•æ˜ å°„" class="headerlink" title="æµ‹è¯•æ˜ å°„"></a>æµ‹è¯•æ˜ å°„</h2><p>ä½ å¯ä»¥ä½¿ç”¨ analyze API æµ‹è¯•å­—ç¬¦ä¸²åŸŸçš„æ˜ å°„ã€‚æ¯”è¾ƒä¸‹é¢ä¸¤ä¸ªè¯·æ±‚çš„è¾“å‡ºï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /gb/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field&quot;: &quot;tweet&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Black-cats&quot; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /gb/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;field&quot;: &quot;tag&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Black-cats&quot; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>tweet åŸŸäº§ç”Ÿä¸¤ä¸ªè¯æ¡ black å’Œ cat ï¼Œ tag åŸŸäº§ç”Ÿå•ç‹¬çš„è¯æ¡ Black-cats ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„æ˜ å°„æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/mapping-intro.html">Elasticsearchæƒå¨æŒ‡å—</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchç¨³å®šæ€§è°ƒä¼˜</title>
    <url>/wiki/elasticsearch%E7%A8%B3%E5%AE%9A%E6%80%A7%E8%B0%83%E4%BC%98/</url>
    <content><![CDATA[<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/43437056">Elasticsearchæ€§èƒ½ä¼˜åŒ–æ€»ç»“</a><br><a href="https://cloud.tencent.com/developer/article/1158408">Elasticsearchè°ƒä¼˜å®è·µ</a></p>
</blockquote>
<h2 id="ç¨³å®šæ€§è°ƒä¼˜"><a href="#ç¨³å®šæ€§è°ƒä¼˜" class="headerlink" title="ç¨³å®šæ€§è°ƒä¼˜"></a>ç¨³å®šæ€§è°ƒä¼˜</h2><p>ä¸€ Linuxå‚æ•°è°ƒä¼˜</p>
<p>ä¿®æ”¹ç³»ç»Ÿèµ„æºé™åˆ¶ ğŸ‘‡<br>å•ç”¨æˆ·å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºå®˜æ–¹æ¨èçš„65536æˆ–æ›´å¤§äº› <code>echo &quot;* - nofile 655360&quot; &gt;&gt;/etc/security/limits.conf</code><br>å•ç”¨æˆ·å†…å­˜åœ°å€ç©ºé—´ <code>echo &quot;* - as unlimited&quot; &gt;&gt;/etc/security/limits.conf</code><br>å•ç”¨æˆ·çº¿ç¨‹æ•° <code>echo &quot;* - nproc 2056474&quot; &gt;&gt;/etc/security/limits.conf</code><br>å•ç”¨æˆ·æ–‡ä»¶å¤§å° <code>echo &quot;* - fsize unlimited&quot; &gt;&gt;/etc/security/limits.conf</code><br>å•ç”¨æˆ·é”å®šå†…å­˜ <code>echo &quot;* - memlock unlimited&quot; &gt;&gt;/etc/security/limits.conf</code><br>å•è¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„æœ€å¤§mapå†…å­˜åŒºåŸŸæ•°é‡ <code>echo &quot;vm.max_map_count = 655300&quot; &gt;&gt;/etc/sysctl.conf</code><br>TCPå…¨è¿æ¥é˜Ÿåˆ—å‚æ•°è®¾ç½®ï¼Œ è¿™æ ·è®¾ç½®çš„ç›®çš„æ˜¯é˜²æ­¢èŠ‚ç‚¹æ•°è¾ƒå¤šï¼ˆæ¯”å¦‚è¶…è¿‡100ï¼‰çš„ESé›†ç¾¤ä¸­ï¼ŒèŠ‚ç‚¹å¼‚å¸¸é‡å¯æ—¶å…¨è¿æ¥é˜Ÿåˆ—åœ¨å¯åŠ¨ç¬é—´æ‰“æ»¡ï¼Œé€ æˆèŠ‚ç‚¹hangä½ï¼Œæ•´ä¸ªé›†ç¾¤å“åº”è¿Ÿæ»çš„æƒ…å†µ<br><code>echo &quot;net.ipv4.tcp_abort_on_overflow = 1&quot; &gt;&gt;/etc/sysctl.conf </code><br><code>echo &quot;net.core.somaxconn = 2048&quot; &gt;&gt;/etc/sysctl.conf</code><br>é™ä½tcp alive timeï¼Œé˜²æ­¢æ— æ•ˆé“¾æ¥å ç”¨é“¾æ¥æ•° <code>echo 300 &gt;/proc/sys/net/ipv4/tcp_keepalive_time</code></p>
<h2 id="ESèŠ‚ç‚¹é…ç½®"><a href="#ESèŠ‚ç‚¹é…ç½®" class="headerlink" title="ESèŠ‚ç‚¹é…ç½®"></a>ESèŠ‚ç‚¹é…ç½®</h2><h3 id="jvm-options"><a href="#jvm-options" class="headerlink" title="jvm.options"></a>jvm.options</h3><p>-Xmså’Œ-Xmxè®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œ<code>æ¨èè®¾ç½®ä¸ºæœºå™¨å†…å­˜çš„ä¸€åŠå·¦å³ï¼Œå‰©ä½™ä¸€åŠç•™ç»™ç³»ç»Ÿcacheä½¿ç”¨</code>ã€‚</p>
<p>jvmå†…å­˜å»ºè®®ä¸è¦ä½äº2Gï¼Œå¦åˆ™æœ‰å¯èƒ½å› ä¸ºå†…å­˜ä¸è¶³å¯¼è‡´ESæ— æ³•æ­£å¸¸å¯åŠ¨æˆ–OOM<br>jvmå»ºè®®ä¸è¦è¶…è¿‡32Gï¼Œå¦åˆ™<code>jvmä¼šç¦ç”¨å†…å­˜å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯</code>ï¼Œé€ æˆå†…å­˜æµªè´¹</p>
<h3 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a>elasticsearch.yml</h3><p>è®¾ç½®å†…å­˜ç†”æ–­å‚æ•°ï¼Œé˜²æ­¢å†™å…¥æˆ–æŸ¥è¯¢å‹åŠ›è¿‡é«˜å¯¼è‡´OOMï¼Œå…·ä½“æ•°å€¼å¯æ ¹æ®ä½¿ç”¨åœºæ™¯è°ƒæ•´ã€‚<br><code>indices.breaker.total.limit: 30% </code><br><code>indices.breaker.request.limit: 6% </code><br><code>indices.breaker.fielddata.limit: 3%</code></p>
<p>è°ƒå°æŸ¥è¯¢ä½¿ç”¨çš„cacheï¼Œé¿å…cacheå ç”¨è¿‡å¤šçš„jvmå†…å­˜ï¼Œå…·ä½“æ•°å€¼å¯æ ¹æ®ä½¿ç”¨åœºæ™¯è°ƒæ•´ã€‚<br><code>indices.queries.cache.count: 500 </code><br><code>indices.queries.cache.size: 5%</code></p>
<p>å•æœºå¤šèŠ‚ç‚¹æ—¶ï¼Œä¸»ä»shardåˆ†é…ä»¥ipä¸ºä¾æ®ï¼Œåˆ†é…åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œé¿å…å•æœºæŒ‚æ‰å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚<br><code>cluster.routing.allocation.awareness.attributes: ip </code><br><code>node.attr.ip: 1.1.1.1</code></p>
<h2 id="ESä½¿ç”¨æ–¹å¼"><a href="#ESä½¿ç”¨æ–¹å¼" class="headerlink" title="ESä½¿ç”¨æ–¹å¼"></a>ESä½¿ç”¨æ–¹å¼</h2><h3 id="èŠ‚ç‚¹æ•°è¾ƒå¤šçš„é›†ç¾¤ï¼Œå¢åŠ ä¸“æœ‰masterï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§"><a href="#èŠ‚ç‚¹æ•°è¾ƒå¤šçš„é›†ç¾¤ï¼Œå¢åŠ ä¸“æœ‰masterï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§" class="headerlink" title="èŠ‚ç‚¹æ•°è¾ƒå¤šçš„é›†ç¾¤ï¼Œå¢åŠ ä¸“æœ‰masterï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§"></a>èŠ‚ç‚¹æ•°è¾ƒå¤šçš„é›†ç¾¤ï¼Œå¢åŠ ä¸“æœ‰masterï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§</h3><p>ESé›†ç¾¤çš„å…ƒä¿¡æ¯ç®¡ç†ã€indexçš„å¢åˆ æ“ä½œã€èŠ‚ç‚¹çš„åŠ å…¥å‰”é™¤ç­‰é›†ç¾¤ç®¡ç†çš„ä»»åŠ¡éƒ½æ˜¯ç”±masterèŠ‚ç‚¹æ¥è´Ÿè´£çš„ï¼ŒmasterèŠ‚ç‚¹å®šæœŸå°†æœ€æ–°çš„é›†ç¾¤çŠ¶æ€å¹¿æ’­è‡³å„ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œmasterçš„ç¨³å®šæ€§å¯¹äºé›†ç¾¤æ•´ä½“çš„ç¨³å®šæ€§æ˜¯è‡³å…³é‡è¦çš„ã€‚å½“é›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡è¾ƒå¤§æ—¶ï¼ˆæ¯”å¦‚è¶…è¿‡30ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œé›†ç¾¤çš„ç®¡ç†å·¥ä½œä¼šå˜å¾—å¤æ‚å¾ˆå¤šã€‚æ­¤æ—¶åº”è¯¥åˆ›å»ºä¸“æœ‰masterèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹åªè´Ÿè´£é›†ç¾¤ç®¡ç†ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œä¸æ‰¿æ‹…æ•°æ®è¯»å†™å‹åŠ›ï¼›å…¶ä»–èŠ‚ç‚¹åˆ™ä»…è´Ÿè´£æ•°æ®è¯»å†™ï¼Œä¸è´Ÿè´£é›†ç¾¤ç®¡ç†çš„å·¥ä½œã€‚</p>
<p>è¿™æ ·æŠŠé›†ç¾¤ç®¡ç†å’Œæ•°æ®çš„å†™å…¥/æŸ¥è¯¢åˆ†ç¦»ï¼Œäº’ä¸å½±å“ï¼Œé˜²æ­¢å› è¯»å†™å‹åŠ›è¿‡å¤§é€ æˆé›†ç¾¤æ•´ä½“ä¸ç¨³å®šã€‚ å°†ä¸“æœ‰masterèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹çš„åˆ†ç¦»ï¼Œéœ€è¦ä¿®æ”¹ESçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ»šåŠ¨é‡å¯å„ä¸ªèŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>ä¸“æœ‰masterèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼ˆconf/elasticsearch.ymlï¼‰å¢åŠ å¦‚ä¸‹å±æ€§ï¼š<br>node.master: true<br>node.data: false<br>node.ingest: false<br>æ•°æ®èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å¢åŠ å¦‚ä¸‹å±æ€§ï¼ˆä¸ä¸Šé¢çš„å±æ€§ç›¸åï¼‰ï¼š<br>node.master: false<br>node.data: true<br>node.ingest: true </p>
</blockquote>
<h3 id="æ§åˆ¶indexã€shardæ€»æ•°é‡"><a href="#æ§åˆ¶indexã€shardæ€»æ•°é‡" class="headerlink" title="æ§åˆ¶indexã€shardæ€»æ•°é‡"></a>æ§åˆ¶indexã€shardæ€»æ•°é‡</h3><p>ä¸Šé¢æåˆ°ï¼ŒESçš„å…ƒä¿¡æ¯ç”±masterèŠ‚ç‚¹ç®¡ç†ï¼Œå®šæœŸåŒæ­¥ç»™å„ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå­˜å‚¨ä¸€ä»½ã€‚è¿™ä¸ªå…ƒä¿¡æ¯ä¸»è¦å­˜å‚¨åœ¨clusterstateä¸­ï¼Œå¦‚æ‰€æœ‰nodeå…ƒä¿¡æ¯ï¼ˆindicesã€èŠ‚ç‚¹å„ç§ç»Ÿè®¡å‚æ•°ï¼‰ã€æ‰€æœ‰index/shardçš„å…ƒä¿¡æ¯ï¼ˆmapping, location, sizeï¼‰ã€å…ƒæ•°æ®ingestç­‰ã€‚</p>
<p>ESåœ¨åˆ›å»ºæ–°åˆ†ç‰‡æ—¶ï¼Œè¦æ ¹æ®ç°æœ‰çš„åˆ†ç‰‡åˆ†å¸ƒæƒ…å†µæŒ‡å®šåˆ†ç‰‡åˆ†é…ç­–ç•¥ï¼Œä»è€Œä½¿å„ä¸ªèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡æ•°åŸºæœ¬ä¸€è‡´ï¼Œæ­¤è¿‡ç¨‹ä¸­å°±éœ€è¦æ·±å…¥éå†clusterstateã€‚å½“é›†ç¾¤ä¸­çš„index/shardè¿‡å¤šæ—¶ï¼Œclusterstateç»“æ„ä¼šå˜å¾—è¿‡äºå¤æ‚ï¼Œå¯¼è‡´éå†clusterstateæ•ˆç‡ä½ä¸‹ï¼Œé›†ç¾¤å“åº”è¿Ÿæ»ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿæ›¾ç»åœ¨ä¸€ä¸ª20ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤é‡Œï¼Œåˆ›å»ºäº†4w+ä¸ªshardï¼Œ<code>å¯¼è‡´æ–°å»ºä¸€ä¸ªindexéœ€è¦60s+æ‰èƒ½å®Œæˆ</code>ã€‚ å½“index/shardæ•°é‡è¿‡å¤šæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»ä»¥ä¸‹å‡ æ–¹é¢æ”¹è¿›ï¼š</p>
<ul>
<li>é™ä½æ•°æ®é‡è¾ƒå°çš„indexçš„shardæ•°é‡</li>
<li>æŠŠä¸€äº›æœ‰å…³è”çš„indexåˆå¹¶æˆä¸€ä¸ªindex</li>
<li>æ•°æ®æŒ‰æŸä¸ªç»´åº¦åšæ‹†åˆ†ï¼Œå†™å…¥å¤šä¸ªé›†ç¾¤</li>
</ul>
<h3 id="Segment-Memoryä¼˜åŒ–"><a href="#Segment-Memoryä¼˜åŒ–" class="headerlink" title="Segment Memoryä¼˜åŒ–"></a>Segment Memoryä¼˜åŒ–</h3><p>å‰é¢æåˆ°ï¼ŒESåº•å±‚é‡‡ç”¨Luceneåšå­˜å‚¨ï¼Œè€ŒLuceneçš„ä¸€ä¸ªindexåˆç”±è‹¥å¹²segmentç»„æˆï¼Œæ¯ä¸ªsegmentéƒ½ä¼šå»ºç«‹è‡ªå·±çš„å€’æ’ç´¢å¼•ç”¨äºæ•°æ®æŸ¥è¯¢ã€‚Luceneä¸ºäº†åŠ é€ŸæŸ¥è¯¢ï¼Œä¸ºæ¯ä¸ªsegmentçš„å€’æ’åšäº†ä¸€å±‚å‰ç¼€ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•åœ¨Lucene4.0ä»¥åé‡‡ç”¨çš„æ•°æ®ç»“æ„æ˜¯<code>FST</code> (Finite State Transducer)ã€‚LuceneåŠ è½½segmentçš„æ—¶å€™å°†å…¶å…¨é‡è£…è½½åˆ°å†…å­˜ä¸­ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚<code>è¿™éƒ¨åˆ†å†…å­˜è¢«ç§°ä¸ºSegmentMemoryï¼Œ å¸¸é©»å†…å­˜ï¼Œå ç”¨heapï¼Œæ— æ³•è¢«GC</code>ã€‚</p>
<p>å‰é¢æåˆ°ï¼Œä¸ºåˆ©ç”¨JVMçš„å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯æ¥èŠ‚çº¦å†…å­˜ï¼Œé€šå¸¸å»ºè®®JVMå†…å­˜åˆ†é…ä¸è¦è¶…è¿‡32Gã€‚å½“é›†ç¾¤çš„æ•°æ®é‡è¿‡å¤§æ—¶ï¼ŒSegmentMemoryä¼šåƒæ‰å¤§é‡çš„å †å†…å­˜ï¼Œè€ŒJVMå†…å­˜ç©ºé—´åˆæœ‰é™ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•é™ä½SegmentMemoryçš„ä½¿ç”¨é‡äº†ï¼Œå¸¸ç”¨æ–¹æ³•æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<ul>
<li>å®šæœŸåˆ é™¤ä¸ä½¿ç”¨çš„index</li>
<li>å¯¹äºä¸å¸¸è®¿é—®çš„indexï¼Œå¯ä»¥é€šè¿‡closeæ¥å£å°†å…¶å…³é—­ï¼Œç”¨åˆ°æ—¶å†æ‰“å¼€</li>
<li>é€šè¿‡force_mergeæ¥å£å¼ºåˆ¶åˆå¹¶segmentï¼Œé™ä½segmentæ•°é‡</li>
<li>åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹FSTéƒ¨åˆ†è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‡Šæ”¾é«˜è¾¾40%çš„Segment Memoryå†…å­˜ç©ºé—´ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchç»Ÿè®¡æ¯å¹´æ¯å°æ—¶è®¿é—®é‡</title>
    <url>/wiki/elasticsearch%E7%BB%9F%E8%AE%A1%E6%AF%8F%E5%B9%B4%E6%AF%8F%E5%B0%8F%E6%97%B6%E8%AE%BF%E9%97%AE%E9%87%8F/</url>
    <content><![CDATA[<blockquote>
<p>éœ€æ±‚èƒŒæ™¯ï¼Œè¦ç»Ÿè®¡æ–‡ç« åœ¨ä¸€å¹´çš„æ—¶é—´å†…ï¼Œæ¯ä¸ªå°æ—¶çš„è®¿é—®æƒ…å†µï¼ŒæŒ‰ç…§0ç‚¹ä¸¾ä¾‹å­ï¼Œæ¯ä¸ªæ–‡ç« ï¼Œä¸€å¹´å†…æ¯ä¸€å¤©0ç‚¹çš„è®¿é—®æ¬¡æ•°ç´¯åŠ èµ·æ¥ï¼›</p>
</blockquote>
<h2 id="Elasticsearchç´¢å¼•å¦‚ä¸‹"><a href="#Elasticsearchç´¢å¼•å¦‚ä¸‹" class="headerlink" title="Elasticsearchç´¢å¼•å¦‚ä¸‹"></a>Elasticsearchç´¢å¼•å¦‚ä¸‹</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;yj_visit_data&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;_class&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;article&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;c&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;ip&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;p&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;ua&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;visitTime&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="Java-RestHighLevelClientå†™æ³•"><a href="#Java-RestHighLevelClientå†™æ³•" class="headerlink" title="Java RestHighLevelClientå†™æ³•"></a>Java RestHighLevelClientå†™æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getDateDist</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest();</span><br><span class="line">        searchRequest.indices(<span class="string">&quot;yj_visit_data2&quot;</span>);</span><br><span class="line">        TermsAggregationBuilder termsAggregation = AggregationBuilders.terms(<span class="string">&quot;article&quot;</span>)</span><br><span class="line">                .field(<span class="string">&quot;article.keyword&quot;</span>).size(<span class="number">2200</span>)</span><br><span class="line">                .subAggregation(AggregationBuilders.dateHistogram(<span class="string">&quot;visitTime&quot;</span>)</span><br><span class="line">                        .field(<span class="string">&quot;visitTime&quot;</span>)</span><br><span class="line">                        .calendarInterval(DateHistogramInterval.HOUR));</span><br><span class="line"></span><br><span class="line">        SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">        sourceBuilder.aggregation(termsAggregation);</span><br><span class="line">        sourceBuilder.query(QueryBuilders.rangeQuery(<span class="string">&quot;visitTime&quot;</span>).gt(<span class="string">&quot;1609430400000&quot;</span>).lte(<span class="string">&quot;1625068799000&quot;</span>));</span><br><span class="line">        sourceBuilder.timeout(<span class="keyword">new</span> TimeValue(<span class="number">900000</span>));</span><br><span class="line">        SearchRequest request = <span class="keyword">new</span> SearchRequest();</span><br><span class="line">        request.source(sourceBuilder);</span><br><span class="line">        SearchResponse search = restHighLevelClient.search(request, RequestOptions.DEFAULT);</span><br><span class="line">        Aggregations aggregations = search.getAggregations();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;agg -&gt; &#123;&#125;&quot;</span>, aggregations.asList().size());</span><br><span class="line">        List&lt;? extends Terms.Bucket&gt; buckets = ((ParsedStringTerms) aggregations.asList().get(<span class="number">0</span>)).getBuckets();</span><br><span class="line">        List&lt;ArticleHourData&gt; hourDataList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Terms.Bucket bucket : buckets) &#123;</span><br><span class="line">            List&lt;? extends Histogram.Bucket&gt; innerBuckets = ((ParsedDateHistogram) bucket.getAggregations().asList().get(<span class="number">0</span>)).getBuckets();</span><br><span class="line">            hourDataList.add(calcBucket(innerBuckets, bucket.getKeyAsString()));</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;result ----&gt; &#123;&#125;&quot;</span>, JSONObject.toJSONString(hourDataList));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="èšåˆåˆ†æ"><a href="#èšåˆåˆ†æ" class="headerlink" title="èšåˆåˆ†æ"></a>èšåˆåˆ†æ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ArticleHourData <span class="title">calcBucket</span><span class="params">(List&lt;? extends Histogram.Bucket&gt; innerBuckets, String article)</span> </span>&#123;</span><br><span class="line">       log.info(<span class="string">&quot;innerBuckets get(0) ---&gt; &#123;&#125;&quot;</span>, JSON.toJSONString(innerBuckets.get(<span class="number">0</span>)));</span><br><span class="line">       Map&lt;String, ? extends List&lt;? extends Histogram.Bucket&gt;&gt; hourMap = innerBuckets.stream()</span><br><span class="line">               .collect(Collectors.groupingBy(bucket -&gt; getHour(bucket.getKeyAsString())));</span><br><span class="line">       log.info(<span class="string">&quot;collect  ======&gt; &#123;&#125; &quot;</span>, JSONObject.toJSONString(hourMap.keySet()));</span><br><span class="line"></span><br><span class="line">       ArticleHourData hourData = ArticleHourData.builder().article(article).build();</span><br><span class="line">       <span class="keyword">if</span> (hourMap.isEmpty()) &#123;</span><br><span class="line">           <span class="keyword">return</span> hourData;</span><br><span class="line">       &#125;</span><br><span class="line">       HashMap&lt;String, Long&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       <span class="keyword">for</span> (String hour : hourMap.keySet()) &#123;</span><br><span class="line">           List&lt;? extends Histogram.Bucket&gt; list = hourMap.get(hour);</span><br><span class="line">           <span class="keyword">if</span> (CollectionUtils.isEmpty(list)) &#123;</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           hashMap.put(hour, list.stream().mapToLong(Histogram.Bucket::getDocCount).sum());</span><br><span class="line">       &#125;</span><br><span class="line">       hourData.setCountMap(hashMap);</span><br><span class="line">       <span class="keyword">return</span> hourData;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="è·å–æ—¶é—´çš„å°æ—¶"><a href="#è·å–æ—¶é—´çš„å°æ—¶" class="headerlink" title="è·å–æ—¶é—´çš„å°æ—¶"></a>è·å–æ—¶é—´çš„å°æ—¶</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">getHour</span><span class="params">(String date)</span> </span>&#123;</span><br><span class="line">      date = date.replace(<span class="string">&quot;Z&quot;</span>, <span class="string">&quot; UTC&quot;</span>);</span><br><span class="line">      SimpleDateFormat format = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS Z&quot;</span>);</span><br><span class="line">      Date d = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          d = format.parse(date);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> String.valueOf(DateUtil.asLocalDateTime(d).getHour());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<h2 id="Pythonå†™æ³•"><a href="#Pythonå†™æ³•" class="headerlink" title="Pythonå†™æ³•"></a>Pythonå†™æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> json.decoder <span class="keyword">import</span> JSONDecoder</span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"><span class="keyword">import</span> logging,json</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">es = Elasticsearch([&#123;<span class="string">&#x27;host&#x27;</span>:<span class="string">&#x27;39.107.117.232&#x27;</span>,<span class="string">&#x27;port&#x27;</span>:<span class="number">9200</span>&#125;], http_auth=(<span class="string">&#x27;elastic&#x27;</span>, <span class="string">&#x27;elastic&#x27;</span>), timeout = <span class="number">90000</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqs = &#123;</span><br><span class="line">   <span class="string">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">   <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;art&quot;</span>: &#123;</span><br><span class="line">         <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;article.keyword&quot;</span>,</span><br><span class="line">            <span class="string">&quot;size&quot;</span>: <span class="number">5</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;art_total&quot;</span>: &#123; </span><br><span class="line">               <span class="string">&quot;value_count&quot;</span>: &#123;</span><br><span class="line">                  <span class="string">&quot;field&quot;</span>: <span class="string">&quot;article.keyword&quot;</span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;_time&quot;</span>: &#123; </span><br><span class="line">                <span class="string">&quot;date_histogram&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;field&quot;</span>: <span class="string">&quot;visitTime&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;calendar_interval&quot;</span>: <span class="string">&quot;hour&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_search_result = es.search(index=<span class="string">&quot;yj_visit_data2&quot;</span> , body=sqs)</span><br><span class="line">_result_json = json.dumps(_search_result,sort_keys=<span class="literal">True</span>, indent=<span class="number">4</span>, separators=(<span class="string">&#x27;, &#x27;</span>, <span class="string">&#x27;: &#x27;</span>), ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">aggregations = _search_result[<span class="string">&#x27;aggregations&#x27;</span>]</span><br><span class="line">art = aggregations[<span class="string">&#x27;art&#x27;</span>]</span><br><span class="line">buckets = art[<span class="string">&#x27;buckets&#x27;</span>]</span><br><span class="line"><span class="comment">#print(type(buckets)) ; print(buckets)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getHour</span>(<span class="params">time</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>)(time[<span class="number">11</span>:<span class="number">13</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æ¯ä¸ªå°æ—¶çš„ç‚¹å‡»æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">countByMonth</span>(<span class="params">dataList , hourTar</span>):</span></span><br><span class="line">    _count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> dataList:</span><br><span class="line">        timestamp = data[<span class="string">&#x27;key_as_string&#x27;</span>]</span><br><span class="line">        hour = getHour(timestamp)</span><br><span class="line">        <span class="keyword">if</span> hour == hourTar: </span><br><span class="line">            _count = (<span class="built_in">int</span>)(data[<span class="string">&#x27;doc_count&#x27;</span>]) + _count   </span><br><span class="line">    <span class="keyword">return</span> _count        </span><br><span class="line">            </span><br><span class="line">   </span><br><span class="line">final_list = []</span><br><span class="line"><span class="comment"># å¾ªç¯è®¡ç®—æ¯ä¸€ä¸ªæ–‡ç« </span></span><br><span class="line"><span class="keyword">for</span> outBucket <span class="keyword">in</span> buckets: </span><br><span class="line">   simple_result = &#123;&#125;</span><br><span class="line">   _time = outBucket[<span class="string">&#x27;_time&#x27;</span>]</span><br><span class="line">   innerBuckets = _time[<span class="string">&#x27;buckets&#x27;</span>]</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;time inner bucker size&quot;</span> , <span class="built_in">len</span>(innerBuckets))</span><br><span class="line">   simple_list = []</span><br><span class="line">   <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">24</span>):</span><br><span class="line">      simple_list.append(countByMonth(innerBuckets,num))</span><br><span class="line">   simple_result[<span class="number">0</span>] = outBucket[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">   simple_result[<span class="number">1</span>] = simple_list</span><br><span class="line">   final_list.append(simple_result)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;final result ----&gt; &quot;</span>,final_list)   </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchè¢«ç ´åçš„ç›¸ä¼¼åº¦</title>
    <url>/wiki/elasticsearch%E8%A2%AB%E7%A0%B4%E5%9D%8F%E7%9A%84%E7%9B%B8%E4%BC%BC%E5%BA%A6/</url>
    <content><![CDATA[<p>åœ¨è®¨è®ºæ›´å¤æ‚çš„ å¤šå­—æ®µæœç´¢ ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¿«é€Ÿè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåªåœ¨ä¸»åˆ†ç‰‡ä¸Š åˆ›å»ºæµ‹è¯•ç´¢å¼• ã€‚</p>
<p>ç”¨æˆ·ä¼šæ—¶ä¸æ—¶çš„æŠ±æ€¨æ— æ³•æŒ‰ç›¸å…³åº¦æ’åºå¹¶æä¾›ç®€çŸ­çš„é‡ç°æ­¥éª¤ï¼šç”¨æˆ·ç´¢å¼•äº†ä¸€äº›æ–‡æ¡£ï¼Œè¿è¡Œä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œç„¶åå‘ç°æ˜æ˜¾ä½ç›¸å…³åº¦çš„ç»“æœå‡ºç°åœ¨é«˜ç›¸å…³åº¦ç»“æœä¹‹ä¸Šã€‚</p>
<p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œå¯ä»¥è®¾æƒ³ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªä¸»åˆ†ç‰‡ä¸Šåˆ›å»ºäº†ç´¢å¼•å’Œæ€»å…± 10 ä¸ªæ–‡æ¡£ï¼Œå…¶ä¸­ 6 ä¸ªæ–‡æ¡£æœ‰å•è¯ foo ã€‚å¯èƒ½æ˜¯åˆ†ç‰‡ 1 æœ‰å…¶ä¸­ 3 ä¸ª foo æ–‡æ¡£ï¼Œè€Œåˆ†ç‰‡ 2 æœ‰å…¶ä¸­å¦å¤– 3 ä¸ªæ–‡æ¡£ï¼Œæ¢å¥è¯è¯´ï¼Œæ‰€æœ‰æ–‡æ¡£æ˜¯å‡åŒ€åˆ†å¸ƒå­˜å‚¨çš„ã€‚</p>
<p>åœ¨ ä»€ä¹ˆæ˜¯ç›¸å…³åº¦ï¼Ÿä¸­ï¼Œæˆ‘ä»¬æè¿°äº† Elasticsearch é»˜è®¤ä½¿ç”¨çš„ç›¸ä¼¼åº¦ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å«åš è¯é¢‘/é€†å‘æ–‡æ¡£é¢‘ç‡ æˆ– TF/IDF ã€‚è¯é¢‘æ˜¯è®¡ç®—æŸä¸ªè¯åœ¨å½“å‰è¢«æŸ¥è¯¢æ–‡æ¡£é‡ŒæŸä¸ªå­—æ®µä¸­å‡ºç°çš„é¢‘ç‡ï¼Œå‡ºç°çš„é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£è¶Šç›¸å…³ã€‚ é€†å‘æ–‡æ¡£é¢‘ç‡ å°† æŸä¸ªè¯åœ¨ç´¢å¼•å†…æ‰€æœ‰æ–‡æ¡£å‡ºç°çš„ç™¾åˆ†æ•° è€ƒè™‘åœ¨å†…ï¼Œå‡ºç°çš„é¢‘ç‡è¶Šé«˜ï¼Œå®ƒçš„æƒé‡å°±è¶Šä½ã€‚</p>
<p>ä½†æ˜¯ç”±äºæ€§èƒ½åŸå› ï¼Œ Elasticsearch ä¸ä¼šè®¡ç®—ç´¢å¼•å†…æ‰€æœ‰æ–‡æ¡£çš„ IDF ã€‚ç›¸åï¼Œæ¯ä¸ªåˆ†ç‰‡ä¼šæ ¹æ® è¯¥åˆ†ç‰‡ å†…çš„æ‰€æœ‰æ–‡æ¡£è®¡ç®—ä¸€ä¸ªæœ¬åœ° IDF ã€‚</p>
<p>å› ä¸ºæ–‡æ¡£æ˜¯å‡åŒ€åˆ†å¸ƒå­˜å‚¨çš„ï¼Œä¸¤ä¸ªåˆ†ç‰‡çš„ IDF æ˜¯ç›¸åŒçš„ã€‚ç›¸åï¼Œè®¾æƒ³å¦‚æœæœ‰ 5 ä¸ª foo æ–‡æ¡£å­˜äºåˆ†ç‰‡ 1 ï¼Œè€Œç¬¬ 6 ä¸ªæ–‡æ¡£å­˜äºåˆ†ç‰‡ 2 ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œ foo åœ¨ä¸€ä¸ªåˆ†ç‰‡é‡Œéå¸¸æ™®é€šï¼ˆæ‰€ä»¥ä¸é‚£ä¹ˆé‡è¦ï¼‰ï¼Œä½†æ˜¯åœ¨å¦ä¸€ä¸ªåˆ†ç‰‡é‡Œéå¸¸å‡ºç°å¾ˆå°‘ï¼ˆæ‰€ä»¥ä¼šæ˜¾å¾—æ›´é‡è¦ï¼‰ã€‚è¿™äº› IDF ä¹‹é—´çš„å·®å¼‚ä¼šå¯¼è‡´ä¸æ­£ç¡®çš„ç»“æœã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæœ¬åœ°å’Œå…¨å±€çš„ IDF çš„å·®å¼‚ä¼šéšç€ç´¢å¼•é‡Œæ–‡æ¡£æ•°çš„å¢å¤šæ¸æ¸æ¶ˆå¤±ï¼Œåœ¨çœŸå®ä¸–ç•Œçš„æ•°æ®é‡ä¸‹ï¼Œå±€éƒ¨çš„ IDF ä¼šè¢«è¿…é€Ÿå‡åŒ–ï¼Œæ‰€ä»¥ä¸Šè¿°é—®é¢˜å¹¶ä¸æ˜¯ç›¸å…³åº¦è¢«ç ´åæ‰€å¯¼è‡´çš„ï¼Œè€Œæ˜¯ç”±äºæ•°æ®å¤ªå°‘ã€‚</p>
<p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ç§æ˜¯åªåœ¨ä¸»åˆ†ç‰‡ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæ­£å¦‚ match æŸ¥è¯¢ é‡Œä»‹ç»çš„é‚£æ ·ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼Œé‚£ä¹ˆæœ¬åœ°çš„ IDF å°±æ˜¯ å…¨å±€çš„ IDFã€‚</p>
<p>ç¬¬äºŒä¸ªæ–¹å¼å°±æ˜¯åœ¨æœç´¢è¯·æ±‚åæ·»åŠ  ?search_type=dfs_query_then_fetch ï¼Œ dfs æ˜¯æŒ‡ åˆ†å¸ƒå¼é¢‘ç‡æœç´¢ï¼ˆDistributed Frequency Searchï¼‰ ï¼Œ å®ƒå‘Šè¯‰ Elasticsearch ï¼Œå…ˆåˆ†åˆ«è·å¾—æ¯ä¸ªåˆ†ç‰‡æœ¬åœ°çš„ IDF ï¼Œç„¶åæ ¹æ®ç»“æœå†è®¡ç®—æ•´ä¸ªç´¢å¼•çš„å…¨å±€ IDF ã€‚</p>
<p>ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨ dfs_query_then_fetch ã€‚å®Œå…¨æ²¡æœ‰å¿…è¦ã€‚åªè¦æœ‰è¶³å¤Ÿçš„æ•°æ®å°±èƒ½ä¿è¯è¯é¢‘æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚æ²¡æœ‰ç†ç”±ç»™æ¯ä¸ªæŸ¥è¯¢é¢å¤–åŠ ä¸Š DFS è¿™æ­¥ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/relevance-intro.html">Elasticsearch: æƒå¨æŒ‡å— Â» åŸºç¡€å…¥é—¨ Â» æ’åºä¸ç›¸å…³æ€§ Â» ä»€ä¹ˆæ˜¯ç›¸å…³æ€§?</a></li>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/relevance-is-broken.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å…¨æ–‡æœç´¢ Â» è¢«ç ´åçš„ç›¸å…³åº¦ï¼</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchè°ƒä¼˜å®è·µ</title>
    <url>/wiki/elasticsearch%E8%B0%83%E4%BC%98%E5%AE%9E%E8%B7%B5-0/</url>
    <content><![CDATA[<blockquote>
<p>ä»æ€§èƒ½å’Œç¨³å®šæ€§ä¸¤æ–¹é¢ï¼Œä»linuxå‚æ•°è°ƒä¼˜ã€ESèŠ‚ç‚¹é…ç½®å’ŒESä½¿ç”¨æ–¹å¼ä¸‰ä¸ªè§’åº¦å…¥æ‰‹ï¼Œä»‹ç»ESè°ƒä¼˜çš„åŸºæœ¬æ–¹æ¡ˆã€‚å½“ç„¶ï¼ŒESçš„è°ƒä¼˜ç»ä¸èƒ½ä¸€æ¦‚è€Œè®ºï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯åšé€‚å½“çš„å–èˆå’Œè°ƒæ•´</p>
</blockquote>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/43437056">Elasticsearchæ€§èƒ½ä¼˜åŒ–æ€»ç»“</a><br><a href="https://cloud.tencent.com/developer/article/1158408">Elasticsearchè°ƒä¼˜å®è·µ</a></p>
</blockquote>
<h2 id="Linuxä¼˜åŒ–"><a href="#Linuxä¼˜åŒ–" class="headerlink" title="Linuxä¼˜åŒ–"></a>Linuxä¼˜åŒ–</h2><h3 id="å…³é—­äº¤æ¢åˆ†åŒºï¼Œé˜²æ­¢å†…å­˜ç½®æ¢é™ä½æ€§èƒ½ã€‚"><a href="#å…³é—­äº¤æ¢åˆ†åŒºï¼Œé˜²æ­¢å†…å­˜ç½®æ¢é™ä½æ€§èƒ½ã€‚" class="headerlink" title="å…³é—­äº¤æ¢åˆ†åŒºï¼Œé˜²æ­¢å†…å­˜ç½®æ¢é™ä½æ€§èƒ½ã€‚"></a>å…³é—­äº¤æ¢åˆ†åŒºï¼Œé˜²æ­¢å†…å­˜ç½®æ¢é™ä½æ€§èƒ½ã€‚</h3><p>å°† <code>/etc/fstab</code> æ–‡ä»¶ä¸­åŒ…å«swapçš„è¡Œæ³¨é‡Šæ‰<br><code>sed -i &#39;/swap/s/^/#/&#39; /etc/fstabswapoff -a</code></p>
<h3 id="ç£ç›˜æŒ‚è½½é€‰é¡¹"><a href="#ç£ç›˜æŒ‚è½½é€‰é¡¹" class="headerlink" title="ç£ç›˜æŒ‚è½½é€‰é¡¹"></a>ç£ç›˜æŒ‚è½½é€‰é¡¹</h3><p>noatimeï¼šç¦æ­¢è®°å½•è®¿é—®æ—¶é—´æˆ³ï¼Œæé«˜æ–‡ä»¶ç³»ç»Ÿè¯»å†™æ€§èƒ½<br>data=writebackï¼š ä¸è®°å½•data journalï¼Œæé«˜æ–‡ä»¶ç³»ç»Ÿå†™å…¥æ€§èƒ½<br>barrier=0ï¼šbarrierä¿è¯journalå…ˆäºdataåˆ·åˆ°ç£ç›˜ï¼Œä¸Šé¢å…³é—­äº†journalï¼Œè¿™é‡Œçš„barrierä¹Ÿå°±æ²¡å¿…è¦å¼€å¯äº†<br>nobhï¼šå…³é—­buffer_headï¼Œé˜²æ­¢å†…æ ¸æ‰“æ–­å¤§å—æ•°æ®çš„IOæ“ä½œ<br>mount -o noatime,data=writeback,barrier=0,nobh /dev/sda /es_data</p>
<h3 id="å¯¹äºSSDç£ç›˜ï¼Œé‡‡ç”¨ç”µæ¢¯è°ƒåº¦ç®—æ³•"><a href="#å¯¹äºSSDç£ç›˜ï¼Œé‡‡ç”¨ç”µæ¢¯è°ƒåº¦ç®—æ³•" class="headerlink" title="å¯¹äºSSDç£ç›˜ï¼Œé‡‡ç”¨ç”µæ¢¯è°ƒåº¦ç®—æ³•"></a>å¯¹äºSSDç£ç›˜ï¼Œé‡‡ç”¨ç”µæ¢¯è°ƒåº¦ç®—æ³•</h3><p>å› ä¸ºSSDæä¾›äº†æ›´æ™ºèƒ½çš„è¯·æ±‚è°ƒåº¦ç®—æ³•ï¼Œä¸éœ€è¦å†…æ ¸å»åšå¤šä½™çš„è°ƒæ•´ (ä»…ä¾›å‚è€ƒ)<br><code>echo noop &gt; /sys/block/sda/queue/scheduler</code></p>
<h2 id="ESèŠ‚ç‚¹é…ç½®"><a href="#ESèŠ‚ç‚¹é…ç½®" class="headerlink" title="ESèŠ‚ç‚¹é…ç½®"></a>ESèŠ‚ç‚¹é…ç½®</h2><p>conf/elasticsearch.ymlæ–‡ä»¶ï¼š</p>
<h3 id="é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦ï¼Œæé«˜å†™å…¥æ€§èƒ½å’Œç¨³å®šæ€§"><a href="#é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦ï¼Œæé«˜å†™å…¥æ€§èƒ½å’Œç¨³å®šæ€§" class="headerlink" title="é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦ï¼Œæé«˜å†™å…¥æ€§èƒ½å’Œç¨³å®šæ€§"></a>é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦ï¼Œæé«˜å†™å…¥æ€§èƒ½å’Œç¨³å®šæ€§</h3><p><code>indices.memory.index_buffer_size: 15%</code><br><code>thread_pool.bulk.queue_size: 1024</code></p>
<h3 id="è®¡ç®—diskä½¿ç”¨é‡æ—¶ï¼Œä¸è€ƒè™‘æ­£åœ¨æ¬è¿çš„shard"><a href="#è®¡ç®—diskä½¿ç”¨é‡æ—¶ï¼Œä¸è€ƒè™‘æ­£åœ¨æ¬è¿çš„shard" class="headerlink" title="è®¡ç®—diskä½¿ç”¨é‡æ—¶ï¼Œä¸è€ƒè™‘æ­£åœ¨æ¬è¿çš„shard"></a>è®¡ç®—diskä½¿ç”¨é‡æ—¶ï¼Œä¸è€ƒè™‘æ­£åœ¨æ¬è¿çš„shard</h3><p>åœ¨è§„æ¨¡æ¯”è¾ƒå¤§çš„é›†ç¾¤ä¸­ï¼Œå¯ä»¥é˜²æ­¢æ–°å»ºshardæ—¶æ‰«ææ‰€æœ‰shardçš„å…ƒæ•°æ®ï¼Œæå‡shardåˆ†é…é€Ÿåº¦ã€‚<br><code>cluster.routing.allocation.disk.include_relocations: false</code></p>
<h2 id="ä¸‰-ESä½¿ç”¨æ–¹å¼"><a href="#ä¸‰-ESä½¿ç”¨æ–¹å¼" class="headerlink" title="ä¸‰ ESä½¿ç”¨æ–¹å¼"></a>ä¸‰ ESä½¿ç”¨æ–¹å¼</h2><h3 id="æ§åˆ¶å­—æ®µçš„å­˜å‚¨é€‰é¡¹"><a href="#æ§åˆ¶å­—æ®µçš„å­˜å‚¨é€‰é¡¹" class="headerlink" title="æ§åˆ¶å­—æ®µçš„å­˜å‚¨é€‰é¡¹"></a>æ§åˆ¶å­—æ®µçš„å­˜å‚¨é€‰é¡¹</h3><p>ESåº•å±‚ä½¿ç”¨Luceneå­˜å‚¨æ•°æ®ï¼Œä¸»è¦åŒ…æ‹¬è¡Œå­˜ï¼ˆStoreFiledï¼‰ã€åˆ—å­˜ï¼ˆDocValuesï¼‰å’Œå€’æ’ç´¢å¼•ï¼ˆInvertIndexï¼‰ä¸‰éƒ¨åˆ†ã€‚ å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæ²¡æœ‰å¿…è¦åŒæ—¶å­˜å‚¨è¿™ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°æ¥åšé€‚å½“è°ƒæ•´ï¼š</p>
<h4 id="StoreFiled"><a href="#StoreFiled" class="headerlink" title="StoreFiled"></a>StoreFiled</h4><p>è¡Œå­˜ï¼Œå…¶ä¸­å æ¯”æœ€å¤§çš„æ˜¯sourceå­—æ®µï¼Œå®ƒæ§åˆ¶docåŸå§‹æ•°æ®çš„å­˜å‚¨ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒESæŠŠdocåŸå§‹æ•°æ®çš„æ•´ä¸ªjsonç»“æ„ä½“å½“åšä¸€ä¸ªstringï¼Œå­˜å‚¨ä¸ºsourceå­—æ®µã€‚æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥é€šè¿‡sourceå­—æ®µæ‹¿åˆ°å½“åˆå†™å…¥æ—¶çš„æ•´ä¸ªjsonç»“æ„ä½“ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰å–å‡ºæ•´ä¸ªåŸå§‹jsonç»“æ„ä½“çš„éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨mappingä¸­å…³é—­sourceå­—æ®µæˆ–è€…åªåœ¨sourceä¸­å­˜å‚¨éƒ¨åˆ†å­—æ®µï¼Œæ•°æ®æŸ¥è¯¢æ—¶ä»å¯é€šè¿‡ESçš„docvaluefieldsè·å–æ‰€æœ‰å­—æ®µçš„å€¼ã€‚<br>æ³¨æ„ï¼šå…³é—­sourceåï¼Œ update, updatebyquery, reindexç­‰æ¥å£å°†æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰updateç­‰éœ€æ±‚çš„indexä¸èƒ½å…³é—­sourceã€‚</p>
<ul>
<li>å…³é—­ _source<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT my_index </span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="sourceåªå­˜å‚¨éƒ¨åˆ†å­—æ®µ"><a href="#sourceåªå­˜å‚¨éƒ¨åˆ†å­—æ®µ" class="headerlink" title="_sourceåªå­˜å‚¨éƒ¨åˆ†å­—æ®µ"></a>_sourceåªå­˜å‚¨éƒ¨åˆ†å­—æ®µ</h4><p>é€šè¿‡includesæŒ‡å®šè¦å­˜å‚¨çš„å­—æ®µæˆ–è€…é€šè¿‡excludesæ»¤é™¤ä¸éœ€è¦çš„å­—æ®µ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;_doc&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;includes&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;*.count&quot;</span>,</span><br><span class="line">          <span class="string">&quot;meta.*&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;excludes&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;meta.description&quot;</span>,</span><br><span class="line">          <span class="string">&quot;meta.other.*&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="docvalues-æ§åˆ¶åˆ—å­˜ã€‚"><a href="#docvalues-æ§åˆ¶åˆ—å­˜ã€‚" class="headerlink" title="docvalues æ§åˆ¶åˆ—å­˜ã€‚"></a>docvalues æ§åˆ¶åˆ—å­˜ã€‚</h4><p>ESä¸»è¦ä½¿ç”¨åˆ—å­˜æ¥æ”¯æŒsorting, aggregationså’ŒscriptsåŠŸèƒ½ï¼Œå¯¹äºæ²¡æœ‰ä¸Šè¿°éœ€æ±‚çš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å…³é—­docvaluesï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;session_id&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;doc_values&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ndexï¼šæ§åˆ¶å€’æ’ç´¢å¼•ã€‚"><a href="#ndexï¼šæ§åˆ¶å€’æ’ç´¢å¼•ã€‚" class="headerlink" title="ndexï¼šæ§åˆ¶å€’æ’ç´¢å¼•ã€‚"></a>ndexï¼šæ§åˆ¶å€’æ’ç´¢å¼•ã€‚</h4><p>ESé»˜è®¤å¯¹äºæ‰€æœ‰å­—æ®µéƒ½å¼€å¯äº†å€’æ’ç´¢å¼•ï¼Œç”¨äºæŸ¥è¯¢ã€‚å¯¹äºæ²¡æœ‰æŸ¥è¯¢éœ€æ±‚çš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å…³é—­å€’æ’ç´¢å¼•ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;session_id&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;index&quot;</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="allESçš„ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ"><a href="#allESçš„ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ" class="headerlink" title="allESçš„ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ"></a>allESçš„ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ</h4><ul>
<li>ESæŠŠç”¨æˆ·å†™å…¥jsonçš„æ‰€æœ‰å­—æ®µå€¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²åï¼Œåšåˆ†è¯ï¼Œç„¶åä¿å­˜å€’æ’ç´¢å¼•ï¼Œç”¨äºæ”¯æŒæ•´ä¸ªjsonçš„å…¨æ–‡æ£€ç´¢ã€‚<br>è¿™ç§éœ€æ±‚é€‚ç”¨çš„åœºæ™¯è¾ƒå°‘ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å°†allå­—æ®µå…³é—­ï¼ŒèŠ‚çº¦å­˜å‚¨æˆæœ¬å’Œcpuå¼€é”€ã€‚ï¼ˆES 6.0+ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸å†æ”¯æŒ_allå­—æ®µï¼Œä¸éœ€è¦è®¾ç½®ï¼‰<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_all&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="fieldnames"><a href="#fieldnames" class="headerlink" title="fieldnames"></a>fieldnames</h4>è¯¥å­—æ®µç”¨äºexistsæŸ¥è¯¢ï¼Œæ¥ç¡®è®¤æŸä¸ªdocé‡Œé¢æœ‰æ— ä¸€ä¸ªå­—æ®µå­˜åœ¨ã€‚è‹¥æ²¡æœ‰è¿™ç§éœ€æ±‚ï¼Œå¯ä»¥å°†å…¶å…³é—­ã€‚<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_field_names&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å¼€å¯æœ€ä½³å‹ç¼©"><a href="#å¼€å¯æœ€ä½³å‹ç¼©" class="headerlink" title="å¼€å¯æœ€ä½³å‹ç¼©"></a>å¼€å¯æœ€ä½³å‹ç¼©</h3><p>å¯¹äºæ‰“å¼€äº†ä¸Šè¿°_sourceå­—æ®µçš„indexï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŠŠluceneé€‚ç”¨çš„å‹ç¼©ç®—æ³•æ›¿æ¢æˆ DEFLATEï¼Œæé«˜æ•°æ®å‹ç¼©ç‡ã€‚<br><code>PUT /my_index/_settings&#123;    &quot;index.codec&quot;: &quot;best_compression&quot;&#125;</code></p>
<h3 id="bulkæ‰¹é‡å†™å…¥"><a href="#bulkæ‰¹é‡å†™å…¥" class="headerlink" title="bulkæ‰¹é‡å†™å…¥"></a>bulkæ‰¹é‡å†™å…¥</h3><p>å†™å…¥æ•°æ®æ—¶å°½é‡ä½¿ç”¨ä¸‹é¢çš„bulkæ¥å£æ‰¹é‡å†™å…¥ï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚æ¯ä¸ªbulkè¯·æ±‚çš„docæ•°é‡è®¾å®šåŒºé—´æ¨èä¸º1k~1wï¼Œå…·ä½“å¯æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰å–ä¸€ä¸ªé€‚å½“çš„æ•°é‡ã€‚</p>
<h3 id="è°ƒæ•´translogåŒæ­¥ç­–ç•¥"><a href="#è°ƒæ•´translogåŒæ­¥ç­–ç•¥" class="headerlink" title="è°ƒæ•´translogåŒæ­¥ç­–ç•¥"></a>è°ƒæ•´translogåŒæ­¥ç­–ç•¥</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œtranslogçš„æŒä¹…åŒ–ç­–ç•¥æ˜¯ï¼Œå¯¹äºæ¯ä¸ªå†™å…¥è¯·æ±‚éƒ½åšä¸€æ¬¡flushï¼Œåˆ·æ–°translogæ•°æ®åˆ°ç£ç›˜ä¸Šã€‚è¿™ç§é¢‘ç¹çš„ç£ç›˜IOæ“ä½œæ˜¯ä¸¥é‡å½±å“å†™å…¥æ€§èƒ½çš„ï¼Œå¦‚æœå¯ä»¥æ¥å—ä¸€å®šæ¦‚ç‡çš„æ•°æ®ä¸¢å¤±ï¼ˆè¿™ç§ç¡¬ä»¶æ•…éšœçš„æ¦‚ç‡å¾ˆå°ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è°ƒæ•´ translog æŒä¹…åŒ–ç­–ç•¥ä¸ºå¼‚æ­¥å‘¨æœŸæ€§æ‰§è¡Œï¼Œå¹¶é€‚å½“è°ƒæ•´translogçš„åˆ·ç›˜å‘¨æœŸã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;translog&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;sync_interval&quot;</span>: <span class="string">&quot;5s&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;durability&quot;</span>: <span class="string">&quot;async&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è°ƒæ•´refresh-interval"><a href="#è°ƒæ•´refresh-interval" class="headerlink" title="è°ƒæ•´refresh_interval"></a>è°ƒæ•´refresh_interval</h3><p>å†™å…¥Luceneçš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯å®æ—¶å¯æœç´¢çš„ï¼ŒESå¿…é¡»é€šè¿‡refreshçš„è¿‡ç¨‹æŠŠå†…å­˜ä¸­çš„æ•°æ®è½¬æ¢æˆLuceneçš„å®Œæ•´segmentåï¼Œæ‰å¯ä»¥è¢«æœç´¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒESæ¯ä¸€ç§’ä¼šrefreshä¸€æ¬¡ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„segmentï¼Œè¿™æ ·ä¼šå¯¼è‡´äº§ç”Ÿçš„segmentè¾ƒå¤šï¼Œä»è€Œsegment mergeè¾ƒä¸ºé¢‘ç¹ï¼Œç³»ç»Ÿå¼€é”€è¾ƒå¤§ã€‚å¦‚æœå¯¹æ•°æ®çš„å®æ—¶å¯è§æ€§è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æé«˜refreshçš„æ—¶é—´é—´éš”ï¼Œé™ä½ç³»ç»Ÿå¼€é”€ã€‚</p>
<p><code>PUT my_index&#123;  &quot;settings&quot;: &#123;    &quot;index&quot;: &#123;        &quot;refresh_interval&quot; : &quot;30s&quot;    &#125;  &#125;&#125;</code></p>
<h3 id="mergeå¹¶å‘æ§åˆ¶"><a href="#mergeå¹¶å‘æ§åˆ¶" class="headerlink" title="mergeå¹¶å‘æ§åˆ¶"></a>mergeå¹¶å‘æ§åˆ¶</h3><p>ESçš„ä¸€ä¸ªindexç”±å¤šä¸ªshardç»„æˆï¼Œè€Œä¸€ä¸ªshardå…¶å®å°±æ˜¯ä¸€ä¸ªLuceneçš„indexï¼Œå®ƒåˆç”±å¤šä¸ªsegmentç»„æˆï¼Œä¸”Luceneä¼šä¸æ–­åœ°æŠŠä¸€äº›å°çš„segmentåˆå¹¶æˆä¸€ä¸ªå¤§çš„segmentï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºmergeã€‚é»˜è®¤å€¼æ˜¯Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))ï¼Œå½“èŠ‚ç‚¹é…ç½®çš„cpuæ ¸æ•°è¾ƒé«˜æ—¶ï¼Œmergeå ç”¨çš„èµ„æºå¯èƒ½ä¼šåé«˜ï¼Œå½±å“é›†ç¾¤çš„æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è°ƒæ•´æŸä¸ªindexçš„mergeè¿‡ç¨‹çš„å¹¶å‘åº¦ï¼š</p>
<p><code>PUT /my_index/_settings&#123;    &quot;index.merge.scheduler.max_thread_count&quot;: 2&#125;</code></p>
<h3 id="å†™å…¥æ•°æ®ä¸æŒ‡å®š-idï¼Œè®©ESè‡ªåŠ¨äº§ç”Ÿ"><a href="#å†™å…¥æ•°æ®ä¸æŒ‡å®š-idï¼Œè®©ESè‡ªåŠ¨äº§ç”Ÿ" class="headerlink" title="å†™å…¥æ•°æ®ä¸æŒ‡å®š_idï¼Œè®©ESè‡ªåŠ¨äº§ç”Ÿ"></a>å†™å…¥æ•°æ®ä¸æŒ‡å®š_idï¼Œè®©ESè‡ªåŠ¨äº§ç”Ÿ</h3><p>å½“ç”¨æˆ·æ˜¾ç¤ºæŒ‡å®šidå†™å…¥æ•°æ®æ—¶ï¼ŒESä¼šå…ˆå‘èµ·æŸ¥è¯¢æ¥ç¡®å®šindexä¸­æ˜¯å¦å·²ç»æœ‰ç›¸åŒidçš„docå­˜åœ¨ï¼Œè‹¥æœ‰åˆ™å…ˆåˆ é™¤åŸæœ‰docå†å†™å…¥æ–°docã€‚è¿™æ ·æ¯æ¬¡å†™å…¥æ—¶ï¼ŒESéƒ½ä¼šè€—è´¹ä¸€å®šçš„èµ„æºåšæŸ¥è¯¢ã€‚å¦‚æœç”¨æˆ·å†™å…¥æ•°æ®æ—¶ä¸æŒ‡å®šdocï¼ŒESåˆ™é€šè¿‡å†…éƒ¨ç®—æ³•äº§ç”Ÿä¸€ä¸ªéšæœºçš„idï¼Œå¹¶ä¸”ä¿è¯idçš„å”¯ä¸€æ€§ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡å‰é¢æŸ¥è¯¢idçš„æ­¥éª¤ï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚ æ‰€ä»¥ï¼Œåœ¨ä¸éœ€è¦é€šè¿‡idå­—æ®µå»é‡ã€updateçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå†™å…¥ä¸æŒ‡å®šidå¯ä»¥æå‡å†™å…¥é€Ÿç‡ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿçš„æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼Œæ— idçš„æ•°æ®å†™å…¥æ€§èƒ½å¯èƒ½æ¯”æœ‰_idçš„é«˜å‡ºè¿‘ä¸€å€ï¼Œå®é™…æŸè€—å’Œå…·ä½“æµ‹è¯•åœºæ™¯ç›¸å…³ã€‚</p>
<h3 id="routing"><a href="#routing" class="headerlink" title="routing"></a>routing</h3><p>å¯¹äºæ•°æ®é‡è¾ƒå¤§çš„indexï¼Œä¸€èˆ¬ä¼šé…ç½®å¤šä¸ªshardæ¥åˆ†æ‘Šå‹åŠ›ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªæŸ¥è¯¢ä¼šåŒæ—¶æœç´¢æ‰€æœ‰çš„shardï¼Œç„¶åå†å°†å„ä¸ªshardçš„ç»“æœåˆå¹¶åï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚å¯¹äºé«˜å¹¶å‘çš„å°æŸ¥è¯¢åœºæ™¯ï¼Œæ¯ä¸ªåˆ†ç‰‡é€šå¸¸ä»…æŠ“å–æå°‘é‡æ•°æ®ï¼Œæ­¤æ—¶æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„è°ƒåº¦å¼€é”€è¿œå¤§äºå®é™…è¯»å–æ•°æ®çš„å¼€é”€ï¼Œä¸”æŸ¥è¯¢é€Ÿåº¦å–å†³äºæœ€æ…¢çš„ä¸€ä¸ªåˆ†ç‰‡ã€‚å¼€å¯routingåŠŸèƒ½åï¼ŒESä¼šå°†routingç›¸åŒçš„æ•°æ®å†™å…¥åˆ°åŒä¸€ä¸ªåˆ†ç‰‡ä¸­ï¼ˆä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼Œç”±index.routingpartitionsizeå‚æ•°æ§åˆ¶ï¼‰ã€‚å¦‚æœæŸ¥è¯¢æ—¶æŒ‡å®šroutingï¼Œé‚£ä¹ˆESåªä¼šæŸ¥è¯¢routingæŒ‡å‘çš„é‚£ä¸ªåˆ†ç‰‡ï¼Œå¯æ˜¾è‘—é™ä½è°ƒåº¦å¼€é”€ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚ routingçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># å†™å…¥PUT my_index/my_type/<span class="number">1</span>?routing=user1&#123;  <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;This is a document&quot;</span>&#125;</span><br><span class="line"># æŸ¥è¯¢GET my_index/_search?routing=user1,user2 &#123;  <span class="attr">&quot;query&quot;</span>: &#123;    <span class="attr">&quot;match&quot;</span>: &#123;      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;document&quot;</span>    &#125;  &#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºstringç±»å‹çš„å­—æ®µé€‰å–åˆé€‚çš„å­˜å‚¨æ–¹å¼"><a href="#ä¸ºstringç±»å‹çš„å­—æ®µé€‰å–åˆé€‚çš„å­˜å‚¨æ–¹å¼" class="headerlink" title="ä¸ºstringç±»å‹çš„å­—æ®µé€‰å–åˆé€‚çš„å­˜å‚¨æ–¹å¼"></a>ä¸ºstringç±»å‹çš„å­—æ®µé€‰å–åˆé€‚çš„å­˜å‚¨æ–¹å¼</h3><h4 id="å­˜ä¸ºtextç±»å‹çš„å­—æ®µï¼ˆstringå­—æ®µé»˜è®¤ç±»å‹ä¸ºtextï¼‰ï¼š"><a href="#å­˜ä¸ºtextç±»å‹çš„å­—æ®µï¼ˆstringå­—æ®µé»˜è®¤ç±»å‹ä¸ºtextï¼‰ï¼š" class="headerlink" title="å­˜ä¸ºtextç±»å‹çš„å­—æ®µï¼ˆstringå­—æ®µé»˜è®¤ç±»å‹ä¸ºtextï¼‰ï¼š"></a>å­˜ä¸ºtextç±»å‹çš„å­—æ®µï¼ˆstringå­—æ®µé»˜è®¤ç±»å‹ä¸ºtextï¼‰ï¼š</h4><pre><code>åšåˆ†è¯åå­˜å‚¨å€’æ’ç´¢å¼•ï¼Œæ”¯æŒå…¨æ–‡æ£€ç´¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ä¸ªå‚æ•°ä¼˜åŒ–å…¶å­˜å‚¨æ–¹å¼ï¼š
 -  normsï¼šç”¨äºåœ¨æœç´¢æ—¶è®¡ç®—è¯¥docçš„_scoreï¼ˆä»£è¡¨è¿™æ¡æ•°æ®ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦ï¼‰ï¼Œå¦‚æœä¸éœ€è¦è¯„åˆ†ï¼Œå¯ä»¥å°†å…¶å…³é—­ã€‚
 - indexoptionsï¼šæ§åˆ¶å€’æ’ç´¢å¼•ä¸­åŒ…æ‹¬å“ªäº›ä¿¡æ¯ï¼ˆdocsã€freqsã€positionsã€offsetsï¼‰ã€‚å¯¹äºä¸å¤ªæ³¨é‡score/highlightingçš„ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥è®¾ä¸º docsæ¥é™ä½å†…å­˜/ç£ç›˜èµ„æºæ¶ˆè€—ã€‚
 - fields: ç”¨äºæ·»åŠ å­å­—æ®µã€‚å¯¹äºæœ‰sortå’ŒèšåˆæŸ¥è¯¢éœ€æ±‚çš„åœºæ™¯ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªkeywordå­å­—æ®µä»¥æ”¯æŒè¿™ä¸¤ç§åŠŸèƒ½ã€‚

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">    &#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;norms&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;index_options&quot;</span>: <span class="string">&quot;docs&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;raw&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ```    </span><br><span class="line">#### å­˜ä¸ºkeywordç±»å‹çš„å­—æ®µ</span><br><span class="line">ä¸åšåˆ†è¯ï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚textåˆ†è¯æ¶ˆè€—CPUèµ„æºï¼Œå†—ä½™å­˜å‚¨keywordå­å­—æ®µå ç”¨å­˜å‚¨ç©ºé—´ã€‚å¦‚æœæ²¡æœ‰å…¨æ–‡ç´¢å¼•éœ€æ±‚ï¼Œåªæ˜¯è¦é€šè¿‡æ•´ä¸ªå­—æ®µåšæœç´¢ï¼Œå¯ä»¥è®¾ç½®è¯¥å­—æ®µçš„ç±»å‹ä¸ºkeywordï¼Œæå‡å†™å…¥é€Ÿç‡ï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚ è®¾ç½®å­—æ®µç±»å‹çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸€æ˜¯åˆ›å»ºä¸€ä¸ªå…·ä½“çš„indexæ—¶ï¼ŒæŒ‡å®šå­—æ®µçš„ç±»å‹ï¼›äºŒæ˜¯é€šè¿‡åˆ›å»ºtemplateï¼Œæ§åˆ¶æŸä¸€ç±»indexçš„å­—æ®µç±»å‹ã€‚</span><br><span class="line"></span><br><span class="line">-  é€šè¿‡mappingæŒ‡å®š tags å­—æ®µä¸ºkeywordç±»å‹</span><br><span class="line">```json</span><br><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;tags&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<ul>
<li> é€šè¿‡templateï¼ŒæŒ‡å®šmy_index*ç±»çš„indexï¼Œå…¶æ‰€æœ‰stringå­—æ®µé»˜è®¤ä¸ºkeywordç±»å‹<br>PUT _template/my_template<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;order&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;template&quot;</span>: <span class="string">&quot;my_index*&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;_default_&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="attr">&quot;strings&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;ignore_above&quot;</span>: <span class="number">256</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      ]</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;aliases&quot;</span>: &#123;</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨query-bool-filterç»„åˆå–ä»£æ™®é€šquery"><a href="#æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨query-bool-filterç»„åˆå–ä»£æ™®é€šquery" class="headerlink" title="æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨query-bool-filterç»„åˆå–ä»£æ™®é€šquery"></a>æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨query-bool-filterç»„åˆå–ä»£æ™®é€šquery</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒESé€šè¿‡ä¸€å®šçš„ç®—æ³•è®¡ç®—è¿”å›çš„æ¯æ¡æ•°æ®ä¸æŸ¥è¯¢è¯­å¥çš„ç›¸å…³åº¦ï¼Œå¹¶é€šè¿‡scoreå­—æ®µæ¥è¡¨å¾ã€‚ä½†å¯¹äºéå…¨æ–‡ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·å¹¶ä¸careæŸ¥è¯¢ç»“æœä¸æŸ¥è¯¢æ¡ä»¶çš„ç›¸å…³åº¦ï¼Œåªæ˜¯æƒ³ç²¾ç¡®çš„æŸ¥æ‰¾ç›®æ ‡æ•°æ®ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡query-bool-filterç»„åˆæ¥è®©ESä¸è®¡ç®—scoreï¼Œå¹¶ä¸”å°½å¯èƒ½çš„ç¼“å­˜filterçš„ç»“æœé›†ï¼Œä¾›åç»­åŒ…å«ç›¸åŒfilterçš„æŸ¥è¯¢ä½¿ç”¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<ul>
<li>æ™®é€šæŸ¥è¯¢<br><code>POST my_index/_search&#123;  &quot;query&quot;: &#123;    &quot;term&quot; : &#123; &quot;user&quot; : &quot;Kimchy&quot; &#125;   &#125;&#125;</code></li>
<li>query-bool-filter åŠ é€ŸæŸ¥è¯¢<br><code>POST my_index/_search&#123;  &quot;query&quot;: &#123;    &quot;bool&quot;: &#123;      &quot;filter&quot;: &#123;        &quot;term&quot;: &#123; &quot;user&quot;: &quot;Kimchy&quot; &#125;      &#125;    &#125;  &#125;&#125;</code></li>
</ul>
<h3 id="indexæŒ‰æ—¥æœŸæ»šåŠ¨ï¼Œä¾¿äºç®¡ç†"><a href="#indexæŒ‰æ—¥æœŸæ»šåŠ¨ï¼Œä¾¿äºç®¡ç†" class="headerlink" title="indexæŒ‰æ—¥æœŸæ»šåŠ¨ï¼Œä¾¿äºç®¡ç†"></a>indexæŒ‰æ—¥æœŸæ»šåŠ¨ï¼Œä¾¿äºç®¡ç†</h3><p>å†™å…¥ESçš„æ•°æ®æœ€å¥½é€šè¿‡æŸç§æ–¹å¼åšåˆ†å‰²ï¼Œå­˜å…¥ä¸åŒçš„indexã€‚<br>å¸¸è§çš„åšæ³•æ˜¯å°†æ•°æ®æŒ‰æ¨¡å—/åŠŸèƒ½åˆ†ç±»ï¼Œå†™å…¥ä¸åŒçš„indexï¼Œç„¶åæŒ‰ç…§æ—¶é—´å»æ»šåŠ¨ç”Ÿæˆindexã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å„ç§æ•°æ®åˆ†å¼€ç®¡ç†ä¸ä¼šæ··æ·†ï¼Œä¹Ÿæ˜“äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚<code>åŒæ—¶indexæŒ‰æ—¶é—´æ»šåŠ¨ï¼Œæ•°æ®è¿‡æœŸæ—¶åˆ é™¤æ•´ä¸ªindexï¼Œè¦æ¯”ä¸€æ¡æ¡åˆ é™¤æ•°æ®æˆ–deletebyqueryæ•ˆç‡é«˜å¾ˆå¤š</code>ï¼Œå› ä¸ºåˆ é™¤æ•´ä¸ªindexæ˜¯ç›´æ¥åˆ é™¤åº•å±‚æ–‡ä»¶ï¼Œè€Œdeletebyqueryæ˜¯æŸ¥è¯¢-æ ‡è®°-åˆ é™¤ã€‚</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼Œå‡å¦‚æœ‰[modulea,moduleb]ä¸¤ä¸ªæ¨¡å—äº§ç”Ÿçš„æ•°æ®ï¼Œé‚£ä¹ˆindexè§„åˆ’å¯ä»¥æ˜¯è¿™æ ·çš„ï¼šä¸€ç±»indexåç§°æ˜¯modulea + {æ—¥æœŸ}ï¼Œå¦ä¸€ç±»indexåç§°æ˜¯module_b+ {æ—¥æœŸ}ã€‚å¯¹äºåå­—ä¸­çš„æ—¥æœŸï¼Œå¯ä»¥åœ¨å†™å…¥æ•°æ®æ—¶è‡ªå·±æŒ‡å®šç²¾ç¡®çš„æ—¥æœŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡ESçš„ingest pipelineä¸­çš„index-name-processorå®ç°ï¼ˆä¼šæœ‰å†™å…¥æ€§èƒ½æŸè€—ï¼‰ã€‚</p>
<h3 id="æŒ‰éœ€æ§åˆ¶indexçš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°"><a href="#æŒ‰éœ€æ§åˆ¶indexçš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°" class="headerlink" title="æŒ‰éœ€æ§åˆ¶indexçš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°"></a>æŒ‰éœ€æ§åˆ¶indexçš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°</h3><p>åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šä¸€ä¸ªESçš„indexç”±å¤šä¸ªshardç»„æˆï¼Œæ¯ä¸ªshardæ‰¿è½½indexçš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>
<p>å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šindexä¹Ÿå¯ä»¥è®¾å®šå‰¯æœ¬æ•°ï¼ˆnumberofreplicasï¼‰ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªshardæœ‰å¤šå°‘ä¸ªå¤‡ä»½ã€‚å¯¹äºæŸ¥è¯¢å‹åŠ›è¾ƒå¤§çš„indexï¼Œå¯ä»¥è€ƒè™‘æé«˜å‰¯æœ¬æ•°ï¼ˆnumberofreplicasï¼‰ï¼Œé€šè¿‡å¤šä¸ªå‰¯æœ¬å‡æ‘ŠæŸ¥è¯¢å‹åŠ›ã€‚</p>
<p>shardæ•°é‡ï¼ˆnumberofshardsï¼‰è®¾ç½®è¿‡å¤šæˆ–è¿‡ä½éƒ½ä¼šå¼•å‘ä¸€äº›é—®é¢˜ï¼šshardæ•°é‡è¿‡å¤šï¼Œåˆ™æ‰¹é‡å†™å…¥/æŸ¥è¯¢è¯·æ±‚è¢«åˆ†å‰²ä¸ºè¿‡å¤šçš„å­å†™å…¥/æŸ¥è¯¢ï¼Œå¯¼è‡´è¯¥indexçš„å†™å…¥ã€æŸ¥è¯¢æ‹’ç»ç‡ä¸Šå‡ï¼›å¯¹äºæ•°æ®é‡è¾ƒå¤§çš„inexï¼Œå½“å…¶shardæ•°é‡è¿‡å°æ—¶ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨èŠ‚ç‚¹èµ„æºï¼Œé€ æˆæœºå™¨èµ„æºåˆ©ç”¨ç‡ä¸é«˜ æˆ– ä¸å‡è¡¡ï¼Œå½±å“å†™å…¥/æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p>
<p>å¯¹äºæ¯ä¸ªindexçš„shardæ•°é‡ï¼Œå¯ä»¥æ ¹æ®æ•°æ®æ€»é‡ã€å†™å…¥å‹åŠ›ã€èŠ‚ç‚¹æ•°é‡ç­‰ç»¼åˆè€ƒé‡åè®¾å®šï¼Œç„¶åæ ¹æ®æ•°æ®å¢é•¿çŠ¶æ€å®šæœŸæ£€æµ‹ä¸‹shardæ•°é‡æ˜¯å¦åˆç†ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿçš„æ¨èæ–¹æ¡ˆæ˜¯ï¼š</p>
<p>å¯¹äºæ•°æ®é‡è¾ƒå°ï¼ˆ100GBä»¥ä¸‹ï¼‰çš„indexï¼Œå¾€å¾€å†™å…¥å‹åŠ›æŸ¥è¯¢å‹åŠ›ç›¸å¯¹è¾ƒä½ï¼Œä¸€èˆ¬è®¾ç½®3<del>5ä¸ªshardï¼Œnumberofreplicasè®¾ç½®ä¸º1å³å¯ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå…±ä¸¤å‰¯æœ¬ï¼‰ ã€‚<br>å¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼ˆ100GBä»¥ä¸Šï¼‰çš„indexï¼š<br>ä¸€èˆ¬æŠŠå•ä¸ªshardçš„æ•°æ®é‡æ§åˆ¶åœ¨ï¼ˆ20GB</del>50GBï¼‰<br>è®©indexå‹åŠ›åˆ†æ‘Šè‡³å¤šä¸ªèŠ‚ç‚¹ï¼šå¯é€šè¿‡index.routing.allocation.totalshardsper_nodeå‚æ•°ï¼Œå¼ºåˆ¶é™å®šä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¯¥indexçš„shardæ•°é‡ï¼Œè®©shardå°½é‡åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹ä¸Š<br>ç»¼åˆè€ƒè™‘æ•´ä¸ªindexçš„shardæ•°é‡ï¼Œå¦‚æœshardæ•°é‡ï¼ˆä¸åŒ…æ‹¬å‰¯æœ¬ï¼‰è¶…è¿‡50ä¸ªï¼Œå°±å¾ˆå¯èƒ½å¼•å‘æ‹’ç»ç‡ä¸Šå‡çš„é—®é¢˜ï¼Œæ­¤æ—¶å¯è€ƒè™‘æŠŠè¯¥indexæ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„indexï¼Œåˆ†æ‘Šæ•°æ®é‡ï¼ŒåŒæ—¶é…åˆroutingä½¿ç”¨ï¼Œé™ä½æ¯ä¸ªæŸ¥è¯¢éœ€è¦è®¿é—®çš„shardæ•°é‡ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearchè¸©å‘</title>
    <url>/wiki/elasticsearch%E8%B8%A9%E5%9D%91/</url>
    <content><![CDATA[<h2 id="search-max-buckets"><a href="#search-max-buckets" class="headerlink" title="search.max_buckets"></a>search.max_buckets</h2><p>This limit can be set by changing the [search.max_buckets] cluster level setting.]];</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT _cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;persistent&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;search.max_buckets&quot;</span>: <span class="number">100000</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Required-one-of-fields-field-script"><a href="#Required-one-of-fields-field-script" class="headerlink" title="Required one of fields [field, script]"></a>Required one of fields [field, script]</h2><p>[Elasticsearch exception [type=illegal_argument_exception, reason=Required one of fields [field, script], but none were specified. ]</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      NativeSearchQuery nativeSearchQuery = <span class="keyword">new</span> NativeSearchQuery(QueryBuilders.matchAllQuery(), <span class="keyword">null</span>);</span><br><span class="line">      Script script = <span class="keyword">new</span> Script(<span class="string">&quot;doc[&#x27;article.keyword&#x27;]&quot;</span>);</span><br><span class="line">      nativeSearchQuery.addAggregation(AggregationBuilders.terms(<span class="string">&quot;art&quot;</span>)</span><br><span class="line">              .field(<span class="string">&quot;article.keyword&quot;</span>).size(<span class="number">10</span>)</span><br><span class="line">              .subAggregation(AggregationBuilders.dateHistogram(<span class="string">&quot;visitTime&quot;</span>)</span><br><span class="line">                      .field(<span class="string">&quot;visitTime&quot;</span>) <span class="comment">// è¿™ä¸€è¡Œæ²¡æœ‰å†™</span></span><br><span class="line">                      .calendarInterval(DateHistogramInterval.HOUR)));</span><br><span class="line">      SearchHits&lt;YjVisitData&gt; search = elasticsearchRestTemplate.search(nativeSearchQuery, YjVisitData.class);</span><br><span class="line">      System.err.println(<span class="string">&quot;search.getAggregations().asList() &#123;&#125;&quot;</span> + search.getAggregations().asList().size());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearché‡è¦é…ç½®</title>
    <url>/wiki/elasticsearch%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>è™½ç„¶Elasticsearchä»…éœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œä½†æœ‰è®¸å¤šè®¾ç½®éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¹¶ä¸”åœ¨è¿›å…¥ç”Ÿäº§ä¹‹å‰ç»å¯¹å¿…é¡»è¿›è¡Œé…ç½®ã€‚</p>
<p><code>path.data</code> å’Œ <code>path.logs</code><br><code>cluster.name</code><br><code>node.name</code><br><code>bootstrap.memory_lock</code><br><code>network.host</code><br><code>discovery.zen.ping.unicast.hosts</code><br><code>discovery.zen.minimum_master_nodes</code><br><code>path.data</code> å’Œ <code>path.logs</code><br>å¦‚æœä½¿ç”¨.zipæˆ–.tar.gzå½’æ¡£ï¼Œåˆ™æ•°æ®å’Œæ—¥å¿—ç›®å½•æ˜¯$ES_HOMEçš„å­æ–‡ä»¶å¤¹ã€‚ å¦‚æœè¿™äº›é‡è¦çš„æ–‡ä»¶å¤¹ä¿ç•™åœ¨å…¶é»˜è®¤ä½ç½®ï¼Œåˆ™å­˜åœ¨å°†Elasticsearchå‡çº§åˆ°æ–°ç‰ˆæœ¬æ—¶è¢«åˆ é™¤çš„é«˜é£é™©ã€‚  </p>
<p>åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œè‚¯å®šå¾—æ›´æ”¹æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">path:</span></span><br><span class="line">  <span class="attr">logs:</span> <span class="string">/var/log/elasticsearch</span></span><br><span class="line">  <span class="attr">data:</span> <span class="string">/var/data/elasticsearch</span></span><br></pre></td></tr></table></figure>
<p>RPMå’ŒDebianå‘è¡Œç‰ˆå·²ç»ä½¿ç”¨æ•°æ®å’Œæ—¥å¿—çš„è‡ªå®šä¹‰è·¯å¾„ã€‚  </p>
<p><code>path.data</code> è®¾ç½®å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªè·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è·¯å¾„å°†ç”¨äºå­˜å‚¨æ•°æ®ï¼ˆå±äºå•ä¸ªåˆ†ç‰‡çš„æ–‡ä»¶å°†å…¨éƒ¨å­˜å‚¨åœ¨åŒä¸€æ•°æ®è·¯å¾„ä¸Šï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">path:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/mnt/elasticsearch_1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/mnt/elasticsearch_2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/mnt/elasticsearch_3</span></span><br></pre></td></tr></table></figure>
<h2 id="cluster-name"><a href="#cluster-name" class="headerlink" title="cluster.name"></a>cluster.name</h2><p>èŠ‚ç‚¹åªèƒ½åœ¨ç¾¤é›†ä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å…±äº«å…¶cluster.nameæ—¶æ‰èƒ½åŠ å…¥ç¾¤é›†ã€‚ é»˜è®¤åç§°ä¸ºelasticsearchï¼Œä½†æ‚¨åº”å°†å…¶æ›´æ”¹ä¸ºæè¿°é›†ç¾¤ç”¨é€”çš„é€‚å½“åç§°ã€‚<br><code>cluster.name: logging-prod</code><br>ç¡®ä¿ä¸è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„é›†ç¾¤åç§°ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´åŠ å…¥é”™è¯¯é›†ç¾¤çš„èŠ‚ç‚¹ã€‚  </p>
<h2 id="node-name"><a href="#node-name" class="headerlink" title="node.name"></a>node.name</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå°†ä½¿ç”¨éšæœºç”Ÿæˆçš„uuidçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèŠ‚ç‚¹idã€‚ è¯·æ³¨æ„ï¼ŒèŠ‚ç‚¹IDæ˜¯æŒä¹…åŒ–çš„ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹é‡æ–°å¯åŠ¨æ—¶ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤é»˜è®¤èŠ‚ç‚¹åç§°ä¹Ÿä¸ä¼šæ›´æ”¹ã€‚<br>é…ç½®ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„åç§°æ˜¯å€¼å¾—çš„ï¼Œè¿™æ˜¯é‡å¯èŠ‚ç‚¹åä¹Ÿèƒ½ä¸€ç›´ä¿æŒçš„ä¼˜åŠ¿ï¼š<br><code>node.name: prod-data-2</code><br>node.nameä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæœåŠ¡å™¨çš„HOSTNAMEï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  </p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">node.name:</span> <span class="string">$&#123;HOSTNAME&#125;</span></span><br><span class="line"><span class="string">bootstrap.memory_lock</span></span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰JVMè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šè¿™äº‹å¯¹äºèŠ‚ç‚¹çš„å¥åº·æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸€ç§å®ç°æ–¹æ³•æ˜¯å°†bootstrap.memory_lockè®¾ç½®ä¸ºtrueã€‚<br>è¦ä½¿æ­¤è®¾ç½®ç”Ÿæ•ˆï¼Œéœ€è¦é¦–å…ˆé…ç½®å…¶ä»–ç³»ç»Ÿè®¾ç½®ã€‚ æœ‰å…³å¦‚ä½•æ­£ç¡®è®¾ç½®å†…å­˜é”å®šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯ç”¨<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html#mlockall">bootstrap.memory_lock</a>ã€‚  </p>
<h2 id="network-host"><a href="#network-host" class="headerlink" title="network.host"></a>network.host</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä»…ä»…ç»‘å®šåœ¨æœ¬åœ°å›è·¯åœ°å€â€”â€”å¦‚ï¼š127.0.0.1ä¸[::1]ã€‚è¿™åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè·‘ä¸€ä¸ªå¼€å‘èŠ‚ç‚¹æ˜¯è¶³å¤Ÿçš„ã€‚<br>æç¤º</p>
<p>äº‹å®ä¸Šï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šç›¸åŒçš„$ES_HOMEä½ç½®ä¸€åŒè¿è¡Œã€‚è¿™å¯ä»¥ç”¨äºæµ‹è¯•Elasticsearchå½¢æˆé›†ç¾¤çš„èƒ½åŠ›,ä½†è¿™ç§é…ç½®æ–¹å¼ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>ä¸ºäº†å°†å…¶å®ƒæœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¯ä»¥ç›¸äº’é€šè®¯çš„é›†ç¾¤ï¼Œä½ çš„èŠ‚ç‚¹å°†ä¸èƒ½ç»‘å®šåœ¨ä¸€ä¸ªå›è·¯åœ°å€ä¸Šã€‚ è¿™é‡Œæœ‰æ›´å¤šçš„ç½‘è·¯é…ç½®ï¼Œé€šå¸¸ä½ åªéœ€è¦é…ç½®network.hostï¼š<br><code>network.host: 192.168.1.10</code><br>network.hostä¹Ÿå¯ä»¥é…ç½®æˆä¸€äº›èƒ½è¯†åˆ«çš„ç‰¹æ®Šçš„å€¼ï¼Œè­¬å¦‚ï¼š_local_ã€_siteã€_global_ï¼Œå®ƒä»¬å¯ä»¥ç»“åˆæŒ‡å®š:ip4ä¸ip6æ¥ä½¿ç”¨ã€‚æ›´å¤šç›¸ä¿¡ä¿¡æ¯è¯·å‚è§ï¼š<a href="https://aqlu.gitbooks.io/elasticsearch-reference/content/Modules/Network_Settings.html">ç½‘è·¯é…ç½®</a></p>
<p>é‡è¦ ğŸ‘‡</p>
<p>ä¸€æ—¦ä½ è‡ªå®šä¹‰äº†network.hostçš„é…ç½®ï¼ŒElasticsearchå°†å‡è®¾ä½ å·²ç»ä»å¼€å‘æ¨¡å¼è½¬åˆ°äº†ç”Ÿäº§æ¨¡å¼ï¼Œå¹¶å°†å‡çº§ç³»ç»Ÿæ£€æµ‹çš„è­¦å‘Šä¿¡æ¯ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼šå¼€å‘æ¨¡å¼vsç”Ÿäº§æ¨¡å¼</p>
<h2 id="discovery-zen-ping-unicast-hostsï¼ˆå•æ’­å‘ç°ï¼‰"><a href="#discovery-zen-ping-unicast-hostsï¼ˆå•æ’­å‘ç°ï¼‰" class="headerlink" title="discovery.zen.ping.unicast.hostsï¼ˆå•æ’­å‘ç°ï¼‰"></a>discovery.zen.ping.unicast.hostsï¼ˆå•æ’­å‘ç°ï¼‰</h2><p>å¼€ç®±å³ç”¨ï¼Œæ— éœ€ä»»ä½•ç½‘ç»œé…ç½®ï¼ŒElasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„å›è·¯åœ°å€ï¼Œå¹¶æ‰«æ9300å¹´åˆ°9305çš„ç«¯å£å»è¿æ¥åŒä¸€æœºå™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹,è¯•å›¾è¿æ¥åˆ°ç›¸åŒçš„æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å…¶ä»–èŠ‚ç‚¹ã€‚å®ƒæä¾›äº†ä¸éœ€è¦ä»»ä½•é…ç½®å°±èƒ½è‡ªåŠ¨ç»„å»ºé›†ç¾¤çš„ä½“éªŒã€‚<br>å½“ä¸å…¶å®ƒæœºå™¨ä¸Šçš„èŠ‚ç‚¹è¦å½¢æˆä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªåœ¨çº¿ä¸”å¯è®¿é—®çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚åƒå¦‚ä¸‹æ¥é…ç½®ï¼š  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">discovery.zen.ping.unicast.hosts:</span><br><span class="line">   - 192.168.1.10:9300</span><br><span class="line">   - 192.168.1.11 #â‘ </span><br><span class="line">   - seeds.mydomain.com #â‘¡</span><br></pre></td></tr></table></figure>
<p>â‘  æœªæŒ‡å®šç«¯å£æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„<code>transport.profiles.default.port</code>å€¼ï¼Œå¦‚æœæ­¤å€¼ä¹Ÿä¸ºè®¾ç½®åˆ™ä½¿ç”¨<code>transport.tcp.port</code></p>
<p>â‘¡ ä¸»æœºåå°†è¢«å°è¯•è§£ææˆèƒ½è§£æçš„å¤šä¸ªIP</p>
<h2 id="discovery-zen-minimum-master-nodes"><a href="#discovery-zen-minimum-master-nodes" class="headerlink" title="discovery.zen.minimum_master_nodes"></a>discovery.zen.minimum_master_nodes</h2><p>ä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé…ç½®discovery-zen-minimum_master_nodeså°†éå¸¸é‡è¦ï¼Œä»–è§„å®šäº†å¿…é¡»è‡³å°‘è¦æœ‰å¤šå°‘ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚<br>æ²¡æœ‰æ­¤è®¾ç½®æ—¶ï¼Œä¸€ä¸ªé›†ç¾¤åœ¨å‘ç”Ÿç½‘ç»œé—®é¢˜æ˜¯å¯èƒ½ä¼šåˆ†è£‚æˆå¤šä¸ªé›†ç¾¤â€”â€”è„‘è£‚â€”â€”è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§ï¼šé€šè¿‡minimum_master_nodesé¿å…è„‘è£‚<br>ä¸ºé¿å…è„‘è£‚ï¼Œä½ éœ€è¦æ ¹æ®masterèŠ‚ç‚¹æ•°æ¥è®¾ç½®æ³•å®šäººæ•°ï¼š<br><code>(master_eligible_nodes / 2) + 1</code><br>æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæœ€å°çš„ä¸»èŠ‚ç‚¹æ•°å› è¢«è®¾ç½®ä¸º(3/2)+1æˆ–è€…æ˜¯2<br><code>discovery.zen.minimum_master_nodes: 2</code></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html#mlockall">elastic å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://www.codingdict.com/document">codingdict.com</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>field name is null or empty</title>
    <url>/wiki/field-name-is-null-or-empty/</url>
    <content><![CDATA[<h2 id="canal-adapter-æŠ¥é”™ä¿¡æ¯"><a href="#canal-adapter-æŠ¥é”™ä¿¡æ¯" class="headerlink" title="canal adapter æŠ¥é”™ä¿¡æ¯"></a>canal adapter æŠ¥é”™ä¿¡æ¯</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2021-07-06 12:46:31.959 [http-nio-8081-exec-2] INFO  o.a.catalina.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring FrameworkServlet &#x27;dispatcherServlet&#x27;</span><br><span class="line">2021-07-06 12:46:31.959 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet - FrameworkServlet &#x27;dispatcherServlet&#x27;: initialization started</span><br><span class="line">2021-07-06 12:46:31.968 [http-nio-8081-exec-2] INFO  org.springframework.web.servlet.DispatcherServlet - FrameworkServlet &#x27;dispatcherServlet&#x27;: initialization completed in 9 ms</span><br><span class="line">2021-07-06 12:46:31.995 [http-nio-8081-exec-2] INFO  c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member</span><br><span class="line">2021-07-06 12:46:32.027 [http-nio-8081-exec-2] ERROR c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - field name is null or empty</span><br><span class="line">java.lang.IllegalArgumentException: field name is null or empty</span><br><span class="line">	at org.elasticsearch.index.query.BaseTermQueryBuilder.&lt;init&gt;(BaseTermQueryBuilder.java:113) ~[na:na]</span><br><span class="line">	at org.elasticsearch.index.query.TermQueryBuilder.&lt;init&gt;(TermQueryBuilder.java:75) ~[na:na]</span><br><span class="line">	at org.elasticsearch.index.query.QueryBuilders.termQuery(QueryBuilders.java:202) ~[na:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.lambda$executeSqlImport$1(ESEtlService.java:141) ~[na:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.support.Util.sqlRS(Util.java:60) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.executeSqlImport(ESEtlService.java:64) ~[na:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.support.AbstractEtlService.importData(AbstractEtlService.java:105) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.importData(ESEtlService.java:56) ~[na:na]</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.etl(ES7xAdapter.java:79) ~[na:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:100) ~[client-adapter.launcher-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:123) ~[client-adapter.launcher-1.1.5-SNAPSHOT.jar:na]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_292]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_292]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_292]</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_292]</span><br><span class="line">	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke</span><br></pre></td></tr></table></figure>


<h2 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h2><p>æ“ä½œæ˜¯å‘æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œé€šè¿‡canal-adapteråŒæ­¥åˆ°elasticsearchä¸­ï¼Œæ¥å£å‘ç”Ÿä»¥ä¸Šé”™è¯¯ï¼<br>ç°è±¡æ˜¯canal-adapteræ£€æµ‹åˆ°å’Œmysqlçš„æ•°æ®å˜åŒ–ï¼Œä½†æ˜¯åŒæ­¥åˆ°esçš„æ—¶å€™å‘ç”Ÿäº†é”™è¯¯ï¼›<br>çŒœæƒ³å¤§æ¦‚æ˜¯æŸä¸ªä¸ºç©ºå¯¼è‡´å­˜åˆ°esçš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼›</p>
<p>ç„¶åæŸ¥çœ‹es7ä¸‹çš„mappingé…ç½®ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-93dc9d1f9074d9d44946f2d5c3780dd7e13.png" width=400 height=300>

<p>å‘ç°æˆ‘çš„sqlæŸ¥idçš„æ—¶å€™å†™é”™äº†ï¼Œåˆ«ååº”è¯¥å†™æˆ_id,å¯¹åº”elasticsearchçš„_id</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Other Question</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>flink æäº¤ä»»åŠ¡</title>
    <url>/wiki/flink-%E6%8F%90%E4%BA%A4%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<p>ä¸‹é¢æ¼”ç¤ºå¦‚ä½•é€šè¿‡adminé¡µé¢æäº¤ä»»åŠ¡ ğŸ‘‡</p>
<h2 id="å‡†å¤‡task-jar"><a href="#å‡†å¤‡task-jar" class="headerlink" title="å‡†å¤‡task jar"></a>å‡†å¤‡task jar</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamWordCount</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»socketæ–‡æœ¬æµè¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputDataStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®—</span></span><br><span class="line">        DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(<span class="keyword">new</span> WordCount.MyFlatMapper())</span><br><span class="line">                .keyBy(<span class="number">0</span>)</span><br><span class="line">                .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>mvn install -DskipTest</code> å¯ä»¥å¾—åˆ°ç›¸åº”çš„jar</p>
<h2 id="adminæäº¤jar"><a href="#adminæäº¤jar" class="headerlink" title="adminæäº¤jar"></a>adminæäº¤jar</h2><img src='https://oscimg.oschina.net/oscnet/up-6f96aa46a523c9cd32f12177775b6d6fab9.png' width=900 height=450> 

<p>æäº¤å®ŒjaråŒ…ä¹‹åï¼Œéœ€è¦è®¾ç½®ç›¸å…³å‚æ•°ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥è®¾ç½®ï¼Œä¸‹é¢æ˜¯å‚è€ƒæ ·ä¾‹ï¼š </p>
<ul>
<li>Enter Class : com.ibli.flink.StreamWordCount<br>ä¹Ÿå°±æ˜¯ç¨‹åºå…¥å£ï¼Œæˆ‘ä»¬è¿™æ˜¯å†™äº†ä¸€ä¸ªmainæ–¹æ³•ï¼Œå¦‚æœæ˜¯ç¨‹åºçš„è¯ï¼Œå¯ä»¥å†™å¯¹åº”bootstrapçš„å¯åŠ¨ç±»</li>
<li>Program Arguments : â€“host localhost â€“port 7777 </li>
</ul>
<p>ç‚¹å‡» <code>submit</code>  ä¹‹åæŸ¥çœ‹æäº¤çš„ä»»åŠ¡çŠ¶æ€</p>
<h2 id="æŸ¥çœ‹ä»»åŠ¡"><a href="#æŸ¥çœ‹ä»»åŠ¡" class="headerlink" title="æŸ¥çœ‹ä»»åŠ¡"></a>æŸ¥çœ‹ä»»åŠ¡</h2><img src='https://oscimg.oschina.net/oscnet/up-f11b32799d87f90c6e78732db82f191be3b.png' width=900 height=450>  

<p>å¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”éƒ½æ˜¯åœ¨æ‰§è¡ŒçŠ¶æ€ï¼›<br>ç‚¹å‡»ä¸€ä¸ªä»»åŠ¡ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…ä¿¡æ¯ï¼Œå’Œä¸€äº›å…¶ä»–çš„ä¿¡æ¯ï¼Œéå¸¸å…¨é¢ï¼›</p>
<img src="https://oscimg.oschina.net/oscnet/up-9678050d3906aae9ccead23d02927d46851.png" width=900 height=450>

<h2 id="æŸ¥çœ‹è¿è¡Œæ—¶ä»»åŠ¡åˆ—è¡¨"><a href="#æŸ¥çœ‹è¿è¡Œæ—¶ä»»åŠ¡åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹è¿è¡Œæ—¶ä»»åŠ¡åˆ—è¡¨"></a>æŸ¥çœ‹è¿è¡Œæ—¶ä»»åŠ¡åˆ—è¡¨</h2><img src='https://oscimg.oschina.net/oscnet/up-da8bf04ac90ae3c16095a6ebf25175b4452.png' width=900 height=350>


<h2 id="æŸ¥çœ‹ä»»åŠ¡ç®¡ç†åˆ—è¡¨"><a href="#æŸ¥çœ‹ä»»åŠ¡ç®¡ç†åˆ—è¡¨" class="headerlink" title="æŸ¥çœ‹ä»»åŠ¡ç®¡ç†åˆ—è¡¨"></a>æŸ¥çœ‹ä»»åŠ¡ç®¡ç†åˆ—è¡¨</h2><img src="https://oscimg.oschina.net/oscnet/up-a85746f93dc171f3d320a17c07294682bb3.png" width=900 height=450>

<p>ç‚¹å‡»ä»»åŠ¡å¯ä»¥è·³è½¬åˆ°è¯¦æƒ…é¡µé¢ ğŸ‘‡ ä¸‹é¢æ˜¯æ‰§è¡Œæ—¥å¿— </p>
<img src= 'https://oscimg.oschina.net/oscnet/up-a11c7ccc522c77d100d57a9c2a08ec9183b.png' width=900 height=500>

<p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œçš„æ ‡å‡†è¾“å‡ºç»“æœâœ…</p>
<img src="https://oscimg.oschina.net/oscnet/up-3d990a6318fab3a11e7336fdcd271851fda.png" width=900 height=400>

<h2 id="ä»»åŠ¡æºæ•°æ®"><a href="#ä»»åŠ¡æºæ•°æ®" class="headerlink" title="ä»»åŠ¡æºæ•°æ®"></a>ä»»åŠ¡æºæ•°æ®</h2><p>é€šè¿‡nc è¾“å…¥æ•°æ®ï¼Œç”±ç¨‹åºè¯»å–7777ç«¯å£è¾“å…¥æµå¹¶è§£ææ•°æ®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gaolei:geekibli gaolei$ nc -lk 7777</span><br><span class="line">hello java</span><br><span class="line">hello flink</span><br></pre></td></tr></table></figure>

<h2 id="å–æ¶ˆä»»åŠ¡å¦‚ä¸‹"><a href="#å–æ¶ˆä»»åŠ¡å¦‚ä¸‹" class="headerlink" title="å–æ¶ˆä»»åŠ¡å¦‚ä¸‹"></a>å–æ¶ˆä»»åŠ¡å¦‚ä¸‹</h2><img src='https://oscimg.oschina.net/oscnet/up-05199d86b957e0adec4e4d91390a0aebbec.png' width=900 height=400> 

<p>å†æ¬¡æŸ¥çœ‹å·²å®Œæˆä»»åŠ¡åˆ—è¡¨ å¦‚ä¸‹ï¼š</p>
<img src='https://oscimg.oschina.net/oscnet/up-78c97d4c4aec1641a22165735764c54b969.png' width=900 height=400>]]></content>
      <categories>
        <category>Apache Flink</category>
      </categories>
      <tags>
        <tag>flink</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache Flink</title>
    <url>/wiki/flink%E7%AE%80%E4%BB%8B/</url>
    <content><![CDATA[<img src="https://flink.apache.org/img/flink-header-logo.svg" width=300 height=300>


<p>å®˜æ–¹åœ°å€è¯·æˆ³ğŸ‘‰ <a href="https://flink.apache.org/">ã€ä¼ é€ã€‘</a> </p>
<blockquote>
<p>Apache Flink is a framework and distributed processing engine for stateful computations over unbounded and bounded data streams. Flink has been designed to run in all common cluster environments, perform computations at in-memory speed and at any scale.  </p>
</blockquote>
<p>Apache Flink æ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å™¨å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®è¿›è¡ŒçŠ¶æ€è®¡ç®—ï¼›  </p>
<h2 id="Why-Flink"><a href="#Why-Flink" class="headerlink" title="Why Flink"></a>Why Flink</h2><ul>
<li>æµæ•°æ®æ›´çœŸå®åœ°ååº”äº†æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼</li>
<li>ä¼ ç»Ÿçš„æ•°æ®æ¶æ„æ˜¯åŸºäºæœ‰é™æ•°æ®é›†çš„</li>
<li>æˆ‘ä»¬çš„ç›®æ ‡<br>1ã€ä½å»¶è¿Ÿ æ¯«ç§’çº§å“åº”<br>2ã€é«˜åå èƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ® åˆ†å¸ƒå¼<br>3ã€ç»“æœçš„å‡†ç¡®æ€§å’Œè‰¯å¥½çš„å®¹é”™æ€§  </li>
</ul>
<h2 id="Where-need-Flink"><a href="#Where-need-Flink" class="headerlink" title="Where need Flink"></a>Where need Flink</h2><ul>
<li>ç”µå•†å’Œå¸‚åœºè¥é”€<br>æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦</li>
<li>ç‰©è”ç½‘ï¼ˆIOTï¼‰<br>ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºï¼Œå®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š</li>
<li>ç”µä¿¡ä¸š<br>åŸºç«™æµé‡è°ƒé…</li>
<li>é“¶è¡Œå’Œé‡‘èä¸š<br>å®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ã€å®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º</li>
</ul>
<h2 id="ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„"><a href="#ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„" class="headerlink" title="ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„"></a>ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„</h2><img src="https://oscimg.oschina.net/oscnet/up-5c77526cb1dbc4696143519dff42c447149.png" width=500 height=300>

<p>ä¼ ç»Ÿçš„æ•°æ®å¤„ç†æ¶æ„å¦‚ä¸ŠğŸ‘†<br>CRM(ç”¨æˆ·å…³ç³»ç³»ç»Ÿ)ï¼Œ Order System(è®¢å•ç³»ç»Ÿ), Web App (ç”¨æˆ·ç‚¹å‡»æ—¶é—´)ï¼Œå½“ç”¨æˆ·å‡ºå‘è¡Œä¸ºä¹‹åéœ€è¦ç³»ç»Ÿä½œå‡ºå“åº”ï¼Œé¦–å…ˆç”±ä¸Šå±‚çš„è®¡ç®—å±‚å¤„ç†è®¡ç®—é€»è¾‘ï¼Œè®¡ç®—å±‚çš„é€»è¾‘è®¡ç®—ä¾èµ–ä¸‹é¢çš„å­˜å‚¨å±‚ï¼Œè®¡ç®—å±‚è®¡ç®—å®Œæˆä¹‹åï¼Œå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚<br>è¿™ç§åŸºäºä¼ ç»Ÿæ•°æ®åº“æ–¹å¼æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯ï¼Œæ•°æ®åº“çš„å¹¶å‘é‡éƒ½æ˜¯å¾ˆä½çš„ã€‚</p>
<h2 id="åˆ†æå¤„ç†æµç¨‹"><a href="#åˆ†æå¤„ç†æµç¨‹" class="headerlink" title="åˆ†æå¤„ç†æµç¨‹"></a>åˆ†æå¤„ç†æµç¨‹</h2><img src="https://oscimg.oschina.net/oscnet/up-060fc9ea54c7bfc0e2d5d73b2d674cad5d4.png" width="500" height="300">
åˆ†æå¤„ç†æµç¨‹æ¶æ„å¦‚ä¸ŠğŸ‘†ï¼Œæ•°æ®å…ˆæœ‰ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ï¼Œç»è¿‡æå–ï¼Œæ¸…æ´—è¿‡æ»¤ç­‰ï¼Œå°†æ•°æ®å­˜æ”¾åˆ°æ•°æ®ä»“åº“ï¼Œç„¶åé€šè¿‡ä¸€äº›sqlå¤„ç†ï¼Œç”Ÿæˆæ•°æ®æŠ¥è¡¨å’Œä¸€äº›å…¶ä»–çš„æŸ¥è¯¢ã€‚  

<ul>
<li>é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®æ—¶æ€§å¤ªå·®äº†ï¼Œå¤„ç†æµç¨‹å¤ªé•¿ï¼Œæ— æ³•æ»¡è¶³æ¯«ç§’çº§éœ€æ±‚</li>
<li>æ•°æ®æ¥æºä¸å”¯ä¸€ï¼Œèƒ½æ»¡è¶³æµ·é‡æ•°æ®å’Œé«˜å¹¶å‘çš„éœ€æ±‚ï¼Œä½†æ˜¯æ— æ³•æ»¡è¶³å®æ—¶çš„éœ€æ±‚</li>
</ul>
<h2 id="æœ‰çŠ¶æ€çš„æµå¼å¤„ç†"><a href="#æœ‰çŠ¶æ€çš„æµå¼å¤„ç†" class="headerlink" title="æœ‰çŠ¶æ€çš„æµå¼å¤„ç†"></a>æœ‰çŠ¶æ€çš„æµå¼å¤„ç†</h2><img src="https://oscimg.oschina.net/oscnet/up-cdf03c1c17f534673e73968bb4a094aadbc.png" width="500" height="300">
æŠŠå½“å‰åšæµå¼è®¡ç®—æ‰€éœ€è¦çš„æ•°æ®ä¸å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯ç®€å•ç²—æš´çš„ç›´æ¥æ”¾åˆ°æœ¬åœ°å†…å­˜ä¸­ï¼›

<h3 id="å†…å­˜ä¸ç¨³å®šï¼Ÿ"><a href="#å†…å­˜ä¸ç¨³å®šï¼Ÿ" class="headerlink" title="å†…å­˜ä¸ç¨³å®šï¼Ÿ"></a>å†…å­˜ä¸ç¨³å®šï¼Ÿ</h3><p>å‘¨æœŸæ€§çš„æ£€æŸ¥ç‚¹ï¼Œæ•°æ®å­˜ç›˜å’Œæ•…éšœæ£€æµ‹ï¼›    </p>
<h2 id="lambdaæ¶æ„"><a href="#lambdaæ¶æ„" class="headerlink" title="lambdaæ¶æ„"></a>lambdaæ¶æ„</h2><p>ç”¨ä¸¤å°ç³»ç»ŸåŒæ—¶ä¿éšœä½å»¶è¿Ÿå’Œç»“æœå‡†ç¡®ï¼›<br><img src="https://oscimg.oschina.net/oscnet/up-d33708041d13956206958f26e3b5b209a37.png" width="500" height="300"></p>
<ul>
<li>è¿™å¥—æ¶æ„åˆ†æˆä¸¤ä¸ªæµç¨‹ï¼Œä¸Šé¢ä¸ºæ‰¹å¤„ç†æµç¨‹ï¼Œæ•°æ®æ”¶é›†åˆ°ä¸€å®šç¨‹åºï¼Œäº¤ç»™æ‰¹å¤„ç†å™¨å¤„ç†ï¼Œæœ€ç»ˆäº§ç”Ÿä¸€ä¸ªæ‰¹å¤„ç†ç»“æœ</li>
<li>ä¸‹é¢çš„æµç¨‹ä¸ºæµå¼å¤„ç†æµç¨‹ï¼Œä¿è¯èƒ½å¿«é€Ÿå¾—åˆ°ç»“æœ</li>
<li>æœ€ç»ˆæœ‰æˆ‘ä»¬åœ¨åº”ç”¨å±‚æ ¹æ®å®é™…é—®é¢˜é€‰æ‹©å…·ä½“çš„å¤„ç†ç»“æœäº¤ç»™åº”ç”¨ç¨‹åºè¿™ç§æ¶æ„æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ<br>å¯èƒ½å¾—åˆ°çš„ç»“æœæ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¿«é€Ÿçš„å¾—åˆ°ä¸€ä¸ªå®æ—¶è®¡ç®—çš„ç»“æœï¼Œéš”ä¸€æ®µæ—¶é—´ä¹‹ååœ¨æ¥çœ‹æ‰¹å¤„ç†äº§ç”Ÿçš„ç»“æœã€‚<br>å®ç°ä¸¤å°ç³»ç»Ÿå’Œç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿï¼Œæˆæœ¬å¾ˆå¤§ï¼›  </li>
</ul>
<h2 id="ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„"><a href="#ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„" class="headerlink" title="ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„"></a>ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„</h2><p>Apache Flink å¯ä»¥å®Œç¾è§£å†³ä¸Šé¢çš„é—®é¢˜ğŸ‘†<br><img src="https://oscimg.oschina.net/oscnet/up-0cec29eb67e668b76cd1387a0cfe71e47a0.png" width="350" height="350"><br>Stromæ— æ³•æ»¡è¶³æµ·é‡æ•°æ®ï¼› Sparking Stream æ— æ³•æ»¡è¶³ä½å»¶è¿Ÿï¼›  </p>
<h3 id="åŸºäºäº‹ä»¶é©±åŠ¨-ï¼ˆEvent-drivenï¼‰"><a href="#åŸºäºäº‹ä»¶é©±åŠ¨-ï¼ˆEvent-drivenï¼‰" class="headerlink" title="åŸºäºäº‹ä»¶é©±åŠ¨ ï¼ˆEvent-drivenï¼‰"></a>åŸºäºäº‹ä»¶é©±åŠ¨ ï¼ˆEvent-drivenï¼‰</h3><img src="https://oscimg.oschina.net/oscnet/up-cf462b316ee2d27df780fd551ce8ecc72cb.png" width="450" height="330">
  

<h3 id="å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®"><a href="#å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®" class="headerlink" title="å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®"></a>å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®</h3><p>ä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥å½¢æˆä¸€ç§äº‹ä»¶æµã€‚ä¿¡ç”¨å¡äº¤æ˜“ã€ä¼ æ„Ÿå™¨æµ‹é‡ã€æœºå™¨æ—¥å¿—ã€ç½‘ç«™æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºä¸Šçš„ç”¨æˆ·äº¤äº’è®°å½•ï¼Œæ‰€æœ‰è¿™äº›æ•°æ®éƒ½å½¢æˆä¸€ç§æµã€‚<br>æ•°æ®å¯ä»¥è¢«ä½œä¸º æ— ç•Œ æˆ–è€… æœ‰ç•Œ æµæ¥å¤„ç†ã€‚  </p>
<ul>
<li><p><b>æ— ç•Œæµ</b> æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä½†æ²¡æœ‰å®šä¹‰æµçš„ç»“æŸã€‚å®ƒä»¬ä¼šæ— ä¼‘æ­¢åœ°äº§ç”Ÿæ•°æ®ã€‚æ— ç•Œæµçš„æ•°æ®å¿…é¡»æŒç»­å¤„ç†ï¼Œå³æ•°æ®è¢«æ‘„å–åéœ€è¦ç«‹åˆ»å¤„ç†ã€‚æˆ‘ä»¬ä¸èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾å†å¤„ç†ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— é™çš„ï¼Œåœ¨ä»»ä½•æ—¶å€™è¾“å…¥éƒ½ä¸ä¼šå®Œæˆã€‚å¤„ç†æ— ç•Œæ•°æ®é€šå¸¸è¦æ±‚ä»¥ç‰¹å®šé¡ºåºæ‘„å–äº‹ä»¶ï¼Œä¾‹å¦‚äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¨æ–­ç»“æœçš„å®Œæ•´æ€§ã€‚</p>
</li>
<li><p><b>æœ‰ç•Œæµ&lt;/&gt; æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä¹Ÿæœ‰å®šä¹‰æµçš„ç»“æŸã€‚æœ‰ç•Œæµå¯ä»¥åœ¨æ‘„å–æ‰€æœ‰æ•°æ®åå†è¿›è¡Œè®¡ç®—ã€‚æœ‰ç•Œæµæ‰€æœ‰æ•°æ®å¯ä»¥è¢«æ’åºï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æœ‰åºæ‘„å–ã€‚æœ‰ç•Œæµå¤„ç†é€šå¸¸è¢«ç§°ä¸ºæ‰¹å¤„ç†</p>
</li>
</ul>
<img src="https://flink.apache.org/img/bounded-unbounded.png" width="600" height="330" >

<p><b>Apache Flink æ“…é•¿å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®é›†</b> ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶å’ŒçŠ¶æ€åŒ–ä½¿å¾— Flink çš„è¿è¡Œæ—¶(runtime)èƒ½å¤Ÿè¿è¡Œä»»ä½•å¤„ç†æ— ç•Œæµçš„åº”ç”¨ã€‚æœ‰ç•Œæµåˆ™ç”±ä¸€äº›ä¸“ä¸ºå›ºå®šå¤§å°æ•°æ®é›†ç‰¹æ®Šè®¾è®¡çš„ç®—æ³•å’Œæ•°æ®ç»“æ„è¿›è¡Œå†…éƒ¨å¤„ç†ï¼Œäº§ç”Ÿäº†å‡ºè‰²çš„æ€§èƒ½ã€‚</p>
<h3 id="å…¶ä»–ç‰¹ç‚¹"><a href="#å…¶ä»–ç‰¹ç‚¹" class="headerlink" title="å…¶ä»–ç‰¹ç‚¹"></a>å…¶ä»–ç‰¹ç‚¹</h3><ul>
<li>æ”¯æŒäº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰è¯­ä¹‰</li>
<li>ç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯</li>
<li>ä½å»¶è¿Ÿ æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿ</li>
<li>ä¸ä¼—å¤šå¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿé“¾æ¥</li>
<li>é«˜å¯ç”¨ï¼ŒåŠ¨æ€æ‰©å±•ï¼Œæ”¯æŒ7*24å…¨å¤©è¿è¡Œ</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p>1ã€<a href="https://www.bilibili.com/video/BV1qy4y1q728?from=search&seid=13654102476223768024">å°šç¡…è°· 2021 Flink Javaç‰ˆ</a><br>2ã€<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.13/zh/">Apache Flink Documentation</a>  </p>
</blockquote>
]]></content>
      <categories>
        <category>Apache Flink</category>
      </categories>
      <tags>
        <tag>flink</tag>
      </tags>
  </entry>
  <entry>
    <title>flinkç®€å•ä¸Šæ‰‹</title>
    <url>/wiki/flink%E7%AE%80%E5%8D%95%E4%B8%8A%E6%89%8B/</url>
    <content><![CDATA[<h2 id="mac-å®‰è£…-flink"><a href="#mac-å®‰è£…-flink" class="headerlink" title="mac å®‰è£… flink"></a>mac å®‰è£… flink</h2><p><b>1ã€æ‰§è¡Œ brew install apache-flink å‘½ä»¤</b></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gaolei:/ gaolei$ brew install apache-flink</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Auto-updated Homebrew!  </span><br><span class="line">Updated 1 tap (homebrew/services).</span><br><span class="line">No changes to formulae.</span><br><span class="line"></span><br><span class="line">==&gt; Downloading https://archive.apache.org/dist/flink/flink-1.9.1/flink-1.9.1-bin-scala_2.11.tgz</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################################### 100.0%</span></span></span><br><span class="line">ğŸº  /usr/local/Cellar/apache-flink/1.9.1: 166 files, 277MB, built in 15 minutes 29 seconds</span><br></pre></td></tr></table></figure>

<p><b>2ã€æ‰§è¡Œflinkå¯åŠ¨è„šæœ¬</b></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/local/Cellar/apache-flink/1.9.1/libexec/bin</span><br><span class="line">./start-cluster.sh</span><br></pre></td></tr></table></figure>

<h2 id="WordCountæ‰¹å¤„ç†Demo"><a href="#WordCountæ‰¹å¤„ç†Demo" class="headerlink" title="WordCountæ‰¹å¤„ç†Demo"></a>WordCountæ‰¹å¤„ç†Demo</h2><h3 id="åˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ–"><a href="#åˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ–" class="headerlink" title="åˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ–"></a>åˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ–</h3><p> æ³¨æ„è‡ªå·±çš„flinkç‰ˆæœ¬ ğŸ‘‡ğŸ‘‡</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-java --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-java_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-java --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–å†™æ‰¹å¤„ç†ç¨‹åº"><a href="#ç¼–å†™æ‰¹å¤„ç†ç¨‹åº" class="headerlink" title="ç¼–å†™æ‰¹å¤„ç†ç¨‹åº"></a>ç¼–å†™æ‰¹å¤„ç†ç¨‹åº</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       <span class="comment">// 1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">       ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">       <span class="comment">// 2ã€è¯»å–æ–‡ä»¶æ•°æ®</span></span><br><span class="line">       String inputPath = <span class="string">&quot;/Users/gaolei/Documents/DemoProjects/flink-start/src/main/resources/hello.txt&quot;</span>;</span><br><span class="line">       DataSource&lt;String&gt; dataSource = env.readTextFile(inputPath);</span><br><span class="line">       <span class="comment">// å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç† æŒ‰ç…§ç©ºæ ¼åˆ†è¯å±•å¼€ è½¬æ¢æˆï¼ˆwordï¼Œ1ï¼‰äºŒå…ƒç»„</span></span><br><span class="line">       AggregateOperator&lt;Tuple2&lt;String, Integer&gt;&gt; result = dataSource.flatMap(<span class="keyword">new</span> MyFlatMapper())</span><br><span class="line">               <span class="comment">// æŒ‰ç…§ç¬¬ä¸€ä¸ªä½ç½® -&gt; word åˆ†ç»„</span></span><br><span class="line">               .groupBy(<span class="number">0</span>)</span><br><span class="line">               .sum(<span class="number">1</span>);</span><br><span class="line">       result.print();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFlatMapper</span> <span class="keyword">implements</span> <span class="title">FlatMapFunction</span>&lt;<span class="title">String</span>, <span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatMap</span><span class="params">(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector)</span> </span>&#123;</span><br><span class="line">           <span class="comment">// é¦–å…ˆæŒ‰ç…§ç©ºæ ¼åˆ†è¯</span></span><br><span class="line">           String[] words = s.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">           <span class="comment">// éå†æ‰€æœ‰çš„word åŒ…è£…æˆäºŒå…ƒç»„è¾“å‡º</span></span><br><span class="line">           <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">               collector.collect(<span class="keyword">new</span> Tuple2&lt;String, Integer&gt;(word, <span class="number">1</span>));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‡†å¤‡æ•°æ®æºæ–‡ä»¶"><a href="#å‡†å¤‡æ•°æ®æºæ–‡ä»¶" class="headerlink" title="å‡†å¤‡æ•°æ®æºæ–‡ä»¶"></a>å‡†å¤‡æ•°æ®æºæ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hello spark</span><br><span class="line">hello world</span><br><span class="line">hello java</span><br><span class="line">hello flink</span><br><span class="line">how are you</span><br><span class="line">what is your name</span><br></pre></td></tr></table></figure>

<h3 id="æ‰§è¡Œç»“æœ"><a href="#æ‰§è¡Œç»“æœ" class="headerlink" title="æ‰§è¡Œç»“æœ"></a>æ‰§è¡Œç»“æœ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(is,1)</span><br><span class="line">(what,1)</span><br><span class="line">(you,1)</span><br><span class="line">(flink,1)</span><br><span class="line">(name,1)</span><br><span class="line">(world,1)</span><br><span class="line">(hello,4)</span><br><span class="line">(your,1)</span><br><span class="line">(are,1)</span><br><span class="line">(java,1)</span><br><span class="line">(how,1)</span><br><span class="line">(spark,1)</span><br></pre></td></tr></table></figure>




<h2 id="flink-å¤„ç†æµå¼æ•°æ®"><a href="#flink-å¤„ç†æµå¼æ•°æ®" class="headerlink" title="flink å¤„ç†æµå¼æ•°æ®"></a>flink å¤„ç†æµå¼æ•°æ®</h2><p>1ã€é€šè¿‡ <code>nc -lk &lt;port&gt;</code> æ‰“å¼€ä¸€ä¸ªsocketæœåŠ¡ï¼Œç›‘å¬7777ç«¯å£ ç”¨äºæ¨¡æ‹Ÿå®æ—¶çš„æµæ•°æ®</p>
<p>2ã€javaä»£ç å¤„ç†æµå¼æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamWordCount</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ï¼Œé»˜è®¤å€¼ = å½“å‰è®¡ç®—æœºçš„CPUé€»è¾‘æ ¸æ•°ï¼ˆè®¾ç½®æˆ1å³å•çº¿ç¨‹å¤„ç†ï¼‰</span></span><br><span class="line">        <span class="comment">// env.setMaxParallelism(32);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        String inputPath = &quot;/tmp/Flink_Tutorial/src/main/resources/hello.txt&quot;;</span></span><br><span class="line"><span class="comment">//        DataStream&lt;String&gt; inputDataStream = env.readTextFile(inputPath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»socketæ–‡æœ¬æµè¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputDataStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®—</span></span><br><span class="line">        DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(<span class="keyword">new</span> WordCount.MyFlatMapper())</span><br><span class="line">                .keyBy(<span class="number">0</span>)</span><br><span class="line">                .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€åœ¨ç»ˆç«¯æ•°æ®æ•°æ®ï¼Œå¦‚ä¸‹ï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-cca0ffbec5b010a4be539bab681d7276234.png" width="500" height="300">  

<p>4ã€åœ¨é¦–æ¬¡å¯åŠ¨çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé”™è¯¯ âŒ<br><code>Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/flink/streaming/api/datastream/DataStream</code><br>å¤„ç†æ–¹æ³•å¯å‚ç…§ å‚è€ƒèµ„æ–™ ğŸ‘‡</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/VIP099/article/details/106457522">Exception in thread â€œmainâ€ java.lang.NoClassDefFoundError è§£å†³æ–¹æ¡ˆ</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Apache Flink</category>
      </categories>
      <tags>
        <tag>flink</tag>
      </tags>
  </entry>
  <entry>
    <title>Flink è¿è¡Œæ—¶æ¶æ„</title>
    <url>/wiki/flink%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9E%B6%E6%9E%84/</url>
    <content><![CDATA[<h2 id="Flinkè¿è¡Œæ—¶ç»„ä»¶"><a href="#Flinkè¿è¡Œæ—¶ç»„ä»¶" class="headerlink" title="Flinkè¿è¡Œæ—¶ç»„ä»¶"></a>Flinkè¿è¡Œæ—¶ç»„ä»¶</h2><ol>
<li><p>JobManager (ä½œä¸šç®¡ç†å™¨)<br>JobManager å…·æœ‰è®¸å¤šä¸åè°ƒ Flink åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼æ‰§è¡Œæœ‰å…³çš„èŒè´£ï¼šå®ƒå†³å®šä½•æ—¶è°ƒåº¦ä¸‹ä¸€ä¸ª taskï¼ˆæˆ–ä¸€ç»„ taskï¼‰ã€å¯¹å®Œæˆçš„ task æˆ–æ‰§è¡Œå¤±è´¥åšå‡ºååº”ã€åè°ƒ checkpointã€å¹¶ä¸”åè°ƒä»å¤±è´¥ä¸­æ¢å¤ç­‰ç­‰ã€‚è¿™ä¸ªè¿›ç¨‹ç”±ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ç»„æˆï¼š</p>
<ul>
<li><p><code>ResourceManager</code><br>ResourceManager è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºæä¾›ã€å›æ”¶ã€åˆ†é… - å®ƒç®¡ç† <code>task slots</code>ï¼Œè¿™æ˜¯ Flink é›†ç¾¤ä¸­èµ„æºè°ƒåº¦çš„å•ä½ã€‚Flink ä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºæä¾›è€…ï¼ˆä¾‹å¦‚ YARNã€Mesosã€Kubernetes å’Œ standalone éƒ¨ç½²ï¼‰å®ç°äº†å¯¹åº”çš„ <code>ResourceManager</code>ã€‚åœ¨ standalone è®¾ç½®ä¸­ï¼ŒResourceManager åªèƒ½åˆ†é…å¯ç”¨ TaskManager çš„ slotsï¼Œè€Œä¸èƒ½è‡ªè¡Œå¯åŠ¨æ–°çš„ TaskManagerã€‚</p>
</li>
<li><p><code>Dispatcher</code><br>Dispatcher æä¾›äº†ä¸€ä¸ª <code>REST</code> æ¥å£ï¼Œç”¨æ¥æäº¤ Flink åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ <code>JobMaster</code>ã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI ç”¨æ¥æä¾›ä½œä¸šæ‰§è¡Œä¿¡æ¯ã€‚</p>
</li>
<li><p><code>JobMaster</code><br><code>JobMaster</code> è´Ÿè´£ç®¡ç†å•ä¸ª <code>JobGraph</code> çš„æ‰§è¡Œã€‚Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ <code>JobMasterã€‚</code><br>å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ª <code>JobManager</code>ã€‚é«˜å¯ç”¨ï¼ˆHAï¼‰è®¾ç½®ä¸­å¯èƒ½æœ‰å¤šä¸ª <code>JobManager</code>ï¼Œå…¶ä¸­ä¸€ä¸ªå§‹ç»ˆæ˜¯ leaderï¼Œå…¶ä»–çš„åˆ™æ˜¯ <code>standby</code>ã€‚</p>
</li>
</ul>
</li>
<li><p>TaskManager ï¼ˆä»»åŠ¡ç®¡ç†å™¨ï¼‰</p>
</li>
</ol>
<ul>
<li><p>Flinkä¸­çš„å·¥ä½œè¿›ç¨‹ï¼Œé€šå¸¸åœ¨flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œæ¯ä¸€ä¸ªTaskMaganeréƒ½åŒ…å«ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰. æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼›</p>
</li>
<li><p>å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œä»–çš„æ’æ§½ï¼Œæ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ï¼ŒJobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº†</p>
</li>
<li><p>åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶ä»–è¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManageräº¤æ¢æ•°æ®ã€‚</p>
</li>
</ul>
<h2 id="ä»»åŠ¡æäº¤æµç¨‹"><a href="#ä»»åŠ¡æäº¤æµç¨‹" class="headerlink" title="ä»»åŠ¡æäº¤æµç¨‹"></a>ä»»åŠ¡æäº¤æµç¨‹</h2><img src="https://oscimg.oschina.net/oscnet/up-89cc1f4eb3aa51db738324a144a29b91db1.png" width=760 height=500>

<h2 id="ä»»åŠ¡è°ƒåº¦åŸç†"><a href="#ä»»åŠ¡è°ƒåº¦åŸç†" class="headerlink" title="ä»»åŠ¡è°ƒåº¦åŸç†"></a>ä»»åŠ¡è°ƒåº¦åŸç†</h2><p>Flink è¿è¡Œæ—¶ç”±ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ç»„æˆï¼šä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–è€…å¤šä¸ª TaskManagerã€‚</p>
<img src="https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/processes.svg" width=760 height=500> 

<p>Client ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”¨äºå‡†å¤‡æ•°æ®æµå¹¶å°†å…¶å‘é€ç»™ JobManagerã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥ï¼ˆåˆ†ç¦»æ¨¡å¼ï¼‰ï¼Œæˆ–ä¿æŒè¿æ¥æ¥æ¥æ”¶è¿›ç¨‹æŠ¥å‘Šï¼ˆé™„åŠ æ¨¡å¼ï¼‰ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½œä¸ºè§¦å‘æ‰§è¡Œ Java/Scala ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›ç¨‹./bin/flink run â€¦ä¸­è¿è¡Œã€‚</p>
<p>å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ JobManager å’Œ TaskManagerï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºstandalone é›†ç¾¤å¯åŠ¨ã€åœ¨å®¹å™¨ä¸­å¯åŠ¨ã€æˆ–è€…é€šè¿‡YARNæˆ–Mesosç­‰èµ„æºæ¡†æ¶ç®¡ç†å¹¶å¯åŠ¨ã€‚TaskManager è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚</p>
<h2 id="æ€è€ƒé—®é¢˜ğŸ¤”"><a href="#æ€è€ƒé—®é¢˜ğŸ¤”" class="headerlink" title="æ€è€ƒé—®é¢˜ğŸ¤”"></a>æ€è€ƒé—®é¢˜ğŸ¤”</h2><blockquote>
<ul>
<li>æ€æ ·å®ç°å¹¶è¡Œè®¡ç®—ï¼Ÿ å¤šçº¿ç¨‹</li>
<li>å¹¶è¡Œçš„ä»»åŠ¡ï¼Œéœ€è¦å ç”¨å¤šå°‘soltï¼Ÿ</li>
<li>ä¸€ä¸ªæµå¤„ç†ç¨‹åºï¼Œåˆ°åº•åŒ…å«å¤šå°‘ä¸ªä»»åŠ¡ï¼Ÿ</li>
</ul>
</blockquote>
<h1 id="Tasks-å’Œç®—å­é“¾"><a href="#Tasks-å’Œç®—å­é“¾" class="headerlink" title="Tasks å’Œç®—å­é“¾"></a>Tasks å’Œç®—å­é“¾</h1><p><code>å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰</code></p>
<p>ä¸€ä¸ªç‰¹å®šç®—å­çš„å­ä»»åŠ¡ï¼ˆsubtaskï¼‰çš„ä¸ªæ•°è¢«ç§°ä¹‹ä¸ºå¹¶è¡Œåº¦ï¼› ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªStreamçš„å¹¶è¡Œåº¦å°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦ã€‚<br>æ•´ä¸ªæµä¹Ÿæœ‰ä¸€ä¸ªå¹¶è¡Œåº¦ï¼Œå°±æ˜¯æ‰€æœ‰ç®—å­æ‰€æœ‰ä»»åŠ¡çš„å¹¶è¡Œåº¦ä¹‹å’Œï¼›<br>å¯¹äºåˆ†å¸ƒå¼æ‰§è¡Œï¼ŒFlink å°†ç®—å­çš„ subtasks é“¾æ¥æˆ tasksã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†ç®—å­é“¾æ¥æˆ task æ˜¯ä¸ªæœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢ã€ç¼“å†²çš„å¼€é”€ï¼Œå¹¶ä¸”å‡å°‘å»¶è¿Ÿçš„åŒæ—¶å¢åŠ æ•´ä½“ååé‡ã€‚é“¾è¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ï¼›è¯·å‚è€ƒé“¾æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚<br><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/tasks_chains.svg" width=760 height=500></p>
<h2 id="TaskManager-å’Œ-Slots"><a href="#TaskManager-å’Œ-Slots" class="headerlink" title="TaskManager å’Œ Slots"></a>TaskManager å’Œ Slots</h2><img src='https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/tasks_slots.svg' width=800 height=380>]]></content>
      <categories>
        <category>Apache Flink</category>
      </categories>
      <tags>
        <tag>flink</tag>
      </tags>
  </entry>
  <entry>
    <title>gitå¸¸ç”¨å‘½ä»¤</title>
    <url>/wiki/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"><a href="#åˆå§‹åŒ–æœ¬åœ°ä»“åº“" class="headerlink" title="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"></a>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</h2><p><code>git init </code><br><code>git add .</code><br><code>git commit -m &lt;message&gt;</code><br><code>git remote add &lt;name&gt; &lt;url&gt;</code><br><code>git push</code><br><code>git push &lt;name&gt;</code><br><code>git push --set-upstream &lt;name&gt; &lt;branch&gt;</code></p>
<h2 id="æ‰¹é‡åˆ é™¤åˆ†æ”¯"><a href="#æ‰¹é‡åˆ é™¤åˆ†æ”¯" class="headerlink" title="æ‰¹é‡åˆ é™¤åˆ†æ”¯"></a>æ‰¹é‡åˆ é™¤åˆ†æ”¯</h2><p>è¿œç¨‹ï¼š<code>git branch -r| grep &#39;ss-1&#39; | sed &#39;s/origin\///g&#39; | xargs -I &#123;&#125; git push origin :&#123;&#125;</code><br>æœ¬åœ°ï¼š<code>git branch -a | grep &#39;feature-re-1&#39; | xargs git branch -D</code></p>
]]></content>
      <categories>
        <category>Develop Tools</category>
        <category>Git</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>hutoolå¯¼å‡ºexcel</title>
    <url>/wiki/hutool%E5%AF%BC%E5%87%BAexcel/</url>
    <content><![CDATA[<blockquote>
<p>å¦‚æœä½ ä»…éœ€ä¸€ä¸ªJavaå¯¼å‡ºexcelçš„å·¥å…·ï¼ŒğŸ‘‡å°±å¯ä»¥æ»¡è¶³ä½ çš„ä¸´æ—¶éœ€æ±‚ï¼Œå½“ç„¶ä»£ç ä¸‹é¢è¿™ä¹ˆå†™è‚¯å®šæ˜¯ä¸è§„èŒƒçš„ï¼Œå¯ä»¥ç¨åå®Œå–„ï¼</p>
</blockquote>
<h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ•°æ®ç±»"><a href="#æ•°æ®ç±»" class="headerlink" title="æ•°æ®ç±»"></a>æ•°æ®ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IPData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Exportæ–¹æ³•ç¤ºä¾‹"><a href="#Exportæ–¹æ³•ç¤ºä¾‹" class="headerlink" title="Exportæ–¹æ³•ç¤ºä¾‹"></a>Exportæ–¹æ³•ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">export</span><span class="params">(List&lt;IPData&gt; rows)</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">       ExcelWriter writer = ExcelUtil.getWriter(<span class="keyword">true</span>);</span><br><span class="line">       writer.renameSheet(<span class="string">&quot;æ‰€æœ‰æ•°æ®&quot;</span>);     <span class="comment">//ç”šè‡³sheetçš„åç§°</span></span><br><span class="line">       writer.addHeaderAlias(<span class="string">&quot;ip&quot;</span>, <span class="string">&quot;IP&quot;</span>);</span><br><span class="line">       writer.write(rows, <span class="keyword">true</span>);</span><br><span class="line">       writer.setOnlyAlias(<span class="keyword">true</span>);</span><br><span class="line">       FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;/Users/gaolei/Desktop/IP1.xlsx&quot;</span>);</span><br><span class="line">       writer.flush(fileOutputStream);</span><br><span class="line">       writer.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>httpsåè®®</title>
    <url>/wiki/https%E5%8D%8F%E8%AE%AE/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/26690712">ã€Š HTTPS å‡çº§æŒ‡å— ã€‹ æ·±å…¥ç†è§£ HTTPS åŸç†ã€è¿‡ç¨‹ä¸å®è·µ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/62246556">HTTPSå®ç°åŸç†</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/26682342">æ·±å…¥ç†è§£HTTPSåŸç†ã€è¿‡ç¨‹ä¸å®è·µ</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>HTTP</category>
      </categories>
      <tags>
        <tag>http</tag>
      </tags>
  </entry>
  <entry>
    <title>Welcome to GeekIBLi</title>
    <url>/wiki/index/</url>
    <content><![CDATA[<h2 id="é“é˜»-ä¸”é•¿"><a href="#é“é˜»-ä¸”é•¿" class="headerlink" title="é“é˜» ä¸”é•¿"></a>é“é˜» ä¸”é•¿</h2><h2 id="ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨è"><a href="#ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨è" class="headerlink" title="ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨è"></a>ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨è</h2><blockquote>
<p><a href="https://e.juejin.cn/">æ˜é‡‘ åšå®¢</a><br><a href="https://www.codingdict.com/">https://www.codingdict.com/</a><br><a href="https://time.geekbang.org/">æå®¢æ—¶é—´</a><br><a href="https://ashiamd.github.io/docsify-notes/#/README">ashiamd.github.io</a><br><a href="https://www.slidestalk.com/">ç¤ºè¯´</a> ã€Œ æä¾›äº†å¾ˆå¤šä¼˜è´¨çš„PPT è¿˜æœ‰å¾ˆå¤šå¤§å‚çš„æ²™é¾™è§†å±ä»¥åŠææ–™ã€<br><a href="https://bytedance.feishu.cn/base/appwBhd98QJ9cpMggHc5QMVHlfd">å­—èŠ‚è·³åŠ¨åç«¯é¢è¯•é¢˜é›†</a><br><a href="https://www.zhihu.com/column/c_1155449617721315328">çŸ¥ä¹ Javaå¿«é€Ÿè¿›é˜¶é€šé“</a><br><a href="https://hollischuang.github.io/toBeTopJavaer/#/">To Be Top Javaer - Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯</a><br><a href="https://blog.div-wang.com/">Div-wang</a></p>
</blockquote>
<h2 id="æŠ€æœ¯å›¢é˜Ÿæ¨è"><a href="#æŠ€æœ¯å›¢é˜Ÿæ¨è" class="headerlink" title="æŠ€æœ¯å›¢é˜Ÿæ¨è"></a>æŠ€æœ¯å›¢é˜Ÿæ¨è</h2><blockquote>
<p><a href="https://xiaomi-info.github.io/">å°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿ</a><br><a href="https://tech.youzan.com/">æœ‰èµæŠ€æœ¯å›¢é˜Ÿ</a><br><a href="https://tech.meituan.com/">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a></p>
</blockquote>
<h2 id="é¢è¯•é¢˜åˆé›†"><a href="#é¢è¯•é¢˜åˆé›†" class="headerlink" title="é¢è¯•é¢˜åˆé›†"></a>é¢è¯•é¢˜åˆé›†</h2><blockquote>
<p><a href="https://juejin.cn/post/6844904096957218823">2020å¹´å¤§å‚Javaé¢è¯•å‰å¤ä¹ çš„æ­£ç¡®å§¿åŠ¿ï¼ˆ800+é¢è¯•é¢˜é™„ç­”æ¡ˆè§£æï¼‰</a><br><a href="https://juejin.cn/post/6844904125939843079">Javaé›†åˆé¢è¯•é¢˜ï¼ˆæ€»ç»“æœ€å…¨é¢çš„é¢è¯•é¢˜ï¼‰</a></p>
</blockquote>
<p><b> ä¸¤å¹´å­¦è¯´è¯ ä¸€ç”Ÿå­¦é—­å˜´ </b></p>
]]></content>
      <categories>
        <category>Overview</category>
      </categories>
  </entry>
  <entry>
    <title>kafka-overview</title>
    <url>/wiki/kafka-overview/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/hellozpc/article/details/105680217">kafkaè¯¦ç»†æ•™ç¨‹</a></li>
<li><a href="http://download.kafka-eagle.org/">Kafka é›†ç¾¤ç®¡ç†</a></li>
<li><a href="https://www.orchome.com/kafka/index">OrcHome kafkaä¸­æ–‡æ•™ç¨‹</a></li>
<li><a href="https://juejin.cn/post/6847902220667748359">é¢è¯•å®˜ï¼šè¯´è¯´Kafkaå¤„ç†è¯·æ±‚çš„å…¨æµç¨‹</a></li>
<li><a href="https://juejin.cn/post/6844904046340341768">è˜‘è‡è¡—åƒäº¿çº§æ¶ˆæ¯Kafkaä¸Šäº‘å®è·µ</a></li>
<li><a href="https://www.imooc.com/article/262018">kafka é›†ç¾¤æ­å»º</a></li>
<li><a href="https://wiki.eryajf.net/pages/2953.html">kafka-2-11é›†ç¾¤éƒ¨ç½²</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Distributed Dir</category>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaå®‰è£…ä¸åˆä½“éªŒ</title>
    <url>/wiki/kafka%E5%AE%89%E8%A3%85%E4%B8%8E%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
    <content><![CDATA[<h2 id="Kafkaçš„å®‰è£…"><a href="#Kafkaçš„å®‰è£…" class="headerlink" title="Kafkaçš„å®‰è£…"></a>Kafkaçš„å®‰è£…</h2><h3 id="å®‰è£…zookeeper"><a href="#å®‰è£…zookeeper" class="headerlink" title="å®‰è£…zookeeper"></a>å®‰è£…zookeeper</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install zookeeper</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ç«¯å£ï¼š2181<br>é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/local/Cellar/zookeeper<br>é…ç½®æ–‡ä»¶ä½ç½®ï¼š/usr/local/etc/zookeeper<br>æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/usr/local/var/log/zookeeper/zookeeper.log  </p>
<h3 id="å¯åŠ¨zookeeper"><a href="#å¯åŠ¨zookeeper" class="headerlink" title="å¯åŠ¨zookeeper"></a>å¯åŠ¨zookeeper</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nohup zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties &amp;</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/up-d339f3f26756d950d6099483c5d033619bd.png"></p>
<h3 id="å®‰è£…Kafka"><a href="#å®‰è£…Kafka" class="headerlink" title="å®‰è£…Kafka"></a>å®‰è£…Kafka</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install kafka</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ç«¯å£ï¼š9092<br>é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/local/Cellar/kafka<br>é…ç½®æ–‡ä»¶ä½ç½®ï¼š/usr/local/etc/kafka<br>æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/usr/local/var/lib/kafka-logs  </p>
<h3 id="å¯åŠ¨kafka"><a href="#å¯åŠ¨kafka" class="headerlink" title="å¯åŠ¨kafka"></a>å¯åŠ¨kafka</h3><p>nohup kafka-server-start /usr/local/etc/kafka/server.properties &amp;<br><img src="https://oscimg.oschina.net/oscnet/up-6dcc2cdd724f403f0a5f1af44448cb5c523.png"></p>
<h2 id="è®¢é˜…å‘å¸ƒDemo"><a href="#è®¢é˜…å‘å¸ƒDemo" class="headerlink" title="è®¢é˜…å‘å¸ƒDemo"></a>è®¢é˜…å‘å¸ƒDemo</h2><h3 id="åˆ›å»ºä¸€ä¸ªTopic"><a href="#åˆ›å»ºä¸€ä¸ªTopic" class="headerlink" title="åˆ›å»ºä¸€ä¸ªTopic"></a>åˆ›å»ºä¸€ä¸ªTopic</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹åˆ›å»ºçš„Topic"><a href="#æŸ¥çœ‹åˆ›å»ºçš„Topic" class="headerlink" title="æŸ¥çœ‹åˆ›å»ºçš„Topic"></a>æŸ¥çœ‹åˆ›å»ºçš„Topic</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-topics --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯"><a href="#ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯" class="headerlink" title="ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯"></a>ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-console-producer --broker-list localhost:9092 --topic test</span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯"><a href="#æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯" class="headerlink" title="æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯"></a>æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic test1 --from-beginning</span><br></pre></td></tr></table></figure>
<p>â€“from-beginning: å°†ä»ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹æ¥æ”¶</p>
<h2 id="SpringBooté›†æˆKafka"><a href="#SpringBooté›†æˆKafka" class="headerlink" title="SpringBooté›†æˆKafka"></a>SpringBooté›†æˆKafka</h2><p><strong>æºç åœ°å€ï¼š<a href="https://gitee.com/IBLiplus/kafka-demo.git">https://gitee.com/IBLiplus/kafka-demo.git</a></strong><br>é¡¹ç›®å¯åŠ¨å‰æŒ‰ç…§ä¸Šè¿°å®‰è£…å¯åŠ¨æ­¥éª¤ï¼Œåœ¨æœ¬åœ°å¯åŠ¨kafka.<br>åˆ›å»ºMavené¡¹ç›®ï¼Œå¼•å…¥ä¸€ä¸‹ä¾èµ–  </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œç«¯å£å·å¯ä»¥è‡ªå·±å®š<br>é…ç½®æ–‡ä»¶ï¼š  </p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">server.port=9010</span></span><br><span class="line"><span class="string">spring.kafka.bootstrap-servers=</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span></span><br><span class="line"><span class="comment"># å‘ç”Ÿé”™è¯¯åï¼Œæ¶ˆæ¯é‡å‘çš„æ¬¡æ•°ã€‚</span></span><br><span class="line"><span class="string">spring.kafka.producer.retries=</span> <span class="number">0</span></span><br><span class="line"><span class="comment">#å½“æœ‰å¤šä¸ªæ¶ˆæ¯éœ€è¦è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œç”Ÿäº§è€…ä¼šæŠŠå®ƒä»¬æ”¾åœ¨åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œã€‚è¯¥å‚æ•°æŒ‡å®šäº†ä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ŒæŒ‰ç…§å­—èŠ‚æ•°è®¡ç®—ã€‚</span></span><br><span class="line"><span class="string">spring.kafka.producer.batch-size=</span> <span class="number">16384</span></span><br><span class="line"><span class="comment"># è®¾ç½®ç”Ÿäº§è€…å†…å­˜ç¼“å†²åŒºçš„å¤§å°ã€‚</span></span><br><span class="line"><span class="string">spring.kafka.producer.buffer-memory=</span> <span class="number">33554432</span></span><br><span class="line"><span class="comment"># é”®çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line"><span class="string">spring.kafka.producer.key-serializer=</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line"><span class="comment"># å€¼çš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line"><span class="string">spring.kafka.producer.value-serializer</span> <span class="string">=</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line"><span class="comment"># acks=0 ï¼š ç”Ÿäº§è€…åœ¨æˆåŠŸå†™å…¥æ¶ˆæ¯ä¹‹å‰ä¸ä¼šç­‰å¾…ä»»ä½•æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚</span></span><br><span class="line"><span class="comment"># acks=1 ï¼š åªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨æˆåŠŸå“åº”ã€‚</span></span><br><span class="line"><span class="comment"># acks=all ï¼šåªæœ‰å½“æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹å…¨éƒ¨æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ‰ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº”ã€‚</span></span><br><span class="line"><span class="string">spring.kafka.producer.acks=</span> <span class="number">1</span></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš” åœ¨spring boot 2.X ç‰ˆæœ¬ä¸­è¿™é‡Œé‡‡ç”¨çš„æ˜¯å€¼çš„ç±»å‹ä¸ºDuration éœ€è¦ç¬¦åˆç‰¹å®šçš„æ ¼å¼ï¼Œå¦‚1S,1M,2H,5D</span></span><br><span class="line"><span class="string">spring.kafka.consumer.auto-commit-interval=</span> <span class="string">1S</span></span><br><span class="line"><span class="comment"># è¯¥å±æ€§æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹è¯¥ä½œä½•å¤„ç†ï¼š</span></span><br><span class="line"><span class="comment"># latestï¼ˆé»˜è®¤å€¼ï¼‰åœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–æ•°æ®ï¼ˆåœ¨æ¶ˆè´¹è€…å¯åŠ¨ä¹‹åç”Ÿæˆçš„è®°å½•ï¼‰</span></span><br><span class="line"><span class="comment"># earliest ï¼šåœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»èµ·å§‹ä½ç½®è¯»å–åˆ†åŒºçš„è®°å½•</span></span><br><span class="line"><span class="string">spring.kafka.consumer.auto-offset-reset=</span> <span class="string">earliest</span></span><br><span class="line"><span class="comment"># æ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤å€¼æ˜¯true,ä¸ºäº†é¿å…å‡ºç°é‡å¤æ•°æ®å’Œæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºfalse,ç„¶åæ‰‹åŠ¨æäº¤åç§»é‡</span></span><br><span class="line"><span class="string">spring.kafka.consumer.enable-auto-commit=</span> <span class="literal">false</span></span><br><span class="line"><span class="comment"># é”®çš„ååºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line"><span class="string">spring.kafka.consumer.key-deserializer=</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line"><span class="comment"># å€¼çš„ååºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line"><span class="string">spring.kafka.consumer.value-deserializer=</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line"><span class="comment"># åœ¨ä¾¦å¬å™¨å®¹å™¨ä¸­è¿è¡Œçš„çº¿ç¨‹æ•°ã€‚</span></span><br><span class="line"><span class="string">spring.kafka.listener.concurrency=</span> <span class="number">5</span></span><br><span class="line"><span class="comment">#listnerè´Ÿè´£ackï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±ç«‹å³commit</span></span><br><span class="line"><span class="string">spring.kafka.listener.ack-mode=</span> <span class="string">manual_immediate</span></span><br><span class="line"><span class="string">spring.kafka.listener.missing-topics-fatal=</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDemo</span> </span>&#123;</span><br><span class="line">    Logger log = LoggerFactory.getLogger(ProductDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> KafkaTemplate&lt;String, Object&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰topic</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_TEST = <span class="string">&quot;topic.test&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_GROUP1 = <span class="string">&quot;topic.group1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPIC_GROUP2 = <span class="string">&quot;topic.group2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String obj)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å‡†å¤‡å‘é€æ¶ˆæ¯ä¸ºï¼š&#123;&#125;&quot;</span>, obj);</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">        ListenableFuture&lt;SendResult&lt;String, Object&gt;&gt; future = kafkaTemplate.send(TOPIC_TEST, obj);</span><br><span class="line">        future.addCallback(<span class="keyword">new</span> ListenableFutureCallback&lt;SendResult&lt;String, Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//å‘é€å¤±è´¥çš„å¤„ç†</span></span><br><span class="line">                log.info(TOPIC_TEST + <span class="string">&quot; - ç”Ÿäº§è€… å‘é€æ¶ˆæ¯å¤±è´¥ï¼š&quot;</span> + throwable.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(SendResult&lt;String, Object&gt; stringObjectSendResult)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//æˆåŠŸçš„å¤„ç†</span></span><br><span class="line">                log.info(TOPIC_TEST + <span class="string">&quot; - ç”Ÿäº§è€… å‘é€æ¶ˆæ¯æˆåŠŸï¼š&quot;</span> + stringObjectSendResult.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¶ˆè´¹æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerDemo</span> </span>&#123;</span><br><span class="line">    Logger log = LoggerFactory.getLogger(ConsumerDemo.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = ProductDemo.TOPIC_TEST, groupId = ProductDemo.TOPIC_GROUP1)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">topic_test</span><span class="params">(ConsumerRecord&lt;?, ?&gt; record, Acknowledgment ack, <span class="meta">@Header(KafkaHeaders.RECEIVED_TOPIC)</span> String topic)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Optional message = Optional.ofNullable(record.value());</span><br><span class="line">        <span class="keyword">if</span> (message.isPresent()) &#123;</span><br><span class="line">            Object msg = message.get();</span><br><span class="line">            log.info(<span class="string">&quot;topic_test æ¶ˆè´¹äº†ï¼š Topic:&quot;</span> + topic + <span class="string">&quot;,Message:&quot;</span> + msg);</span><br><span class="line">            ack.acknowledge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = ProductDemo.TOPIC_TEST, groupId = ProductDemo.TOPIC_GROUP2)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">topic_test1</span><span class="params">(ConsumerRecord&lt;?, ?&gt; record, Acknowledgment ack, <span class="meta">@Header(KafkaHeaders.RECEIVED_TOPIC)</span> String topic)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Optional message = Optional.ofNullable(record.value());</span><br><span class="line">        <span class="keyword">if</span> (message.isPresent()) &#123;</span><br><span class="line">            Object msg = message.get();</span><br><span class="line">            log.info(<span class="string">&quot;topic_test1 æ¶ˆè´¹äº†ï¼š Topic:&quot;</span> + topic + <span class="string">&quot;,Message:&quot;</span> + msg);</span><br><span class="line">            ack.acknowledge();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Resource</span><br><span class="line">private ProductDemo productDemo;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/kafka/test&quot;)</span><br><span class="line">public void testKafka()&#123;</span><br><span class="line">    logger.info(&quot;start test&quot;);</span><br><span class="line">    productDemo.send(&quot;hello kafka&quot;);</span><br><span class="line">    logger.info(&quot;end test&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p align="middle">å±±è„šå¤ªæ‹¥æŒ¤ æˆ‘ä»¬æ›´é«˜å¤„è§ã€‚</p></blockquote>
]]></content>
      <categories>
        <category>Distributed Dir</category>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>kibanaæ·»åŠ ç”¨æˆ·åŠæ§åˆ¶æƒé™</title>
    <url>/wiki/kibana%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%8F%8A%E6%8E%A7%E5%88%B6%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<blockquote>
<p>æ“ä½œæ­¥éª¤ï¼š ã€ä¿®æ”¹elasticsearché…ç½®æ–‡ä»¶ã€‘ -&gt; ã€é‡å¯elasticsearchã€‘ -&gt; ã€åˆå§‹åŒ–è´¦å·&amp;å¯†ç ã€‘ -&gt; ã€ä¿®æ”¹kibanaé…ç½®æ–‡ä»¶ã€‘ -&gt; ã€é‡å¯kibanaã€‘ -&gt; ã€åˆå§‹è´¦å·ç™»å½•kibanaã€‘ -&gt; ã€åˆ›å»ºã€é…ç½®è§’è‰²ã€‘ -&gt; ã€åˆ›å»ºæ–°ç”¨æˆ·ã€‘</p>
</blockquote>
<h2 id="é…ç½®elasticsearch"><a href="#é…ç½®elasticsearch" class="headerlink" title="é…ç½®elasticsearch"></a>é…ç½®elasticsearch</h2><p>å¼€å¯è‡ªå¸¦çš„xpackçš„éªŒè¯åŠŸèƒ½<br><code>xpack.security.enabled: true</code></p>
<p>é…ç½®å•èŠ‚ç‚¹æ¨¡å¼<br><code>discovery.type: single-node</code></p>
<h3 id="å‘1-é›†ç¾¤èŠ‚ç‚¹é…ç½®æŠ¥é”™"><a href="#å‘1-é›†ç¾¤èŠ‚ç‚¹é…ç½®æŠ¥é”™" class="headerlink" title="å‘1: é›†ç¾¤èŠ‚ç‚¹é…ç½®æŠ¥é”™"></a>å‘1: é›†ç¾¤èŠ‚ç‚¹é…ç½®æŠ¥é”™</h3><p><code>cluster.initial_master_nodes</code></p>
<h3 id="å‘2-æœ¬æ¬¡å­˜å‚¨èŠ‚ç‚¹é…ç½®æŠ¥é”™"><a href="#å‘2-æœ¬æ¬¡å­˜å‚¨èŠ‚ç‚¹é…ç½®æŠ¥é”™" class="headerlink" title="å‘2: æœ¬æ¬¡å­˜å‚¨èŠ‚ç‚¹é…ç½®æŠ¥é”™"></a>å‘2: æœ¬æ¬¡å­˜å‚¨èŠ‚ç‚¹é…ç½®æŠ¥é”™</h3><p>maybe these locations are not writable or multiple nodes were started without increasing [node.max_local_storage_nodes] (was [1])?<br><code>node.max_local_storage_nodes: 2</code></p>
<h2 id="ä¸ºå†…ç½®è´¦å·è®¾ç½®å¯†ç "><a href="#ä¸ºå†…ç½®è´¦å·è®¾ç½®å¯†ç " class="headerlink" title="ä¸ºå†…ç½®è´¦å·è®¾ç½®å¯†ç "></a>ä¸ºå†…ç½®è´¦å·è®¾ç½®å¯†ç </h2><p>åœ¨elasticsearchçš„binä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<br><code>./elasticsearch-setup-passwords interactive</code></p>
<img src="https://oscimg.oschina.net/oscnet/up-2073ba41d73f8d4b16cd39e420ee017f62d.png" width="800" height='480'>


<h2 id="é…ç½®kibana"><a href="#é…ç½®kibana" class="headerlink" title="é…ç½®kibana"></a>é…ç½®kibana</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ä½¿ç”¨åˆå§‹ç”¨æˆ·kibana</span><br><span class="line">elasticsearch.username: &quot;kibana_system&quot;</span><br><span class="line">elasticsearch.password: &quot;å¯†ç &quot;</span><br></pre></td></tr></table></figure>

<p>é‡å¯kibanaä¹‹åä½¿ç”¨åˆå§‹è´¦å· <code>elastic</code> ç™»å½•</p>
<h2 id="åˆ›å»ºã€é…ç½®è§’è‰²"><a href="#åˆ›å»ºã€é…ç½®è§’è‰²" class="headerlink" title="åˆ›å»ºã€é…ç½®è§’è‰²"></a>åˆ›å»ºã€é…ç½®è§’è‰²</h2><img src='https://oscimg.oschina.net/oscnet/up-be2569d2151c190b3f49f2faebae05dd19a.png' width=840 height=750>


<h2 id="åˆ›å»ºæ–°ç”¨æˆ·"><a href="#åˆ›å»ºæ–°ç”¨æˆ·" class="headerlink" title="åˆ›å»ºæ–°ç”¨æˆ·"></a>åˆ›å»ºæ–°ç”¨æˆ·</h2><img src='https://oscimg.oschina.net/oscnet/up-b662c15522750b55863cf006e9c8a9d63c4.png' width=840 height=750>


<h2 id="æŸ¥çœ‹æ–°ç”¨æˆ·è®¿é—®ç•Œé¢"><a href="#æŸ¥çœ‹æ–°ç”¨æˆ·è®¿é—®ç•Œé¢" class="headerlink" title="æŸ¥çœ‹æ–°ç”¨æˆ·è®¿é—®ç•Œé¢"></a>æŸ¥çœ‹æ–°ç”¨æˆ·è®¿é—®ç•Œé¢</h2><p>è§’è‰²é‡Œé¢é…ç½®äº†kibanaçš„è®¿é—®æƒé™ï¼Œåªå¼€é€šäº†discoverå’Œdashboardä¸¤ä¸ªå…¥å£<br><img src='https://oscimg.oschina.net/oscnet/up-3371b430006a3b65cffc8a41f04cb02f423.png' width=800 height=450></p>
<p>ç´¢å¼•çš„è¯ï¼Œæœ‰å¥½å‡ ä¸ªç´¢å¼•ï¼Œä½†æ˜¯åªé…ç½®äº†ä¸€ä¸ªç´¢å¼•çš„æƒé™<br><img src='https://oscimg.oschina.net/oscnet/up-10b5d2b6e179b6c200c691631dd43fc1713.png' width=800 height=450></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/QiaoRui_/article/details/97375237">kibana7.2æ·»åŠ ç™»å½•åŠæƒé™</a></li>
<li><a href="https://www.cnblogs.com/tq1226112215/p/8435127.html">Elasticsearch å®‰è£…</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>most_fieldsç±»å‹</title>
    <url>/wiki/most-fields%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="å¤šå­—æ®µæ˜ å°„"><a href="#å¤šå­—æ®µæ˜ å°„" class="headerlink" title="å¤šå­—æ®µæ˜ å°„"></a>å¤šå­—æ®µæ˜ å°„</h2><p>é¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯å¯¹æˆ‘ä»¬çš„å­—æ®µç´¢å¼•ä¸¤æ¬¡ï¼šä¸€æ¬¡ä½¿ç”¨è¯å¹²æ¨¡å¼ä»¥åŠä¸€æ¬¡éè¯å¹²æ¨¡å¼ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œé‡‡ç”¨ <code>multifields</code> æ¥å®ç°ï¼Œå·²ç»åœ¨ <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/multi-fields.html">multifields</a> æœ‰æ‰€ä»‹ç»ï¼š</p>
<p><code>DELETE /my_index</code>  </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span>: &#123; <span class="attr">&quot;number_of_shards&quot;</span>: <span class="number">1</span> &#125;, </span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;my_type&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;title&quot;</span>: &#123; </span><br><span class="line">                    <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">                    <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;std&quot;</span>:   &#123; </span><br><span class="line">                            <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                            <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>title å­—æ®µä½¿ç”¨ english è‹±è¯­åˆ†æå™¨æ¥æå–è¯å¹²ã€‚</li>
<li>title.std å­—æ®µä½¿ç”¨ standard æ ‡å‡†åˆ†æå™¨ï¼Œæ‰€ä»¥æ²¡æœ‰è¯å¹²æå–ã€‚</li>
</ul>
<p>æ¥ç€ç´¢å¼•ä¸€äº›æ–‡æ¡£ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /my_index/my_type/<span class="number">1</span></span><br><span class="line">&#123; <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;My rabbit jumps&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line">PUT /my_index/my_type/<span class="number">2</span></span><br><span class="line">&#123; <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Jumping jack rabbits&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨ä¸€ä¸ªç®€å• match æŸ¥è¯¢ title æ ‡é¢˜å­—æ®µæ˜¯å¦åŒ…å« jumping rabbits ï¼ˆè·³è·ƒçš„å…”å­ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;jumping rabbits&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæœ‰äº† <code>english</code> åˆ†æå™¨ï¼Œè¿™ä¸ªæŸ¥è¯¢æ˜¯åœ¨æŸ¥æ‰¾ä»¥ jump å’Œ rabbit è¿™ä¸¤ä¸ªè¢«æå–è¯çš„æ–‡æ¡£ã€‚ä¸¤ä¸ªæ–‡æ¡£çš„ title å­—æ®µéƒ½åŒæ—¶åŒ…æ‹¬è¿™ä¸¤ä¸ªè¯ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ–‡æ¡£å¾—åˆ°çš„è¯„åˆ†ä¹Ÿç›¸åŒï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span>: <span class="number">0.42039964</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;My rabbit jumps&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span>: <span class="number">0.42039964</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Jumping jack rabbits&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåªæ˜¯æŸ¥è¯¢ <code>title.std</code> å­—æ®µï¼Œé‚£ä¹ˆåªæœ‰æ–‡æ¡£ 2 æ˜¯åŒ¹é…çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¦‚æœåŒæ—¶æŸ¥è¯¢ä¸¤ä¸ªå­—æ®µï¼Œç„¶åä½¿ç”¨ <code>bool</code> æŸ¥è¯¢å°†è¯„åˆ†ç»“æœ åˆå¹¶ ï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–‡æ¡£éƒ½æ˜¯åŒ¹é…çš„ï¼ˆ <code>title</code> å­—æ®µçš„ä½œç”¨ï¼‰ï¼Œè€Œä¸”æ–‡æ¡£ 2 çš„ç›¸å…³åº¦è¯„åˆ†æ›´é«˜ï¼ˆ <code>title.std</code> å­—æ®µçš„ä½œç”¨ï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>:  <span class="string">&quot;jumping rabbits&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>:   <span class="string">&quot;most_fields&quot;</span>, </span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>: [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;title.std&quot;</span> ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰åŒ¹é…å­—æ®µçš„è¯„åˆ†åˆå¹¶èµ·æ¥ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>most_fields</code> ç±»å‹ã€‚è¿™è®© <code>multi_match</code> æŸ¥è¯¢ç”¨ <code>bool</code> æŸ¥è¯¢å°†ä¸¤ä¸ªå­—æ®µè¯­å¥åŒ…åœ¨é‡Œé¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>dis_max</code> (æœ€ä½³å­—æ®µ) æŸ¥è¯¢ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span>: <span class="number">0.8226396</span>, </span><br><span class="line">        <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;Jumping jack rabbits&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span>: <span class="number">0.10741998</span>, </span><br><span class="line">        <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;My rabbit jumps&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–‡æ¡£ 2 ç°åœ¨çš„è¯„åˆ†è¦æ¯”æ–‡æ¡£ 1 é«˜ã€‚</p>
<p>ç”¨å¹¿åº¦åŒ¹é…å­—æ®µ <code>title</code> åŒ…æ‹¬å°½å¯èƒ½å¤šçš„æ–‡æ¡£â€”â€”ä»¥æå‡å¬å›ç‡â€”â€”åŒæ—¶åˆä½¿ç”¨å­—æ®µ <code>title.std</code> ä½œä¸º ä¿¡å· å°†ç›¸å…³åº¦æ›´é«˜çš„æ–‡æ¡£ç½®äºç»“æœé¡¶éƒ¨ã€‚</p>
<p>æ¯ä¸ªå­—æ®µå¯¹äºæœ€ç»ˆè¯„åˆ†çš„è´¡çŒ®å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å€¼ <code>boost</code> æ¥æ§åˆ¶ã€‚æ¯”å¦‚ï¼Œä½¿ <code>title</code> å­—æ®µæ›´ä¸ºé‡è¦ï¼Œè¿™æ ·åŒæ—¶ä¹Ÿé™ä½äº†å…¶ä»–ä¿¡å·å­—æ®µçš„ä½œç”¨ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>:       <span class="string">&quot;jumping rabbits&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>:        <span class="string">&quot;most_fields&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span>:      [ <span class="string">&quot;title^10&quot;</span>, <span class="string">&quot;title.std&quot;</span> ] </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>title å­—æ®µçš„ boost çš„å€¼ä¸º 10 ä½¿å®ƒæ¯” title.std æ›´é‡è¦ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/most-fields.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» å¤šæ•°å­—æ®µ</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatis-å·¥ä½œåŸç†</title>
    <url>/wiki/mybatis-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="Mybatiså·¥ä½œåŸç†"><a href="#Mybatiså·¥ä½œåŸç†" class="headerlink" title="Mybatiså·¥ä½œåŸç†"></a>Mybatiså·¥ä½œåŸç†</h1><h2 id="Mybatisæ•´ä½“æ¡†æ¶"><a href="#Mybatisæ•´ä½“æ¡†æ¶" class="headerlink" title="Mybatisæ•´ä½“æ¡†æ¶"></a>Mybatisæ•´ä½“æ¡†æ¶</h2><p><img src="https://oscimg.oschina.net/oscnet/up-978b1c01a681073e4a020fdce7703887901.png">  </p>
<h2 id="å·¥ä½œåŸç†è§£æ"><a href="#å·¥ä½œåŸç†è§£æ" class="headerlink" title="å·¥ä½œåŸç†è§£æ"></a>å·¥ä½œåŸç†è§£æ</h2><p><img src="https://oscimg.oschina.net/oscnet/up-0015501b933b36728b8f66f281d78358e97.png">  </p>
<p>1ï¼‰è¯»å–MyBatisé…ç½®æ–‡ä»¶ï¼šmybatis-config.xml ä¸º MyBatis çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé…ç½®äº† MyBatis çš„è¿è¡Œç¯å¢ƒç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚</p>
<blockquote>
<p>è¯»å–é…ç½®æ–‡ä»¶å°†mybatis-config.xmlè½¬æ¢ä¸ºorg.apache.ibatis.session.Configurationç±»ï¼Œè¿™é‡ŒmybatisåŒ…å«9ä¸ªå…¨å±€é…ç½®ï¼›</p>
</blockquote>
<p>2ï¼‰åŠ è½½æ˜ å°„æ–‡ä»¶ã€‚æ˜ å°„æ–‡ä»¶å³ SQL æ˜ å°„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„ SQL è¯­å¥ï¼Œéœ€è¦åœ¨ MyBatis é…ç½®æ–‡ä»¶ mybatis-config.xml ä¸­åŠ è½½ã€‚mybatis-config.xml æ–‡ä»¶å¯ä»¥åŠ è½½å¤šä¸ªæ˜ å°„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚</p>
<blockquote>
<p>æ‰«æMappingç›®å½•ä¸‹çš„***Mapper.xmlæ–‡ä»¶ï¼› </p>
</blockquote>
<p>3ï¼‰æ„é€ ä¼šè¯å·¥å‚ï¼šé€šè¿‡ MyBatis çš„ç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„å»ºä¼šè¯å·¥å‚ SqlSessionFactoryã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Bean(name = &quot;sqlSessionFactory&quot;)</span><br><span class="line">public SqlSessionFactory sqlSessionFactory(HikariDataSource dataSource) throws Exception &#123;</span><br><span class="line">    SqlSessionFactoryBean bean = new SqlSessionFactoryBean();</span><br><span class="line">    bean.setDataSource(dataSource);</span><br><span class="line">    bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:com/****/mapping/**/*.xml&quot;));</span><br><span class="line">    return bean.getObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆå·¥å‚å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlSessionFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">SqlSessionFactory</span>&gt;, <span class="title">InitializingBean</span>, <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationEvent</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log LOGGER = LogFactory.getLog(SqlSessionFactoryBean.class);</span><br><span class="line">    <span class="keyword">private</span> Resource configLocation;</span><br><span class="line">    <span class="keyword">private</span> Configuration configuration;</span><br><span class="line">    <span class="keyword">private</span> Resource[] mapperLocations;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="keyword">private</span> TransactionFactory transactionFactory;</span><br><span class="line">    <span class="keyword">private</span> Properties configurationProperties;</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactoryBuilder sqlSessionFactoryBuilder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">    <span class="keyword">private</span> String environment = SqlSessionFactoryBean.class.getSimpleName();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> failFast;</span><br><span class="line">    <span class="keyword">private</span> Interceptor[] plugins;</span><br><span class="line">    <span class="keyword">private</span> TypeHandler&lt;?&gt;[] typeHandlers;</span><br><span class="line">    <span class="keyword">private</span> String typeHandlersPackage;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt;[] typeAliases;</span><br><span class="line">    <span class="keyword">private</span> String typeAliasesPackage;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt; typeAliasesSuperType;</span><br><span class="line">    <span class="keyword">private</span> DatabaseIdProvider databaseIdProvider;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;? extends VFS&gt; vfs;</span><br><span class="line">    <span class="keyword">private</span> Cache cache;</span><br><span class="line">    <span class="keyword">private</span> ObjectFactory objectFactory;</span><br><span class="line">    <span class="keyword">private</span> ObjectWrapperFactory objectWrapperFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlSessionFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4ï¼‰åˆ›å»ºä¼šè¯å¯¹è±¡ï¼šç”±ä¼šè¯å·¥å‚åˆ›å»º SqlSession å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†æ‰§è¡Œ SQL è¯­å¥çš„æ‰€æœ‰æ–¹æ³•ã€‚</p>
<blockquote>
<p>SqlSessionå¯¹è±¡å®Œæˆå’Œæ•°æ®åº“çš„äº¤äº’ï¼š </p>
</blockquote>
<p>5ï¼‰Executor æ‰§è¡Œå™¨ï¼šMyBatis åº•å±‚å®šä¹‰äº†ä¸€ä¸ª Executor æ¥å£æ¥æ“ä½œæ•°æ®åº“ï¼Œå®ƒå°†æ ¹æ® SqlSession ä¼ é€’çš„å‚æ•°åŠ¨æ€åœ°ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚</p>
<blockquote>
<p>3ç§æ‰§è¡ŒæœŸç±»å‹ï¼ˆSimple Pre Batchï¼‰  Executoræ¥å£æœ‰ä¸¤ä¸ªå®ç°ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬æ‰§è¡Œå™¨ã€ä¸€ä¸ªæ˜¯ç¼“å­˜æ‰§è¡Œå™¨ã€‚</p>
</blockquote>
<p>6ï¼‰MappedStatement å¯¹è±¡ï¼šåœ¨ Executor æ¥å£çš„æ‰§è¡Œæ–¹æ³•ä¸­æœ‰ä¸€ä¸ª MappedStatement ç±»å‹çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹æ˜ å°„ä¿¡æ¯çš„å°è£…ï¼Œç”¨äºå­˜å‚¨è¦æ˜ å°„çš„ SQL è¯­å¥çš„ idã€å‚æ•°ç­‰ä¿¡æ¯ã€‚</p>
<blockquote>
<p>å€ŸåŠ©MappedStatementä¸­çš„ç»“æœæ˜ å°„å…³ç³»ï¼Œå°†è¿”å›ç»“æœè½¬åŒ–æˆHashMapã€JavaBeanç­‰å­˜å‚¨ç»“æ„å¹¶è¿”å›ã€‚ </p>
</blockquote>
<p>7ï¼‰è¾“å…¥å‚æ•°æ˜ å°„ï¼šè¾“å…¥å‚æ•°ç±»å‹å¯ä»¥æ˜¯ Mapã€List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å…¥å‚æ•°æ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ preparedStatement å¯¹è±¡è®¾ç½®å‚æ•°çš„è¿‡ç¨‹ã€‚<br>8ï¼‰è¾“å‡ºç»“æœæ˜ å°„ï¼šè¾“å‡ºç»“æœç±»å‹å¯ä»¥æ˜¯ Mapã€ List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å‡ºç»“æœæ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ç»“æœé›†çš„è§£æè¿‡ç¨‹ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>ã€1ã€‘<a href="http://c.biancheng.net/view/4304.html">MyBatisçš„å·¥ä½œåŸç† Cè¯­è¨€ç½‘</a>  </p>
]]></content>
      <categories>
        <category>Spring Family</category>
        <category>mybatis</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/wiki/mybatis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<hr>
<p>title: mybatisé…ç½®æ–‡ä»¶è§£æ<br>toc: true<br>date: 2021-07-28 17:05:46<br>tags: mybatis<br>categories: [Spring Family]</p>
<hr>
<h1 id="Mybatisé…ç½®æ–‡ä»¶"><a href="#Mybatisé…ç½®æ–‡ä»¶" class="headerlink" title="Mybatisé…ç½®æ–‡ä»¶"></a>Mybatisé…ç½®æ–‡ä»¶</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- å¼•å…¥æ•°æ®åº“å±æ€§æ–‡ä»¶ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>  <span class="attr">resource</span>=<span class="string">&quot;database.properties&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;property name=&quot;username&quot; value=&quot;sa&quot;&gt;&lt;/property&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- mybatisé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- åˆ«åçš„é…ç½® --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;typeAlias type=&quot;com.xit.pojo.User&quot; alias=&quot;user&quot;/&gt; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.xit.pojo&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">  	<span class="comment">&lt;!-- é…ç½®è¿è¡Œç¯å¢ƒ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- ç”±JDBCç®¡ç†äº‹åŠ¡ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- é…ç½®æ•°æ®æºï¼šè¿æ¥æ±  --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- å¼•å…¥Mapperæ˜ å°„æ–‡ä»¶ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/xit/pojo/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- URLæ–¹å¼ --&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!-- &lt;mapper url=&quot;file:///C:/eclipse-workspace/mybatis-01/src/com/xit/pojo/UserMapper.xml&quot;/&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="Mybatisæœ‰å‡ éƒ¨åˆ†å…¨å±€é…ç½®"><a href="#Mybatisæœ‰å‡ éƒ¨åˆ†å…¨å±€é…ç½®" class="headerlink" title="Mybatisæœ‰å‡ éƒ¨åˆ†å…¨å±€é…ç½®"></a>Mybatisæœ‰å‡ éƒ¨åˆ†å…¨å±€é…ç½®</h2><p>properties=&gt;ettings=&gt;typeAliases=&gt;typeHandlers=&gt;objectFactory=&gt;plugins=&gt;environment=&gt;databaseIdProvider=&gt;mappers</p>
<h2 id="Mybatis-åŠ è½½Mapperæ–‡ä»¶æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"><a href="#Mybatis-åŠ è½½Mapperæ–‡ä»¶æœ‰å‡ ç§æ–¹å¼ï¼Ÿ" class="headerlink" title="Mybatis åŠ è½½Mapperæ–‡ä»¶æœ‰å‡ ç§æ–¹å¼ï¼Ÿ"></a>Mybatis åŠ è½½Mapperæ–‡ä»¶æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</h2><p><img src="https://oscimg.oschina.net/oscnet/up-418b861802897058c608593b4b159d5baa2.png"><br>ä»¥ä¸Šæ˜¯Mybatiså®˜æ–¹æ–‡æ¡£ä»‹ç»çš„æ ·ä¾‹ğŸ‘†ï¼Œ<a href="https://mybatis.org/mybatis-3/zh/configuration.html#mappers">åŸæ–‡é“¾æ¥è¯·ç‚¹å‡»è¿™</a>  </p>
<p>  <strong>æœ‰4ç§æ–¹å¼ï¼›æŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°åº•ä¾æ¬¡æ˜¯ï¼š</strong>  </p>
<ul>
<li>package</li>
<li>resource</li>
<li>url</li>
<li>class</li>
</ul>
<p>ä¸‹é¢æ˜¯MybatisåŠ è½½mybatis-config.xmlæ–‡ä»¶é…ç½®çš„æºç ï¼Œä»ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°åŠ è½½çš„4ä¸­æ–¹å¼å’Œä¼˜å…ˆçº§ï¼ğŸ‘‡<br><strong>org.apache.ibatis.builder.xml.XMLConfigBuilder#typeHandlerElement</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">mapperElement</span><span class="params">(XNode parent)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Iterator var2 = parent.getChildren().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">                    XNode child = (XNode)var2.next();</span><br><span class="line">                    String resource;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;package&quot;</span>.equals(child.getName())) &#123;</span><br><span class="line">                        resource = child.getStringAttribute(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">                        <span class="keyword">this</span>.configuration.addMappers(resource);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        resource = child.getStringAttribute(<span class="string">&quot;resource&quot;</span>);</span><br><span class="line">                        String url = child.getStringAttribute(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">                        String mapperClass = child.getStringAttribute(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">                        XMLMapperBuilder mapperParser;</span><br><span class="line">                        InputStream inputStream;</span><br><span class="line">                        <span class="keyword">if</span> (resource != <span class="keyword">null</span> &amp;&amp; url == <span class="keyword">null</span> &amp;&amp; mapperClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            ErrorContext.instance().resource(resource);</span><br><span class="line">                            inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">                            mapperParser = <span class="keyword">new</span> XMLMapperBuilder(inputStream, <span class="keyword">this</span>.configuration, resource, <span class="keyword">this</span>.configuration.getSqlFragments());</span><br><span class="line">                            mapperParser.parse();</span><br><span class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resource == <span class="keyword">null</span> &amp;&amp; url != <span class="keyword">null</span> &amp;&amp; mapperClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                            ErrorContext.instance().resource(url);</span><br><span class="line">                            inputStream = Resources.getUrlAsStream(url);</span><br><span class="line">                            mapperParser = <span class="keyword">new</span> XMLMapperBuilder(inputStream, <span class="keyword">this</span>.configuration, url, <span class="keyword">this</span>.configuration.getSqlFragments());</span><br><span class="line">                            mapperParser.parse();</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (resource != <span class="keyword">null</span> || url != <span class="keyword">null</span> || mapperClass == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> BuilderException(<span class="string">&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass);</span><br><span class="line">                            <span class="keyword">this</span>.configuration.addMapper(mapperInterface);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```      </span><br><span class="line"></span><br><span class="line">## Mybatisæœ‰å‡ ç§æ‰§è¡Œå™¨</span><br><span class="line">mybatisæœ‰<span class="number">3</span>ä¸­æ‰§è¡Œå™¨ï¼› </span><br><span class="line">```text</span><br><span class="line"><span class="keyword">package</span> org.apache.ibatis.session;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ExecutorType</span> </span>&#123;</span><br><span class="line">    SIMPLE, <span class="comment">// é»˜è®¤</span></span><br><span class="line">    REUSE,</span><br><span class="line">    BATCH;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ExecutorType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
  <entry>
    <title>mysqlä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”</title>
    <url>/wiki/mysql%E4%B9%90%E8%A7%82%E9%94%81%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    <content><![CDATA[<h1 id="åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”"><a href="#åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”"></a>åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”</h1><h2 id="æ•´ä½“çš„å®é™…æ€è·¯"><a href="#æ•´ä½“çš„å®é™…æ€è·¯" class="headerlink" title="æ•´ä½“çš„å®é™…æ€è·¯"></a>æ•´ä½“çš„å®é™…æ€è·¯</h2><p>è¦å®ç°åˆ†å¸ƒå¼é”ï¼Œæœ€ç®€å•çš„æ–¹å¼å¯èƒ½å°±æ˜¯ç›´æ¥åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°äº†ã€‚å½“æˆ‘ä»¬è¦é”ä½æŸä¸ªæ–¹æ³•æˆ–èµ„æºçš„æ—¶å€™ï¼Œ<br>æˆ‘ä»¬å°±åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚  </p>
<h2 id="åŸºäºæ•°æ®è¡¨å®ç°åˆ†å¸ƒå¼é”çš„å‡ ä¸ªè¦ç‚¹"><a href="#åŸºäºæ•°æ®è¡¨å®ç°åˆ†å¸ƒå¼é”çš„å‡ ä¸ªè¦ç‚¹" class="headerlink" title="åŸºäºæ•°æ®è¡¨å®ç°åˆ†å¸ƒå¼é”çš„å‡ ä¸ªè¦ç‚¹"></a>åŸºäºæ•°æ®è¡¨å®ç°åˆ†å¸ƒå¼é”çš„å‡ ä¸ªè¦ç‚¹</h2><p>1ã€è¿™æŠŠé”ä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚<br>2ã€è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£å†³æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•åœ¨è·å¾—é”ã€‚<br>3ã€è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„insertæ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”çš„æ“ä½œã€‚<br>4ã€è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®åº“è¡¨ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚  </p>
<p><strong>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰å…¶å®ƒæ–¹å¼è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼š</strong>  </p>
<p>1ã€æ•°æ®åº“æ˜¯å•ç‚¹ï¼Ÿé‚£å°±æä¸¤ä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“ä¹‹å‰åŒå‘åŒæ­¥ï¼Œä¸€æ—¦æŒ‚æ‰å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡åº“ä¸Šã€‚<br>2ã€æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Ÿå¯ä»¥åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŠŠæ•°æ®åº“ä¸­çš„è¶…æ—¶æ•°æ®æ¸…ç†ä¸€éã€‚<br>3ã€éé˜»å¡ï¼Ÿå¯ä»¥å†™ä¸€ä¸ªwhileå¾ªç¯ï¼Œç›´åˆ°insertæˆåŠŸå†è¿”å›æˆåŠŸã€‚<br>4ã€éé‡å…¥ï¼Ÿå¯ä»¥åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸€ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“ä¸­å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œå°±ç›´æ¥æŠŠé”åˆ†é…ç»™å®ƒå³å¯ã€‚   </p>
<h2 id="ä¹è§‚é”-amp-æ‚²è§‚é”"><a href="#ä¹è§‚é”-amp-æ‚²è§‚é”" class="headerlink" title="ä¹è§‚é”&amp;æ‚²è§‚é”"></a>ä¹è§‚é”&amp;æ‚²è§‚é”</h2><p>ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œ<br>å¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“å¦‚æœæä¾›ç±»ä¼¼äºwrite_conditionæœºåˆ¶çš„å…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚  </p>
<blockquote>
<p>å®ƒå‡è®¾å¤šç”¨æˆ·å¹¶å‘çš„äº‹åŠ¡åœ¨å¤„ç†æ—¶ä¸ä¼šå½¼æ­¤äº’ç›¸å½±å“ï¼Œå„äº‹åŠ¡èƒ½å¤Ÿåœ¨ä¸äº§ç”Ÿé”çš„æƒ…å†µä¸‹å¤„ç†å„è‡ªå½±å“çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚åœ¨æäº¤æ•°æ®æ›´æ–°ä¹‹å‰ï¼Œ<br>æ¯ä¸ªäº‹åŠ¡ä¼šå…ˆæ£€æŸ¥åœ¨è¯¥äº‹åŠ¡è¯»å–æ•°æ®åï¼Œæœ‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡åˆä¿®æ”¹äº†è¯¥æ•°æ®ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡æœ‰æ›´æ–°çš„è¯ï¼Œæ­£åœ¨æäº¤çš„äº‹åŠ¡ä¼šè¿›è¡Œå›æ»šã€‚<br>ç›¸å¯¹äºæ‚²è§‚é”ï¼Œåœ¨å¯¹æ•°æ®åº“è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¹è§‚é”å¹¶ä¸ä¼šä½¿ç”¨æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ã€‚<strong>ä¸€èˆ¬çš„å®ç°ä¹è§‚é”çš„æ–¹å¼å°±æ˜¯è®°å½•æ•°æ®ç‰ˆæœ¬</strong>ã€‚  </p>
</blockquote>
<p>æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚<br>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚    </p>
<p>ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚<br>ä½†å¦‚æœç»å¸¸äº§ç”Ÿå†²çªï¼Œä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚  </p>
<h2 id="ä¹è§‚é”çš„å®ç°"><a href="#ä¹è§‚é”çš„å®ç°" class="headerlink" title="ä¹è§‚é”çš„å®ç°"></a>ä¹è§‚é”çš„å®ç°</h2><p>å®ç°æ•°æ®ç‰ˆæœ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨æ—¶é—´æˆ³ã€‚  </p>
<h3 id="1ã€ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”"><a href="#1ã€ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”" class="headerlink" title="1ã€ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”"></a>1ã€ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”</h3><p>ä½¿ç”¨ç‰ˆæœ¬å·æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®åˆå§‹åŒ–æ—¶æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ•°æ®çš„æ›´æ–°æ“ä½œéƒ½å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1æ“ä½œã€‚å¹¶åˆ¤æ–­å½“å‰ç‰ˆæœ¬å·æ˜¯ä¸æ˜¯è¯¥æ•°æ®çš„æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯</span><br><span class="line">select (status,status,version) from t_goods where id=#&#123;id&#125;</span><br><span class="line">2.æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•</span><br><span class="line">3.ä¿®æ”¹å•†å“statusä¸º2</span><br><span class="line">update t_goods</span><br><span class="line">set status=2,version=version+1</span><br><span class="line">where id=#&#123;id&#125; and version=#&#123;version&#125;;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”æœºåˆ¶å¾€å¾€åŸºäºç³»ç»Ÿä¸­æ•°æ®å­˜å‚¨é€»è¾‘ï¼Œå› æ­¤ä¹Ÿå…·å¤‡ä¸€å®šçš„å±€é™æ€§ã€‚ç”±äºä¹è§‚é”æœºåˆ¶æ˜¯åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­å®ç°çš„ï¼Œå¯¹äºæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„ç”¨æˆ·æ•°æ®æ›´æ–°æ“ä½œä¸å—æˆ‘ä»¬ç³»ç»Ÿçš„æ§åˆ¶ï¼Œ<br>å› æ­¤å¯èƒ½ä¼šé€ æˆè„æ•°æ®è¢«æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬åº”è¯¥å……åˆ†è€ƒè™‘åˆ°è¿™äº›æƒ…å†µï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼ˆå¦‚å°†ä¹è§‚é”ç­–ç•¥åœ¨æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°ï¼Œ<br>å¯¹å¤–åªå¼€æ”¾åŸºäºæ­¤å­˜å‚¨è¿‡ç¨‹çš„æ•°æ®æ›´æ–°é€”å¾„ï¼Œè€Œä¸æ˜¯å°†æ•°æ®åº“è¡¨ç›´æ¥å¯¹å¤–å…¬å¼€ï¼‰ã€‚</p>
<blockquote>
<p>è¿™ä¸€ç‚¹å…¶å®åœ¨å¾®æœåŠ¡æ¶æ„ä¸­åªè¦åšå¥½æ•°æ®éš”ç¦»å°±å¯ä»¥é¿å…ï¼Œæ¯”å¦‚userè¿™å¼ æ•°æ®è¡¨ï¼ŒæŒ‰ç…§è¾¹ç•Œåˆ’åˆ†åº”è¯¥å±äºç”¨æˆ·ä¸­å¿ƒæœåŠ¡çš„ï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚ä»“å‚¨ï¼Œç‰©æµç­‰éœ€è¦<br>ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåº”è¯¥æœ‰ç”¨æˆ·ä¸­å¿ƒæš´éœ²å‡ºæ¥å£ï¼Œè€Œä¸æ˜¯ä»“å‚¨å»æ•°æ®åº“æŸ¥è¯¢userè¿™å¼ è¡¨çš„æ•°æ®ï¼Œç”šè‡³update userçš„æ•°æ®ã€‚</p>
</blockquote>
<h3 id="2ã€ä½¿ç”¨æ—¶é—´æˆ³"><a href="#2ã€ä½¿ç”¨æ—¶é—´æˆ³" class="headerlink" title="2ã€ä½¿ç”¨æ—¶é—´æˆ³"></a>2ã€ä½¿ç”¨æ—¶é—´æˆ³</h3><p>ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨update_timeå­—æ®µï¼Œå¹¶ä¸”è¿™ä¸ªå­—æ®µè‚¯å®šæ˜¯è·Ÿéšæ•°æ®åº“æ—¶é—´é…ç½®çš„ï¼Œå³ update on current_timestamp ï¼›</p>
<h2 id="ä¹è§‚é”çš„ä¼˜ç‚¹ä¸ä¸è¶³"><a href="#ä¹è§‚é”çš„ä¼˜ç‚¹ä¸ä¸è¶³" class="headerlink" title="ä¹è§‚é”çš„ä¼˜ç‚¹ä¸ä¸è¶³"></a>ä¹è§‚é”çš„ä¼˜ç‚¹ä¸ä¸è¶³</h2><p>ä¹è§‚å¹¶å‘æ§åˆ¶ç›¸ä¿¡äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ç«äº‰(data race)çš„æ¦‚ç‡æ˜¯æ¯”è¾ƒå°çš„ï¼Œå› æ­¤å°½å¯èƒ½ç›´æ¥åšä¸‹å»ï¼Œç›´åˆ°æäº¤çš„æ—¶å€™æ‰å»é”å®šï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä»»ä½•é”å’Œæ­»é”ã€‚<br>èƒ½å¤Ÿæå‡æ•°æ®åº“çš„ååé‡ï¼›<br>ä½†å¦‚æœç›´æ¥ç®€å•è¿™ä¹ˆåšï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šé‡åˆ°ä¸å¯é¢„æœŸçš„ç»“æœï¼Œä¾‹å¦‚ä¸¤ä¸ªäº‹åŠ¡éƒ½è¯»å–äº†æ•°æ®åº“çš„æŸä¸€è¡Œï¼Œç»è¿‡ä¿®æ”¹ä»¥åå†™å›æ•°æ®åº“ï¼Œè¿™æ—¶å°±é‡åˆ°äº†é—®é¢˜ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/lmb55/article/details/78495629">åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”å®ç°</a><br><a href="https://blog.csdn.net/tianjiabin123/article/details/72625156">åˆ†å¸ƒå¼é”æ–¹å¼ï¼ˆä¸€ã€åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”ï¼‰</a><br><a href="https://zhuanlan.zhihu.com/p/42056183">åˆ†å¸ƒå¼é”çœ‹è¿™ç¯‡å°±å¤Ÿäº†</a><br><a href="https://blog.csdn.net/lmb55/article/details/78266667">ä¹è§‚é”ä¸æ‚²è§‚é”æ·±å…¥å­¦ä¹ </a></p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlå¸¸ç”¨å‘½ä»¤</title>
    <url>/wiki/mysql%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="binlogç›¸å…³å‘½ä»¤"><a href="#binlogç›¸å…³å‘½ä»¤" class="headerlink" title="binlogç›¸å…³å‘½ä»¤"></a>binlogç›¸å…³å‘½ä»¤</h2><p>mysql&gt; show variables like â€˜binlog_formatâ€™;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>
<p>show variables like â€˜log_binâ€™;</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">+---------------+-------+</span><br></pre></td></tr></table></figure>



<h2 id="ç”¨æˆ·-amp-æƒé™"><a href="#ç”¨æˆ·-amp-æƒé™" class="headerlink" title="ç”¨æˆ·&amp;æƒé™"></a>ç”¨æˆ·&amp;æƒé™</h2><h3 id="åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"><a href="#åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ" class="headerlink" title="åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"></a>åˆ›å»ºç”¨æˆ·å¹¶æˆæƒ</h3><p>rootç”¨æˆ·ç™»å½•ï¼š mysql -u root -p ç„¶åè¾“å…¥å¯†ç <br>åˆ›å»ºç”¨æˆ·ï¼š <code>create user &#39;yjuser&#39;@&#39;%&#39; identified by &#39;u-bx.com&#39;;</code><br>æˆæƒç”¨æˆ·åªè¯»æƒé™ï¼š <code>grant SELECT on mirror.* to &#39;yjuser&#39;@&#39;%&#39; IDENTIFIED by &#39;u-bx.com&#39;;</code><br>åˆ·æ–°æƒé™ï¼š<code>flush privileges;</code></p>
<h3 id="æŸ¥çœ‹å½“å‰ç”¨æˆ·"><a href="#æŸ¥çœ‹å½“å‰ç”¨æˆ·" class="headerlink" title="æŸ¥çœ‹å½“å‰ç”¨æˆ·"></a>æŸ¥çœ‹å½“å‰ç”¨æˆ·</h3><p><code>select User();</code></p>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>multi_match æŸ¥è¯¢</title>
    <url>/wiki/multi-match-%E6%9F%A5%E8%AF%A2/</url>
    <content><![CDATA[<p>multi_match æŸ¥è¯¢ä¸ºèƒ½åœ¨å¤šä¸ªå­—æ®µä¸Šåå¤æ‰§è¡Œç›¸åŒæŸ¥è¯¢æä¾›äº†ä¸€ç§ä¾¿æ·æ–¹å¼ã€‚</p>
<p>ğŸ“’ ğŸ“’ ğŸ“’</p>
<blockquote>
<p>multi_match å¤šåŒ¹é…æŸ¥è¯¢çš„ç±»å‹æœ‰å¤šç§ï¼Œå…¶ä¸­çš„ä¸‰ç§æ°å·§ä¸ äº†è§£æˆ‘ä»¬çš„æ•°æ® ä¸­ä»‹ç»çš„ä¸‰ä¸ªåœºæ™¯å¯¹åº”ï¼Œå³ï¼š<code>best_fields</code> ã€ <code>most_fields</code> å’Œ <code>cross_fields</code> ï¼ˆæœ€ä½³å­—æ®µã€å¤šæ•°å­—æ®µã€è·¨å­—æ®µï¼‰ã€‚</p>
</blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„ç±»å‹æ˜¯ <code>best_fields</code> ï¼Œè¿™è¡¨ç¤ºå®ƒä¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆä¸€ä¸ª <code>match</code> æŸ¥è¯¢ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåˆ° <code>dis_max</code> æŸ¥è¯¢çš„å†…éƒ¨ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;dis_max&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;queries&quot;</span>:  [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;Quick brown fox&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;minimum_should_match&quot;</span>: <span class="string">&quot;30%&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;body&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;query&quot;</span>: <span class="string">&quot;Quick brown fox&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;minimum_should_match&quot;</span>: <span class="string">&quot;30%&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;tie_breaker&quot;</span>: <span class="number">0.3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢ç”¨ multi_match é‡å†™æˆæ›´ç®€æ´çš„å½¢å¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>:                <span class="string">&quot;Quick brown fox&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:                 <span class="string">&quot;best_fields&quot;</span>, </span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>:               [ <span class="string">&quot;title&quot;</span>, <span class="string">&quot;body&quot;</span> ],</span><br><span class="line">        <span class="attr">&quot;tie_breaker&quot;</span>:          <span class="number">0.3</span>,</span><br><span class="line">        <span class="attr">&quot;minimum_should_match&quot;</span>: <span class="string">&quot;30%&quot;</span> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>âš ï¸ âš ï¸ âš ï¸</p>
<ul>
<li>best_fields ç±»å‹æ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸æŒ‡å®šã€‚</li>
<li>å¦‚ minimum_should_match æˆ– operator è¿™æ ·çš„å‚æ•°ä¼šè¢«ä¼ é€’åˆ°ç”Ÿæˆçš„ match æŸ¥è¯¢ä¸­ã€‚</li>
</ul>
<h2 id="æŸ¥è¯¢å­—æ®µåç§°çš„æ¨¡ç³ŠåŒ¹é…"><a href="#æŸ¥è¯¢å­—æ®µåç§°çš„æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="æŸ¥è¯¢å­—æ®µåç§°çš„æ¨¡ç³ŠåŒ¹é…"></a>æŸ¥è¯¢å­—æ®µåç§°çš„æ¨¡ç³ŠåŒ¹é…</h2><p>å­—æ®µåç§°å¯ä»¥ç”¨ <code>æ¨¡ç³ŠåŒ¹é…</code> çš„æ–¹å¼ç»™å‡ºï¼šä»»ä½•ä¸æ¨¡ç³Šæ¨¡å¼æ­£åˆ™åŒ¹é…çš„å­—æ®µéƒ½ä¼šè¢«åŒ…æ‹¬åœ¨æœç´¢æ¡ä»¶ä¸­ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åŒæ—¶åŒ¹é… <code>book_title</code> ã€ <code>chapter_title</code> å’Œ <code>section_title</code> ï¼ˆä¹¦åã€ç« åã€èŠ‚åï¼‰è¿™ä¸‰ä¸ªå­—æ®µï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>:  <span class="string">&quot;Quick brown fox&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>: <span class="string">&quot;*_title&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æå‡å•ä¸ªå­—æ®µçš„æƒé‡"><a href="#æå‡å•ä¸ªå­—æ®µçš„æƒé‡" class="headerlink" title="æå‡å•ä¸ªå­—æ®µçš„æƒé‡"></a>æå‡å•ä¸ªå­—æ®µçš„æƒé‡</h2><p>å¯ä»¥ä½¿ç”¨ ^ å­—ç¬¦è¯­æ³•ä¸ºå•ä¸ªå­—æ®µæå‡æƒé‡ï¼Œåœ¨å­—æ®µåç§°çš„æœ«å°¾æ·»åŠ  ^boost ï¼Œå…¶ä¸­ boost æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span>:  <span class="string">&quot;Quick brown fox&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;fields&quot;</span>: [ <span class="string">&quot;*_title&quot;</span>, <span class="string">&quot;chapter_title^2&quot;</span> ] </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>chapter_title è¿™ä¸ªå­—æ®µçš„ boost å€¼ä¸º 2 ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªå­—æ®µ book_title å’Œ section_title å­—æ®µçš„é»˜è®¤ boost å€¼ä¸º 1 ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/multi-match-query.html">Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» multi_match æŸ¥è¯¢</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.x/query-dsl-multi-match-query.html">Elasticsearch Guide [7.x] Â» Query DSL Â» Full text queries Â» Multi-match query</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>nettyå®ç°ç®€æ˜“RPCè°ƒç”¨</title>
    <url>/wiki/netty%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93RPC%E8%B0%83%E7%94%A8/</url>
    <content><![CDATA[<h1 id="åŸºäºNettyæ‰‹å†™ä¸€ä¸ªRPCç®€æ˜“è¿œç¨‹è°ƒç”¨"><a href="#åŸºäºNettyæ‰‹å†™ä¸€ä¸ªRPCç®€æ˜“è¿œç¨‹è°ƒç”¨" class="headerlink" title="åŸºäºNettyæ‰‹å†™ä¸€ä¸ªRPCç®€æ˜“è¿œç¨‹è°ƒç”¨"></a>åŸºäºNettyæ‰‹å†™ä¸€ä¸ªRPCç®€æ˜“è¿œç¨‹è°ƒç”¨</h1><p><img src="https://oscimg.oschina.net/oscnet/up-b813c676214fc02b6f107ca7f6133a635fb.png">    </p>
<h2 id="æŠ½è±¡åè®®"><a href="#æŠ½è±¡åè®®" class="headerlink" title="æŠ½è±¡åè®®"></a>æŠ½è±¡åè®®</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokerProtocol</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºäºŒè¿›åˆ¶æµè°ƒç”¨åè®®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String className;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String methodName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½¢å‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt;[] params;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®å‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object[] values;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨å†Œä¸­å¿ƒ"><a href="#æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="æ³¨å†Œä¸­å¿ƒ"></a>æ³¨å†Œä¸­å¿ƒ</h2><h3 id="RpcRegistry-åŸºäºNettyå®ç°çš„RPCæ³¨å†Œä¸­å¿ƒ"><a href="#RpcRegistry-åŸºäºNettyå®ç°çš„RPCæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="RpcRegistry åŸºäºNettyå®ç°çš„RPCæ³¨å†Œä¸­å¿ƒ"></a>RpcRegistry åŸºäºNettyå®ç°çš„RPCæ³¨å†Œä¸­å¿ƒ</h3><blockquote>
<p>1ã€ ServerBootstrap å¯åŠ¨8080ç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯é“¾æ¥ï¼›<br>2ã€ RegisterHandlerç”¨æ¥å¤„ç†RPCæ¥å£çš„å‘ç°å’Œæ³¨å†Œï¼›    </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcRegistry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer post;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RpcRegistry</span><span class="params">(Integer post)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.post = post;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        ServerBootstrap server = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">        server.group(bossGroup, workerGroup)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(Channel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="comment">// æ¥å—å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†</span></span><br><span class="line">                        ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line">                        <span class="comment">//é…ç½®é€šç”¨è§£ç å™¨</span></span><br><span class="line">                        <span class="keyword">int</span> fieldLength = <span class="number">4</span>;</span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, <span class="number">0</span>, fieldLength, <span class="number">0</span>, fieldLength));</span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> LengthFieldPrepender(fieldLength));</span><br><span class="line">                        <span class="comment">//å¯¹è±¡ç¼–ç å™¨</span></span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;encoder&quot;</span>, <span class="keyword">new</span> ObjectEncoder());</span><br><span class="line">                        pipeline.addLast(<span class="string">&quot;decoder&quot;</span>, <span class="keyword">new</span> ObjectDecoder(Integer.MAX_VALUE, ClassResolvers.cacheDisabled(<span class="keyword">null</span>)));</span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> RegisterHandler());</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                .childOption(ChannelOption.SO_KEEPALIVE, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ChannelFuture future = server.bind(<span class="keyword">this</span>.post).sync();</span><br><span class="line">            System.out.println(<span class="string">&quot;Rpc registry started in port &quot;</span> + <span class="keyword">this</span>.post);</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workerGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> RpcRegistry(<span class="number">8080</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="RegisterHandler-æ‰§è¡ŒRPCçš„å‘ç°å’Œæ³¨å†Œ"><a href="#RegisterHandler-æ‰§è¡ŒRPCçš„å‘ç°å’Œæ³¨å†Œ" class="headerlink" title="RegisterHandler æ‰§è¡ŒRPCçš„å‘ç°å’Œæ³¨å†Œ"></a>RegisterHandler æ‰§è¡ŒRPCçš„å‘ç°å’Œæ³¨å†Œ</h3><blockquote>
<p>1ã€æ‰«æå›ºå®šåŒ…ä¸‹æˆ–è€…è·¯å¾„ä¸‹çš„ç±»;<br>2ã€æ¥å£ä¸ºkeyï¼Œå…·ä½“å®ä¾‹ä½œä¸ºvalueï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œä¸­å¿ƒå®¹å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; REGISTRY_MAP = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; classNameList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RegisterHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€æ‰«ææ‰€æœ‰éœ€è¦æ³¨å†Œçš„ç±»</span></span><br><span class="line">        scannerClass(<span class="string">&quot;com.ibli.netty.rpc.provider&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ³¨å†Œ</span></span><br><span class="line">        doRegistry();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object result;</span><br><span class="line">        InvokerProtocol request = (InvokerProtocol) msg;</span><br><span class="line">        <span class="keyword">if</span> (REGISTRY_MAP.containsKey(request.getClassName())) &#123;</span><br><span class="line">            Object provider = REGISTRY_MAP.get(request.getClassName());</span><br><span class="line">            Method method = provider.getClass().getMethod(request.getMethodName(), request.getParams());</span><br><span class="line">            result = method.invoke(provider, request.getValues());</span><br><span class="line">            ctx.write(result);</span><br><span class="line">            ctx.flush();</span><br><span class="line">            ctx.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doRegistry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (classNameList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String className : classNameList) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt; clazz = Class.forName(className);</span><br><span class="line">                Class&lt;?&gt; i = clazz.getInterfaces()[<span class="number">0</span>];</span><br><span class="line">                REGISTRY_MAP.put(i.getName(), clazz.newInstance());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">scannerClass</span><span class="params">(String packageName)</span> </span>&#123;</span><br><span class="line">        URL url = <span class="keyword">this</span>.getClass().getClassLoader().getResource(packageName.replaceAll(<span class="string">&quot;\\.&quot;</span>, <span class="string">&quot;/&quot;</span>));</span><br><span class="line">        File dir = <span class="keyword">new</span> File(url.getFile());</span><br><span class="line">        <span class="keyword">for</span> (File file : dir.listFiles()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">                scannerClass(packageName + <span class="string">&quot;.&quot;</span> + file.getName());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                classNameList.add(packageName + <span class="string">&quot;.&quot;</span> + file.getName().replace(<span class="string">&quot;.class&quot;</span>, <span class="string">&quot;&quot;</span>).trim());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="APIä»¥åŠå®ç°"><a href="#APIä»¥åŠå®ç°" class="headerlink" title="APIä»¥åŠå®ç°"></a>APIä»¥åŠå®ç°</h2><h3 id="RPCæ¥å£-å®šä¹‰ä¸€ä¸ªç®€å•çš„æœåŠ¡æ¥å£"><a href="#RPCæ¥å£-å®šä¹‰ä¸€ä¸ªç®€å•çš„æœåŠ¡æ¥å£" class="headerlink" title="RPCæ¥å£ å®šä¹‰ä¸€ä¸ªç®€å•çš„æœåŠ¡æ¥å£"></a>RPCæ¥å£ å®šä¹‰ä¸€ä¸ªç®€å•çš„æœåŠ¡æ¥å£</h3><blockquote>
<p>ä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡å¯¹å¤–æš´éœ²çš„API;  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRpcService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RPCæ¥å£å®ç°"><a href="#RPCæ¥å£å®ç°" class="headerlink" title="RPCæ¥å£å®ç°"></a>RPCæ¥å£å®ç°</h3><blockquote>
<p>providerå®ç°å…·ä½“çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„æœåŠ¡ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcServiceImpl</span> <span class="keyword">implements</span> <span class="title">IRpcService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RPCè°ƒç”¨æ–¹"><a href="#RPCè°ƒç”¨æ–¹" class="headerlink" title="RPCè°ƒç”¨æ–¹"></a>RPCè°ƒç”¨æ–¹</h2><h3 id="è°ƒç”¨RPC"><a href="#è°ƒç”¨RPC" class="headerlink" title="è°ƒç”¨RPC"></a>è°ƒç”¨RPC</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcConsumer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        IRpcService rpc = RpcProxy.create(IRpcService.class);</span><br><span class="line">        System.err.println(rpc.add(<span class="number">1</span>,<span class="number">3</span>));</span><br><span class="line">        System.err.println(rpc.mul(<span class="number">3</span>,<span class="number">3</span>));</span><br><span class="line">        System.err.println(rpc.sub(<span class="number">14</span>,<span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="RpcProxy-åŠ¨æ€ä»£ç†å¯¹è±¡è¯·æ±‚RPC"><a href="#RpcProxy-åŠ¨æ€ä»£ç†å¯¹è±¡è¯·æ±‚RPC" class="headerlink" title="RpcProxy åŠ¨æ€ä»£ç†å¯¹è±¡è¯·æ±‚RPC"></a>RpcProxy åŠ¨æ€ä»£ç†å¯¹è±¡è¯·æ±‚RPC</h2><blockquote>
<p>é€šè¿‡Netty Bootstrapè®¿é—®8080ç«¯å£ï¼›</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcProxy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        MethodProxy proxy = <span class="keyword">new</span> MethodProxy(clazz);</span><br><span class="line">        Class&lt;?&gt;[] interfaces = clazz.isInterface() ?</span><br><span class="line">                <span class="keyword">new</span> Class[]&#123;clazz&#125; :</span><br><span class="line">                clazz.getInterfaces();</span><br><span class="line">        T result = (T) Proxy.newProxyInstance(clazz.getClassLoader(), interfaces, proxy);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Class&lt;?&gt; clazz;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">MethodProxy</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.clazz = clazz;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">                <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> rpcInvoke(proxy, method, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Object <span class="title">rpcInvoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å°è£…è¯·æ±‚çš„å†…å®¹</span></span><br><span class="line">            InvokerProtocol msg = <span class="keyword">new</span> InvokerProtocol();</span><br><span class="line">            msg.setClassName(<span class="keyword">this</span>.clazz.getName());</span><br><span class="line">            msg.setMethodName(method.getName());</span><br><span class="line">            msg.setParams(method.getParameterTypes());</span><br><span class="line">            msg.setValues(args);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">final</span> RpcProxyHandler consumerHandler = <span class="keyword">new</span> RpcProxyHandler();</span><br><span class="line">            EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Bootstrap client = <span class="keyword">new</span> Bootstrap();</span><br><span class="line">                client.group(group)</span><br><span class="line">                        .channel(NioSocketChannel.class)</span><br><span class="line">                        .handler(<span class="keyword">new</span> ChannelInitializer() &#123;</span><br><span class="line">                            <span class="meta">@Override</span></span><br><span class="line">                            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(Channel ch)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                                <span class="comment">//æ¥æ”¶è¯¾å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†æµç¨‹</span></span><br><span class="line">                                ChannelPipeline pipeline = ch.pipeline();</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">int</span> fieldLength = <span class="number">4</span>;</span><br><span class="line">                                <span class="comment">//é€šç”¨è§£ç å™¨è®¾ç½®</span></span><br><span class="line">                                pipeline.addLast(<span class="keyword">new</span> LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, <span class="number">0</span>, fieldLength, <span class="number">0</span>, fieldLength));</span><br><span class="line">                                <span class="comment">//é€šç”¨ç¼–ç å™¨</span></span><br><span class="line">                                pipeline.addLast(<span class="keyword">new</span> LengthFieldPrepender(fieldLength));</span><br><span class="line">                                <span class="comment">//å¯¹è±¡ç¼–ç å™¨</span></span><br><span class="line">                                pipeline.addLast(<span class="string">&quot;encoder&quot;</span>, <span class="keyword">new</span> ObjectEncoder());</span><br><span class="line">                                <span class="comment">//å¯¹è±¡è§£ç å™¨</span></span><br><span class="line">                                pipeline.addLast(<span class="string">&quot;decoder&quot;</span>, <span class="keyword">new</span> ObjectDecoder(Integer.MAX_VALUE, ClassResolvers.cacheDisabled(<span class="keyword">null</span>)));</span><br><span class="line"></span><br><span class="line">                                pipeline.addLast(<span class="string">&quot;handler&quot;</span>, consumerHandler);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .option(ChannelOption.TCP_NODELAY, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">                ChannelFuture future = client.connect(<span class="string">&quot;localhost&quot;</span>, <span class="number">8080</span>).sync();</span><br><span class="line">                future.channel().writeAndFlush(msg).sync();</span><br><span class="line">                future.channel().closeFuture().sync();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                group.shutdownGracefully();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> consumerHandler.getResponse();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RPCè°ƒç”¨æ–¹æ¥å—å¹¶å¤„ç†è°ƒç”¨ç»“æœ"><a href="#RPCè°ƒç”¨æ–¹æ¥å—å¹¶å¤„ç†è°ƒç”¨ç»“æœ" class="headerlink" title="RPCè°ƒç”¨æ–¹æ¥å—å¹¶å¤„ç†è°ƒç”¨ç»“æœ"></a>RPCè°ƒç”¨æ–¹æ¥å—å¹¶å¤„ç†è°ƒç”¨ç»“æœ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcProxyHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object response;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.response = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>nettyå®ç°ç®€æ˜“tomcat</title>
    <url>/wiki/netty%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93tomcat/</url>
    <content><![CDATA[<h1 id="åŸºäºNettyæ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„Tomcatå®¹å™¨"><a href="#åŸºäºNettyæ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„Tomcatå®¹å™¨" class="headerlink" title="åŸºäºNettyæ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„Tomcatå®¹å™¨"></a>åŸºäºNettyæ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„Tomcatå®¹å™¨</h1><p>æœ¬æ–‡ä¸»è¦åŸºäºä¼ ç»Ÿçš„BIOæ¥å®ç°ä¸€ä¸ªç®€å•çš„Httpè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼›<br>1ã€Servletè¯·æ±‚æ— éå°±æ˜¯doGet/doPostï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰æŠ½è±¡Servletè®°å¿†GET/POSTæ–¹æ³•ï¼›<br>2ã€åŸºäºNetty APIå®ç°CSé€šä¿¡ï¼›<br>3ã€æ¨¡æ‹ŸSpringåŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ³¨å†Œè¯·æ±‚ä»¥åŠæ§åˆ¶å™¨ï¼›  </p>
<p><img src="https://oscimg.oschina.net/oscnet/up-6bb2d717164854e73513f9ed1355d1844bc.png">   </p>
<h2 id="Nettyç‰ˆæœ¬"><a href="#Nettyç‰ˆæœ¬" class="headerlink" title="Nettyç‰ˆæœ¬"></a>Nettyç‰ˆæœ¬</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;o.netty&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;netty-all&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;<span class="number">4.1</span><span class="number">.6</span>.Final&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="GlRequest-åŸºäºNetty-amp-HttpRequestçš„APIæ“ä½œï¼Œéå¸¸ç®€å•"><a href="#GlRequest-åŸºäºNetty-amp-HttpRequestçš„APIæ“ä½œï¼Œéå¸¸ç®€å•" class="headerlink" title="GlRequest åŸºäºNetty&amp;HttpRequestçš„APIæ“ä½œï¼Œéå¸¸ç®€å•"></a>GlRequest åŸºäºNetty&amp;HttpRequestçš„APIæ“ä½œï¼Œéå¸¸ç®€å•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ChannelHandlerContext ctx;</span><br><span class="line">    <span class="keyword">private</span> HttpRequest req;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlRequest</span><span class="params">(ChannelHandlerContext ctx, HttpRequest req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ctx = ctx;</span><br><span class="line">        <span class="keyword">this</span>.req = req;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.req.uri();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.req.method().name();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; getParams() &#123;</span><br><span class="line">        QueryStringDecoder decoder = <span class="keyword">new</span> QueryStringDecoder(req.uri());</span><br><span class="line">        <span class="keyword">return</span> decoder.parameters();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getParam</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; params = getParams();</span><br><span class="line">        List&lt;String&gt; strings = params.get(name);</span><br><span class="line">        <span class="keyword">if</span> (strings == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strings.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="GlResponse-åŸºäºNetty-amp-FullHttpResponseçš„APIæ“ä½œ"><a href="#GlResponse-åŸºäºNetty-amp-FullHttpResponseçš„APIæ“ä½œ" class="headerlink" title="GlResponse åŸºäºNetty&amp;FullHttpResponseçš„APIæ“ä½œ"></a>GlResponse åŸºäºNetty&amp;FullHttpResponseçš„APIæ“ä½œ</h2><blockquote>
<p>FullHttpResponseä½œä¸ºè¿”å›è¯·æ±‚çš„ä¸»ä½“ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlResponse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ChannelHandlerContext ctx;</span><br><span class="line">    <span class="keyword">private</span> HttpRequest req;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlResponse</span><span class="params">(ChannelHandlerContext ctx, HttpRequest req)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.req = req;</span><br><span class="line">        <span class="keyword">this</span>.ctx = ctx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String string)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (string == <span class="keyword">null</span> || string.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FullHttpResponse response = <span class="keyword">new</span> DefaultFullHttpResponse(</span><br><span class="line">                    HttpVersion.HTTP_1_1,</span><br><span class="line">                    HttpResponseStatus.OK,</span><br><span class="line">                    Unpooled.wrappedBuffer(string.getBytes(<span class="string">&quot;UTF-8&quot;</span>))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            response.headers().set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">            ctx.write(response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ctx.flush();</span><br><span class="line">            ctx.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="GlServlet-å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•"><a href="#GlServlet-å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•" class="headerlink" title="GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•"></a>GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•</h2><blockquote>
<p>å®šä¹‰æŠ½è±¡çš„Servletå’ŒdoGetæ–¹æ³•å’ŒdoPostæ–¹æ³•ï¼Œå…·ä½“çš„ä¸šåŠ¡å»å®ç°è‡ªå·±çš„æ–¹æ³•å’Œé€»è¾‘ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String GET = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (GET.equals(request.getMethod())) &#123;</span><br><span class="line">               doGet(request, response);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               doPost(request, response);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<h2 id="FirstServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•"><a href="#FirstServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•" class="headerlink" title="FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•"></a>FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstServlet</span> <span class="keyword">extends</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å…·ä½“çš„é€»è¾‘</span></span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        response.write(<span class="string">&quot;This is first servlet from NIO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SecondServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•"><a href="#SecondServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•" class="headerlink" title="SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•"></a>SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondServlet</span> <span class="keyword">extends</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        response.write(<span class="string">&quot;This second request form NIO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web-nio-properties-é…ç½®æ–‡ä»¶"><a href="#web-nio-properties-é…ç½®æ–‡ä»¶" class="headerlink" title="web-nio.properties é…ç½®æ–‡ä»¶"></a>web-nio.properties é…ç½®æ–‡ä»¶</h2><blockquote>
<p>é…ç½®è¯·æ±‚å’Œå¤„ç†å™¨ï¼ŒSpringä¸­æ˜¯é€šè¿‡Controllerä¸‹çš„@XXXMappingæ³¨è§£å»æ‰«æå¹¶åŠ è½½åˆ°å·¥å‚çš„ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">servlet.one.className=com.ibli.netty.tomcat.nio.servlet.FirstServlet</span><br><span class="line">servlet.one.url=/firstServlet.<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">servlet.two.className=com.ibli.netty.tomcat.nio.servlet.SecondServlet</span><br><span class="line">servlet.two.url=/secondServlet.<span class="keyword">do</span></span><br></pre></td></tr></table></figure>

<h2 id="GlTomcat"><a href="#GlTomcat" class="headerlink" title="GlTomcat"></a>GlTomcat</h2><blockquote>
<p>å¯åŠ¨æœåŠ¡ç«¯ï¼Œåœ¨ç½‘é¡µä¸­è®¿é—®æœ¬åœ°8080ç«¯å£ï¼Œè¾“å…¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„urlè¿›è¡Œæµ‹è¯•ï¼š  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlTomcat</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer PORT = <span class="number">8080</span>;</span><br><span class="line">    <span class="keyword">private</span> Properties webXml = <span class="keyword">new</span> Properties();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, GlServlet&gt; servletMapping = <span class="keyword">new</span> HashMap&lt;String, GlServlet&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> GlTomcat().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tomcatçš„å¯åŠ¨å…¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1ã€åŠ è½½webé…ç½®æ–‡ä»¶ï¼Œè§£æé…ç½®</span></span><br><span class="line">        init();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bossçº¿ç¨‹</span></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="comment">// Workerçº¿ç¨‹</span></span><br><span class="line">        EventLoopGroup workGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="comment">//2ã€åˆ›å»ºNettyæœåŠ¡ç«¯å¯¹è±¡</span></span><br><span class="line">        ServerBootstrap server = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">        <span class="comment">//3ã€ é…ç½®æœåŠ¡ç«¯å‚æ•°</span></span><br><span class="line">        server.group(bossGroup, workGroup)</span><br><span class="line">                <span class="comment">// é…ç½®ä¸»çº¿ç¨‹çš„å¤„ç†é€»è¾‘</span></span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                <span class="comment">// å­çº¿ç¨‹çš„å›è°ƒé€»è¾‘</span></span><br><span class="line">                .childHandler(<span class="keyword">new</span> ChannelInitializer() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(Channel client)</span> </span>&#123;</span><br><span class="line">                        <span class="comment">// å¤„ç†å…·ä½“çš„å›è°ƒé€»è¾‘</span></span><br><span class="line">                        <span class="comment">// è´£ä»»é“¾æ¨¡å¼</span></span><br><span class="line">                        <span class="comment">//è¿”å›-ç¼–ç </span></span><br><span class="line">                        client.pipeline().addLast(<span class="keyword">new</span> HttpResponseEncoder());</span><br><span class="line">                        <span class="comment">//è¯·æ±‚-è§£ç </span></span><br><span class="line">                        client.pipeline().addLast(<span class="keyword">new</span> HttpRequestDecoder());</span><br><span class="line">                        <span class="comment">//ç”¨æˆ·è‡ªå·±çš„é€»è¾‘å¤„ç†</span></span><br><span class="line">                        client.pipeline().addLast(<span class="keyword">new</span> GlTomcatHandler());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">// é…ç½®ä¸»çº¿ç¨‹å¯åˆ†é…çš„æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">                .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                <span class="comment">//ä¿æŒé•¿é“¾æ¥</span></span><br><span class="line">                .childOption(ChannelOption.SO_KEEPALIVE, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        ChannelFuture future = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            future = server.bind(<span class="keyword">this</span>.PORT).sync();</span><br><span class="line">            System.err.println(<span class="string">&quot;Gl tomcat started in pory &quot;</span> + <span class="keyword">this</span>.PORT);</span><br><span class="line">            future.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">            workGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     * è¿™å…¶å®ä½¿ç”¨äº†ç­–ç•¥æ¨¡å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String WEB_INF = <span class="keyword">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath();</span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(WEB_INF + <span class="string">&quot;web-nio.properties&quot;</span>);</span><br><span class="line">            webXml.load(fis);</span><br><span class="line">            <span class="keyword">for</span> (Object k : webXml.keySet()) &#123;</span><br><span class="line">                String key = k.toString();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (key.endsWith(<span class="string">&quot;.url&quot;</span>)) &#123;</span><br><span class="line">                    <span class="comment">//servlet.two.url</span></span><br><span class="line">                    String servletName = key.replaceAll(<span class="string">&quot;\\.url&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                    String url = webXml.getProperty(key);</span><br><span class="line">                    <span class="comment">//servlet.two.className</span></span><br><span class="line">                    String className = webXml.getProperty(servletName + <span class="string">&quot;.className&quot;</span>);</span><br><span class="line">                    <span class="comment">//åå°„åˆ›å»ºservletå®ä¾‹</span></span><br><span class="line">                    <span class="comment">// load-on-startup &gt;=1 :webå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–  0ï¼šç”¨æˆ·è¯·æ±‚çš„æ—¶å€™æ‰å¯åŠ¨</span></span><br><span class="line">                    GlServlet obj = (GlServlet) Class.forName(className).newInstance();</span><br><span class="line">                    <span class="comment">// å°†urlå’Œservletå»ºç«‹æ˜ å°„å…³ç³»</span></span><br><span class="line">                    servletMapping.put(url, obj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ç”¨æˆ·è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlTomcatHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line">                HttpRequest req = (HttpRequest) msg;</span><br><span class="line">                GlRequest request = <span class="keyword">new</span> GlRequest(ctx,req);</span><br><span class="line">                GlResponse response = <span class="keyword">new</span> GlResponse(ctx,req);</span><br><span class="line">                String url = request.getUrl();</span><br><span class="line">                <span class="keyword">if</span> (servletMapping.containsKey(url))&#123;</span><br><span class="line">                    servletMapping.get(url).service(request,response);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    response.write(<span class="string">&quot;404 Not Fount&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h2><blockquote>
<p>è¯·æ±‚ : <a href="http://localhost:8080/secoundServlet.do">http://localhost:8080/secoundServlet.do</a> è¿™çš„åœ°å€å†™é”™è¯¯  âš ï¸<br><img src="https://oscimg.oschina.net/oscnet/up-4652c388dd368f575bc5c0719f68a8632df.png">  </p>
</blockquote>
<blockquote>
<p>è¯·æ±‚ : <a href="http://localhost:8080/secondServlet.do">http://localhost:8080/secondServlet.do</a><br><img src="https://oscimg.oschina.net/oscnet/up-cc90b46288898bfe801e33f3a94bfab5070.png">  </p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>python3åŸºç¡€è¯­æ³•</title>
    <url>/wiki/python3%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</url>
    <content><![CDATA[<h2 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython 3 æºç æ–‡ä»¶ä»¥ UTF-8 ç¼–ç ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯ unicode å­—ç¬¦ä¸²ã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ºæºç æ–‡ä»¶æŒ‡å®šä¸åŒçš„ç¼–ç ï¼š<br><code># -*- coding: cp-1252 -*-</code></p>
<h2 id="æ ‡è¯†ç¬¦"><a href="#æ ‡è¯†ç¬¦" class="headerlink" title="æ ‡è¯†ç¬¦"></a>æ ‡è¯†ç¬¦</h2><ul>
<li>ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»æ˜¯å­—æ¯è¡¨ä¸­å­—æ¯æˆ–ä¸‹åˆ’çº¿ _ ã€‚</li>
<li>æ ‡è¯†ç¬¦çš„å…¶ä»–çš„éƒ¨åˆ†ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆã€‚</li>
<li>æ ‡è¯†ç¬¦å¯¹å¤§å°å†™æ•æ„Ÿã€‚<br>åœ¨ Python 3 ä¸­ï¼Œå¯ä»¥ç”¨ä¸­æ–‡ä½œä¸ºå˜é‡åï¼Œé ASCII æ ‡è¯†ç¬¦ä¹Ÿæ˜¯å…è®¸çš„äº†ã€‚</li>
</ul>
<h2 id="pythonä¿ç•™å­—"><a href="#pythonä¿ç•™å­—" class="headerlink" title="pythonä¿ç•™å­—"></a>pythonä¿ç•™å­—</h2><p>import keyword<br>keyword.kwlist<br>[â€˜Falseâ€™, â€˜Noneâ€™, â€˜Trueâ€™, â€˜andâ€™, â€˜asâ€™, â€˜assertâ€™, â€˜breakâ€™, â€˜classâ€™, â€˜continueâ€™, â€˜defâ€™, â€˜delâ€™, â€˜elifâ€™, â€˜elseâ€™, â€˜exceptâ€™, â€˜finallyâ€™, â€˜forâ€™, â€˜fromâ€™, â€˜globalâ€™, â€˜ifâ€™, â€˜importâ€™, â€˜inâ€™, â€˜isâ€™, â€˜lambdaâ€™, â€˜nonlocalâ€™, â€˜notâ€™, â€˜orâ€™, â€˜passâ€™, â€˜raiseâ€™, â€˜returnâ€™, â€˜tryâ€™, â€˜whileâ€™, â€˜withâ€™, â€˜yieldâ€™]</p>
<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>Pythonä¸­å•è¡Œæ³¨é‡Šä»¥ # å¼€å¤´,å¤šè¡Œæ³¨é‡Šå¯ä»¥ç”¨å¤šä¸ª # å·ï¼Œè¿˜æœ‰ â€˜â€™â€™ å’Œ â€œâ€â€ï¼š</p>
<h2 id="è¡Œä¸ç¼©è¿›"><a href="#è¡Œä¸ç¼©è¿›" class="headerlink" title="è¡Œä¸ç¼©è¿›"></a>è¡Œä¸ç¼©è¿›</h2><p>pythonæœ€å…·ç‰¹è‰²çš„å°±æ˜¯ä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºä»£ç å—ï¼Œä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å· {} ã€‚<br>ç¼©è¿›çš„ç©ºæ ¼æ•°æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªä»£ç å—çš„è¯­å¥å¿…é¡»åŒ…å«ç›¸åŒçš„ç¼©è¿›ç©ºæ ¼æ•°ã€‚</p>
<h2 id="å¤šè¡Œè¯­å¥"><a href="#å¤šè¡Œè¯­å¥" class="headerlink" title="å¤šè¡Œè¯­å¥"></a>å¤šè¡Œè¯­å¥</h2><p>Python é€šå¸¸æ˜¯ä¸€è¡Œå†™å®Œä¸€æ¡è¯­å¥ï¼Œä½†å¦‚æœè¯­å¥å¾ˆé•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åæ–œæ  \ æ¥å®ç°å¤šè¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">total = item_one + \</span><br><span class="line">        item_two + \</span><br><span class="line">        item_three</span><br></pre></td></tr></table></figure>

<p>åœ¨ [], {}, æˆ– () ä¸­çš„å¤šè¡Œè¯­å¥ï¼Œä¸éœ€è¦ä½¿ç”¨åæ–œæ  \ï¼Œä¾‹å¦‚ï¼š</p>
<p><code>total = [&#39;item_one&#39;, &#39;item_two&#39;, &#39;item_three&#39;,         &#39;item_four&#39;, &#39;item_five&#39;]</code></p>
<h2 id="æ•°å­—-Number-ç±»å‹"><a href="#æ•°å­—-Number-ç±»å‹" class="headerlink" title="æ•°å­—(Number)ç±»å‹"></a>æ•°å­—(Number)ç±»å‹</h2><p>pythonä¸­æ•°å­—æœ‰å››ç§ç±»å‹ï¼šæ•´æ•°ã€å¸ƒå°”å‹ã€æµ®ç‚¹æ•°å’Œå¤æ•°ã€‚</p>
<ul>
<li>int (æ•´æ•°) , å¦‚ 1, åªæœ‰ä¸€ç§æ•´æ•°ç±»å‹ intï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œæ²¡æœ‰ python2 ä¸­çš„ Longã€‚</li>
<li>bool (å¸ƒå°”), å¦‚ Trueã€‚</li>
<li>float (æµ®ç‚¹æ•°), å¦‚ 1.23ã€3E-2</li>
<li>complex (å¤æ•°), å¦‚ 1 + 2jã€ 1.1 + 2.2j</li>
</ul>
<h2 id="å­—ç¬¦ä¸²-String"><a href="#å­—ç¬¦ä¸²-String" class="headerlink" title="å­—ç¬¦ä¸²(String)"></a>å­—ç¬¦ä¸²(String)</h2><ul>
<li>pythonä¸­å•å¼•å·å’ŒåŒå¼•å·ä½¿ç”¨å®Œå…¨ç›¸åŒã€‚</li>
<li>ä½¿ç”¨ä¸‰å¼•å·(â€˜â€™â€™ æˆ– â€œâ€â€)å¯ä»¥æŒ‡å®šä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²ã€‚</li>
<li>è½¬ä¹‰ç¬¦ \</li>
<li>åæ–œæ å¯ä»¥ç”¨æ¥è½¬ä¹‰ï¼Œä½¿ç”¨rå¯ä»¥è®©åæ–œæ ä¸å‘ç”Ÿè½¬ä¹‰ã€‚ã€‚ å¦‚ râ€this is a line with \nâ€ åˆ™\nä¼šæ˜¾ç¤ºï¼Œå¹¶ä¸æ˜¯æ¢è¡Œã€‚</li>
<li>æŒ‰å­—é¢æ„ä¹‰çº§è”å­—ç¬¦ä¸²ï¼Œå¦‚â€this â€œ â€œis â€œ â€œstringâ€ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºthis is stringã€‚</li>
<li>å­—ç¬¦ä¸²å¯ä»¥ç”¨ + è¿ç®—ç¬¦è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨ * è¿ç®—ç¬¦é‡å¤ã€‚</li>
<li>Python ä¸­çš„å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç´¢å¼•æ–¹å¼ï¼Œä»å·¦å¾€å³ä»¥ 0 å¼€å§‹ï¼Œä»å³å¾€å·¦ä»¥ -1 å¼€å§‹ã€‚</li>
<li>Pythonä¸­çš„å­—ç¬¦ä¸²ä¸èƒ½æ”¹å˜ã€‚</li>
<li>Python æ²¡æœ‰å•ç‹¬çš„å­—ç¬¦ç±»å‹ï¼Œä¸€ä¸ªå­—ç¬¦å°±æ˜¯é•¿åº¦ä¸º 1 çš„å­—ç¬¦ä¸²ã€‚</li>
<li>å­—ç¬¦ä¸²çš„æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼šå˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡:æ­¥é•¿]</li>
</ul>
<h2 id="ç©ºè¡Œ"><a href="#ç©ºè¡Œ" class="headerlink" title="ç©ºè¡Œ"></a>ç©ºè¡Œ</h2><p>å‡½æ•°ä¹‹é—´æˆ–ç±»çš„æ–¹æ³•ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ï¼Œè¡¨ç¤ºä¸€æ®µæ–°çš„ä»£ç çš„å¼€å§‹ã€‚ç±»å’Œå‡½æ•°å…¥å£ä¹‹é—´ä¹Ÿç”¨ä¸€è¡Œç©ºè¡Œåˆ†éš”ï¼Œä»¥çªå‡ºå‡½æ•°å…¥å£çš„å¼€å§‹ã€‚</p>
<p>ç©ºè¡Œä¸ä»£ç ç¼©è¿›ä¸åŒï¼Œç©ºè¡Œå¹¶ä¸æ˜¯Pythonè¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚ä¹¦å†™æ—¶ä¸æ’å…¥ç©ºè¡Œï¼ŒPythonè§£é‡Šå™¨è¿è¡Œä¹Ÿä¸ä¼šå‡ºé”™ã€‚ä½†æ˜¯ç©ºè¡Œçš„ä½œç”¨åœ¨äºåˆ†éš”ä¸¤æ®µä¸åŒåŠŸèƒ½æˆ–å«ä¹‰çš„ä»£ç ï¼Œä¾¿äºæ—¥åä»£ç çš„ç»´æŠ¤æˆ–é‡æ„ã€‚</p>
<p>è®°ä½ï¼šç©ºè¡Œä¹Ÿæ˜¯ç¨‹åºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h2 id="åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥"><a href="#åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥" class="headerlink" title="åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥"></a>åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥</h2><p>Python å¯ä»¥åœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨å¤šæ¡è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä½¿ç”¨åˆ†å· ; åˆ†å‰²ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> sys; x = <span class="string">&#x27;runoob&#x27;</span>; sys.stdout.write(x + <span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„"><a href="#å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„" class="headerlink" title="å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„"></a>å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„</h2><p>ç¼©è¿›ç›¸åŒçš„ä¸€ç»„è¯­å¥æ„æˆä¸€ä¸ªä»£ç å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä»£ç ç»„ã€‚</p>
<p>åƒifã€whileã€defå’Œclassè¿™æ ·çš„å¤åˆè¯­å¥ï¼Œé¦–è¡Œä»¥å…³é”®å­—å¼€å§‹ï¼Œä»¥å†’å·( : )ç»“æŸï¼Œè¯¥è¡Œä¹‹åçš„ä¸€è¡Œæˆ–å¤šè¡Œä»£ç æ„æˆä»£ç ç»„ã€‚</p>
<p>æˆ‘ä»¬å°†é¦–è¡ŒåŠåé¢çš„ä»£ç ç»„ç§°ä¸ºä¸€ä¸ªå­å¥(clause)ã€‚</p>
<p>å¦‚ä¸‹å®ä¾‹ï¼š  </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> expression : </span><br><span class="line">   suite</span><br><span class="line"><span class="keyword">elif</span> expression : </span><br><span class="line">   suite </span><br><span class="line"><span class="keyword">else</span> : </span><br><span class="line">   suite</span><br><span class="line">```      </span><br><span class="line"></span><br><span class="line"><span class="comment">## print è¾“å‡º</span></span><br><span class="line"><span class="built_in">print</span> é»˜è®¤è¾“å‡ºæ˜¯æ¢è¡Œçš„ï¼Œå¦‚æœè¦å®ç°ä¸æ¢è¡Œéœ€è¦åœ¨å˜é‡æœ«å°¾åŠ ä¸Š end=<span class="string">&quot;&quot;</span>ï¼š</span><br><span class="line"></span><br><span class="line"><span class="comment">## import ä¸ from...import</span></span><br><span class="line">åœ¨ python ç”¨ <span class="keyword">import</span> æˆ–è€… <span class="keyword">from</span>...<span class="keyword">import</span> æ¥å¯¼å…¥ç›¸åº”çš„æ¨¡å—ã€‚</span><br><span class="line"></span><br><span class="line">å°†æ•´ä¸ªæ¨¡å—(somemodule)å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š <span class="keyword">import</span> somemodule</span><br><span class="line"></span><br><span class="line">ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æŸä¸ªå‡½æ•°,æ ¼å¼ä¸ºï¼š <span class="keyword">from</span> somemodule <span class="keyword">import</span> somefunction</span><br><span class="line"></span><br><span class="line">ä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªå‡½æ•°,æ ¼å¼ä¸ºï¼š <span class="keyword">from</span> somemodule <span class="keyword">import</span> firstfunc, secondfunc, thirdfunc</span><br><span class="line"></span><br><span class="line">å°†æŸä¸ªæ¨¡å—ä¸­çš„å…¨éƒ¨å‡½æ•°å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š <span class="keyword">from</span> somemodule <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">## å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"></span><br><span class="line">å¾ˆå¤šç¨‹åºå¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œæ¥æŸ¥çœ‹ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒPythonå¯ä»¥ä½¿ç”¨-hå‚æ•°æŸ¥çœ‹å„å‚æ•°å¸®åŠ©ä¿¡æ¯ï¼š</span><br></pre></td></tr></table></figure>
<p>$ python -h<br>usage: python [option] â€¦ [-c cmd | -m mod | file | -] [arg] â€¦<br>Options and arguments (and corresponding environment variables):<br>-c cmd : program passed in as string (terminates option list)<br>-d     : debug output from parser (also PYTHONDEBUG=x)<br>-E     : ignore environment variables (such as PYTHONPATH)<br>-h     : print this help message and exit</p>
<p>[ etc. ]</p>
<p>```<br>æˆ‘ä»¬åœ¨ä½¿ç”¨è„šæœ¬å½¢å¼æ‰§è¡Œ Python æ—¶ï¼Œå¯ä»¥æ¥æ”¶å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•°;</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>python3åŸºæœ¬æ•°æ®ç±»å‹</title>
    <url>/wiki/python%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<p>Python ä¸­çš„å˜é‡ä¸éœ€è¦å£°æ˜ã€‚æ¯ä¸ªå˜é‡åœ¨ä½¿ç”¨å‰éƒ½å¿…é¡»èµ‹å€¼ï¼Œå˜é‡èµ‹å€¼ä»¥åè¯¥å˜é‡æ‰ä¼šè¢«åˆ›å»ºã€‚</p>
<p>åœ¨ Python ä¸­ï¼Œå˜é‡å°±æ˜¯å˜é‡ï¼Œå®ƒæ²¡æœ‰ç±»å‹ï¼Œæˆ‘ä»¬æ‰€è¯´çš„â€ç±»å‹â€æ˜¯å˜é‡æ‰€æŒ‡çš„å†…å­˜ä¸­å¯¹è±¡çš„ç±»å‹ã€‚</p>
<p>ç­‰å·ï¼ˆ=ï¼‰ç”¨æ¥ç»™å˜é‡èµ‹å€¼ã€‚</p>
<p>ç­‰å·ï¼ˆ=ï¼‰è¿ç®—ç¬¦å·¦è¾¹æ˜¯ä¸€ä¸ªå˜é‡å,ç­‰å·ï¼ˆ=ï¼‰è¿ç®—ç¬¦å³è¾¹æ˜¯å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼</p>
<h2 id="æ ‡å‡†æ•°æ®ç±»å‹"><a href="#æ ‡å‡†æ•°æ®ç±»å‹" class="headerlink" title="æ ‡å‡†æ•°æ®ç±»å‹"></a>æ ‡å‡†æ•°æ®ç±»å‹</h2><p>Python3 ä¸­æœ‰å…­ä¸ªæ ‡å‡†çš„æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>Numberï¼ˆæ•°å­—ï¼‰</li>
<li>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
<li>Listï¼ˆåˆ—è¡¨ï¼‰</li>
<li>Tupleï¼ˆå…ƒç»„ï¼‰</li>
<li>Setï¼ˆé›†åˆï¼‰</li>
<li>Dictionaryï¼ˆå­—å…¸ï¼‰</li>
<li>Python3 çš„å…­ä¸ªæ ‡å‡†æ•°æ®ç±»å‹ä¸­ï¼š</li>
</ul>
<p><code>ä¸å¯å˜æ•°æ®</code>ï¼ˆ3 ä¸ªï¼‰ï¼šNumberï¼ˆæ•°å­—ï¼‰ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Tupleï¼ˆå…ƒç»„ï¼‰ï¼›<br><code>å¯å˜æ•°æ®</code>ï¼ˆ3 ä¸ªï¼‰ï¼šListï¼ˆåˆ—è¡¨ï¼‰ã€Dictionaryï¼ˆå­—å…¸ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€‚</p>
<h2 id="Numberï¼ˆæ•°å­—ï¼‰"><a href="#Numberï¼ˆæ•°å­—ï¼‰" class="headerlink" title="Numberï¼ˆæ•°å­—ï¼‰"></a>Numberï¼ˆæ•°å­—ï¼‰</h2><p>Python3 æ”¯æŒ intã€floatã€boolã€complexï¼ˆå¤æ•°ï¼‰ã€‚</p>
<p>åœ¨Python 3é‡Œï¼Œåªæœ‰ä¸€ç§æ•´æ•°ç±»å‹ intï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œæ²¡æœ‰ python2 ä¸­çš„ Longã€‚</p>
<p>åƒå¤§å¤šæ•°è¯­è¨€ä¸€æ ·ï¼Œæ•°å€¼ç±»å‹çš„èµ‹å€¼å’Œè®¡ç®—éƒ½æ˜¯å¾ˆç›´è§‚çš„ã€‚</p>
<p>å†…ç½®çš„ type() å‡½æ•°å¯ä»¥ç”¨æ¥æŸ¥è¯¢å˜é‡æ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a, b, c, d = <span class="number">20</span>, <span class="number">5.5</span>, <span class="literal">True</span>, <span class="number">4</span>+<span class="number">3j</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="built_in">type</span>(a), <span class="built_in">type</span>(b), <span class="built_in">type</span>(c), <span class="built_in">type</span>(d))</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">int</span>&#x27;&gt; &lt;<span class="title">class</span> &#x27;<span class="title">float</span>&#x27;&gt; &lt;<span class="title">class</span> &#x27;<span class="title">bool</span>&#x27;&gt; &lt;<span class="title">class</span> &#x27;<span class="title">complex</span>&#x27;&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–è¿˜å¯ä»¥ç”¨ isinstance æ¥åˆ¤æ–­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="number">111</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(a, <span class="built_in">int</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>âš ï¸ isinstance å’Œ type çš„åŒºåˆ«åœ¨äºï¼š<br>type()ä¸ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚<br>isinstance()ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚</p>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šPython3 ä¸­ï¼Œbool æ˜¯ int çš„å­ç±»ï¼ŒTrue å’Œ False å¯ä»¥å’Œæ•°å­—ç›¸åŠ  True==1ï¼ŒFalse==0 æ˜¯ä¼šè¿”å› Tureï¼Œä½†å¯ä»¥é€šè¿‡ is æ¥åˆ¤æ–­ç±»å‹ã€‚<br>1ã€Pythonå¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ï¼Œå¦‚a, b = 1, 2ã€‚<br>2ã€ä¸€ä¸ªå˜é‡å¯ä»¥é€šè¿‡èµ‹å€¼æŒ‡å‘ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚<br>3ã€æ•°å€¼çš„é™¤æ³•åŒ…å«ä¸¤ä¸ªè¿ç®—ç¬¦ï¼š/ è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ// è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚<br>4ã€åœ¨æ··åˆè®¡ç®—æ—¶ï¼ŒPythonä¼šæŠŠæ•´å‹è½¬æ¢æˆä¸ºæµ®ç‚¹æ•°ã€‚</p>
</blockquote>
<h2 id="Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"><a href="#Stringï¼ˆå­—ç¬¦ä¸²ï¼‰" class="headerlink" title="Stringï¼ˆå­—ç¬¦ä¸²ï¼‰"></a>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</h2><p>Pythonä¸­çš„å­—ç¬¦ä¸²ç”¨å•å¼•å· â€˜ æˆ–åŒå¼•å· â€œ æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ä½¿ç”¨åæ–œæ  \ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚<br>å­—ç¬¦ä¸²çš„æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><code>å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</code><br>ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚</p>
<h2 id="Listï¼ˆåˆ—è¡¨ï¼‰"><a href="#Listï¼ˆåˆ—è¡¨ï¼‰" class="headerlink" title="Listï¼ˆåˆ—è¡¨ï¼‰"></a>Listï¼ˆåˆ—è¡¨ï¼‰</h2><p>Listï¼ˆåˆ—è¡¨ï¼‰ æ˜¯ Python ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„æ•°æ®ç±»å‹ã€‚</p>
<p>åˆ—è¡¨å¯ä»¥å®Œæˆå¤§å¤šæ•°é›†åˆç±»çš„æ•°æ®ç»“æ„å®ç°ã€‚åˆ—è¡¨ä¸­å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸ç›¸åŒï¼Œå®ƒæ”¯æŒæ•°å­—ï¼Œå­—ç¬¦ä¸²ç”šè‡³å¯ä»¥åŒ…å«åˆ—è¡¨ï¼ˆæ‰€è°“åµŒå¥—ï¼‰ã€‚</p>
<p>åˆ—è¡¨æ˜¯å†™åœ¨æ–¹æ‹¬å· [] ä¹‹é—´ã€ç”¨é€—å·åˆ†éš”å¼€çš„å…ƒç´ åˆ—è¡¨ã€‚</p>
<p>å’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œåˆ—è¡¨åŒæ ·å¯ä»¥è¢«ç´¢å¼•å’Œæˆªå–ï¼Œåˆ—è¡¨è¢«æˆªå–åè¿”å›ä¸€ä¸ªåŒ…å«æ‰€éœ€å…ƒç´ çš„æ–°åˆ—è¡¨ã€‚</p>
<p>åˆ—è¡¨æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š<br><code>å˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</code><br>ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚</p>
<h2 id="Tupleï¼ˆå…ƒç»„ï¼‰"><a href="#Tupleï¼ˆå…ƒç»„ï¼‰" class="headerlink" title="Tupleï¼ˆå…ƒç»„ï¼‰"></a>Tupleï¼ˆå…ƒç»„ï¼‰</h2><p>å…ƒç»„ï¼ˆtupleï¼‰ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹ã€‚å…ƒç»„å†™åœ¨å°æ‹¬å· () é‡Œï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</p>
<p>å…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹ä¹Ÿå¯ä»¥ä¸ç›¸åŒï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">tuple</span> = ( <span class="string">&#x27;abcd&#x27;</span>, <span class="number">786</span> , <span class="number">2.23</span>, <span class="string">&#x27;runoob&#x27;</span>, <span class="number">70.2</span>  )</span><br><span class="line">tinytuple = (<span class="number">123</span>, <span class="string">&#x27;runoob&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">tuple</span>)             <span class="comment"># è¾“å‡ºå®Œæ•´å…ƒç»„</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">tuple</span>[<span class="number">0</span>])          <span class="comment"># è¾“å‡ºå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">tuple</span>[<span class="number">1</span>:<span class="number">3</span>])        <span class="comment"># è¾“å‡ºä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">tuple</span>[<span class="number">2</span>:])         <span class="comment"># è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span> (tinytuple * <span class="number">2</span>)     <span class="comment"># è¾“å‡ºä¸¤æ¬¡å…ƒç»„</span></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">tuple</span> + tinytuple) <span class="comment"># è¿æ¥å…ƒç»„</span></span><br></pre></td></tr></table></figure>

<h2 id="Setï¼ˆé›†åˆï¼‰"><a href="#Setï¼ˆé›†åˆï¼‰" class="headerlink" title="Setï¼ˆé›†åˆï¼‰"></a>Setï¼ˆé›†åˆï¼‰</h2><p>é›†åˆï¼ˆsetï¼‰æ˜¯ç”±ä¸€ä¸ªæˆ–æ•°ä¸ªå½¢æ€å„å¼‚çš„å¤§å°æ•´ä½“ç»„æˆçš„ï¼Œæ„æˆé›†åˆçš„äº‹ç‰©æˆ–å¯¹è±¡ç§°ä½œå…ƒç´ æˆ–æ˜¯æˆå‘˜ã€‚</p>
<p>åŸºæœ¬åŠŸèƒ½æ˜¯è¿›è¡Œæˆå‘˜å…³ç³»æµ‹è¯•å’Œåˆ é™¤é‡å¤å…ƒç´ ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨å¤§æ‹¬å· { } æˆ–è€… set() å‡½æ•°åˆ›å»ºé›†åˆï¼Œæ³¨æ„ï¼šåˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ set() è€Œä¸æ˜¯ { }ï¼Œå› ä¸º { } æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ã€‚</p>
<p>åˆ›å»ºæ ¼å¼ï¼š<br><code>parame = &#123;value01,value02,...&#125;</code> æˆ–è€… <code>set(value)</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line">sites = &#123;<span class="string">&#x27;Google&#x27;</span>, <span class="string">&#x27;Taobao&#x27;</span>, <span class="string">&#x27;Runoob&#x27;</span>, <span class="string">&#x27;Facebook&#x27;</span>, <span class="string">&#x27;Zhihu&#x27;</span>, <span class="string">&#x27;Baidu&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sites)   <span class="comment"># è¾“å‡ºé›†åˆï¼Œé‡å¤çš„å…ƒç´ è¢«è‡ªåŠ¨å»æ‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆå‘˜æµ‹è¯•</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;Runoob&#x27;</span> <span class="keyword">in</span> sites :</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Runoob åœ¨é›†åˆä¸­&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Runoob ä¸åœ¨é›†åˆä¸­&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># setå¯ä»¥è¿›è¡Œé›†åˆè¿ç®—</span></span><br><span class="line">a = <span class="built_in">set</span>(<span class="string">&#x27;abracadabra&#x27;</span>)</span><br><span class="line">b = <span class="built_in">set</span>(<span class="string">&#x27;alacazam&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a - b)     <span class="comment"># a å’Œ b çš„å·®é›†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a | b)     <span class="comment"># a å’Œ b çš„å¹¶é›†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a &amp; b)     <span class="comment"># a å’Œ b çš„äº¤é›†</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a ^ b)     <span class="comment"># a å’Œ b ä¸­ä¸åŒæ—¶å­˜åœ¨çš„å…ƒç´ </span></span><br></pre></td></tr></table></figure>

<h2 id="Dictionaryï¼ˆå­—å…¸ï¼‰"><a href="#Dictionaryï¼ˆå­—å…¸ï¼‰" class="headerlink" title="Dictionaryï¼ˆå­—å…¸ï¼‰"></a>Dictionaryï¼ˆå­—å…¸ï¼‰</h2><p>å­—å…¸ï¼ˆdictionaryï¼‰æ˜¯Pythonä¸­å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å†…ç½®æ•°æ®ç±»å‹ã€‚</p>
<p>åˆ—è¡¨æ˜¯æœ‰åºçš„å¯¹è±¡é›†åˆï¼Œå­—å…¸æ˜¯æ— åºçš„å¯¹è±¡é›†åˆã€‚ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šå­—å…¸å½“ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡é”®æ¥å­˜å–çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡åç§»å­˜å–ã€‚</p>
<p>å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå­—å…¸ç”¨ { } æ ‡è¯†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— åºçš„ é”®(key) : å€¼(value) çš„é›†åˆã€‚</p>
<p>é”®(key)å¿…é¡»ä½¿ç”¨ä¸å¯å˜ç±»å‹ã€‚</p>
<p>åœ¨åŒä¸€ä¸ªå­—å…¸ä¸­ï¼Œé”®(key)å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚</p>
<pre><code class="python">#!/usr/bin/python3

dict = &#123;&#125;
dict[&#39;one&#39;] = &quot;1 - èœé¸Ÿæ•™ç¨‹&quot;
dict[2]     = &quot;2 - èœé¸Ÿå·¥å…·&quot;

tinydict = &#123;&#39;name&#39;: &#39;runoob&#39;,&#39;code&#39;:1, &#39;site&#39;: &#39;www.runoob.com&#39;&#125;


print (dict[&#39;one&#39;])       # è¾“å‡ºé”®ä¸º &#39;one&#39; çš„å€¼
print (dict[2])           # è¾“å‡ºé”®ä¸º 2 çš„å€¼
print (tinydict)          # è¾“å‡ºå®Œæ•´çš„å­—å…¸
print (tinydict.keys())   # è¾“å‡ºæ‰€æœ‰é”®
print (tinydict.values()) # è¾“å‡ºæ‰€æœ‰å€¼
</code></pre>
<p>æ³¨æ„ï¼š<br>1ã€å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå®ƒçš„å…ƒç´ æ˜¯é”®å€¼å¯¹ã€‚<br>2ã€å­—å…¸çš„å…³é”®å­—å¿…é¡»ä¸ºä¸å¯å˜ç±»å‹ï¼Œä¸”ä¸èƒ½é‡å¤ã€‚<br>3ã€åˆ›å»ºç©ºå­—å…¸ä½¿ç”¨ { }ã€‚</p>
<h2 id="Pythonæ•°æ®ç±»å‹è½¬æ¢"><a href="#Pythonæ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="Pythonæ•°æ®ç±»å‹è½¬æ¢"></a>Pythonæ•°æ®ç±»å‹è½¬æ¢</h2><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®å†…ç½®çš„ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä½ åªéœ€è¦å°†æ•°æ®ç±»å‹ä½œä¸ºå‡½æ•°åå³å¯ã€‚</p>
<p>ä»¥ä¸‹å‡ ä¸ªå†…ç½®çš„å‡½æ•°å¯ä»¥æ‰§è¡Œæ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚è¿™äº›å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¡¨ç¤ºè½¬æ¢çš„å€¼ã€‚</p>
<img src = 'https://oscimg.oschina.net/oscnet/up-2af36cf02d5a8c9ba5c9148154bbdd83207.png' whdth='700'>]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonæ“ä½œelasticsearch</title>
    <url>/wiki/python%E6%93%8D%E4%BD%9Celasticsearch/</url>
    <content><![CDATA[<h2 id="ä¸‹è½½pythonå¯¹åº”çš„elasticsearchä¾èµ–åŒ…"><a href="#ä¸‹è½½pythonå¯¹åº”çš„elasticsearchä¾èµ–åŒ…" class="headerlink" title="ä¸‹è½½pythonå¯¹åº”çš„elasticsearchä¾èµ–åŒ…"></a>ä¸‹è½½pythonå¯¹åº”çš„elasticsearchä¾èµ–åŒ…</h2><p><code>pip3 install elasticsearch==7.10.0</code></p>
<h2 id="pythonæ“ä½œelasticsearchä»£ç "><a href="#pythonæ“ä½œelasticsearchä»£ç " class="headerlink" title="pythonæ“ä½œelasticsearchä»£ç "></a>pythonæ“ä½œelasticsearchä»£ç </h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;init ...&quot;</span>)</span><br><span class="line">es = Elasticsearch([&#123;<span class="string">&#x27;host&#x27;</span>:<span class="string">&#x27;XXXXXX&#x27;</span>,<span class="string">&#x27;port&#x27;</span>:<span class="number">9200</span>&#125;], http_auth=(<span class="string">&#x27;elastic&#x27;</span>, <span class="string">&#x27;XXXXXX&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(es.get(index=&#x27;yj_ip_pool&#x27;, doc_type=&#x27;_doc&#x27;, id=&#x27;9256058&#x27;))</span></span><br><span class="line">countRes = es.count(index=<span class="string">&#x27;yj_ip_pool&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(countRes)</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥è¯¢æ•ˆæœ"><a href="#æŸ¥è¯¢æ•ˆæœ" class="headerlink" title="æŸ¥è¯¢æ•ˆæœ"></a>æŸ¥è¯¢æ•ˆæœ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gaolei:awesome-python3-webapp gaolei$ /usr/local/opt/python/bin/python3.7 /Users/gaolei/Documents/DemoProjects/awesome-python3-webapp/www/es_test.py</span><br><span class="line">init ...</span><br><span class="line">&#123;&#x27;count&#x27;: 20095400, &#x27;_shards&#x27;: &#123;&#x27;total&#x27;: 1, &#x27;successful&#x27;: 1, &#x27;skipped&#x27;: 0, &#x27;failed&#x27;: 0&#125;&#125;</span><br><span class="line">gaolei:awesome-python3-webapp gaolei$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºä»€ä¹ˆç¦æ­¢å¼€å‘äººå‘˜ä¿®æ”¹ serialVersionUID å­—æ®µçš„å€¼?</title>
    <url>/wiki/%E4%B8%BA%E4%BB%80%E4%B9%88%E7%A6%81%E6%AD%A2%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98%E4%BF%AE%E6%94%B9-serialVersionUID-%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC/</url>
    <content><![CDATA[<blockquote>
<p>åºåˆ—åŒ–æ˜¯ä¸€ç§å¯¹è±¡æŒä¹…åŒ–çš„æ‰‹æ®µã€‚æ™®éåº”ç”¨åœ¨ç½‘ç»œä¼ è¾“ã€RMI ç­‰åœºæ™¯ä¸­ã€‚ç±»é€š è¿‡å®ç° java.io.Serializable æ¥å£ä»¥å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½ã€‚<br><a href="http://www.hollischuang.com/archives/1150">Java å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€æ·±å…¥åˆ†æ Java çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€å•ä¾‹ä¸ åºåˆ—åŒ–çš„é‚£äº›äº‹å„¿</a>  </p>
</blockquote>
<p>åœ¨è¿™å‡ ç¯‡æ–‡ç« ä¸­ï¼Œåˆ†åˆ«ä»‹ç»è¿‡äº†åºåˆ—åŒ–æ¶‰åŠåˆ°çš„ç±»å’Œæ¥å£ã€å¦‚ä½•è‡ªå®šä¹‰åºåˆ—åŒ– ç­–ç•¥ã€transient å…³é”®å­—å’Œåºåˆ—åŒ–çš„å…³ç³»ç­‰ï¼Œè¿˜é€šè¿‡å­¦ä¹  ArrayList å¯¹åºåˆ—åŒ–çš„å®ç°æº ç æ·±å…¥å­¦ä¹ äº†åºåˆ—åŒ–ã€‚å¹¶ä¸”è¿˜æ‹“å±•åˆ†æäº†ä¸€ä¸‹åºåˆ—åŒ–å¯¹å•ä¾‹çš„å½±å“ç­‰ã€‚<br>ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹å¹¶æœªå±•å¼€ä»‹ç»ï¼Œé‚£å°±æ˜¯å…³äº serialVersionUID ã€‚è¿™ä¸ª å­—æ®µåˆ°åº•æœ‰ä»€ä¹ˆç”¨?å¦‚æœä¸è®¾ç½®ä¼šæ€ä¹ˆæ ·?ä¸ºä»€ä¹ˆã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¸­æœ‰ä»¥ä¸‹è§„å®š:</p>
<img src='https://oscimg.oschina.net/oscnet/up-5b1a6020460edc9c688c054bdbad957cc28.png'>   


<h2 id="èƒŒæ™¯çŸ¥è¯†"><a href="#èƒŒæ™¯çŸ¥è¯†" class="headerlink" title="èƒŒæ™¯çŸ¥è¯†"></a>èƒŒæ™¯çŸ¥è¯†</h2><p>Serializable å’Œ Externalizable<br>ç±»é€šè¿‡å®ç° java.io.Serializable æ¥å£ä»¥å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½ã€‚æœªå®ç°æ­¤æ¥ å£çš„ç±»å°†æ— æ³•è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ã€‚å¯åºåˆ—åŒ–ç±»çš„æ‰€æœ‰å­ç±»å‹æœ¬èº«éƒ½æ˜¯å¯åºåˆ— åŒ–çš„ã€‚<br>å¦‚æœè¯»è€…çœ‹è¿‡ Serializable çš„æºç ï¼Œå°±ä¼šå‘ç°ï¼Œä»–åªæ˜¯ä¸€ä¸ªç©ºçš„æ¥å£ï¼Œé‡Œ é¢ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡æœ‰ã€‚Serializable æ¥å£æ²¡æœ‰æ–¹æ³•æˆ–å­—æ®µï¼Œä»…ç”¨äºæ ‡è¯†å¯åºåˆ—åŒ–çš„ è¯­ä¹‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°è¿™ä¸ªæ¥å£ï¼Œæƒ³è¦è¢«åºåˆ—åŒ–çš„è¯ï¼Œå°±ä¼šæŠ›å‡º java. io.NotSerializableException å¼‚å¸¸ã€‚</p>
<p>å®ƒæ˜¯æ€ä¹ˆä¿è¯åªæœ‰å®ç°äº†è¯¥æ¥å£çš„æ–¹æ³•æ‰èƒ½è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å‘¢?<br>åŸå› æ˜¯åœ¨æ‰§è¡Œåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œåˆ°ä»¥ä¸‹ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            writeString((String) obj, unshared);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cl.isArray()) &#123;</span><br><span class="line">            writeArray(obj, desc, unshared);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Enum) &#123;</span><br><span class="line">            writeEnum((Enum&lt;?&gt;) obj, desc, unshared);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> Serializable) &#123;</span><br><span class="line">            writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (extendedDebugInfo) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(</span><br><span class="line">                        cl.getName() + <span class="string">&quot;\n&quot;</span> + debugInfoStack.toString());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NotSerializableException(cl.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿›è¡Œåºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šåˆ¤æ–­è¦è¢«åºåˆ—åŒ–çš„ç±»æ˜¯å¦æ˜¯ Enumã€Array å’Œ Serializable ç±»å‹ï¼Œå¦‚æœéƒ½ä¸æ˜¯åˆ™ç›´æ¥æŠ›å‡º NotSerializableExceptionã€‚<br>Java ä¸­è¿˜æä¾›äº† Externalizable æ¥å£ï¼Œä¹Ÿå¯ä»¥å®ç°å®ƒæ¥æä¾›åºåˆ—åŒ–èƒ½åŠ›ã€‚</p>
<p>Externalizable ç»§æ‰¿è‡ª Serializableï¼Œè¯¥æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•: writeExternal() ä¸ readExternal()ã€‚<br>å½“ä½¿ç”¨ Externalizable æ¥å£æ¥è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦å¼€å‘äººå‘˜é‡ å†™ writeExternal() ä¸ readExternal() æ–¹æ³•ã€‚å¦åˆ™æ‰€æœ‰å˜é‡çš„å€¼éƒ½ä¼šå˜æˆé»˜è®¤å€¼ã€‚</p>
<h2 id="transient"><a href="#transient" class="headerlink" title="transient"></a>transient</h2><p>transient å…³é”®å­—çš„ä½œç”¨æ˜¯æ§åˆ¶å˜é‡çš„åºåˆ—åŒ–ï¼Œåœ¨å˜é‡å£°æ˜å‰åŠ ä¸Šè¯¥å…³é”®å­—ï¼Œå¯ ä»¥é˜»æ­¢è¯¥å˜é‡è¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œtransient å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œå¦‚ int å‹çš„æ˜¯ 0ï¼Œå¯¹è±¡å‹çš„æ˜¯ nullã€‚</p>
<h2 id="è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥"></a>è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥</h2><p>åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¢«åºåˆ—åŒ–çš„ç±»ä¸­å®šä¹‰äº† writeObject å’Œ readObject æ–¹æ³•ï¼Œ è™šæ‹Ÿæœºä¼šè¯•å›¾è°ƒç”¨å¯¹è±¡ç±»é‡Œçš„ writeObject å’Œ readObject æ–¹æ³•ï¼Œè¿›è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„ åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ–¹æ³•ï¼Œåˆ™é»˜è®¤è°ƒç”¨æ˜¯ ObjectOutputStream çš„ defaultWriteOb- ject æ–¹æ³•ä»¥åŠ ObjectInputStream çš„ defaultReadObject æ–¹æ³•ã€‚<br>ç”¨æˆ·è‡ªå®šä¹‰çš„ writeObject å’Œ readObject æ–¹æ³•å¯ä»¥å…è®¸ç”¨æˆ·æ§åˆ¶åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œ æ¯”å¦‚å¯ä»¥åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­åŠ¨æ€æ”¹å˜åºåˆ—åŒ–çš„æ•°å€¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šå­—æ®µéœ€è¦å®šä¹‰åºåˆ—åŒ–çš„ç­–ç•¥çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ tran- sient ä¿® é¥°ï¼Œ å¹¶ è‡ª å·± é‡ å†™ writeObject å’Œ readObject æ–¹ æ³•ï¼Œ å¦‚ java.util. ArrayList ä¸­å°±æœ‰è¿™æ ·çš„å®ç°ã€‚</p>
<p>æˆ‘ä»¬éšä¾¿æ‰¾å‡ ä¸ª Java ä¸­å®ç°äº†åºåˆ—åŒ–æ¥å£çš„ç±»ï¼Œå¦‚ Stringã€Integer ç­‰ï¼Œæˆ‘ä»¬ å¯ä»¥å‘ç°ä¸€ä¸ªç»†èŠ‚ï¼Œé‚£å°±æ˜¯è¿™äº›ç±»é™¤äº†å®ç°äº† Serializable å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ª serialVersionUID</p>
<img src='https://oscimg.oschina.net/oscnet/up-74a9507ed04462e44fb2b7dd941d6b00fd4.png'>

<p>é‚£ä¹ˆï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯ serialVersionUID å‘¢?ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™æ ·ä¸€ä¸ªå­—æ®µå‘¢?</p>
<h2 id="ä»€ä¹ˆæ˜¯-serialVersionUID"><a href="#ä»€ä¹ˆæ˜¯-serialVersionUID" class="headerlink" title="ä»€ä¹ˆæ˜¯ serialVersionUID"></a>ä»€ä¹ˆæ˜¯ serialVersionUID</h2><p>åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ Java å¯¹è±¡æ˜¯ä¿å­˜åœ¨ JVM çš„å †å†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ JVM å †ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå¯¹ è±¡ä¹Ÿå°±è·Ÿç€æ¶ˆå¤±äº†ã€‚</p>
<p>è€Œåºåˆ—åŒ–æä¾›äº†ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥è®©ä½ åœ¨å³ä½¿ JVM åœæœºçš„æƒ…å†µä¸‹ä¹Ÿèƒ½æŠŠå¯¹è±¡ä¿å­˜ ä¸‹æ¥çš„æ–¹æ¡ˆã€‚å°±åƒæˆ‘ä»¬å¹³æ—¶ç”¨çš„ U ç›˜ä¸€æ ·ã€‚æŠŠ Java å¯¹è±¡åºåˆ—åŒ–æˆå¯å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢ å¼(å¦‚äºŒè¿›åˆ¶æµ)ï¼Œæ¯”å¦‚ä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œå½“å†æ¬¡éœ€è¦è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä»æ–‡ä»¶ä¸­ è¯»å–å‡ºäºŒè¿›åˆ¶æµï¼Œå†ä»äºŒè¿›åˆ¶æµä¸­ååºåˆ—åŒ–å‡ºå¯¹è±¡ã€‚</p>
<p>è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œä¸€ä¸ªéå¸¸é‡ è¦çš„ä¸€ç‚¹æ˜¯ä¸¤ä¸ªç±»çš„åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´ï¼Œè¿™ä¸ªæ‰€è°“çš„åºåˆ—åŒ– IDï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­ å®šä¹‰çš„ serialVersionUIDã€‚</p>
<h2 id="å¦‚æœ-serialVersionUID-å˜äº†ä¼šæ€æ ·"><a href="#å¦‚æœ-serialVersionUID-å˜äº†ä¼šæ€æ ·" class="headerlink" title="å¦‚æœ serialVersionUID å˜äº†ä¼šæ€æ ·"></a>å¦‚æœ serialVersionUID å˜äº†ä¼šæ€æ ·</h2><p>æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­å§ï¼Œçœ‹çœ‹å¦‚æœ serialVersionUID è¢«ä¿®æ”¹äº†ä¼šå‘ç”Ÿä»€ä¹ˆ?</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableDemo1</span> </span>&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//Initializes The Object User1 user = new User1(); user.setName(&quot;hollis&quot;);</span></span><br><span class="line">                <span class="comment">//Write Obj to File ObjectOutputStream oos = null; try &#123;</span></span><br><span class="line">                oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;tempFile&quot;</span>));</span><br><span class="line">                oos.writeObject(user);</span><br><span class="line">            &#125; <span class="keyword">catch</span>(</span><br><span class="line">            IOException e)</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span></span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                IOUtils.closeQuietly(oos);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User1</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">```        </span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å…ˆæ‰§è¡Œä»¥ä¸Šä»£ç ï¼ŒæŠŠä¸€ä¸ª User1 å¯¹è±¡å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ User1 ç±»ï¼ŒæŠŠ serialVersionUID çš„å€¼æ”¹ä¸º <span class="number">2L</span>ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2L</span>;</span><br><span class="line">            <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.name = name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼ŒæŠŠæ–‡ä»¶ä¸­çš„å¯¹è±¡ååºåˆ—åŒ–å‡ºæ¥:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableDemo2</span> </span>&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//Read Obj from File</span></span><br><span class="line">                File file = <span class="keyword">new</span> File(<span class="string">&quot;tempFile&quot;</span>);</span><br><span class="line">                ObjectInputStream ois = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">                    User1 newUser = (User1) ois.readObject();</span><br><span class="line">                    System.out.println(newUser);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    IOUtils.closeQuietly(ois);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        FileUtils.forceDelete(file);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹</span><br><span class="line">```java</span><br><span class="line">java.io.InvalidClassException: com.hollis.User1; local <span class="class"><span class="keyword">class</span> <span class="title">incompatible</span>: <span class="title">stream</span> <span class="title">classdesc</span></span></span><br><span class="line"><span class="class"><span class="title">serialVersionUID</span> </span>= <span class="number">1</span>, local <span class="class"><span class="keyword">class</span> <span class="title">serialVersionUID</span> </span>= <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œä»¥ä¸Šä»£ç æŠ›å‡ºäº†ä¸€ä¸ª java.io.InvalidClassExceptionï¼Œå¹¶ä¸” æŒ‡å‡º serialVersionUID ä¸ä¸€è‡´ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVM ä¼šæŠŠä¼ æ¥çš„å­—èŠ‚æµä¸­çš„ serialVersio- nUID ä¸æœ¬åœ°ç›¸åº”å®ä½“ç±»çš„ serialVersionUID è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒå°±è®¤ä¸ºæ˜¯ä¸€è‡´ çš„ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šå‡ºç°åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ï¼Œå³æ˜¯ Invalid- CastExceptionã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¸­è§„å®šï¼Œåœ¨å…¼å®¹æ€§å‡çº§ä¸­ï¼Œåœ¨ä¿®æ”¹ç±»çš„æ—¶å€™ï¼Œä¸è¦ ä¿®æ”¹ serialVersionUID çš„åŸå› ã€‚é™¤éæ˜¯å®Œå…¨ä¸å…¼å®¹çš„ä¸¤ä¸ªç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼ŒserialVersionUID å…¶å®æ˜¯éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚</p>
<p>å¦‚æœè¯»è€…æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŠŠå„ä¸ªç‰ˆæœ¬çš„ JDK ä»£ç éƒ½æ‹¿å‡ºæ¥çœ‹ä¸€ä¸‹ï¼Œé‚£äº›å‘ä¸‹å…¼å®¹ çš„ç±»çš„ serialVersionUID æ˜¯æ²¡æœ‰å˜åŒ–è¿‡çš„ã€‚æ¯”å¦‚ String ç±»çš„ serialVersionUIDä¸€ç›´éƒ½æ˜¯ -6849794470754667710Lã€‚</p>
<p>ä½†æ˜¯ï¼Œä½œè€…è®¤ä¸ºï¼Œè¿™ä¸ªè§„èŒƒå…¶å®è¿˜å¯ä»¥å†ä¸¥æ ¼ä¸€äº›ï¼Œé‚£å°±æ˜¯è§„å®š:<br>å¦‚æœä¸€ä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œå°±å¿…é¡»æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª private static final long serialVersionUIDå˜é‡ï¼Œå¹¶ä¸”è®¾ç½®åˆå§‹å€¼ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦æ˜ç¡®å®šä¸€ä¸ª-serialVersionUID"><a href="#ä¸ºä»€ä¹ˆè¦æ˜ç¡®å®šä¸€ä¸ª-serialVersionUID" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ˜ç¡®å®šä¸€ä¸ª serialVersionUID"></a>ä¸ºä»€ä¹ˆè¦æ˜ç¡®å®šä¸€ä¸ª serialVersionUID</h2><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ç±»ä¸­æ˜ç¡®çš„å®šä¹‰ä¸€ä¸ª serialVersionUID çš„è¯ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>
<p>å°è¯•ä¿®æ”¹ä¸Šé¢çš„ demo ä»£ç ï¼Œå…ˆä½¿ç”¨ä»¥ä¸‹ç±»å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥ç±»ä¸­ä¸å®šä¹‰ serialVersionUIDï¼Œå°†å…¶å†™å…¥æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.name = name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ä¿®æ”¹ User1 ç±»ï¼Œå‘å…¶ä¸­å¢åŠ ä¸€ä¸ªå±æ€§ã€‚åœ¨å°è¯•å°†å…¶ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œ å¹¶è¿›è¡Œååºåˆ—åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§ è¡Œ ç»“ æœ:java.io.InvalidClassException: com.hollis.User1; local class incompatible: stream classdesc serialVersionUID = -2986778152837257883, local class serialVersionUID = 7961728318907695402</p>
<p>åŒæ ·ï¼ŒæŠ›å‡ºäº† InvalidClassExceptionï¼Œå¹¶ä¸”æŒ‡å‡ºä¸¤ä¸ª serialVersio- nUID ä¸åŒï¼Œåˆ†åˆ«æ˜¯ -2986778152837257883 å’Œ 7961728318907695402ã€‚<br>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œç³»ç»Ÿè‡ªå·±æ·»åŠ äº†ä¸€ä¸ª serialVersionUIDã€‚ æ‰€ä»¥ï¼Œä¸€æ—¦ç±»å®ç°äº† Serializableï¼Œå°±å»ºè®®æ˜ç¡®çš„å®šä¹‰ä¸€ä¸ª serialVersionUIDã€‚ä¸ç„¶åœ¨ä¿®æ”¹ç±»çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚</p>
<p>serialVersionUID æœ‰ä¸¤ç§æ˜¾ç¤ºçš„ç”Ÿæˆæ–¹å¼:</p>
<p>ä¸€æ˜¯é»˜è®¤çš„1Lï¼Œæ¯”å¦‚:private static final long serialVersionUID = 1L;<br>äºŒæ˜¯æ ¹æ®ç±»åã€æ¥å£åã€æˆå‘˜æ–¹æ³•åŠå±æ€§ç­‰æ¥ç”Ÿæˆä¸€ä¸ª 64 ä½çš„å“ˆå¸Œå­—æ®µï¼Œæ¯”å¦‚:private static final long serialVersionUID = xxxxL;</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>serialVersionUID æ˜¯ç”¨æ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚æ‰€ä»¥åœ¨åšå…¼å®¹æ€§å‡çº§çš„æ—¶å€™ï¼Œ ä¸è¦æ”¹å˜ç±»ä¸­ serialVersionUID çš„å€¼ã€‚</p>
<p>å¦‚æœä¸€ä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œä¸€å®šè¦è®°å¾—å®šä¹‰ serialVersionUIDï¼Œå¦åˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚å¯ä»¥åœ¨ IDE ä¸­é€šè¿‡è®¾ç½®ï¼Œè®©ä»–å¸®å¿™æç¤ºï¼Œå¹¶ä¸”å¯ä»¥ä¸€é”®å¿«é€Ÿç”Ÿæˆä¸€ ä¸ª serialVersionUIDã€‚</p>
<p>ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ˜¯å› ä¸ºååºåˆ—åŒ–è¿‡ç¨‹ä¸­åšäº†æ ¡éªŒï¼Œå¹¶ä¸”å¦‚æœæ²¡æœ‰æ˜ç¡®å®šä¹‰çš„ è¯ï¼Œä¼šæ ¹æ®ç±»çš„å±æ€§è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="">JavaæŠ€æœ¯çµé­‚15é—®</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿®æ”¹mysqlè¡¨åˆ›å»ºæ—¶é—´</title>
    <url>/wiki/%E4%BF%AE%E6%94%B9mysql%E8%A1%A8%E5%88%9B%E5%BB%BA%E6%97%B6%E9%97%B4/</url>
    <content><![CDATA[<ul>
<li><p>ä¿®æ”¹æœåŠ¡å™¨æ—¶é—´<br><code>date -s &quot;2021-07-14 21:22:10&quot;</code></p>
</li>
<li><p>æ‰§è¡ŒDDL<br><code>alter table mirror_user comment &#39;ç”¨æˆ·è¡¨&#39;;</code></p>
</li>
<li><p>æœåŠ¡å™¨æ—¶é—´ä¿®æ­£<br><code>ntpdate ntp1.aliyun.com</code></p>
</li>
</ul>
]]></content>
      <categories>
        <category>DataBase</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>å€’æ’ç´¢å¼•</title>
    <url>/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/</url>
    <content><![CDATA[<p>Elasticsearch ä½¿ç”¨ä¸€ç§ç§°ä¸º å€’æ’ç´¢å¼• çš„ç»“æ„ï¼Œå®ƒé€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚ä¸€ä¸ªå€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤è¯çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºå…¶ä¸­æ¯ä¸ªè¯ï¼Œæœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚  </p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£çš„ content åŸŸåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š  </p>
<p>The quick brown fox jumped over the lazy dog<br>Quick brown foxes leap over lazy dogs in summer<br>ä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ¯ä¸ªæ–‡æ¡£çš„ content åŸŸæ‹†åˆ†æˆå•ç‹¬çš„ è¯ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸º è¯æ¡ æˆ– tokens ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡å¤è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<img src="https://oscimg.oschina.net/oscnet/up-ea663f731dfb8db97706ffd2d34a2297576.png" width=230 height=300>  

<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ <code>quick brown</code> ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š  </p>
<img src="https://oscimg.oschina.net/oscnet/up-6b1b6fb36d1467bfab8d222ace66f4f3dc7.png" width=230 height=160>
ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…åº¦æ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»…è®¡ç®—åŒ¹é…è¯æ¡æ•°é‡çš„ç®€å• ç›¸ä¼¼æ€§ç®—æ³• ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¯¹äºæˆ‘ä»¬æŸ¥è¯¢çš„ç›¸å…³æ€§æ¥è®²ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªæ–‡æ¡£æ›´ä½³ã€‚  

<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›®å‰çš„å€’æ’ç´¢å¼•æœ‰ä¸€äº›é—®é¢˜ï¼š</p>
<p><code>Quick</code> å’Œ <code>quick</code> ä»¥ç‹¬ç«‹çš„è¯æ¡å‡ºç°ï¼Œç„¶è€Œç”¨æˆ·å¯èƒ½è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„è¯ã€‚<br><code>fox</code> å’Œ <code>foxes</code> éå¸¸ç›¸ä¼¼, å°±åƒ <code>dog</code> å’Œ <code>dogs</code> ï¼›ä»–ä»¬æœ‰ç›¸åŒçš„è¯æ ¹ã€‚<br><code>jumped</code> å’Œ <code>leap</code>, å°½ç®¡æ²¡æœ‰ç›¸åŒçš„è¯æ ¹ï¼Œä½†ä»–ä»¬çš„æ„æ€å¾ˆç›¸è¿‘ã€‚ä»–ä»¬æ˜¯åŒä¹‰è¯ã€‚<br>ä½¿ç”¨å‰é¢çš„ç´¢å¼•æœç´¢ <code>+Quick</code> <code>+fox</code> ä¸ä¼šå¾—åˆ°ä»»ä½•åŒ¹é…æ–‡æ¡£ã€‚ï¼ˆè®°ä½ï¼Œ+ å‰ç¼€è¡¨æ˜è¿™ä¸ªè¯å¿…é¡»å­˜åœ¨ã€‚ï¼‰åªæœ‰åŒæ—¶å‡ºç° <code>Quick</code> å’Œ <code>fox</code> çš„æ–‡æ¡£æ‰æ»¡è¶³è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£åŒ…å« <code>quick fox</code> ï¼Œç¬¬äºŒä¸ªæ–‡æ¡£åŒ…å« <code>Quick foxes</code> ã€‚</p>
<p>æˆ‘ä»¬çš„ç”¨æˆ·å¯ä»¥åˆç†çš„æœŸæœ›ä¸¤ä¸ªæ–‡æ¡£ä¸æŸ¥è¯¢åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥åšçš„æ›´å¥½ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†è¯æ¡è§„èŒƒä¸ºæ ‡å‡†æ¨¡å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸ç”¨æˆ·æœç´¢çš„è¯æ¡ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†å…·æœ‰è¶³å¤Ÿç›¸å…³æ€§çš„æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼š</p>
<p><code>Quick</code> å¯ä»¥å°å†™åŒ–ä¸º <code>quick</code> ã€‚<br><code>foxes</code> å¯ä»¥ è¯å¹²æå– â€“å˜ä¸ºè¯æ ¹çš„æ ¼å¼â€“ ä¸º <code>fox</code> ã€‚ç±»ä¼¼çš„ï¼Œ <code>dogs</code> å¯ä»¥ä¸ºæå–ä¸º <code>dog</code> ã€‚<br><code>jumped</code> å’Œ <code>leap</code> æ˜¯åŒä¹‰è¯ï¼Œå¯ä»¥ç´¢å¼•ä¸ºç›¸åŒçš„å•è¯ <code>jump</code> ã€‚<br>ç°åœ¨ç´¢å¼•çœ‹ä¸Šå»åƒè¿™æ ·ï¼š<br><img src="https://oscimg.oschina.net/oscnet/up-5ee716c408738e8394f2d9809f8be8354ba.png" width=230 height=270><br>è¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬æœç´¢ <code>+Quick</code> <code>+fox</code> ä»ç„¶ ä¼šå¤±è´¥ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ç´¢å¼•ä¸­ï¼Œå·²ç»æ²¡æœ‰ <code>Quick</code> äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æœç´¢çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸ content åŸŸç›¸åŒçš„æ ‡å‡†åŒ–è§„åˆ™ï¼Œä¼šå˜æˆæŸ¥è¯¢ <code>+quick</code> <code>+fox</code> ï¼Œè¿™æ ·ä¸¤ä¸ªæ–‡æ¡£éƒ½ä¼šåŒ¹é…ï¼</p>
<p>è¿™éå¸¸é‡è¦ã€‚ä½ åªèƒ½æœç´¢åœ¨ç´¢å¼•ä¸­å‡ºç°çš„è¯æ¡ï¼Œæ‰€ä»¥ç´¢å¼•æ–‡æœ¬å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²å¿…é¡»æ ‡å‡†åŒ–ä¸ºç›¸åŒçš„æ ¼å¼ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å…³äº Elasticsearch å†…å­˜å ç”¨åŠåˆ†é…</title>
    <url>/wiki/%E5%85%B3%E4%BA%8E-Elasticsearch-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E5%8F%8A%E5%88%86%E9%85%8D/</url>
    <content><![CDATA[<p>Elasticsearch å’Œ Lucene å¯¹å†…å­˜ä½¿ç”¨æƒ…å†µï¼š </p>
<img src='https://nereuschen.github.io/2015/09/16/ElasticSearch%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E5%88%86%E6%9E%90/es-cache.png' width=500 height=550>


<p>Elasticsearch é™åˆ¶çš„å†…å­˜å¤§å°æ˜¯ JAVA å †ç©ºé—´çš„å¤§å°ï¼Œä¸åŒ…æ‹¬Lucene ç¼“å­˜å€’æ’ç´¢å¼•æ•°æ®ç©ºé—´ã€‚</p>
<p>Lucene ä¸­çš„ å€’æ’ç´¢å¼• segments å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ºæé«˜è®¿é—®é€Ÿåº¦ï¼Œéƒ½ä¼šæŠŠå®ƒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜ Lucene æ€§èƒ½ã€‚æ‰€ä»¥å»ºè®®è‡³å°‘ç•™ç³»ç»Ÿä¸€åŠå†…å­˜ç»™Luceneã€‚<br><code>Node Query Cache</code> (è´Ÿè´£ç¼“å­˜f ilter æŸ¥è¯¢ç»“æœ)ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªï¼Œè¢«æ‰€æœ‰ shard å…±äº«ï¼Œfilter queryæŸ¥è¯¢ç»“æœè¦ä¹ˆæ˜¯ yes è¦ä¹ˆæ˜¯noï¼Œä¸æ¶‰åŠ scores çš„è®¡ç®—ã€‚<br>é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦é…ç½®ï¼Œé»˜è®¤ä¸ºï¼šindices.queries.cache.size:10%</p>
<p><code>Indexing Buffer</code> ç´¢å¼•ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨æ–°ç´¢å¼•çš„æ–‡æ¡£ï¼Œå½“å…¶è¢«å¡«æ»¡æ—¶ï¼Œç¼“å†²åŒºä¸­çš„æ–‡æ¡£è¢«å†™å…¥ç£ç›˜ä¸­çš„ <code>segments</code> ä¸­ã€‚èŠ‚ç‚¹ä¸Šæ‰€æœ‰ <code>shard</code> å…±äº«ã€‚<br>ç¼“å†²åŒºé»˜è®¤å¤§å°ï¼š indices.memory.index_buffer_size: 10%<br>å¦‚æœç¼“å†²åŒºå¤§å°è®¾ç½®äº†ç™¾åˆ†ç™¾åˆ™ indices.memory.min_index_buffer_size ç”¨äºè¿™æ˜¯æœ€å°å€¼ï¼Œé»˜è®¤ä¸º 48mbã€‚indices.memory.max_index_buffer_size ç”¨äºæœ€å¤§å¤§å°ï¼Œæ— é»˜è®¤å€¼ã€‚</p>
<p><code>segments</code><br>segmentsä¼šé•¿æœŸå ç”¨å†…å­˜ï¼Œå…¶åˆè¡·å°±æ˜¯åˆ©ç”¨OSçš„cacheæå‡æ€§èƒ½ã€‚åªæœ‰åœ¨Mergeä¹‹åï¼Œæ‰ä¼šé‡Šæ”¾æ‰æ ‡è®°ä¸ºDeleteçš„segmentsï¼Œé‡Šæ”¾éƒ¨åˆ†å†…å­˜ã€‚</p>
<p><code>Shard Request Cache</code> ç”¨äºç¼“å­˜è¯·æ±‚ç»“æœï¼Œä½†ä¹‹ç¼“å­˜request sizeä¸º0çš„ã€‚æ¯”å¦‚è¯´ hits.total, aggregations å’Œ suggestions.<br>é»˜è®¤æœ€å¤§ä¸ºindices.requests.cache.size:1%</p>
<p><code>Field Data Cache</code> å­—æ®µç¼“å­˜é‡è¦ç”¨äºå¯¹å­—æ®µè¿›è¡Œæ’åºã€èšåˆæ˜¯ä½¿ç”¨ã€‚å› ä¸ºæ„å»ºå­—æ®µæ•°æ®ç¼“å­˜ä»£ä»·æ˜‚è´µï¼Œæ‰€ä»¥å»ºè®®æœ‰è¶³å¤Ÿçš„å†…è®­æ¥å­˜å‚¨ã€‚<br><code>Fielddata</code> æ˜¯ ã€Œ å»¶è¿Ÿ ã€ åŠ è½½ã€‚å¦‚æœä½ ä»æ¥æ²¡æœ‰èšåˆä¸€ä¸ªåˆ†æå­—ç¬¦ä¸²ï¼Œå°±ä¸ä¼šåŠ è½½ fielddata åˆ°å†…å­˜ä¸­ï¼Œä¹Ÿå°±ä¸ä¼šä½¿ç”¨å¤§é‡çš„å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åˆ†é…è¾ƒå°çš„heapç»™Elasticsearchã€‚å› ä¸ºheapè¶Šå°æ„å‘³ç€Elasticsearchçš„GCä¼šæ¯”è¾ƒå¿«ï¼Œå¹¶ä¸”é¢„ç•™ç»™Luceneçš„å†…å­˜ä¹Ÿä¼šæ¯”è¾ƒå¤§ã€‚ã€‚<br>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¿å­˜fielddataæ—¶ï¼ŒElastisearchä¼šä¸æ–­åœ°ä»ç£ç›˜åŠ è½½æ•°æ®åˆ°å†…å­˜ï¼Œå¹¶å‰”é™¤æ‰æ—§çš„å†…å­˜æ•°æ®ã€‚å‰”é™¤æ“ä½œä¼šé€ æˆä¸¥é‡çš„ç£ç›˜I/Oï¼Œå¹¶ä¸”å¼•å‘å¤§é‡çš„GCï¼Œä¼šä¸¥é‡å½±å“Elastisearchçš„æ€§èƒ½ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹Fielddataä¼šä¸æ–­å ç”¨å†…å­˜ï¼Œç›´åˆ°å®ƒè§¦å‘äº†fielddata circuit breakerã€‚<br>fielddata circuit breakerä¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶è¯„ä¼°è¿™æ¬¡æŸ¥è¯¢ä¼šä½¿ç”¨å¤šå°‘å†…å­˜ï¼Œä»è€Œè®¡ç®—åŠ è½½è¿™éƒ¨åˆ†å†…å­˜ä¹‹åï¼ŒField Data Cacheæ‰€å ç”¨çš„å†…å­˜æ˜¯å¦ä¼šè¶…è¿‡indices.breaker.fielddata.limitã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œå°±ä¼šè§¦å‘fielddata circuit breakerï¼Œabortè¿™æ¬¡æŸ¥è¯¢å¹¶ä¸”æŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢OOMã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">indices.breaker.fielddata.limit:60% (é»˜è®¤heapçš„60%)  (es7ä¹‹åæ”¹æˆ70%)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè®¾ç½®äº†indices.fielddata.cache.sizeï¼Œå½“è¾¾åˆ°sizeæ—¶ï¼Œcacheä¼šå‰”é™¤æ—§çš„fielddataã€‚</p>
<blockquote>
<p>indices.breaker.fielddata.limit å¿…é¡»å¤§äº indices.fielddata.cache.sizeï¼Œå¦åˆ™åªä¼šè§¦å‘fielddata circuit breakerï¼Œè€Œä¸ä¼šå‰”é™¤æ—§çš„fielddataã€‚</p>
</blockquote>
<h2 id="é…ç½®Elasticsearchå †å†…å­˜"><a href="#é…ç½®Elasticsearchå †å†…å­˜" class="headerlink" title="é…ç½®Elasticsearchå †å†…å­˜"></a>é…ç½®Elasticsearchå †å†…å­˜</h2><p>Elasticsearché»˜è®¤å®‰è£…åè®¾ç½®çš„å†…å­˜æ˜¯ <code>1GB</code>ï¼Œè¿™æ˜¯è¿œè¿œä¸å¤Ÿç”¨äºç”Ÿäº§ç¯å¢ƒçš„ã€‚<br>æœ‰ä¸¤ç§æ–¹å¼ä¿®æ”¹Elasticsearchçš„å †å†…å­˜ï¼š</p>
<blockquote>
<ol>
<li>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š<code>export ES_HEAP_SIZE=10g</code> åœ¨eså¯åŠ¨æ—¶ä¼šè¯»å–è¯¥å˜é‡ï¼›</li>
<li>å¯åŠ¨æ—¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™esï¼š <code>./bin/elasticsearch -Xmx10g -Xms10g</code></li>
</ol>
</blockquote>
<h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><p>ç»™esåˆ†é…å†…å­˜æ—¶è¦æ³¨æ„ï¼Œè‡³å°‘è¦åˆ†é…ä¸€åŠå„¿å†…å­˜ç•™ç»™ Luceneã€‚<br>åˆ†é…ç»™ es çš„å†…å­˜æœ€å¥½ä¸è¦è¶…è¿‡ 32G ï¼Œå› ä¸ºå¦‚æœå †å¤§å°å°äº 32 GBï¼ŒJVM å¯ä»¥åˆ©ç”¨æŒ‡é’ˆå‹ç¼©ï¼Œè¿™å¯ä»¥å¤§å¤§é™ä½å†…å­˜çš„ä½¿ç”¨ï¼šæ¯ä¸ªæŒ‡é’ˆ 4 å­—èŠ‚è€Œä¸æ˜¯ 8 å­—èŠ‚ã€‚å¦‚æœå¤§äº32G æ¯ä¸ªæŒ‡é’ˆå ç”¨ 8å­—èŠ‚ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„å†…å­˜å¸¦å®½ï¼Œé™ä½äº†cpuæ€§èƒ½ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼Œ è¦å…³é—­ <code>swap</code> å†…å­˜äº¤æ¢ç©ºé—´ï¼Œç¦ç”¨swappingã€‚é¢‘ç¹çš„swapping å¯¹æœåŠ¡å™¨æ¥è¯´æ˜¯è‡´å‘½çš„ã€‚<br>æ€»ç»“ï¼šç»™es JVMæ ˆçš„å†…å­˜æœ€å¥½ä¸è¦è¶…è¿‡32Gï¼Œç•™ç»™Luceneçš„å†…å­˜è¶Šå¤§è¶Šå¥½ï¼ŒLuceneæŠŠæ‰€æœ‰çš„segmentéƒ½ç¼“å­˜èµ·æ¥ï¼Œä¼šåŠ å¿«å…¨æ–‡æ£€ç´¢ã€‚</p>
<h2 id="å…³é—­äº¤æ¢åŒº"><a href="#å…³é—­äº¤æ¢åŒº" class="headerlink" title="å…³é—­äº¤æ¢åŒº"></a>å…³é—­äº¤æ¢åŒº</h2><p>è¿™åº”è¯¥æ˜¾è€Œæ˜“è§äº†ï¼Œä½†ä»ç„¶éœ€è¦æ˜ç¡®çš„å†™å‡ºæ¥ï¼šæŠŠå†…å­˜æ¢æˆç¡¬ç›˜å°†æ¯æ‰æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼šæ¶‰åŠå†…å­˜çš„æ“ä½œæ˜¯éœ€è¦å¿«é€Ÿæ‰§è¡Œçš„ã€‚å¦‚æœä»‹è´¨ä»å†…å­˜å˜ä¸ºäº†ç¡¬ç›˜ï¼Œä¸€ä¸ª10å¾®ç§’çš„æ“ä½œå˜æˆéœ€è¦10æ¯«ç§’ã€‚è€Œä¸”è¿™ç§å»¶è¿Ÿå‘ç”Ÿåœ¨æ‰€æœ‰æœ¬è¯¥åªèŠ±è´¹10å¾®ç§’çš„æ“ä½œä¸Šï¼Œå°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆäº¤æ¢åŒºå¯¹äºæ€§èƒ½æ¥è¯´æ˜¯å™©æ¢¦ã€‚</p>
<p>æœ€å¥½çš„é€‰æ‹©æ˜¯ç¦ç”¨æ‰æ“ä½œç³»ç»Ÿçš„äº¤æ¢åŒºã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo swapoff -a</span><br></pre></td></tr></table></figure>
<p>æ¥ç¦ç”¨ï¼Œä½ å¯èƒ½è¿˜éœ€è¦ç¼–è¾‘ <code>/etc/fstab</code> æ–‡ä»¶ã€‚ç»†èŠ‚å¯ä»¥å‚è€ƒä½ çš„æ“ä½œç³»ç»Ÿæ–‡æ¡£ã€‚</p>
<p>å¦‚æœå®é™…ç¯å¢ƒä¸å…è®¸ç¦ç”¨æ‰ <code>swap</code>ï¼Œä½ å¯ä»¥å°è¯•é™ä½ <code>swappiness</code>ã€‚æ­¤å€¼æ§åˆ¶æ“ä½œç³»ç»Ÿä½¿ç”¨äº¤æ¢åŒºçš„ç§¯ææ€§ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨äº¤æ¢åŒºï¼Œä½†ä»å…è®¸æ“ä½œç³»ç»Ÿåœ¨ç´§æ€¥æƒ…å†µä¸‹å°†å†…å­˜é‡Œçš„ä¸œè¥¿æ”¾åˆ°äº¤æ¢åŒºã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°Linuxç³»ç»Ÿæ¥è¯´ï¼Œè¿™å¯ä»¥ç”¨ <code>sysctl</code> å€¼æ¥é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">vm.swappiness</span> <span class="string">=</span> <span class="number">1</span> <span class="comment"># å°†æ­¤å€¼é…ç½®ä¸º1ä¼šæ¯”0å¥½ï¼Œåœ¨kernalå†…æ ¸çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œ0å¯èƒ½ä¼šå¼•èµ·OOMå¼‚å¸¸ã€‚</span></span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œå¦‚æœä¸¤ç§æ–¹æ³•éƒ½ä¸å¯ç”¨ï¼Œä½ åº”è¯¥åœ¨ElasticSearchçš„é…ç½®ä¸­å¯ç”¨ <code>mlockall.file</code>ã€‚è¿™å…è®¸JVMé”å®šå…¶ä½¿ç”¨çš„å†…å­˜ï¼Œè€Œé¿å…è¢«æ”¾å…¥æ“ä½œç³»ç»Ÿäº¤æ¢åŒºã€‚</p>
<p>åœ¨elasticsearch.ymlä¸­ï¼Œåšå¦‚ä¸‹è®¾ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">bootstrap.mlockall: true</span><br></pre></td></tr></table></figure>

<h2 id="æŸ¥çœ‹nodeèŠ‚ç‚¹æ•°æ®"><a href="#æŸ¥çœ‹nodeèŠ‚ç‚¹æ•°æ®" class="headerlink" title="æŸ¥çœ‹nodeèŠ‚ç‚¹æ•°æ®"></a>æŸ¥çœ‹nodeèŠ‚ç‚¹æ•°æ®</h2><p><code>GET /_cat/nodes?v&amp;h=id,ip,port,v,master,name,heap.current,heap.percent,heap.max,ram.current,ram.percent,ram.max,fielddata.memory_size,fielddata.evictions,query_cache.memory_size,query_cache.evictions, request_cache.memory_size,request_cache.evictions,request_cache.hit_count,request_cache.miss_count</code></p>
<p><code>GET /_cat/nodes?v&amp;h=id,heap.current,heap.percent,heap.max,ram.current,ram.percent,ram.max,fielddata.memory_size</code></p>
<p><code>GET /_cat/nodes?v&amp;h=id,fielddata.evictions,query_cache.memory_size,query_cache.evictions, request_cache.memory_size,request_cache.evictions,request_cache.hit_count,request_cache.miss_count</code></p>
<h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><blockquote>
<p><a href="https://nereuschen.github.io/2015/09/16/ElasticSearch%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E5%88%86%E6%9E%90/"></a></p>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼-CAPç†è®º</title>
    <url>/wiki/%E5%88%86%E5%B8%83%E5%BC%8F-CAP%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<h1 id="CAP-åŸåˆ™"><a href="#CAP-åŸåˆ™" class="headerlink" title="CAP åŸåˆ™"></a>CAP åŸåˆ™</h1><p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ã€‚<br>CAPåŸåˆ™çš„ç²¾é«“å°±æ˜¯è¦ä¹ˆAPï¼Œè¦ä¹ˆCPï¼Œè¦ä¹ˆACï¼Œä½†æ˜¯ä¸å­˜åœ¨CAPã€‚</p>
<img src="https://oscimg.oschina.net/oscnet/up-1d3052b25a13428857fde791eaa01c02e9b.png">

<ul>
<li>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ˜¯å¦åŒæ ·çš„å€¼ï¼Œå³å†™æ“ä½œä¹‹åçš„è¯»æ“ä½œï¼Œå¿…é¡»è¿”å›è¯¥å€¼ã€‚ï¼ˆåˆ†ä¸ºå¼±ä¸€è‡´æ€§ã€å¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰</li>
<li>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šåœ¨é›†ç¾¤ä¸­ä¸€éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœåï¼Œé›†ç¾¤æ•´ä½“æ˜¯å¦è¿˜èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚ï¼ˆå¯¹æ•°æ®æ›´æ–°å…·å¤‡é«˜å¯ç”¨æ€§ï¼‰</li>
<li>åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰ï¼šä»¥å®é™…æ•ˆæœè€Œè¨€ï¼Œåˆ†åŒºç›¸å½“äºå¯¹é€šä¿¡çš„æ—¶é™è¦æ±‚ã€‚ç³»ç»Ÿå¦‚æœä¸èƒ½åœ¨æ—¶é™å†…è¾¾æˆæ•°æ®ä¸€è‡´æ€§ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†åˆ†åŒºçš„æƒ…å†µï¼Œå¿…é¡»å°±å½“å‰æ“ä½œåœ¨Cå’ŒAä¹‹é—´åšå‡ºé€‰æ‹©ã€‚</li>
</ul>
<h2 id="å–èˆç­–ç•¥"><a href="#å–èˆç­–ç•¥" class="headerlink" title="å–èˆç­–ç•¥"></a>å–èˆç­–ç•¥</h2><blockquote>
<p>CA without P</p>
</blockquote>
<p>å¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†æ”¾å¼ƒPçš„åŒæ—¶ä¹Ÿå°±æ„å‘³ç€æ”¾å¼ƒäº†ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼èŠ‚ç‚¹å—é™ï¼Œæ²¡åŠæ³•éƒ¨ç½²å­èŠ‚ç‚¹ï¼Œè¿™æ˜¯è¿èƒŒåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„åˆè¡·çš„ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“RDBMSï¼šOracleã€MySQLå°±æ˜¯CAã€‚</p>
<blockquote>
<p>CP without A</p>
</blockquote>
<p>å¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´ä¿æŒå¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿(ä¹Ÿå°±æ˜¯ç­‰å¾…æ•°æ®åŒæ­¥å®Œæ‰èƒ½æ­£å¸¸è®¿é—®æœåŠ¡)ï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è€…æ¶ˆæ¯ä¸¢å¤±ç­‰æƒ…å†µï¼Œå°±è¦<font color=red>ç‰ºç‰²ç”¨æˆ·çš„ä½“éªŒ</font>ï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®å…¨éƒ¨ä¸€è‡´äº†ä¹‹åå†è®©ç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚è®¾è®¡æˆCPçš„ç³»ç»Ÿå…¶å®ä¸å°‘ï¼Œæœ€å…¸å‹çš„å°±æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¦‚Redisã€HBaseç­‰ã€‚å¯¹äºè¿™äº›åˆ†å¸ƒå¼æ•°æ®åº“æ¥è¯´ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› ä¸ºå¦‚æœè¿è¿™ä¸ªæ ‡å‡†éƒ½è¾¾ä¸åˆ°ï¼Œé‚£ä¹ˆç›´æ¥é‡‡ç”¨å…³ç³»å‹æ•°æ®åº“å°±å¥½ï¼Œæ²¡å¿…è¦å†æµªè´¹èµ„æºæ¥éƒ¨ç½²åˆ†å¸ƒå¼æ•°æ®åº“ã€‚</p>
<blockquote>
<p>AP wihtout C</p>
</blockquote>
<p>è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚å…¸å‹çš„åº”ç”¨å°±å¦‚æŸç±³çš„æŠ¢è´­æ‰‹æœºåœºæ™¯ï¼Œå¯èƒ½å‰å‡ ç§’ä½ æµè§ˆå•†å“çš„æ—¶å€™é¡µé¢æç¤ºæ˜¯æœ‰åº“å­˜çš„ï¼Œå½“ä½ é€‰æ‹©å®Œå•†å“å‡†å¤‡ä¸‹å•çš„æ—¶å€™ï¼Œç³»ç»Ÿæç¤ºä½ ä¸‹å•å¤±è´¥ï¼Œå•†å“å·²å”®å®Œã€‚è¿™å…¶å®å°±æ˜¯å…ˆåœ¨ Aï¼ˆå¯ç”¨æ€§ï¼‰æ–¹é¢ä¿è¯ç³»ç»Ÿå¯ä»¥æ­£å¸¸çš„æœåŠ¡ï¼Œç„¶ååœ¨æ•°æ®çš„ä¸€è‡´æ€§æ–¹é¢åšäº†äº›ç‰ºç‰²ï¼Œè™½ç„¶å¤šå°‘ä¼šå½±å“ä¸€äº›ç”¨æˆ·ä½“éªŒï¼Œä½†ä¹Ÿä¸è‡³äºé€ æˆç”¨æˆ·è´­ç‰©æµç¨‹çš„ä¸¥é‡é˜»å¡ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆâ€”â€”BASE"><a href="#è§£å†³æ–¹æ¡ˆâ€”â€”BASE" class="headerlink" title="è§£å†³æ–¹æ¡ˆâ€”â€”BASE"></a>è§£å†³æ–¹æ¡ˆâ€”â€”BASE</h2><p>BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç®€å†™ï¼ŒBASEæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong consistencyï¼‰ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual consistencyï¼‰ã€‚</p>
<blockquote>
<p>åŸºæœ¬å¯ç”¨Basically Available</p>
</blockquote>
<p>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§â€”â€”ä½†è¯·æ³¨æ„ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ï¼Œä»¥ä¸‹ä¸¤ä¸ªå°±æ˜¯â€œåŸºæœ¬å¯ç”¨â€çš„å…¸å‹ä¾‹å­ã€‚</p>
<p>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœ¨çº¿æœç´¢å¼•æ“éœ€è¦0.5ç§’å†…è¿”å›ç»™ç”¨æˆ·ç›¸åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°å¼‚å¸¸ï¼ˆæ¯”å¦‚ç³»ç»Ÿéƒ¨åˆ†æœºæˆ¿å‘ç”Ÿæ–­ç”µæˆ–æ–­ç½‘æ•…éšœï¼‰ï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº†1~2ç§’ã€‚<br>åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ä¸Šè¿›è¡Œè´­ç‰©ï¼Œæ¶ˆè´¹è€…å‡ ä¹èƒ½å¤Ÿé¡ºåˆ©åœ°å®Œæˆæ¯ä¸€ç¬”è®¢å•ï¼Œä½†æ˜¯åœ¨ä¸€äº›èŠ‚æ—¥å¤§ä¿ƒè´­ç‰©é«˜å³°çš„æ—¶å€™ï¼Œç”±äºæ¶ˆè´¹è€…çš„è´­ç‰©è¡Œä¸ºæ¿€å¢ï¼Œä¸ºäº†ä¿æŠ¤è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚</p>
<blockquote>
<p>è½¯çŠ¶æ€Soft state</p>
</blockquote>
<p>è½¯çŠ¶æ€ä¹Ÿç§°å¼±çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚</p>
<blockquote>
<p>æœ€ç»ˆä¸€è‡´æ€§Eventually consistent</p>
</blockquote>
<p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/lixinkuan328/article/details/95535691">https://blog.csdn.net/lixinkuan328/article/details/95535691</a></p>
]]></content>
      <categories>
        <category>Distributed Dir</category>
        <category>theory</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</title>
    <url>/wiki/%E5%88%86%E5%B8%83%E5%BC%8F-%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h1 id="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"><a href="#ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•"></a>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•</h1><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•(Consistent Hashing Algorithm)æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç®—æ³•ï¼Œå¸¸ç”¨äºè´Ÿè½½å‡è¡¡ã€‚Memcached clientä¹Ÿé€‰æ‹©è¿™ç§ç®—æ³•ï¼Œè§£å†³å°†key-valueå‡åŒ€åˆ†é…åˆ°ä¼—å¤šMemcached serverä¸Šçš„é—®é¢˜ã€‚å®ƒå¯ä»¥å–ä»£ä¼ ç»Ÿçš„å–æ¨¡æ“ä½œï¼Œè§£å†³äº†å–æ¨¡æ“ä½œæ— æ³•åº”å¯¹å¢åˆ Memcached Serverçš„é—®é¢˜(å¢åˆ serverä¼šå¯¼è‡´åŒä¸€ä¸ªkey,åœ¨getæ“ä½œæ—¶åˆ†é…ä¸åˆ°æ•°æ®çœŸæ­£å­˜å‚¨çš„serverï¼Œå‘½ä¸­ç‡ä¼šæ€¥å‰§ä¸‹é™)ã€‚</p>
<h2 id="å“ˆå¸ŒæŒ‡æ ‡"><a href="#å“ˆå¸ŒæŒ‡æ ‡" class="headerlink" title="å“ˆå¸ŒæŒ‡æ ‡"></a>å“ˆå¸ŒæŒ‡æ ‡</h2><blockquote>
<p>è¯„ä¼°ä¸€ä¸ªå“ˆå¸Œç®—æ³•çš„ä¼˜åŠ£ï¼Œæœ‰å¦‚ä¸‹æŒ‡æ ‡ï¼Œè€Œä¸€è‡´æ€§å“ˆå¸Œå…¨éƒ¨æ»¡è¶³ï¼š</p>
</blockquote>
<ul>
<li>å‡è¡¡æ€§(Balance)ï¼šå°†å…³é”®å­—çš„å“ˆå¸Œåœ°å€å‡åŒ€åœ°åˆ†å¸ƒåœ¨åœ°å€ç©ºé—´ä¸­ï¼Œä½¿åœ°å€ç©ºé—´å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œè¿™æ˜¯è®¾è®¡å“ˆå¸Œçš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ã€‚</li>
<li>å•è°ƒæ€§(Monotonicity): å•è°ƒæ€§æ˜¯æŒ‡å½“åœ°å€ç©ºé—´å¢å¤§æ—¶ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°æ‰€å¾—åˆ°çš„å…³é”®å­—çš„å“ˆå¸Œåœ°å€ä¹Ÿèƒ½æ˜ å°„çš„æ–°çš„åœ°å€ç©ºé—´ï¼Œè€Œä¸æ˜¯ä»…é™äºåŸå…ˆçš„åœ°å€ç©ºé—´ã€‚æˆ–ç­‰åœ°å€ç©ºé—´å‡å°‘æ—¶ï¼Œä¹Ÿæ˜¯åªèƒ½æ˜ å°„åˆ°æœ‰æ•ˆçš„åœ°å€ç©ºé—´ä¸­ã€‚ç®€å•çš„å“ˆå¸Œå‡½æ•°å¾€å¾€ä¸èƒ½æ»¡è¶³æ­¤æ€§è´¨ã€‚</li>
<li>åˆ†æ•£æ€§(Spread): å“ˆå¸Œç»å¸¸ç”¨åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»ˆç«¯ç”¨æˆ·é€šè¿‡å“ˆå¸Œå‡½æ•°å°†è‡ªå·±çš„å†…å®¹å­˜åˆ°ä¸åŒçš„ç¼“å†²åŒºã€‚æ­¤æ—¶ï¼Œç»ˆç«¯æœ‰å¯èƒ½çœ‹ä¸åˆ°æ‰€æœ‰çš„ç¼“å†²ï¼Œè€Œæ˜¯åªèƒ½çœ‹åˆ°å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å½“ç»ˆç«¯å¸Œæœ›é€šè¿‡å“ˆå¸Œè¿‡ç¨‹å°†å†…å®¹æ˜ å°„åˆ°ç¼“å†²ä¸Šæ—¶ï¼Œç”±äºä¸åŒç»ˆç«¯æ‰€è§çš„ç¼“å†²èŒƒå›´æœ‰å¯èƒ½ä¸åŒï¼Œä»è€Œå¯¼è‡´å“ˆå¸Œçš„ç»“æœä¸ä¸€è‡´ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„å†…å®¹è¢«ä¸åŒçš„ç»ˆç«¯æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ã€‚è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯åº”è¯¥é¿å…çš„ï¼Œå› ä¸ºå®ƒå¯¼è‡´ç›¸åŒå†…å®¹è¢«å­˜å‚¨åˆ°ä¸åŒç¼“å†²ä¸­å»ï¼Œé™ä½äº†ç³»ç»Ÿå­˜å‚¨çš„æ•ˆç‡ã€‚åˆ†æ•£æ€§çš„å®šä¹‰å°±æ˜¯ä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„ä¸¥é‡ç¨‹åº¦ã€‚å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é¿å…ä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯å°½é‡é™ä½åˆ†æ•£æ€§ã€‚</li>
<li>è´Ÿè½½(Load): è´Ÿè½½é—®é¢˜å®é™…ä¸Šæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦çœ‹å¾…åˆ†æ•£æ€§é—®é¢˜ã€‚æ—¢ç„¶ä¸åŒçš„ç»ˆç«¯å¯èƒ½å°†ç›¸åŒçš„å†…å®¹æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„ç¼“å†²åŒºè€Œè¨€ï¼Œä¹Ÿå¯èƒ½è¢«ä¸åŒçš„ç”¨æˆ·æ˜ å°„ä¸ºä¸åŒçš„å†…å®¹ã€‚ä¸åˆ†æ•£æ€§ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯åº”å½“é¿å…çš„ï¼Œå› æ­¤å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é™ä½ç¼“å†²çš„è´Ÿè·</li>
</ul>
<h2 id="ä¸€è‡´æ€§å“ˆå¸Œ"><a href="#ä¸€è‡´æ€§å“ˆå¸Œ" class="headerlink" title="ä¸€è‡´æ€§å“ˆå¸Œ"></a>ä¸€è‡´æ€§å“ˆå¸Œ</h2><blockquote>
<p>å°†èŠ‚ç‚¹é€šè¿‡hashæ˜ å°„åˆ°hashç¯ä¸Šï¼Œç†æƒ³çš„æƒ…å†µæ˜¯å¤šä¸ªèŠ‚ç‚¹ç›´æ¥åˆ†å¸ƒå‡åŒ€</p>
</blockquote>
<img src="https://oscimg.oschina.net/oscnet/up-ac8ab4cd06d150b14ddfe58e2cdcbdb7dff.png" >


<p>å½“æˆ‘ä»¬çš„å¯¹è±¡é€šè¿‡hashç®—æ³•åˆ†é…åœ¨hashç¯ä¸Šçš„æ—¶å€™ï¼Œå®ƒæ˜¯å›ºå®šåˆ†é…åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ä¸Šçš„ï¼Œå½“æˆ‘ä»¬åœ¨BCä¹‹é—´æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä»…ä»…ä¼šå½±å“åˆ°BCè¿™ä¸€æ®µç©ºé—´ä¸Šçš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç¯ä¸Šçš„æ•°æ®éƒ½è¦è·Ÿç€å˜åŒ–ï¼›</p>
<blockquote>
<p>ç°å®æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½åˆ†é…ä¸å‡åŒ€</p>
</blockquote>
<img src="https://oscimg.oschina.net/oscnet/up-3a12f9634fed9d5f67debfcdd7fe22f1fae.png">

<p>è¿™å’Œä¼ ç»Ÿçš„hashå–æ¨¡ä¸€æ ·ï¼ŒåŒæ ·ä¼šæ•°æ®å€¾æ–œçš„é—®é¢˜ï¼</p>
<blockquote>
<p>è™šæ‹ŸèŠ‚ç‚¹</p>
</blockquote>
<p>è¿™ä¸ªæ—¶å€™è™šæ‹ŸèŠ‚ç‚¹å°±æ­¤è¯ç”Ÿï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è™šæ‹ŸèŠ‚ç‚¹åœ¨ä¸€è‡´æ€§Hashä¸­çš„ä½œç”¨ã€‚å½“æˆ‘ä»¬åœ¨Hashç¯ä¸Šæ–°å¢è‹¥å¹²ä¸ªç‚¹ï¼Œé‚£ä¹ˆæ¯ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å°±ä¼šæ¥è¿‘ç›¸ç­‰ã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯æˆ‘ä»¬å¯ä»¥æ–°å¢è‹¥å¹²ä¸ªç‰‡/è¡¨ï¼Œä½†æ˜¯æˆæœ¬æœ‰é™ï¼Œæˆ‘ä»¬é€šè¿‡å¤åˆ¶å¤šä¸ªAã€Bã€Cçš„å‰¯æœ¬({A1-An},{B1-Bn},{C1-Cn})ä¸€èµ·å‚ä¸è®¡ç®—ï¼ŒæŒ‰ç…§é¡ºæ—¶é’ˆçš„æ–¹å‘è¿›è¡Œæ•°æ®åˆ†å¸ƒï¼ŒæŒ‰ç…§ä¸‹å›¾ç¤ºæ„:<br><img src="https://oscimg.oschina.net/oscnet/up-88c2aef2ec993ede090695ffe78f53f999a.png"></p>
<p>æ­¤æ—¶A=[A,C1)&amp;[A1,C2)&amp;[A2,B4)&amp;[A3,A4)&amp;[A4,B1)ï¼›B=[B,A1)&amp;[B2,C)&amp;[B3,C3)&amp;[B4,C4)&amp;[B1,A)ï¼›C=[C1,B)&amp;[C2,B2)&amp;[C,B3)&amp;[B3,C3)&amp;[C4,A3)ï¼›ç”±å›¾å¯ä»¥çœ‹å‡ºåˆ†å¸ƒç‚¹è¶Šå¯†é›†ï¼Œå¹³è¡¡æ€§çº¦å¥½ã€‚</p>
<h2 id="ç®—æ³•å®ç°"><a href="#ç®—æ³•å®ç°" class="headerlink" title="ç®—æ³•å®ç°"></a>ç®—æ³•å®ç°</h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰å¤šç§å…·ä½“çš„å®ç°ï¼ŒåŒ…æ‹¬ Chord ç®—æ³•ï¼ŒKAD ç®—æ³•ç­‰ï¼Œéƒ½æ¯”è¾ƒå¤æ‚ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>1 ã€<a href="https://blog.csdn.net/kefengwang/article/details/81628977">ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åŸç†ä¸å®ç°</a><br>2ã€<a href="https://www.cnblogs.com/xialihua1023/p/10304932.html">æµ…è°ˆä¸€è‡´æ€§HashåŸç†åŠåº”ç”¨</a></p>
]]></content>
      <categories>
        <category>Distributed Dir</category>
        <category>theory</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†æä¸åˆ†æå™¨</title>
    <url>/wiki/%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%86%E6%9E%90%E5%99%A8/</url>
    <content><![CDATA[<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<p>é¦–å…ˆï¼Œå°†ä¸€å—æ–‡æœ¬åˆ†æˆé€‚åˆäºå€’æ’ç´¢å¼•çš„ç‹¬ç«‹çš„ <code>è¯æ¡</code> ï¼Œä¹‹åï¼Œå°†è¿™äº›è¯æ¡ç»Ÿä¸€åŒ–ä¸ºæ ‡å‡†æ ¼å¼ä»¥æé«˜å®ƒä»¬çš„â€œå¯æœç´¢æ€§â€ï¼Œæˆ–è€… recall<br>åˆ†æå™¨æ‰§è¡Œä¸Šé¢çš„å·¥ä½œã€‚ åˆ†æå™¨ å®é™…ä¸Šæ˜¯å°†ä¸‰ä¸ªåŠŸèƒ½å°è£…åˆ°äº†ä¸€ä¸ªåŒ…é‡Œï¼š</p>
<h3 id="å­—ç¬¦è¿‡æ»¤å™¨"><a href="#å­—ç¬¦è¿‡æ»¤å™¨" class="headerlink" title="å­—ç¬¦è¿‡æ»¤å™¨"></a>å­—ç¬¦è¿‡æ»¤å™¨</h3><p>é¦–å…ˆï¼Œå­—ç¬¦ä¸²æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª å­—ç¬¦è¿‡æ»¤å™¨ ã€‚ä»–ä»¬çš„ä»»åŠ¡æ˜¯åœ¨åˆ†è¯å‰æ•´ç†å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥å»æ‰HTMLï¼Œæˆ–è€…å°† &amp; è½¬åŒ–æˆ andã€‚</p>
<h3 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h3><p>å…¶æ¬¡ï¼Œå­—ç¬¦ä¸²è¢« åˆ†è¯å™¨ åˆ†ä¸ºå•ä¸ªçš„è¯æ¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ†è¯å™¨é‡åˆ°ç©ºæ ¼å’Œæ ‡ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†æ–‡æœ¬æ‹†åˆ†æˆè¯æ¡ã€‚</p>
<h3 id="Token-è¿‡æ»¤å™¨"><a href="#Token-è¿‡æ»¤å™¨" class="headerlink" title="Token è¿‡æ»¤å™¨"></a>Token è¿‡æ»¤å™¨</h3><p>æœ€åï¼Œè¯æ¡æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª token è¿‡æ»¤å™¨ ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œå°å†™åŒ– Quick ï¼‰ï¼Œåˆ é™¤è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œ åƒ aï¼Œ andï¼Œ the ç­‰æ— ç”¨è¯ï¼‰ï¼Œæˆ–è€…å¢åŠ è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œåƒ jump å’Œ leap è¿™ç§åŒä¹‰è¯ï¼‰ã€‚<br>Elasticsearchæä¾›äº†å¼€ç®±å³ç”¨çš„å­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨å’Œtoken è¿‡æ»¤å™¨ã€‚ è¿™äº›å¯ä»¥ç»„åˆèµ·æ¥å½¢æˆè‡ªå®šä¹‰çš„åˆ†æå™¨ä»¥ç”¨äºä¸åŒçš„ç›®çš„ã€‚</p>
<h2 id="å†…ç½®åˆ†æå™¨"><a href="#å†…ç½®åˆ†æå™¨" class="headerlink" title="å†…ç½®åˆ†æå™¨"></a>å†…ç½®åˆ†æå™¨</h2><p>ä½†æ˜¯ï¼Œ Elasticsearchè¿˜é™„å¸¦äº†å¯ä»¥ç›´æ¥ä½¿ç”¨çš„é¢„åŒ…è£…çš„åˆ†æå™¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ—å‡ºæœ€é‡è¦çš„åˆ†æå™¨ã€‚ä¸ºäº†è¯æ˜å®ƒä»¬çš„å·®å¼‚ï¼Œæˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªåˆ†æå™¨ä¼šä»ä¸‹é¢çš„å­—ç¬¦ä¸²å¾—åˆ°å“ªäº›è¯æ¡ï¼š<br><code>&quot;Set the shape to semi-transparent by calling set_trans(5)&quot;</code></p>
<h3 id="æ ‡å‡†åˆ†æå™¨"><a href="#æ ‡å‡†åˆ†æå™¨" class="headerlink" title="æ ‡å‡†åˆ†æå™¨"></a>æ ‡å‡†åˆ†æå™¨</h3><p>æ ‡å‡†åˆ†æå™¨æ˜¯Elasticsearché»˜è®¤ä½¿ç”¨çš„åˆ†æå™¨ã€‚å®ƒæ˜¯åˆ†æå„ç§è¯­è¨€æ–‡æœ¬æœ€å¸¸ç”¨çš„é€‰æ‹©ã€‚å®ƒæ ¹æ® Unicode è”ç›Ÿ å®šä¹‰çš„ å•è¯è¾¹ç•Œ åˆ’åˆ†æ–‡æœ¬ã€‚åˆ é™¤ç»å¤§éƒ¨åˆ†æ ‡ç‚¹ã€‚æœ€åï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿ<br><code>set, the, shape, to, semi, transparent, by, calling, set_trans, 5</code></p>
<h3 id="ç®€å•åˆ†æå™¨"><a href="#ç®€å•åˆ†æå™¨" class="headerlink" title="ç®€å•åˆ†æå™¨"></a>ç®€å•åˆ†æå™¨</h3><p>ç®€å•åˆ†æå™¨åœ¨ä»»ä½•ä¸æ˜¯å­—æ¯çš„åœ°æ–¹åˆ†éš”æ–‡æœ¬ï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿ<br><code>set, the, shape, to, semi, transparent, by, calling, set, trans</code></p>
<h3 id="ç©ºæ ¼åˆ†æå™¨"><a href="#ç©ºæ ¼åˆ†æå™¨" class="headerlink" title="ç©ºæ ¼åˆ†æå™¨"></a>ç©ºæ ¼åˆ†æå™¨</h3><p>ç©ºæ ¼åˆ†æå™¨åœ¨ç©ºæ ¼çš„åœ°æ–¹åˆ’åˆ†æ–‡æœ¬ã€‚å®ƒä¼šäº§ç”Ÿ<br><code>Set, the, shape, to, semi-transparent, by, calling, set_trans(5)</code></p>
<h3 id="è¯­è¨€åˆ†æå™¨"><a href="#è¯­è¨€åˆ†æå™¨" class="headerlink" title="è¯­è¨€åˆ†æå™¨"></a>è¯­è¨€åˆ†æå™¨</h3><p>ç‰¹å®šè¯­è¨€åˆ†æå™¨å¯ç”¨äº å¾ˆå¤šè¯­è¨€ã€‚å®ƒä»¬å¯ä»¥è€ƒè™‘æŒ‡å®šè¯­è¨€çš„ç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œ è‹±è¯­ åˆ†æå™¨é™„å¸¦äº†ä¸€ç»„è‹±è¯­æ— ç”¨è¯ï¼ˆå¸¸ç”¨å•è¯ï¼Œä¾‹å¦‚ and æˆ–è€… the ï¼Œå®ƒä»¬å¯¹ç›¸å…³æ€§æ²¡æœ‰å¤šå°‘å½±å“ï¼‰ï¼Œå®ƒä»¬ä¼šè¢«åˆ é™¤ã€‚ ç”±äºç†è§£è‹±è¯­è¯­æ³•çš„è§„åˆ™ï¼Œè¿™ä¸ªåˆ†è¯å™¨å¯ä»¥æå–è‹±è¯­å•è¯çš„ è¯å¹² ã€‚</p>
<h3 id="è‹±è¯­-åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼š"><a href="#è‹±è¯­-åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼š" class="headerlink" title="è‹±è¯­ åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼š"></a>è‹±è¯­ åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼š</h3><p><code>set, shape, semi, transpar, call, set_tran, 5</code><br>æ³¨æ„çœ‹ <code>transparentã€</code> <code>calling</code> å’Œ <code>set_trans</code> å·²ç»å˜ä¸ºè¯æ ¹æ ¼å¼ã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨</h2><p>å½“æˆ‘ä»¬ <code>ç´¢å¼•</code> ä¸€ä¸ªæ–‡æ¡£ï¼Œå®ƒçš„å…¨æ–‡åŸŸè¢«åˆ†ææˆè¯æ¡ä»¥ç”¨æ¥åˆ›å»ºå€’æ’ç´¢å¼•ã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨å…¨æ–‡åŸŸ æœç´¢ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†æŸ¥è¯¢å­—ç¬¦ä¸²é€šè¿‡ ç›¸åŒçš„åˆ†æè¿‡ç¨‹ ï¼Œä»¥ä¿è¯æˆ‘ä»¬æœç´¢çš„è¯æ¡æ ¼å¼ä¸ç´¢å¼•ä¸­çš„è¯æ¡æ ¼å¼ä¸€è‡´ã€‚</p>
<p>å…¨æ–‡æŸ¥è¯¢ï¼Œç†è§£æ¯ä¸ªåŸŸæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åšæ­£ç¡®çš„äº‹ï¼š</p>
<p>å½“ä½ æŸ¥è¯¢ä¸€ä¸ª <code>å…¨æ–‡</code> åŸŸæ—¶ï¼Œ ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²åº”ç”¨ç›¸åŒçš„åˆ†æå™¨ï¼Œä»¥äº§ç”Ÿæ­£ç¡®çš„æœç´¢è¯æ¡åˆ—è¡¨ã€‚<br>å½“ä½ æŸ¥è¯¢ä¸€ä¸ª <code>ç²¾ç¡®å€¼</code> åŸŸæ—¶ï¼Œä¸ä¼šåˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æœç´¢ä½ æŒ‡å®šçš„ç²¾ç¡®å€¼ã€‚</p>
<h2 id="æµ‹è¯•åˆ†æå™¨"><a href="#æµ‹è¯•åˆ†æå™¨" class="headerlink" title="æµ‹è¯•åˆ†æå™¨"></a>æµ‹è¯•åˆ†æå™¨</h2><p>æœ‰äº›æ—¶å€™å¾ˆéš¾ç†è§£åˆ†è¯çš„è¿‡ç¨‹å’Œå®é™…è¢«å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ï¼Œç‰¹åˆ«æ˜¯ä½ åˆšæ¥è§¦Elasticsearchã€‚ä¸ºäº†ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>analyze API</code> æ¥çœ‹æ–‡æœ¬æ˜¯å¦‚ä½•è¢«åˆ†æçš„ã€‚åœ¨æ¶ˆæ¯ä½“é‡Œï¼ŒæŒ‡å®šåˆ†æå™¨å’Œè¦åˆ†æçš„æ–‡æœ¬ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">GET /_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;Text to analyze&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„è¯æ¡ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;tokens&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">&quot;token&quot;</span>:        <span class="string">&quot;text&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span>: <span class="number">0</span>,</span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span>:   <span class="number">4</span>,</span><br><span class="line">         <span class="attr">&quot;type&quot;</span>:         <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;position&quot;</span>:     <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">&quot;token&quot;</span>:        <span class="string">&quot;to&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span>: <span class="number">5</span>,</span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span>:   <span class="number">7</span>,</span><br><span class="line">         <span class="attr">&quot;type&quot;</span>:         <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;position&quot;</span>:     <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         <span class="attr">&quot;token&quot;</span>:        <span class="string">&quot;analyze&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;start_offset&quot;</span>: <span class="number">8</span>,</span><br><span class="line">         <span class="attr">&quot;end_offset&quot;</span>:   <span class="number">15</span>,</span><br><span class="line">         <span class="attr">&quot;type&quot;</span>:         <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">         <span class="attr">&quot;position&quot;</span>:     <span class="number">3</span></span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>token</code> æ˜¯å®é™…å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ã€‚ <code>position</code> æŒ‡æ˜è¯æ¡åœ¨åŸå§‹æ–‡æœ¬ä¸­å‡ºç°çš„ä½ç½®ã€‚ <code>start_offset</code> å’Œ <code>end_offset</code> æŒ‡æ˜å­—ç¬¦åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚</p>
<p>æ¯ä¸ªåˆ†æå™¨çš„ <code>type</code> å€¼éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚å®ƒä»¬åœ¨Elasticsearchä¸­çš„å”¯ä¸€ä½œç”¨åœ¨äºâ€‹keep_types token è¿‡æ»¤å™¨â€‹ã€‚</p>
<p>analyze API æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒæœ‰åŠ©äºæˆ‘ä»¬ç†è§£Elasticsearchç´¢å¼•å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œéšç€æ·±å…¥ï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥è®¨è®ºå®ƒã€‚</p>
<h2 id="æŒ‡å®šåˆ†æå™¨"><a href="#æŒ‡å®šåˆ†æå™¨" class="headerlink" title="æŒ‡å®šåˆ†æå™¨"></a>æŒ‡å®šåˆ†æå™¨</h2><p>å½“Elasticsearchåœ¨ä½ çš„æ–‡æ¡£ä¸­æ£€æµ‹åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²åŸŸï¼Œå®ƒä¼šè‡ªåŠ¨è®¾ç½®å…¶ä¸ºä¸€ä¸ªå…¨æ–‡ <code>å­—ç¬¦ä¸²</code> åŸŸï¼Œä½¿ç”¨ <code>æ ‡å‡†</code> åˆ†æå™¨å¯¹å®ƒè¿›è¡Œåˆ†æã€‚</p>
<p>ä½ ä¸å¸Œæœ›æ€»æ˜¯è¿™æ ·ã€‚å¯èƒ½ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åˆ†æå™¨ï¼Œé€‚ç”¨äºä½ çš„æ•°æ®ä½¿ç”¨çš„è¯­è¨€ã€‚æœ‰æ—¶å€™ä½ æƒ³è¦ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸâ€”â€‹ä¸ä½¿ç”¨åˆ†æï¼Œç›´æ¥ç´¢å¼•ä½ ä¼ å…¥çš„ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ç”¨æˆ·IDæˆ–è€…ä¸€ä¸ªå†…éƒ¨çš„çŠ¶æ€åŸŸæˆ–æ ‡ç­¾ã€‚</p>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨æŒ‡å®šè¿™äº›åŸŸçš„æ˜ å°„ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å¯åŠ¨ELKè„šæœ¬å‘½ä»¤</title>
    <url>/wiki/%E5%90%AF%E5%8A%A8ELK%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="esuser-æˆæƒ"><a href="#esuser-æˆæƒ" class="headerlink" title="esuser æˆæƒ"></a>esuser æˆæƒ</h2><p><code>chown -R esuser /usr/local/elasticsearch/*</code></p>
<h2 id="elastcisearch-å¯åŠ¨è„šæœ¬"><a href="#elastcisearch-å¯åŠ¨è„šæœ¬" class="headerlink" title="elastcisearch å¯åŠ¨è„šæœ¬"></a>elastcisearch å¯åŠ¨è„šæœ¬</h2><p><code>nohup ./elasticsearch-7.10.0/bin/elasticsearch &gt;&gt; ./elasticsearch-7.10.0/nohup.out 2&gt;&amp;1 &amp;</code></p>
<h2 id="kibana-å¯åŠ¨è„šæœ¬"><a href="#kibana-å¯åŠ¨è„šæœ¬" class="headerlink" title="kibana å¯åŠ¨è„šæœ¬"></a>kibana å¯åŠ¨è„šæœ¬</h2><p><code>nohup ./bin/kibana &gt;&gt; ./nohup.out 2&gt;&amp;1 &amp;</code></p>
<h2 id="logstash-å¯åŠ¨è„šæœ¬"><a href="#logstash-å¯åŠ¨è„šæœ¬" class="headerlink" title="logstash å¯åŠ¨è„šæœ¬"></a>logstash å¯åŠ¨è„šæœ¬</h2><p><code>nohup /usr/local/logstash/logstash-7.10.0/bin/logstash -f /usr/local/logstash/logstash-7.10.0/config/redtom-logstash.conf</code></p>
<p><code>nohup /usr/local/logstash/logstash-7.10.0/bin/logstash -f /usr/local/logstash/logstash-7.10.0/config/redtom-logstash.conf &gt;&gt; /usr/local/logstash/logstash-7.10.0/nohup.out 2&gt;&amp;1 &amp;</code></p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Administration and Deployment</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºç¡€é¢è¯•é¢˜ç›®</title>
    <url>/wiki/%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE/</url>
    <content><![CDATA[<h2 id="1-Stringä¸å¯å˜"><a href="#1-Stringä¸å¯å˜" class="headerlink" title="1.Stringä¸å¯å˜"></a>1.Stringä¸å¯å˜</h2><p>String å¯¹è±¡çš„ä¸å¯å˜æ€§</p>
<p>äº†è§£äº† String å¯¹è±¡çš„å®ç°åï¼Œä½ æœ‰æ²¡æœ‰å‘ç°åœ¨å®ç°ä»£ç ä¸­ String ç±»è¢« final å…³é”®å­—ä¿®é¥°äº†ï¼Œè€Œä¸”å˜é‡ char æ•°ç»„ä¹Ÿè¢« final ä¿®é¥°äº†ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ç±»è¢« final ä¿®é¥°ä»£è¡¨è¯¥ç±»ä¸å¯ç»§æ‰¿ï¼Œè€Œ char[] è¢« final+private ä¿®é¥°ï¼Œä»£è¡¨äº† String å¯¹è±¡ä¸å¯è¢«æ›´æ”¹ã€‚Java å®ç°çš„è¿™ä¸ªç‰¹æ€§å«ä½œ String å¯¹è±¡çš„ä¸å¯å˜æ€§ï¼Œå³ String å¯¹è±¡ä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œå°±ä¸èƒ½å†å¯¹å®ƒè¿›è¡Œæ”¹å˜ã€‚</p>
<p>Java è¿™æ ·åšçš„å¥½å¤„åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>ç¬¬ä¸€ï¼Œä¿è¯ String å¯¹è±¡çš„å®‰å…¨æ€§ã€‚å‡è®¾ String å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆ String å¯¹è±¡å°†å¯èƒ½è¢«æ¶æ„ä¿®æ”¹ã€‚</p>
<p>ç¬¬äºŒï¼Œä¿è¯ hash å±æ€§å€¼ä¸ä¼šé¢‘ç¹å˜æ›´ï¼Œç¡®ä¿äº†å”¯ä¸€æ€§ï¼Œä½¿å¾—ç±»ä¼¼ HashMap å®¹å™¨æ‰èƒ½å®ç°ç›¸åº”çš„ key-value ç¼“å­˜åŠŸèƒ½ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œå¯ä»¥å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡å­—ç¬¦ä¸²å¸¸é‡çš„æ–¹å¼åˆ›å»ºï¼Œå¦‚ String str=â€œabcâ€ï¼›å¦ä¸€ç§æ˜¯å­—ç¬¦ä¸²å˜é‡é€šè¿‡ new å½¢å¼çš„åˆ›å»ºï¼Œå¦‚ String str = new String(â€œabcâ€)ã€‚</p>
<p>å½“ä»£ç ä¸­ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆä¼šæ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦‚æœåœ¨ï¼Œå°±è¿”å›è¯¥å¯¹è±¡å¼•ç”¨ï¼Œå¦åˆ™æ–°çš„å­—ç¬¦ä¸²å°†åœ¨å¸¸é‡æ± ä¸­è¢«åˆ›å»ºã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘åŒä¸€ä¸ªå€¼çš„å­—ç¬¦ä¸²å¯¹è±¡çš„é‡å¤åˆ›å»ºï¼ŒèŠ‚çº¦å†…å­˜ã€‚</p>
<h3 id="2-String-å’Œ-StringBuilderã€StringBuffer-çš„åŒºåˆ«ï¼Ÿ"><a href="#2-String-å’Œ-StringBuilderã€StringBuffer-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2.String å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ"></a>2.String å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿ</h3><p><a href="https://www.cnblogs.com/weibanggang/p/9455926.html">https://www.cnblogs.com/weibanggang/p/9455926.html</a></p>
<h2 id="3-æè¿°ä¸€ä¸‹-JVM-åŠ è½½-class-æ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿ"><a href="#3-æè¿°ä¸€ä¸‹-JVM-åŠ è½½-class-æ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿ" class="headerlink" title="3.æè¿°ä¸€ä¸‹ JVM åŠ è½½ class æ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿ"></a>3.æè¿°ä¸€ä¸‹ JVM åŠ è½½ class æ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿ</h2><p><a href="https://www.cnblogs.com/williamjie/p/11167920.html">https://www.cnblogs.com/williamjie/p/11167920.html</a></p>
<h2 id="4-char-å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"><a href="#4-char-å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="4.char å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ"></a>4.char å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h2><p>æ­£ç¡®ç­”æ¡ˆï¼š</p>
<p>charå‹å˜é‡æ˜¯ç”¨æ¥å­˜å‚¨Unicodeç¼–ç çš„å­—ç¬¦çš„ï¼Œunicodeç¼–ç å­—ç¬¦é›†ä¸­åŒ…å«äº†æ±‰å­—ï¼Œ</p>
<p>æ‰€ä»¥ï¼Œcharå‹å˜é‡ä¸­å½“ç„¶å¯ä»¥å­˜å‚¨æ±‰å­—å•¦ã€‚ä¸è¿‡ï¼Œå¦‚æœæŸä¸ªç‰¹æ®Šçš„æ±‰å­—æ²¡æœ‰è¢«åŒ…å«åœ¨unicodeç¼–ç å­—ç¬¦é›†ä¸­ï¼Œ</p>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªcharå‹å˜é‡ä¸­å°±ä¸èƒ½å­˜å‚¨è¿™ä¸ªç‰¹æ®Šæ±‰å­—ã€‚</p>
<p>è¡¥å……è¯´æ˜ï¼šunicodeç¼–ç å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ï¼Œcharç±»å‹çš„å˜é‡ä¹Ÿæ˜¯å ç”¨ä¸¤ä¸ªå­—èŠ‚</p>
<h2 id="5-æŠ½è±¡ç±»ï¼ˆabstract-classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ"><a href="#5-æŠ½è±¡ç±»ï¼ˆabstract-classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ" class="headerlink" title="5.æŠ½è±¡ç±»ï¼ˆabstract classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ"></a>5.æŠ½è±¡ç±»ï¼ˆabstract classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ</h2><p><a href="https://blog.csdn.net/aptentity/article/details/68942916">https://blog.csdn.net/aptentity/article/details/68942916</a></p>
<h2 id="6-é™æ€åµŒå¥—ç±»-Static-Nested-Class-å’Œå†…éƒ¨ç±»ï¼ˆInner-Classï¼‰çš„ä¸åŒï¼Ÿ"><a href="#6-é™æ€åµŒå¥—ç±»-Static-Nested-Class-å’Œå†…éƒ¨ç±»ï¼ˆInner-Classï¼‰çš„ä¸åŒï¼Ÿ" class="headerlink" title="6.é™æ€åµŒå¥—ç±»(Static Nested Class)å’Œå†…éƒ¨ç±»ï¼ˆInner Classï¼‰çš„ä¸åŒï¼Ÿ"></a>6.é™æ€åµŒå¥—ç±»(Static Nested Class)å’Œå†…éƒ¨ç±»ï¼ˆInner Classï¼‰çš„ä¸åŒï¼Ÿ</h2><p><a href="https://blog.csdn.net/machinecat0898/article/details/80071242">https://blog.csdn.net/machinecat0898/article/details/80071242</a></p>
<h2 id="7-æŠ½è±¡çš„ï¼ˆabstractï¼‰æ–¹æ³•æ˜¯å¦å¯åŒæ—¶æ˜¯é™æ€çš„ï¼ˆstaticï¼‰-ï¼ˆnativeï¼‰ï¼Œ-synchronized-ä¿®é¥°ï¼Ÿ"><a href="#7-æŠ½è±¡çš„ï¼ˆabstractï¼‰æ–¹æ³•æ˜¯å¦å¯åŒæ—¶æ˜¯é™æ€çš„ï¼ˆstaticï¼‰-ï¼ˆnativeï¼‰ï¼Œ-synchronized-ä¿®é¥°ï¼Ÿ" class="headerlink" title="7.æŠ½è±¡çš„ï¼ˆabstractï¼‰æ–¹æ³•æ˜¯å¦å¯åŒæ—¶æ˜¯é™æ€çš„ï¼ˆstaticï¼‰,ï¼ˆnativeï¼‰ï¼Œ synchronized ä¿®é¥°ï¼Ÿ"></a>7.æŠ½è±¡çš„ï¼ˆabstractï¼‰æ–¹æ³•æ˜¯å¦å¯åŒæ—¶æ˜¯é™æ€çš„ï¼ˆstaticï¼‰,ï¼ˆnativeï¼‰ï¼Œ synchronized ä¿®é¥°ï¼Ÿ</h2><p> ç­”ï¼šéƒ½ä¸èƒ½ã€‚<br>æŠ½è±¡æ–¹æ³•éœ€è¦å­ç±»é‡å†™ï¼Œè€Œé™æ€çš„æ–¹æ³•æ˜¯æ— æ³•è¢«é‡å†™çš„ï¼Œå› æ­¤äºŒè€…æ˜¯çŸ›ç›¾çš„ã€‚<br>æœ¬åœ°æ–¹æ³•æ˜¯ç”±æœ¬åœ°ä»£ç ï¼ˆå¦‚Cä»£ç ï¼‰å®ç°çš„æ–¹æ³•ï¼Œè€ŒæŠ½è±¡æ–¹æ³•æ˜¯æ²¡æœ‰å®ç°çš„ï¼Œä¹Ÿæ˜¯çŸ›ç›¾çš„ã€‚<br>synchronizedå’Œæ–¹æ³•çš„å®ç°ç»†èŠ‚æœ‰å…³ï¼ŒæŠ½è±¡æ–¹æ³•ä¸æ¶‰åŠå®ç°ç»†èŠ‚ï¼Œå› æ­¤ä¹Ÿæ˜¯ç›¸äº’çŸ›ç›¾çš„ã€‚ </p>
<h2 id="8-å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†"><a href="#8-å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†" class="headerlink" title="8.å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†"></a>8.å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†</h2><p><a href="https://www.cnblogs.com/fnlingnzb-learner/p/10649509.html">https://www.cnblogs.com/fnlingnzb-learner/p/10649509.html</a></p>
<h2 id="9-å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å®ƒçš„åŒ…å«ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰çš„æˆå‘˜å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶"><a href="#9-å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å®ƒçš„åŒ…å«ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰çš„æˆå‘˜å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶" class="headerlink" title="9.å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å®ƒçš„åŒ…å«ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰çš„æˆå‘˜å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶"></a>9.å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å®ƒçš„åŒ…å«ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰çš„æˆå‘˜å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶</h2><p><a href="https://www.cnblogs.com/aademeng/articles/11084885.html">https://www.cnblogs.com/aademeng/articles/11084885.html</a><br><a href="https://www.cnblogs.com/dolphin0520/p/3811445.html">https://www.cnblogs.com/dolphin0520/p/3811445.html</a></p>
<p>é™æ€å†…éƒ¨ç±»ï¼šå®ƒæ˜¯ç”¨staticä¿®é¥°çš„ï¼Œåœ¨è®¿é—®é™åˆ¶ä¸Šå®ƒåªèƒ½è®¿é—®å¤–éƒ¨ç±»ä¸­çš„staticæ‰€ä¿®é¥°çš„æˆå‘˜å˜é‡æˆ–è€…æ˜¯æ–¹æ³•<br>æˆå‘˜å†…éƒ¨ç±»ï¼šæˆå‘˜å†…éƒ¨ç±»æ˜¯æœ€æ™®é€šçš„å†…éƒ¨ç±»ï¼Œå®ƒå¯ä»¥æ— æ¡ä»¶è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å±æ€§å’Œæˆå‘˜æ–¹æ³•ï¼ˆåŒ…æ‹¬privateæˆå‘˜å’Œé™æ€æˆå‘˜ï¼‰ã€‚<br>ã€æ³¨æ„ã€‘å½“æˆå‘˜å†…éƒ¨ç±»æ‹¥æœ‰å’Œå¤–éƒ¨ç±»åŒåçš„æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿéšè—ç°è±¡ï¼Œå³é»˜è®¤æƒ…å†µä¸‹è®¿é—®çš„æ˜¯æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ã€‚å¦‚æœè¦è®¿é—®å¤–éƒ¨ç±»çš„åŒåæˆå‘˜ï¼Œéœ€è¦ä»¥ä¸‹é¢çš„å½¢å¼è¿›è¡Œè®¿é—®ï¼š<br>å±€éƒ¨å†…éƒ¨ç±»ï¼šå±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¤–å›´ç±»çš„æ–¹æ³•ä¸­çš„ï¼Œåœ¨è®¿é—®çš„æ—¶å€™å®ƒå¯ä»¥ç›´æ¥è®¿é—®å¤–å›´ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ä½†æ˜¯ä¸èƒ½éšä¾¿è®¿é—®å±€éƒ¨å˜é‡ï¼Œé™¤éè¿™ä¸ªå±€éƒ¨å˜é‡è¢«finalä¿®é¥°ã€‚<br>åŒ¿åå†…éƒ¨ç±»ï¼š</p>
<h2 id="10-Java-ä¸­çš„-final-å…³é”®å­—æœ‰å“ªäº›ç”¨æ³•ï¼Ÿ"><a href="#10-Java-ä¸­çš„-final-å…³é”®å­—æœ‰å“ªäº›ç”¨æ³•ï¼Ÿ" class="headerlink" title="10.Java ä¸­çš„ final å…³é”®å­—æœ‰å“ªäº›ç”¨æ³•ï¼Ÿ"></a>10.Java ä¸­çš„ final å…³é”®å­—æœ‰å“ªäº›ç”¨æ³•ï¼Ÿ</h2><p><a href="https://www.cnblogs.com/dotgua/p/6357951.html">https://www.cnblogs.com/dotgua/p/6357951.html</a><br>å¤šçº¿ç¨‹ä¸‹çš„finalè¯­ä¹‰ ğŸ‘‡<br><a href="https://www.codercc.com/backend/basic/juc/concurrent-keywords/final.html#_1-final%E7%9A%84%E7%AE%80%E4%BB%8B">https://www.codercc.com/backend/basic/juc/concurrent-keywords/final.html#_1-final%E7%9A%84%E7%AE%80%E4%BB%8B</a></p>
<ul>
<li>ä¿®é¥°å˜é‡<br>åŸºæœ¬ç±»å‹çš„å˜é‡ï¼Œå€¼æ˜¯ä¸å¯ä»¥å˜åŒ–çš„<br>å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå¼•ç”¨æ˜¯ä¸å¯ä»¥å˜åŒ–çš„ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹å¼•ç”¨çš„å€¼<br>æ–¹æ³•å‚æ•°ï¼š ä¿è¯è¿™ä¸ªå˜é‡åœ¨è¿™ä¸ªæ–¹æ³•ä¸­çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–</li>
<li>ä¿®é¥°æ–¹æ³•<br>å®ƒè¡¨ç¤ºè¯¥æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ã€‚è¿™ç§ä½¿ç”¨æ–¹å¼ä¸»è¦æ˜¯ä»è®¾è®¡çš„è§’åº¦è€ƒè™‘ï¼Œå³æ˜ç¡®å‘Šè¯‰å…¶ä»–å¯èƒ½ä¼šç»§æ‰¿è¯¥ç±»çš„ç¨‹åºå‘˜ï¼Œä¸å¸Œæœ›ä»–ä»¬å»è¦†ç›–è¿™ä¸ªæ–¹æ³•ã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼Œç„¶è€Œï¼Œå…³äºprivateå’Œfinalå…³é”®å­—è¿˜æœ‰ä¸€ç‚¹è”ç³»ï¼Œè¿™å°±æ˜¯ç±»ä¸­æ‰€æœ‰çš„privateæ–¹æ³•éƒ½éšå¼åœ°æŒ‡å®šä¸ºæ˜¯finalçš„ï¼Œç”±äºæ— æ³•åœ¨ç±»å¤–ä½¿ç”¨privateæ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•è¦†ç›–å®ƒ</li>
<li>ä¿®é¥°ç±»<br>ç”¨finalä¿®é¥°çš„ç±»æ˜¯æ— æ³•è¢«ç»§æ‰¿çš„</li>
</ul>
<h2 id="11-Thread-ç±»çš„-sleep-æ–¹æ³•å’Œå¯¹è±¡çš„-wait-æ–¹æ³•éƒ½å¯ä»¥è®©çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#11-Thread-ç±»çš„-sleep-æ–¹æ³•å’Œå¯¹è±¡çš„-wait-æ–¹æ³•éƒ½å¯ä»¥è®©çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="11.Thread ç±»çš„ sleep()æ–¹æ³•å’Œå¯¹è±¡çš„ wait()æ–¹æ³•éƒ½å¯ä»¥è®©çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«?"></a>11.Thread ç±»çš„ sleep()æ–¹æ³•å’Œå¯¹è±¡çš„ wait()æ–¹æ³•éƒ½å¯ä»¥è®©çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«?</h2><p>sleep()æ–¹æ³•æ˜¯Threadç±»</p>
<pre><code>sleepæ˜¯Threadçš„é™æ€nativeæ–¹æ³•,å¯éšæ—¶è°ƒç”¨,ä¼šä½¿å½“å‰çº¿ç¨‹ä¼‘çœ ,å¹¶é‡Šæ”¾CPUèµ„æº,ä½†ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”;
</code></pre>
<p>wait()æ–¹æ³•æ˜¯Objectç±»</p>
<pre><code>wait()æ–¹æ³•æ˜¯Objectçš„nativeæ–¹æ³•,åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨,è°ƒç”¨ä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€,å¹¶é‡Šæ”¾CPUèµ„æºä¸å¯¹è±¡é”,éœ€è¦æˆ‘ä»¬è°ƒç”¨notify/notifyAllæ–¹æ³•å”¤é†’æŒ‡å®šæˆ–å…¨éƒ¨çš„ä¼‘çœ çº¿ç¨‹,å†æ¬¡ç«äº‰CPUèµ„æº.
</code></pre>
<p>æ³¨æ„:<br>sleep(long millis)å­˜åœ¨ç¡çœ æ—¶é—´,ä¸ç®—ç‰¹ç‚¹<br>å› ä¸ºwait()æ–¹æ³•å­˜åœ¨é‡è½½wait(long timeout),å³è®¾ç½®äº†ç­‰å¾…è¶…æ—¶æ—¶é—´<br>å®ƒä»¬ä¸¤ä¸ªéƒ½éœ€è¦å†æ¬¡æŠ¢å¤ºCPUèµ„æº</p>
<h2 id="12-çº¿ç¨‹çš„-sleep-æ–¹æ³•å’Œ-yield-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#12-çº¿ç¨‹çš„-sleep-æ–¹æ³•å’Œ-yield-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="12.çº¿ç¨‹çš„ sleep()æ–¹æ³•å’Œ yield()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>12.çº¿ç¨‹çš„ sleep()æ–¹æ³•å’Œ yield()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>sleep()æ–¹æ³•åœ¨ç»™å…¶ä»–çº¿ç¨‹è¿è¡Œæœºä¼šæ—¶ä¸è€ƒè™‘çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚å› æ­¤ä¼šç»™ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹è¿è¡Œçš„æœºä¼šï¼Œè€Œyield()æ–¹æ³•åªä¼šç»™ç›¸åŒä¼˜å…ˆçº§æˆ–æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹è¿è¡Œçš„æœºä¼šã€‚<br>çº¿ç¨‹æ‰§è¡Œsleep()æ–¹æ³•åä¼šè½¬å…¥é˜»å¡çŠ¶æ€ï¼Œæ‰€ä»¥æ‰§è¡Œsleep()æ–¹æ³•çš„çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…è‚¯å®šä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œyield()æ–¹æ³•åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°å°±ç»ªçŠ¶æ€ï¼Œæ‰€ä»¥æ‰§è¡Œyield()æ–¹æ³•çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å°±ç»ªçŠ¶æ€ååˆç«‹é©¬è¢«æ‰§è¡Œã€‚</p>
<h2 id="13-çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»"><a href="#13-çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»" class="headerlink" title="13.çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»"></a>13.çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³»</h2><img src='https://cdn.jsdelivr.net/gh/it-briefcode/it-briefcode-images/images/2020-10/15/15-58-29-0925f9fed78f11a87bbef280245e1e49-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%85%AD%E7%A7%8D%E8%BD%AC%E6%8D%A2-6ff1d1.png' width=600 height=450>
https://blog.csdn.net/zhangdongnihao/article/details/104029972
https://juejin.cn/post/6885159254764814349


<h2 id="14-è®¿é—®ä¿®é¥°ç¬¦-public-private-protected-ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰æ—¶çš„åŒºåˆ«ï¼Ÿ"><a href="#14-è®¿é—®ä¿®é¥°ç¬¦-public-private-protected-ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰æ—¶çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="14.è®¿é—®ä¿®é¥°ç¬¦ public,private,protected,ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰æ—¶çš„åŒºåˆ«ï¼Ÿ"></a>14.è®¿é—®ä¿®é¥°ç¬¦ public,private,protected,ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰æ—¶çš„åŒºåˆ«ï¼Ÿ</h2><img src="https://oscimg.oschina.net/oscnet/up-07ccdf4c85f874c49b19c6201cb826dc739.png" width=600 height=280 >

<h2 id="15-è¯·è¯´å‡ºä¸çº¿ç¨‹åŒæ­¥ä»¥åŠçº¿ç¨‹è°ƒåº¦ç›¸å…³çš„æ–¹æ³•ã€‚"><a href="#15-è¯·è¯´å‡ºä¸çº¿ç¨‹åŒæ­¥ä»¥åŠçº¿ç¨‹è°ƒåº¦ç›¸å…³çš„æ–¹æ³•ã€‚" class="headerlink" title="15.è¯·è¯´å‡ºä¸çº¿ç¨‹åŒæ­¥ä»¥åŠçº¿ç¨‹è°ƒåº¦ç›¸å…³çš„æ–¹æ³•ã€‚"></a>15.è¯·è¯´å‡ºä¸çº¿ç¨‹åŒæ­¥ä»¥åŠçº¿ç¨‹è°ƒåº¦ç›¸å…³çš„æ–¹æ³•ã€‚</h2><p>ï¼ˆ1ï¼‰ wait()ï¼šä½¿ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…ï¼ˆé˜»å¡ï¼‰çŠ¶æ€ï¼Œå¹¶ä¸”é‡Šæ”¾æ‰€æŒæœ‰çš„å¯¹è±¡çš„é”ï¼›<br>ï¼ˆ2ï¼‰sleep()ï¼šä½¿ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•è¦å¤„ç† InterruptedException å¼‚å¸¸ï¼›<br>ï¼ˆ3ï¼‰notify()ï¼šå”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œå½“ç„¶åœ¨è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ç¡®åˆ‡çš„å”¤é†’æŸä¸€ä¸ªç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œè€Œæ˜¯ç”± JVM ç¡®å®šå”¤é†’å“ªä¸ªçº¿ç¨‹ï¼Œè€Œä¸”ä¸ä¼˜å…ˆçº§æ— å…³ï¼›<br>ï¼ˆ4ï¼‰notityAll()ï¼šå”¤é†’æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¯¥æ–¹æ³•å¹¶ä¸æ˜¯å°†å¯¹è±¡çš„é”ç»™æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œæ˜¯è®©å®ƒä»¬ç«äº‰ï¼Œåªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥å°±ç»ªçŠ¶æ€ï¼›</p>
<blockquote>
<p>è¡¥å……ï¼šJava 5 é€šè¿‡ Lock æ¥å£æä¾›äº†æ˜¾å¼çš„é”æœºåˆ¶ï¼ˆexplicit lockï¼‰ï¼Œå¢å¼ºäº†çµæ´»æ€§ä»¥åŠå¯¹çº¿ç¨‹çš„åè°ƒã€‚Lock æ¥å£ä¸­å®šä¹‰äº†åŠ é”ï¼ˆlock()ï¼‰å’Œè§£é”ï¼ˆunlock()ï¼‰çš„æ–¹æ³•ï¼ŒåŒæ—¶è¿˜æä¾›äº† newCondition()æ–¹æ³•æ¥äº§ç”Ÿç”¨äºçº¿ç¨‹ä¹‹é—´é€šä¿¡çš„ Condition å¯¹è±¡ï¼›æ­¤å¤–ï¼ŒJava 5 è¿˜æä¾›äº†ä¿¡å·é‡æœºåˆ¶ï¼ˆsemaphoreï¼‰ï¼Œä¿¡å·é‡å¯ä»¥ç”¨æ¥é™åˆ¶å¯¹æŸä¸ªå…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„çº¿ç¨‹çš„æ•°é‡ã€‚åœ¨å¯¹èµ„æºè¿›è¡Œè®¿é—®ä¹‹å‰ï¼Œçº¿ç¨‹å¿…é¡»å¾—åˆ°ä¿¡å·é‡çš„è®¸å¯ï¼ˆè°ƒç”¨ Semaphore å¯¹è±¡çš„ acquire()æ–¹æ³•ï¼‰ï¼›åœ¨å®Œæˆå¯¹èµ„æºçš„è®¿é—®åï¼Œçº¿ç¨‹å¿…é¡»å‘ä¿¡å·é‡å½’è¿˜è®¸å¯ï¼ˆè°ƒç”¨ Semaphore å¯¹è±¡çš„ release()æ–¹æ³•ï¼‰ã€‚</p>
</blockquote>
<h2 id="16-synchronized-å…³é”®å­—çš„ç”¨æ³•ï¼Ÿ"><a href="#16-synchronized-å…³é”®å­—çš„ç”¨æ³•ï¼Ÿ" class="headerlink" title="16.synchronized å…³é”®å­—çš„ç”¨æ³•ï¼Ÿ"></a>16.synchronized å…³é”®å­—çš„ç”¨æ³•ï¼Ÿ</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">m1</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SyncDemo.class)&#123;</span><br><span class="line">            <span class="comment">// TODO</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">m3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="17-Java-ä¸­å¦‚ä½•å®ç°åºåˆ—åŒ–ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"><a href="#17-Java-ä¸­å¦‚ä½•å®ç°åºåˆ—åŒ–ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ" class="headerlink" title="17.Java ä¸­å¦‚ä½•å®ç°åºåˆ—åŒ–ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ"></a>17.Java ä¸­å¦‚ä½•å®ç°åºåˆ—åŒ–ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ</h2><p>åºåˆ—åŒ–å°±æ˜¯ä¸€ç§ç”¨æ¥å¤„ç†å¯¹è±¡æµçš„æœºåˆ¶ï¼Œæ‰€è°“å¯¹è±¡æµä¹Ÿå°±æ˜¯å°†å¯¹è±¡çš„å†…å®¹è¿›è¡ŒæµåŒ–ã€‚å¯ä»¥å¯¹æµåŒ–åçš„å¯¹è±¡è¿›è¡Œè¯»å†™æ“ä½œï¼Œä¹Ÿå¯å°†æµåŒ–åçš„å¯¹è±¡ä¼ è¾“äºç½‘ç»œä¹‹é—´ã€‚<br>åºåˆ—åŒ–æ˜¯ä¸ºäº†è§£å†³å¯¹è±¡æµè¯»å†™æ“ä½œæ—¶å¯èƒ½å¼•å‘çš„é—®é¢˜ï¼ˆå¦‚æœä¸è¿›è¡Œåºåˆ—åŒ–å¯èƒ½ä¼šå­˜åœ¨æ•°æ®ä¹±åºçš„é—®é¢˜ï¼‰ã€‚è¦å®ç°åºåˆ—åŒ–ï¼Œéœ€è¦è®©ä¸€ä¸ªç±»å®ç° Serializable æ¥å£ï¼Œè¯¥æ¥å£æ˜¯ä¸€ä¸ªæ ‡è¯†æ€§æ¥å£ï¼Œæ ‡æ³¨è¯¥ç±»å¯¹è±¡æ˜¯å¯è¢«åºåˆ—åŒ–çš„ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªè¾“å‡ºæµæ¥æ„é€ ä¸€ä¸ªå¯¹è±¡è¾“å‡ºæµå¹¶é€šè¿‡ writeObject(Object)æ–¹æ³•å°±å¯ä»¥å°†å®ç°å¯¹è±¡å†™å‡ºï¼ˆå³ä¿å­˜å…¶çŠ¶æ€ï¼‰ï¼›å¦‚æœéœ€è¦ååºåˆ—åŒ–åˆ™å¯ä»¥ç”¨ä¸€ä¸ªè¾“å…¥æµå»ºç«‹å¯¹è±¡è¾“å…¥æµï¼Œç„¶åé€šè¿‡ readObject æ–¹æ³•ä»æµä¸­è¯»å–å¯¹è±¡ã€‚åºåˆ—åŒ–é™¤äº†èƒ½å¤Ÿå®ç°å¯¹è±¡çš„æŒä¹…åŒ–ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿç”¨äºå¯¹è±¡çš„æ·±åº¦å…‹éš†</p>
<h2 id="18-é˜è¿°-JDBC-æ“ä½œæ•°æ®åº“çš„æ­¥éª¤"><a href="#18-é˜è¿°-JDBC-æ“ä½œæ•°æ®åº“çš„æ­¥éª¤" class="headerlink" title="18.é˜è¿° JDBC æ“ä½œæ•°æ®åº“çš„æ­¥éª¤"></a>18.é˜è¿° JDBC æ“ä½œæ•°æ®åº“çš„æ­¥éª¤</h2><p>ä¸‹é¢çš„ä»£ç ä»¥è¿æ¥æœ¬æœºçš„ Oracle æ•°æ®åº“ä¸ºä¾‹ï¼Œæ¼”ç¤º JDBC æ“ä½œæ•°æ®åº“çš„æ­¥éª¤ã€‚<br>ï¼ˆ1ï¼‰ åŠ è½½é©±åŠ¨ã€‚<br><code>Class.forName(&quot;oracle.jdbc.driver.OracleDriver&quot;);</code><br>ï¼ˆ2ï¼‰ åˆ›å»ºè¿æ¥ã€‚<br><code>Connection con = DriverManager.getConnection(&quot;jdbc:oracle:thin:@localhost:1521:orcl&quot;,&quot;scott&quot;, &quot;tiger&quot;);</code><br>ï¼ˆ3ï¼‰ åˆ›å»ºè¯­å¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PreparedStatement ps = con.prepareStatement(<span class="string">&quot;select * from emp where sal between ? and ?&quot;</span>);</span><br><span class="line">ps.setint(<span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line">ps.setint(<span class="number">2</span>, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ4ï¼‰æ‰§è¡Œè¯­å¥ã€‚<br><code>ResultSet rs = ps.executeQuery();</code><br>ï¼ˆ5ï¼‰å¤„ç†ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">	System.out.println(rs.getint(<span class="string">&quot;empno&quot;</span>) + <span class="string">&quot; - &quot;</span> +</span><br><span class="line">	rs.getString(<span class="string">&quot;ename&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ6ï¼‰ å…³é—­èµ„æºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(con != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			con.close();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æç¤ºï¼šå…³é—­å¤–éƒ¨èµ„æºçš„é¡ºåºåº”è¯¥å’Œæ‰“å¼€çš„é¡ºåºç›¸åï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆå…³é—­ ResultSetã€å†å…³é—­ Statementã€åœ¨å…³é—­ Connectionã€‚ä¸Šé¢çš„ä»£ç åªå…³é—­äº† Connectionï¼ˆè¿æ¥ï¼‰ï¼Œè™½ç„¶é€šå¸¸æƒ…å†µä¸‹åœ¨å…³é—­è¿æ¥æ—¶ï¼Œè¿æ¥ä¸Šåˆ›å»ºçš„è¯­å¥å’Œæ‰“å¼€çš„æ¸¸æ ‡ä¹Ÿä¼šå…³é—­ï¼Œä½†ä¸èƒ½ä¿è¯æ€»æ˜¯å¦‚æ­¤ï¼Œå› æ­¤åº”è¯¥æŒ‰ç…§åˆšæ‰è¯´çš„é¡ºåºåˆ†åˆ«å…³é—­ã€‚æ­¤å¤–ï¼Œç¬¬ä¸€æ­¥åŠ è½½é©±åŠ¨åœ¨ JDBC 4.0 ä¸­æ˜¯å¯ä»¥çœç•¥çš„ï¼ˆè‡ªåŠ¨ä»ç±»è·¯å¾„ä¸­åŠ è½½é©±åŠ¨ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å»ºè®®ä¿ç•™ã€‚</p>
<h2 id="19-Statement-å’Œ-PreparedStatement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ"><a href="#19-Statement-å’Œ-PreparedStatement-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ" class="headerlink" title="19.Statement å’Œ PreparedStatement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ"></a>19.Statement å’Œ PreparedStatement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿ</h2><p>ä¸ Statement ç›¸æ¯”ï¼Œ<br>â‘ PreparedStatement æ¥å£ä»£è¡¨é¢„ç¼–è¯‘çš„è¯­å¥ï¼Œå®ƒä¸»è¦çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å‡å°‘ SQL çš„ç¼–è¯‘é”™è¯¯å¹¶å¢åŠ  SQL çš„å®‰å…¨æ€§ï¼ˆå‡å°‘ SQL æ³¨å°„æ”»å‡»çš„å¯èƒ½æ€§ï¼‰ï¼›â‘¡PreparedStatement ä¸­çš„ SQL è¯­å¥æ˜¯å¯ä»¥å¸¦å‚æ•°çš„ï¼Œé¿å…äº†ç”¨å­—ç¬¦ä¸²è¿æ¥æ‹¼æ¥ SQL è¯­å¥çš„éº»çƒ¦å’Œä¸å®‰å…¨ï¼›<br>â‘¢å½“æ‰¹é‡å¤„ç† SQL æˆ–é¢‘ç¹æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢æ—¶ï¼ŒPreparedStatement æœ‰æ˜æ˜¾çš„æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ï¼Œç”±äºæ•°æ®åº“å¯ä»¥å°†ç¼–è¯‘ä¼˜åŒ–åçš„SQLè¯­å¥ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æ‰§è¡Œç›¸åŒç»“æ„çš„è¯­å¥æ—¶å°±ä¼šå¾ˆå¿«ï¼ˆä¸ç”¨å†æ¬¡ç¼–è¯‘å’Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼‰ã€‚</p>
<blockquote>
<p>è¡¥å……ï¼šä¸ºäº†æä¾›å¯¹å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨ï¼ŒJDBC API ä¸­è¿˜æä¾›äº† CallableStatement æ¥å£ã€‚å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯æ•°æ®åº“ä¸­ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥çš„é›†åˆï¼Œç»ç¼–è¯‘åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥æ‰§è¡Œå®ƒã€‚è™½ç„¶è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ä¼šåœ¨ç½‘ç»œå¼€é”€ã€å®‰å…¨æ€§ã€æ€§èƒ½ä¸Šè·å¾—å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯å­˜åœ¨å¦‚æœåº•å±‚æ•°æ®åº“å‘ç”Ÿè¿ç§»æ—¶å°±ä¼šæœ‰å¾ˆå¤šéº»çƒ¦ï¼Œå› ä¸ºæ¯ç§æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹åœ¨ä¹¦å†™ä¸Šå­˜åœ¨ä¸å°‘çš„å·®åˆ«ã€‚</p>
</blockquote>
<h2 id="20-åœ¨è¿›è¡Œæ•°æ®åº“ç¼–ç¨‹æ—¶ï¼Œè¿æ¥æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#20-åœ¨è¿›è¡Œæ•°æ®åº“ç¼–ç¨‹æ—¶ï¼Œè¿æ¥æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="20.åœ¨è¿›è¡Œæ•°æ®åº“ç¼–ç¨‹æ—¶ï¼Œè¿æ¥æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>20.åœ¨è¿›è¡Œæ•°æ®åº“ç¼–ç¨‹æ—¶ï¼Œè¿æ¥æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h2><p>ç”±äºåˆ›å»ºè¿æ¥å’Œé‡Šæ”¾è¿æ¥éƒ½æœ‰å¾ˆå¤§çš„å¼€é”€ï¼ˆå°¤å…¶æ˜¯æ•°æ®åº“æœåŠ¡å™¨ä¸åœ¨æœ¬åœ°æ—¶ï¼Œæ¯æ¬¡å»ºç«‹è¿æ¥éƒ½éœ€è¦è¿›è¡Œ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‡Šæ”¾è¿æ¥éœ€è¦è¿›è¡Œ TCP å››æ¬¡æ¡æ‰‹ï¼Œé€ æˆçš„å¼€é”€æ˜¯ä¸å¯å¿½è§†çš„ï¼‰ï¼Œ<code>ä¸ºäº†æå‡ç³»ç»Ÿè®¿é—®æ•°æ®åº“çš„æ€§èƒ½ï¼Œå¯ä»¥äº‹å…ˆåˆ›å»ºè‹¥å¹²è¿æ¥ç½®äºè¿æ¥æ± ä¸­ï¼Œéœ€è¦æ—¶ç›´æ¥ä»è¿æ¥æ± è·å–ï¼Œä½¿ç”¨ç»“æŸæ—¶å½’è¿˜è¿æ¥æ± è€Œä¸å¿…å…³é—­è¿æ¥ï¼Œä»è€Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾è¿æ¥æ‰€é€ æˆçš„å¼€é”€</code>ï¼Œè¿™æ˜¯å…¸å‹çš„ç”¨ç©ºé—´æ¢å–æ—¶é—´çš„ç­–ç•¥ï¼ˆæµªè´¹äº†ç©ºé—´å­˜å‚¨è¿æ¥ï¼Œä½†èŠ‚çœäº†åˆ›å»ºå’Œé‡Šæ”¾è¿æ¥çš„æ—¶é—´ï¼‰ã€‚æ± åŒ–æŠ€æœ¯åœ¨Java å¼€å‘ä¸­æ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ—¶åˆ›å»ºçº¿ç¨‹æ± çš„é“ç†ä¸æ­¤ç›¸åŒã€‚åŸºäº Java çš„å¼€æºæ•°æ®åº“è¿æ¥æ± ä¸»è¦æœ‰ï¼šC3P0ã€Proxoolã€DBCPã€BoneCPã€Druid ç­‰ã€‚</p>
<blockquote>
<p>è¡¥å……ï¼šåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­æ—¶é—´å’Œç©ºé—´æ˜¯ä¸å¯è°ƒå’Œçš„çŸ›ç›¾ï¼Œç†è§£è¿™ä¸€ç‚¹å¯¹è®¾è®¡æ»¡è¶³æ€§èƒ½è¦æ±‚çš„ç®—æ³•æ˜¯è‡³å…³é‡è¦çš„ã€‚å¤§å‹ç½‘ç«™æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªå…³é”®å°±æ˜¯ä½¿ç”¨ç¼“å­˜ï¼Œè€Œç¼“å­˜è·Ÿä¸Šé¢è®²çš„è¿æ¥æ± é“ç†éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚å¯ä»¥å°†çƒ­ç‚¹æ•°æ®ç½®äºç¼“å­˜ä¸­ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢è¿™äº›æ•°æ®æ—¶å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å¾—åˆ°ï¼Œè¿™æ— è®ºå¦‚ä½•ä¹Ÿå¿«è¿‡å»æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚å½“ç„¶ï¼Œç¼“å­˜çš„ç½®æ¢ç­–ç•¥ç­‰ä¹Ÿä¼šå¯¹ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿé‡è¦å½±å“ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜çš„è®¨è®ºå·²ç»è¶…å‡ºäº†è¿™é‡Œè¦é˜è¿°çš„èŒƒå›´ã€‚</p>
</blockquote>
<h2 id="21-ä»€ä¹ˆæ˜¯-DAO-æ¨¡å¼"><a href="#21-ä»€ä¹ˆæ˜¯-DAO-æ¨¡å¼" class="headerlink" title="21.ä»€ä¹ˆæ˜¯ DAO æ¨¡å¼?"></a>21.ä»€ä¹ˆæ˜¯ DAO æ¨¡å¼?</h2><p>DAOï¼ˆData Access Objectï¼‰é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªä¸ºæ•°æ®åº“æˆ–å…¶ä»–æŒä¹…åŒ–æœºåˆ¶æä¾›äº†æŠ½è±¡æ¥å£çš„å¯¹è±¡ï¼Œåœ¨ä¸æš´éœ²åº•å±‚æŒä¹…åŒ–æ–¹æ¡ˆå®ç°ç»†èŠ‚çš„å‰æä¸‹æä¾›äº†å„ç§æ•°æ®è®¿é—®æ“ä½œã€‚åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œåº”è¯¥å°†æ‰€æœ‰å¯¹æ•°æ®æºçš„è®¿é—®æ“ä½œè¿›è¡ŒæŠ½è±¡åŒ–åå°è£…åœ¨ä¸€ä¸ªå…¬å…±APIä¸­ã€‚<br>ç”¨ç¨‹åºè®¾è®¡è¯­è¨€æ¥è¯´ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­å®šä¹‰äº†æ­¤åº”ç”¨ç¨‹åºä¸­å°†ä¼šç”¨åˆ°çš„æ‰€æœ‰äº‹åŠ¡æ–¹æ³•ã€‚åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œå½“éœ€è¦å’Œæ•°æ®æºè¿›è¡Œäº¤äº’çš„æ—¶å€™åˆ™ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œåœ¨é€»è¾‘ä¸Šè¯¥ç±»å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æ•°æ®å­˜å‚¨ã€‚DAO æ¨¡å¼å®é™…ä¸ŠåŒ…å«äº†ä¸¤ä¸ªæ¨¡å¼ï¼Œä¸€æ˜¯ DataAccessorï¼ˆæ•°æ®è®¿é—®å™¨ï¼‰ï¼ŒäºŒæ˜¯ Data Objectï¼ˆæ•°æ®å¯¹è±¡ï¼‰ï¼Œå‰è€…è¦è§£å†³å¦‚ä½•è®¿é—®æ•°æ®çš„é—®é¢˜ï¼Œè€Œåè€…è¦è§£å†³çš„æ˜¯å¦‚ä½•ç”¨å¯¹è±¡å°è£…æ•°æ®ã€‚</p>
<h2 id="22-Java-ä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿ"><a href="#22-Java-ä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿ" class="headerlink" title="22.Java ä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿ"></a>22.Java ä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼Ÿ</h2><p>Java ä¸­çš„ String ç±»æä¾›äº†æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼šmatches()ã€replaceAll()ã€replaceFirst()ã€split()ã€‚æ­¤å¤–ï¼ŒJava ä¸­å¯ä»¥ç”¨ Pattern ç±»è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„ API è¿›è¡Œå„ç§æ­£åˆ™è¡¨è¾¾å¼æ“ä½œã€‚é¢è¯•é¢˜ï¼š - å¦‚æœè¦ä»å­—ç¬¦ä¸²ä¸­æˆªå–ç¬¬ä¸€ä¸ªè‹±æ–‡å·¦æ‹¬å·ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šåŒ—äº¬å¸‚(æœé˜³åŒº)(è¥¿åŸåŒº)(æµ·æ·€åŒº)ï¼Œæˆªå–ç»“æœä¸ºï¼šåŒ—äº¬å¸‚ï¼Œé‚£ä¹ˆæ­£åˆ™è¡¨è¾¾å¼æ€ä¹ˆå†™ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegExpTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String str = <span class="string">&quot;åŒ—äº¬å¸‚(æœé˜³åŒº)(è¥¿åŸåŒº)(æµ·æ·€åŒº)&quot;</span>;</span><br><span class="line">		Pattern p = Pattern.compile(<span class="string">&quot;.*?(?=\()&quot;</span>);</span><br><span class="line">		Matcher m = p.matcher(str);</span><br><span class="line">		<span class="keyword">if</span>(m.find()) &#123;</span><br><span class="line">			System.out.println(m.group());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºBIOå®ç°ç®€æ˜“tomcat</title>
    <url>/wiki/%E5%9F%BA%E4%BA%8EBIO%E5%AE%9E%E7%8E%B0%E7%AE%80%E6%98%93tomcat/</url>
    <content><![CDATA[<h1 id="åŸºäºä¼ ç»Ÿçš„BIOæ‰‹å†™ä¸€ä¸ªç®€æ˜“Tomcat"><a href="#åŸºäºä¼ ç»Ÿçš„BIOæ‰‹å†™ä¸€ä¸ªç®€æ˜“Tomcat" class="headerlink" title="åŸºäºä¼ ç»Ÿçš„BIOæ‰‹å†™ä¸€ä¸ªç®€æ˜“Tomcat"></a>åŸºäºä¼ ç»Ÿçš„BIOæ‰‹å†™ä¸€ä¸ªç®€æ˜“Tomcat</h1><p>æœ¬æ–‡ä¸»è¦åŸºäºä¼ ç»Ÿçš„BIOæ¥å®ç°ä¸€ä¸ªç®€å•çš„Httpè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼›<br>1ã€Servletè¯·æ±‚æ— éå°±æ˜¯doGet/doPostï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰æŠ½è±¡Servletè®°å¿†GET/POSTæ–¹æ³•ï¼›<br>2ã€åŸºäºSocketå’ŒServerSocketå®ç°CSé€šä¿¡ï¼›<br>3ã€æ¨¡æ‹ŸSpringåŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ³¨å†Œè¯·æ±‚ä»¥åŠæ§åˆ¶å™¨ï¼›  </p>
<p><img src="https://oscimg.oschina.net/oscnet/up-b6fb1dfc1fbbb3ae4d616c0a9572b08b4ad.png">   </p>
<h2 id="GlRequest-å°è£…ä¸€ä¸ªè¯·æ±‚"><a href="#GlRequest-å°è£…ä¸€ä¸ªè¯·æ±‚" class="headerlink" title="GlRequest å°è£…ä¸€ä¸ªè¯·æ±‚"></a>GlRequest å°è£…ä¸€ä¸ªè¯·æ±‚</h2><blockquote>
<p>å½“ç„¶æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„è¯·æ±‚ï¼Œè¿™é‡Œåªå¤„ç†è¯·æ±‚çš„URLå’Œè¯·æ±‚æ–¹æ³•ï¼›<br>è·å–è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥æµï¼Œè§£ææ•°æ®Urlå’ŒMethodï¼Œå¹¶åšç›¸åº”çš„å¤„ç†ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String method;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlRequest</span><span class="params">(InputStream is)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è§£æhttpè¯·æ±‚çš„å…·ä½“å†…å®¹ï¼›</span></span><br><span class="line">            String content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> ((len = is.read(buff)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                content = <span class="keyword">new</span> String(buff, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            String line = content.split(<span class="string">&quot;\\n&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            String [] arr = line.split(<span class="string">&quot;\\s&quot;</span>);</span><br><span class="line">            <span class="keyword">this</span>.method = arr[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">this</span>.url = arr[<span class="number">1</span>].split(<span class="string">&quot;\\?&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUrl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.method;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GlResponse-å®šä¹‰è¿”å›å€¼response"><a href="#GlResponse-å®šä¹‰è¿”å›å€¼response" class="headerlink" title="GlResponse å®šä¹‰è¿”å›å€¼response"></a>GlResponse å®šä¹‰è¿”å›å€¼response</h2><blockquote>
<p>å¤„ç†è¯·æ±‚è¿”å›å€¼ï¼Œå°†ä¸šåŠ¡å¤„ç†çš„ç»“æœé€šè¿‡è¾“å‡ºæµè¾“å‡ºï¼›<br>è¾“å‡ºå¤§è‡´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€æ˜¯è¿”å›çš„æ•°æ®ï¼Œç¬¬äºŒæ˜¯è¿”å›æ•°æ®çš„Header;  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlResponse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> OutputStream outputStream;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GlResponse</span><span class="params">(OutputStream os)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.outputStream = os;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String string)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        sb.append(<span class="string">&quot;HTTP/1.1 200 OK\n&quot;</span>)</span><br><span class="line">                .append(<span class="string">&quot;Content-Type: text/html;\n&quot;</span>)</span><br><span class="line">                .append(<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">                .append(string);</span><br><span class="line">        outputStream.write(sb.toString().getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GlServlet-å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•"><a href="#GlServlet-å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•" class="headerlink" title="GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•"></a>GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³•</h2><blockquote>
<p>å®šä¹‰æŠ½è±¡çš„Servletå’ŒdoGetæ–¹æ³•å’ŒdoPostæ–¹æ³•ï¼Œå…·ä½“çš„ä¸šåŠ¡å»å®ç°è‡ªå·±çš„æ–¹æ³•å’Œé€»è¾‘ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String GET = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">           <span class="keyword">if</span> (GET.equals(request.getMethod())) &#123;</span><br><span class="line">               doGet(request, response);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               doPost(request, response);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="FirstServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•"><a href="#FirstServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•" class="headerlink" title="FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•"></a>FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstServlet</span> <span class="keyword">extends</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// å…·ä½“çš„é€»è¾‘</span></span><br><span class="line">        <span class="keyword">this</span>.doPost(request, response);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        response.write(<span class="string">&quot;This is first servlet from BIO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SecondServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•"><a href="#SecondServlet-å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•" class="headerlink" title="SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•"></a>SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondServlet</span> <span class="keyword">extends</span> <span class="title">GlServlet</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        doPost(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(GlRequest request, GlResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        response.write(<span class="string">&quot;This second request form BIO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="web-bio-properties-é…ç½®æ–‡ä»¶"><a href="#web-bio-properties-é…ç½®æ–‡ä»¶" class="headerlink" title="web-bio.properties é…ç½®æ–‡ä»¶"></a>web-bio.properties é…ç½®æ–‡ä»¶</h2><blockquote>
<p>é…ç½®è¯·æ±‚å’Œå¤„ç†å™¨ï¼ŒSpringä¸­æ˜¯é€šè¿‡Controllerä¸‹çš„@XXXMappingæ³¨è§£å»æ‰«æå¹¶åŠ è½½åˆ°å·¥å‚çš„ï¼›  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">servlet.one.className=com.ibli.netty.tomcat.bio.servlet.FirstServlet</span><br><span class="line">servlet.one.url=/firstServlet.<span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">servlet.two.className=com.ibli.netty.tomcat.bio.servlet.SecondServlet</span><br><span class="line">servlet.two.url=/secondServlet.<span class="keyword">do</span></span><br></pre></td></tr></table></figure>

<h2 id="GlTomcatæµ‹è¯•ç±»"><a href="#GlTomcatæµ‹è¯•ç±»" class="headerlink" title="GlTomcatæµ‹è¯•ç±»"></a>GlTomcatæµ‹è¯•ç±»</h2><blockquote>
<p>å¯åŠ¨æœåŠ¡ç«¯ï¼Œåœ¨ç½‘é¡µä¸­è®¿é—®æœ¬åœ°8080ç«¯å£ï¼Œè¾“å…¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„urlè¿›è¡Œæµ‹è¯•ï¼š  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlTomcat</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ServerSocket server;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer PORT = <span class="number">8080</span>;</span><br><span class="line">    <span class="keyword">private</span> Properties webXml = <span class="keyword">new</span> Properties();</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, GlServlet&gt; servletMapping = <span class="keyword">new</span> HashMap&lt;String, GlServlet&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿé¡¹ç›®mainæ–¹æ³•ï¼Œå¯åŠ¨åŠ è½½é…ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args å¯åŠ¨å‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> GlTomcat().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Tomcatçš„å¯åŠ¨å…¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1ã€åŠ è½½webé…ç½®æ–‡ä»¶ï¼Œè§£æé…ç½®</span></span><br><span class="line">        init();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2ã€å¯åŠ¨æœåŠ¡å™¨socketï¼Œç­‰å¾…ç”¨æˆ·è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            server = <span class="keyword">new</span> ServerSocket(<span class="keyword">this</span>.PORT);</span><br><span class="line">            System.err.println(<span class="string">&quot;Gl tomcat started in port &quot;</span> + <span class="keyword">this</span>.PORT);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                Socket client = server.accept();</span><br><span class="line">                <span class="comment">// 3ã€è·å¾—è¯·æ±‚ä¿¡æ¯ï¼Œè§£æHTTPåè®®çš„å†…å®¹</span></span><br><span class="line">                process(client);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String WEB_INF = <span class="keyword">this</span>.getClass().getResource(<span class="string">&quot;/&quot;</span>).getPath();</span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(WEB_INF + <span class="string">&quot;web-bio.properties&quot;</span>);</span><br><span class="line">            webXml.load(fis);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (Object k : webXml.keySet()) &#123;</span><br><span class="line">                String key = k.toString();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (key.endsWith(<span class="string">&quot;.url&quot;</span>)) &#123;</span><br><span class="line">                    <span class="comment">//servlet.two.url</span></span><br><span class="line">                    String servletName = key.replaceAll(<span class="string">&quot;\\.url&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                    String url = webXml.getProperty(key);</span><br><span class="line">                    <span class="comment">//servlet.two.className</span></span><br><span class="line">                    String className = webXml.getProperty(servletName + <span class="string">&quot;.className&quot;</span>);</span><br><span class="line">                    <span class="comment">//åå°„åˆ›å»ºservletå®ä¾‹</span></span><br><span class="line">                    <span class="comment">// load-on-startup &gt;=1 :webå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–  0ï¼šç”¨æˆ·è¯·æ±‚çš„æ—¶å€™æ‰å¯åŠ¨</span></span><br><span class="line">                    GlServlet obj = (GlServlet) Class.forName(className).newInstance();</span><br><span class="line">                    <span class="comment">// å°†urlå’Œservletå»ºç«‹æ˜ å°„å…³ç³»</span></span><br><span class="line">                    servletMapping.put(url, obj);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æå®¢æˆ·ç«¯è¯·æ±‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Socket client)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        InputStream is = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream os = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è¯·æ±‚</span></span><br><span class="line">            is = client.getInputStream();</span><br><span class="line">            <span class="comment">//å°è£…è¿”å›å€¼</span></span><br><span class="line">            os = client.getOutputStream();</span><br><span class="line">            GlRequest request = <span class="keyword">new</span> GlRequest(is);</span><br><span class="line">            GlResponse response = <span class="keyword">new</span> GlResponse(os);</span><br><span class="line"></span><br><span class="line">            String url = request.getUrl();</span><br><span class="line">            <span class="keyword">if</span> (servletMapping.containsKey(url)) &#123;</span><br><span class="line">                servletMapping.get(url).service(request, response);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                response.write(<span class="string">&quot;404 Not found!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (os != <span class="keyword">null</span>) &#123;</span><br><span class="line">                os.flush();</span><br><span class="line">                os.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123;</span><br><span class="line">                is.close();</span><br><span class="line">                client.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰“å°è¯·æ±‚ä¿¡æ¯"><a href="#æ‰“å°è¯·æ±‚ä¿¡æ¯" class="headerlink" title="æ‰“å°è¯·æ±‚ä¿¡æ¯"></a>æ‰“å°è¯·æ±‚ä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Request content : GET /fitstServlet.<span class="keyword">do</span> HTTP/<span class="number">1.1</span></span><br><span class="line">Host: localhost:<span class="number">8080</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Macintosh; Intel Mac OS X <span class="number">10_14_5</span>) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">88.0</span><span class="number">.4324</span><span class="number">.150</span> Safari/<span class="number">537.36</span> OPR/<span class="number">74.0</span><span class="number">.3911</span><span class="number">.160</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: none</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: navigate</span></span><br><span class="line"><span class="comment">Sec-Fetch-User: ?1</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: document</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br></pre></td></tr></table></figure>

<h2 id="å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŠç»“æœå±•ç¤º"><a href="#å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŠç»“æœå±•ç¤º" class="headerlink" title="å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŠç»“æœå±•ç¤º"></a>å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŠç»“æœå±•ç¤º</h2><blockquote>
<p>è¯·æ±‚ï¼š <a href="http://localhost:8080/firstServlet.do">http://localhost:8080/firstServlet.do</a><br><img src="https://oscimg.oschina.net/oscnet/up-e4faf840776bb504c26ddd7266033651a09.png">  </p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>IO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>IO</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šæ¡¶æ’åº</title>
    <url>/wiki/%E5%A4%9A%E6%A1%B6%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<p>å¤šå€¼æ¡¶ï¼ˆ terms ã€ histogram å’Œ date_histogram ï¼‰åŠ¨æ€ç”Ÿæˆå¾ˆå¤šæ¡¶ã€‚ Elasticsearch æ˜¯å¦‚ä½•å†³å®šè¿™äº›æ¡¶å±•ç¤ºç»™ç”¨æˆ·çš„é¡ºåºå‘¢ï¼Ÿ</p>
<p>é»˜è®¤çš„ï¼Œæ¡¶ä¼šæ ¹æ® doc_count é™åºæ’åˆ—ã€‚è¿™æ˜¯ä¸€ä¸ªå¥½çš„é»˜è®¤è¡Œä¸ºï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬æƒ³è¦æ‰¾åˆ°æ–‡æ¡£ä¸­ä¸æŸ¥è¯¢æ¡ä»¶ç›¸å…³çš„æœ€å¤§å€¼ï¼šå”®ä»·ã€äººå£æ•°é‡ã€é¢‘ç‡ã€‚ä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›èƒ½ä¿®æ”¹è¿™ä¸ªé¡ºåºï¼Œä¸åŒçš„æ¡¶æœ‰ç€ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</p>
<h2 id="å†…ç½®æ’åº"><a href="#å†…ç½®æ’åº" class="headerlink" title="å†…ç½®æ’åº"></a>å†…ç½®æ’åº</h2><p>è¿™äº›æ’åºæ¨¡å¼æ˜¯æ¡¶ å›ºæœ‰çš„ èƒ½åŠ›ï¼šå®ƒä»¬æ“ä½œæ¡¶ç”Ÿæˆçš„æ•°æ® ï¼Œæ¯”å¦‚ doc_count ã€‚ å®ƒä»¬å…±äº«ç›¸åŒçš„è¯­æ³•ï¼Œä½†æ˜¯æ ¹æ®ä½¿ç”¨æ¡¶çš„ä¸åŒä¼šæœ‰äº›ç»†å¾®å·®åˆ«ã€‚</p>
<p>è®©æˆ‘ä»¬åšä¸€ä¸ª terms èšåˆä½†æ˜¯æŒ‰ doc_count å€¼çš„å‡åºæ’åºï¼š</p>
<p><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;order&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;_count&quot;</span> : <span class="string">&quot;asc&quot;</span> </span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br></pre></td></tr></table></figure>

<p>ç”¨å…³é”®å­— _count ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ doc_count å€¼çš„å‡åºæ’åºã€‚</p>
<p>æˆ‘ä»¬ä¸ºèšåˆå¼•å…¥äº†ä¸€ä¸ª order å¯¹è±¡ï¼Œ å®ƒå…è®¸æˆ‘ä»¬å¯ä»¥æ ¹æ®ä»¥ä¸‹å‡ ä¸ªå€¼ä¸­çš„ä¸€ä¸ªå€¼è¿›è¡Œæ’åºï¼š</p>
<ul>
<li>_count<br>æŒ‰æ–‡æ¡£æ•°æ’åºã€‚å¯¹ terms ã€ histogram ã€ date_histogram æœ‰æ•ˆã€‚</li>
<li>_term<br>æŒ‰è¯é¡¹çš„å­—ç¬¦ä¸²å€¼çš„å­—æ¯é¡ºåºæ’åºã€‚åªåœ¨ terms å†…ä½¿ç”¨ã€‚</li>
<li>_key<br>æŒ‰æ¯ä¸ªæ¡¶çš„é”®å€¼æ•°å€¼æ’åºï¼ˆç†è®ºä¸Šä¸ _term ç±»ä¼¼ï¼‰ã€‚ åªåœ¨ histogram å’Œ date_histogram å†…ä½¿ç”¨ã€‚</li>
</ul>
<h2 id="æŒ‰åº¦é‡æ’åº"><a href="#æŒ‰åº¦é‡æ’åº" class="headerlink" title="æŒ‰åº¦é‡æ’åº"></a>æŒ‰åº¦é‡æ’åº</h2><p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šæƒ³åŸºäºåº¦é‡è®¡ç®—çš„ç»“æœå€¼è¿›è¡Œæ’åºã€‚ åœ¨æˆ‘ä»¬çš„æ±½è½¦é”€å”®åˆ†æä»ªè¡¨ç›˜ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æŒ‰ç…§æ±½è½¦é¢œè‰²åˆ›å»ºä¸€ä¸ªé”€å”®æ¡çŠ¶å›¾è¡¨ï¼Œä½†æŒ‰ç…§æ±½è½¦å¹³å‡å”®ä»·çš„å‡åºè¿›è¡Œæ’åºã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªåº¦é‡ï¼Œå†æŒ‡å®š order å‚æ•°å¼•ç”¨è¿™ä¸ªåº¦é‡å³å¯ï¼š</p>
<p><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;order&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;avg_price&quot;</span> : <span class="string">&quot;asc&quot;</span> </span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;avg&quot;</span>: &#123;<span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>&#125; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>è®¡ç®—æ¯ä¸ªæ¡¶çš„å¹³å‡å”®ä»·ã€‚</p>
</li>
<li><p>æ¡¶æŒ‰ç…§è®¡ç®—å¹³å‡å€¼çš„å‡åºæ’åºã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ç”¨ä»»ä½•åº¦é‡æ’åºï¼Œåªéœ€ç®€å•çš„å¼•ç”¨åº¦é‡çš„åå­—ã€‚ä¸è¿‡æœ‰äº›åº¦é‡ä¼šè¾“å‡ºå¤šä¸ªå€¼ã€‚ extended_stats åº¦é‡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå®ƒè¾“å‡ºå¥½å‡ ä¸ªåº¦é‡å€¼ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å¤šå€¼åº¦é‡è¿›è¡Œæ’åºï¼Œ æˆ‘ä»¬åªéœ€ä»¥å…³å¿ƒçš„åº¦é‡ä¸ºå…³é”®è¯ä½¿ç”¨ç‚¹å¼è·¯å¾„ï¼š<br><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;order&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;stats.variance&quot;</span> : <span class="string">&quot;asc&quot;</span> </span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;stats&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;extended_stats&quot;</span>: &#123;<span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ . ç¬¦å·ï¼Œæ ¹æ®æ„Ÿå…´è¶£çš„åº¦é‡è¿›è¡Œæ’åºã€‚</li>
</ul>
<h2 id="æ·±åº¦åº¦é‡æ’åº"><a href="#æ·±åº¦åº¦é‡æ’åº" class="headerlink" title="æ·±åº¦åº¦é‡æ’åº"></a>æ·±åº¦åº¦é‡æ’åº</h2><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œåº¦é‡æ˜¯æ¡¶çš„ç›´æ¥å­èŠ‚ç‚¹ã€‚å¹³å‡å”®ä»·æ˜¯æ ¹æ®æ¯ä¸ª term æ¥è®¡ç®—çš„ã€‚ åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰å¯èƒ½å¯¹ æ›´æ·± çš„åº¦é‡è¿›è¡Œæ’åºï¼Œæ¯”å¦‚å­™å­æ¡¶æˆ–ä»å­™æ¡¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›´æ·±çš„è·¯å¾„ï¼Œå°†åº¦é‡ç”¨å°–æ‹¬å·ï¼ˆ &gt; ï¼‰åµŒå¥—èµ·æ¥ï¼Œåƒè¿™æ ·ï¼š my_bucket&gt;another_bucket&gt;metric ã€‚</p>
<p>éœ€è¦æé†’çš„æ˜¯åµŒå¥—è·¯å¾„ä¸Šçš„æ¯ä¸ªæ¡¶éƒ½å¿…é¡»æ˜¯ å•å€¼ çš„ã€‚ filter æ¡¶ç”Ÿæˆ ä¸€ä¸ªå•å€¼æ¡¶ï¼šæ‰€æœ‰ä¸è¿‡æ»¤æ¡ä»¶åŒ¹é…çš„æ–‡æ¡£éƒ½åœ¨æ¡¶ä¸­ã€‚ å¤šå€¼æ¡¶ï¼ˆå¦‚ï¼šterms ï¼‰åŠ¨æ€ç”Ÿæˆè®¸å¤šæ¡¶ï¼Œæ— æ³•é€šè¿‡æŒ‡å®šä¸€ä¸ªç¡®å®šè·¯å¾„æ¥è¯†åˆ«ã€‚</p>
<p>ç›®å‰ï¼Œåªæœ‰ä¸‰ä¸ªå•å€¼æ¡¶ï¼š filter ã€ global å’Œ reverse_nested ã€‚è®©æˆ‘ä»¬å¿«é€Ÿç”¨ç¤ºä¾‹è¯´æ˜ï¼Œåˆ›å»ºä¸€ä¸ªæ±½è½¦å”®ä»·çš„ç›´æ–¹å›¾ï¼Œä½†æ˜¯æŒ‰ç…§çº¢è‰²å’Œç»¿è‰²ï¼ˆä¸åŒ…æ‹¬è“è‰²ï¼‰è½¦å„è‡ªçš„æ–¹å·®æ¥æ’åºï¼š</p>
<p><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;histogram&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;interval&quot;</span>: <span class="number">20000</span>,</span><br><span class="line">              <span class="attr">&quot;order&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;red_green_cars&gt;tats.variance&quot;</span> : <span class="string">&quot;asc&quot;</span> </span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;red_green_cars&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;filter&quot;</span>: &#123; <span class="attr">&quot;terms&quot;</span>: &#123;<span class="attr">&quot;color&quot;</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>]&#125;&#125;, </span><br><span class="line">                    <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;stats&quot;</span>: &#123;<span class="attr">&quot;extended_stats&quot;</span>: &#123;<span class="attr">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span>&#125;&#125; </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>æŒ‰ç…§åµŒå¥—åº¦é‡çš„æ–¹å·®å¯¹æ¡¶çš„ç›´æ–¹å›¾è¿›è¡Œæ’åºã€‚</p>
</li>
<li><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨å•å€¼è¿‡æ»¤å™¨ filter ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå¥—æ’åºã€‚</p>
</li>
<li><p>æŒ‰ç…§ç”Ÿæˆçš„åº¦é‡å¯¹ç»Ÿè®¡ç»“æœè¿›è¡Œæ’åºã€‚</p>
</li>
</ul>
<p>æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¦‚ä½•è®¿é—®ä¸€ä¸ªåµŒå¥—çš„åº¦é‡ã€‚ stats åº¦é‡æ˜¯ red_green_cars èšåˆçš„å­èŠ‚ç‚¹ï¼Œè€Œ red_green_cars åˆæ˜¯ colors èšåˆçš„å­èŠ‚ç‚¹ã€‚ ä¸ºäº†æ ¹æ®è¿™ä¸ªåº¦é‡æ’åºï¼Œæˆ‘ä»¬å®šä¹‰äº†è·¯å¾„ red_green_cars&gt;tats.variance ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œå› ä¸º filter æ¡¶æ˜¯ä¸ªå•å€¼æ¡¶ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤šç´¢å¼•å¤šç±»å‹æœç´¢</title>
    <url>/wiki/%E5%A4%9A%E7%B4%A2%E5%BC%95%E5%A4%9A%E7%B1%BB%E5%9E%8B%E6%90%9C%E7%B4%A2/</url>
    <content><![CDATA[<p>å¦‚æœä¸å¯¹æŸä¸€ç‰¹æ®Šçš„ç´¢å¼•æˆ–è€…ç±»å‹åšé™åˆ¶ï¼Œå°±ä¼šæœç´¢é›†ç¾¤ä¸­çš„æ‰€æœ‰æ–‡æ¡£ã€‚Elasticsearch è½¬å‘æœç´¢è¯·æ±‚åˆ°æ¯ä¸€ä¸ªä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼Œæ±‡é›†æŸ¥è¯¢å‡ºçš„å‰10ä¸ªç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™æˆ‘ä»¬ã€‚</p>
<p>ç„¶è€Œï¼Œç»å¸¸çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æ®Šçš„ç´¢å¼•å¹¶ä¸”åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰¹æ®Šçš„ç±»å‹ä¸­è¿›è¡Œæœç´¢ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨URLä¸­æŒ‡å®šç‰¹æ®Šçš„ç´¢å¼•å’Œç±»å‹è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><code>/_search</code><br>åœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹<br><code>/gb/_search</code><br>åœ¨ gb ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹<br><code>/gb,us/_search</code><br>åœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„æ–‡æ¡£<br><code>/g*,u*/_search</code><br>åœ¨ä»»ä½•ä»¥ g æˆ–è€… u å¼€å¤´çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹<br><code>/gb/user/_search</code><br>åœ¨ gb ç´¢å¼•ä¸­æœç´¢ user ç±»å‹<br><code>/gb,us/user,tweet/_search</code><br>åœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹<br><code>/_all/user,tweet/_search</code><br>åœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹<br>å½“åœ¨å•ä¸€çš„ç´¢å¼•ä¸‹è¿›è¡Œæœç´¢çš„æ—¶å€™ï¼ŒElasticsearch è½¬å‘è¯·æ±‚åˆ°ç´¢å¼•çš„æ¯ä¸ªåˆ†ç‰‡ä¸­ï¼Œå¯ä»¥æ˜¯ä¸»åˆ†ç‰‡ä¹Ÿå¯ä»¥æ˜¯å‰¯æœ¬åˆ†ç‰‡ï¼Œç„¶åä»æ¯ä¸ªåˆ†ç‰‡ä¸­æ”¶é›†ç»“æœã€‚å¤šç´¢å¼•æœç´¢æ°å¥½ä¹Ÿæ˜¯ç”¨ç›¸åŒçš„æ–¹å¼å·¥ä½œçš„â€”â€‹åªæ˜¯ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„åˆ†ç‰‡ã€‚  </p>
<p>æ³¨æ„ âš ï¸<br>æœç´¢ä¸€ä¸ªç´¢å¼•æœ‰äº”ä¸ªä¸»åˆ†ç‰‡å’Œæœç´¢äº”ä¸ªç´¢å¼•å„æœ‰ä¸€ä¸ªåˆ†ç‰‡å‡†ç¡®æ¥æ‰€è¯´æ˜¯ç­‰ä»·çš„ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>å­—ç¬¦ä¸²æ’åºä¸å¤šå­—æ®µ</title>
    <url>/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8E%92%E5%BA%8F%E4%B8%8E%E5%A4%9A%E5%AD%97%E6%AE%B5/</url>
    <content><![CDATA[<p>è¢«è§£æçš„å­—ç¬¦ä¸²å­—æ®µä¹Ÿæ˜¯å¤šå€¼å­—æ®µï¼Œ ä½†æ˜¯å¾ˆå°‘ä¼šæŒ‰ç…§ä½ æƒ³è¦çš„æ–¹å¼è¿›è¡Œæ’åºã€‚å¦‚æœä½ æƒ³åˆ†æä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ fine old art ï¼Œ è¿™åŒ…å« 3 é¡¹ã€‚æˆ‘ä»¬å¾ˆå¯èƒ½æƒ³è¦æŒ‰ç¬¬ä¸€é¡¹çš„å­—æ¯æ’åºï¼Œç„¶åæŒ‰ç¬¬äºŒé¡¹çš„å­—æ¯æ’åºï¼Œè¯¸å¦‚æ­¤ç±»ï¼Œä½†æ˜¯ Elasticsearch åœ¨æ’åºè¿‡ç¨‹ä¸­æ²¡æœ‰è¿™æ ·çš„ä¿¡æ¯ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ min å’Œ max æ’åºæ¨¡å¼ï¼ˆé»˜è®¤æ˜¯ min ï¼‰ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´æ’åºä»¥ art æˆ–æ˜¯ old ï¼Œä»»ä½•ä¸€ä¸ªéƒ½ä¸æ˜¯æ‰€å¸Œæœ›çš„ã€‚</p>
<p>ä¸ºäº†ä»¥å­—ç¬¦ä¸²å­—æ®µè¿›è¡Œæ’åºï¼Œè¿™ä¸ªå­—æ®µåº”ä»…åŒ…å«ä¸€é¡¹ï¼š æ•´ä¸ª not_analyzed å­—ç¬¦ä¸²ã€‚ ä½†æ˜¯æˆ‘ä»¬ä»éœ€è¦ analyzed å­—æ®µï¼Œè¿™æ ·æ‰èƒ½ä»¥å…¨æ–‡è¿›è¡ŒæŸ¥è¯¢</p>
<p>ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç”¨ä¸¤ç§æ–¹å¼å¯¹åŒä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œç´¢å¼•ï¼Œè¿™å°†åœ¨æ–‡æ¡£ä¸­åŒ…æ‹¬ä¸¤ä¸ªå­—æ®µï¼š analyzed ç”¨äºæœç´¢ï¼Œ not_analyzed ç”¨äºæ’åº</p>
<p>ä½†æ˜¯ä¿å­˜ç›¸åŒçš„å­—ç¬¦ä¸²ä¸¤æ¬¡åœ¨ _source å­—æ®µæ˜¯æµªè´¹ç©ºé—´çš„ã€‚ æˆ‘ä»¬çœŸæ­£æƒ³è¦åšçš„æ˜¯ä¼ é€’ä¸€ä¸ª å•å­—æ®µ ä½†æ˜¯å´ç”¨ä¸¤ç§æ–¹å¼ç´¢å¼•å®ƒã€‚æ‰€æœ‰çš„ _core_field ç±»å‹ (strings, numbers, Booleans, dates) æ¥æ”¶ä¸€ä¸ª fields å‚æ•°</p>
<p>è¯¥å‚æ•°å…è®¸ä½ è½¬åŒ–ä¸€ä¸ªç®€å•çš„æ˜ å°„å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;tweet&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;string&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºä¸€ä¸ªå¤šå­—æ®µæ˜ å°„å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;tweet&quot;</span>: &#123; </span><br><span class="line">    <span class="attr">&quot;type&quot;</span>:     <span class="string">&quot;string&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;raw&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;type&quot;</span>:  <span class="string">&quot;string&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;not_analyzed&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>tweet ä¸»å­—æ®µä¸ä¹‹å‰çš„ä¸€æ ·: æ˜¯ä¸€ä¸ª analyzed å…¨æ–‡å­—æ®µã€‚</p>
</li>
<li><p>æ–°çš„ tweet.raw å­å­—æ®µæ˜¯ not_analyzed.</p>
</li>
</ul>
<p>ç°åœ¨ï¼Œè‡³å°‘åªè¦æˆ‘ä»¬é‡æ–°ç´¢å¼•äº†æˆ‘ä»¬çš„æ•°æ®ï¼Œä½¿ç”¨ tweet å­—æ®µç”¨äºæœç´¢ï¼Œ<code>tweet.raw</code> å­—æ®µç”¨äºæ’åºï¼š<br><code>curl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;tweet&quot;</span>: <span class="string">&quot;elasticsearch&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;sort&quot;</span>: <span class="string">&quot;tweet.raw&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>åµŒå¥—æ¡¶</title>
    <url>/wiki/%E5%B5%8C%E5%A5%97%E6%A1%B6/</url>
    <content><![CDATA[<h2 id="ä¸¤å±‚åµŒå¥—"><a href="#ä¸¤å±‚åµŒå¥—" class="headerlink" title="ä¸¤å±‚åµŒå¥—"></a>ä¸¤å±‚åµŒå¥—</h2><p>åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„åµŒå¥—æ–¹æ¡ˆæ—¶ï¼Œèšåˆçš„åŠ›é‡æ‰èƒ½çœŸæ­£å¾—ä»¥æ˜¾ç°ã€‚ åœ¨å‰ä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•å°†ä¸€ä¸ªåº¦é‡åµŒå…¥æ¡¶ä¸­ï¼Œå®ƒçš„åŠŸèƒ½å·²ç»ååˆ†å¼ºå¤§äº†ã€‚</p>
<p>ä½†çœŸæ­£ä»¤äººæ¿€åŠ¨çš„åˆ†ææ¥è‡ªäºå°†æ¡¶åµŒå¥—è¿› å¦å¤–ä¸€ä¸ªæ¡¶ æ‰€èƒ½å¾—åˆ°çš„ç»“æœã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªé¢œè‰²çš„æ±½è½¦åˆ¶é€ å•†çš„åˆ†å¸ƒï¼š</p>
<p><code>GET /cars/transactions/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">   <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;colors&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;color&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;avg_price&quot;</span>: &#123; </span><br><span class="line">               <span class="attr">&quot;avg&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;make&quot;</span>: &#123; </span><br><span class="line">                <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;make&quot;</span> </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ³¨æ„å‰ä¾‹ä¸­çš„ avg_price åº¦é‡ä»ç„¶ä¿æŒåŸä½ã€‚</p>
</li>
<li><p>å¦ä¸€ä¸ªèšåˆ make è¢«åŠ å…¥åˆ°äº† color é¢œè‰²æ¡¶ä¸­ã€‚</p>
</li>
<li><p>è¿™ä¸ªèšåˆæ˜¯ terms æ¡¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªæ±½è½¦åˆ¶é€ å•†ç”Ÿæˆå”¯ä¸€çš„æ¡¶ã€‚</p>
</li>
</ul>
<p>è¿™é‡Œå‘ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„äº‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè§‚å¯Ÿåˆ°ä¹‹å‰ä¾‹å­ä¸­çš„ <code>avg_price</code> åº¦é‡å®Œå…¨æ²¡æœ‰å˜åŒ–ï¼Œè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ ä¸€ä¸ªèšåˆçš„æ¯ä¸ª å±‚çº§ éƒ½å¯ä»¥æœ‰å¤šä¸ªåº¦é‡æˆ–æ¡¶ï¼Œ <code>avg_price</code> åº¦é‡å‘Šè¯‰æˆ‘ä»¬æ¯ç§é¢œè‰²æ±½è½¦çš„å¹³å‡ä»·æ ¼ã€‚å®ƒä¸å…¶ä»–çš„æ¡¶å’Œåº¦é‡ç›¸äº’ç‹¬ç«‹ã€‚</p>
<p>è¿™å¯¹æˆ‘ä»¬çš„åº”ç”¨éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™é‡Œé¢æœ‰å¾ˆå¤šç›¸äº’å…³è”ï¼Œä½†åˆå®Œå…¨ä¸åŒçš„åº¦é‡éœ€è¦æ”¶é›†ã€‚èšåˆä½¿æˆ‘ä»¬èƒ½å¤Ÿç”¨ä¸€æ¬¡æ•°æ®è¯·æ±‚è·å¾—æ‰€æœ‰çš„è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å¦å¤–ä¸€ä»¶å€¼å¾—æ³¨æ„çš„é‡è¦äº‹æƒ…æ˜¯æˆ‘ä»¬æ–°å¢çš„è¿™ä¸ª make èšåˆï¼Œå®ƒæ˜¯ä¸€ä¸ª <code>terms</code> æ¡¶ï¼ˆåµŒå¥—åœ¨ colors ã€ terms æ¡¶å†…ï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä¼šä¸ºæ•°æ®é›†ä¸­çš„æ¯ä¸ªå”¯ä¸€ç»„åˆç”Ÿæˆï¼ˆ color ã€ make ï¼‰å…ƒç»„ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹è¿”å›çš„å“åº”ï¼ˆä¸ºäº†ç®€å•æˆ‘ä»¬åªæ˜¾ç¤ºéƒ¨åˆ†ç»“æœï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;colors&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;buckets&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;doc_count&quot;</span>: <span class="number">4</span>,</span><br><span class="line">               <span class="attr">&quot;make&quot;</span>: &#123; </span><br><span class="line">                  <span class="attr">&quot;buckets&quot;</span>: [</span><br><span class="line">                     &#123;</span><br><span class="line">                        <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;honda&quot;</span>, </span><br><span class="line">                        <span class="attr">&quot;doc_count&quot;</span>: <span class="number">3</span></span><br><span class="line">                     &#125;,</span><br><span class="line">                     &#123;</span><br><span class="line">                        <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;bmw&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;doc_count&quot;</span>: <span class="number">1</span></span><br><span class="line">                     &#125;</span><br><span class="line">                  ]</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;value&quot;</span>: <span class="number">32500</span> </span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ­£å¦‚æœŸæœ›çš„é‚£æ ·ï¼Œæ–°çš„èšåˆåµŒå…¥åœ¨æ¯ä¸ªé¢œè‰²æ¡¶ä¸­ã€‚</p>
</li>
<li><p>ç°åœ¨æˆ‘ä»¬çœ‹è§æŒ‰ä¸åŒåˆ¶é€ å•†åˆ†è§£çš„æ¯ç§é¢œè‰²ä¸‹è½¦è¾†ä¿¡æ¯ã€‚</p>
</li>
<li><p>æœ€ç»ˆï¼Œæˆ‘ä»¬çœ‹åˆ°å‰ä¾‹ä¸­çš„ avg_price åº¦é‡ä»ç„¶ç»´æŒä¸å˜ã€‚</p>
</li>
</ul>
<h2 id="ä¸‰å±‚åµŒå¥—"><a href="#ä¸‰å±‚åµŒå¥—" class="headerlink" title="ä¸‰å±‚åµŒå¥—"></a>ä¸‰å±‚åµŒå¥—</h2><p>è®©æˆ‘ä»¬å›åˆ°è¯é¢˜çš„åŸç‚¹ï¼Œåœ¨è¿›å…¥æ–°è¯é¢˜ä¹‹å‰ï¼Œå¯¹æˆ‘ä»¬çš„ç¤ºä¾‹åšæœ€åä¸€ä¸ªä¿®æ”¹ï¼Œ ä¸ºæ¯ä¸ªæ±½è½¦ç”Ÿæˆå•†è®¡ç®—æœ€ä½å’Œæœ€é«˜çš„ä»·æ ¼ï¼š<br><code>GET /cars/transactions/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">   <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;colors&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;color&quot;</span></span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;avg_price&quot;</span>: &#123; <span class="attr">&quot;avg&quot;</span>: &#123; <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;make&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;terms&quot;</span> : &#123;</span><br><span class="line">                    <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;make&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">&quot;aggs&quot;</span> : &#123; </span><br><span class="line">                    <span class="attr">&quot;min_price&quot;</span> : &#123; <span class="attr">&quot;min&quot;</span>: &#123; <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>&#125; &#125;, </span><br><span class="line">                    <span class="attr">&quot;max_price&quot;</span> : &#123; <span class="attr">&quot;max&quot;</span>: &#123; <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span>&#125; &#125; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æˆ‘ä»¬éœ€è¦å¢åŠ å¦å¤–ä¸€ä¸ªåµŒå¥—çš„ aggs å±‚çº§ã€‚</p>
</li>
<li><p>ç„¶ååŒ…æ‹¬ min æœ€å°åº¦é‡ã€‚</p>
</li>
<li><p>ä»¥åŠ max æœ€å¤§åº¦é‡ã€‚</p>
</li>
</ul>
<p>å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼ˆåªæ˜¾ç¤ºéƒ¨åˆ†ç»“æœï¼‰ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">...</span><br><span class="line">   <span class="attr">&quot;aggregations&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;colors&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;buckets&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">               <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">               <span class="attr">&quot;doc_count&quot;</span>: <span class="number">4</span>,</span><br><span class="line">               <span class="attr">&quot;make&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;buckets&quot;</span>: [</span><br><span class="line">                     &#123;</span><br><span class="line">                        <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;honda&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;doc_count&quot;</span>: <span class="number">3</span>,</span><br><span class="line">                        <span class="attr">&quot;min_price&quot;</span>: &#123;</span><br><span class="line">                           <span class="attr">&quot;value&quot;</span>: <span class="number">10000</span> </span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">&quot;max_price&quot;</span>: &#123;</span><br><span class="line">                           <span class="attr">&quot;value&quot;</span>: <span class="number">20000</span> </span><br><span class="line">                        &#125;</span><br><span class="line">                     &#125;,</span><br><span class="line">                     &#123;</span><br><span class="line">                        <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;bmw&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;doc_count&quot;</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="attr">&quot;min_price&quot;</span>: &#123;</span><br><span class="line">                           <span class="attr">&quot;value&quot;</span>: <span class="number">80000</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">&quot;max_price&quot;</span>: &#123;</span><br><span class="line">                           <span class="attr">&quot;value&quot;</span>: <span class="number">80000</span></span><br><span class="line">                        &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                  ]</span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="attr">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;value&quot;</span>: <span class="number">32500</span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†è¿™ä¸¤ä¸ªæ¡¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æŸ¥è¯¢çš„ç»“æœè¿›è¡Œæ‰©å±•å¹¶å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š  </p>
<p>æœ‰å››è¾†çº¢è‰²è½¦ã€‚<br>çº¢è‰²è½¦çš„å¹³å‡å”®ä»·æ˜¯ $32ï¼Œ500 ç¾å…ƒã€‚<br>å…¶ä¸­ä¸‰è¾†çº¢è‰²è½¦æ˜¯ Honda æœ¬ç”°åˆ¶é€ ï¼Œä¸€è¾†æ˜¯ BMW å®é©¬åˆ¶é€ ã€‚<br>æœ€ä¾¿å®œçš„çº¢è‰²æœ¬ç”°å”®ä»·ä¸º $10ï¼Œ000 ç¾å…ƒã€‚<br>æœ€è´µçš„çº¢è‰²æœ¬ç”°å”®ä»·ä¸º $20ï¼Œ000 ç¾å…ƒã€‚  </p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‹¥å¡é¿å…</title>
    <url>/wiki/%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D/</url>
    <content><![CDATA[<h1 id="æ‹¥å¡é¿å…"><a href="#æ‹¥å¡é¿å…" class="headerlink" title="æ‹¥å¡é¿å…"></a>æ‹¥å¡é¿å…</h1><p>æ‹¥å¡æ§åˆ¶çš„æ…¢å¯åŠ¨æ˜¯ä»¥æŒ‡æ•°æ–¹å¼å¿«é€Ÿçš„é€šè¿‡è¯•æ¢æ¥æ‰©å¤§æ‹¥å¡çª—å£çš„ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿç½‘ç»œä¸¢åŒ…ï¼Œåˆ™è‚¯å®šæ˜¯å¾ˆå¤šæŠ¥æ–‡æ®µéƒ½ä¼šéƒ½æ˜¯ï¼Œå› ä¸ºçª—å£æ—¶ç§°è¢«å¢é•¿çš„ï¼›ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œéœ€è¦å¼•å…¥â€“ æ‹¥å¡é¿å…</p>
<h2 id="ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…"><a href="#ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…" class="headerlink" title="ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…"></a>ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…</h2><p>æ‹¥å¡é¿å…ä¸ºäº†è§£å†³æ…¢å¯åŠ¨ä¸‹ï¼Œå½“æ‹¥å¡çª—å£è¶…å‡ºç½‘ç»œå¸¦å®½æ—¶å‘ç”Ÿçš„å¤§é‡ä¸¢åŒ…é—®é¢˜ï¼Œå®ƒæå‡ºä¸€ä¸ªã€Œæ…¢å¯åŠ¨é˜ˆå€¼ã€çš„æ¦‚å¿µï¼Œå½“æ‹¥å¡çª—å£åˆ°è¾¾è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œä¸åœ¨ä»¥æŒ‡æ•°æ–¹å¼å¢é•¿ï¼Œè€Œé€‰æ‹©æ¶¨å¹…æ¯”è¾ƒç¼“æ…¢çš„ã€Œçº¿æ€§å¢é•¿ã€ï¼Œè®¡ç®—æ–¹å¼ï¼š</p>
<blockquote>
<p>cwnd += SMSS*SMSS/cwnd</p>
</blockquote>
<img src="https://oscimg.oschina.net/oscnet/up-e56d8072b2a74fa9b18ff6ca2d605405d2f.png" width=760 height=360>

<p>å½“æ‹¥å¡çª—å£åœ¨çº¿æ€§å¢é•¿æ—¶å‘ç”Ÿä¸¢åŒ…ï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®ä¸ºå½“å‰çª—å£çš„ä¸€åŠï¼Œæ…¢å¯åŠ¨çª—å£æ¢å¤åˆå§‹çª—å£ï¼ˆinit wndï¼‰ï¼›</p>
<blockquote>
<p>æ‹¥å¡é¿å…å’Œæ…¢å¯åŠ¨æ˜¯ç»“åˆä½¿ç”¨çš„ï¼Œå½“å‘ç”Ÿç½‘ç»œä¸¢åŒ…æ˜¯ï¼Œæ‹¥å¡æ§åˆ¶é‡‡ç”¨å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿå¯åŠ¨æ¥è§£å†³ä¸¢åŒ…é—®é¢˜ï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>å¿«é€Ÿé‡ä¼ /å¿«é€Ÿæ¢å¤</title>
    <url>/wiki/%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0-%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D/</url>
    <content><![CDATA[<h1 id="å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤"><a href="#å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤" class="headerlink" title="å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤"></a>å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤</h1><h2 id="å¿«é€Ÿé‡ä¼ "><a href="#å¿«é€Ÿé‡ä¼ " class="headerlink" title="å¿«é€Ÿé‡ä¼ "></a>å¿«é€Ÿé‡ä¼ </h2><blockquote>
<p>d ä¸ºä½•ä¼šæ¥æ”¶åˆ°ä»¥ä¸ªå¤±åºæ•°æ®æ®µï¼Ÿ </p>
</blockquote>
<ul>
<li>è‹¥æŠ¥æ–‡ä¸¢å¤±ï¼Œå°†ä¼šäº§ç”Ÿè¿ç»­çš„å¤±åºACKæ®µ </li>
<li>è‹¥ç½‘ç»œè·¯å¾„ä¸è®¾å¤‡å¯¼è‡´æ•°æ®æ®µå¤±åºï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ</li>
<li>è‹¥æŠ¥æ–‡é‡å¤ï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ</li>
</ul>
<img src="https://oscimg.oschina.net/oscnet/up-eaadaebd682089bdd3919de4f0d232749dc.png" width=450 height= 520>

<ul>
<li>å½“å‘é€ç«¯å‘é€pkt0æ˜¯æ­£å¸¸çš„ï¼Œç”±äºæ»‘åŠ¨çª—å£ä¸ºæ»¡ï¼Œå‘é€æ–¹å¯ä»¥ç»§ç»­å‘é€pkt1ï¼Œpkt2ï¼›</li>
<li>åŠ å…¥pkt1å‘ç”Ÿäº†ä¸¢åŒ…ï¼Œè™½ç„¶pkt2æ¥æ”¶ç«¯æ¥æ”¶æˆåŠŸäº†ï¼Œä½†æ˜¯æ²¡æœ‰pkt1çš„æ•°æ®æ®µï¼Œæ¥æ”¶ç«¯è¿˜æ˜¯å‘é€ACK1çš„ç¡®è®¤æŠ¥æ–‡ï¼›</li>
<li>åœ¨æ²¡æœ‰ã€Œå¿«é€Ÿé‡ä¼ ã€çš„æƒ…å†µä¸‹ï¼Œå‘é€ç«¯éœ€è¦ç­‰åˆ°RTOä¹‹åï¼Œæ‰å¯ä»¥é‡æ–°å‘é€pkt1</li>
<li>é‡ä¼ æˆåŠŸä¹‹åï¼Œæ¥æ”¶ç«¯å…¶å®æ”¶åˆ°äº†pkt2ä¹‹å‰çš„æ‰€æœ‰æ•°æ®æ®µï¼Œæ‰€ä»¥å‘é€ACK3çš„ç¡®è®¤æŠ¥æ–‡<blockquote>
<p>è¿™ç§éœ€è¦ç­‰å¾…RTOæ‰å¯ä»¥é‡ä¼ çš„æ–¹å¼æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œå› æ­¤éœ€è¦å¿«é€Ÿé‡ä¼ æ¥è¿›è¡Œä¼˜åŒ–ï¼›</p>
</blockquote>
</li>
</ul>
<h2 id="å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤"><a href="#å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤" class="headerlink" title="å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤"></a>å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤</h2><img src="https://oscimg.oschina.net/oscnet/up-9da669c35316aafb318674d3364ea07d72d.png" width=450 height=520>

<p>å½“å‘é€æ–¹è¿ç»­å‘é€pkt3ï¼Œpkt4ï¼Œpkt5ï¼Œpkt6å››ä¸ªæ•°æ®ç«¯ï¼Œä½†æ˜¯pkt5åœ¨ç½‘ç»œä¸­ä¸¢åŒ…äº†ï¼Œé‚£åé¢å‘é€çš„pkt6ï¼Œpkt7ï¼Œpkt8çš„ç¡®è®¤æŠ¥æ–‡éƒ½è¿”å›ACK5ï¼Œå¸Œæœ›å‘é€æ–¹åƒæ˜‚ä¼ pkt5çš„æ•°æ®æ®µï¼›è¿™ä¸ªæ—¶å€™ï¼Œå‘é€æ–¹æ”¶åˆ°è¿ç»­3ä¸ªç›¸åŒçš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¾¿ç«‹å³é‡æ–°å‘é€pkt5çš„æ•°æ®æ®µï¼›</p>
<blockquote>
<p>æ¥æ”¶æ–¹:</p>
</blockquote>
<ul>
<li>å½“æ¥æ”¶åˆ°ä¸€ä¸ªå¤±åºæ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘é€å®ƒæ‰€æœŸå¾…çš„ç¼ºå£ ACK åºåˆ—å·</li>
<li>å½“æ¥æ”¶åˆ°å¡«å……å¤±åºç¼ºå£çš„æ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘ é€å®ƒæ‰€æœŸå¾…çš„ä¸‹ä¸€ä¸ª ACK åºåˆ—å·</li>
</ul>
<blockquote>
<p>å‘é€æ–¹</p>
</blockquote>
<ul>
<li>å½“æ¥æ”¶åˆ°3ä¸ªé‡å¤çš„å¤±åº ACK æ®µ(4ä¸ªç›¸åŒçš„å¤±åºACKæ®µ)æ—¶ï¼Œä¸å†ç­‰å¾…é‡ä¼ å®šæ—¶å™¨çš„è§¦å‘ï¼Œç«‹åˆ»åŸºäºå¿«é€Ÿé‡ä¼ æœºåˆ¶é‡å‘æŠ¥æ–‡æ®µ</li>
</ul>
<p>å½“pkt5é‡æ–°å‘é€å¹¶è¢«æ¥æ”¶ç«¯æ¥æ”¶ä¹‹åï¼Œæ¥æ”¶ç«¯å‘é€ACK9çš„ç¡®è®¤æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯å†åˆ†åˆ«å‘é€ACK6ï¼ŒACK7ï¼ŒACK8ï¼Œè¿™ä¸ªç§°è°“ã€Œ <strong><font color=red>ç´¯è®¡ç¡®è®¤</font></strong> ã€ã€‚</p>
<h2 id="å¿«é€Ÿæ¢å¤"><a href="#å¿«é€Ÿæ¢å¤" class="headerlink" title="å¿«é€Ÿæ¢å¤"></a>å¿«é€Ÿæ¢å¤</h2><blockquote>
<p>å¿«é€Ÿé‡ä¼ ä¸‹ä¸€å®šè¦è¿›å…¥æ…¢å¯åŠ¨å—?</p>
</blockquote>
<p>æ¥å—ç«¯æ”¶åˆ°é‡å¤ACKï¼Œæ„å‘³ç€ç½‘ç»œä»åœ¨æµåŠ¨ï¼Œè€Œå¦‚æœè¦é‡æ–°è¿›å…¥æ…¢å¯åŠ¨ï¼Œä¼šå¯¼è‡´ç½‘ç»œçªç„¶å‡å°‘æ•°æ®æµï¼Œæ‹¥å¡çª—å£æ¢å¤åˆå§‹çª—å£ï¼Œæ‰€ä»¥ï¼Œã€Œ<strong>åœ¨å¿«é€Ÿæ¢å¤ä¸‹å‘ç”Ÿä¸¢åŒ…çš„åœºæ™¯ä¸‹</strong>ã€ï¼Œåº”è¯¥ä½¿ç”¨å¿«é€Ÿæ¢å¤ï¼Œç®€å•çš„è®²ï¼Œå°±æ˜¯å°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®æˆå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠï¼Œè€Œæ‹¥å¡çª—å£ä¹Ÿé€‚å½“æ”¾ä½ï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­—æ¢å¤åˆ°åˆå§‹çª—å£å¤§å°ï¼›</p>
<img src="https://oscimg.oschina.net/oscnet/up-4a7f76cb315a13d1d905f2bfb3a376db087.png" >

<p>å¿«é€Ÿæ¢å¤çš„æµç¨‹å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼</p>
<blockquote>
<p>å¿«é€Ÿæ¢å¤çš„å…·ä½“æ“ä½œï¼š</p>
</blockquote>
<ul>
<li>å°† ssthresh è®¾ç½®ä¸ºå½“å‰æ‹¥å¡çª—å£ cwnd çš„ä¸€åŠï¼Œè®¾å½“å‰ cwnd ä¸º ssthresh åŠ ä¸Š 3*MSS</li>
<li>æ¯æ”¶åˆ°ä¸€ä¸ªé‡å¤ ACKï¼Œcwnd å¢åŠ  1 ä¸ª MSS</li>
<li>å½“æ–°æ•°æ® ACK åˆ°è¾¾åï¼Œè®¾ç½® cwnd ä¸º ssthresh</li>
</ul>
]]></content>
      <categories>
        <category>Computer Network</category>
        <category>TCP</category>
      </categories>
      <tags>
        <tag>TCP</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿ-æ­»é”</title>
    <url>/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E6%AD%BB%E9%94%81/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/44125bb12ebf">æ­»é”æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…æ­»é”ï¼Ÿ</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98">å“²å­¦å®¶å°±é¤é—®é¢˜</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Linux System</category>
        <category>Process</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­–ç•¥</title>
    <url>/wiki/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://blog.csdn.net/qq_35642036/article/details/82809812">æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªå‡ ç§</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%93%B2%E5%AD%A6%E5%AE%B6%E5%B0%B1%E9%A4%90%E9%97%AE%E9%A2%98"></a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Linux System</category>
        <category>Process</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨èç³»ç»Ÿ-Overview</title>
    <url>/wiki/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F-Overview/</url>
    <content><![CDATA[<h2 id="åšå®¢èµ„æ–™"><a href="#åšå®¢èµ„æ–™" class="headerlink" title="åšå®¢èµ„æ–™"></a>åšå®¢èµ„æ–™</h2><ul>
<li><a href="https://blog.csdn.net/qq_40027052/article/details/78733365">æ·±åº¦è§£æäº¬ä¸œä¸ªæ€§åŒ–æ¨èç³»ç»Ÿæ¼”è¿›å²</a>  </li>
<li><a href="https://www.cnblogs.com/liuning8023/p/5522619.html">ç”¨ Mahout å’Œ Elasticsearch å®ç°æ¨èç³»ç»Ÿ</a></li>
<li><a href="https://tech.meituan.com/2015/01/22/mt-recommend-practice.html">ç¾å›¢æ¨èç®—æ³•å®è·µ</a></li>
<li><a href="https://blog.csdn.net/love284969214/article/details/82932064">58åŒåŸæ¨èç³»ç»Ÿè®¾è®¡ä¸å®ç°</a></li>
<li><a href="http://www.360doc.com/content/16/0307/22/31263000_540328712.shtml">å¾®åšæ¨èç³»ç»Ÿçš„æ¶æ„æ¼”è¿›ä¹‹è·¯</a></li>
<li><a href="https://blog.csdn.net/tzs_1041218129/article/details/103331908">Flink åœ¨å°çº¢ä¹¦æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨</a></li>
<li><a href="https://www.slidestalk.com/YunQi/XiaoHongShu_BigData_Platform_Evolution">å°çº¢ä¹¦å¤§æ•°æ®åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨</a></li>
<li><a href="https://www.slidestalk.com/u223/rs_in_kuaikan">å¿«çœ‹æ¼«ç”»ä¸ªæ€§åŒ–æ¨èæ¢ç´¢ä¸å®è·µ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/45123018">æ•°æ®ä»“åº“ç³»åˆ—ç¯‡â€”â€”å”¯å“ä¼šå¤§æ•°æ®æ¶æ„</a></li>
<li><a href="https://developer.aliyun.com/article/763941">æ¨èç³»ç»ŸåŸºæœ¬æ¦‚å¿µå’Œæ¶æ„</a></li>
<li><a href="https://bp.aliyun.com/detail/140">PAIå¹³å°æ­å»ºä¼ä¸šçº§ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ - Aliyun</a></li>
<li><a href="https://www.aliyun.com/product/bigdata/product/learn"></a></li>
<li><a href="https://toutiao.io/posts/35tpcy/preview">è˜‘è‡è¡—æ¨èå·¥ç¨‹å®è·µ</a></li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href=""></a></li>
<li><a href=""></a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Recommend System</category>
        <category>Overview</category>
      </categories>
      <tags>
        <tag>æ¨èç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>æ®µåˆå¹¶</title>
    <url>/wiki/%E6%AE%B5%E5%90%88%E5%B9%B6/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://learnku.com/articles/41593">learnku.com</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Getting Started</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»Ÿè®¡å»é‡æ•°æ® (è¿‘ä¼¼åº¦é‡)</title>
    <url>/wiki/%E7%BB%9F%E8%AE%A1%E5%8E%BB%E9%87%8D%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="cardinalityç”¨æ³•"><a href="#cardinalityç”¨æ³•" class="headerlink" title="cardinalityç”¨æ³•"></a>cardinalityç”¨æ³•</h2><p>å¸¸ç”¨å†™æ³•å¦‚ä¸‹ğŸ‘‡<br><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;months&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;date_histogram&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;sold&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;interval&quot;</span>: <span class="string">&quot;month&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;distinct_colors&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;cardinality&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç²¾åº¦é—®é¢˜"><a href="#ç²¾åº¦é—®é¢˜" class="headerlink" title="ç²¾åº¦é—®é¢˜"></a>ç²¾åº¦é—®é¢˜</h2><p><code>cardinality</code> åº¦é‡æ˜¯ä¸€ä¸ª <code>è¿‘ä¼¼ç®—æ³•</code>ã€‚ å®ƒæ˜¯åŸºäº HyperLogLog++ ï¼ˆHLLï¼‰ç®—æ³•çš„ã€‚ HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚</p>
<p>æˆ‘ä»¬ä¸éœ€è¦ç†è§£æŠ€æœ¯ç»†èŠ‚ï¼Œ ä½†æˆ‘ä»¬æœ€å¥½åº”è¯¥å…³æ³¨ä¸€ä¸‹è¿™ä¸ªç®—æ³•çš„ ç‰¹æ€§ ï¼š</p>
<ul>
<li>å¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ã€‚</li>
<li>å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ã€‚</li>
</ul>
<p>è¦é…ç½®ç²¾åº¦ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®š <code>precision_threshold</code> å‚æ•°çš„å€¼ã€‚ è¿™ä¸ªé˜ˆå€¼å®šä¹‰äº†åœ¨ä½•ç§åŸºæ•°æ°´å¹³ä¸‹æˆ‘ä»¬å¸Œæœ›å¾—åˆ°ä¸€ä¸ªè¿‘ä¹ç²¾ç¡®çš„ç»“æœã€‚å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<p><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;distinct_colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;cardinality&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;precision_threshold&quot;</span> : <span class="number">100</span> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>âš ï¸ âš ï¸<br><code>precision_threshold</code> æ¥å— 0â€“40000 ä¹‹é—´çš„æ•°å­—ï¼Œæ›´å¤§çš„å€¼è¿˜æ˜¯ä¼šè¢«å½“ä½œ 40000 æ¥å¤„ç† </p>
<p>ç¤ºä¾‹ä¼šç¡®ä¿å½“å­—æ®µå”¯ä¸€å€¼åœ¨ 100 ä»¥å†…æ—¶ä¼šå¾—åˆ°éå¸¸å‡†ç¡®çš„ç»“æœã€‚å°½ç®¡ç®—æ³•æ˜¯æ— æ³•ä¿è¯è¿™ç‚¹çš„ï¼Œä½†å¦‚æœåŸºæ•°åœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œå‡ ä¹æ€»æ˜¯ 100% æ­£ç¡®çš„ã€‚é«˜äºé˜ˆå€¼çš„åŸºæ•°ä¼šå¼€å§‹èŠ‚çœå†…å­˜è€Œç‰ºç‰²å‡†ç¡®åº¦ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹åº¦é‡ç»“æœå¸¦å…¥è¯¯å·®ã€‚</p>
<p>å¯¹äºæŒ‡å®šçš„é˜ˆå€¼ï¼Œ<code>HLL</code> çš„æ•°æ®ç»“æ„ä¼šå¤§æ¦‚ä½¿ç”¨ <code>precision_threshold</code> * 8 å­—èŠ‚çš„å†…å­˜ï¼Œæ‰€ä»¥å°±å¿…é¡»åœ¨ç‰ºç‰²å†…å­˜å’Œè·å¾—é¢å¤–çš„å‡†ç¡®åº¦é—´åšå¹³è¡¡ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ 100 çš„é˜ˆå€¼å¯ä»¥åœ¨å”¯ä¸€å€¼ä¸ºç™¾ä¸‡çš„æƒ…å†µä¸‹ä»ç„¶å°†è¯¯å·®ç»´æŒ 5% ä»¥å†…</p>
<h2 id="é€Ÿåº¦é—®é¢˜"><a href="#é€Ÿåº¦é—®é¢˜" class="headerlink" title="é€Ÿåº¦é—®é¢˜"></a>é€Ÿåº¦é—®é¢˜</h2><p>å¦‚æœæƒ³è¦è·å¾—å”¯ä¸€å€¼çš„æ•°ç›®ï¼Œ é€šå¸¸ éœ€è¦æŸ¥è¯¢æ•´ä¸ªæ•°æ®é›†åˆï¼ˆæˆ–å‡ ä¹æ‰€æœ‰æ•°æ®ï¼‰ã€‚ æ‰€æœ‰åŸºäºæ‰€æœ‰æ•°æ®çš„æ“ä½œéƒ½å¿…é¡»è¿…é€Ÿï¼ŒåŸå› æ˜¯æ˜¾ç„¶çš„ã€‚ <code>HyperLogLog</code> çš„é€Ÿåº¦å·²ç»å¾ˆå¿«äº†ï¼Œå®ƒåªæ˜¯ç®€å•çš„å¯¹æ•°æ®åšå“ˆå¸Œä»¥åŠä¸€äº›ä½æ“ä½œã€‚</p>
<p>ä½†å¦‚æœé€Ÿåº¦å¯¹æˆ‘ä»¬è‡³å…³é‡è¦ï¼Œå¯ä»¥åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚ å› ä¸º HLL åªéœ€è¦å­—æ®µå†…å®¹çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç´¢å¼•æ—¶å°±é¢„å…ˆè®¡ç®—å¥½ã€‚ å°±èƒ½åœ¨æŸ¥è¯¢æ—¶è·³è¿‡å“ˆå¸Œè®¡ç®—ç„¶åå°†å“ˆå¸Œå€¼ä» <code>fielddata</code> ç›´æ¥åŠ è½½å‡ºæ¥ã€‚</p>
<blockquote>
<p>é¢„å…ˆè®¡ç®—å“ˆå¸Œå€¼åªå¯¹å†…å®¹å¾ˆé•¿æˆ–è€…åŸºæ•°å¾ˆé«˜çš„å­—æ®µæœ‰ç”¨ï¼Œè®¡ç®—è¿™äº›å­—æ®µçš„å“ˆå¸Œå€¼çš„æ¶ˆè€—åœ¨æŸ¥è¯¢æ—¶æ˜¯æ— æ³•å¿½ç•¥çš„ã€‚<br>  å°½ç®¡æ•°å€¼å­—æ®µçš„å“ˆå¸Œè®¡ç®—æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œå­˜å‚¨å®ƒä»¬çš„åŸå§‹å€¼é€šå¸¸éœ€è¦åŒæ ·ï¼ˆæˆ–æ›´å°‘ï¼‰çš„å†…å­˜ç©ºé—´ã€‚è¿™å¯¹ä½åŸºæ•°çš„å­—ç¬¦ä¸²å­—æ®µåŒæ ·é€‚ç”¨ï¼ŒElasticsearch çš„å†…éƒ¨ä¼˜åŒ–èƒ½å¤Ÿä¿è¯æ¯ä¸ªå”¯ä¸€å€¼åªè®¡ç®—ä¸€æ¬¡å“ˆå¸Œã€‚<br>  åŸºæœ¬ä¸Šè¯´ï¼Œé¢„å…ˆè®¡ç®—å¹¶ä¸èƒ½ä¿è¯æ‰€æœ‰çš„å­—æ®µéƒ½æ›´å¿«ï¼Œå®ƒåªå¯¹é‚£äº›å…·æœ‰é«˜åŸºæ•°å’Œ/æˆ–è€…å†…å®¹å¾ˆé•¿çš„å­—ç¬¦ä¸²å­—æ®µæœ‰ä½œç”¨ã€‚éœ€è¦è®°ä½çš„æ˜¯ï¼Œé¢„è®¡ç®—åªæ˜¯ç®€å•çš„å°†æŸ¥è¯¢æ¶ˆè€—çš„æ—¶é—´æå‰è½¬ç§»åˆ°ç´¢å¼•æ—¶ï¼Œå¹¶éæ²¡æœ‰ä»»ä½•ä»£ä»·ï¼ŒåŒºåˆ«åœ¨äºä½ å¯ä»¥é€‰æ‹©åœ¨ ä»€ä¹ˆæ—¶å€™ åšè¿™ä»¶äº‹ï¼Œè¦ä¹ˆåœ¨ç´¢å¼•æ—¶ï¼Œè¦ä¹ˆåœ¨æŸ¥è¯¢æ—¶ã€‚</p>
</blockquote>
<p>åˆ›å»ºç´¢å¼•æ—¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PUT /cars/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;transactions&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;color&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;fields&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;hash&quot;</span>: &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;murmur3&quot;</span> </span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¤šå€¼å­—æ®µçš„ç±»å‹æ˜¯ <code>murmur3</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ã€‚</p>
</blockquote>
<p>ç°åœ¨å½“æˆ‘ä»¬æ‰§è¡Œèšåˆæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>color.hash</code> å­—æ®µè€Œä¸æ˜¯ color å­—æ®µï¼š<br><code>curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39;</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;distinct_colors&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;cardinality&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color.hash&quot;</span> </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ç°åœ¨ <code>cardinality</code> åº¦é‡ä¼šè¯»å– â€œ<code>color.hash</code>â€œ é‡Œçš„å€¼ï¼ˆé¢„å…ˆè®¡ç®—çš„å“ˆå¸Œå€¼ï¼‰ï¼Œå–ä»£åŠ¨æ€è®¡ç®—åŸå§‹å€¼çš„å“ˆå¸Œã€‚</p>
<p>å•ä¸ªæ–‡æ¡£èŠ‚çœçš„æ—¶é—´æ˜¯éå¸¸å°‘çš„ï¼Œä½†æ˜¯å¦‚æœä½ èšåˆä¸€äº¿æ•°æ®ï¼Œæ¯ä¸ªå­—æ®µå¤šèŠ±è´¹ 10 çº³ç§’çš„æ—¶é—´ï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½ä¼šé¢å¤–å¢åŠ  1 ç§’ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨éå¸¸å¤§é‡çš„æ•°æ®é‡Œé¢ä½¿ç”¨ <code>cardinality</code> ï¼Œæˆ‘ä»¬å¯ä»¥æƒè¡¡ä½¿ç”¨é¢„è®¡ç®—çš„æ„ä¹‰ï¼Œæ˜¯å¦éœ€è¦æå‰è®¡ç®— hashï¼Œä»è€Œåœ¨æŸ¥è¯¢æ—¶è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œåšä¸€äº›æ€§èƒ½æµ‹è¯•æ¥æ£€éªŒé¢„è®¡ç®—å“ˆå¸Œæ˜¯å¦é€‚ç”¨äºä½ çš„åº”ç”¨åœºæ™¯ã€‚ã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>èšåˆ æ¡å½¢å›¾</title>
    <url>/wiki/%E8%81%9A%E5%90%88-%E6%9D%A1%E5%BD%A2%E5%9B%BE/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href=""></a></li>
<li><a href=""></a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>èšåˆ é«˜çº§æ¦‚å¿µ</title>
    <url>/wiki/%E8%81%9A%E5%90%88-%E9%AB%98%E7%BA%A7%E6%A6%82%E5%BF%B5/</url>
    <content><![CDATA[<h2 id="æ¡¶"><a href="#æ¡¶" class="headerlink" title="æ¡¶"></a>æ¡¶</h2><p><code>æ¡¶</code> ç®€å•æ¥è¯´å°±æ˜¯æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆï¼š</p>
<ul>
<li>ä¸€ä¸ªé›‡å‘˜å±äº ç”·æ€§ æ¡¶æˆ–è€… å¥³æ€§ æ¡¶</li>
<li>å¥¥å°”å·´å°¼å±äº çº½çº¦ æ¡¶</li>
<li>æ—¥æœŸ2014-10-28å±äº åæœˆ æ¡¶<br>å½“èšåˆå¼€å§‹è¢«æ‰§è¡Œï¼Œæ¯ä¸ªæ–‡æ¡£é‡Œé¢çš„å€¼é€šè¿‡è®¡ç®—æ¥å†³å®šç¬¦åˆå“ªä¸ªæ¡¶çš„æ¡ä»¶ã€‚å¦‚æœåŒ¹é…åˆ°ï¼Œæ–‡æ¡£å°†æ”¾å…¥ç›¸åº”çš„æ¡¶å¹¶æ¥ç€è¿›è¡Œèšåˆæ“ä½œã€‚</li>
</ul>
<p>æ¡¶ä¹Ÿå¯ä»¥è¢«åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ï¼Œæä¾›å±‚æ¬¡åŒ–çš„æˆ–è€…æœ‰æ¡ä»¶çš„åˆ’åˆ†æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œè¾›è¾›é‚£æä¼šè¢«æ”¾å…¥ä¿„äº¥ä¿„å·è¿™ä¸ªæ¡¶ï¼Œè€Œ æ•´ä¸ª ä¿„äº¥ä¿„å·æ¡¶ä¼šè¢«æ”¾å…¥ç¾å›½è¿™ä¸ªæ¡¶ã€‚</p>
<p>Elasticsearch æœ‰å¾ˆå¤šç§ç±»å‹çš„æ¡¶ï¼Œèƒ½è®©ä½ é€šè¿‡å¾ˆå¤šç§æ–¹å¼æ¥åˆ’åˆ†æ–‡æ¡£ï¼ˆ<code>æ—¶é—´</code>ã€<code>æœ€å—æ¬¢è¿çš„è¯</code>ã€<code>å¹´é¾„åŒºé—´</code>ã€<code>åœ°ç†ä½ç½®</code> ç­‰ç­‰ï¼‰ã€‚å…¶å®æ ¹æœ¬ä¸Šéƒ½æ˜¯é€šè¿‡åŒæ ·çš„åŸç†è¿›è¡Œæ“ä½œï¼šåŸºäºæ¡ä»¶æ¥åˆ’åˆ†æ–‡æ¡£ã€‚</p>
<h2 id="æŒ‡æ ‡"><a href="#æŒ‡æ ‡" class="headerlink" title="æŒ‡æ ‡"></a>æŒ‡æ ‡</h2><p>æ¡¶èƒ½è®©æˆ‘ä»¬åˆ’åˆ†æ–‡æ¡£åˆ°æœ‰æ„ä¹‰çš„é›†åˆï¼Œä½†æ˜¯æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯å¯¹è¿™äº›æ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œä¸€äº›æŒ‡æ ‡çš„è®¡ç®—ã€‚åˆ†æ¡¶æ˜¯ä¸€ç§è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µï¼šå®ƒæä¾›äº†ä¸€ç§ç»™æ–‡æ¡£åˆ†ç»„çš„æ–¹æ³•æ¥è®©æˆ‘ä»¬å¯ä»¥è®¡ç®—æ„Ÿå…´è¶£çš„æŒ‡æ ‡ã€‚</p>
<p>å¤§å¤šæ•° <code>æŒ‡æ ‡</code> æ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ï¼ˆä¾‹å¦‚æœ€å°å€¼ã€å¹³å‡å€¼ã€æœ€å¤§å€¼ï¼Œè¿˜æœ‰æ±‡æ€»ï¼‰ï¼Œè¿™äº›æ˜¯é€šè¿‡æ–‡æ¡£çš„å€¼æ¥è®¡ç®—ã€‚åœ¨å®è·µä¸­ï¼ŒæŒ‡æ ‡èƒ½è®©ä½ è®¡ç®—åƒå¹³å‡è–ªèµ„ã€æœ€é«˜å‡ºå”®ä»·æ ¼ã€95%çš„æŸ¥è¯¢å»¶è¿Ÿè¿™æ ·çš„æ•°æ®ã€‚</p>
<h2 id="æ¡¶å’ŒæŒ‡æ ‡çš„ç»„åˆ"><a href="#æ¡¶å’ŒæŒ‡æ ‡çš„ç»„åˆ" class="headerlink" title="æ¡¶å’ŒæŒ‡æ ‡çš„ç»„åˆ"></a>æ¡¶å’ŒæŒ‡æ ‡çš„ç»„åˆ</h2><p><code>èšåˆ</code> æ˜¯ç”±æ¡¶å’ŒæŒ‡æ ‡ç»„æˆçš„ã€‚ èšåˆå¯èƒ½åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå¯èƒ½åªæœ‰ä¸€ä¸ªæŒ‡æ ‡ï¼Œæˆ–è€…å¯èƒ½ä¸¤ä¸ªéƒ½æœ‰ã€‚ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›æ¡¶åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰€å±å›½å®¶æ¥åˆ’åˆ†æ–‡æ¡£ï¼ˆæ¡¶ï¼‰ï¼Œç„¶åè®¡ç®—æ¯ä¸ªå›½å®¶çš„å¹³å‡è–ªé…¬ï¼ˆæŒ‡æ ‡ï¼‰ã€‚</p>
<p>ç”±äºæ¡¶å¯ä»¥è¢«åµŒå¥—ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°éå¸¸å¤šå¹¶ä¸”éå¸¸å¤æ‚çš„èšåˆï¼š</p>
<p>1.é€šè¿‡å›½å®¶åˆ’åˆ†æ–‡æ¡£ï¼ˆæ¡¶ï¼‰</p>
<p>2.ç„¶åé€šè¿‡æ€§åˆ«åˆ’åˆ†æ¯ä¸ªå›½å®¶ï¼ˆæ¡¶ï¼‰</p>
<p>3.ç„¶åé€šè¿‡å¹´é¾„åŒºé—´åˆ’åˆ†æ¯ç§æ€§åˆ«ï¼ˆæ¡¶ï¼‰</p>
<p>4.æœ€åï¼Œä¸ºæ¯ä¸ªå¹´é¾„åŒºé—´è®¡ç®—å¹³å‡è–ªé…¬ï¼ˆæŒ‡æ ‡ï¼‰</p>
<p>æœ€åå°†å‘Šè¯‰ä½ æ¯ä¸ª &lt;å›½å®¶, æ€§åˆ«, å¹´é¾„&gt; ç»„åˆçš„å¹³å‡è–ªé…¬ã€‚æ‰€æœ‰çš„è¿™äº›éƒ½åœ¨ä¸€ä¸ªè¯·æ±‚å†…å®Œæˆå¹¶ä¸”åªéå†ä¸€æ¬¡æ•°æ®ï¼</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿‡æ»¤å’Œèšåˆ</title>
    <url>/wiki/%E8%BF%87%E6%BB%A4%E5%92%8C%E8%81%9A%E5%90%88/</url>
    <content><![CDATA[<h2 id="è¿‡æ»¤å’Œèšåˆ"><a href="#è¿‡æ»¤å’Œèšåˆ" class="headerlink" title="è¿‡æ»¤å’Œèšåˆ"></a>è¿‡æ»¤å’Œèšåˆ</h2><p>èšåˆèŒƒå›´é™å®šè¿˜æœ‰ä¸€ä¸ªè‡ªç„¶çš„æ‰©å±•å°±æ˜¯è¿‡æ»¤ã€‚å› ä¸ºèšåˆæ˜¯åœ¨æŸ¥è¯¢ç»“æœèŒƒå›´å†…æ“ä½œçš„ï¼Œä»»ä½•å¯ä»¥é€‚ç”¨äºæŸ¥è¯¢çš„è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥åº”ç”¨åœ¨èšåˆä¸Šã€‚</p>
<h2 id="è¿‡æ»¤"><a href="#è¿‡æ»¤" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h2><p>å¦‚æœæˆ‘ä»¬æƒ³æ‰¾åˆ°å”®ä»·åœ¨ $10,000 ç¾å…ƒä¹‹ä¸Šçš„æ‰€æœ‰æ±½è½¦åŒæ—¶ä¹Ÿä¸ºè¿™äº›è½¦è®¡ç®—å¹³å‡å”®ä»·ï¼Œ å¯ä»¥ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ª <code>constant_score</code> æŸ¥è¯¢å’Œ <code>filter</code> çº¦æŸï¼š</p>
<p><code>GET /cars/transactions/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;constant_score&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;filter&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">                    <span class="attr">&quot;price&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;gte&quot;</span>: <span class="number">10000</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;single_avg_price&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;avg&quot;</span> : &#123; <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;price&quot;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»æ ¹æœ¬ä¸Šè®²ï¼Œä½¿ç”¨ <code>non-scoring</code> æŸ¥è¯¢å’Œä½¿ç”¨ <code>match</code> æŸ¥è¯¢æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚æŸ¥è¯¢ï¼ˆåŒ…æ‹¬äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼‰è¿”å›ä¸€ç»„æ–‡æ¡£çš„å­é›†ï¼Œèšåˆæ­£æ˜¯æ“ä½œè¿™äº›æ–‡æ¡£ã€‚ä½¿ç”¨ <code>filtering query</code> ä¼šå¿½ç•¥è¯„åˆ†ï¼Œå¹¶æœ‰å¯èƒ½ä¼šç¼“å­˜ç»“æœæ•°æ®ç­‰ç­‰ã€‚</p>
<h2 id="è¿‡æ»¤æ¡¶"><a href="#è¿‡æ»¤æ¡¶" class="headerlink" title="è¿‡æ»¤æ¡¶"></a>è¿‡æ»¤æ¡¶</h2><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæƒ³å¯¹èšåˆç»“æœè¿‡æ»¤æ€ä¹ˆåŠï¼Ÿ å‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºæ±½è½¦ç»é”€å•†åˆ›å»ºä¸€ä¸ªæœç´¢é¡µé¢ï¼Œ æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºç”¨æˆ·æœç´¢çš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶ä¹Ÿæƒ³åœ¨é¡µé¢ä¸Šæä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼ˆä¸æœç´¢åŒ¹é…çš„ï¼‰ä¸Šä¸ªæœˆåº¦æ±½è½¦çš„å¹³å‡å”®ä»·ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ— æ³•ç®€å•çš„åšèŒƒå›´é™å®šï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªä¸åŒçš„æ¡ä»¶ã€‚æœç´¢ç»“æœå¿…é¡»æ˜¯ ford ï¼Œä½†æ˜¯èšåˆç»“æœå¿…é¡»æ»¡è¶³ ford AND sold &gt; now - 1M ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§ç‰¹æ®Šçš„æ¡¶ï¼Œå«åš filter ï¼ˆæ³¨ï¼šè¿‡æ»¤æ¡¶ï¼‰ ã€‚ æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªè¿‡æ»¤æ¡¶ï¼Œå½“æ–‡æ¡£æ»¡è¶³è¿‡æ»¤æ¡¶çš„æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åŠ å…¥åˆ°æ¡¶å†…ã€‚</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š<br><code>GET /cars/transactions/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">   <span class="attr">&quot;query&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;make&quot;</span>: <span class="string">&quot;ford&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="attr">&quot;aggs&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;recent_sales&quot;</span>: &#123;</span><br><span class="line">         <span class="attr">&quot;filter&quot;</span>: &#123; </span><br><span class="line">            <span class="attr">&quot;range&quot;</span>: &#123;</span><br><span class="line">               <span class="attr">&quot;sold&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;from&quot;</span>: <span class="string">&quot;now-1M&quot;</span></span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="attr">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;average_price&quot;</span>:&#123;</span><br><span class="line">               <span class="attr">&quot;avg&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;field&quot;</span>: <span class="string">&quot;price&quot;</span> </span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ä½¿ç”¨ è¿‡æ»¤ æ¡¶åœ¨ æŸ¥è¯¢ èŒƒå›´åŸºç¡€ä¸Šåº”ç”¨è¿‡æ»¤å™¨ã€‚</p>
</li>
<li><p>avg åº¦é‡åªä¼šå¯¹ ford å’Œä¸Šä¸ªæœˆå”®å‡ºçš„æ–‡æ¡£è®¡ç®—å¹³å‡å”®ä»·ã€‚</p>
</li>
</ul>
<p>å› ä¸º <code>filter</code> æ¡¶å’Œå…¶ä»–æ¡¶çš„æ“ä½œæ–¹å¼ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥éšæ„å°†å…¶ä»–æ¡¶å’Œåº¦é‡åµŒå…¥å…¶ä¸­ã€‚æ‰€æœ‰åµŒå¥—çš„ç»„ä»¶éƒ½ä¼š â€œç»§æ‰¿â€ è¿™ä¸ªè¿‡æ»¤ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥æŒ‰éœ€é’ˆå¯¹èšåˆè¿‡æ»¤å‡ºé€‰æ‹©éƒ¨åˆ†ã€‚</p>
<h2 id="åè¿‡æ»¤å™¨"><a href="#åè¿‡æ»¤å™¨" class="headerlink" title="åè¿‡æ»¤å™¨"></a>åè¿‡æ»¤å™¨</h2><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å¯¹æœç´¢ç»“æœå’Œèšåˆç»“æœè¿›è¡Œè¿‡æ»¤ï¼ˆä¸è®¡ç®—å¾—åˆ†çš„ filter æŸ¥è¯¢ï¼‰ï¼Œä»¥åŠé’ˆå¯¹èšåˆç»“æœçš„ä¸€éƒ¨åˆ†è¿›è¡Œè¿‡æ»¤ï¼ˆ filter æ¡¶ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å¯èƒ½ä¼šæƒ³ï¼Œâ€åªè¿‡æ»¤æœç´¢ç»“æœï¼Œä¸è¿‡æ»¤èšåˆç»“æœå‘¢ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ä½¿ç”¨ post_filter ã€‚</p>
<p>å®ƒæ˜¯æ¥æ”¶ä¸€ä¸ªè¿‡æ»¤å™¨çš„é¡¶å±‚æœç´¢è¯·æ±‚å…ƒç´ ã€‚è¿™ä¸ªè¿‡æ»¤å™¨åœ¨æŸ¥è¯¢ ä¹‹å æ‰§è¡Œï¼ˆè¿™æ­£æ˜¯è¯¥è¿‡æ»¤å™¨çš„åå­—çš„ç”±æ¥ï¼šå®ƒåœ¨æŸ¥è¯¢ä¹‹å post æ‰§è¡Œï¼‰ã€‚æ­£å› ä¸ºå®ƒåœ¨æŸ¥è¯¢ä¹‹åæ‰§è¡Œï¼Œå®ƒå¯¹æŸ¥è¯¢èŒƒå›´æ²¡æœ‰ä»»ä½•å½±å“ï¼Œæ‰€ä»¥å¯¹èšåˆä¹Ÿä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªè¡Œä¸ºå¯¹æŸ¥è¯¢æ¡ä»¶åº”ç”¨æ›´å¤šçš„è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çš„æ“ä½œï¼Œå°±å¦‚ UI ä¸Šçš„å„ä¸ªåˆ†ç±»é¢ã€‚è®©æˆ‘ä»¬ä¸ºæ±½è½¦ç»é”€å•†è®¾è®¡å¦å¤–ä¸€ä¸ªæœç´¢é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å…è®¸ç”¨æˆ·æœç´¢æ±½è½¦åŒæ—¶å¯ä»¥æ ¹æ®é¢œè‰²æ¥è¿‡æ»¤ã€‚é¢œè‰²çš„é€‰é¡¹æ˜¯é€šè¿‡èšåˆè·å¾—çš„ï¼š</p>
<p><code>GET /cars/transactions/_search</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;size&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;make&quot;</span>: <span class="string">&quot;ford&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;post_filter&quot;</span>: &#123;    </span><br><span class="line">        <span class="attr">&quot;term&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;color&quot;</span> : <span class="string">&quot;green&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;aggs&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;all_colors&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;terms&quot;</span> : &#123; <span class="attr">&quot;field&quot;</span> : <span class="string">&quot;color&quot;</span> &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>post_filter å…ƒç´ æ˜¯ top-level è€Œä¸”ä»…å¯¹å‘½ä¸­ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚</p>
</blockquote>
<p>æŸ¥è¯¢ éƒ¨åˆ†æ‰¾åˆ°æ‰€æœ‰çš„ ford æ±½è½¦ï¼Œç„¶åç”¨ terms èšåˆåˆ›å»ºä¸€ä¸ªé¢œè‰²åˆ—è¡¨ã€‚å› ä¸ºèšåˆå¯¹æŸ¥è¯¢èŒƒå›´è¿›è¡Œæ“ä½œï¼Œé¢œè‰²åˆ—è¡¨ä¸ç¦ç‰¹æ±½è½¦æœ‰çš„é¢œè‰²ç›¸å¯¹åº”ã€‚</p>
<p>æœ€åï¼Œ post_filter ä¼šè¿‡æ»¤æœç´¢ç»“æœï¼Œåªå±•ç¤ºç»¿è‰² ford æ±½è½¦ã€‚è¿™åœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ å å‘ç”Ÿï¼Œæ‰€ä»¥èšåˆä¸å—å½±å“ã€‚</p>
<p>è¿™é€šå¸¸å¯¹ UI çš„è¿è´¯ä¸€è‡´æ€§å¾ˆé‡è¦ï¼Œå¯ä»¥æƒ³è±¡ç”¨æˆ·åœ¨ç•Œé¢å•†é€‰æ‹©äº†ä¸€ç±»é¢œè‰²ï¼ˆæ¯”å¦‚ï¼šç»¿è‰²ï¼‰ï¼ŒæœŸæœ›çš„æ˜¯æœç´¢ç»“æœå·²ç»è¢«è¿‡æ»¤äº†ï¼Œè€Œ ä¸æ˜¯ è¿‡æ»¤ç•Œé¢ä¸Šçš„é€‰é¡¹ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ filter æŸ¥è¯¢ï¼Œç•Œé¢ä¼šé©¬ä¸Šå˜æˆ åª æ˜¾ç¤º ç»¿è‰² ä½œä¸ºé€‰é¡¹ï¼Œè¿™ä¸æ˜¯ç”¨æˆ·æƒ³è¦çš„ï¼</p>
<p>âš ï¸ âš ï¸ âš ï¸</p>
<h2 id="æ€§èƒ½è€ƒè™‘ï¼ˆPerformance-considerationï¼‰"><a href="#æ€§èƒ½è€ƒè™‘ï¼ˆPerformance-considerationï¼‰" class="headerlink" title="æ€§èƒ½è€ƒè™‘ï¼ˆPerformance considerationï¼‰"></a>æ€§èƒ½è€ƒè™‘ï¼ˆPerformance considerationï¼‰</h2><p>å½“ä½ éœ€è¦å¯¹æœç´¢ç»“æœå’Œèšåˆç»“æœåšä¸åŒçš„è¿‡æ»¤æ—¶ï¼Œä½ æ‰åº”è¯¥ä½¿ç”¨ post_filter ï¼Œ æœ‰æ—¶ç”¨æˆ·ä¼šåœ¨æ™®é€šæœç´¢ä½¿ç”¨ post_filter ã€‚</p>
<p>ä¸è¦è¿™ä¹ˆåšï¼ post_filter çš„ç‰¹æ€§æ˜¯åœ¨æŸ¥è¯¢ ä¹‹å æ‰§è¡Œï¼Œä»»ä½•è¿‡æ»¤å¯¹æ€§èƒ½å¸¦æ¥çš„å¥½å¤„ï¼ˆæ¯”å¦‚ç¼“å­˜ï¼‰éƒ½ä¼šå®Œå…¨å¤±å»ã€‚</p>
<p>åœ¨æˆ‘ä»¬éœ€è¦ä¸åŒè¿‡æ»¤æ—¶ï¼Œ post_filter åªä¸èšåˆä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€‰æ‹©åˆé€‚ç±»å‹çš„è¿‡æ»¤ï¼ˆå¦‚ï¼šæœç´¢å‘½ä¸­ã€èšåˆæˆ–ä¸¤è€…å…¼æœ‰ï¼‰é€šå¸¸å’Œæˆ‘ä»¬æœŸæœ›å¦‚ä½•è¡¨ç°ç”¨æˆ·äº¤äº’æœ‰å…³ã€‚é€‰æ‹©åˆé€‚çš„è¿‡æ»¤å™¨ï¼ˆæˆ–ç»„åˆï¼‰å–å†³äºæˆ‘ä»¬æœŸæœ›å¦‚ä½•å°†ç»“æœå‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
<ul>
<li>åœ¨ filter è¿‡æ»¤ä¸­çš„ non-scoring æŸ¥è¯¢ï¼ŒåŒæ—¶å½±å“æœç´¢ç»“æœå’Œèšåˆç»“æœã€‚</li>
<li>filter æ¡¶å½±å“èšåˆã€‚</li>
<li>post_filter åªå½±å“æœç´¢ç»“æœã€‚</li>
</ul>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Aggregations</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢å‘å¯¹è±¡ç‰¹å¾</title>
    <url>/wiki/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%89%B9%E5%BE%81/</url>
    <content><![CDATA[<h2 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h2><p>å°è£…æ˜¯ä¿è¯è½¯ä»¶éƒ¨ä»¶å…·æœ‰ä¼˜è‰¯çš„æ¨¡å—æ€§çš„åŸºç¡€ï¼Œå°è£…çš„ç›®æ ‡å°±æ˜¯å®ç°è½¯ä»¶å†…éƒ¨çš„â€œé«˜å†…èšã€ä½è€¦åˆâ€ã€‚é˜²æ­¢ç¨‹åºç›¸äº’ä¾èµ–è€Œå¸¦æ¥çš„å˜åŠ¨å½±å“ã€‚åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹è±¡æ˜¯å°è£…çš„æœ€åŸºæœ¬å•ä½ï¼Œé¢å‘å¯¹è±¡çš„å°è£…æ¯”ä¼ ç»Ÿè¯­è¨€çš„å°è£…æ›´ä¸ºæ¸…æ™°ã€ä¹Ÿæ›´ä¸ºæœ‰åŠ›ï¼Œé¢å‘å¯¹è±¡çš„å°è£…å°±æ˜¯æŠŠæè¿°ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºçš„ä»£ç å°è£…åœ¨ä¸€ä¸ªâ€œæ¨¡å—â€ä¸­ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç±»ä¸­ï¼Œå±æ€§ç”¨å˜é‡å®šä¹‰ï¼Œè¡Œä¸ºç”¨æ–¹æ³•å®šä¹‰ï¼Œæ–¹æ³•å¯ä»¥ç›´æ¥è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ã€‚</p>
<p>å°†ä¸€ä¸ªç±»ä¸­çš„æˆå‘˜å˜é‡å…¨éƒ¨å®šä¹‰ä¸ºç§æœ‰çš„ï¼Œåªæœ‰è¿™ä¸ªç±»è‡ªå·±çš„æ–¹æ³•æ‰å¯ä»¥è®¿é—®åˆ°è¿™äº›æˆå‘˜å˜é‡ï¼Œè¿™å°±åŸºæœ¬ä¸Šå®ç°å¯¹è±¡çš„å°è£…ï¼ŒæŠŠæ¡ä¸€ä¸ªåŸåˆ™ï¼šæŠŠå¯¹åŒä¸€äº‹ç‰©è¿›è¡Œæ“ä½œçš„æ–¹æ³•å’Œç›¸å…³çš„æ–¹æ³•æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ŒæŠŠæ–¹æ³•å’Œå®ƒæ“ä½œçš„æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚</p>
<h2 id="æŠ½è±¡"><a href="#æŠ½è±¡" class="headerlink" title="æŠ½è±¡"></a>æŠ½è±¡</h2><p>æŠ½è±¡å°±æ˜¯æ‰¾å‡ºä¸€äº›äº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ä¹‹å¤„ï¼Œç„¶åå°†è¿™äº›äº‹ç‰©å½’ä¸ºä¸€ç±»ï¼Œè¿™ä¸ªç±»åªè€ƒè™‘è¿™äº›äº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ä¹‹å¤„ï¼Œå¹¶ä¸”ä¼šå¿½ç•¥ä¸å½“å‰ä¸»é¢˜å’Œç›®æ ‡æ— å…³çš„é‚£äº›æ–¹é¢ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä¸å½“å‰ç›®æ ‡æœ‰å…³çš„æ–¹é¢ã€‚</p>
<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><p>åœ¨å®šä¹‰å’Œå®ç°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»çš„åŸºç¡€ä¸Šæ¥è¿›è¡Œï¼ŒæŠŠè¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»æ‰€å®šä¹‰çš„å†…å®¹ä½œä¸ºè‡ªå·±çš„å†…å®¹ï¼Œå¹¶å¯ä»¥åŠ å…¥è‹¥å¹²æ–°çš„å†…å®¹ï¼Œæˆ–ä¿®æ”¹åŸæ¥çš„æ–¹æ³•ä½¿ä¹‹æ›´é€‚åˆç‰¹æ®Šçš„éœ€è¦ï¼Œè¿™å°±æ˜¯ç»§æ‰¿ã€‚</p>
<p>ç»§æ‰¿æ˜¯å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»èµ„æºï¼ˆæ•°æ®æˆ–è€…æ–¹æ³•ï¼‰çš„æœºåˆ¶ï¼Œè¿™æ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ï¼Œæé«˜äº†è½¯ä»¶çš„å¯é‡ç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h2 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h2><p>å¤šæ€æ˜¯æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹å’Œé€šè¿‡è¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åœ¨è¯¥ç¼–ç¨‹æ—¶ä¸ç¡®å®šï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰ç¡®å®šï¼Œå³ä¸€ä¸ªå¼•ç”¨å˜é‡å€’åº•ä¼šæŒ‡å‘å“ªä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­å®ç°çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç”±ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½å†³å®šã€‚å› ä¸ºåœ¨ç¨‹åºè¿è¡Œæ—¶æ‰ç¡®å®šå…·ä½“çš„ç±»ï¼Œè¿™æ ·ï¼Œä¸ç”¨ä¿®æ”¹æºç¨‹åºä»£ç ï¼Œå°±å¯ä»¥è®©å¼•ç”¨å˜é‡ç»‘å®šåˆ°å„ç§ä¸åŒçš„ç±»å®ç°ä¸Šï¼Œä»è€Œå¯¼è‡´è¯¥å¼•ç”¨è°ƒç”¨çš„å…·ä½“æ–¹æ³•éšä¹‹æ”¹å˜ï¼Œå³ä¸ä¿®æ”¹ç¨‹åºä»£ç å°±å¯ä»¥æ”¹å˜ç¨‹åºè¿è¡Œæ—¶æ‰€ç»‘å®šçš„å…·ä½“ä»£ç ï¼Œè®©ç¨‹åºå¯ä»¥é€‰æ‹©å¤šä¸ªè¿è¡ŒçŠ¶æ€ï¼Œè¿™å°±æ˜¯å¤šæ€æ€§ã€‚</p>
<p>å¤šæ€æ€§å¢å¼ºäº†è½¯ä»¶çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œç®€å•ä¸€å¥è¯ç†è§£å¤šæ€çš„è¯å°±æ˜¯ï¼Œç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹</p>
<blockquote>
<p>ç¼–è¯‘çœ‹å·¦è¾¹ â€“ æ˜¯æŒ‡ æƒ³è¦æˆåŠŸçš„ä¿å­˜,å°±è¦ä½¿ç”¨å·¦è¾¹ä¹Ÿå°±æ˜¯ åªèƒ½ä½¿ç”¨çˆ¶ç±»æä¾›çš„åŠŸèƒ½!!å¦‚æœçˆ¶ç±»ä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šç¼–è¯‘æŠ¥é”™<br>è¿è¡Œçœ‹å³è¾¹ â€“ æ˜¯æŒ‡ æƒ³è¦å¾—åˆ°ç»“æœ,å°±è¦çœ‹å³è¾¹ä¹Ÿå°±æ˜¯ ä½¿ç”¨å­ç±»çš„æ–¹æ³•ä½“!!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹é—´é€šä¿¡IPC</title>
    <url>/wiki/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1IPC/</url>
    <content><![CDATA[<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<ul>
<li><a href="https://www.jianshu.com/p/c1015f5ffa74">è¿›ç¨‹é—´é€šä¿¡IPC (InterProcess Communication)</a></li>
</ul>
</blockquote>
]]></content>
      <categories>
        <category>Linux System</category>
        <category>Process</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaä½è¿ç®—</title>
    <url>/wiki/Java%E4%BD%8D%E8%BF%90%E7%AE%97/</url>
    <content><![CDATA[<p>åœ¨è®¡ç®—æœºä¸­æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å‚¨å­˜çš„ã€‚ä½è¿ç®—å…¶å®å°±æ˜¯ç›´æ¥å¯¹åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œå› æ­¤å¤„ç†æ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œå¦‚æœèƒ½å·§å¦™è¿ç”¨ä½æ“ä½œï¼Œå®Œå…¨å¯ä»¥è¾¾åˆ°å››ä¸¤æ‹¨åƒæ–¤çš„æ•ˆæœï¼Œæ­£å› ä¸ºä½æ“ä½œçš„è¿™äº›ä¼˜ç‚¹ï¼Œæ‰€ä»¥ä½æ“ä½œåœ¨å„å¤§ITå…¬å¸çš„ç¬”è¯•é¢è¯•ä¸­ä¸€ç›´æ˜¯ä¸ªçƒ­ç‚¹é—®é¢˜ã€‚</p>
<h2 id="ä½æ“ä½œåŸºç¡€"><a href="#ä½æ“ä½œåŸºç¡€" class="headerlink" title="ä½æ“ä½œåŸºç¡€"></a>ä½æ“ä½œåŸºç¡€</h2><p>åŸºæœ¬çš„ä½æ“ä½œç¬¦æœ‰ä¸ã€æˆ–ã€å¼‚æˆ–ã€å–åã€å·¦ç§»ã€å³ç§»è¿™6ç§ï¼Œå®ƒä»¬çš„è¿ç®—è§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>åœ¨è¿™6ç§æ“ä½œç¬¦ï¼Œåªæœ‰~å–åæ˜¯å•ç›®æ“ä½œç¬¦ï¼Œå…¶å®ƒ5ç§éƒ½æ˜¯åŒç›®æ“ä½œç¬¦ã€‚</li>
<li>ä½æ“ä½œåªèƒ½ç”¨äºæ•´å½¢æ•°æ®ï¼Œå¯¹floatå’Œdoubleç±»å‹è¿›è¡Œä½æ“ä½œä¼šè¢«ç¼–è¯‘å™¨æŠ¥é”™ã€‚</li>
<li>ä½æ“ä½œç¬¦çš„è¿ç®—ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œå› ä¸ºå°½é‡ä½¿ç”¨æ‹¬å·æ¥ç¡®ä¿è¿ç®—é¡ºåºï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¼šå¾—åˆ°è«æ˜å…¶å¦™çš„ç»“æœã€‚æ¯”å¦‚è¦å¾—åˆ°åƒ1ï¼Œ3ï¼ŒÂ  Â  Â  5ï¼Œ9è¿™äº›2^i+1çš„æ•°å­—ã€‚å†™æˆint a = 1 Â« i + 1;æ˜¯ä¸å¯¹çš„ï¼Œç¨‹åºä¼šå…ˆæ‰§è¡Œi + 1ï¼Œå†æ‰§è¡Œå·¦ç§»æ“ä½œã€‚åº”è¯¥å†™æˆint a = (1 Â« i) + 1;</li>
<li>å¦å¤–ä½æ“ä½œè¿˜æœ‰ä¸€äº›å¤åˆæ“ä½œç¬¦ï¼Œå¦‚&amp;=ã€|=ã€ ^=ã€Â«=ã€Â»=ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.bit;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String [] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = -<span class="number">15</span>, b = <span class="number">15</span>;</span><br><span class="line">        System.out.println(a &gt;&gt; <span class="number">2</span>); <span class="comment">// -4ï¼š-15 = 1111 0001(äºŒè¿›åˆ¶)ï¼Œå³ç§»äºŒä½ï¼Œæœ€é«˜ä½ç”±ç¬¦å·ä½å¡«å……å°†å¾—åˆ°1111 1100å³-4</span></span><br><span class="line">        System.out.println(b &gt;&gt; <span class="number">2</span>); <span class="comment">// 3ï¼š15=0000 1111(äºŒè¿›åˆ¶)ï¼Œå³ç§»äºŒä½ï¼Œæœ€é«˜ä½ç”±ç¬¦å·ä½å¡«å……å°†å¾—åˆ°0000 0011å³3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨ä½æ“ä½œå°æŠ€å·§"><a href="#å¸¸ç”¨ä½æ“ä½œå°æŠ€å·§" class="headerlink" title="å¸¸ç”¨ä½æ“ä½œå°æŠ€å·§"></a>å¸¸ç”¨ä½æ“ä½œå°æŠ€å·§</h2><p>ä¸‹é¢å¯¹ä½æ“ä½œçš„ä¸€äº›å¸¸è§åº”ç”¨ä½œä¸ªæ€»ç»“ï¼Œæœ‰åˆ¤æ–­å¥‡å¶ã€äº¤æ¢ä¸¤æ•°ã€å˜æ¢ç¬¦å·åŠæ±‚ç»å¯¹å€¼ã€‚è¿™äº›å°æŠ€å·§åº”ç”¨æ˜“è®°ï¼Œåº”å½“ç†Ÿç»ƒæŒæ¡ã€‚</p>
<h3 id="åˆ¤æ–­å¥‡å¶"><a href="#åˆ¤æ–­å¥‡å¶" class="headerlink" title="åˆ¤æ–­å¥‡å¶"></a>åˆ¤æ–­å¥‡å¶</h3><p>åªè¦æ ¹æ®æœ€æœªä½æ˜¯0è¿˜æ˜¯1æ¥å†³å®šï¼Œä¸º0å°±æ˜¯å¶æ•°ï¼Œä¸º1å°±æ˜¯å¥‡æ•°ã€‚å› æ­¤å¯ä»¥ç”¨if ((a &amp; 1) == 0)ä»£æ›¿if (a % 2 == 0)æ¥åˆ¤æ–­aæ˜¯ä¸æ˜¯å¶æ•°ã€‚ä¸‹é¢ç¨‹åºå°†è¾“å‡º0åˆ°100ä¹‹é—´çš„æ‰€æœ‰å¶æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i ++) &#123;</span><br><span class="line">   <span class="keyword">if</span> ((i &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123; <span class="comment">// å¶æ•°</span></span><br><span class="line">       System.out.println(i);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="äº¤æ¢ä¸¤æ•°"><a href="#äº¤æ¢ä¸¤æ•°" class="headerlink" title="äº¤æ¢ä¸¤æ•°"></a>äº¤æ¢ä¸¤æ•°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> c = <span class="number">1</span>, d = <span class="number">2</span>;</span><br><span class="line">c ^= d;</span><br><span class="line">d ^= c;</span><br><span class="line">c ^= d;</span><br><span class="line">System.out.println(<span class="string">&quot;c=&quot;</span> + c);</span><br><span class="line">System.out.println(<span class="string">&quot;d=&quot;</span> + d);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è¿™æ ·ç†è§£ï¼š</p>
<p>ç¬¬ä¸€æ­¥ a=b å³a=(ab)ï¼›<br>ç¬¬äºŒæ­¥ b=a å³b=b(ab)ï¼Œç”±äºè¿ç®—æ»¡è¶³äº¤æ¢å¾‹ï¼Œb(ab)=bbaã€‚ç”±äºä¸€ä¸ªæ•°å’Œè‡ªå·±å¼‚æˆ–çš„ç»“æœä¸º0å¹¶ä¸”ä»»ä½•æ•°ä¸0å¼‚æˆ–éƒ½ä¼šä¸å˜çš„ï¼Œæ‰€ä»¥æ­¤æ—¶bè¢«èµ‹ä¸Šäº†açš„å€¼ï¼›<br>ç¬¬ä¸‰æ­¥ a=b å°±æ˜¯a=abï¼Œç”±äºå‰é¢äºŒæ­¥å¯çŸ¥a=(ab)ï¼Œb=aï¼Œæ‰€ä»¥a=abå³a=(ab)aã€‚æ•…aä¼šè¢«èµ‹ä¸Šbçš„å€¼ï¼›</p>
<h3 id="å˜æ¢ç¬¦å·"><a href="#å˜æ¢ç¬¦å·" class="headerlink" title="å˜æ¢ç¬¦å·"></a>å˜æ¢ç¬¦å·</h3><p>å˜æ¢ç¬¦å·å°±æ˜¯æ­£æ•°å˜æˆè´Ÿæ•°ï¼Œè´Ÿæ•°å˜æˆæ­£æ•°ã€‚<br>å¦‚å¯¹äº-11å’Œ11ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å˜æ¢æ–¹æ³•å°†-11å˜æˆ11</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1111 0101(äºŒè¿›åˆ¶) â€“å–å-&gt; 0000 1010(äºŒè¿›åˆ¶) â€“åŠ 1-&gt; 0000 1011(äºŒè¿›åˆ¶)</span><br></pre></td></tr></table></figure>
<p>åŒæ ·å¯ä»¥è¿™æ ·çš„å°†11å˜æˆ-11</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0000 1011(äºŒè¿›åˆ¶) â€“å–å-&gt; 0000 0100(äºŒè¿›åˆ¶) â€“åŠ 1-&gt; 1111 0101(äºŒè¿›åˆ¶)</span><br></pre></td></tr></table></figure>
<p>å› æ­¤å˜æ¢ç¬¦å·åªéœ€è¦å–åååŠ 1å³å¯ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> a = -<span class="number">15</span>, b = <span class="number">15</span>;</span><br><span class="line">System.out.println(~a + <span class="number">1</span>);</span><br><span class="line">System.out.println(~b + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h3 id="æ±‚ç»å¯¹å€¼"><a href="#æ±‚ç»å¯¹å€¼" class="headerlink" title="æ±‚ç»å¯¹å€¼"></a>æ±‚ç»å¯¹å€¼</h3><p>ä½æ“ä½œä¹Ÿå¯ä»¥ç”¨æ¥æ±‚ç»å¯¹å€¼ï¼Œå¯¹äºè´Ÿæ•°å¯ä»¥é€šè¿‡å¯¹å…¶å–åååŠ 1æ¥å¾—åˆ°æ­£æ•°ã€‚å¯¹-6å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1111 1010(äºŒè¿›åˆ¶) â€“å–å-&gt;0000 0101(äºŒè¿›åˆ¶) -åŠ 1-&gt; 0000 0110(äºŒè¿›åˆ¶)</span><br></pre></td></tr></table></figure>
<p>æ¥å¾—åˆ°6ã€‚</p>
<p>å› æ­¤å…ˆç§»ä½æ¥å–ç¬¦å·ä½ï¼Œint i = a Â» 31;è¦æ³¨æ„å¦‚æœaä¸ºæ­£æ•°ï¼Œiç­‰äº0ï¼Œä¸ºè´Ÿæ•°ï¼Œiç­‰äº-1ã€‚ç„¶åå¯¹iè¿›è¡Œåˆ¤æ–­â€”â€”å¦‚æœiç­‰äº0ï¼Œç›´æ¥è¿”å›ã€‚å¦ä¹‹ï¼Œè¿”å›~a+1ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">System.out.println(i == <span class="number">0</span> ? a : (~a + <span class="number">1</span>));</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å†åˆ†æä¸‹ã€‚å¯¹äºä»»ä½•æ•°ï¼Œä¸0å¼‚æˆ–éƒ½ä¼šä¿æŒä¸å˜ï¼Œä¸-1å³0xFFFFFFFFå¼‚æˆ–å°±ç›¸å½“äºå–åã€‚å› æ­¤ï¼Œaä¸iå¼‚æˆ–åå†å‡iï¼ˆå› ä¸ºiä¸º0æˆ–-1ï¼Œæ‰€ä»¥å‡iå³æ˜¯è¦ä¹ˆåŠ 0è¦ä¹ˆåŠ 1ï¼‰ä¹Ÿå¯ä»¥å¾—åˆ°ç»å¯¹å€¼ã€‚æ‰€ä»¥å¯ä»¥å¯¹ä¸Šé¢ä»£ç ä¼˜åŒ–ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> j = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">System.out.println((a ^ j) - j);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™ç§æ–¹æ³•æ²¡ç”¨ä»»ä½•åˆ¤æ–­è¡¨è¾¾å¼ï¼Œè€Œä¸”æœ‰äº›ç¬”é¢è¯•é¢˜å°±è¦æ±‚è¿™æ ·åšï¼Œå› æ­¤å»ºè®®è¯»è€…è®°ä½è¯¥æ–¹æ³•ï¼ˆ_è®²è§£è¿‡ååº”è¯¥æ˜¯æ¯”è¾ƒå¥½è®°äº†ï¼‰ã€‚</p>
<h3 id="ä½æ“ä½œä¸ç©ºé—´å‹ç¼©"><a href="#ä½æ“ä½œä¸ç©ºé—´å‹ç¼©" class="headerlink" title="ä½æ“ä½œä¸ç©ºé—´å‹ç¼©"></a>ä½æ“ä½œä¸ç©ºé—´å‹ç¼©</h3><p>ç­›ç´ æ•°æ³•åœ¨è¿™é‡Œä¸å°±è¯¦ç»†ä»‹ç»äº†ï¼Œæœ¬æ–‡ç€é‡å¯¹ç­›ç´ æ•°æ³•æ‰€ä½¿ç”¨çš„ç´ æ•°è¡¨è¿›è¡Œä¼˜åŒ–æ¥å‡å°å…¶ç©ºé—´å ç”¨ã€‚è¦å‹ç¼©ç´ æ•°è¡¨çš„ç©ºé—´å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä½æ“ä½œã€‚ä¸‹é¢æ˜¯ç”¨ç­›ç´ æ•°æ³•è®¡ç®—100ä»¥å†…çš„ç´ æ•°ç¤ºä¾‹ä»£ç ï¼ˆæ³¨2ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ‰“å°100ä»¥å†…ç´ æ•°ï¼š</span></span><br><span class="line"><span class="comment">// ï¼ˆ1ï¼‰å¯¹æ¯ä¸ªç´ æ•°ï¼Œå®ƒçš„å€æ•°å¿…å®šä¸æ˜¯ç´ æ•°ï¼›</span></span><br><span class="line"><span class="comment">// ï¼ˆ2ï¼‰æœ‰å¾ˆå¤šé‡å¤è®¿é—®å¦‚flag[10]ä¼šåœ¨è®¿é—®flag[2]å’Œflag[5]æ—¶å„è®¿é—®ä¸€æ¬¡ï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">boolean</span>[] flags = <span class="keyword">new</span> <span class="keyword">boolean</span>[max];</span><br><span class="line"><span class="keyword">int</span> [] primes = <span class="keyword">new</span> <span class="keyword">int</span>[max / <span class="number">3</span> + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> pi = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">2</span>; m &lt; max ; m ++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!flags[m]) &#123;</span><br><span class="line">        primes[pi++] = m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> n = m; n &lt; max; n += m) &#123;</span><br><span class="line">            flags[n] = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(primes));</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ç¨‹åºæ˜¯ç”¨boolæ•°ç»„æ¥ä½œæ ‡è®°çš„ï¼Œboolå‹æ•°æ®å 1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰ï¼Œå› æ­¤ç”¨ä½æ“ä½œæ¥å‹ç¼©ä¸‹ç©ºé—´å ç”¨å°†ä¼šä½¿ç©ºé—´çš„å ç”¨å‡å°‘å…«åˆ†ä¹‹ä¸ƒã€‚</p>
<p>ä¸‹é¢è€ƒè™‘ä¸‹å¦‚ä½•åœ¨æ•°ç»„ä¸­å¯¹æŒ‡å®šä½ç½®ç½®1ï¼Œå…ˆè€ƒè™‘å¦‚ä½•å¯¹ä¸€ä¸ªæ•´æ•°åœ¨æŒ‡å®šä½ç½®ä¸Šç½®1ã€‚å¯¹äºä¸€ä¸ªæ•´æ•°å¯ä»¥é€šè¿‡å°†1å‘å·¦ç§»ä½åä¸å…¶ç›¸æˆ–æ¥è¾¾åˆ°åœ¨æŒ‡å®šä½ä¸Šç½®1çš„æ•ˆæœï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸€ä¸ªæ•°æŒ‡å®šä½ä¸Šç½®1</span></span><br><span class="line"><span class="keyword">int</span> e = <span class="number">0</span>;</span><br><span class="line">e |= Â <span class="number">1</span> &lt;&lt; <span class="number">10</span>;</span><br><span class="line">System.out.println(e);</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œå¯ä»¥1å‘å·¦ç§»ä½åä¸åŸæ•°ç›¸ä¸æ¥åˆ¤æ–­æŒ‡å®šä½ä¸Šæ˜¯0è¿˜æ˜¯1ï¼ˆä¹Ÿå¯ä»¥å°†åŸæ•°å³ç§»è‹¥å¹²ä½å†ä¸1ç›¸ä¸ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åˆ¤æ–­æŒ‡å®šä½ä¸Šæ˜¯0è¿˜æ˜¯1</span></span><br><span class="line"><span class="keyword">if</span> ((e &amp; (<span class="number">1</span> &lt;&lt; <span class="number">10</span>)) != <span class="number">0</span>)</span><br><span class="line">    System.out.println(<span class="string">&quot;æŒ‡å®šä½ä¸Šä¸º1&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æŒ‡å®šä½ä¸Šä¸º0&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>æ‰©å±•åˆ°æ•°ç»„ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºæ•°ç»„åœ¨å†…å­˜ä¸Šä¹Ÿæ˜¯è¿ç»­åˆ†é…çš„ä¸€æ®µç©ºé—´ï¼Œå®Œå…¨å¯ä»¥â€œè®¤ä¸ºâ€æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ•´æ•°ã€‚å…ˆå†™ä¸€ä»½æµ‹è¯•ä»£ç ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨æ•°ç»„ä¸­ä½¿ç”¨ä½æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] bits = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">40</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; <span class="number">40</span>; m += <span class="number">3</span>) &#123;</span><br><span class="line">    bits[m / <span class="number">32</span>] |= (<span class="number">1</span> &lt;&lt; (m % <span class="number">32</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºæ•´ä¸ªbits</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">0</span>; m &lt; <span class="number">40</span>; m++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (((bits[m / <span class="number">32</span>] &gt;&gt; (m % <span class="number">32</span>)) &amp; <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">        System.out.print(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        System.out.print(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1001001001001001001001001001001001001001</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºè¯¥æ•°ç»„æ¯3ä¸ªå°±ç½®æˆäº†1ï¼Œè¯æ˜æˆ‘ä»¬ä¸Šé¢å¯¹æ•°ç»„è¿›è¡Œä½æ“ä½œçš„æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚å› æ­¤å¯ä»¥å°†ä¸Šé¢ç­›ç´ æ•°æ–¹æ³•æ”¹æˆä½¿ç”¨ä½æ“ä½œå‹ç¼©åçš„ç­›ç´ æ•°æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span>[] flags2 = <span class="keyword">new</span> <span class="keyword">int</span>[max / <span class="number">32</span> + <span class="number">1</span>];</span><br><span class="line">pi = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> m = <span class="number">2</span>; m &lt; max ; m ++) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((((flags2[m / <span class="number">32</span>] &gt;&gt; (m % <span class="number">32</span>)) &amp; <span class="number">1</span>) == <span class="number">0</span>)) &#123;</span><br><span class="line">        primes[pi++] = m;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> n = m; n &lt; max; n += m) &#123;</span><br><span class="line">            flags2[n / <span class="number">32</span>] |= (<span class="number">1</span> &lt;&lt; (n % <span class="number">32</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(Arrays.toString(primes));</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>, <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h2 id="ä½æ“ä½œå·¥å…·ç±»"><a href="#ä½æ“ä½œå·¥å…·ç±»" class="headerlink" title="ä½æ“ä½œå·¥å…·ç±»"></a>ä½æ“ä½œå·¥å…·ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.bit;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Java ä½è¿ç®—çš„å¸¸ç”¨æ–¹æ³•å°è£…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitUtils</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¿ç®—æ•°æŒ‡å®šä½ç½®çš„å€¼</span></span><br><span class="line"><span class="comment">     * ä¾‹å¦‚ï¼š 0000 1011 è·å–å…¶ç¬¬ 0 ä½çš„å€¼ä¸º 1, ç¬¬ 2 ä½ çš„å€¼ä¸º 0</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     *            éœ€è¦è¿ç®—çš„æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pos</span></span><br><span class="line"><span class="comment">     *            æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æŒ‡å®šä½ç½®çš„å€¼(0 or 1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">getBitValue</span><span class="params">(<span class="keyword">byte</span> source, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">byte</span>) ((source &gt;&gt; pos) &amp; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†è¿ç®—æ•°æŒ‡å®šä½ç½®çš„å€¼ç½®ä¸ºæŒ‡å®šå€¼</span></span><br><span class="line"><span class="comment">     * ä¾‹: 0000 1011 éœ€è¦æ›´æ–°ä¸º 0000 1111, å³ç¬¬ 2 ä½çš„å€¼éœ€è¦ç½®ä¸º 1</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     *            éœ€è¦è¿ç®—çš„æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pos</span></span><br><span class="line"><span class="comment">     *            æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     *            åªèƒ½å–å€¼ä¸º 0, æˆ– 1, æ‰€æœ‰å¤§äº0çš„å€¼ä½œä¸º1å¤„ç†, æ‰€æœ‰å°äº0çš„å€¼ä½œä¸º0å¤„ç†</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿ç®—åçš„ç»“æœæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">setBitValue</span><span class="params">(<span class="keyword">byte</span> source, <span class="keyword">int</span> pos, <span class="keyword">byte</span> value)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">byte</span> mask = (<span class="keyword">byte</span>) (<span class="number">1</span> &lt;&lt; pos);</span><br><span class="line">        <span class="keyword">if</span> (value &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            source |= mask;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            source &amp;= (~mask);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†è¿ç®—æ•°æŒ‡å®šä½ç½®å–åå€¼</span></span><br><span class="line"><span class="comment">     * ä¾‹ï¼š 0000 1011 æŒ‡å®šç¬¬ 3 ä½å–å, ç»“æœä¸º 0000 0011; æŒ‡å®šç¬¬2ä½å–å, ç»“æœä¸º 0000 1111</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pos</span></span><br><span class="line"><span class="comment">     *            æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7)</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿ç®—åçš„ç»“æœæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="title">reverseBitValue</span><span class="params">(<span class="keyword">byte</span> source, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> mask = (<span class="keyword">byte</span>) (<span class="number">1</span> &lt;&lt; pos);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">byte</span>) (source ^ mask);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥è¿ç®—æ•°çš„æŒ‡å®šä½ç½®æ˜¯å¦ä¸º1</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source</span></span><br><span class="line"><span class="comment">     *            éœ€è¦è¿ç®—çš„æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pos</span></span><br><span class="line"><span class="comment">     *            æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true è¡¨ç¤ºæŒ‡å®šä½ç½®å€¼ä¸º1, false è¡¨ç¤ºæŒ‡å®šä½ç½®å€¼ä¸º 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">checkBitValue</span><span class="params">(<span class="keyword">byte</span> source, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        source = (<span class="keyword">byte</span>) (source &gt;&gt;&gt; pos);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> (source &amp; <span class="number">1</span>) == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…¥å£å‡½æ•°åšæµ‹è¯•</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å–åè¿›åˆ¶ 11 (äºŒçº§åˆ¶ 0000 1011) ä¸ºä¾‹å­</span></span><br><span class="line">        <span class="keyword">byte</span> source = <span class="number">11</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å–ç¬¬2ä½å€¼å¹¶è¾“å‡º, ç»“æœåº”ä¸º 0000 1011</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> i = <span class="number">7</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            System.out.printf(<span class="string">&quot;%d &quot;</span>, getBitValue(source, i));</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å°†ç¬¬6ä½ç½®ä¸º1å¹¶è¾“å‡º , ç»“æœä¸º 75 (0100 1011)</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n&quot;</span> + setBitValue(source, <span class="number">6</span>, (<span class="keyword">byte</span>) <span class="number">1</span>));</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// å°†ç¬¬6ä½å–åå¹¶è¾“å‡º, ç»“æœåº”ä¸º75(0100 1011)</span></span><br><span class="line">        System.out.println(reverseBitValue(source, <span class="number">6</span>));</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// æ£€æŸ¥ç¬¬6ä½æ˜¯å¦ä¸º1ï¼Œç»“æœåº”ä¸ºfalse</span></span><br><span class="line">        System.out.println(checkBitValue(source, <span class="number">6</span>));</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// è¾“å‡ºä¸º1çš„ä½, ç»“æœåº”ä¸º 0 1 3</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (checkBitValue(source, i)) &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;%d &quot;</span>, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="BitSetç±»"><a href="#BitSetç±»" class="headerlink" title="BitSetç±»"></a>BitSetç±»</h2><p>BitSetç±»ï¼šå¤§å°å¯åŠ¨æ€æ”¹å˜, å–å€¼ä¸ºtrueæˆ–falseçš„ä½é›†åˆã€‚ç”¨äºè¡¨ç¤ºä¸€ç»„å¸ƒå°”æ ‡å¿—ã€‚ æ­¤ç±»å®ç°äº†ä¸€ä¸ªæŒ‰éœ€å¢é•¿çš„ä½å‘é‡ã€‚ä½ set çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ª boolean å€¼ã€‚ç”¨éè´Ÿçš„æ•´æ•°å°† BitSet çš„ä½ç¼–å…¥ç´¢å¼•ã€‚å¯ä»¥å¯¹æ¯ä¸ªç¼–å…¥ç´¢å¼•çš„ä½è¿›è¡Œæµ‹è¯•ã€è®¾ç½®æˆ–è€…æ¸…é™¤ã€‚é€šè¿‡é€»è¾‘ä¸ã€é€»è¾‘æˆ–å’Œé€»è¾‘å¼‚æˆ–æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª BitSet ä¿®æ”¹å¦ä¸€ä¸ª BitSet çš„å†…å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œset ä¸­æ‰€æœ‰ä½çš„åˆå§‹å€¼éƒ½æ˜¯ falseã€‚</p>
<p>æ¯ä¸ªä½ set éƒ½æœ‰ä¸€ä¸ªå½“å‰å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯¥ä½ set å½“å‰æ‰€ç”¨ç©ºé—´çš„ä½æ•°ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå¤§å°ä¸ä½ set çš„å®ç°æœ‰å…³ï¼Œæ‰€ä»¥å®ƒå¯èƒ½éšå®ç°çš„ä¸åŒè€Œæ›´æ”¹ã€‚ä½ set çš„é•¿åº¦ä¸ä½ set çš„é€»è¾‘é•¿åº¦æœ‰å…³ï¼Œå¹¶ä¸”æ˜¯ä¸å®ç°æ— å…³è€Œå®šä¹‰çš„ã€‚</p>
<p>é™¤éå¦è¡Œè¯´æ˜ï¼Œå¦åˆ™å°† null å‚æ•°ä¼ é€’ç»™ BitSet ä¸­çš„ä»»ä½•æ–¹æ³•éƒ½å°†å¯¼è‡´ NullPointerExceptionã€‚ åœ¨æ²¡æœ‰å¤–éƒ¨åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ª BitSet æ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p>æ„é€ å‡½æ•°: BitSet() or BitSet(int nbits)ï¼Œé»˜è®¤åˆå§‹å¤§å°ä¸º64ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> pos)</span>: ä½ç½®posçš„å­—ä½è®¾ç½®ä¸º<span class="keyword">true</span>ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">int</span> bitIndex, <span class="keyword">boolean</span> value)</span>: å°†æŒ‡å®šç´¢å¼•å¤„çš„ä½è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> pos)</span>: ä½ç½®posçš„å­—ä½è®¾ç½®ä¸º<span class="keyword">false</span>ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span>: å°†æ­¤ BitSet ä¸­çš„æ‰€æœ‰ä½è®¾ç½®ä¸º <span class="keyword">false</span>ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">cardinality</span><span class="params">()</span>: è¿”å›æ­¤ BitSet ä¸­è®¾ç½®ä¸º <span class="keyword">true</span> çš„ä½æ•°ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> pos)</span>: è¿”å›ä½ç½®æ˜¯posçš„å­—ä½å€¼ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">and</span><span class="params">(BitSet other)</span>: otheråŒè¯¥å­—ä½é›†è¿›è¡Œä¸æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">or</span><span class="params">(BitSet other)</span>: otheråŒè¯¥å­—ä½é›†è¿›è¡Œæˆ–æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">xor</span><span class="params">(BitSet other)</span>: otheråŒè¯¥å­—ä½é›†è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">andNot</span><span class="params">(BitSet set)</span>: æ¸…é™¤æ­¤ BitSet ä¸­æ‰€æœ‰çš„ä½,set â€“ ç”¨æ¥å±è”½æ­¤ BitSet çš„ BitSet</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span>: è¿”å›æ­¤ BitSet è¡¨ç¤ºä½å€¼æ—¶å®é™…ä½¿ç”¨ç©ºé—´çš„ä½æ•°ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span>: è¿”å›æ­¤ BitSet çš„â€œé€»è¾‘å¤§å°â€ï¼šBitSet ä¸­æœ€é«˜è®¾ç½®ä½çš„ç´¢å¼•åŠ  1ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span>: è¿”å›è¯¥é›†åˆHash ç ï¼Œ è¿™ä¸ªç åŒé›†åˆä¸­çš„å­—ä½å€¼æœ‰å…³ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object other)</span>: å¦‚æœotherä¸­çš„å­—ä½åŒé›†åˆä¸­çš„å­—ä½ç›¸åŒï¼Œè¿”å›<span class="keyword">true</span>ã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span>: å…‹éš†æ­¤ BitSetï¼Œç”Ÿæˆä¸€ä¸ªä¸ä¹‹ç›¸ç­‰çš„æ–° BitSetã€‚</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span>: è¿”å›æ­¤ä½ set çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä¾‹1ï¼šæ ‡æ˜ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ç”¨äº†å“ªäº›å­—ç¬¦</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.bit;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WhichChars</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BitSet used = <span class="keyword">new</span> BitSet();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WhichChars</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++)</span><br><span class="line">            used.set(str.charAt(i));  <span class="comment">// set bit for char</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String desc = <span class="string">&quot;[&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> size = used.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (used.get(i))</span><br><span class="line">                desc += (<span class="keyword">char</span>) i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> desc + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        WhichChars w = <span class="keyword">new</span> WhichChars(<span class="string">&quot;How do you do&quot;</span>);</span><br><span class="line">        System.out.println(w);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹2ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.bit;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainTestThree</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BitSet bm = <span class="keyword">new</span> BitSet();</span><br><span class="line">        System.out.println(bm.isEmpty() + <span class="string">&quot;--&quot;</span> + bm.size());</span><br><span class="line">        bm.set(<span class="number">0</span>);</span><br><span class="line">        System.out.println(bm.isEmpty() + <span class="string">&quot;--&quot;</span> + bm.size());</span><br><span class="line">        bm.set(<span class="number">1</span>);</span><br><span class="line">        System.out.println(bm.isEmpty() + <span class="string">&quot;--&quot;</span> + bm.size());</span><br><span class="line">        System.out.println(bm.get(<span class="number">65</span>));</span><br><span class="line">        System.out.println(bm.isEmpty() + <span class="string">&quot;--&quot;</span> + bm.size());</span><br><span class="line">        bm.set(<span class="number">65</span>);</span><br><span class="line">        System.out.println(bm.isEmpty() + <span class="string">&quot;--&quot;</span> + bm.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹3ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.king.bit;</span><br><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainTestFour</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BitSet bm1 = <span class="keyword">new</span> BitSet(<span class="number">7</span>);</span><br><span class="line">        System.out.println(bm1.isEmpty() + <span class="string">&quot;--&quot;</span> + bm1.size());</span><br><span class="line"> </span><br><span class="line">        BitSet bm2 = <span class="keyword">new</span> BitSet(<span class="number">63</span>);</span><br><span class="line">        System.out.println(bm2.isEmpty() + <span class="string">&quot;--&quot;</span> + bm2.size());</span><br><span class="line"> </span><br><span class="line">        BitSet bm3 = <span class="keyword">new</span> BitSet(<span class="number">65</span>);</span><br><span class="line">        System.out.println(bm3.isEmpty() + <span class="string">&quot;--&quot;</span> + bm3.size());</span><br><span class="line"> </span><br><span class="line">        BitSet bm4 = <span class="keyword">new</span> BitSet(<span class="number">111</span>);</span><br><span class="line">        System.out.println(bm4.isEmpty() + <span class="string">&quot;--&quot;</span> + bm4.size());</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½æ“ä½œæŠ€å·§"><a href="#ä½æ“ä½œæŠ€å·§" class="headerlink" title="ä½æ“ä½œæŠ€å·§"></a>ä½æ“ä½œæŠ€å·§</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. è·å¾—intå‹æœ€å¤§å€¼</span></span><br><span class="line">System.out.println((<span class="number">1</span> &lt;&lt; <span class="number">31</span>) - <span class="number">1</span>);<span class="comment">// 2147483647ï¼Œ ç”±äºä¼˜å…ˆçº§å…³ç³»ï¼Œæ‹¬å·ä¸å¯çœç•¥</span></span><br><span class="line">System.out.println(~(<span class="number">1</span> &lt;&lt; <span class="number">31</span>));<span class="comment">// 2147483647</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 2. è·å¾—intå‹æœ€å°å€¼</span></span><br><span class="line">System.out.println(<span class="number">1</span> &lt;&lt; <span class="number">31</span>);</span><br><span class="line">System.out.println(<span class="number">1</span> &lt;&lt; -<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 3. è·å¾—longç±»å‹çš„æœ€å¤§å€¼</span></span><br><span class="line">System.out.println(((<span class="keyword">long</span>)<span class="number">1</span> &lt;&lt; <span class="number">127</span>) - <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 4. ä¹˜ä»¥2è¿ç®—</span></span><br><span class="line">System.out.println(<span class="number">10</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 5. é™¤ä»¥2è¿ç®—(è´Ÿå¥‡æ•°çš„è¿ç®—ä¸å¯ç”¨)</span></span><br><span class="line">System.out.println(<span class="number">10</span>&gt;&gt;<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 6. ä¹˜ä»¥2çš„mæ¬¡æ–¹</span></span><br><span class="line">System.out.println(<span class="number">10</span>&lt;&lt;<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 7. é™¤ä»¥2çš„mæ¬¡æ–¹</span></span><br><span class="line">System.out.println(<span class="number">16</span>&gt;&gt;<span class="number">2</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 8. åˆ¤æ–­ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§</span></span><br><span class="line">System.out.println((<span class="number">10</span> &amp; <span class="number">1</span>) == <span class="number">1</span>);</span><br><span class="line">System.out.println((<span class="number">9</span> &amp; <span class="number">1</span>) == <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 9. ä¸ç”¨ä¸´æ—¶å˜é‡äº¤æ¢ä¸¤ä¸ªæ•°ï¼ˆé¢è¯•å¸¸è€ƒï¼‰</span></span><br><span class="line">a ^= b;</span><br><span class="line">b ^= a;</span><br><span class="line">a ^= b;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 10. å–ç»å¯¹å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”n&gt;0 ? n:-n é«˜ï¼‰</span></span><br><span class="line"><span class="keyword">int</span> n = -<span class="number">1</span>;</span><br><span class="line">System.out.println((n ^ (n &gt;&gt; <span class="number">31</span>)) - (n &gt;&gt; <span class="number">31</span>));</span><br><span class="line"><span class="comment">/* n&gt;&gt;31 å–å¾—nçš„ç¬¦å·ï¼Œè‹¥nä¸ºæ­£æ•°ï¼Œn&gt;&gt;31ç­‰äº0ï¼Œè‹¥nä¸ºè´Ÿæ•°ï¼Œn&gt;&gt;31ç­‰äº-1</span></span><br><span class="line"><span class="comment">è‹¥nä¸ºæ­£æ•° n^0-0æ•°ä¸å˜ï¼Œè‹¥nä¸ºè´Ÿæ•°n^-1 éœ€è¦è®¡ç®—nå’Œ-1çš„è¡¥ç ï¼Œå¼‚æˆ–åå†å–è¡¥ç ï¼Œ</span></span><br><span class="line"><span class="comment">ç»“æœnå˜å·å¹¶ä¸”ç»å¯¹å€¼å‡1ï¼Œå†å‡å»-1å°±æ˜¯ç»å¯¹å€¼ */</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 11. å–ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”a&gt;b ? a:bé«˜ï¼‰</span></span><br><span class="line">System.out.println(b&amp;((a-b)&gt;&gt;<span class="number">31</span>) | a&amp;(~(a-b)&gt;&gt;<span class="number">31</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 12. å–ä¸¤ä¸ªæ•°çš„æœ€å°å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”a&gt;b ? b:aé«˜ï¼‰</span></span><br><span class="line">System.out.println(a&amp;((a-b)&gt;&gt;<span class="number">31</span>) | b&amp;(~(a-b)&gt;&gt;<span class="number">31</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 13. åˆ¤æ–­ç¬¦å·æ˜¯å¦ç›¸åŒ(true è¡¨ç¤º xå’Œyæœ‰ç›¸åŒçš„ç¬¦å·ï¼Œ falseè¡¨ç¤ºxï¼Œyæœ‰ç›¸åçš„ç¬¦å·ã€‚)</span></span><br><span class="line">System.out.println((a ^ b) &gt; <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 14. è®¡ç®—2çš„næ¬¡æ–¹ n &gt; 0</span></span><br><span class="line">System.out.println(<span class="number">2</span>&lt;&lt;(n-<span class="number">1</span>));</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 15. åˆ¤æ–­ä¸€ä¸ªæ•°næ˜¯ä¸æ˜¯2çš„å¹‚</span></span><br><span class="line">System.out.println((n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>);</span><br><span class="line"><span class="comment">/*å¦‚æœæ˜¯2çš„å¹‚ï¼Œnä¸€å®šæ˜¯100... n-1å°±æ˜¯1111....</span></span><br><span class="line"><span class="comment">æ‰€ä»¥åšä¸è¿ç®—ç»“æœä¸º0*/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 16. æ±‚ä¸¤ä¸ªæ•´æ•°çš„å¹³å‡å€¼</span></span><br><span class="line">System.out.println((a+b) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 17. ä»ä½ä½åˆ°é«˜ä½,å–nçš„ç¬¬mä½</span></span><br><span class="line"><span class="keyword">int</span> m = <span class="number">2</span>;</span><br><span class="line">System.out.println((n &gt;&gt; (m-<span class="number">1</span>)) &amp; <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 18. ä»ä½ä½åˆ°é«˜ä½.å°†nçš„ç¬¬mä½ç½®ä¸º1</span></span><br><span class="line">System.out.println(n | (<span class="number">1</span>&lt;&lt;(m-<span class="number">1</span>)));</span><br><span class="line"><span class="comment">/*å°†1å·¦ç§»m-1ä½æ‰¾åˆ°ç¬¬mä½ï¼Œå¾—åˆ°000...1...000</span></span><br><span class="line"><span class="comment">nåœ¨å’Œè¿™ä¸ªæ•°åšæˆ–è¿ç®—*/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 19. ä»ä½ä½åˆ°é«˜ä½,å°†nçš„ç¬¬mä½ç½®ä¸º0</span></span><br><span class="line">System.out.println(n &amp; ~(<span class="number">0</span>&lt;&lt;(m-<span class="number">1</span>)));</span><br><span class="line"><span class="comment">/* å°†1å·¦ç§»m-1ä½æ‰¾åˆ°ç¬¬mä½ï¼Œå–ååå˜æˆ111...0...1111</span></span><br><span class="line"><span class="comment">nå†å’Œè¿™ä¸ªæ•°åšä¸è¿ç®—*/</span></span><br></pre></td></tr></table></figure>

<br>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaçº¿ç¨‹æ± </title>
    <url>/wiki/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<h2 id="çº¿ç¨‹æ± ç®€ä»‹"><a href="#çº¿ç¨‹æ± ç®€ä»‹" class="headerlink" title="çº¿ç¨‹æ± ç®€ä»‹"></a>çº¿ç¨‹æ± ç®€ä»‹</h2><p>è™½ç„¶Javaçº¿ç¨‹æ± ç†è®ºï¼Œä»¥åŠæ„é€ çº¿ç¨‹æ± çš„å„ç§å‚æ•°ï¼Œä»¥åŠ Executors æä¾›çš„é»˜è®¤å®ç°ä¹‹å‰ç ”è¯»è¿‡ï¼Œä¸è¿‡çº¿ä¸Šè¿˜æ²¡æœ‰å‘ç”Ÿè¿‡çº¿ç¨‹æ± è¯¯ç”¨å¼•å‘çš„äº‹æ•…ï¼Œæ‰€ä»¥æœ‰å¿…è¦æŠŠè¿™äº›å‚æ•°å†ä»”ç»†ç¢ç£¨ä¸€éã€‚</p>
<p>ä¼˜å…ˆè¡¥å……ä¸€äº›çº¿ç¨‹æ± çš„å·¥ä½œç†è®ºï¼Œæœ‰åŠ©äºå±•å¼€ä¸‹é¢çš„å†…å®¹ã€‚çº¿ç¨‹æ± é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”±å¾ˆå¤šçº¿ç¨‹æ„æˆçš„æ± å­ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå°±ä»æ± å­ä¸­å–ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚è¿™ä¸ªç†è§£æ˜¯æˆ‘åœ¨ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°è¿™ä¸ªæ¦‚å¿µæ—¶å€™çš„ç†è§£ï¼Œè™½ç„¶æ•´ä½“åŸºæœ¬åˆ‡å…¥åˆ°æ ¸å¿ƒï¼Œä½†æ˜¯å®é™…ä¸Šä¼šæ¯”è¿™ä¸ªå¤æ‚ã€‚ä¾‹å¦‚çº¿ç¨‹æ± è‚¯å®šä¸ä¼šæ— é™æ‰©å¤§çš„ï¼Œå¦åˆ™èµ„æºä¼šè€—å°½ï¼›å½“çº¿ç¨‹æ•°åˆ°è¾¾ä¸€ä¸ªé˜¶æ®µï¼Œæäº¤çš„ä»»åŠ¡ä¼šè¢«æš‚æ—¶å­˜å‚¨åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—å†…å®¹å¯ä»¥ä¸æ–­æ‰©å¤§ï¼Œæç«¯ä¸‹ä¹Ÿä¼šè€—å°½èµ„æºï¼Œé‚£é€‰æ‹©ä»€ä¹ˆç±»å‹çš„é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—æ»¡å¦‚ä½•å¤„ç†ä»»åŠ¡ï¼Œéƒ½æœ‰æ¶‰åŠå¾ˆå¤šå†…å®¹ã€‚çº¿ç¨‹æ± æ€»ä½“çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p>+++++++=</p>
<p>çº¿ç¨‹æ± å†…çš„çº¿ç¨‹æ•°çš„å¤§å°ç›¸å…³çš„æ¦‚å¿µæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ ¸å¿ƒæ± å¤§å°ï¼Œè¿˜æœ‰æœ€å¤§æ± å¤§å°ã€‚å¦‚æœå½“å‰çš„çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒæ± ä¸ªæ•°å°ï¼Œå½“ä»»åŠ¡åˆ°æ¥ï¼Œä¼šä¼˜å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡ã€‚å½“å·²ç»åˆ°è¾¾æ ¸å¿ƒæ± å¤§å°ï¼Œåˆ™æŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œä¸ºäº†èµ„æºä¸è¢«è€—å°½ï¼Œé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡å¯èƒ½ä¹Ÿæ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœè¾¾åˆ°é˜Ÿåˆ—ä¸Šé™åˆ™è€ƒè™‘ç»§ç»­åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæ­¤åˆ»çº¿ç¨‹çš„ä¸ªæ•°å·²ç»åˆ°è¾¾æœ€å¤§æ± ä¸Šé™ï¼Œåˆ™è€ƒè™‘æŠŠä»»åŠ¡ä¸¢å¼ƒã€‚</p>
<p>åœ¨ java.util.concurrent åŒ…ä¸­ï¼Œæä¾›äº† ThreadPoolExecutor çš„å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="params"><span class="function">                              TimeUnit unit,</span></span></span><br><span class="line"><span class="params"><span class="function">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="params"><span class="function">                              ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="params"><span class="function">                              RejectedExecutionHandler handler)</span> </span>&#123;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>


<p>æ—¢ç„¶æœ‰äº†åˆšåˆšå¯¹çº¿ç¨‹æ± å·¥ä½œåŸç†å¯¹æ¦‚è¿°ï¼Œè¿™äº›å‚æ•°å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼š</p>
<h3 id="corePoolSize"><a href="#corePoolSize" class="headerlink" title="corePoolSize"></a>corePoolSize</h3><p> æ ¸å¿ƒæ± å¤§å°ï¼Œæ—¢ç„¶å¦‚å‰åŸç†éƒ¨åˆ†æ‰€è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨åˆåˆ›å»ºçº¿ç¨‹æ± æ—¶çº¿ç¨‹ä¸ä¼šç«‹å³å¯åŠ¨ï¼Œç›´åˆ°æœ‰ä»»åŠ¡æäº¤æ‰å¼€å§‹å¯åŠ¨çº¿ç¨‹å¹¶é€æ¸æ—¶çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeã€‚è‹¥æƒ³ä¸€å¼€å§‹å°±åˆ›å»ºæ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹éœ€è°ƒç”¨prestartAllCoreThreadsæ–¹æ³•ã€‚</p>
<h3 id="maximumPoolSize"><a href="#maximumPoolSize" class="headerlink" title="maximumPoolSize"></a>maximumPoolSize</h3><p>æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“æ ¸å¿ƒçº¿ç¨‹æ»¡ä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿæ»¡æ—¶æ‰ä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶å†³å®šæ˜¯å¦åˆ›å»ºæ–°çº¿ç¨‹ã€‚</p>
<h3 id="keepAliveTime"><a href="#keepAliveTime" class="headerlink" title="keepAliveTime"></a>keepAliveTime</h3><p>å½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œå¤šäºçš„ç©ºé—²çº¿ç¨‹æœ€å¤šå­˜æ´»æ—¶é—´</p>
<h3 id="unit"><a href="#unit" class="headerlink" title="unit"></a>unit</h3><p>keepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚</p>
<h3 id="workQueue"><a href="#workQueue" class="headerlink" title="workQueue"></a>workQueue</h3><p>å½“çº¿ç¨‹æ•°ç›®è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚ä¸»è¦æœ‰3ç§ç±»å‹çš„BlockingQueueå¯ä¾›é€‰æ‹©ï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œæœ‰ç•Œé˜Ÿåˆ—å’ŒåŒæ­¥ç§»äº¤ã€‚å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†é˜è¿°ã€‚ä»å‚æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ­¤é˜Ÿåˆ—ä»…ä¿å­˜å®ç°Runnableæ¥å£çš„ä»»åŠ¡ã€‚ åˆ«çœ‹è¿™ä¸ªå‚æ•°ä½ç½®å¾ˆé åï¼Œä½†æ˜¯çœŸçš„å¾ˆé‡è¦ï¼Œå› ä¸ºæ¥¼ä¸»çš„å‘å°±å› è¿™ä¸ªå‚æ•°è€Œèµ·ï¼Œè¿™äº›ç»†èŠ‚æœ‰å¿…è¦ä»”ç»†äº†è§£æ¸…æ¥šã€‚</p>
<h3 id="threadFactory"><a href="#threadFactory" class="headerlink" title="threadFactory"></a>threadFactory</h3><p>æ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ã€‚</p>
<h3 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h3><p>é˜»å¡é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æ—¶æ‰€é‡‡å–çš„é¥±å’Œç­–ç•¥ã€‚javaé»˜è®¤æä¾›äº†4ç§é¥±å’Œç­–ç•¥çš„å®ç°æ–¹å¼ï¼šä¸­æ­¢ã€æŠ›å¼ƒã€æŠ›å¼ƒæœ€æ—§çš„ã€è°ƒç”¨è€…è¿è¡Œã€‚å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†é˜è¿°ã€‚</p>
<h2 id="å¯é€‰æ‹©çš„é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£"><a href="#å¯é€‰æ‹©çš„é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£" class="headerlink" title="å¯é€‰æ‹©çš„é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£"></a>å¯é€‰æ‹©çš„é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£</h2><p>åœ¨é‡å¤ä¸€ä¸‹æ–°ä»»åŠ¡è¿›å…¥æ—¶çº¿ç¨‹æ± çš„æ‰§è¡Œç­–ç•¥ï¼š<br>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰æ·»åŠ æ–°çš„çº¿ç¨‹ï¼Œè€Œä¸è¿›è¡Œæ’é˜Ÿã€‚ï¼ˆå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°äºcorePoolSizeï¼Œåˆ™ä»»åŠ¡æ ¹æœ¬ä¸ä¼šå­˜å…¥queueä¸­ï¼Œè€Œæ˜¯ç›´æ¥è¿è¡Œï¼‰<br>å¦‚æœè¿è¡Œçš„çº¿ç¨‹å¤§äºç­‰äº corePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚<br>å¦‚æœæ— æ³•å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé™¤éåˆ›å»ºæ­¤çº¿ç¨‹è¶…å‡º maximumPoolSizeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ã€‚<br>ä¸»è¦æœ‰3ç§ç±»å‹çš„BlockingQueueï¼š</p>
<h3 id="æ— ç•Œé˜Ÿåˆ—"><a href="#æ— ç•Œé˜Ÿåˆ—" class="headerlink" title="æ— ç•Œé˜Ÿåˆ—"></a>æ— ç•Œé˜Ÿåˆ—</h3><p>é˜Ÿåˆ—å¤§å°æ— é™åˆ¶ï¼Œå¸¸ç”¨çš„ä¸ºæ— ç•Œçš„LinkedBlockingQueueï¼Œä½¿ç”¨è¯¥é˜Ÿåˆ—åšä¸ºé˜»å¡é˜Ÿåˆ—æ—¶è¦å°¤å…¶å½“å¿ƒï¼Œå½“ä»»åŠ¡è€—æ—¶è¾ƒé•¿æ—¶å¯èƒ½ä¼šå¯¼è‡´å¤§é‡æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯æœ€ç»ˆå¯¼è‡´OOMã€‚é˜…è¯»ä»£ç å‘ç°ï¼ŒExecutors.newFixedThreadPool é‡‡ç”¨å°±æ˜¯ LinkedBlockingQueueï¼Œè€Œæ¥¼ä¸»è¸©åˆ°çš„å°±æ˜¯è¿™ä¸ªå‘ï¼Œå½“QPSå¾ˆé«˜ï¼Œå‘é€æ•°æ®å¾ˆå¤§ï¼Œå¤§é‡çš„ä»»åŠ¡è¢«æ·»åŠ åˆ°è¿™ä¸ªæ— ç•ŒLinkedBlockingQueue ä¸­ï¼Œå¯¼è‡´cpuå’Œå†…å­˜é£™å‡æœåŠ¡å™¨æŒ‚æ‰ã€‚</p>
<h3 id="æœ‰ç•Œé˜Ÿåˆ—"><a href="#æœ‰ç•Œé˜Ÿåˆ—" class="headerlink" title="æœ‰ç•Œé˜Ÿåˆ—"></a>æœ‰ç•Œé˜Ÿåˆ—</h3><p>å¸¸ç”¨çš„æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯éµå¾ªFIFOåŸåˆ™çš„é˜Ÿåˆ—å¦‚ArrayBlockingQueueä¸æœ‰ç•Œçš„LinkedBlockingQueueï¼Œå¦ä¸€ç±»æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚PriorityBlockingQueueã€‚PriorityBlockingQueueä¸­çš„ä¼˜å…ˆçº§ç”±ä»»åŠ¡çš„Comparatorå†³å®šã€‚<br>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—æ—¶é˜Ÿåˆ—å¤§å°éœ€å’Œçº¿ç¨‹æ± å¤§å°äº’ç›¸é…åˆï¼Œçº¿ç¨‹æ± è¾ƒå°æœ‰ç•Œé˜Ÿåˆ—è¾ƒå¤§æ—¶å¯å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œé™ä½cpuä½¿ç”¨ç‡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯å¯èƒ½ä¼šé™åˆ¶ç³»ç»Ÿååé‡ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¿®å¤æ–¹æ¡ˆä¸­ï¼Œé€‰æ‹©çš„å°±æ˜¯è¿™ä¸ªç±»å‹çš„é˜Ÿåˆ—ï¼Œè™½ç„¶ä¼šæœ‰éƒ¨åˆ†ä»»åŠ¡è¢«ä¸¢å¤±ï¼Œä½†æ˜¯æˆ‘ä»¬çº¿ä¸Šæ˜¯æ’åºæ—¥å¿—æœé›†ä»»åŠ¡ï¼Œæ‰€ä»¥å¯¹éƒ¨åˆ†å¯¹ä¸¢å¤±æ˜¯å¯ä»¥å®¹å¿çš„ã€‚</p>
<h3 id="åŒæ­¥ç§»äº¤é˜Ÿåˆ—"><a href="#åŒæ­¥ç§»äº¤é˜Ÿåˆ—" class="headerlink" title="åŒæ­¥ç§»äº¤é˜Ÿåˆ—"></a>åŒæ­¥ç§»äº¤é˜Ÿåˆ—</h3><p>å¦‚æœä¸å¸Œæœ›ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è€Œæ˜¯å¸Œæœ›å°†ä»»åŠ¡ç›´æ¥ç§»äº¤ç»™å·¥ä½œçº¿ç¨‹ï¼Œå¯ä½¿ç”¨SynchronousQueueä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚SynchronousQueueä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯ä¸€ç§çº¿ç¨‹ä¹‹é—´ç§»äº¤çš„æœºåˆ¶ã€‚è¦å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥SynchronousQueueä¸­ï¼Œå¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥æ”¶è¿™ä¸ªå…ƒç´ ã€‚åªæœ‰åœ¨ä½¿ç”¨æ— ç•Œçº¿ç¨‹æ± æˆ–è€…æœ‰é¥±å’Œç­–ç•¥æ—¶æ‰å»ºè®®ä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚</p>
<h2 id="å¯é€‰æ‹©çš„é¥±å’Œç­–ç•¥RejectedExecutionHandlerè¯¦è§£"><a href="#å¯é€‰æ‹©çš„é¥±å’Œç­–ç•¥RejectedExecutionHandlerè¯¦è§£" class="headerlink" title="å¯é€‰æ‹©çš„é¥±å’Œç­–ç•¥RejectedExecutionHandlerè¯¦è§£"></a>å¯é€‰æ‹©çš„é¥±å’Œç­–ç•¥RejectedExecutionHandlerè¯¦è§£</h2><p>JDKä¸»è¦æä¾›äº†4ç§é¥±å’Œç­–ç•¥ä¾›é€‰æ‹©ã€‚4ç§ç­–ç•¥éƒ½åšä¸ºé™æ€å†…éƒ¨ç±»åœ¨ThreadPoolExcutorä¸­è¿›è¡Œå®ç°ã€‚</p>
<h3 id="AbortPolicyä¸­æ­¢ç­–ç•¥"><a href="#AbortPolicyä¸­æ­¢ç­–ç•¥" class="headerlink" title="AbortPolicyä¸­æ­¢ç­–ç•¥"></a>AbortPolicyä¸­æ­¢ç­–ç•¥</h3><p>è¯¥ç­–ç•¥æ˜¯é»˜è®¤é¥±å’Œç­–ç•¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RejectedExecutionException(<span class="string">&quot;Task &quot;</span> + r.toString() +</span><br><span class="line">                                                 <span class="string">&quot; rejected from &quot;</span> +</span><br><span class="line">                                                 e.toString());</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è¯¥ç­–ç•¥æ—¶åœ¨é¥±å’Œæ—¶ä¼šæŠ›å‡ºRejectedExecutionExceptionï¼ˆç»§æ‰¿è‡ªRuntimeExceptionï¼‰ï¼Œè°ƒç”¨è€…å¯æ•è·è¯¥å¼‚å¸¸è‡ªè¡Œå¤„ç†ã€‚</p>
<h3 id="DiscardPolicyæŠ›å¼ƒç­–ç•¥"><a href="#DiscardPolicyæŠ›å¼ƒç­–ç•¥" class="headerlink" title="DiscardPolicyæŠ›å¼ƒç­–ç•¥"></a>DiscardPolicyæŠ›å¼ƒç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œä»€ä¹ˆéƒ½ä¸åšã€‚</p>
<h3 id="DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥"><a href="#DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥" class="headerlink" title="DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥"></a>DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                e.getQueue().poll();</span><br><span class="line">                e.execute(r);</span><br><span class="line">            &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>å¦‚ä»£ç ï¼Œå…ˆå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ å‡ºé˜ŸæŠ›å¼ƒï¼Œå†å°è¯•æäº¤ä»»åŠ¡ã€‚å¦‚æœæ­¤æ—¶é˜»å¡é˜Ÿåˆ—ä½¿ç”¨PriorityBlockingQueueä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå°†ä¼šå¯¼è‡´ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡è¢«æŠ›å¼ƒï¼Œå› æ­¤ä¸å»ºè®®å°†è¯¥ç§ç­–ç•¥é…åˆä¼˜å…ˆçº§é˜Ÿåˆ—ä½¿ç”¨ã€‚</p>
<h3 id="CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œ"><a href="#CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œ" class="headerlink" title="CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œ"></a>CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!e.isShutdown()) &#123;</span><br><span class="line">                r.run();</span><br><span class="line">            &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>æ—¢ä¸æŠ›å¼ƒä»»åŠ¡ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è¿è¡Œä»»åŠ¡çš„runæ–¹æ³•ï¼Œæ¢è¨€ä¹‹å°†ä»»åŠ¡å›é€€ç»™è°ƒç”¨è€…æ¥ç›´æ¥è¿è¡Œã€‚ä½¿ç”¨è¯¥ç­–ç•¥æ—¶çº¿ç¨‹æ± é¥±å’Œåå°†ç”±è°ƒç”¨çº¿ç¨‹æ± çš„ä¸»çº¿ç¨‹è‡ªå·±æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå› æ­¤åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿™æ®µæ—¶é—´é‡Œä¸»çº¿ç¨‹æ— æ³•å†æäº¤æ–°ä»»åŠ¡ï¼Œä»è€Œä½¿çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æœ‰æ—¶é—´å°†æ­£åœ¨å¤„ç†çš„ä»»åŠ¡å¤„ç†å®Œæˆã€‚</p>
<h2 id="Javaæä¾›çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ± è§£æ"><a href="#Javaæä¾›çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ± è§£æ" class="headerlink" title="Javaæä¾›çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ± è§£æ"></a>Javaæä¾›çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ± è§£æ</h2><p>æ—¢ç„¶æ¥¼ä¸»è¸©å‘å°±æ˜¯ä½¿ç”¨äº† JDK çš„é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆå†æ¥çœ‹çœ‹è¿™äº›é»˜è®¤å®ç°åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œå°è£…äº†å“ªäº›å‚æ•°ã€‚ç®€è€Œè¨€ä¹‹ Executors å·¥å‚æ–¹æ³•Executors.newCachedThreadPool() æä¾›äº†æ— ç•Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶ï¼›Executors.newFixedThreadPool(int) æä¾›äº†å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œå†…éƒ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼›Executors.newSingleThreadExecutor() æä¾›äº†å•ä¸ªåå°çº¿ç¨‹ã€‚</p>
<p>è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä¸Šè¿°å››ç§çº¿ç¨‹æ± ã€‚</p>
<h3 id="newCachedThreadPool"><a href="#newCachedThreadPool" class="headerlink" title="newCachedThreadPool"></a>newCachedThreadPool</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                      <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>åœ¨newCachedThreadPoolä¸­å¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚<br>åˆçœ‹è¯¥æ„é€ å‡½æ•°æ—¶æˆ‘æœ‰è¿™æ ·çš„ç–‘æƒ‘ï¼šæ ¸å¿ƒçº¿ç¨‹æ± ä¸º0ï¼Œé‚£æŒ‰ç…§å‰é¢æ‰€è®²çš„çº¿ç¨‹æ± ç­–ç•¥æ–°ä»»åŠ¡æ¥ä¸´æ—¶æ— æ³•è¿›å…¥æ ¸å¿ƒçº¿ç¨‹æ± ï¼Œåªèƒ½è¿›å…¥ SynchronousQueueä¸­è¿›è¡Œç­‰å¾…ï¼Œè€ŒSynchronousQueueçš„å¤§å°ä¸º1ï¼Œé‚£å²‚ä¸æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡åˆ°è¾¾æ—¶åªèƒ½ç­‰å¾…åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ç¬¬äºŒä¸ªä»»åŠ¡åˆ°è¾¾å‘ç°æ— æ³•è¿›å…¥é˜Ÿåˆ—æ‰èƒ½åˆ›å»ºç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ<br>è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåœ¨ä¸Šé¢è®²SynchronousQueueæ—¶å…¶å®å·²ç»ç»™å‡ºäº†ï¼Œè¦å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥SynchronousQueueä¸­ï¼Œå¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥æ”¶è¿™ä¸ªå…ƒç´ ã€‚å› æ­¤å³ä¾¿SynchronousQueueä¸€å¼€å§‹ä¸ºç©ºä¸”å¤§å°ä¸º1ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡ä¹Ÿæ— æ³•æ”¾å…¥å…¶ä¸­ï¼Œå› ä¸ºæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ä»SynchronousQueueä¸­å–èµ°å…ƒç´ ã€‚å› æ­¤ç¬¬ä¸€ä¸ªä»»åŠ¡åˆ°è¾¾æ—¶ä¾¿ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</p>
<h3 id="newFixedThreadPool"><a href="#newFixedThreadPool" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                     <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                     <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹ä»£ç ä¸€ç›®äº†ç„¶äº†ï¼Œçº¿ç¨‹æ•°é‡å›ºå®šï¼Œä½¿ç”¨æ— é™å¤§çš„é˜Ÿåˆ—ã€‚å†æ¬¡å¼ºè°ƒï¼Œæ¥¼ä¸»å°±æ˜¯è¸©çš„è¿™ä¸ªæ— é™å¤§é˜Ÿåˆ—çš„å‘ã€‚</p>
<p>4.3 newScheduledThreadPool<br>åˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¥çœ‹çœ‹ScheduledThreadPoolExecutorï¼ˆï¼‰çš„æ„é€ å‡½æ•°</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="number">0</span>, NANOSECONDS,</span><br><span class="line">             <span class="keyword">new</span> DelayedWorkQueue());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ScheduledThreadPoolExecutorçš„çˆ¶ç±»å³ThreadPoolExecutorï¼Œå› æ­¤è¿™é‡Œå„å‚æ•°å«ä¹‰å’Œä¸Šé¢ä¸€æ ·ã€‚å€¼å¾—å…³å¿ƒçš„æ˜¯DelayedWorkQueueè¿™ä¸ªé˜»å¡å¯¹åˆ—ï¼Œåœ¨ä¸Šé¢æ²¡æœ‰ä»‹ç»ï¼Œå®ƒä½œä¸ºé™æ€å†…éƒ¨ç±»å°±åœ¨ScheduledThreadPoolExecutorä¸­è¿›è¡Œäº†å®ç°ã€‚ç®€å•çš„è¯´ï¼ŒDelayedWorkQueueæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œå®ƒèƒ½æŒ‰ä¸€å®šçš„é¡ºåºå¯¹å·¥ä½œé˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œæ’åˆ—ã€‚</p>
<h3 id="newSingleThreadExecutor"><a href="#newSingleThreadExecutor" class="headerlink" title="newSingleThreadExecutor"></a>newSingleThreadExecutor</h3><p>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newSingleThreadScheduledExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DelegatedScheduledExecutorService</span><br><span class="line">            (<span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">1</span>));</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆnewäº†ä¸€ä¸ªçº¿ç¨‹æ•°ç›®ä¸º 1 çš„ScheduledThreadPoolExecutorï¼Œå†æŠŠè¯¥å¯¹è±¡ä¼ å…¥DelegatedScheduledExecutorServiceä¸­ï¼Œçœ‹çœ‹DelegatedScheduledExecutorServiceçš„å®ç°ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DelegatedScheduledExecutorService(ScheduledExecutorService executor) &#123;</span><br><span class="line">            <span class="keyword">super</span>(executor);</span><br><span class="line">            e = executor;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>åœ¨çœ‹çœ‹å®ƒçš„çˆ¶ç±»</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DelegatedExecutorService(ExecutorService executor) &#123; </span><br><span class="line">           e = executor; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®å°±æ˜¯ä½¿ç”¨è£…é¥°æ¨¡å¼å¢å¼ºäº†ScheduledExecutorServiceï¼ˆ1ï¼‰çš„åŠŸèƒ½ï¼Œä¸ä»…ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹é¡ºåºæ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿä¿è¯çº¿ç¨‹æ„å¤–ç»ˆæ­¢åä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆç¦æ­¢ä½¿ç”¨-Executors-åˆ›å»ºçº¿ç¨‹æ± "><a href="#ä¸ºä»€ä¹ˆç¦æ­¢ä½¿ç”¨-Executors-åˆ›å»ºçº¿ç¨‹æ± " class="headerlink" title="ä¸ºä»€ä¹ˆç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ?"></a>ä¸ºä»€ä¹ˆç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ?</h2><img src='https://oscimg.oschina.net/oscnet/up-9d0200e116259f64c5485a1bbf0d4265c31.png'>

<h3 id="å®éªŒè¯æ˜Executorsç¼ºé™·"><a href="#å®éªŒè¯æ˜Executorsç¼ºé™·" class="headerlink" title="å®éªŒè¯æ˜Executorsç¼ºé™·"></a>å®éªŒè¯æ˜Executorsç¼ºé™·</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorsDemo</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="number">15</span>);</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">               executor.execute(<span class="keyword">new</span> SubThread());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">SubThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">       <span class="comment">//do nothing &#125;</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æŒ‡å®šJVMå‚æ•°:-Xmx8m -Xms8mè¿è¡Œä»¥ä¸Šä»£ç ï¼Œä¼šæŠ›å‡ºOOM:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.OutOfMemoryError: GC overhead limit exceeded</span><br><span class="line">at java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue. java:<span class="number">416</span>)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor. java:<span class="number">1371</span>)</span><br><span class="line">at com.hollis.ExecutorsDemo.main(ExecutorsDemo.java:<span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šä»£ç æŒ‡å‡ºï¼ŒExecutorsDemo.java çš„ç¬¬ 16 è¡Œï¼Œå°±æ˜¯ä»£ç ä¸­çš„ execu- tor.execute(new SubThread());ã€‚</p>
<h3 id="Executors-ä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·"><a href="#Executors-ä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·" class="headerlink" title="Executors ä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·"></a>Executors ä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·</h3><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“äº† Executors åˆ›å»ºçš„çº¿ç¨‹æ± å­˜åœ¨ OOM çš„é£é™©ï¼Œé‚£ ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢?æˆ‘ä»¬éœ€è¦æ·±å…¥ Executors çš„æºç æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>å…¶å®ï¼Œåœ¨ä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥çœ‹å‡ºè››ä¸é©¬è¿¹çš„ï¼Œåœ¨ä»¥ä¸Šçš„ä»£ç ä¸­å…¶å® å·²ç»è¯´äº†ï¼ŒçœŸæ­£çš„å¯¼è‡´ OOM çš„å…¶å®æ˜¯ LinkedBlockingQueue.offer æ–¹æ³•ã€‚</p>
<p>å¦‚æœè¯»è€…ç¿»çœ‹ä»£ç çš„è¯ï¼Œä¹Ÿå¯ä»¥å‘ç°ï¼Œå…¶å®åº•å±‚ç¡®å®æ˜¯é€šè¿‡ LinkedBlock- ingQueue å®ç°çš„:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">        <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¯»è€…å¯¹ Java ä¸­çš„é˜»å¡é˜Ÿåˆ—æœ‰æ‰€äº†è§£çš„è¯ï¼Œçœ‹åˆ°è¿™é‡Œæˆ–è®¸å°±èƒ½å¤Ÿæ˜ç™½åŸå› äº†ã€‚</p>
<p>Java ä¸­ çš„ BlockingQueue ä¸» è¦ æœ‰ ä¸¤ ç§ å® ç°ï¼Œ åˆ† åˆ« æ˜¯ ArrayBlockingQ- ueue å’Œ LinkedBlockingQueueã€‚</p>
<ul>
<li>ArrayBlockingQueue æ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¿…é¡»è®¾ç½®å®¹é‡ã€‚</li>
<li>LinkedBlockingQueue æ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡å¯ä»¥é€‰æ‹© è¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸º Integer.MAX_ VALUEã€‚  </li>
</ul>
<p>è¿™é‡Œçš„é—®é¢˜å°±å‡ºåœ¨:ä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¸è®¾ç½® LinkedBlockingQueue çš„ å®¹é‡çš„è¯ï¼Œå…¶é»˜è®¤å®¹é‡å°†ä¼šæ˜¯ Integer.MAX_VALUEã€‚</p>
<p>è€Œ newFixedThreadPool ä¸­åˆ›å»º LinkedBlockingQueue æ—¶ï¼Œå¹¶æœªæŒ‡å®šå®¹ é‡ã€‚æ­¤æ—¶ï¼ŒLinkedBlockingQueue å°±æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ—ï¼Œå¯¹äºä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ— æ¥è¯´ï¼Œæ˜¯å¯ä»¥ä¸æ–­çš„å‘é˜Ÿåˆ—ä¸­åŠ å…¥ä»»åŠ¡çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æœ‰å¯èƒ½å› ä¸ºä»»åŠ¡è¿‡å¤šè€Œå¯¼ è‡´å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</p>
<p>ä¸Šé¢æåˆ°çš„é—®é¢˜ä¸»è¦ä½“ç°åœ¨newFixedThreadPool å’Œ newSingleThreadExecutor ä¸¤ä¸ªå·¥å‚æ–¹æ³•ä¸Šï¼Œå¹¶ä¸æ˜¯è¯´ newCachedThreadPool å’Œ newScheduledThreadPool è¿™ä¸¤ä¸ªæ–¹æ³•å°±å®‰å…¨äº†ï¼Œè¿™ä¸¤ç§æ–¹å¼åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°å¯èƒ½æ˜¯ Integer.MAX_VALUEï¼Œè€Œåˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œå¿…ç„¶å°±æœ‰å¯èƒ½å¯¼è‡´ OOMã€‚</p>
<h3 id="åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿"><a href="#åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿" class="headerlink" title="åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿"></a>åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿</h3><p>é¿å…ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¸»è¦æ˜¯é¿å…ä½¿ç”¨å…¶ä¸­çš„é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ å¯ä»¥è‡ªå·±ç›´æ¥è°ƒç”¨ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ã€‚åœ¨åˆ›å»ºçš„ åŒæ—¶ï¼Œç»™ BlockQueue æŒ‡å®šå®¹é‡å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ExecutorService executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">10</span>, <span class="number">10</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> ArrayBlockingQueue(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<p>è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦æäº¤çš„çº¿ç¨‹æ•°è¶…è¿‡å½“å‰å¯ç”¨çº¿ç¨‹æ•°æ—¶ï¼Œå°±ä¼šæŠ›å‡º java.util. concurrent.RejectedExecutionExceptionï¼Œè¿™æ˜¯å› ä¸ºå½“å‰çº¿ç¨‹æ± ä½¿ç”¨çš„é˜Ÿåˆ— æ˜¯æœ‰è¾¹ç•Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å·²ç»æ»¡äº†ä¾¿æ— æ³•ç»§ç»­å¤„ç†æ–°çš„è¯·æ±‚ã€‚ä½†æ˜¯å¼‚å¸¸(Exception)æ€»æ¯” å‘ç”Ÿé”™è¯¯(Error)è¦å¥½ã€‚</p>
<p>é™¤äº†è‡ªå·±å®šä¹‰ ThreadPoolExecutor å¤–ã€‚è¿˜æœ‰å…¶ä»–æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ç¬¬ä¸€æ—¶é—´ å°±åº”è¯¥æƒ³åˆ°å¼€æºç±»åº“ï¼Œå¦‚ apache å’Œ guava ç­‰ã€‚</p>
<p>ä½œè€…æ¨èä½¿ç”¨ guava æä¾›çš„ ThreadFactoryBuilder æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutorsDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadFactory namedThreadFactory = <span class="keyword">new</span> ThreadFactoryBuilder()</span><br><span class="line">            .setNameFormat(<span class="string">&quot;demo-pool-%d&quot;</span>).build();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ExecutorService pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">200</span>, <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">            <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">1024</span>), namedThreadFactory, <span class="keyword">new</span></span><br><span class="line">            ThreadPoolExecutor. AbortPolicy());</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123; pool.execute(<span class="keyword">new</span> SubThread());</span><br><span class="line">        &#125; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šè¿°æ–¹å¼åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¸ä»…å¯ä»¥é¿å… OOM çš„é—®é¢˜ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹å ç§°ï¼Œæ›´åŠ æ–¹ä¾¿çš„å‡ºé”™çš„æ—¶å€™æº¯æºã€‚</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹ä¸å¹¶å‘</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>elasticsearch-reindex</title>
    <url>/wiki/elasticsearch-reindex/</url>
    <content><![CDATA[<h2 id="reindex-å¸¸è§„ä½¿ç”¨"><a href="#reindex-å¸¸è§„ä½¿ç”¨" class="headerlink" title="reindex å¸¸è§„ä½¿ç”¨"></a>reindex å¸¸è§„ä½¿ç”¨</h2><blockquote>
<p>Reindexè¦æ±‚ä¸ºæºç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£å¯ç”¨_sourceã€‚<br>Reindexä¸å°è¯•è®¾ç½®ç›®æ ‡ç´¢å¼•ï¼Œå®ƒä¸å¤åˆ¶æºç´¢å¼•çš„è®¾ç½®ï¼Œä½ åº”è¯¥åœ¨è¿è¡Œ_reindexæ“ä½œä¹‹å‰è®¾ç½®ç›®æ ‡ç´¢å¼•ï¼ŒåŒ…æ‹¬è®¾ç½®æ˜ å°„ã€ç¢ç‰‡è®¡æ•°ã€å‰¯æœ¬ç­‰ã€‚</p>
</blockquote>
<p>å¦‚ä¸‹ç¤ºä¾‹å°†æŠŠæ–‡æ¡£ä»twitterç´¢å¼•å¤åˆ¶åˆ°new_twitterç´¢å¼•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;source&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;twitter&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;dest&quot;: &#123;</span><br><span class="line">    &quot;index&quot;: &quot;new_twitter&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯è¿”å›å€¼ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">299</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;updated&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;created&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;deleted&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;batches&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;version_conflicts&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;noops&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;retries&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;bulk&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;search&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;throttled_millis&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;requests_per_second&quot;</span> : <span class="number">-1.0</span>,</span><br><span class="line">  <span class="attr">&quot;throttled_until_millis&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;failures&quot;</span> : [ ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±åƒ_update_by_queryä¸€æ ·ï¼Œ_reindexè·å–æºç´¢å¼•çš„å¿«ç…§ï¼Œä½†å®ƒçš„ç›®æ ‡å¿…é¡»æ˜¯ä¸åŒçš„ç´¢å¼•ï¼Œå› æ­¤ä¸å¤ªå¯èƒ½å‘ç”Ÿç‰ˆæœ¬å†²çªã€‚å¯ä»¥åƒindex APIé‚£æ ·é…ç½®destå…ƒç´ æ¥æ§åˆ¶ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚ä»…ä»…çœç•¥version_type(å¦‚ä¸Šæ‰€è¿°)æˆ–å°†å…¶è®¾ç½®ä¸ºinternalï¼Œéƒ½ä¼šå¯¼è‡´Elasticsearchç›²ç›®åœ°å°†æ–‡æ¡£è½¬å‚¨åˆ°ç›®æ ‡ä¸­ï¼Œè¦†ç›–ä»»ä½•ç¢°å·§å…·æœ‰ç›¸åŒç±»å‹å’Œidçš„æ–‡æ¡£</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version_type&quot;</span>: <span class="string">&quot;internal&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å°†version_typeè®¾ç½®ä¸ºexternalå°†å¯¼è‡´Elasticsearchä¿å­˜æºæ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œåˆ›å»ºä»»ä½•ç¼ºå¤±çš„æ–‡æ¡£ï¼Œå¹¶æ›´æ–°ç›®æ ‡ç´¢å¼•ä¸­æ¯”æºç´¢å¼•ä¸­ç‰ˆæœ¬æ›´æ—§çš„æ–‡æ¡£ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter2&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;version_type&quot;</span>: <span class="string">&quot;external&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è®¾ç½®op_type=createå°†å¯¼è‡´_reindexåªåœ¨ç›®æ ‡ç´¢å¼•ä¸­åˆ›å»ºç¼ºå¤±çš„æ–‡æ¡£ã€‚æ‰€æœ‰ç°æœ‰æ–‡ä»¶å°†å¯¼è‡´ç‰ˆæœ¬å†²çªï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter3&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;op_type&quot;</span>: <span class="string">&quot;create&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å†²çªå°†ä¸­æ­¢_reindexè¿›ç¨‹ï¼Œâ€œconflictsâ€è¯·æ±‚ä½“å‚æ•°å¯ç”¨äºæŒ‡ç¤º_reindexå¤„ç†å…³äºç‰ˆæœ¬å†²çªçš„ä¸‹ä¸€ä¸ªæ–‡æ¡£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä»–é”™è¯¯ç±»å‹çš„å¤„ç†ä¸å—â€œconflictsâ€å‚æ•°çš„å½±å“ï¼Œå½“åœ¨è¯·æ±‚ä½“ä¸­è®¾ç½®â€œconflictsâ€:â€œproceedâ€æ—¶ï¼Œ_reindexè¿›ç¨‹å°†ç»§ç»­å¤„ç†ç‰ˆæœ¬å†²çªï¼Œå¹¶è¿”å›æ‰€é‡åˆ°çš„ç‰ˆæœ¬å†²çªè®¡æ•°ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;conflicts&quot;</span>: <span class="string">&quot;proceed&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter3&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;op_type&quot;</span>: <span class="string">&quot;create&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>è¿”å›å€¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">7</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;updated&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;created&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;deleted&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;batches&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;version_conflicts&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;noops&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;retries&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;bulk&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;search&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;throttled_millis&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;requests_per_second&quot;</span> : <span class="number">-1.0</span>,</span><br><span class="line">  <span class="attr">&quot;throttled_until_millis&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;failures&quot;</span> : [ ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡å‘æºæ·»åŠ æŸ¥è¯¢æ¥é™åˆ¶æ–‡æ¡£ã€‚è¿™å°†åªå¤åˆ¶ç”±kimchyå‘å‡ºçš„tweetåˆ°new_twitterï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;conflicts&quot;</span>: <span class="string">&quot;proceed&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;term&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;user&quot;</span>: <span class="string">&quot;kimchy&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>sourceä¸­çš„indexå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…è®¸ä½ åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ä»å¤šä¸ªæºå¤åˆ¶ã€‚è¿™å°†ä»twitterå’Œblogç´¢å¼•å¤åˆ¶æ–‡æ¡£ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;conflicts&quot;</span>: <span class="string">&quot;proceed&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: [<span class="string">&quot;twitter&quot;</span>,<span class="string">&quot;blog&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šReindex APIä¸å¤„ç†IDå†²çªï¼Œå› æ­¤æœ€åç¼–å†™çš„æ–‡æ¡£å°†â€œèƒœå‡ºâ€ï¼Œä½†é¡ºåºé€šå¸¸æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ä¾èµ–è¿™ç§è¡Œä¸ºä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œç›¸åï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ç¡®ä¿idæ˜¯æƒŸä¸€çš„ã€‚<br>è¿˜å¯ä»¥é€šè¿‡è®¾ç½®å¤§å°æ¥é™åˆ¶å¤„ç†æ–‡æ¡£çš„æ•°é‡ï¼Œç¤ºä¾‹å°†åªå¤åˆ¶ä¸€ä¸ªå•ä¸€çš„æ–‡ä»¶ä»twitteråˆ°new_twitterï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æƒ³ä»twitterç´¢å¼•ä¸­è·å¾—ä¸€ç»„ç‰¹å®šçš„æ–‡æ¡£ï¼Œä½ éœ€è¦ä½¿ç”¨sortã€‚æ’åºä¼šé™ä½æ»šåŠ¨çš„æ•ˆç‡ï¼Œä½†åœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·åšæ˜¯å€¼å¾—çš„ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œé€‰æ‹©ä¸€ä¸ªæ¯”å¤§å°å’Œæ’åºæ›´å…·é€‰æ‹©æ€§çš„æŸ¥è¯¢ã€‚è¿™å°†æŠŠ10000ä¸ªæ–‡æ¡£ä»twitterå¤åˆ¶åˆ°new_twitterï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">10000</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;blog2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sort&quot;</span>: &#123; <span class="attr">&quot;age&quot;</span>: <span class="string">&quot;desc&quot;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>sourceéƒ¨åˆ†æ”¯æŒæœç´¢è¯·æ±‚ä¸­æ”¯æŒçš„æ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåªæœ‰åŸå§‹æ–‡æ¡£ä¸­çš„ä¸€éƒ¨åˆ†å­—æ®µå¯ä»¥ä½¿ç”¨æºè¿‡æ»¤é‡æ–°ç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;_source&quot;</span>: [<span class="string">&quot;user&quot;</span>, <span class="string">&quot;_doc&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>ä¸_update_by_queryä¸€æ ·ï¼Œ_reindexæ”¯æŒä¿®æ”¹æ–‡æ¡£çš„è„šæœ¬ã€‚ä¸_update_by_queryä¸åŒï¼Œè„šæœ¬å…è®¸ä¿®æ”¹æ–‡æ¡£çš„å…ƒæ•°æ®ã€‚è¿™ä¸ªä¾‹å­æ”¹å˜äº†æºæ–‡æ¡£çš„ç‰ˆæœ¬ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;blog2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;version_type&quot;</span>: <span class="string">&quot;external&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;if (ctx._source.foo == \&quot;bar\&quot;) &#123;ctx._version++; ctx._source.remove(\&quot;foo\&quot;)&#125;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>å°±åƒåœ¨_update_by_queryä¸­ä¸€æ ·ï¼Œä½ å¯ä»¥è®¾ç½®ctx.opæ›´æ”¹åœ¨ç›®æ ‡ç´¢å¼•ä¸Šæ‰§è¡Œçš„æ“ä½œï¼Œå€¼ä¸ºnoopï¼Œdeleteã€‚<br>è®¾ç½®ctx.opåˆ°ä»»ä½•å…¶ä»–å­—æ®µéƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œåœ¨ctxä¸­è®¾ç½®ä»»ä½•å…¶ä»–å­—æ®µä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯ä»¥ä¿®æ”¹ä»¥ä¸‹å€¼ï¼š_idã€_index<br>ã€_versionã€_routingã€‚<br>å°†_versionè®¾ç½®ä¸ºnullæˆ–å°†å®ƒä»ctxæ˜ å°„ä¸­æ¸…é™¤ï¼Œå°±åƒæ²¡æœ‰åœ¨ç´¢å¼•è¯·æ±‚ä¸­å‘é€ç‰ˆæœ¬ä¸€æ ·;å®ƒå°†å¯¼è‡´åœ¨ç›®æ ‡ç´¢å¼•ä¸­è¦†ç›–æ–‡æ¡£ï¼Œè€Œä¸ç®¡ç›®æ ‡ä¸Šçš„ç‰ˆæœ¬æˆ–åœ¨_reindexè¯·æ±‚ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ç±»å‹ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ_reindexçœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰è·¯ç”±çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆè¯¥è·¯ç”±å°†è¢«ä¿ç•™ï¼Œé™¤éè„šæœ¬æ›´æ”¹äº†å®ƒï¼Œä½ å¯ä»¥è®¾ç½®è·¯ç”±å¯¹destçš„è¯·æ±‚ï¼Œä»¥æ”¹å˜è¿™ä¸€ç‚¹ï¼š<br>keepï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸ºåŒ¹é…ä¸Šçš„è·¯ç”±ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚<br>discardï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸ºnullã€‚<br>=<some text>ï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸º=ä¹‹åçš„æ‰€æœ‰æ–‡æœ¬ã€‚<br>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯·æ±‚å°†æ‰€æœ‰æ–‡æ¡£ä»å…·æœ‰å…¬å¸åç§°catçš„æºç´¢å¼•å¤åˆ¶åˆ°è·¯ç”±è®¾ç½®ä¸ºcatçš„destç´¢å¼•ä¸­ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;company&quot;</span>: <span class="string">&quot;cat&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;routing&quot;</span>: <span class="string">&quot;=cat&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ_reindexä½¿ç”¨æ»šåŠ¨æ‰¹æ¬¡ä¸º1000ï¼Œå¯ä»¥ä½¿ç”¨æºå…ƒç´ ä¸­çš„sizeå­—æ®µæ›´æ”¹æ‰¹å¤§å°ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;size&quot;</span>: <span class="number">100</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;routing&quot;</span>: <span class="string">&quot;=cat&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>_reindexè¿˜å¯ä»¥é€šè¿‡åƒè¿™æ ·æŒ‡å®šç®¡é“æ¥ä½¿ç”¨IngestèŠ‚ç‚¹ç‰¹æ€§ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pipeline&quot;</span>: <span class="string">&quot;some_ingest_pipeline&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>




<h2 id="è¿œç¨‹reindex"><a href="#è¿œç¨‹reindex" class="headerlink" title="è¿œç¨‹reindex"></a>è¿œç¨‹reindex</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;remote&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;http://otherhost:9200&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;data&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>hostå‚æ•°å¿…é¡»åŒ…å«scheme, host, portï¼ˆå¦‚ï¼š<a href="http://otherhost:9200ï¼‰,ä¹Ÿå¯ä»¥åŠ è·¯å¾„ï¼ˆå¦‚ï¼šhttp://otherhost:9200/proxyï¼‰ï¼Œusernameå’Œpasswordæ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¿œç¨‹é›†ç¾¤å¼€å¯äº†å®‰å…¨è®¤è¯ï¼Œé‚£ä¹ˆæ˜¯å¿…é€‰çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨usernameå’Œpasswordï¼Œéœ€è¦ä½¿ç”¨httpsã€‚">http://otherhost:9200ï¼‰,ä¹Ÿå¯ä»¥åŠ è·¯å¾„ï¼ˆå¦‚ï¼šhttp://otherhost:9200/proxyï¼‰ï¼Œusernameå’Œpasswordæ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¿œç¨‹é›†ç¾¤å¼€å¯äº†å®‰å…¨è®¤è¯ï¼Œé‚£ä¹ˆæ˜¯å¿…é€‰çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨usernameå’Œpasswordï¼Œéœ€è¦ä½¿ç”¨httpsã€‚</a><br>è¿œç¨‹ä¸»æœºéœ€è¦è®¾ç½®ç™½åå•ï¼Œå¯ä»¥é€šè¿‡elasticsearch.ymlæ–‡ä»¶é‡Œçš„reindex.remote.whitelistå±æ€§è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœè®¾ç½®å¤šä¸ªå€¼å¯ä»¥ä½¿ç”¨é€—å·æ¥è¿›è¡Œåˆ†éš”ï¼ˆå¦‚ï¼šotherhost:9200, another:9200, 127.0.10.*:9200, localhost:*ï¼‰ï¼Œè¿™é‡Œçš„é…ç½®å¯ä»¥å¿½ç•¥schemeï¼Œå¦‚ï¼š</p>
<p><code>reindex.remote.whitelist: &quot;otherhost:9200, another:9200, 127.0.10.*:9200, localhost:*&quot;</code></p>
<p>å¿…é¡»è®©æ¯ä¸ªå¤„ç†reindexçš„èŠ‚ç‚¹ä¸Šæ·»åŠ ç™½åå•çš„é…ç½®ã€‚<br>è¿™ä¸ªç‰¹æ€§åº”è¯¥é€‚ç”¨äºå¯èƒ½æ‰¾åˆ°çš„ä»»ä½•ç‰ˆæœ¬çš„Elasticsearchçš„è¿œç¨‹é›†ç¾¤ï¼Œè¿™åº”è¯¥å…è®¸é€šè¿‡ä»æ—§ç‰ˆæœ¬çš„é›†ç¾¤reindexï¼Œå°†Elasticsearchçš„ä»»ä½•ç‰ˆæœ¬å‡çº§åˆ°å½“å‰ç‰ˆæœ¬ã€‚<br>è¦å¯ç”¨å‘é€åˆ°æ—§ç‰ˆæœ¬Elasticsearchçš„æŸ¥è¯¢ï¼Œæ— éœ€éªŒè¯æˆ–ä¿®æ”¹å³å¯å°†æŸ¥è¯¢å‚æ•°ç›´æ¥å‘é€åˆ°è¿œç¨‹ä¸»æœºï¼Œæ³¨æ„ï¼šè¿œç¨‹reindexä¸æ”¯æŒæ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨slicingã€‚<br>ä»è¿œç¨‹æœåŠ¡å™¨reindexä½¿ç”¨å †ä¸Šç¼“å†²åŒºï¼Œé»˜è®¤æœ€å¤§å¤§å°ä¸º100mbï¼Œå¦‚æœè¿œç¨‹ç´¢å¼•åŒ…å«éå¸¸å¤§çš„æ–‡æ¡£ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ›´å°çš„æ‰¹å¤„ç†å¤§å°ï¼Œä¸‹é¢çš„ç¤ºä¾‹å°†æ‰¹å¤„ç†å¤§å°è®¾ç½®ä¸º10ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;remote&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;http://otherhost:9200&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;size&quot;</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;data&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ä½¿ç”¨socket_timeoutå­—æ®µè®¾ç½®è¿œç¨‹è¿æ¥ä¸Šçš„å¥—æ¥å­—è¯»å–è¶…æ—¶ï¼Œä½¿ç”¨connect_timeoutå­—æ®µè®¾ç½®è¿æ¥è¶…æ—¶ï¼Œä»–ä»¬çš„é»˜è®¤å€¼ä¸º30ç§’ï¼Œä¸‹é¢ç¤ºä¾‹ä¾‹å°†å¥—æ¥å­—è¯»å–è¶…æ—¶è®¾ç½®ä¸º1åˆ†é’Ÿï¼Œè¿æ¥è¶…æ—¶è®¾ç½®ä¸º10ç§’ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;remote&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;host&quot;</span>: <span class="string">&quot;http://otherhost:9200&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;socket_timeout&quot;</span>: <span class="string">&quot;1m&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;connect_timeout&quot;</span>: <span class="string">&quot;10s&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;source&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;match&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;data&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;dest&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>


<h2 id="é…ç½®SSLå‚æ•°"><a href="#é…ç½®SSLå‚æ•°" class="headerlink" title="é…ç½®SSLå‚æ•°"></a>é…ç½®SSLå‚æ•°</h2><p>è¿œç¨‹reindexæ”¯æŒé…ç½®SSLå‚æ•°ï¼Œé™¤äº†åœ¨Elasticsearchç§˜é’¥åº“ä¸­æ·»åŠ å®‰å…¨è®¾ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦åœ¨elasticsearch.ymlæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä¸å¯èƒ½åœ¨_reindexè¯·æ±‚ä½“ä¸­é…ç½®ã€‚<br>æ”¯æŒä»¥ä¸‹è®¾ç½®ï¼š<br>reindex.ssl.certificate_authorities<br>åº”å—ä¿¡ä»»çš„PEMç¼–ç è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ï¼Œä¸åŒåŒæ—¶æŒ‡å®šreindex.ssl.certificate_authoritieså’Œreindex.ssl.truststore.pathã€‚<br>reindex.ssl.truststore.path<br>åŒ…å«è¦ä¿¡ä»»çš„è¯ä¹¦çš„Javaå¯†é’¥å­˜å‚¨æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªå¯†é’¥å­˜å‚¨åº“å¯ä»¥æ˜¯â€œJKSâ€æˆ–â€œPKCS#12â€æ ¼å¼ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®šreindex.ssl.certificate_authoritieså’Œreindex.ssl.truststore.pathã€‚<br>reindex.ssl.truststore.password<br>reindex.ssl.truststore.pathé…ç½®çš„å¯†ç ï¼Œä¸èƒ½å’Œreindex.ssl.truststore.secure_passwordä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.truststore.secure_password<br>reindex.ssl.truststore.pathé…ç½®çš„å¯†ç ï¼Œä¸èƒ½å’Œreindex.ssl.truststore.passwordä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.truststore.type<br>reindex.ssl.truststore.pathä¿¡ä»»å­˜å‚¨åº“çš„ç±»å‹ï¼Œå¿…é¡»æ˜¯jksæˆ–PKCS12ï¼Œå¦‚æœreindex.ssl.truststore.pathçš„ç»“æŸæ˜¯â€.p12â€, â€œ.pfxâ€æˆ–è€…â€pkcs12â€ï¼Œé‚£ä¹ˆè¯¥é…ç½®çš„é»˜è®¤å€¼æ˜¯PKCS12ï¼Œå¦åˆ™é»˜è®¤å€¼æ˜¯jksã€‚<br>reindex.ssl.verification_mode<br>æŒ‡ç¤ºç”¨äºé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œä¼ªé€ è¯ä¹¦çš„éªŒè¯ç±»å‹ã€‚å¯ä»¥è®¾ç½®ä¸ºfullï¼ˆéªŒè¯ä¸»æœºåå’Œè¯ä¹¦è·¯å¾„ï¼‰ã€certificateï¼ˆéªŒè¯è¯ä¹¦è·¯å¾„ï¼Œä½†ä¸éªŒè¯ä¸»æœºåï¼‰ã€noneï¼ˆä¸æ‰§è¡ŒéªŒè¯â€”â€”è¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¼ºçƒˆä¸é¼“åŠ±çš„ï¼‰ï¼Œé»˜è®¤æ˜¯fullã€‚<br>reindex.ssl.certificate<br>æŒ‡å®šPEMç¼–ç è¯ä¹¦çš„è·¯å¾„æˆ–è€…è¯ä¹¦é“¾ç”¨äºHTTPå®¢æˆ·ç«¯èº«ä»½è®¤è¯ï¼Œè¿™ä¸ªé…ç½®è¿˜éœ€è¦è®¾ç½®reindex.ssl.keyå€¼ï¼Œä¸èƒ½åŒæ—¶è®¾ç½®reindex.ssl.certificateå’Œreindex.ssl.keystore.pathã€‚<br>reindex.ssl.key<br>æŒ‡å®šä¸ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„è¯ä¹¦ç›¸å…³è”çš„PEMç¼–ç ç§é’¥çš„è·¯å¾„ï¼Œä¸èƒ½åŒæ—¶è®¾ç½®reindex.ssl.keyå’Œreindex.ssl.keystore.pathã€‚<br>reindex.ssl.key_passphrase<br>æŒ‡å®šç”¨äºè§£å¯†å·²åŠ å¯†çš„PEMç¼–ç ç§é’¥(reindex.ssl.key)çš„å£ä»¤ï¼Œä¸èƒ½ä¸reindex.ssl.secure_key_passphraseä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.secure_key_passphrase<br>æŒ‡å®šç”¨äºè§£å¯†å·²åŠ å¯†çš„PEMç¼–ç ç§é’¥(reindex.ssl.key)çš„å£ä»¤ï¼Œä¸èƒ½ä¸reindex.ssl.key_passphraseä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.keystore.path<br>æŒ‡å®šå¯†é’¥å­˜å‚¨åº“çš„è·¯å¾„ï¼Œå…¶ä¸­åŒ…å«ç”¨äºHTTPå®¢æˆ·æœºèº«ä»½éªŒè¯çš„ç§é’¥å’Œè¯ä¹¦(å¦‚æœè¿œç¨‹é›†ç¾¤éœ€è¦)ï¼Œè¿™ä¸ªå¯†é’¥å­˜å‚¨åº“å¯ä»¥æ˜¯â€œJKSâ€æˆ–â€œPKCS#12â€æ ¼å¼ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®šreindex.ssl.keyå’Œreindex.ssl.keystore.pathã€‚<br>reindex.ssl.keystore.type<br>å¯†é’¥å­˜å‚¨åº“çš„ç±»å‹(reindex.ssl.keystore.path)ï¼Œå¿…é¡»æ˜¯jksæˆ–è€…PKCS12ï¼Œå¦‚æœreindex.ssl.keystore.pathçš„ç»“æŸæ˜¯â€.p12â€, â€œ.pfxâ€æˆ–è€…â€pkcs12â€ï¼Œé‚£ä¹ˆè¯¥é…ç½®çš„é»˜è®¤å€¼æ˜¯PKCS12ï¼Œå¦åˆ™é»˜è®¤å€¼æ˜¯jksã€‚<br>reindex.ssl.keystore.password<br>å¯†é’¥å­˜å‚¨åº“çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.secure_passwordä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.keystore.secure_password<br>å¯†é’¥å­˜å‚¨åº“çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.passwordä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.keystore.key_password<br>å¯†é’¥å­˜å‚¨åº“ä¸­å¯†é’¥çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œé»˜è®¤ä¸ºå¯†é’¥å­˜å‚¨åº“å¯†ç ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.secure_key_passwordä¸€èµ·ä½¿ç”¨ã€‚<br>reindex.ssl.keystore.secure_key_password<br>å¯†é’¥å­˜å‚¨åº“ä¸­å¯†é’¥çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œé»˜è®¤ä¸ºå¯†é’¥å­˜å‚¨åº“å¯†ç ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.key_passwordä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="URLå‚æ•°"><a href="#URLå‚æ•°" class="headerlink" title="URLå‚æ•°"></a>URLå‚æ•°</h2><p>é™¤äº†æ ‡å‡†çš„prettyå‚æ•°å¤–ï¼Œ reindexè¿˜æ”¯æŒrefresh, wait_for_completion, wait_for_active_shards, timeout, scrollå’Œrequests_per_secondã€‚<br>å‘é€refresh urlå‚æ•°å°†å¯¼è‡´å¯¹æ‰€å†™è¯·æ±‚çš„æ‰€æœ‰ç´¢å¼•è¿›è¡Œåˆ·æ–°ï¼Œè¿™ä¸Index APIçš„refreshå‚æ•°ä¸åŒï¼Œåè€…åªä¼šåˆ·æ–°æ¥æ”¶æ–°æ•°æ®çš„ç¢ç‰‡ï¼Œä¸index APIä¸åŒçš„æ˜¯ï¼Œå®ƒä¸æ”¯æŒwait_forã€‚<br>å¦‚æœè¯·æ±‚åŒ…å«wait_for_completion=falseï¼Œåˆ™Elasticsearchå°†æ‰§è¡Œä¸€äº›æ‰§è¡Œå‰æ£€æŸ¥ï¼Œå¯åŠ¨è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡å¯ä¸Tasks apiä¸€èµ·ç”¨äºå–æ¶ˆæˆ–è·å–ä»»åŠ¡çŠ¶æ€ï¼ŒElasticsearchè¿˜å°†åˆ›å»ºæ­¤ä»»åŠ¡çš„è®°å½•ï¼Œä½œä¸º.tasks/task/${taskId}çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥è‡ªå·±å†³å®šæ˜¯ä¿ç•™æˆ–è€…åˆ é™¤ä»–ï¼Œå½“ä½ å·²ç»å®Œæˆäº†ï¼Œåˆ é™¤ä»–ï¼Œè¿™æ ·esä¼šå›æ”¶ä»–ä½¿ç”¨çš„ç©ºé—´ã€‚<br>wait_for_active_shardsæ§åˆ¶åœ¨è¿›è¡Œé‡æ–°ç´¢å¼•ä¹‹å‰å¿…é¡»æ¿€æ´»å¤šå°‘ä¸ªshardå‰¯æœ¬ï¼Œè¶…æ—¶æ§åˆ¶æ¯ä¸ªå†™è¯·æ±‚ç­‰å¾…ä¸å¯ç”¨ç¢ç‰‡å˜ä¸ºå¯ç”¨çš„æ—¶é—´ï¼Œä¸¤è€…åœ¨æ‰¹é‡APIä¸­çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒï¼Œç”±äº_reindexä½¿ç”¨æ»šåŠ¨æœç´¢ï¼Œä½ è¿˜å¯ä»¥æŒ‡å®šæ»šåŠ¨å‚æ•°æ¥æ§åˆ¶â€œæœç´¢ä¸Šä¸‹æ–‡â€å­˜æ´»çš„æ—¶é—´(ä¾‹å¦‚?scroll=10m)ï¼Œé»˜è®¤å€¼æ˜¯5åˆ†é’Ÿã€‚<br>requests_per_secondå¯ä»¥è®¾ç½®ä¸ºä»»ä½•æ­£æ•°(1.4ã€6ã€1000ç­‰)ï¼Œå¹¶é€šè¿‡åœ¨æ¯ä¸ªæ‰¹ä¸­å¡«å……ç­‰å¾…æ—¶é—´æ¥æ§åˆ¶_reindexå‘å‡ºæ‰¹ç´¢å¼•æ“ä½œçš„é€Ÿç‡ï¼Œå¯ä»¥é€šè¿‡å°†requests_per_secondè®¾ç½®ä¸º-1æ¥ç¦ç”¨ã€‚<br>èŠ‚æµæ˜¯é€šè¿‡åœ¨æ‰¹ä¹‹é—´ç­‰å¾…æ¥å®Œæˆçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç»™_reindexå†…éƒ¨ä½¿ç”¨çš„æ»šåŠ¨è®¾ç½®ä¸€ä¸ªè€ƒè™‘å¡«å……çš„è¶…æ—¶ï¼Œå¡«å……æ—¶é—´æ˜¯æ‰¹å¤§å°é™¤ä»¥requests_per_secondå’Œå†™å…¥æ—¶é—´ä¹‹é—´çš„å·®é¢ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰¹å¤„ç†å¤§å°ä¸º1000ï¼Œæ‰€ä»¥å¦‚æœrequests_per_secondè¢«è®¾ç½®ä¸º500ï¼š</p>
<p><code>target_time = 1000 / 500 per second = 2 seconds </code>padding time<code> = target_time - write_time = 2 seconds - 0.5 seconds = 1.5 seconds</code></p>
<p>ç”±äºæ‰¹å¤„ç†æ˜¯ä½œä¸ºå•ä¸ª_bulkè¯·æ±‚å‘å‡ºçš„ï¼Œå› æ­¤è¾ƒå¤§çš„æ‰¹å¤„ç†å¤§å°å°†å¯¼è‡´Elasticsearchåˆ›å»ºè®¸å¤šè¯·æ±‚ï¼Œç„¶åç­‰å¾…ä¸€æ®µæ—¶é—´å†å¯åŠ¨ä¸‹ä¸€ä¸ªè¯·æ±‚é›†ï¼Œè¿™æ˜¯â€œburstyâ€è€Œä¸æ˜¯â€œsmoothâ€ï¼Œé»˜è®¤å€¼æ˜¯-1ã€‚</p>
<p>å“åº”ä½“ </p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;took&quot;</span>: <span class="number">639</span>,</span><br><span class="line">    <span class="attr">&quot;timed_out&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;total&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;updated&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;created&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;deleted&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;batches&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;noops&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;version_conflicts&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;retries&quot;</span>: &#123;</span><br><span class="line">	<span class="attr">&quot;bulk&quot;</span>: <span class="number">0</span>,</span><br><span class="line">	<span class="attr">&quot;search&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;throttled_millis&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;requests_per_second&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;throttled_until_millis&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failures&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>took<br>æ•´ä¸ªæ“ä½œèŠ±è´¹çš„æ€»æ¯«ç§’æ•°ã€‚<br>timed_out<br>å¦‚æœåœ¨reindexæœŸé—´æ‰§è¡Œçš„ä»»ä½•è¯·æ±‚è¶…æ—¶ï¼Œåˆ™å°†æ­¤æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚<br>total<br>æˆåŠŸå¤„ç†çš„æ–‡æ¡£æ•°é‡ã€‚<br>updated<br>æˆåŠŸæ›´æ–°çš„æ–‡æ¡£æ•°é‡ã€‚<br>created<br>æˆåŠŸåˆ›å»ºçš„æ–‡æ¡£çš„æ•°é‡ã€‚<br>deleted<br>æˆåŠŸåˆ é™¤çš„æ–‡æ¡£æ•°é‡ã€‚<br>batches<br>ç”±reindexå›æ‹‰çš„æ»šåŠ¨å“åº”çš„æ•°é‡ã€‚<br>noops<br>ç”±äºç”¨äºreindexçš„è„šæœ¬è¿”å›äº†ctx.opçš„noopå€¼è€Œè¢«å¿½ç•¥çš„æ–‡æ¡£æ•°é‡ã€‚<br>version_conflicts<br>reindexå‘½ä¸­çš„ç‰ˆæœ¬å†²çªæ•°ã€‚<br>retries<br>reindexå°è¯•é‡è¯•çš„æ¬¡æ•°,bulkæ˜¯é‡è¯•çš„æ‰¹é‡æ“ä½œçš„æ•°é‡ï¼Œsearchæ˜¯é‡è¯•çš„æœç´¢æ“ä½œçš„æ•°é‡ã€‚<br>throttled_millis<br>è¯·æ±‚ä¼‘çœ ä»¥ç¬¦åˆrequests_per_secondçš„æ¯«ç§’æ•°ã€‚<br>requests_per_second<br>åœ¨reindexæœŸé—´æ¯ç§’æœ‰æ•ˆæ‰§è¡Œçš„è¯·æ±‚æ•°ã€‚<br>throttled_until_millis<br>åœ¨_reindexå“åº”ä¸­ï¼Œè¯¥å­—æ®µåº”è¯¥å§‹ç»ˆç­‰äºé›¶ï¼Œå®ƒåªæœ‰åœ¨ä½¿ç”¨ä»»åŠ¡APIæ—¶æ‰æœ‰æ„ä¹‰ï¼Œåœ¨ä»»åŠ¡APIä¸­ï¼Œå®ƒæŒ‡ç¤ºä¸‹ä¸€æ¬¡(æ¯«ç§’)å†æ¬¡æ‰§è¡ŒèŠ‚æµè¯·æ±‚ï¼Œä»¥ç¬¦åˆrequests_per_secondã€‚<br>failures<br>å‡ºç°å¤šä¸ªé”™è¯¯ä»¥æ•°ç»„è¿”å›ã€‚</p>
<h2 id="ä½¿ç”¨task-api"><a href="#ä½¿ç”¨task-api" class="headerlink" title="ä½¿ç”¨task api"></a>ä½¿ç”¨task api</h2><p>è·å–task</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&amp;wait_for_completion=false&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;new_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>è¿”å›å€¼ä¸º</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;task&quot;</span> : <span class="string">&quot;8uQK-B00RiWq03awtJok1Q:18&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥ç”¨ä»»åŠ¡APIè·å–æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„reindexè¯·æ±‚çš„çŠ¶æ€ï¼š<br><code>curl -XGET &quot;http://127.0.0.1:9200/_tasks?detailed=true&amp;actions=*reindex&amp;pretty&quot;</code><br>æˆ–è€…æ ¹æ®task idè·å–<br><code>curl -XGET &quot;http://127.0.0.1:9200/_tasks/8uQK-B00RiWq03awtJok1Q:48?pretty&quot;</code><br>è¿”å›å€¼ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;completed&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;task&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;node&quot;</span> : <span class="string">&quot;8uQK-B00RiWq03awtJok1Q&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;id&quot;</span> : <span class="number">48</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;transport&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;action&quot;</span> : <span class="string">&quot;indices:data/write/reindex&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;total&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;updated&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;created&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;deleted&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;batches&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;version_conflicts&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;noops&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;retries&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;bulk&quot;</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;search&quot;</span> : <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;throttled_millis&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;requests_per_second&quot;</span> : <span class="number">0.0</span>,</span><br><span class="line">      <span class="attr">&quot;throttled_until_millis&quot;</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span> : <span class="string">&quot;reindex from [twitter] to [new_twitter][_doc]&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start_time_in_millis&quot;</span> : <span class="number">1566216815832</span>,</span><br><span class="line">    <span class="attr">&quot;running_time_in_nanos&quot;</span> : <span class="number">86829</span>,</span><br><span class="line">    <span class="attr">&quot;cancellable&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;headers&quot;</span> : &#123; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;error&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;index_not_found_exception&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;no such index [new_twitter] and [action.auto_create_index] ([twitter,index10,-index1*,+ind*,-myIndex]) doesn&#x27;t match&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index_uuid&quot;</span> : <span class="string">&quot;_na_&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;index&quot;</span> : <span class="string">&quot;new_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å–æ¶ˆtask"><a href="#å–æ¶ˆtask" class="headerlink" title="å–æ¶ˆtask"></a>å–æ¶ˆtask</h2><p>ä»»ä½•reindexæ¥å£éƒ½å¯ä»¥ä½¿ç”¨task cancel apiå–æ¶ˆï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"> curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_tasks/8uQK-B00RiWq03awtJok1Q:48/_cancel?pretty&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;node_failures&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;failed_node_exception&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;Failed node [8uQK-B00RiWq03awtJok1Q]&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;node_id&quot;</span> : <span class="string">&quot;8uQK-B00RiWq03awtJok1Q&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;caused_by&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;resource_not_found_exception&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;task [8uQK-B00RiWq03awtJok1Q:48] doesn&#x27;t support cancellation&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;nodes&quot;</span> : &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å–æ¶ˆåº”è¯¥å¾ˆå¿«å‘ç”Ÿï¼Œä½†å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼ŒTasks APIå°†ç»§ç»­åˆ—å‡ºä»»åŠ¡ï¼Œç›´åˆ°å®ƒé†’æ¥å–æ¶ˆè‡ªå·±ã€‚</p>
<h2 id="rethrottle"><a href="#rethrottle" class="headerlink" title="rethrottle"></a>rethrottle</h2><p>å¯ä»¥åœ¨urlä¸­ä½¿ç”¨_rethrottleï¼Œå¹¶ä½¿ç”¨requests_per_secondå‚æ•°æ¥è®¾ç½®èŠ‚æµï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex/8uQK-B00RiWq03awtJok1Q:250/_rethrottle?requests_per_second=-1&amp;pretty&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;node_failures&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;failed_node_exception&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;Failed node [8uQK-B00RiWq03awtJok1Q]&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;node_id&quot;</span> : <span class="string">&quot;8uQK-B00RiWq03awtJok1Q&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;caused_by&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;resource_not_found_exception&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;reason&quot;</span> : <span class="string">&quot;task [8uQK-B00RiWq03awtJok1Q:250] is missing&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;nodes&quot;</span> : &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="reindexæ”¹å˜å±æ€§åç§°"><a href="#reindexæ”¹å˜å±æ€§åç§°" class="headerlink" title="reindexæ”¹å˜å±æ€§åç§°"></a>reindexæ”¹å˜å±æ€§åç§°</h2><p>_reindexå¯ä»¥é‡å‘½åå±æ€§åï¼Œå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å¦‚ä¸‹æ–‡æ¡£çš„ç´¢å¼•ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/test/_doc/1?refresh&amp;pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;words words&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;flag&quot;</span>: <span class="string">&quot;foo&quot;</span></span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>åœ¨reindexçš„æ—¶å€™æƒ³æŠŠflagä¿®æ”¹ä¸ºtagï¼Œç¤ºä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order2&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;ctx._source.tag = ctx._source.remove(\&quot;flag\&quot;)&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹order2çš„æ•°æ®ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XGET <span class="string">&quot;http://127.0.0.1:9200/order2/_doc/1?pretty&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;order2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;found&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;text&quot;</span> : <span class="string">&quot;words words&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tag&quot;</span> : <span class="string">&quot;foo&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="åˆ‡ç‰‡"><a href="#åˆ‡ç‰‡" class="headerlink" title="åˆ‡ç‰‡"></a>åˆ‡ç‰‡</h2><p>Reindexæ”¯æŒåˆ‡ç‰‡æ»šåŠ¨ï¼Œä»¥å¹¶è¡ŒåŒ–é‡æ–°ç´¢å¼•è¿‡ç¨‹ã€‚è¿™ç§å¹¶è¡ŒåŒ–å¯ä»¥æé«˜æ•ˆç‡ï¼Œå¹¶æä¾›ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•å°†è¯·æ±‚åˆ†è§£ä¸ºæ›´å°çš„éƒ¨åˆ†</p>
<h3 id="æ‰‹åŠ¨åˆ‡ç‰‡"><a href="#æ‰‹åŠ¨åˆ‡ç‰‡" class="headerlink" title="æ‰‹åŠ¨åˆ‡ç‰‡"></a>æ‰‹åŠ¨åˆ‡ç‰‡</h3><p>é€šè¿‡ä¸ºæ¯ä¸ªè¯·æ±‚æä¾›ä¸€ä¸ªç‰‡idå’Œç‰‡çš„æ€»æ•°ï¼Œæ‰‹å·¥åˆ‡ç‰‡ä¸€ä¸ªé‡ç´¢å¼•è¯·æ±‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;slice&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;max&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;slice&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;max&quot;</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥éªŒè¯ï¼š</p>
<p><code>curl -XGET &quot;http://127.0.0.1:9200/_refresh?pretty&quot;</code></p>
<p><code>curl -XPOST &quot;http://127.0.0.1:9200/order2/_search?size=0&amp;filter_path=hits.total&amp;pretty&quot;</code></p>
<p>è¿”å›å€¼ä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="è‡ªåŠ¨åˆ‡é¢"><a href="#è‡ªåŠ¨åˆ‡é¢" class="headerlink" title="è‡ªåŠ¨åˆ‡é¢"></a>è‡ªåŠ¨åˆ‡é¢</h3><p>ä½ è¿˜å¯ä»¥è®©_reindexä½¿ç”¨åˆ‡ç‰‡æ»šåŠ¨è‡ªåŠ¨å¹¶è¡ŒåŒ–_uidä¸Šçš„åˆ‡ç‰‡ï¼Œä½¿ç”¨slicesæŒ‡å®šè¦ä½¿ç”¨çš„ç‰‡æ•°:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?slices=5&amp;refresh&amp;pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;order2&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸‹é¢è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/order2/_search?size=0&amp;filter_path=hits.total&amp;pretty&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;value&quot;</span> : <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> : <span class="string">&quot;eq&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="reindexå¤šä¸ªç´¢å¼•"><a href="#reindexå¤šä¸ªç´¢å¼•" class="headerlink" title="reindexå¤šä¸ªç´¢å¼•"></a>reindexå¤šä¸ªç´¢å¼•</h2><p>å¦‚æœæœ‰è®¸å¤šç´¢å¼•éœ€è¦reindexï¼Œé€šå¸¸æœ€å¥½ä¸€æ¬¡reindexä¸€ä¸ªç´¢å¼•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªglobæ¨¡å¼æ¥è·å–è®¸å¤šç´¢å¼•ã€‚è¿™æ ·ï¼Œå¦‚æœæœ‰ä»»ä½•é”™è¯¯ï¼Œå¯ä»¥åˆ é™¤éƒ¨åˆ†å®Œæˆçš„ç´¢å¼•å¹¶ä»è¯¥ç´¢å¼•é‡æ–°å¼€å§‹ï¼Œä»è€Œæ¢å¤è¯¥è¿‡ç¨‹ã€‚å®ƒè¿˜ä½¿å¹¶è¡ŒåŒ–è¿‡ç¨‹å˜å¾—ç›¸å½“ç®€å•ï¼šå°†ç´¢å¼•åˆ—è¡¨æ‹†åˆ†ä¸ºreindexå¹¶å¹¶è¡Œè¿è¡Œæ¯ä¸ªåˆ—è¡¨ã€‚<br>å¯ä»¥ä½¿ç”¨ä¸€æ¬¡æ€§è„šæœ¬ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">for index in i1 i2 i3 i4 i5; do</span><br><span class="line">  curl -HContent-Type:application/json -XPOST localhost:<span class="number">9200</span>/_reindex?pretty -d&#x27;&#123;</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;&#x27;$index&#x27;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;&#x27;$index&#x27;-reindexed&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#x27;</span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="reindexæ¯æ—¥ç´¢å¼•"><a href="#reindexæ¯æ—¥ç´¢å¼•" class="headerlink" title="reindexæ¯æ—¥ç´¢å¼•"></a>reindexæ¯æ—¥ç´¢å¼•</h2><p>å°½ç®¡æœ‰ä¸Šè¿°å»ºè®®ï¼Œä½ ä»ç„¶å¯ä»¥ç»“åˆä½¿ç”¨_reindexå’ŒPainlessæ¥reindexæ¯æ—¥ç´¢å¼•ï¼Œä»è€Œå°†æ–°æ¨¡æ¿åº”ç”¨äºç°æœ‰æ–‡æ¡£ã€‚<br>å‡è®¾æœ‰ä»¥ä¸‹æ–‡ä»¶ç»„æˆçš„ç´¢å¼•:</p>
<p><code>curl -XPUT &quot;http://127.0.0.1:9200/metricbeat-2016.05.30/_doc/1?refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d</code><br>{â€œsystem.cpu.idle.pctâ€:  0.908}â€™</p>
<p><code>curl -XPUT &quot;http://127.0.0.1:9200/metricbeat-2016.05.31/_doc/1?refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#39;</code><br>{â€œsystem.cpu.idle.pctâ€:  0.105}</p>
<p>metricbeat-*ç´¢å¼•çš„æ–°æ¨¡æ¿å·²ç»åŠ è½½åˆ°Elasticsearchä¸­ï¼Œä½†å®ƒåªé€‚ç”¨äºæ–°åˆ›å»ºçš„ç´¢å¼•ã€‚<br>ä¸‹é¢çš„è„šæœ¬ä»ç´¢å¼•åç§°ä¸­æå–æ—¥æœŸï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé™„åŠ -1çš„æ–°ç´¢å¼•ã€‚æ‰€æœ‰æ¥è‡ªmetricbeat-2016.05.31çš„æ•°æ®å°†reindexåˆ°metricbeat-2016.05.31-1ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;metricbeat-*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;metricbeat&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;script&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;source&quot;</span>: <span class="string">&quot;ctx._index = &#x27;metricbeat-&#x27; + (ctx._index.substring(&#x27;metricbeat-&#x27;.length(),ctx._index.length())) + &#x27;-1&#x27;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»¥å‰metricbeatç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£ç°åœ¨éƒ½å¯ä»¥åœ¨*-1ç´¢å¼•ä¸­æ‰¾åˆ°ã€‚</p>
<p><code>curl -XGET &quot;http://127.0.0.1:9200/metricbeat-2016.05.30-1/_doc/1?pretty&quot;</code><br><code>curl -XGET &quot;http://127.0.0.1:9200/metricbeat-2016.05.31-1/_doc/1?pretty&quot;</code></p>
<p>å‰ä¸€ç§æ–¹æ³•è¿˜å¯ä»¥ä¸æ›´æ”¹å­—æ®µåç§°ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿ä»…å°†ç°æœ‰æ•°æ®åŠ è½½åˆ°æ–°ç´¢å¼•ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡å‘½åä»»ä½•å­—æ®µã€‚</p>
<h2 id="æå–ç´¢å¼•ä¸­çš„å­é›†åˆ"><a href="#æå–ç´¢å¼•ä¸­çš„å­é›†åˆ" class="headerlink" title="æå–ç´¢å¼•ä¸­çš„å­é›†åˆ"></a>æå–ç´¢å¼•ä¸­çš„å­é›†åˆ</h2><p>_reindexå¯ç”¨äºæå–ç´¢å¼•çš„éšæœºå­é›†è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -XPOST <span class="string">&quot;http://127.0.0.1:9200/_reindex?pretty&quot;</span> -H <span class="string">&quot;Content-Type:application/json&quot;</span> -d&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;twitter&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;query&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;function_score&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;query&quot;</span> : &#123; <span class="attr">&quot;match_all&quot;</span>: &#123;&#125; &#125;,</span><br><span class="line">        <span class="attr">&quot;random_score&quot;</span> : &#123;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;sort&quot;</span>: <span class="string">&quot;_score&quot;</span>    </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;random_twitter&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>_reindexé»˜è®¤æŒ‰_docæ’åºï¼Œå› æ­¤random_scoreä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œé™¤éä½ è¦†ç›–sortå±æ€§ä¸º_scoreã€‚</p>
]]></content>
      <categories>
        <category>Elasticsearch</category>
        <category>Search in Depth</category>
      </categories>
      <tags>
        <tag>elasticsearch</tag>
      </tags>
  </entry>
  <entry>
    <title>æå°½HashMapåº•å±‚åŸç†</title>
    <url>/wiki/%E6%9E%81%E5%B0%BDHashMap%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<blockquote>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/92481037">HashMap ä¸­çš„å®¹é‡ä¸æ‰©å®¹å®ç°ï¼Œç»†è‡´å…¥å¾®ï¼Œå€¼çš„ä¸€å“</a></li>
<li><a href="https://www.zhihu.com/search?type=content&q=hashmap">Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ</a> </li>
</ul>
</blockquote>
<blockquote>
<p>HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ¬æ–‡ç»“åˆJDK1.7å’ŒJDK1.8çš„åŒºåˆ«ï¼Œæ·±å…¥æ¢è®¨HashMapçš„ç»“æ„å®ç°å’ŒåŠŸèƒ½åŸç†ã€‚</p>
</blockquote>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>Javaä¸ºæ•°æ®ç»“æ„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæ¥å£java.util.Mapï¼Œæ­¤æ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://pic2.zhimg.com/26341ef9fe5caf66ba0b7c40bba264a5_b.png"></p>
<p>ä¸‹é¢é’ˆå¯¹å„ä¸ªå®ç°ç±»çš„ç‰¹ç‚¹åšä¸€äº›è¯´æ˜ï¼š</p>
<p>(1) HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚</p>
<p>(2) Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ã€‚Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚</p>
<p>(3) LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚</p>
<p>(4) TreeMapï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚å¯¹äºä¸Šè¿°å››ç§Mapç±»å‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚é€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬çŸ¥é“äº†HashMapæ˜¯Javaçš„Mapå®¶æ—ä¸­ä¸€ä¸ªæ™®é€šæˆå‘˜ï¼Œé‰´äºå®ƒå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„ä½¿ç”¨æ¡ä»¶ï¼Œæ‰€ä»¥æ˜¯ä½¿ç”¨é¢‘åº¦æœ€é«˜çš„ä¸€ä¸ªã€‚ä¸‹æ–‡æˆ‘ä»¬ä¸»è¦ç»“åˆæºç ï¼Œä»å­˜å‚¨ç»“æ„ã€å¸¸ç”¨æ–¹æ³•åˆ†æã€æ‰©å®¹ä»¥åŠå®‰å…¨æ€§ç­‰æ–¹é¢æ·±å…¥è®²è§£HashMapçš„å·¥ä½œåŸç†ã€‚</p>
<h2 id="å†…éƒ¨å®ç°"><a href="#å†…éƒ¨å®ç°" class="headerlink" title="å†…éƒ¨å®ç°"></a>å†…éƒ¨å®ç°</h2><h3 id="å­˜å‚¨ç»“æ„-å­—æ®µ"><a href="#å­˜å‚¨ç»“æ„-å­—æ®µ" class="headerlink" title="å­˜å‚¨ç»“æ„-å­—æ®µ"></a>å­˜å‚¨ç»“æ„-å­—æ®µ</h3><p>ä»ç»“æ„å®ç°æ¥è®²ï¼ŒHashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°çš„ï¼Œå¦‚ä¸‹å¦‚æ‰€ç¤ºã€‚</p>
<img src='https://pic1.zhimg.com/8db4a3bdfb238da1a1c4431d2b6e075c_b.png'>

<p>è¿™é‡Œéœ€è¦è®²æ˜ç™½ä¸¤ä¸ªé—®é¢˜ï¼šæ•°æ®åº•å±‚å…·ä½“å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ ·çš„å­˜å‚¨æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼Ÿ</p>
<p>(1) ä»æºç å¯çŸ¥ï¼ŒHashMapç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å­—æ®µï¼Œå°±æ˜¯ Node[] tableï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ˜æ˜¾å®ƒæ˜¯ä¸€ä¸ªNodeçš„æ•°ç»„ã€‚æˆ‘ä»¬æ¥çœ‹Node[JDK1.8]æ˜¯ä½•ç‰©ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;    <span class="comment">//ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½®</span></span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;   <span class="comment">//é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode</span></span><br><span class="line"></span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span></span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entryæ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚</p>
<p>(2) HashMapå°±æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨çš„ã€‚å“ˆå¸Œè¡¨ä¸ºè§£å†³å†²çªï¼Œå¯ä»¥é‡‡ç”¨å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ç­‰æ¥è§£å†³é—®é¢˜ï¼ŒJavaä¸­HashMapé‡‡ç”¨äº†é“¾åœ°å€æ³•ã€‚é“¾åœ°å€æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ•°ç»„åŠ é“¾è¡¨çš„ç»“åˆã€‚åœ¨æ¯ä¸ªæ•°ç»„å…ƒç´ ä¸Šéƒ½ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå½“æ•°æ®è¢«Hashåï¼Œå¾—åˆ°æ•°ç»„ä¸‹æ ‡ï¼ŒæŠŠæ•°æ®æ”¾åœ¨å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é“¾è¡¨ä¸Šã€‚ä¾‹å¦‚ç¨‹åºæ‰§è¡Œä¸‹é¢ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.put(<span class="string">&quot;ç¾å›¢&quot;</span>,<span class="string">&quot;å°ç¾&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿå°†è°ƒç”¨â€ç¾å›¢â€è¿™ä¸ªkeyçš„hashCode()æ–¹æ³•å¾—åˆ°å…¶hashCode å€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºæ¯ä¸ªJavaå¯¹è±¡ï¼‰ï¼Œç„¶åå†é€šè¿‡Hashç®—æ³•çš„åä¸¤æ­¥è¿ç®—ï¼ˆé«˜ä½è¿ç®—å’Œå–æ¨¡è¿ç®—ï¼Œä¸‹æ–‡æœ‰ä»‹ç»ï¼‰æ¥å®šä½è¯¥é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®ï¼Œæœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashç¢°æ’ã€‚å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’çš„æ¦‚ç‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆç‡å°±ä¼šè¶Šé«˜ã€‚</p>
<p>å¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºç°è¾ƒå¤šç¢°æ’ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®å°±æ˜¯åœ¨æ ¹æ®å®é™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’ã€‚é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶mapä½¿å¾—Hashç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•å’Œæ‰©å®¹æœºåˆ¶ã€‚</p>
<p>åœ¨ç†è§£Hashå’Œæ‰©å®¹æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸‹HashMapçš„å‡ ä¸ªå­—æ®µã€‚ä»HashMapçš„é»˜è®¤æ„é€ å‡½æ•°æºç å¯çŸ¥ï¼Œæ„é€ å‡½æ•°å°±æ˜¯å¯¹ä¸‹é¢å‡ ä¸ªå­—æ®µè¿›è¡Œåˆå§‹åŒ–ï¼Œæºç å¦‚ä¸‹:</p>
<p>int threshold;             // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æé™<br>    final float loadFactor;    // è´Ÿè½½å› å­<br>    int modCount;<br>    int size;</p>
<p>é¦–å…ˆï¼ŒNode[] tableçš„åˆå§‹åŒ–é•¿åº¦length(é»˜è®¤å€¼æ˜¯16)ï¼ŒLoad factorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)ï¼Œthresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°ã€‚threshold = length * Load factorã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚</p>
<p>ç»“åˆè´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œæ‰©å®¹åçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ã€‚é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­Load factorçš„å€¼ï¼›ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­loadFactorçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äº1ã€‚</p>
<p>sizeè¿™ä¸ªå­—æ®µå…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯HashMapä¸­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡ã€‚æ³¨æ„å’Œtableçš„é•¿åº¦lengthã€å®¹çº³æœ€å¤§é”®å€¼å¯¹æ•°é‡thresholdçš„åŒºåˆ«ã€‚è€ŒmodCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œ<code>ä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±äºç»“æ„å˜åŒ–ã€‚</code></p>
<p>åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸è§„çš„è®¾è®¡ï¼Œå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚ç‡è¦å°äºåˆæ•°ï¼Œå…·ä½“è¯æ˜å¯ä»¥å‚è€ƒ[<a href="http://blog.csdn.net/liuqiyao_01/article/details/14475159]%EF%BC%8CHashtable%E5%88%9D%E5%A7%8B%E5%8C%96%E6%A1%B6%E5%A4%A7%E5%B0%8F%E4%B8%BA11%EF%BC%8C%E5%B0%B1%E6%98%AF%E6%A1%B6%E5%A4%A7%E5%B0%8F%E8%AE%BE%E8%AE%A1%E4%B8%BA%E7%B4%A0%E6%95%B0%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%88Hashtable%E6%89%A9%E5%AE%B9%E5%90%8E%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E8%BF%98%E6%98%AF%E7%B4%A0%E6%95%B0%EF%BC%89%E3%80%82HashMap%E9%87%87%E7%94%A8%E8%BF%99%E7%A7%8D%E9%9D%9E%E5%B8%B8%E8%A7%84%E8%AE%BE%E8%AE%A1%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E4%B8%BA%E4%BA%86%E5%9C%A8%E5%8F%96%E6%A8%A1%E5%92%8C%E6%89%A9%E5%AE%B9%E6%97%B6%E5%81%9A%E4%BC%98%E5%8C%96%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B8%BA%E4%BA%86%E5%87%8F%E5%B0%91%E5%86%B2%E7%AA%81%EF%BC%8CHashMap%E5%AE%9A%E4%BD%8D%E5%93%88%E5%B8%8C%E6%A1%B6%E7%B4%A2%E5%BC%95%E4%BD%8D%E7%BD%AE%E6%97%B6%EF%BC%8C%E4%B9%9F%E5%8A%A0%E5%85%A5%E4%BA%86%E9%AB%98%E4%BD%8D%E5%8F%82%E4%B8%8E%E8%BF%90%E7%AE%97%E7%9A%84%E8%BF%87%E7%A8%8B%E3%80%82">http://blog.csdn.net/liuqiyao_01/article/details/14475159]ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–ï¼ŒåŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸è¿ç®—çš„è¿‡ç¨‹ã€‚</a></p>
<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºç°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºç°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æ„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½ï¼Œå…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚æœ¬æ–‡ä¸å†å¯¹çº¢é»‘æ ‘å±•å¼€è®¨è®ºï¼Œæƒ³äº†è§£æ›´å¤šçº¢é»‘æ ‘æ•°æ®ç»“æ„çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒ[<a href="http://blog.csdn.net/v_july_v/article/details/6105630]%E3%80%82">http://blog.csdn.net/v_july_v/article/details/6105630]ã€‚</a></p>
<h2 id="å®ç°-æ–¹æ³•"><a href="#å®ç°-æ–¹æ³•" class="headerlink" title="å®ç°-æ–¹æ³•"></a>å®ç°-æ–¹æ³•</h2><p>HashMapçš„å†…éƒ¨åŠŸèƒ½å®ç°å¾ˆå¤šï¼Œæœ¬æ–‡ä¸»è¦ä»æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®ã€putæ–¹æ³•çš„è¯¦ç»†æ‰§è¡Œã€æ‰©å®¹è¿‡ç¨‹ä¸‰ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„ç‚¹æ·±å…¥å±•å¼€è®²è§£ã€‚</p>
<h3 id="ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®"><a href="#ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®" class="headerlink" title="ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®"></a>ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®</h3><p>ä¸ç®¡å¢åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡HashMapçš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªHashMapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éå†é“¾è¡¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚HashMapå®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æ¥å†³å®šäº†hashæ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚å…ˆçœ‹çœ‹æºç çš„å®ç°(æ–¹æ³•ä¸€+æ–¹æ³•äºŒ):</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•ä¸€ï¼š</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;   <span class="comment">//jdk1.8 &amp; jdk1.7</span></span><br><span class="line">     <span class="keyword">int</span> h;</span><br><span class="line">     <span class="comment">// h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼</span></span><br><span class="line">     <span class="comment">// h ^ (h &gt;&gt;&gt; 16)  ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸è¿ç®—</span></span><br><span class="line">     <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line">æ–¹æ³•äºŒï¼š</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;  <span class="comment">//jdk1.7çš„æºç ï¼Œjdk1.8æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å®ç°åŸç†ä¸€æ ·çš„</span></span><br><span class="line">     <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);  <span class="comment">//ç¬¬ä¸‰æ­¥ å–æ¨¡è¿ç®—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„Hashç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼šå–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®—ã€‚</p>
<p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚</p>
<p>åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚</p>
<p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹ï¼Œnä¸ºtableçš„é•¿åº¦ã€‚<br><img src='https://pic2.zhimg.com/8e8203c1b51be6446cda4026eaaccf19_b.png'></p>
<h2 id="åˆ†æHashMapçš„putæ–¹æ³•"><a href="#åˆ†æHashMapçš„putæ–¹æ³•" class="headerlink" title="åˆ†æHashMapçš„putæ–¹æ³•"></a>åˆ†æHashMapçš„putæ–¹æ³•</h2><p>HashMapçš„putæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç†è§£ï¼Œè‡ªå·±æœ‰å…´è¶£å¯ä»¥å»å¯¹æ¯”æºç æ›´æ¸…æ¥šåœ°ç ”ç©¶å­¦ä¹ ã€‚<br><img src='https://pic3.zhimg.com/58e67eae921e4b431782c07444af824e_b.png'></p>
<p>â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼›</p>
<p>â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼›</p>
<p>â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼›</p>
<p>â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼›</p>
<p>â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼›</p>
<p>â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p>
<p>JDK1.8HashMapçš„putæ–¹æ³•æºç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">     <span class="comment">// å¯¹keyçš„hashCode()åšhash</span></span><br><span class="line">     <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">     Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">     <span class="comment">// æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º</span></span><br><span class="line">     <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">         n = (tab = resize()).length;</span><br><span class="line">     <span class="comment">// æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† </span></span><br><span class="line">     <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>) </span><br><span class="line">         tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">     <span class="keyword">else</span> &#123;</span><br><span class="line">         Node&lt;K,V&gt; e; K k;</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value</span></span><br><span class="line">         <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">             ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">             e = p;</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">             e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">         <span class="comment">// æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨</span></span><br><span class="line">         <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                 <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                     p.next = newNode(hash, key,value,<span class="keyword">null</span>);                      <span class="comment">//é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></span><br><span class="line">                     <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st  </span></span><br><span class="line">                         treeifyBin(tab, hash);</span><br><span class="line">                     <span class="keyword">break</span>;</span><br><span class="line">                 &#125;                  <span class="comment">// keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</span></span><br><span class="line">                 <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                     ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))                                  </span><br><span class="line">                             <span class="keyword">break</span>;</span><br><span class="line">                 p = e;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">             V oldValue = e.value;</span><br><span class="line">             <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                 e.value = value;</span><br><span class="line">             afterNodeAccess(e);</span><br><span class="line">             <span class="keyword">return</span> oldValue;</span><br><span class="line">         &#125;</span><br><span class="line">     </span><br><span class="line">     ++modCount;</span><br><span class="line">     <span class="comment">// æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹</span></span><br><span class="line">     <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">         resize();</span><br><span class="line">     afterNodeInsertion(evict);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h3 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h3><p>æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚æˆ‘ä»¬åˆ†æä¸‹resizeçš„æºç ï¼Œé‰´äºJDK1.8èå…¥äº†çº¢é»‘æ ‘ï¼Œè¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç†è§£æˆ‘ä»¬ä»ç„¶ä½¿ç”¨JDK1.7çš„ä»£ç ï¼Œå¥½ç†è§£ä¸€äº›ï¼Œæœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œå…·ä½“åŒºåˆ«åæ–‡å†è¯´ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;   <span class="comment">//ä¼ å…¥æ–°çš„å®¹é‡</span></span><br><span class="line">     Entry[] oldTable = table;    <span class="comment">//å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„</span></span><br><span class="line">     <span class="keyword">int</span> oldCapacity = oldTable.length;         </span><br><span class="line">     <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;  <span class="comment">//æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº†</span></span><br><span class="line">         threshold = Integer.MAX_VALUE; <span class="comment">//ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº†</span></span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">  </span><br><span class="line">     Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];  <span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„</span></span><br><span class="line">     transfer(newTable);                         <span class="comment">//ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ</span></span><br><span class="line">     table = newTable;                           <span class="comment">//HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„</span></span><br><span class="line">     threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);<span class="comment">//ä¿®æ”¹é˜ˆå€¼</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable)</span> </span>&#123;</span><br><span class="line">     Entry[] src = table;                   <span class="comment">//srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">     <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.length; j++) &#123; <span class="comment">//éå†æ—§çš„Entryæ•°ç»„</span></span><br><span class="line">         Entry&lt;K,V&gt; e = src[j];             <span class="comment">//å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´ </span></span><br><span class="line">         <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">             src[j] = <span class="keyword">null</span>;<span class="comment">//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰</span></span><br><span class="line">             <span class="keyword">do</span> &#123;</span><br><span class="line">                 Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                 <span class="keyword">int</span> i = indexFor(e.hash, newCapacity); <span class="comment">//ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®</span></span><br><span class="line">                 e.next = newTable[i]; <span class="comment">//æ ‡è®°[1]</span></span><br><span class="line">                 newTable[i] = e;      <span class="comment">//å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š</span></span><br><span class="line">                 e = next;             <span class="comment">//è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ </span></span><br><span class="line">             &#125; <span class="keyword">while</span> (e != <span class="keyword">null</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ ç»ˆä¼šè¢«æ”¾åˆ°Entryé“¾çš„å°¾éƒ¨(å¦‚æœå‘ç”Ÿäº†hashå†²çªçš„è¯ï¼‰ï¼Œè¿™ä¸€ç‚¹å’ŒJdk1.8æœ‰åŒºåˆ«ï¼Œä¸‹æ–‡è¯¦è§£ã€‚åœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚</p>
<p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å…¶ä¸­çš„å“ˆå¸Œæ¡¶æ•°ç»„tableçš„size=2ï¼Œ æ‰€ä»¥key = 3ã€7ã€5ï¼Œputé¡ºåºä¾æ¬¡ä¸º 5ã€7ã€3ã€‚åœ¨mod 2ä»¥åéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚è¿™é‡Œå‡è®¾è´Ÿè½½å› å­ loadFactor=1ï¼Œå³å½“é”®å€¼å¯¹çš„å®é™…å¤§å°size å¤§äº tableçš„å®é™…å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚</p>
<img src='https://pic1.zhimg.com/e5aa99e811d1814e010afa7779b759d4_b.png'>

<p>ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹JDK1.8åšäº†å“ªäº›ä¼˜åŒ–ã€‚ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚</p>
<img src='https://pic2.zhimg.com/a285d9b2da279a18b052fe5eed69afe9_b.png'>

<p>å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p>
<img src='https://pic2.zhimg.com/b2cb057773e3d67976c535d6ef547d51_b.png'>

<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p>
<img src='https://pic3.zhimg.com/544caeb82a329fa49cc99842818ed1ba_b.png'>

<p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK1.8ä¸ä¼šå€’ç½®ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸‹JDK1.8çš„resizeæºç ï¼Œå†™çš„å¾ˆèµï¼Œå¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">     Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">     <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">     <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">     <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span></span><br><span class="line">         <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">             threshold = Integer.MAX_VALUE;</span><br><span class="line">             <span class="keyword">return</span> oldTab;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                  oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">             newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">         newCap = oldThr;</span><br><span class="line">     <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">         newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">         newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// è®¡ç®—æ–°çš„resizeä¸Šé™</span></span><br><span class="line">     <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">         newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                   (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">     &#125;</span><br><span class="line">     threshold = newThr;</span><br><span class="line">     <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;ï¼Œ&quot;unchecked&quot;&#125;)</span></span><br><span class="line">         Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">     table = newTab;</span><br><span class="line">     <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">// æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­</span></span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">             Node&lt;K,V&gt; e;</span><br><span class="line">             <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                 oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                 <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                     newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                 <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                     ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                 <span class="keyword">else</span> &#123; <span class="comment">// é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å—</span></span><br><span class="line">                     Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                     Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                     Node&lt;K,V&gt; next;</span><br><span class="line">                     <span class="keyword">do</span> &#123;</span><br><span class="line">                         next = e.next;</span><br><span class="line">                         <span class="comment">// åŸç´¢å¼•</span></span><br><span class="line">                         <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                             <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                 loHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 loTail.next = e;</span><br><span class="line">                             loTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                         <span class="comment">// åŸç´¢å¼•+oldCap</span></span><br><span class="line">                         <span class="keyword">else</span> &#123;</span><br><span class="line">                             <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                 hiHead = e;</span><br><span class="line">                             <span class="keyword">else</span></span><br><span class="line">                                 hiTail.next = e;</span><br><span class="line">                             hiTail = e;</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                     <span class="comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                     <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                         loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                         newTab[j] = loHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                     <span class="comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span></span><br><span class="line">                     <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                         hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                         newTab[j + oldCap] = hiHead;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> newTab;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="çº¿ç¨‹å®‰å…¨æ€§"><a href="#çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="çº¿ç¨‹å®‰å…¨æ€§"></a>çº¿ç¨‹å®‰å…¨æ€§</h3><p>åœ¨å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„HashMapï¼Œè€Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸‹é¢ä¸¾ä¾‹å­è¯´æ˜åœ¨å¹¶å‘çš„å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ä½¿ç”¨HashMapå¯èƒ½é€ æˆæ­»å¾ªç¯ã€‚ä»£ç ä¾‹å­å¦‚ä¸‹(ä¾¿äºç†è§£ï¼Œä»ç„¶ä½¿ç”¨JDK1.7çš„ç¯å¢ƒ)ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMapInfiniteLoop</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;Integer,String&gt; map = <span class="keyword">new</span> HashMap&lt;Integer,String&gt;(<span class="number">2</span>ï¼Œ<span class="number">0.75f</span>);  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        map.put(<span class="number">5</span>ï¼Œ <span class="string">&quot;C&quot;</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="string">&quot;Thread1&quot;</span>) &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                map.put(<span class="number">7</span>, <span class="string">&quot;B&quot;</span>);  </span><br><span class="line">                System.out.println(map);  </span><br><span class="line">            &#125;;  </span><br><span class="line">        &#125;.start();  </span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="string">&quot;Thread2&quot;</span>) &#123;  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">                map.put(<span class="number">3</span>, <span class="string">&quot;A);  </span></span><br><span class="line"><span class="string">                System.out.println(map);  </span></span><br><span class="line"><span class="string">            &#125;;  </span></span><br><span class="line"><span class="string">        &#125;.start();        </span></span><br><span class="line"><span class="string">    &#125;  </span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œmapåˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼ŒloadFactor=0.75ï¼Œthreshold=2*0.75=1ï¼Œä¹Ÿå°±æ˜¯è¯´å½“putç¬¬äºŒä¸ªkeyçš„æ—¶å€™ï¼Œmapå°±éœ€è¦è¿›è¡Œresizeã€‚</p>
<p>é€šè¿‡è®¾ç½®æ–­ç‚¹è®©çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶debugåˆ°transferæ–¹æ³•(3.3å°èŠ‚ä»£ç å—)çš„é¦–è¡Œã€‚æ³¨æ„æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å·²ç»æˆåŠŸæ·»åŠ æ•°æ®ã€‚æ”¾å¼€thread1çš„æ–­ç‚¹è‡³transferæ–¹æ³•çš„â€œEntry next = e.next;â€ è¿™ä¸€è¡Œï¼›ç„¶åæ”¾å¼€çº¿ç¨‹2çš„çš„æ–­ç‚¹ï¼Œè®©çº¿ç¨‹2è¿›è¡Œresizeã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚</p>
<img src="https://pic4.zhimg.com/fa10635a66de637fe3cbd894882ff0c7_b.png">  

<p>æ³¨æ„ï¼ŒThread1çš„ e æŒ‡å‘äº†key(3)ï¼Œè€ŒnextæŒ‡å‘äº†key(7)ï¼Œå…¶åœ¨çº¿ç¨‹äºŒrehashåï¼ŒæŒ‡å‘äº†çº¿ç¨‹äºŒé‡ç»„åçš„é“¾è¡¨ã€‚<br>çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = eï¼Œ ç„¶åæ˜¯e = nextï¼Œå¯¼è‡´äº†eæŒ‡å‘äº†key(7)ï¼Œè€Œä¸‹ä¸€æ¬¡å¾ªç¯çš„next = e.nextå¯¼è‡´äº†nextæŒ‡å‘äº†key(3)ã€‚</p>
<img src="https://pic4.zhimg.com/d39d7eff6e8e04f98f5b53bebe2d4d7f_b.png">  

<p>e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7)ã€‚æ³¨æ„ï¼šæ­¤æ—¶çš„key(7).next å·²ç»æŒ‡å‘äº†key(3)ï¼Œ ç¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºç°äº†ã€‚</p>
<img src="https://pic2.zhimg.com/5f3cf5300f041c771a736b40590fd7b1_b.png">  

<p>äºæ˜¯ï¼Œå½“æˆ‘ä»¬ç”¨çº¿ç¨‹ä¸€è°ƒç”¨map.get(11)æ—¶ï¼Œæ‚²å‰§å°±å‡ºç°äº†â€”â€”Infinite Loopã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>(1) æ‰©å®¹æ˜¯ä¸€ä¸ªç‰¹åˆ«è€—æ€§èƒ½çš„æ“ä½œï¼Œæ‰€ä»¥å½“ç¨‹åºå‘˜åœ¨ä½¿ç”¨HashMapçš„æ—¶å€™ï¼Œä¼°ç®—mapçš„å¤§å°ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ç»™ä¸€ä¸ªå¤§è‡´çš„æ•°å€¼ï¼Œé¿å…mapè¿›è¡Œé¢‘ç¹çš„æ‰©å®¹ã€‚</p>
<p>(2) è´Ÿè½½å› å­æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä¹Ÿå¯ä»¥å¤§äº1ï¼Œä½†æ˜¯å»ºè®®ä¸è¦è½»æ˜“ä¿®æ”¹ï¼Œé™¤éæƒ…å†µéå¸¸ç‰¹æ®Šã€‚</p>
<p>(3) HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸è¦åœ¨å¹¶å‘çš„ç¯å¢ƒä¸­åŒæ—¶æ“ä½œHashMapï¼Œå»ºè®®ä½¿ç”¨ConcurrentHashMapã€‚</p>
<p>(4) JDK1.8å¼•å…¥çº¢é»‘æ ‘å¤§ç¨‹åº¦ä¼˜åŒ–äº†HashMapçš„æ€§èƒ½ã€‚(5) è¿˜æ²¡å‡çº§JDK1.8çš„ï¼Œç°åœ¨å¼€å§‹å‡çº§å§ã€‚HashMapçš„æ€§èƒ½æå‡ä»…ä»…æ˜¯JDK1.8çš„å†°å±±ä¸€è§’ã€‚</p>
]]></content>
      <categories>
        <category>Develop Lan</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
</search>

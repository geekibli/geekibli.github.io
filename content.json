{"pages":[{"title":"Categories","date":"2021-08-11T02:49:25.950Z","path":"categories/index.html","text":""},{"title":"æ½œå¿ƒä¸€æŠ€ ç›´åˆ°æè‡´","date":"2021-08-11T02:45:43.229Z","path":"about/index.html","text":"é“é˜» ä¸”é•¿ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨èæ˜é‡‘ åšå®¢https://www.codingdict.com/æå®¢æ—¶é—´ashiamd.github.ioå­—èŠ‚è·³åŠ¨åç«¯é¢è¯•é¢˜é›†çŸ¥ä¹ Javaå¿«é€Ÿè¿›é˜¶é€šé“To Be Top Javaer - Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯Div-wangJava å…¨æ ˆçŸ¥è¯†ä½“ç³»https://github.com/crossoverJie/JCSprouthttps://github.com/ZhongFuCheng3y/3y â€¼ï¸ å·¥å…·ç½‘ç«™ProcessOnç¤ºè¯´ ã€Œ æä¾›äº†å¾ˆå¤šä¼˜è´¨çš„PPT è¿˜æœ‰å¾ˆå¤šå¤§å‚çš„æ²™é¾™è§†å±ä»¥åŠææ–™ã€ æŠ€æœ¯å›¢é˜Ÿæ¨èå°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿæœ‰èµæŠ€æœ¯å›¢é˜Ÿç¾å›¢æŠ€æœ¯å›¢é˜Ÿ é¢è¯•é¢˜åˆé›†2020å¹´å¤§å‚Javaé¢è¯•å‰å¤ä¹ çš„æ­£ç¡®å§¿åŠ¿ï¼ˆ800+é¢è¯•é¢˜é™„ç­”æ¡ˆè§£æï¼‰Javaé›†åˆé¢è¯•é¢˜ï¼ˆæ€»ç»“æœ€å…¨é¢çš„é¢è¯•é¢˜ï¼‰ ä¸¤å¹´å­¦è¯´è¯ ä¸€ç”Ÿå­¦é—­å˜´"},{"title":"Tags","date":"2021-08-11T02:44:22.789Z","path":"tags/index.html","text":""}],"posts":[{"title":"Arthas-Javaè¯Šæ–­ç¥å™¨","date":"2021-08-20T08:28:32.000Z","path":"wiki/Arthas-Javaè¯Šæ–­ç¥å™¨/","text":"Arthas-Javaè¯Šæ–­ç¥å™¨ å®˜æ–¹æ–‡æ¡£åœ°å€ ğŸ‘‰ https://arthas.aliyun.com/doc/index.html# 1. å®‰è£…arthaswget https://arthas.aliyun.com/arthas-boot.jar java -jar arthas-boot.jar --target-ip 0.0.0.0 å¦‚æœä½ çš„æœºå™¨æ²¡æœ‰ä»»ä½•javaè¿›ç¨‹åœ¨è¿è¡Œï¼Œä¼šæç¤ºå¦‚ä¸‹é”™è¯¯ ğŸ‘‡ æ­£å¸¸å¯åŠ¨å¦‚ä¸‹ï¼š âš ï¸ ç”±äºæˆ‘ä»¬ä»…ä»…å¯åŠ¨äº†ä¸€ä¸ªjavaè¿›ç¨‹ï¼Œæ‰€æœ‰è¿™é‡Œå°±åªæœ‰ä¸€ä¸ªã€‚è¾“å…¥1å›è½¦å³å¯ã€‚ 42423å°±æ˜¯æˆ‘ä»¬çš„javaè¿›ç¨‹å· 2. æŸ¥çœ‹JVMä¿¡æ¯2.1 syspropsysprop å¯ä»¥æ‰“å°æ‰€æœ‰çš„System Propertiesä¿¡æ¯ã€‚ ä¹Ÿå¯ä»¥æŒ‡å®šå•ä¸ªkeyï¼š sysprop java.version ä¹Ÿå¯ä»¥é€šè¿‡grepæ¥è¿‡æ»¤ï¼š sysprop | grep user å¯ä»¥è®¾ç½®æ–°çš„valueï¼š sysprop testKey testValue 2.2 sysenvsysenv å‘½ä»¤å¯ä»¥è·å–åˆ°ç¯å¢ƒå˜é‡ã€‚å’Œsyspropå‘½ä»¤ç±»ä¼¼ã€‚ 2.3 jvmjvm å‘½ä»¤ä¼šæ‰“å°å‡ºJVMçš„å„ç§è¯¦ç»†ä¿¡æ¯ã€‚ 2.4 dashboarddashboard å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å®æ—¶æ•°æ®é¢æ¿ã€‚ è¾“å…¥ Q æˆ–è€… Ctrl+C å¯ä»¥é€€å‡ºdashboardå‘½ä»¤ã€‚ 3. æŸ¥çœ‹çº¿ç¨‹ç›¸å…³3.1 æŸ¥çœ‹çº¿ç¨‹åˆ—è¡¨thread 3.2 æŸ¥çœ‹çº¿ç¨‹æ ˆä¿¡æ¯thread 18 3.3 æŸ¥çœ‹5ç§’å†…çš„CPUä½¿ç”¨ç‡top nçº¿ç¨‹æ ˆthread -n 3 -i 5000 3.4 æŸ¥æ‰¾çº¿ç¨‹æ˜¯å¦æœ‰é˜»å¡thread -b 4. sc/sm æŸ¥çœ‹å·²åŠ è½½çš„ç±»ä¸‹é¢ä»‹ç»Arthasé‡ŒæŸ¥æ‰¾å·²åŠ è½½ç±»çš„å‘½ä»¤ã€‚ 4.1 sc æŸ¥æ‰¾åˆ°æ‰€æœ‰JVMå·²ç»åŠ è½½åˆ°çš„ç±»å¦‚æœæœç´¢çš„æ˜¯æ¥å£ï¼Œè¿˜ä¼šæœç´¢æ‰€æœ‰çš„å®ç°ç±»ã€‚æ¯”å¦‚æŸ¥çœ‹æ‰€æœ‰çš„Filterå®ç°ç±»ï¼š sc javax.servlet.Filter é€šè¿‡-då‚æ•°ï¼Œå¯ä»¥æ‰“å°å‡ºç±»åŠ è½½çš„å…·ä½“ä¿¡æ¯ï¼Œå¾ˆæ–¹ä¾¿æŸ¥æ‰¾ç±»åŠ è½½é—®é¢˜ã€‚ sc -d javax.servlet.Filter scæ”¯æŒé€šé…ï¼Œæ¯”å¦‚æœç´¢æ‰€æœ‰çš„StringUtilsï¼š sc *StringUtils 4.2 sm æŸ¥æ‰¾ç±»çš„å…·ä½“å‡½æ•°sm java.math.RoundingMode é€šè¿‡-då‚æ•°å¯ä»¥æ‰“å°å‡½æ•°çš„å…·ä½“å±æ€§ï¼š sm -d java.math.RoundingMode ä¹Ÿå¯ä»¥æŸ¥æ‰¾ç‰¹å®šçš„å‡½æ•°ï¼Œæ¯”å¦‚æŸ¥æ‰¾æ„é€ å‡½æ•°ï¼š sm java.math.RoundingMode &lt;init&gt; 5. Jadåç¼–è¯‘å¯ä»¥é€šè¿‡ jad å‘½ä»¤æ¥åç¼–è¯‘ä»£ç ï¼š jad com.example.demo.arthas.user.UserController é€šè¿‡--source-onlyå‚æ•°å¯ä»¥åªæ‰“å°å‡ºåœ¨åç¼–è¯‘çš„æºä»£ç ï¼š jad --source-only com.example.demo.arthas.user.UserController 6. OgnlåŠ¨æ€ä»£ç åœ¨Arthasé‡Œï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„ognlå‘½ä»¤ï¼Œå¯ä»¥åŠ¨æ€æ‰§è¡Œä»£ç ã€‚ 6.1 è°ƒç”¨staticå‡½æ•°ognl &#39;@java.lang.System@out.println(&quot;hello ognl&quot;)&#39; å¯ä»¥æ£€æŸ¥Terminalé‡Œçš„è¿›ç¨‹è¾“å‡ºï¼Œå¯ä»¥å‘ç°æ‰“å°å‡ºäº†hello ognlã€‚ 6.2 æŸ¥æ‰¾UserControllerçš„ClassLoader123sc -d com.example.demo.arthas.user.UserController | grep classLoaderHash$ sc -d com.example.demo.arthas.user.UserController | grep classLoaderHash classLoaderHash 1be6f5c3 æ³¨æ„hashcodeæ˜¯å˜åŒ–çš„ï¼Œéœ€è¦å…ˆæŸ¥çœ‹å½“å‰çš„ClassLoaderä¿¡æ¯ï¼Œæå–å¯¹åº”ClassLoaderçš„hashcodeã€‚ å¦‚æœä½ ä½¿ç”¨-cï¼Œä½ éœ€è¦æ‰‹åŠ¨è¾“å…¥hashcodeï¼š-c &lt;hashcode&gt; $ ognl -c 1be6f5c3 @com.example.demo.arthas.user.UserController@logger å¯¹äºåªæœ‰å”¯ä¸€å®ä¾‹çš„ClassLoaderå¯ä»¥é€šè¿‡--classLoaderClassæŒ‡å®šclass nameï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼š 123456$ ognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader @org.springframework.boot.SpringApplication@logger@Slf4jLocationAwareLog[ FQCN=@String[org.apache.commons.logging.LogAdapter$Slf4jLocationAwareLog], name=@String[org.springframework.boot.SpringApplication], logger=@Logger[Logger[org.springframework.boot.SpringApplication]],] --classLoaderClass çš„å€¼æ˜¯ClassLoaderçš„ç±»åï¼Œåªæœ‰åŒ¹é…åˆ°å”¯ä¸€çš„ClassLoaderå®ä¾‹æ—¶æ‰èƒ½å·¥ä½œï¼Œç›®çš„æ˜¯æ–¹ä¾¿è¾“å…¥é€šç”¨å‘½ä»¤ï¼Œè€Œ-c &lt;hashcode&gt;æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚ 6.3 è·å–é™æ€ç±»çš„é™æ€å­—æ®µè·å–UserControllerç±»é‡Œçš„loggerå­—æ®µï¼š 1ognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader @com.example.demo.arthas.user.UserController@logger è¿˜å¯ä»¥é€šè¿‡-xå‚æ•°æ§åˆ¶è¿”å›å€¼çš„å±•å¼€å±‚æ•°ã€‚æ¯”å¦‚ï¼š 1ognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader -x 2 @com.example.demo.arthas.user.UserController@logger 6.4 æ‰§è¡Œå¤šè¡Œè¡¨è¾¾å¼ï¼Œèµ‹å€¼ç»™ä¸´æ—¶å˜é‡ï¼Œè¿”å›ä¸€ä¸ªList123456ognl &#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;$ ognl &#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;@ArrayList[ @String[/Library/Java/JavaVirtualMachines/jdk1.8.0_162.jdk/Contents/Home/jre], @String[Java(TM) SE Runtime Environment],] 6.5 æ›´å¤šåœ¨Arthasé‡Œognlè¡¨è¾¾å¼æ˜¯å¾ˆé‡è¦çš„åŠŸèƒ½ï¼Œåœ¨å¾ˆå¤šå‘½ä»¤é‡Œéƒ½å¯ä»¥ä½¿ç”¨ognlè¡¨è¾¾å¼ã€‚ ä¸€äº›æ›´å¤æ‚çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒï¼š OGNLç‰¹æ®Šç”¨æ³•è¯·å‚è€ƒï¼šhttps://github.com/alibaba/arthas/issues/71 OGNLè¡¨è¾¾å¼å®˜æ–¹æŒ‡å—ï¼šhttps://commons.apache.org/proper/commons-ognl/language-guide.html 7. WatchæŸ¥çœ‹å‘½ä»¤7.1 å¦‚ä½•ä½¿ç”¨watch com.example.demo.arthas.user.UserController * &#39;&#123;params, throwExp&#125;&#39; æ‰§è¡Œå®Œä¹‹åï¼Œä¼šé˜»å¡ï¼Œæ­¤æ—¶å¦‚æœæœ‰è¯·æ±‚è¿›æ¥ï¼Œå‘ç”Ÿä¸€åœºçš„è¯ï¼Œå°±ä¼šçœ‹åˆ°å¼‚å¸¸ä¿¡æ¯ã€‚ å¦‚æœæƒ³æŠŠè·å–åˆ°çš„ç»“æœå±•å¼€ï¼Œå¯ä»¥ç”¨-xå‚æ•°ï¼š watch com.example.demo.arthas.user.UserController * &#39;&#123;params, throwExp&#125;&#39; -x 2 7.2 è¿”å›å€¼è¡¨è¾¾å¼åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¿”å›å€¼è¡¨è¾¾å¼ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªognlè¡¨è¾¾å¼ï¼Œå®ƒæ”¯æŒä¸€äº›å†…ç½®å¯¹è±¡ï¼š loader clazz method target params returnObj throwExp isBefore isThrow isReturn ä½ å¯ä»¥åˆ©ç”¨è¿™äº›å†…ç½®å¯¹è±¡æ¥ç»„æˆä¸åŒçš„è¡¨è¾¾å¼ã€‚æ¯”å¦‚è¿”å›ä¸€ä¸ªæ•°ç»„ï¼š 1watch com.example.demo.arthas.user.UserController * &#x27;&#123;params[0], target, returnObj&#125;&#x27; æ›´å¤šå‚è€ƒï¼š https://arthas.aliyun.com/doc/advice-class.html 7.3 æ¡ä»¶è¡¨è¾¾å¼watchå‘½ä»¤æ”¯æŒåœ¨ç¬¬4ä¸ªå‚æ•°é‡Œå†™æ¡ä»¶è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼š watch com.example.demo.arthas.user.UserController * returnObj &#39;params[0] &gt; 100&#39; å½“è®¿é—® localhost:80/user/1æ—¶ï¼Œwatchå‘½ä»¤æ²¡æœ‰è¾“å‡º å½“è®¿é—®localhost:80/user/101æ—¶ï¼Œwatchä¼šæ‰“å°å‡ºç»“æœã€‚ 7.4 å½“å¼‚å¸¸æ—¶æ•è·watchå‘½ä»¤æ”¯æŒ-eé€‰é¡¹ï¼Œè¡¨ç¤ºåªæ•è·æŠ›å‡ºå¼‚å¸¸æ—¶çš„è¯·æ±‚ï¼š watch com.example.demo.arthas.user.UserController * &quot;&#123;params[0],throwExp&#125;&quot; -e 7.5 æŒ‰ç…§è€—æ—¶è¿›è¡Œè¿‡æ»¤watchå‘½ä»¤æ”¯æŒæŒ‰è¯·æ±‚è€—æ—¶è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚ï¼š watch com.example.demo.arthas.user.UserController * &#39;&#123;params, returnObj&#125;&#39; &#39;#cost&gt;200&#39; 8. çƒ­æ›´æ–°ä»£ç ä¸‹é¢ä»‹ç»é€šè¿‡jad/mc/redefine å‘½ä»¤å®ç°åŠ¨æ€æ›´æ–°ä»£ç çš„åŠŸèƒ½ã€‚ ç›®å‰ï¼Œè®¿é—® http://localhost/user/0 ï¼Œä¼šè¿”å›500å¼‚å¸¸ï¼š 12curl http://localhost/user/0&#123;&quot;timestamp&quot;:1550223186170,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;java.lang.IllegalArgumentException&quot;,&quot;message&quot;:&quot;id &lt; 1&quot;,&quot;path&quot;:&quot;/user/0&quot;&#125; ä¸‹é¢é€šè¿‡çƒ­æ›´æ–°ä»£ç ï¼Œä¿®æ”¹è¿™ä¸ªé€»è¾‘ã€‚ 8.1 jadåç¼–è¯‘UserControlleråœ¨arthasä¸­æ‰§è¡Œjadå‘½ä»¤ ğŸ‘‡ jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java jadåç¼–è¯‘çš„ç»“æœä¿å­˜åœ¨ /tmp/UserController.javaæ–‡ä»¶é‡Œäº†ã€‚ åœ¨ã€ æœºå™¨ ã€‘ä¸Šç„¶åç”¨vimæ¥ç¼–è¾‘/tmp/UserController.javaï¼š vim /tmp/UserController.java æ¯”å¦‚å½“ user id å°äº1æ—¶ï¼Œä¹Ÿæ­£å¸¸è¿”å›ï¼Œä¸æŠ›å‡ºå¼‚å¸¸ï¼š 123456789@GetMapping(value=&#123;&quot;/user/&#123;id&#125;&quot;&#125;)public User findUserById(@PathVariable Integer id) &#123; logger.info(&quot;id: &#123;&#125;&quot;, (Object)id); if (id != null &amp;&amp; id &lt; 1) &#123; return new User(id, &quot;name&quot; + id); // throw new IllegalArgumentException(&quot;id &lt; 1&quot;); &#125; return new User(id.intValue(), &quot;name&quot; + id);&#125; 8.2 scæŸ¥æ‰¾åŠ è½½UserControllerçš„ClassLoader123sc -d *UserController | grep classLoaderHash$ sc -d *UserController | grep classLoaderHash classLoaderHash 1be6f5c3 å¯ä»¥å‘ç°æ˜¯ springbootLaunchedURLClassLoader@1be6f5c3 åŠ è½½çš„ã€‚ è®°ä¸‹classLoaderHashï¼Œåé¢éœ€è¦ä½¿ç”¨å®ƒã€‚åœ¨è¿™é‡Œï¼Œå®ƒæ˜¯ 1be6f5c3ã€‚ 8.3 mcç¼–è¯‘javaæ–‡ä»¶ç¼–è¯‘javaæ–‡ä»¶ï¼Œç±»ä¼¼äºjavacã€‚ ä¿å­˜å¥½/tmp/UserController.javaä¹‹åï¼Œä½¿ç”¨mc(Memory Compiler)å‘½ä»¤æ¥ç¼–è¯‘ï¼Œå¹¶ä¸”é€šè¿‡-cæˆ–è€…--classLoaderClasså‚æ•°æŒ‡å®šClassLoaderï¼š 12345mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp$ mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmpMemory compiler output:/tmp/com/example/demo/arthas/user/UserController.classAffect(row-cnt:1) cost in 346 ms ä¹Ÿå¯ä»¥é€šè¿‡mc -c &lt;classLoaderHash&gt; /tmp/UserController.java -d /tmpï¼Œä½¿ç”¨-cå‚æ•°æŒ‡å®šClassLoaderHash: 1$ mc -c 1be6f5c3 /tmp/UserController.java -d /tmp 8.4 redefineåŠ è½½classæ–‡ä»¶å†ä½¿ç”¨redefineå‘½ä»¤é‡æ–°åŠ è½½æ–°ç¼–è¯‘å¥½çš„UserController.classï¼š 123redefine /tmp/com/example/demo/arthas/user/UserController.class$ redefine /tmp/com/example/demo/arthas/user/UserController.classredefine success, size: 1 8.5 çƒ­ä¿®æ”¹ä»£ç ç»“æœredefineæˆåŠŸä¹‹åï¼Œå†æ¬¡è®¿é—® localhost:80/user/0 ï¼Œç»“æœæ˜¯ï¼š 1234&#123; &quot;id&quot;: 0, &quot;name&quot;: &quot;name0&quot;&#125; 9. Exit/Stop9.1 resetArthasåœ¨ watch/trace ç­‰å‘½ä»¤æ—¶ï¼Œå®é™…ä¸Šæ˜¯ä¿®æ”¹äº†åº”ç”¨çš„å­—èŠ‚ç ï¼Œæ’å…¥å¢å¼ºçš„ä»£ç ã€‚æ˜¾å¼æ‰§è¡Œ reset å‘½ä»¤ï¼Œå¯ä»¥æ¸…é™¤æ‰è¿™äº›å¢å¼ºä»£ç ã€‚ 9.2 é€€å‡ºArthasç”¨ exit æˆ–è€… quit å‘½ä»¤å¯ä»¥é€€å‡ºArthasã€‚ é€€å‡ºArthasä¹‹åï¼Œè¿˜å¯ä»¥å†æ¬¡ç”¨ java -jar arthas-boot.jar æ¥è¿æ¥ã€‚ 9.3 å½»åº•é€€å‡ºArthasexit/quitå‘½ä»¤åªæ˜¯é€€å‡ºå½“å‰sessionï¼Œarthas serverè¿˜åœ¨ç›®æ ‡è¿›ç¨‹ä¸­è¿è¡Œã€‚ æƒ³å®Œå…¨é€€å‡ºArthasï¼Œå¯ä»¥æ‰§è¡Œ stop å‘½ä»¤ã€‚ 10. arthas-bootæ”¯æŒçš„å‚æ•°arthas-boot.jar æ”¯æŒå¾ˆå¤šå‚æ•°ï¼Œå¯ä»¥æ‰§è¡Œ java -jar arthas-boot.jar -h æ¥æŸ¥çœ‹ã€‚ 10.1 å…è®¸å¤–éƒ¨è®¿é—®é»˜è®¤æƒ…å†µä¸‹ï¼Œ arthas serverä¾¦å¬çš„æ˜¯ 127.0.0.1 è¿™ä¸ªIPï¼Œå¦‚æœå¸Œæœ›è¿œç¨‹å¯ä»¥è®¿é—®ï¼Œå¯ä»¥ä½¿ç”¨--target-ipçš„å‚æ•°ã€‚ java -jar arthas-boot.jar --target-ip 10.2 åˆ—å‡ºæ‰€æœ‰çš„ç‰ˆæœ¬java -jar arthas-boot.jar --versions ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬ï¼š java -jar arthas-boot.jar --use-version 3.1.0 10.3 åªä¾¦å¬Telnetç«¯å£ï¼Œä¸ä¾¦å¬HTTPç«¯å£java -jar arthas-boot.jar --telnet-port 9999 --http-port -1 10.4 æ‰“å°è¿è¡Œçš„è¯¦æƒ…java -jar arthas-boot.jar -v 11. Web Console","tags":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"}],"categories":[]},{"title":"LeetCode-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—","date":"2021-08-19T13:12:54.000Z","path":"wiki/LeetCode-åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—/","text":"åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x21ib6/ ç»™å®šä¸€ä¸ªéç©ºæ•´æ•°æ•°ç»„ï¼Œé™¤äº†æŸä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ä»¥å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚ è¯´æ˜ï¼š ä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ ç¤ºä¾‹ 1: è¾“å…¥: [2,2,1]è¾“å‡º: 1ç¤ºä¾‹ 2: è¾“å…¥: [4,1,2,1,2]è¾“å‡º: 4ç›¸å…³æ ‡ç­¾ä½è¿ç®— åˆ†æä»…ä»…å‡ºç°ä¸€ä¸ªï¼Œå¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ªæ•°å’Œå‰åéƒ½ä¸ä¸€æ ·ï¼Œç„¶åç‰¹æ®Šåˆ¤æ–­ä¸€ä¸‹å¤´éƒ¨å’Œå°¾éƒ¨å°±å¯ä»¥äº†ã€‚ ä»£ç 1234567891011121314151617181920212223class Solution &#123; public int singleNumber(int[] nums) &#123; if(nums == null || nums.length == 0)&#123; return 0; &#125; if(nums.length == 1)&#123; return nums[0]; &#125; Arrays.sort(nums); for(int i = 2; i &lt; nums.length; i++)&#123; if(nums[i - 2] != nums[i - 1] &amp;&amp; nums[i - 1] != nums[i])&#123; return nums[i - 1]; &#125; if(i == nums.length - 1 &amp;&amp; nums[i] != nums[i - 1])&#123; return nums[i]; &#125; if(i == 2 &amp;&amp; nums[i - 2] != nums[i - 1])&#123; return nums[i - 2]; &#125; &#125; return 0; &#125;&#125; åˆ†æäºŒä½¿ç”¨å¼‚æˆ–è¿ç®—ï¼Œå°†æ‰€æœ‰å€¼è¿›è¡Œå¼‚æˆ–å¼‚æˆ–è¿ç®—ï¼Œç›¸å¼‚ä¸ºçœŸï¼Œç›¸åŒä¸ºå‡ï¼Œæ‰€ä»¥ a^a = 0 ;0^a = aå› ä¸ºå¼‚æˆ–è¿ç®— æ»¡è¶³äº¤æ¢å¾‹ a^b^a = a^a^b = b æ‰€ä»¥æ•°ç»„ç»è¿‡å¼‚æˆ–è¿ç®—ï¼Œå•ç‹¬çš„å€¼å°±å‰©ä¸‹äº† https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x21ib6/?discussion=Mo9fKT ä»£ç äºŒ123456789class Solution &#123; public int singleNumber(int[] nums) &#123; int reduce = 0; for (int num : nums) &#123; reduce = reduce ^ num; &#125; return reduce; &#125;&#125;","tags":[{"name":"ç®€å•","slug":"ç®€å•","permalink":"http://example.com/tags/%E7%AE%80%E5%8D%95/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"http://example.com/tags/%E6%95%B0%E7%BB%84/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"http://example.com/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"}],"categories":[]},{"title":"LeetCode-å­˜åœ¨é‡å¤å…ƒç´ ","date":"2021-08-19T12:57:35.000Z","path":"wiki/LeetCode-å­˜åœ¨é‡å¤å…ƒç´ /","text":"å­˜åœ¨é‡å¤å…ƒç´ https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x248f5/ ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é‡å¤å…ƒç´ ã€‚ å¦‚æœå­˜åœ¨ä¸€å€¼åœ¨æ•°ç»„ä¸­å‡ºç°è‡³å°‘ä¸¤æ¬¡ï¼Œå‡½æ•°è¿”å› true ã€‚å¦‚æœæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ éƒ½ä¸ç›¸åŒï¼Œåˆ™è¿”å› false ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: [1,2,3,1]è¾“å‡º: trueç¤ºä¾‹ 2: è¾“å…¥: [1,2,3,4]è¾“å‡º: falseç¤ºä¾‹ 3: è¾“å…¥: [1,1,1,3,3,4,3,2,4,2]è¾“å‡º: true ä»£ç 1ã€åŒé‡å¾ªç¯æ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä½†æ˜¯ä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ 123456789101112131415class Solution &#123; public boolean containsDuplicate(int[] nums) &#123; if(nums == null || nums.length == 0)&#123; return false; &#125; for(int i = 0; i &lt; nums.length; i++)&#123; for(int j = i + 1; j &lt; nums.length ; j++)&#123; if(nums[i] == nums[j])&#123; return true; &#125; &#125; &#125; return false; &#125;&#125; 2ã€å…ˆæ’åºï¼Œç„¶ååˆ¤æ–­ç›¸é‚»ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ç›¸ç­‰ 1234567891011class Solution &#123; public boolean containsDuplicate(int[] nums) &#123; Arrays.sort(nums); for(int i = 1; i &lt; nums.length; i++) &#123; if (nums[i] == nums[i - 1]) &#123; return true; &#125; &#125; return false; &#125;&#125;","tags":[{"name":"ç®€å•","slug":"ç®€å•","permalink":"http://example.com/tags/%E7%AE%80%E5%8D%95/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"http://example.com/tags/%E6%95%B0%E7%BB%84/"},{"name":"å“ˆå¸Œè¡¨","slug":"å“ˆå¸Œè¡¨","permalink":"http://example.com/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/"},{"name":"æ’åº","slug":"æ’åº","permalink":"http://example.com/tags/%E6%8E%92%E5%BA%8F/"}],"categories":[]},{"title":"LeetCode-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII","date":"2021-08-19T12:35:49.000Z","path":"wiki/LeetCode-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºII/","text":"ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºIIhttps://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x2zsx1/ ç»™å®šä¸€ä¸ªæ•°ç»„ prices ï¼Œå…¶ä¸­ prices[i] æ˜¯ä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰ã€‚ æ³¨æ„ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: prices = [7,1,5,3,6,4]è¾“å‡º: 7è§£é‡Š: åœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚ éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-3 = 3 ã€‚ç¤ºä¾‹ 2: è¾“å…¥: prices = [1,2,3,4,5]è¾“å‡º: 4è§£é‡Š: åœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 5-1 = 4 ã€‚ æ³¨æ„ä½ ä¸èƒ½åœ¨ç¬¬ 1 å¤©å’Œç¬¬ 2 å¤©æ¥è¿è´­ä¹°è‚¡ç¥¨ï¼Œä¹‹åå†å°†å®ƒä»¬å–å‡ºã€‚å› ä¸ºè¿™æ ·å±äºåŒæ—¶å‚ä¸äº†å¤šç¬”äº¤æ˜“ï¼Œä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ã€‚ç¤ºä¾‹ 3: è¾“å…¥: prices = [7,6,4,3,1]è¾“å‡º: 0è§£é‡Š: åœ¨è¿™ç§æƒ…å†µä¸‹, æ²¡æœ‰äº¤æ˜“å®Œæˆ, æ‰€ä»¥æœ€å¤§åˆ©æ¶¦ä¸º 0ã€‚ â°æç¤ºï¼š 1 &lt;= prices.length &lt;= 3 * 1040 &lt;= prices[i] &lt;= 104 åˆ†æ[7,1,5,3,6,4][1,2,3,4,5] å…¶å®è§„å¾‹å¾ˆç®€å•ï¼Œå°±æ¯”è¾ƒå½“å¤©å’Œå‰ä¸€å¤©çš„å¤§å°å…³ç³»å°±å¥½äº†ï¼Œä¸€æ¬¡å¾ªç¯å°±ä¸‹æ¥äº†ã€‚ ä¸€å¼€å§‹æƒ³çš„æ¯”è¾ƒå¤æ‚ï¼Œç”¨çš„æŒ‡é’ˆæ»‘åŠ¨ï¼Œæ¯”å¦‚1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5è¿™ç§ï¼Œä¸€å¼€å§‹æƒ³çš„æ˜¯ 5 - 1 ï¼Œå…¶å® 1 + 1 + 1 + 1å°±è¡Œäº†ã€‚ ä»£ç 12345678910111213141516171819202122class Solution &#123; public int maxProfit(int[] prices) &#123; if(prices == null || prices.length == 0)&#123; return 0; &#125; if(prices.length == 1)&#123; return 0; &#125; int count = 0; int index = 0; // [7,1,5,3,6,4] // [1,2,3,4,5] for(int i = 1; i &lt; prices.length ; i++)&#123; if(prices[i] &gt; prices[i - 1])&#123; count += prices[i] - prices[i - 1]; &#125; &#125; return count; &#125;&#125;","tags":[{"name":"ç®€å•","slug":"ç®€å•","permalink":"http://example.com/tags/%E7%AE%80%E5%8D%95/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"http://example.com/tags/%E6%95%B0%E7%BB%84/"},{"name":"è´ªå¿ƒ","slug":"è´ªå¿ƒ","permalink":"http://example.com/tags/%E8%B4%AA%E5%BF%83/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"http://example.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"}],"categories":[]},{"title":"LeetCode-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹","date":"2021-08-19T11:28:03.000Z","path":"wiki/LeetCode-åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹/","text":"åˆ é™¤æ’åºæ•°ç»„ä¸­çš„é‡å¤é¡¹https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x2gy9m/ ç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ nums ï¼Œè¯·ä½  åŸåœ° åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´  åªå‡ºç°ä¸€æ¬¡ ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚ ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚ è¯´æ˜: ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢? è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥ã€Œå¼•ç”¨ã€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚ ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹: 1234567// nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´int len = removeDuplicates(nums);// åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚// æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­ è¯¥é•¿åº¦èŒƒå›´å†… çš„æ‰€æœ‰å…ƒç´ ã€‚for (int i = 0; i &lt; len; i++) &#123; print(nums[i]);&#125; ç¤ºä¾‹ 1ï¼š è¾“å…¥ï¼šnums = [1,1,2]è¾“å‡ºï¼š2, nums = [1,2]è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2 ï¼Œå¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2 ã€‚ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ç¤ºä¾‹ 2ï¼š è¾“å…¥ï¼šnums = [0,0,1,1,1,2,2,3,3,4]è¾“å‡ºï¼š5, nums = [0,1,2,3,4]è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5 ï¼Œ å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4 ã€‚ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ æç¤ºï¼š 0 &lt;= nums.length &lt;= 3 * 104-104 &lt;= nums[i] &lt;= 104nums å·²æŒ‰å‡åºæ’åˆ— æ€è·¯å‡å¦‚è¾“å…¥ [0,0,1,1,1,2,2,3,3,4] æœ€ç»ˆçš„ç»“æœåº”è¯¥æ˜¯[0,1,2,3,4,2,2,3,3,4] count å˜é‡ç”¨æ¥å­˜å‚¨ä¸é‡å¤æ•°ç»„çš„ä¸ªæ•° offset ä½œä¸ºå½“å‰æ¸¸æ ‡è®°å½•åˆ¤æ–­ä¹‹åä¸é‡å¤çš„æ•°æ®çš„ä½ç½® è§£æ³•123456789101112131415161718class Solution &#123; public int removeDuplicates(int[] nums) &#123; if (nums == null || nums.length == 0)&#123; return 0; &#125; int result = 1; int offset = 1; for (int i = 1;i&lt;nums.length;i++)&#123; if (nums[i] == nums[i - 1])&#123; continue; &#125; nums[offset] = nums[i]; offset++; result++; &#125; return result; &#125;&#125;","tags":[{"name":"ç®€å•","slug":"ç®€å•","permalink":"http://example.com/tags/%E7%AE%80%E5%8D%95/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"http://example.com/tags/%E6%95%B0%E7%BB%84/"},{"name":"åŒæŒ‡é’ˆ","slug":"åŒæŒ‡é’ˆ","permalink":"http://example.com/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"}],"categories":[]},{"title":"MySQLä¸­çš„é”ğŸ”’","date":"2021-08-19T07:17:31.000Z","path":"wiki/MySQLä¸­çš„é”ğŸ”’/","text":"ä¹è§‚é”å’Œæ‚²è§‚é” è¡¨é”å’Œè¡Œé” è¡¨é”ï¼š å¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šåŠ›åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ è¡¨é”æŒ‰ç…§æ•°æ®æ“ä½œå¯ä»¥åˆ†æˆä¸¤ç§ï¼š è¡¨è¯»é”ï¼ˆTable Read Lockï¼‰ è¡¨å†™é”ï¼ˆTable Write Lock è¯»è¯»ä¸é˜»å¡ï¼šå½“å‰ç”¨æˆ·åœ¨è¯»æ•°æ®ï¼Œå…¶ä»–çš„ç”¨æˆ·ä¹Ÿåœ¨è¯»æ•°æ®ï¼Œä¸ä¼šåŠ é” è¯»å†™é˜»å¡ï¼šå½“å‰ç”¨æˆ·åœ¨è¯»æ•°æ®ï¼Œå…¶ä»–çš„ç”¨æˆ·ä¸èƒ½ä¿®æ”¹å½“å‰ç”¨æˆ·è¯»çš„æ•°æ®ï¼Œä¼šåŠ é”ï¼ å†™å†™é˜»å¡ï¼šå½“å‰ç”¨æˆ·åœ¨ä¿®æ”¹æ•°æ®ï¼Œå…¶ä»–çš„ç”¨æˆ·ä¸èƒ½ä¿®æ”¹å½“å‰ç”¨æˆ·æ­£åœ¨ä¿®æ”¹çš„æ•°æ®ï¼Œä¼šåŠ é”ï¼ è¡Œé”ï¼š å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡ä½ï¼Œå¹¶å‘åº¦é«˜ InnoDBå®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ã€‚ å…±äº«é”ï¼ˆSé”ï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’ä»–é”ã€‚ ä¹Ÿå«åšè¯»é”ï¼šè¯»é”æ˜¯å…±äº«çš„ï¼Œå¤šä¸ªå®¢æˆ·å¯ä»¥åŒæ—¶è¯»å–åŒä¸€ä¸ªèµ„æºï¼Œä½†ä¸å…è®¸å…¶ä»–å®¢æˆ·ä¿®æ”¹ã€‚ æ’ä»–é”ï¼ˆXé”)ï¼šå…è®¸è·å¾—æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡å–å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«è¯»é”å’Œæ’ä»–å†™é”ã€‚ ä¹Ÿå«åšå†™é”ï¼šå†™é”æ˜¯æ’ä»–çš„ï¼Œå†™é”ä¼šé˜»å¡å…¶ä»–çš„å†™é”å’Œè¯»é”ã€‚ å¦å¤–ï¼Œä¸ºäº†å…è®¸è¡Œé”å’Œè¡¨é”å…±å­˜ï¼Œå®ç°å¤šç²’åº¦é”æœºåˆ¶ï¼ŒInnoDBè¿˜æœ‰ä¸¤ç§å†…éƒ¨ä½¿ç”¨çš„æ„å‘é”ï¼ˆIntention Locksï¼‰ï¼Œè¿™ä¸¤ç§æ„å‘é”éƒ½æ˜¯è¡¨é”ï¼š æ„å‘å…±äº«é”ï¼ˆISï¼‰ï¼šäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œå…±äº«é”ï¼Œäº‹åŠ¡åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ISé”ã€‚ æ„å‘æ’ä»–é”ï¼ˆIXï¼‰ï¼šäº‹åŠ¡æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œæ’ä»–é”ï¼Œäº‹åŠ¡åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡ŒåŠ æ’ä»–é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„IXé”ã€‚ æ„å‘é”ä¹Ÿæ˜¯æ•°æ®åº“éšå¼å¸®æˆ‘ä»¬åšäº†ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ“å¿ƒï¼ âš ï¸ InnoDBè¡Œé”å’Œè¡¨é”éƒ½æ”¯æŒï¼MyISAMåªæ”¯æŒè¡¨é”ï¼ innoDBä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°è¡Œé”ï¼ŸInnoDBåªæœ‰é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®æ‰ä½¿ç”¨è¡Œçº§é”ï¼Œå¦åˆ™ï¼ŒInnoDBå°†ä½¿ç”¨è¡¨é” å‚è€ƒèµ„æ–™æ•°æ®åº“ä¸¤å¤§ç¥å™¨ã€ç´¢å¼•å’Œé”ã€‘ åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[]},{"title":"MySQLæ€§èƒ½è°ƒä¼˜","date":"2021-08-19T06:06:45.000Z","path":"wiki/MySQLæ€§èƒ½è°ƒä¼˜/","text":"1ã€ä½¿ç”¨ã€ è¦†ç›–ç´¢å¼• ã€‘é¿å…å›è¡¨é”é€ æˆçš„æ—¶é—´æ¶ˆè€—1ã€æŸ¥è¯¢è¯­å¥çš„æ—¶å€™é¿å…ä½¿ç”¨select * 2ã€åˆ›å»ºç´¢å¼•æ·»åŠ é€‚å½“çš„åˆ—é¿å…å›è¡¨ 2ã€ä½¿ç”¨ã€ è”åˆç´¢å¼• ã€‘åŒºåˆ†åº¦æ¯”è¾ƒé«˜çš„åˆ—æ”¾åˆ°å‰é¢æ³¨æ„è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™ 3ã€å¯¹ç´¢å¼•è¿›è¡Œå‡½æ•°è®¡ç®—æˆ–è€…è¡¨è¾¾å¼è®¡ç®—ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ ğŸ”’4ã€åˆ©ç”¨å­æŸ¥è¯¢ä¼˜åŒ–è¶…å¤šåˆ†é¡µåœºæ™¯5ã€explainå‘½ä»¤æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ show profileæŸ¥è¯¢æ‰§è¡Œçš„æ€§èƒ½æ¶ˆè€—é¢è¯•å‰å¿…é¡»çŸ¥é“çš„MySQLå‘½ä»¤ã€expalinã€‘ -3y 6ã€åœ¨äº‹åŠ¡å¼€å§‹åï¼Œäº‹åŠ¡å†…å°½å¯èƒ½åªæ“ä½œæ•°æ®åº“ï¼Œå‡å°‘é”æŒæœ‰æ—¶é—´7ã€å°½é‡é¿å…å­—ç¬¦ä¸²æŸ¥è¯¢ï¼Œå¦‚æœå…è®¸çš„è¯å¯ä»¥ä½¿ç”¨Elasticsearch8ã€å¦‚æœä¼˜åŒ–éƒ½åšäº†è¿˜æ˜¯æŸ¥è¯¢çš„å¾ˆæ…¢ï¼Œå¯ä»¥åšä¸€äº›èšåˆè¡¨ï¼Œçº¿ä¸Šçš„ä¸šåŠ¡ç›´æ¥æŸ¥èšåˆä¹‹åçš„æ•°æ®9ã€è¯»å†™ç“¶é¢ˆé—®é¢˜9.1 å¦‚æœæ˜¯å•åº“çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘è¯»å†™åˆ†ç¦»ï¼Œæå‡è¯»/å†™çš„æ€§èƒ½ 9.2 ä¸»ä»ç»“æ„ä¸‹è¿˜æ˜¯å­˜åœ¨ç“¶é¢ˆçš„è¯ï¼Œå¯ä»¥è€ƒè™‘åˆ†åº“åˆ†è¡¨ æ³¨æ„ åˆ†åº“åˆ†è¡¨ä¸‹çš„idå°½é‡ä¿è¯é€’å¢","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[]},{"title":"kafka-åŸºç¡€çŸ¥è¯†","date":"2021-08-18T12:05:29.000Z","path":"wiki/kafka-åŸºç¡€çŸ¥è¯†/","text":"kafkaæ˜¯ä»€ä¹ˆkafkaè¿è¡Œæ—¶æ¶æ„kafkaä¸ºä»€ä¹ˆèƒ½æ‰¿è½½é«˜å¹¶å‘kafkaçš„ç¡®è®¤æœºåˆ¶æ˜¯ä»€ä¹ˆkafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯å‡†ç¡®kafkaä¼šä¸¢æ¶ˆæ¯å—ï¼Ÿ kafkaä¼šé‡å¤æ¶ˆè´¹æ¶ˆæ¯å— å¹‚ç­‰æ€§ æ¶ˆæ¯é¡ºåºæ¶ˆè´¹é—®é¢˜å‚è€ƒèµ„æ–™kafkaåŸºç¡€çŸ¥è¯† - yyy","tags":[{"name":"kafka","slug":"kafka","permalink":"http://example.com/tags/kafka/"}],"categories":[]},{"title":"Spring-äº‹åŠ¡éš”ç¦»","date":"2021-08-18T03:10:21.000Z","path":"wiki/Spring-äº‹åŠ¡éš”ç¦»/","text":"å‚è€ƒèµ„æ–™https://juejin.cn/post/6854573219916021767","tags":[],"categories":[]},{"title":"Flink-ç‰©ç†åˆ†åŒºå‡½æ•°","date":"2021-08-12T08:38:31.000Z","path":"wiki/Flink-ç‰©ç†åˆ†åŒºå‡½æ•°/","text":"Flinkæä¾›çš„8ç§åˆ†åŒºå‡½æ•°GlobalPartitionerè¯¥åˆ†åŒºå™¨ä¼šå°†æ‰€æœ‰çš„æ•°æ®éƒ½å‘é€åˆ°ä¸‹æ¸¸çš„æŸä¸ªç®—å­å®ä¾‹(subtask id = 0) 12345678910111213// æ•°æ®ä¼šè¢«åˆ†å‘åˆ°ä¸‹æ¸¸ç®—å­çš„ç¬¬ä¸€ä¸ªå®ä¾‹ä¸­è¿›è¡Œå¤„ç† public static void global() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setMaxParallelism(8); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); dataStream.flatMap(new RichFlatMapFunction&lt;String, String&gt;() &#123; @Override public void flatMap(String s, Collector&lt;String&gt; collector) throws Exception &#123; collector.collect(s + &quot;_**&quot;); &#125; &#125;).setParallelism(2).global().print(&quot;global : &quot;); env.execute(); &#125; ShufflePartitioneréšæœºé€‰æ‹©ä¸€ä¸ªä¸‹æ¸¸ç®—å­å®ä¾‹è¿›è¡Œå‘é€ 12345678//æ•°æ®ä¼šè¢«éšæœºåˆ†å‘åˆ°ä¸‹æ¸¸ç®—å­çš„æ¯ä¸€ä¸ªå®ä¾‹ä¸­è¿›è¡Œ public static void shuffle() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); DataStream&lt;String&gt; broadcast = dataStream.shuffle(); broadcast.print(&quot;shuffle : &quot;); env.execute(); &#125; BroadcastPartitionerå‘é€åˆ°ä¸‹æ¸¸æ‰€æœ‰çš„ç®—å­å®ä¾‹ 12345678//å¹¿æ’­åˆ†åŒºä¼šå°†ä¸Šæ¸¸æ•°æ®è¾“å‡ºåˆ°ä¸‹æ¸¸ç®—å­çš„æ¯ä¸ªå®ä¾‹ä¸­ã€‚é€‚åˆäºå¤§æ•°æ®é›†å’Œå°æ•°æ®é›†åšJionçš„åœºæ™¯ public static void broadcast() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); DataStream&lt;String&gt; broadcast = dataStream.broadcast(); broadcast.print(&quot;broadcast : &quot;); env.execute(); &#125; RebalancePartitioneré€šè¿‡å¾ªç¯çš„æ–¹å¼ä¾æ¬¡å‘é€åˆ°ä¸‹æ¸¸çš„task 123456789101112public static void rebalance() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setParallelism(4); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); dataStream.map(new RichMapFunction&lt;String, String&gt;() &#123; @Override public String map(String s) throws Exception &#123; return s + &quot;_**&quot;; &#125; &#125;).setParallelism(1).rebalance().print(&quot;rebalance : &quot;); env.execute(); &#125; RescalePartitioner123456789101112131415/** * è¿™ç§åˆ†åŒºå™¨ä¼šæ ¹æ®ä¸Šä¸‹æ¸¸ç®—å­çš„å¹¶è¡Œåº¦ï¼Œå¾ªç¯çš„æ–¹å¼è¾“å‡ºåˆ°ä¸‹æ¸¸ç®—å­çš„æ¯ä¸ªå®ä¾‹ã€‚è¿™é‡Œæœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œå‡è®¾ä¸Šæ¸¸å¹¶è¡Œåº¦ä¸º 2ï¼Œç¼–å·ä¸º A å’Œ Bã€‚ä¸‹æ¸¸å¹¶è¡Œåº¦ä¸º 4ï¼Œç¼–å·ä¸º 1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚é‚£ä¹ˆ A åˆ™æŠŠæ•°æ®å¾ªç¯å‘é€ç»™ 1 å’Œ 2ï¼ŒB åˆ™æŠŠæ•°æ®å¾ªç¯å‘é€ç»™ 3 å’Œ 4ã€‚å‡è®¾ä¸Šæ¸¸å¹¶è¡Œåº¦ä¸º 4ï¼Œç¼–å·ä¸º Aï¼ŒBï¼ŒCï¼ŒDã€‚ä¸‹æ¸¸å¹¶è¡Œåº¦ä¸º 2ï¼Œç¼–å·ä¸º 1ï¼Œ2ã€‚é‚£ä¹ˆ A å’Œ B åˆ™æŠŠæ•°æ®å‘é€ç»™ 1ï¼ŒC å’Œ D åˆ™æŠŠæ•°æ®å‘é€ç»™ 2ã€‚ */ public static void rescale() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setParallelism(4); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); dataStream.map(new RichMapFunction&lt;String, String&gt;() &#123; @Override public String map(String s) throws Exception &#123; return s + &quot;_**&quot;; &#125; &#125;).setParallelism(1).rescale().print(&quot;rescale : &quot;); env.execute(); &#125; ForwardPartitionerå‘é€åˆ°ä¸‹æ¸¸å¯¹åº”çš„ç¬¬ä¸€ä¸ªtaskï¼Œä¿è¯ä¸Šä¸‹æ¸¸ç®—å­å¹¶è¡Œåº¦ä¸€è‡´ï¼Œå³ä¸Šæœ‰ç®—å­ä¸ä¸‹æ¸¸ç®—å­æ˜¯1:1çš„å…³ç³» 12345678//ç”¨äºå°†è®°å½•è¾“å‡ºåˆ°ä¸‹æ¸¸æœ¬åœ°çš„ç®—å­å®ä¾‹ã€‚å®ƒè¦æ±‚ä¸Šä¸‹æ¸¸ç®—å­å¹¶è¡Œåº¦ä¸€æ ·ã€‚ç®€å•çš„è¯´ï¼ŒForwardPartitionerç”¨æ¥åšæ•°æ®çš„æ§åˆ¶å°æ‰“å°ã€‚ public static void forward() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setParallelism(1); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;ggg&quot;, &quot;fff&quot;, &quot;ddd&quot;, &quot;sss&quot;, &quot;aaa&quot;, &quot;qqq&quot;, &quot;www&quot;); DataStream&lt;String&gt; broadcast = dataStream.shuffle(); broadcast.print(&quot;shuffle : &quot;); env.execute(); &#125; âš ï¸ åœ¨ä¸Šä¸‹æ¸¸çš„ç®—å­æ²¡æœ‰æŒ‡å®šåˆ†åŒºå™¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä¸Šä¸‹æ¸¸çš„ç®—å­å¹¶è¡Œåº¦ä¸€è‡´ï¼Œåˆ™ä½¿ç”¨ForwardPartitionerï¼Œå¦åˆ™ä½¿ç”¨RebalancePartitionerï¼Œå¯¹äºForwardPartitionerï¼Œå¿…é¡»ä¿è¯ä¸Šä¸‹æ¸¸ç®—å­å¹¶è¡Œåº¦ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ KeyByPartitioneræ ¹æ®keyçš„åˆ†ç»„ç´¢å¼•é€‰æ‹©å‘é€åˆ°ç›¸å¯¹åº”çš„ä¸‹æ¸¸subtask 123456789101112public static void keyBy() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setMaxParallelism(8); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhh&quot;, &quot;hhh&quot;, &quot;hhh&quot;, &quot;hhh&quot;, &quot;sss&quot;, &quot;sss&quot;, &quot;sss&quot;, &quot;www&quot;); dataStream.flatMap(new RichFlatMapFunction&lt;String, String&gt;() &#123; @Override public void flatMap(String s, Collector&lt;String&gt; collector) throws Exception &#123; collector.collect(s + &quot;_**&quot;); &#125; &#125;).keyBy(String::toString).print(&quot;keyBy : &quot;); env.execute(); &#125; CustomPartitionerWrapperé€šè¿‡Partitionerå®ä¾‹çš„partitionæ–¹æ³•(è‡ªå®šä¹‰çš„)å°†è®°å½•è¾“å‡ºåˆ°ä¸‹æ¸¸ã€‚ 1234567891011121314151617181920212223public static void custom() throws Exception &#123; StreamExecutionEnvironment env = getEnv().setMaxParallelism(8); DataStreamSource&lt;String&gt; dataStream = env.fromElements(&quot;hhhh&quot;, &quot;hhhss&quot;, &quot;hhh&quot;, &quot;hhh&quot;, &quot;sss&quot;, &quot;sss&quot;, &quot;sss&quot;, &quot;www&quot;); dataStream.flatMap(new RichFlatMapFunction&lt;String, String&gt;() &#123; @Override public void flatMap(String s, Collector&lt;String&gt; collector) throws Exception &#123; collector.collect(s + &quot;_**&quot;); &#125; &#125;).partitionCustom(new CustomPartitioner(),String::toString) .print(&quot;custom :&quot;); env.execute(); &#125; public static class CustomPartitioner implements Partitioner&lt;String&gt; &#123; // key: æ ¹æ®keyçš„å€¼æ¥åˆ†åŒº // numPartitions: ä¸‹æ¸¸ç®—å­å¹¶è¡Œåº¦ @Override public int partition(String key, int numPartitions) &#123; return key.length() % numPartitions;//åœ¨æ­¤å¤„å®šä¹‰åˆ†åŒºç­–ç•¥ &#125; &#125; Flinkçš„å…«ç§åˆ†åŒºç­–ç•¥æºç è§£è¯» Apache Flink ä¸­æ–‡æ–‡æ¡£","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"Flink-UDFå‡½æ•°ç±»","date":"2021-08-12T06:36:09.000Z","path":"wiki/Flink-UDFå‡½æ•°ç±»/","text":"å‡½æ•°ç±»æ¯”å¦‚è¯´æˆ‘ä»¬å¸¸ç”¨çš„MapFunctionï¼ŒFilterFunctionï¼ŒProcessFunctionç­‰ï¼Œæ¯ä¸€æ­¥æ“ä½œéƒ½åŸºæœ¬ä¸Šéƒ½å¯¹åº”ä¸€ä¸ªFunctionã€‚ 12345678910public static class MyFlatMapper implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; // é¦–å…ˆæŒ‰ç…§ç©ºæ ¼åˆ†è¯ String[] words = s.split(&quot; &quot;); // éå†æ‰€æœ‰çš„word åŒ…è£…æˆäºŒå…ƒç»„è¾“å‡º for (String word : words) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(word, 1)); &#125; &#125;&#125; âš ï¸ ç®€å•æ»šåŠ¨èšåˆå‡½æ•°ï¼Œæ¯”å¦‚sumï¼Œmaxæ˜¯ä¸éœ€è¦Functionã€‚ å¥½å¤„ï¼š 1ã€é€šç”¨å‹å¼ºï¼Œå¯å¤ç”¨ 2ã€å¯æŠ½è±¡æ–¹æ³•ï¼Œä»£ç ç®€æ´ åŒ¿åå‡½æ•°ä¸éœ€è¦å•ç‹¬å®šä¹‰Functionï¼Œç›´æ¥åœ¨Streamçš„æ“ä½œä¸­ç›´æ¥å®ç°ï¼Œæ•ˆæœå’Œä¸Šé¢ğŸ‘†çš„å®Œå…¨ä¸€æ ·ã€‚ 1234567DataStream&lt;SensorReading&gt; dataStream = unionStream.map(new MapFunction&lt;String, SensorReading&gt;() &#123; @Override public SensorReading map(String s) throws Exception &#123; String[] strings = s.split(&quot;,&quot;); return new SensorReading(strings[0], new Double(strings[1]), new Double(strings[2])); &#125;&#125;); å¯Œå‡½æ•°â€˜â€˜å¯Œå‡½æ•°â€™â€™æ˜¯DataStream API æä¾›çš„ä¸€ä¸ªå‡½æ•°ç±»çš„æ¥å£ï¼Œæ‰€æœ‰Flinkå‡½æ•°ç±»éƒ½æœ‰å…¶Richç‰ˆæœ¬ï¼Œå®ƒä¸å¸¸è§„å‡½æ•°çš„ä¸åŒåœ¨äºï¼Œå¯ä»¥è·å–è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶åŒ…å«ä¸€äº›å£°æ˜å‘¨æœŸæ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ›´åŠ å¤æ‚çš„åŠŸèƒ½ã€‚ RichMapFunctionï¼ŒRichFlatMapFunctionç­‰ç­‰ Rich Functionæœ‰ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œå…¸å‹çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æœ‰ ğŸ‘‡ open() æ–¹æ³•æ˜¯rich functionçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç®—å­æ¯”å¦‚mapè¢«è°ƒç”¨ä¹‹å‰è¢«è°ƒç”¨ã€‚ close()æ–¹æ³•æ˜¯ç”Ÿå‘½å‘¨æœŸä¸­æœ€åä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œã€‚ å¦‚æœæœ‰å¤šä¸ªåˆ†åŒºçš„è¯ï¼Œæ¯ä¸ªåˆ†åŒºçš„openæ–¹æ³•å’Œcloseæ–¹æ³•éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ getRuntimeContext()è·å–è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243public class RichFunctionDemo &#123; public static void main(String[] args) throws Exception &#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStreamSource&lt;String&gt; dataSource = env.socketTextStream(&quot;localhost&quot;, 9999); DataStream&lt;SensorReading&gt; dataStream = dataSource.map(new MapFunction&lt;String, SensorReading&gt;() &#123; @Override public SensorReading map(String s) throws Exception &#123; String[] strings = s.split(&quot;,&quot;); return new SensorReading(strings[0], new Long(strings[1]), new Double(strings[2])); &#125; &#125;); DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; stream = dataStream.map(new MyMapFunction()); stream.print(); env.execute(); &#125; // å¯Œå‡½æ•°æ˜¯æŠ½è±¡ç±»ï¼Œè¿™é‡Œè¦ç”¨ç»§æ‰¿ public static class MyMapFunction extends RichMapFunction&lt;SensorReading, Tuple2&lt;String, Integer&gt;&gt; &#123; @Override public void open(Configuration parameters) throws Exception &#123; System.err.println(&quot;invoke open&quot;); // ä¸€èˆ¬å®šä¹‰çŠ¶æ€ï¼Œæˆ–è€…é“¾æ¥æ•°æ®åº“æ“ä½œ super.open(parameters); &#125; @Override public Tuple2&lt;String, Integer&gt; map(SensorReading sensorReading) throws Exception &#123; RuntimeContext runtimeContext = this.getRuntimeContext(); System.err.println(&quot;runtimeContext.getTaskName() : &quot; + runtimeContext.getTaskName()); return new Tuple2&lt;&gt;(sensorReading.getSersorId(), runtimeContext.getIndexOfThisSubtask()); &#125; @Override public void close() throws Exception &#123; super.close(); System.err.println(&quot;invoke close method&quot;); &#125; &#125;&#125;","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"Flink-åˆ°åº•æ”¯æŒå¤šå°‘ç§æ•°æ®ç±»å‹","date":"2021-08-11T11:50:41.000Z","path":"wiki/Flink-åˆ°åº•æ”¯æŒå¤šå°‘ä¸­æ•°æ®ç±»å‹/","text":"Flinkæ”¯æŒæ‰€æœ‰çš„Javaå’ŒScalaåŸºç¡€æ•°æ®ç±»å‹ä»¥åŠå…¶åŒ…è£…ç±»å‹ æ”¯æŒTupleå…ƒç»„ç±»å‹ï¼ŒFlinkåœ¨Java APIä¸­å®šä¹‰äº†å¾ˆå¤šTupleçš„å®ç°ç±»ï¼Œä»Tuple0 ~ Tuple25ç±»å‹ Scalaæ ·ä¾‹ç±» case classï¼Œå¯¹åº”Javaä¸­çš„POJOç±»å¯¹è±¡(å¿…é¡»æä¾›æ— å‚æ„é€ æ–¹æ³• get/set) å…¶ä»–ï¼Œæ¯”å¦‚ Arrays , Lists, Maps, Enumsç­‰éƒ½æ˜¯æ”¯æŒçš„","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"Flink-å¦‚ä½•è¯»å–æ•°æ®æºï¼ˆé›†åˆï½œæ–‡ä»¶ï½œè‡ªå®šä¹‰ï½œKafkaç­‰ï¼‰","date":"2021-08-11T11:50:11.000Z","path":"wiki/Flink-å¦‚ä½•è¯»å–æ•°æ®æºï¼ˆé›†åˆï½œæ–‡ä»¶ï½œè‡ªå®šä¹‰ï½œKafkaç­‰ï¼‰/","text":"è¯»å–æ–‡ä»¶è¿™é‡Œæ˜¯ä»¥txtæ–‡ä»¶ä¸ºä¾‹ï¼Œå®ç°WordCountï¼Œå…¶ä»–æ–‡ä»¶ç±»å‹åŒç†ã€‚ 12345678910111213141516171819202122232425 public static void main(String[] args) throws Exception &#123; // 1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // 2ã€è¯»å–æ–‡ä»¶æ•°æ® String inputPath = &quot;/Users/gaolei/Documents/DemoProjects/flink-start/src/main/resources/hello.txt&quot;; DataSource&lt;String&gt; dataSource = env.readTextFile(inputPath); // å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç† æŒ‰ç…§ç©ºæ ¼åˆ†è¯å±•å¼€ è½¬æ¢æˆï¼ˆwordï¼Œ1ï¼‰äºŒå…ƒç»„ AggregateOperator&lt;Tuple2&lt;String, Integer&gt;&gt; result = dataSource.flatMap(new MyFlatMapper()) // æŒ‰ç…§ç¬¬ä¸€ä¸ªä½ç½® -&gt; word åˆ†ç»„ .groupBy(0) .sum(1); result.print(); &#125; public static class MyFlatMapper implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; // é¦–å…ˆæŒ‰ç…§ç©ºæ ¼åˆ†è¯ String[] words = s.split(&quot; &quot;); // éå†æ‰€æœ‰çš„word åŒ…è£…æˆäºŒå…ƒç»„è¾“å‡º for (String word : words) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(word, 1)); &#125; &#125;&#125; å®ç°è‡ªå®šä¹‰æ•°æ®æºéœ€è¦è‡ªå·±å†™ä¸€ä¸ªç±»ï¼Œå®ç°SourceFunctionæ¥å£çš„runæ–¹æ³•å’Œcancleæ–¹æ³•ï¼Œæ³¨æ„âš ï¸ï¼ŒSourceFunctionçš„æ³›å‹ç±»å‹å¿…é¡»è¦å†™ä¸Šï¼Œä¸ç„¶ä¼šæŠ¥é”™çš„ã€‚ 1234567891011121314151617181920212223242526272829303132public static void main(String[] args) throws Exception &#123; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment().setParallelism(1); DataStreamSource dataStreamSource = env.addSource(new MySourceFunction()); dataStreamSource.print(); env.execute(); &#125; // å®ç°è‡ªå®šä¹‰çš„source public static class MySourceFunction implements SourceFunction&lt;SensorReading&gt; &#123; // å®šä¹‰æ ‡è¯†ä½ æ§åˆ¶æ•°æ®äº§ç”Ÿ private boolean running = true; public void run(SourceContext ctx) throws Exception &#123; // å®šä¹‰å„ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ HashMap&lt;String, Double&gt; sensorMap = new HashMap&lt;String, Double&gt;(10); for (int i = 0; i &lt; 10; i++) &#123; sensorMap.put(&quot;sensor_&quot; + (i + 1), 60 + new Random().nextGaussian() * 20); &#125; while (running) &#123; for (String sensor : sensorMap.keySet()) &#123; double newtemp = sensorMap.get(sensor) + new Random().nextGaussian(); sensorMap.put(sensor, newtemp); ctx.collect(new SensorReading(sensor, System.currentTimeMillis(), newtemp)); &#125; Thread.sleep(10000); &#125; &#125; public void cancel() &#123; running = false; &#125; &#125;","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"Flink-ä½ æ‰€çŸ¥é“çš„ç®—å­éƒ½åœ¨è¿™","date":"2021-08-11T11:49:20.000Z","path":"wiki/Flink-ä½ æ‰€çŸ¥é“çš„ç®—å­éƒ½åœ¨è¿™/","text":"å¥½äº†ï¼Œçœ‹åˆ°è¿™çš„è¯ï¼ŒApache FlinkåŸºç¡€æ¦‚å¿µå•¥çš„éƒ½åº”è¯¥äº†è§£å·®ä¸å¤šäº†å§ï¼Œæˆ‘ä»¬å‡ å¤©å°±Seeä¸€ä¸‹ï¼Œå¹³æ—¶ç”¨åˆ°çš„StreamApiä¸­å„å¼å„æ ·çš„ç®—å­éƒ½æœ‰ä»€ä¹ˆï¼Œç„¶åï¼Œæˆ‘ä»¬æç‚¹Demoè¯•ä¸€ä¸‹ã€‚ ğŸ“’ æˆ‘ä¹Ÿæ˜¯è¾¹å­¦è¾¹å®ç°ä¸€äº›Demo,è¿™æ ·å‘¢å¯ä»¥æ–¹ä¾¿è‡ªå·±ç†è§£ï¼Œå½¢æˆä½“ç³»ä»¥åä¹Ÿåº”è¯¥èƒ½å¸®åˆ°åˆ«äººå¿«é€Ÿå­¦ä¹ å§ã€‚ è¿™å°±æ˜¯åœ°å€äº†ğŸ‘‰ https://github.com/geekibli/flink-study æ¬¢è¿starï¼ ä¸‹é¢çš„Demoéƒ½æ˜¯å¯ä»¥ç›´æ¥è¿è¡Œçš„ å¦‚æœæ˜¯é€šè¿‡socketè·å–æ•°æ®çš„è¯ï¼Œç¡®è®¤ç°å¼€å¯ç«¯å£å•Šï¼Œæˆ‘ç”¨çš„Macç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ nc -lk 9999 æä¾›ä¸€ä¸ªå…¨å±€è·å–ç¯å¢ƒçš„æ–¹æ³•æˆ‘ä»¬ä¸€ä¸ªé™æ€æ–¹æ³•getEnv(), ä¸ç„¶æ¯æ¬¡è¿˜è¦newï¼ŒæŒºéº»çƒ¦çš„ï¼› 123private static StreamExecutionEnvironment getEnv() &#123; return StreamExecutionEnvironment.getExecutionEnvironment();&#125; POJOç±»12345public class SensorReading implements Serializable &#123; private String sersorId; private double timestamp; private double newtemp;&#125; map12345678910111213141516public static void mapTest() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); ArrayList&lt;Integer&gt; nums = Lists.newArrayList(); nums.add(1); nums.add(2); nums.add(3); DataStreamSource&lt;Integer&gt; source = env.fromCollection(nums); SingleOutputStreamOperator&lt;Integer&gt; map = source.map(new MapFunction&lt;Integer, Integer&gt;() &#123; @Override public Integer map(Integer integer) throws Exception &#123; return integer * integer; &#125; &#125;); map.print(); env.execute();&#125; keyBy123456789101112131415161718192021public static void keyByTest() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); DataStreamSource&lt;Tuple2&lt;String, Integer&gt;&gt; source = env.fromElements( new Tuple2&lt;String, Integer&gt;(&quot;age&quot;, 1), new Tuple2&lt;String, Integer&gt;(&quot;name&quot;, 2), new Tuple2&lt;String, Integer&gt;(&quot;name&quot;, 3), new Tuple2&lt;String, Integer&gt;(&quot;name&quot;, 3)); source.map( new MapFunction&lt;Tuple2&lt;String, Integer&gt;, Tuple2&lt;String, Integer&gt;&gt;() &#123; @Override public Tuple2&lt;String, Integer&gt; map(Tuple2&lt;String, Integer&gt; stringIntegerTuple2) throws Exception &#123; Integer f1 = stringIntegerTuple2.f1; stringIntegerTuple2.setField(f1 + 10, 1); return stringIntegerTuple2; &#125; &#125;) .keyBy(1) .print(); env.execute(); &#125; reduce12345678910111213141516171819public static void reduceTest() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); env.fromElements( Tuple2.of(2L, 3L), Tuple2.of(1L, 5L), Tuple2.of(1L, 5L), Tuple2.of(1L, 7L), Tuple2.of(2L, 4L), Tuple2.of(1L, 5L)) .keyBy(1) .reduce(new ReduceFunction&lt;Tuple2&lt;Long, Long&gt;&gt;() &#123; @Override public Tuple2&lt;Long, Long&gt; reduce(Tuple2&lt;Long, Long&gt; longLongTuple2, Tuple2&lt;Long, Long&gt; t1) throws Exception &#123; return new Tuple2&lt;Long, Long&gt;(t1.f0, longLongTuple2.f1 + t1.f1); &#125; &#125;) .print(); env.execute();&#125; è¿˜æœ‰ä¸€ä¸ªæ —å­ğŸŒ° 123456789101112131415161718192021222324public static void reduce() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); DataStreamSource&lt;String&gt; dataSource = env.socketTextStream(&quot;localhost&quot;, 9999); DataStream&lt;SensorReading&gt; dataStream = dataSource.map(new MapFunction&lt;String, SensorReading&gt;() &#123; @Override public SensorReading map(String s) throws Exception &#123; String[] strings = s.split(&quot;,&quot;); return new SensorReading(strings[0], new Long(strings[1]), new Double(strings[2])); &#125; &#125;); DataStream&lt;SensorReading&gt; sersorId = dataStream.keyBy(&quot;sersorId&quot;) .reduce(new ReduceFunction&lt;SensorReading&gt;() &#123; @Override public SensorReading reduce(SensorReading sensorReading, SensorReading t1) throws Exception &#123; String id = t1.getSersorId(); Double time = t1.getTimestamp(); return new SensorReading(id, time, Math.max(sensorReading.getNewtemp(), t1.getNewtemp())); &#125; &#125;); sersorId.print(); env.execute();&#125; split|select12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public static void splitTest() throws Exception &#123; StreamExecutionEnvironment env = getEnv(); DataStreamSource&lt;String&gt; dataSource = env.socketTextStream(&quot;localhost&quot;, 9999); DataStream&lt;SensorReading&gt; dataStream = dataSource.map(new MapFunction&lt;String, SensorReading&gt;() &#123; @Override public SensorReading map(String s) throws Exception &#123; String[] strings = s.split(&quot;,&quot;); return new SensorReading(strings[0], new Double(strings[1]), new Double(strings[2])); &#125; &#125;); SplitStream&lt;SensorReading&gt; split = dataStream.split(new OutputSelector&lt;SensorReading&gt;() &#123; @Override public Iterable&lt;String&gt; select(SensorReading value) &#123; return (value.getNewtemp() &gt; 30) ? Collections.singleton(&quot;high&quot;) : Collections.singleton(&quot;low&quot;); &#125; &#125;); DataStream&lt;SensorReading&gt; low = split.select(&quot;low&quot;); DataStream&lt;SensorReading&gt; high = split.select(&quot;high&quot;); DataStream&lt;SensorReading&gt; all = split.select(&quot;high&quot;, &quot;low&quot;); // connect DataStream&lt;Tuple2&lt;String, Double&gt;&gt; highStream = high.map(new MapFunction&lt;SensorReading, Tuple2&lt;String, Double&gt;&gt;() &#123; @Override public Tuple2&lt;String, Double&gt; map(SensorReading sensorReading) throws Exception &#123; return new Tuple2&lt;&gt;(sensorReading.getSersorId(), sensorReading.getNewtemp()); &#125; &#125;); // é“¾æ¥ä¹‹åçš„stream ConnectedStreams&lt;Tuple2&lt;String, Double&gt;, SensorReading&gt; connect = highStream.connect(low); SingleOutputStreamOperator&lt;Object&gt; resultStream = connect.map(new CoMapFunction&lt;Tuple2&lt;String, Double&gt;, SensorReading, Object&gt;() &#123; @Override public Object map1(Tuple2&lt;String, Double&gt; stringDoubleTuple2) throws Exception &#123; return new Tuple3&lt;&gt;(stringDoubleTuple2.f0, stringDoubleTuple2.f0, &quot;high temp warning&quot;); &#125; @Override public Object map2(SensorReading sensorReading) throws Exception &#123; return new Tuple2&lt;&gt;(sensorReading.getSersorId(), &quot;normal temp&quot;); &#125; &#125;); resultStream.print(); env.execute(); &#125; connect | coMapå¦‚ä¸Šsplitæ–¹æ³•ä¸‹é¢æˆ‘ä»¬æ˜¯æœ‰æ“ä½œconnectçš„apiçš„ union12345678910111213141516171819public static void unionTest() throws Exception &#123; // å¿…é¡»æ˜¯æ•°æ®ç±»å‹ç›¸åŒ StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStreamSource&lt;String&gt; firstStream = env.socketTextStream(&quot;localhost&quot;, 9999); DataStreamSource&lt;String&gt; secondStream = env.socketTextStream(&quot;localhost&quot;, 7777); DataStream&lt;String&gt; unionStream = firstStream.union(secondStream); DataStream&lt;SensorReading&gt; dataStream = unionStream.map(new MapFunction&lt;String, SensorReading&gt;() &#123; @Override public SensorReading map(String s) throws Exception &#123; String[] strings = s.split(&quot;,&quot;); return new SensorReading(strings[0], new Double(strings[1]), new Double(strings[2])); &#125; &#125;); dataStream.print(); env.execute();&#125; // TODO ä¸æ–­å­¦ä¹  ä¸æ–­è¡¥å……","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"Flink-æ ¸å¿ƒä¹‹Windowsçª—å£","date":"2021-08-10T08:55:40.000Z","path":"wiki/Flink-æ ¸å¿ƒä¹‹Windowsçª—å£/","text":"ä»€ä¹ˆæ˜¯çª—å£ çª—å£åˆ†é…å™¨æœ‰å‡ ç§ çª—å£å¦‚ä½•å®ç°å¢é‡è®¡ç®—å’Œå…¨é‡è®¡ç®—","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-é—¨é¢æ¨¡å¼","date":"2021-08-07T12:27:47.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-é—¨é¢æ¨¡å¼/","text":"é—¨é¢æ¨¡å¼é—¨é¢æ¨¡å¼åˆå«åšå¤–è§‚æ¨¡å¼ï¼Œæä¾›ç»Ÿä¸€çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ï¼›é—¨é¢æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ï¼›é—¨é¢æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼› ç±»å›¾ Facade é—¨é¢ç±»12345678910111213141516public class Facade &#123; // ç»§æ‰¿å„ä¸ªå­ç³»ç»ŸåŠŸèƒ½ï¼Œè¿›è¡Œå°è£…ï¼Œä¸€å®šç¨‹åº¦ä¸Šä¸éµå¾ªå•ä¸€èŒè´£åŸåˆ™ SubSystemA subSystemA = new SubSystemA(); SubSystemB subSystemB = new SubSystemB(); SubSystemC subSystemC = new SubSystemC(); public void doA()&#123; subSystemA.doA(); &#125; public void doB()&#123; subSystemB.doB(); &#125; public void doC()&#123; subSystemC.doC(); &#125;&#125; å­ç³»ç»ŸA123public class SubSystemA &#123; public void doA()&#123;&#125;&#125; å­ç³»ç»ŸB123public class SubSystemB &#123; public void doB()&#123;&#125;&#125; å­ç³»ç»ŸC123public class SubSystemC &#123; public void doC()&#123;&#125;&#125; ä»¥ä¸ŠFacadeç±»é›†æˆäº†ä¸‰ä¸ªå­ç³»ç»Ÿçš„ç±»ï¼Œåœ¨è‡ªå·±å®šä¹‰çš„æ–¹æ³•ä¸­ï¼Œå¹¶ä¸æ˜¯Facadeè‡ªå·±å®ç°çš„é€»è¾‘ï¼Œè€Œæ˜¯è°ƒç”¨äº†å¯¹åº”å­ç³»ç»Ÿçš„æ–¹æ³•ï¼Œè¿™ç§å®ç°æ–¹å¼å«åšé—¨é¢æ¨¡å¼ï¼›æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼› çœ‹åˆ°è¿™æ˜¯ä¸æ˜¯æœ‰ç‚¹ä¼¼æ›¾ç›¸è¯†å‘¢ï¼Œæ²¡é”™ï¼Œæˆ‘ä»¬å¤©å¤©éƒ½åœ¨å†™çš„Controller,Service,Daoä¸å°±æ˜¯é—¨é¢æ¨¡å¼å—ï¼Œæ²¡é”™ï¼Œåªä¸è¿‡æŠŠè¿™ç§æ–¹å¼å½¢æˆæ–¹æ³•è®ºï¼Œä¹Ÿå°±æœ‰äº†æ‰€è°“çš„é—¨é¢æ¨¡å¼ï¼ ä¸¾ä¸ªæ —å­ä¸€äº›å•†ä¸šåšå®¢ä¼šæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å‘è¡¨æ–‡ç« æˆ–è€…è¯„è®ºç‚¹èµä¼šè·å¾—ä¸€äº›ç§¯åˆ†å•Šï¼Œè™šæ‹Ÿå¸å•Š,ç„¶åä¼šæœ‰ç§¯åˆ†å•†åŸï¼Œåœ¨é‡Œé¢å¯ä»¥å…è´¹çš„å…‘æ¢å•†å“ï¼Œå…¶å®å¾ˆéš¾å‡‘çš„å¤Ÿç§¯åˆ†ï¼Œä¸å¤Ÿè´¹åŠ²çš„â€¦ å¥½äº†ï¼Œç»“åˆä¼ªä»£ç æ¥ä½“éªŒé—¨é¢æ¨¡å¼ğŸ‘‡ğŸ‘‡ğŸ‘‡ï¼š ä¸‹é¢æ˜¯ä¸€äº›æ¼”ç¤ºæ‰€éœ€è¦çš„ç±»ï¼š å…³ç³»å›¾å¦‚ä¸‹ PaymentService æ”¯ä»˜æœåŠ¡123456public class PaymentService &#123; public boolean pay(GiftInfo giftInfo)&#123; System.out.println(&quot;æ‰£å‡&quot; + giftInfo.getName() + &quot;ç§¯åˆ†æˆåŠŸï¼&quot;); return true; &#125;&#125; QualityService åº“å­˜æœåŠ¡123456public class QualityService &#123; public boolean isAvailable(GiftInfo giftInfo)&#123; System.out.println(&quot;æ ¡éªŒ&quot; + giftInfo.getName() + &quot;ç§¯åˆ†é€šè¿‡ï¼Œåº“å­˜å……è¶³ï¼&quot;); return true; &#125;&#125; ShipService ç‰©æµæœåŠ¡123456public class ShipService &#123; public String doShip(GiftInfo giftInfo)&#123; System.out.println(giftInfo.getName() + &quot;ç”Ÿæˆç‰©æµè®¢å•&quot;); return String.valueOf(System.currentTimeMillis()); &#125;&#125; å®¢æˆ·ç«¯ éé—¨é¢æ¨¡å¼å†™æ³•12345678910111213141516171819public static void main(String[] args) &#123; QualityService qualityService = new QualityService(); PaymentService paymentService = new PaymentService(); ShipService shipService = new ShipService(); GiftInfo giftInfo = new GiftInfo(&quot; ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ &quot;); if (!qualityService.isAvailable(giftInfo))&#123; System.err.println(&quot;Quality not enough!&quot;); &#125; if (!paymentService.pay(giftInfo))&#123; System.err.println(&quot;Pay error!&quot;); &#125; String shipNo = shipService.doShip(giftInfo); System.err.println(&quot;Order shipNo:&quot; + shipNo);&#125; è¿™ç§å†™æ³•ä¼šå°†åº“å­˜ï¼Œæ”¯ä»˜å’Œç‰©æµç­‰æœåŠ¡éƒ½æš´éœ²ç»™è°ƒç”¨æ–¹ï¼Œæ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œè€Œä¸”é€ æˆå®¢æˆ·ç«¯ä¾èµ–ä¸¥é‡ï¼Œä»£ç è‡ƒè‚¿ï¼› é—¨é¢æ¨¡å¼å†™æ³•123456public static void main(String[] args) &#123; FacadeService facadeService = new FacadeService(); GiftInfo giftInfo = new GiftInfo(&quot; ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ &quot;); String shipNo = facadeService.doOrder(giftInfo); System.err.println(&quot;Order shipNo:&quot; + shipNo); &#125; ä¸Šé¢è¿™ç§å°±æ˜¯é—¨é¢æ¨¡å¼çš„å†™æ³•ğŸ‘† ï¼Œ ç›¸ä¿¡å¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰å§ï¼Œè¿™æ ·çš„è¯ï¼Œæš´éœ²ç»™å®¢æˆ·ç«¯å°±ä¸€ä¸ªè®¢å•æœåŠ¡å°±å¯ä»¥äº†ï¼ åº”ç”¨åœºæ™¯ å­ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ é—¨é¢æ¨¡å¼æä¾›ç®€å•çš„æ¥å£ï¼Œç»™ç”¨æˆ·ä½¿ç”¨ï¼› æ„å»ºå¤šå±‚çš„ç³»ç»Ÿæ¥å£ï¼Œåˆ©ç”¨é—¨é¢å¯¹è±¡ä½œä¸ºæ¯å±‚çš„å…¥å£ï¼Œç®€åŒ–å±‚ä¹‹é—´çš„è°ƒç”¨ åº”ç”¨Spring JdbcUtilsMybatis configurationTomcat requestFacade responseFacade ä¼˜ç‚¹ ç®€åŒ–äº†è°ƒç”¨è¿‡ç¨‹ï¼Œæ— éœ€æ·±å…¥äº†è§£å­ç³»ç»Ÿï¼Œä»¥é˜²æ­¢ç»™å­ç³»ç»Ÿå¸¦æ¥é£é™© æ ¹æ®ä¸Šé¢ç¤¼å“å…‘æ¢çš„é€»è¾‘ï¼Œç”¨æˆ·æ ¹æœ¬ä¸careä½ åº•å±‚çš„å…‘æ¢é€»è¾‘ï¼Œä»€ä¹ˆåº“å­˜å•Šï¼Œæ”¯ä»˜çŠ¶æ€å•Šï¼Œç”Ÿæˆè®¢å•é€»è¾‘ç­‰ç­‰ï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæˆ‘åªéœ€è¦ä¸€æ­¥ä¸‹å•å³å¯ï¼› å‡å°‘ç³»ç»Ÿä¾èµ–ï¼Œæ¾è€¦åˆ è¿™ä¸€ç‚¹ä¹Ÿæ˜¯ç›¸å¯¹å®¢æˆ·ç«¯æ¥è¯´ï¼Œå®¢æˆ·ç«¯åªå…³å¿ƒçš„çš„è®¢å•æœåŠ¡å°±å¥½äº†ï¼Œå…¶ä»–çš„åº“å­˜ï¼Œä¾›åº”é“¾ç­‰éƒ½ä¸å…³ç³»ï¼› æ›´å¥½çš„åˆ’åˆ†è®¿é—®å±‚æ¬¡ï¼Œæé«˜äº†å®‰å…¨æ€§ åˆç†çš„åˆ’åˆ†å±‚æ¬¡ï¼Œå‡å°‘åº•å±‚ç³»ç»Ÿçš„æš´éœ²ï¼Œä»…ä»…æš´éœ²ä¸€äº›å¿…è¦çš„çŠ¶æ€å’Œæ¥å£ï¼Œè¿™ä¸€ç‚¹å¤§å®¶åº”è¯¥éƒ½çŸ¥é“çš„ï¼Œåƒserviceå±‚è°ƒç”¨Daoå±‚ï¼Œè€Œä¸èƒ½åœ¨serviceå±‚ç›´æ¥è®¿é—®æ•°æ®åº“ï¼› éµå¾ªè¿ªç±³ç‰¹æ³•åˆ™ ç¼ºç‚¹ å½“å­ç³»ç»Ÿçš„åŠŸèƒ½éœ€è¦æ‰©å±•æˆ–è€…ä¿®æ”¹çš„æ—¶å€™ï¼Œä¸Šå±‚å°è£…å¯èƒ½è¦é¢ä¸´ä¿®æ”¹çš„é£é™©ï¼Œè¿™æ ·å¢åŠ äº†åæœŸçš„ç»´æŠ¤æˆæœ¬ï¼Œä¹Ÿä¸éµå¾ªå¼€é—­åŸåˆ™ å¯èƒ½ä¼šè¿èƒŒå•ä¸€èŒè´£åŸåˆ™ é—¨é¢æ¨¡å¼å’Œä»£ç†æ¨¡å¼çš„åŒºåˆ«ç®€å•æ¥è¯´ï¼Œé—¨é¢æ¨¡å¼å°±æ˜¯ä¸€ç§ä»£ç†æ¨¡å¼ï¼Œæ˜¯å±äºé™æ€ä»£ç†çš„æ¨¡å¼ï¼›ä½†æ˜¯å’Œé™æ€ä»£ç†åˆæœ‰ä¸€äº›åŒºåˆ«ï¼Œé—¨é¢æ¨¡å¼çš„ä¾§é‡ç‚¹åœ¨äºå¯¹åº•å±‚çš„å°è£…ï¼Œè€Œé™æ€ä»£ç†åˆ™ç»ˆäºå¯¹ä»£ç†å¯¹è±¡çš„å¢å¼ºï¼Œé™¤äº†è°ƒç”¨å—å§”æ‰˜å¯¹è±¡çš„æ–¹æ³•ä¹‹å¤–ï¼Œå¯ä»¥æ‰©å±•é¢å¤–çš„åŠŸèƒ½ï¼›å¾ˆå¤šæ—¶å€™ä¼šæŠŠé—¨é¢æ¨¡å¼æ³¨å…¥æˆå•ä¾‹ï¼Œæ¯”å¦‚ä¸€äº›å…¨å±€çš„Util,è¿˜æœ‰æˆ‘ä»¬å¸¸è§çš„ä¸€äº›Controllerç­‰ç­‰ï¼›","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-é€‚é…å™¨æ¨¡å¼","date":"2021-08-07T12:23:59.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-é€‚é…å™¨æ¨¡å¼/","text":"é€‚é…å™¨æ¨¡å¼é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰åˆå«åšå˜å‹å™¨æ¨¡å¼ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£å˜æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä»è€Œä½¿å¾—åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œå¯¼è‡´æ— æ³•åœ¨ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œï¼Œå±äºç»“æ„æ€§è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼› åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸­é—´å±‚è§£å†³ã€‚é€‚é…å™¨æ¨¡å¼å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œé€‚é…å™¨æ¨¡å¼èµ·ç€è½¬åŒ–/å§”æ‰˜çš„ä½œç”¨ï¼Œå°†ä¸€ç§æ¥å£è½¬åŒ–ä¸ºä¸¤ä¸€ç§æœåŠ¡åŠŸèƒ½æˆ–éœ€æ±‚çš„æ¥å£ã€‚ ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥åˆ†æä¸€ä¸‹ğŸ‘‡ ç±»å›¾ å¦‚å›¾æ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼ç±»å›¾æ‰€åœ¨ğŸ‘† ä»£ç å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šä¸­é€‰æ‹©ï¼Œäºšé©¬é€Šçš„AWS,é˜¿é‡Œçš„OSSç­‰ç­‰å§ï¼Œä½†æ˜¯ä¸åŒçš„å‚å•†æœ‰è‡ªå·±çš„æ ‡å‡†æˆ–è€…API,ä½†æ˜¯åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­ä½“ç°çš„å°±æ˜¯ä¸€ä¸ªputObjectæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªCloudSDKæ ‡å‡†ï¼Œç„¶åä¸åŒçš„å‚å•†æ¥é€‚é…æˆ‘ä»¬è‡ªå·±çš„æ ‡å‡†ï¼Œåœ¨æˆ‘ä»¬çš„putObjectå’Œä¸‰æ–¹çš„SDKä¸­é—´åŠ ä¸€å±‚é€‚é…å±‚ï¼›å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä»…ä»…æ˜¯å®Œæˆæ–‡ä»¶ä¸Šä¼ çš„åŠ¨ä½œï¼Œè‡³äºä½ æœåŠ¡ç«¯åˆ°åº•ä½¿ç”¨äºšé©¬é€Šçš„æœåŠ¡è¿˜æ˜¯é˜¿é‡Œçš„æœåŠ¡ï¼Œå®ƒæ˜¯ä¸careçš„ï¼Œè¿™ä¹Ÿä½“ç°çš„ç­–ç•¥æ¨¡å¼ï¼› æ‰€ä»¥è¿™ä¸ªä¾‹å­å…¼å¤‡å·¥å‚æ¨¡å¼+ç­–ç•¥æ¨¡å¼+é€‚é…å™¨æ¨¡å¼ï¼› CloudController12345678910111213141516171819public class CloudController &#123; // å¦‚æœæ˜¯Springé¡¹ç›®è¿™é‡Œç›´æ¥æ³¨å…¥å°±å¯ä»¥äº†ï¼Œæ²¡å¿…è¦è¿™ä¹ˆéº»çƒ¦ public CloudController(CloudService cloudService) &#123; this.cloudService = cloudService; &#125; private CloudService cloudService; public void uploadFile(String fileName)&#123; System.out.println(&quot;invoke upload file service!&quot; + fileName); cloudService.uploadFile(fileName); &#125; public static void main(String[] args) &#123; CloudController cloudController = new CloudController(new CloudService(&quot;ali&quot;)); cloudController.uploadFile(&quot;think in java&quot;); &#125;&#125; CloudService1234567891011121314public class CloudService &#123; private CloudSDK cloudSDK; public CloudService(String cloudStorage) &#123; // ä½¿ç”¨å·¥å‚æ¥åˆ›å»ºå…·ä½“çš„SDK this.cloudSDK = CloudFactory.create(cloudStorage); &#125; public void uploadFile(String fileName) &#123; cloudSDK.putObject(fileName); &#125;&#125; CloudSDK å®šä¹‰SDKæ ‡å‡†123public interface CloudSDK &#123; void putObject(String fileName);&#125; AWSSDKAdapter é€‚é…CloudSDKæ ‡å‡†123456789101112public class AWSSDKAdapter implements CloudSDK &#123; private AWSSDK awssdk; public AWSSDKAdapter() &#123; this.awssdk = new AWSSDK(); &#125; @Override public void putObject(String fileName) &#123; awssdk.putObject(fileName); &#125;&#125; AliSDKAdapteré€‚é…CloudSDKæ ‡å‡†1234567891011121314public class AliSDKAdapter implements CloudSDK &#123; private AliSDK aliSDK; public AliSDKAdapter() &#123; this.aliSDK = new AliSDK(); &#125; // è¿™ä¸ªæ–¹æ³•å°±æ˜¯é€‚é…å™¨çš„æ ‡å‡† ä¸ç®¡ä½ çš„ä¸‰æ–¹æœåŠ¡éœ€è¦å¤šå°‘æ¥å£ï¼Œæ˜¯è¦å®ç°äº‘ä¸Šä¼ ï¼Œç»Ÿä¸€é€šè¿‡putObjectè¿™ä¸ªæ¥å£å®ç°å°±å¯ä»¥ @Override public void putObject(String fileName) &#123; aliSDK.setBucket(); aliSDK.uploadFile(fileName); &#125;&#125; AWSSDK ä¸‰æ–¹SDK123456public class AWSSDK &#123; // ä¸€èˆ¬ä»¥JARçš„æ–¹å¼å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½å»ä¿®æ”¹ä¸‰æ–¹çš„SDK,è¿™æ˜¯å„ä¸ªå‚å•†åˆ¶å®šçš„è‡ªå·±çš„æ ‡å‡† public void putObject(String fileName)&#123; System.out.println(&quot;aws upload file &quot; + fileName); &#125;&#125; AliSDK ä¸‰æ–¹SDK12345678910public class AliSDK &#123; // ä¸€èˆ¬ä»¥JARçš„æ–¹å¼å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½å»ä¿®æ”¹ä¸‰æ–¹çš„SDK,è¿™æ˜¯å„ä¸ªå‚å•†åˆ¶å®šçš„è‡ªå·±çš„æ ‡å‡† public void setBucket() &#123; System.out.println(&quot;Ali oss set bucket!&quot;); &#125; public void uploadFile(String fileName) &#123; System.out.println(&quot;Ali oss upload file!&quot; + fileName); &#125;&#125; CloudFactory12345678910111213141516public class CloudFactory &#123; // è¿™é‡Œæ˜¯å†™æ­»äº† ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼æˆ–è€…å¯åŠ¨åŠ è½½ç­‰ç­‰æ–¹å¼å®ç°ï¼Œæœ‰å¾ˆå¤š private static final Map&lt;String, CloudSDK&gt; sdkMap = new HashMap&lt;&gt;(); // æ€»ä¹‹è¦ç¬¦åˆå¼€é—­åŸåˆ™ å¯¹ä¿®æ”¹å…³é—­ static &#123; sdkMap.put(&quot;ali&quot;, new AliSDKAdapter()); sdkMap.put(&quot;aws&quot;, new AWSSDKAdapter()); &#125; // é€šè¿‡ä¸åŒçš„ç­–ç•¥ç”Ÿæˆå…·ä½“çš„SDKå®ä¾‹ public static CloudSDK create(String storage) &#123; return sdkMap.get(storage); &#125;&#125; é€‚é…å™¨å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯åŒ…è£…å™¨æ¨¡å¼ï¼Œè£…é¥°å™¨æ¨¡å¼å…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä»£ç†æ¨¡å¼ï¼› å¯¹æ¯”ç»´åº¦ é€‚é…å™¨æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼ å½¢å¼ æ²¡æœ‰å±‚çº§å…³ç³» ä¸€ç§éå¸¸ç‰¹åˆ«çš„ä»£ç†æ¨¡å¼ï¼Œå…·æœ‰å±‚çº§å…³ç³» å®šä¹‰ é€‚é…å™¨å’Œè¢«é€‚é…è€…æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œé€šå¸¸é‡‡ç”¨ç»§æ‰¿æˆ–ä»£ç†çš„æ–¹å¼è¿›è¡ŒåŒ…è£… è£…é¥°å™¨å’Œè¢«è£…é¥°è€…éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ç›®çš„æ˜¯æ‰©å±•ä¹‹åä¾æ—§ä¿ç•™OOPå…³ç³» å…³ç³» æ²¡æœ‰æ»¡è¶³has-açš„å…³ç³» æ»¡è¶³is-aå…³ç³» åŠŸèƒ½ æ³¨é‡å…¼å®¹ã€è½¬æ¢ æ³¨é‡è¦†ç›–ã€æ‰©å±• è®¾è®¡ åç½®è€ƒè™‘ å‰ç½®è€ƒè™‘ é€‚é…å™¨åŠŸèƒ½çš„ä¼˜ç‚¹ âœ… èƒ½æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œä½†ç°æœ‰çš„ç±»å¤ç”¨ä¸éœ€è¦æ”¹å˜ é€‚é…å™¨ç±»å’ŒåŸè§’è‰²è§£è€¦ï¼ŒæŠ•ç¨¿ç¨‹åºçš„æ‰©å±•æ€§ åœ¨å¾ˆå¤šä¸šåŠ¡ä¸­ç¬¦åˆå¼€é—­åŸåˆ™ é€‚é…å™¨çš„ç¼ºç‚¹ é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ç»¼åˆè€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§ å¢åŠ ä»£ç é˜…è¯»éš¾åº¦ï¼Œé™ä½ä»£ç å¯è¯»æ€§ï¼Œè¿‡å¤šçš„é€‚é…å™¨ä¼šä½¿å¾—ç³»ç»Ÿä»£ç å˜å¾—ç´Šä¹±","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-è´£ä»»é“¾æ¨¡å¼","date":"2021-08-07T12:21:01.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-è´£ä»»é“¾æ¨¡å¼/","text":"è´£ä»»é“¾æ¨¡å¼è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patterï¼‰æ˜¯å°†é“¾ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹çœ‹æˆæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¤„ç†çš„è¯·æ±‚å‡ä¸ç›¸åŒï¼Œå¹¶ä¸”å†…éƒ¨è‡ªåŠ¨ç»´æŠ¤ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ã€‚å½“ä¸€ä¸ªè¯·æ±‚ä»é“¾çš„å¤´éƒ¨å‘å‡ºæ—¶ï¼Œä¼šæ²¿ç€é“¾çš„è·¯å¾„ä¸€æ¬¡ä¼ é€’ç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œç›´åˆ°æœ‰èŠ‚ç‚¹å¤„ç†è¿™ä¸ªè¯·æ±‚ä¸ºæ­¢ï¼›è´£ä»»é“¾æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ ç±»å›¾ Handler è´£ä»»é“¾æŠ½è±¡ç±» é“¾å¼ç»“æ„12345678910public abstract class Handler &#123; protected Handler nextHandler; public void setNextHandler(Handler nextHandler) &#123; this.nextHandler = nextHandler; &#125; public abstract void handleRequest(String request);&#125; ConcreteHandlerA èŠ‚ç‚¹å¯¹è±¡A1234567891011121314public class ConcreteHandlerA extends Handler &#123; @Override public void handleRequest(String request) &#123; if (&quot;reqA&quot;.equals(request)) &#123; System.err.println(this.getClass().getSimpleName() + &quot;deal this request &quot; + request); return; &#125; if (this.nextHandler != null) &#123; this.nextHandler.handleRequest(request); &#125; &#125;&#125; ConcreteHandlerB èŠ‚ç‚¹å¯¹è±¡B123456789101112public class ConcreteHandlerB extends Handler &#123; @Override public void handleRequest(String request) &#123; if (&quot;reqB&quot;.equals(request)) &#123; System.err.println(this.getClass().getSimpleName() + &quot;deal this request &quot; + request); return; &#125; if (this.nextHandler != null) &#123; this.nextHandler.handleRequest(request); &#125; &#125;&#125; DemoTest æµ‹è¯•ç±»12345678910public class DemoTest &#123; public static void main(String[] args) &#123; Handler handlerA = new ConcreteHandlerA(); Handler handlerB = new ConcreteHandlerB(); handlerA.setNextHandler(handlerB); handlerA.handleRequest(&quot;reqB&quot;); &#125;&#125;// è¾“å‡ºç»“æœï¼š//ConcreteHandlerBdeal this request reqB ä¸šåŠ¡ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¸šåŠ¡åœºæ™¯çš„ä¾‹å­ğŸŒ°æ¥å±•ç¤ºä¸€ä¸‹ä»€ä¹ˆæ˜¯è´£ä»»é“¾æ¨¡å¼ï¼šæˆ‘ä»¬ç™»å½•æ—¶ï¼Œè‚¯å®šè¦æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æœ‰æ²¡æœ‰ä¼ å‚ï¼Œå¦‚æœå‚æ•°éƒ½æ˜¯ç©ºçš„è¯ï¼Œé‚£ä¹Ÿæ²¡æœ‰å¿…è¦æ‰§è¡Œåé¢çš„ç™»å½•éƒ¨åˆ†ï¼Œç›´æ¥è¿”å›äº†ï¼›å¦‚æœå‚æ•°æ˜¯åˆæ³•çš„ï¼Œé‚£æˆ‘ä»¬å°±è¦æ ¡éªŒæ•°æ®åº“æ˜¯å¦å­˜åœ¨è¿™ä¸ªç”¨æˆ·äº†ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥ç”¨æˆ·ï¼Œé‚£å°±ç›´æ¥è¿”å›ï¼›å¦‚æœå­˜åœ¨ï¼Œé‚£å°±è¦æ ¡éªŒç”¨æˆ·æœ‰æ²¡æœ‰æƒé™è®¿é—®æ­£åœ¨è¯·æ±‚çš„èµ„æºï¼Œå¦‚æœæœ‰æƒé™ï¼Œåˆ™å¯ä»¥æ­£å¸¸è®¿é—®èµ„æºï¼Œå¦‚æœæ²¡æœ‰æƒé™ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼› éè´£ä»»é“¾æ¨¡å¼å†™æ³•12345678910111213141516// ä»¥ä¸‹æ˜¯ä¼ªä»£ç public void login(String userName,String pwd)&#123; if (StringUtils.isEmpty(userName) || StringUtils.isEmpty(pwd))&#123; throw new IllegalArgumentException(); &#125; Member member = selectUser(userName,pwd); if (Objects.isNull(member))&#123; throw new IllegalArgumentException(); &#125; if (!validateRoot(member))&#123; throw new IllegalArgumentException(); &#125; System.err.println(&quot;Login success!&quot;); &#125; è¿™ç§å†™æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„æ“ä½œå…¨éƒ¨æ‚ç³…åœ¨ä¸€èµ·äº†ï¼Œç»“æ„æ˜¯ååˆ†æ··ä¹±çš„ï¼›ä¸‹é¢ğŸ‘‡çœ‹ä¸€ä¸‹å¦‚æœä½¿ç”¨è´£ä»»é“¾æ¨¡å¼è¯¥å¦‚ä½•å®ç°ï¼š Handler æŠ½è±¡è´£ä»»é“¾å¤„ç†å™¨12345678910public abstract class Handler &#123; protected Handler next; public void next(Handler next)&#123; this.next = next; &#125; public abstract void doHandler(Member member);&#125; ValidateHandler å‚æ•°æ ¡éªŒå¤„ç†å™¨1234567891011public class ValidateHandler extends Handler&#123; @Override public void doHandler(Member member) &#123; if (StringUtils.isEmpty(member.getLoginName()) || StringUtils.isEmpty(member.getLoginPass()))&#123; System.err.println(&quot;ç™»å½•åæˆ–è€…å¯†ç ä¸ºç©ºï¼&quot;); return; &#125; System.err.println(&quot;å‚æ•°æ ¡éªŒæˆåŠŸï¼&quot;); next.doHandler(member); &#125;&#125; ç™»å½•å¤„ç†å™¨12345678public class LoginHandler extends Handler &#123; @Override public void doHandler(Member member) &#123; System.err.println(&quot;login success!&quot;); member.setRoleName(&quot;root&quot;); next.doHandler(member); &#125;&#125; é‰´æƒå¤„ç†å™¨12345678910public class AuthHandler extends Handler&#123; @Override public void doHandler(Member member) &#123; if (&quot;root&quot;.equals(member.getRoleName()))&#123; System.err.println(&quot;Auth success!&quot;); return; &#125; System.err.println(&quot;Auth failed!&quot;); &#125;&#125; Memberæˆå‘˜ç±»12345678910111213public class Member &#123; private String loginName; private String loginPass; private String roleName; public Member(String loginName, String loginPass) &#123; this.loginName = loginName; this.loginPass = loginPass; &#125; // GETTER SETTER ....&#125; DemoTest æµ‹è¯•ç±»123456789101112public class DemoTest &#123; // é¦–å…ˆåˆ›å»ºæ‰€æœ‰çš„å¤„ç†å™¨ï¼Œè®¾ç½®åå®ƒä»¬çš„å…ˆåé¡ºåºï¼Œè®¾ç½®nextèŠ‚ç‚¹ï¼Œå®Œæˆä¹‹ååœ¨æ‰§è¡Œé“¾è·¯æ“ä½œï¼› public static void main(String[] args) &#123; ValidateHandler validateHandler = new ValidateHandler(); LoginHandler loginHandler = new LoginHandler(); validateHandler.next(loginHandler); AuthHandler authHandler = new AuthHandler(); loginHandler.next(authHandler); Member member = new Member(&quot;xiaoming&quot;, &quot;222&quot;); validateHandler.doHandler(member); &#125;&#125; ä¸Šé¢çš„å†™æ³•ï¼Œçœ‹èµ·æ¥æœ‰æ²¡æœ‰æ¯”éè´£ä»»é“¾å†™æ³•è¦Bæ ¼é«˜ä¸€äº›ï¼Œä½†æ˜¯ï¼Œè¿™æ ·æ¯æ¬¡åˆ›å»ºèŠ‚ç‚¹å¯¹è±¡ï¼Œå¥½åƒåˆæ˜¾å¾—ä¸å¤ªçˆ½ï¼Œæœ‰äº›è‡ƒè‚¿çš„æ„æ€ï¼è€Œä¸”è°ƒæ•´èŠ‚ç‚¹ä¹‹é—´çš„é¡ºåºæ—¶ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“æ”¹é”™ï¼ é‚£æˆ‘ä»¬å°±è¿›ä¸€æ­¥ä¼˜åŒ–ä»¥ä¸‹å§ï¼ è´£ä»»é“¾æ¨¡å¼+å»ºé€ è€…æ¨¡å¼ ä¼˜åŒ–æ·»åŠ å»ºé€ å™¨builder12345678910111213141516171819202122232425262728293031public abstract class Handler&lt;T&gt; &#123; protected Handler next; public void next(Handler next) &#123; this.next = next; &#125; public abstract void doHandler(Member member); // æš´éœ²å»ºé€ å™¨ï¼Œå°†èŠ‚ç‚¹å¯¹è±¡ä»¥é“¾è¡¨çš„å½¢å¼ä¸²èµ·æ¥ public static class Builder&lt;T&gt; &#123; private Handler&lt;T&gt; head; private Handler&lt;T&gt; tail; public Handler&lt;T&gt; build() &#123; return this.head; &#125; public Builder&lt;T&gt; addHandler(Handler&lt;T&gt; handler) &#123; if (this.head == null) &#123; this.head = this.tail = handler; return this; &#125; this.tail.next(handler); this.tail = handler; return this; &#125; &#125;&#125; æµ‹è¯•123456789public static void main(String[] args) &#123; Member member = new Member(&quot;xiaoming&quot;, null); Handler.Builder&lt;Handler&gt; builder = new Handler.Builder(); builder.addHandler(new ValidateHandler()) .addHandler(new LoginHandler()) .addHandler(new AuthHandler()) .build() .doHandler(member); &#125; é€šè¿‡æ·»åŠ å»ºé€ å™¨ä¹‹åï¼Œè´£ä»»é“¾çš„ç»„è£…ä¸è°ƒç”¨æ˜¯ä¸æ˜¯æ˜¾å¾—å¾ˆæ¸…æ™°ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯¹è±¡å„å¸å…¶èŒï¼Œå¦‚æœéœ€è¦æœ¬èŠ‚ç‚¹æ‰§è¡Œï¼Œåˆ™æ‰§è¡Œï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™äº¤ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ç»§ç»­ï¼ è´£ä»»é“¾é€‚ç”¨çš„åœºæ™¯ å¤šä¸ªå¯¹è±¡å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œä½†å…·ä½“ç”±é‚£ä¸ªå¯¹è±¡å¤„ç†åˆ™åœ¨è¿åŠ¨æ—¶åŠ¨æ€å†³å®š åœ¨ä¸æ˜ç¡®ğŸˆ¯æŒ‡å®šæ¥å—è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡çš„ä¸€ä¸ªæäº¤è¯·æ±‚ å¯ä»¥åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ ä¸¾ä¸€äº›å®é™…çš„ä¾‹å­ï¼šjavax.servlet.Filterçš„doFilteræ–¹æ³•å°±æ˜¯ä½¿ç”¨çš„è´£ä»»é“¾æ¨¡å¼; org.springframework.web.filter.CompositeFilter#doFilter123public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; (new CompositeFilter.VirtualFilterChain(chain, this.filters)).doFilter(request, response); &#125; è¿™æ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªå®ç°(javax.servlet.Filter),ä¸‹é¢å±•å¼€å…·ä½“çš„ä»£ç ï¼š org.springframework.web.filter.CompositeFilter12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class CompositeFilter implements Filter &#123; //Filter è¿™é‡Œçš„Filterç›¸å½“äºå¤„ç†èŠ‚ç‚¹ï¼Œå­˜æ”¾åœ¨Listä¸­ï¼Œå’Œæˆ‘ä»¬ä¸Šé¢çš„Handlerå­˜æ”¾åœ¨å»ºé€ è€…çš„é“¾å¼ç»“æ„ä¸­ï¼Œå¼‚æ›²åŒå·¥ã€‚ private List&lt;? extends Filter&gt; filters = new ArrayList(); public CompositeFilter() &#123; &#125; public void setFilters(List&lt;? extends Filter&gt; filters) &#123; this.filters = new ArrayList(filters); &#125; public void init(FilterConfig config) throws ServletException &#123; Iterator var2 = this.filters.iterator(); while(var2.hasNext()) &#123; Filter filter = (Filter)var2.next(); filter.init(config); &#125; &#125; public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; (new CompositeFilter.VirtualFilterChain(chain, this.filters)).doFilter(request, response); &#125; public void destroy() &#123; int i = this.filters.size(); while(i-- &gt; 0) &#123; Filter filter = (Filter)this.filters.get(i); filter.destroy(); &#125; &#125; private static class VirtualFilterChain implements FilterChain &#123; private final FilterChain originalChain; private final List&lt;? extends Filter&gt; additionalFilters; private int currentPosition = 0; public VirtualFilterChain(FilterChain chain, List&lt;? extends Filter&gt; additionalFilters) &#123; this.originalChain = chain; this.additionalFilters = additionalFilters; &#125; public void doFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException &#123; if (this.currentPosition == this.additionalFilters.size()) &#123; this.originalChain.doFilter(request, response); // é€šè¿‡currentPositionçš„ç§»åŠ¨ï¼Œè½¬ç§»åˆ°é“¾è·¯ä¸Šçš„ä¸åŒå¤„ç†èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯è´£ä»»é“¾æ¨¡å¼çš„ä½“ç° &#125; else &#123; ++this.currentPosition; Filter nextFilter = (Filter)this.additionalFilters.get(this.currentPosition - 1); nextFilter.doFilter(request, response, this); &#125; &#125; &#125;&#125; åƒä¸Šé¢çš„ä¾‹å­è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œæ¯”å¦‚Spring Securityå’ŒShiroä¸­çš„æ‹¦æˆªå™¨å°±æ˜¯å¾ˆå…¸å‹çš„è´£ä»»é“¾æ¨¡å¼ï¼Œè¿˜æœ‰Nettyä¸­çš„ io.netty.channel.ChannelPipelineç­‰ç­‰ï¼Œéƒ½æ˜¯è´£ä»»é“¾æ¨¡å¼ï¼› è´£ä»»é“¾æ¨¡å¼çš„ä¼˜ç‚¹ğŸ‘ğŸ‘ğŸ‘ å°†è¯·æ±‚ä¸å¤„ç†è§£è€¦ è¯·æ±‚å¤„ç†è€…ï¼ˆèŠ‚ç‚¹å¯¹è±¡ï¼‰åªéœ€è¦å…³æ³¨è‡ªå·±æ„Ÿå…´è¶£çš„è¯·æ±‚è¿›è¡Œå¤„ç†å³å¯ï¼Œå¯¹äºä¸æ„Ÿå…´è¶£çš„è¯·æ±‚ï¼Œç›´æ¥è½¬å‘ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ å…·å¤‡é“¾å¼ä¼ é€’å¤„ç†è¯·æ±‚åŠŸèƒ½ï¼Œè¯·æ±‚å‘é€è€…æ— éœ€çŸ¥æ™“é“¾è·¯ç»“æ„ï¼Œåªéœ€ç­‰å¾…å¤„ç†è¯·æ±‚ç»“æœ é“¾è·¯ç»“æ„çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜é“¾è·¯ç»“æœåŠ¨æ€çš„æ–°å¢å’Œåˆ é™¤è´£ä»» æ˜“äºæ‰©å±•æ–°çš„è¯·æ±‚èŠ‚ç‚¹ï¼ˆç¬¦åˆå¼€é—­åŸåˆ™ï¼‰ è´£ä»»é“¾æ¨¡å¼çš„ç¼ºç‚¹ è´£ä»»é“¾å¤ªé•¿æˆ–è€…å¤„ç†æ—¶é—´å¤ªé•¿ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ å¦‚æœèŠ‚ç‚¹å¯¹è±¡å­˜åœ¨å¾ªç¯â™»ï¸å¼•ç”¨æ—¶ï¼Œä¼šé€ æˆæ­»å¾ªç¯ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œæ‰€ä»¥è¿™ä¸ªåœ¨è®¾è®¡çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ä¸èƒ½å½¢æˆé—­ç¯âš ï¸âš ï¸âš ï¸","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-è§‚å¯Ÿè€…æ¨¡å¼","date":"2021-08-07T12:18:40.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-è§‚å¯Ÿè€…æ¨¡å¼/","text":"è§‚å¯Ÿè€…æ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼æŒ‡å¤šä¸ªå¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚è¿™ç§æ¨¡å¼æœ‰æ—¶åˆç§°ä½œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€æ¨¡å‹-è§†å›¾æ¨¡å¼ï¼Œå®ƒæ˜¯å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚ å±äºè¡Œä¸ºå‹æ¨¡å¼ ç±»å›¾ ISubject12345678public interface ISubject&lt;E&gt; &#123; boolean attach(IObserver&lt;E&gt; observer); boolean detach(IObserver&lt;E&gt; observer); void notify(E event);&#125; ConcreteSubject12345678910111213141516171819202122232425public class ConcreteSubject&lt;E&gt; implements ISubject&lt;E&gt; &#123; private List&lt;IObserver&lt;E&gt;&gt; observers = new ArrayList&lt;&gt;(); @Override public boolean attach(IObserver&lt;E&gt; observer) &#123; if (this.observers.contains(observer)) &#123; return false; &#125; observers.add(observer); return true; &#125; @Override public boolean detach(IObserver&lt;E&gt; observer) &#123; return this.observers.remove(observer); &#125; @Override public void notify(E event) &#123; for (IObserver observer : observers) &#123; observer.update(event); &#125; &#125;&#125; IObserver1234public interface IObserver&lt;E&gt; &#123; void update(E event);&#125; ConcreteObserver123456public class ConcreteObserver&lt;E&gt; implements IObserver&lt;E&gt; &#123; @Override public void update(E event) &#123; System.err.println(&quot;receive event &quot; + event); &#125;&#125; DemoTest12345678910public class DemoTest &#123; public static void main(String[] args) &#123; ISubject&lt;String&gt; subject = new ConcreteSubject&lt;String&gt;(); subject.attach(new ConcreteObserver&lt;String&gt;()); subject.attach(new ConcreteObserver&lt;String&gt;()); subject.attach(new ConcreteObserver&lt;String&gt;()); subject.notify(&quot;test&quot;); &#125;&#125; JDKå®ç°è§‚å¯Ÿè€…æ¨¡å¼ æ¯”å¦‚æœ‰ä¸€ä¸ªåšå®¢ç³»ç»Ÿæä¾›äº†é—®é¢˜ç¤¾åŒºï¼Œä¸€ä¸ªäººæå‡ºé—®é¢˜ï¼Œä¼šæœ‰å…¶ä»–äººæ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼›æˆ‘ä»¬ä½¿ç”¨JDKæ¥æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼› Blog è¢«è§‚å¯Ÿå¯¹è±¡12345678910111213141516171819public class Blog extends Observable &#123; private Blog() &#123; &#125; private static final Blog blog = new Blog(); private String name = &quot;IBLi Blog&quot;; public static Blog getInstance() &#123; return blog; &#125; public void question(Question question) &#123; System.out.println(question.getUserName() + &quot; åœ¨ blog æäº¤äº†é—®é¢˜ ï¼š &quot; + question.getContent()); setChanged(); notifyObservers(question); &#125;&#125; Question1234567891011121314151617181920212223242526public class Question &#123; private String userName; private String content; public Question(String userName, String content) &#123; this.userName = userName; this.content = content; &#125; public String getUserName() &#123; return userName; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public String getContent() &#123; return content; &#125; public void setContent(String content) &#123; this.content = content; &#125;&#125; Student å­¦ç”Ÿç±» è¢«é€šçŸ¥å¯¹è±¡123456789101112131415161718192021222324252627282930313233public class Student implements Observer &#123; private String name; public Student(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; /** * This method is called whenever the observed object is changed. An * application calls an &lt;tt&gt;Observable&lt;/tt&gt; object&#x27;s * &lt;code&gt;notifyObservers&lt;/code&gt; method to have all the object&#x27;s * observers notified of the change. * * @param o the observable object. * @param arg an argument passed to the &lt;code&gt;notifyObservers&lt;/code&gt; */ @Override public void update(Observable o, Object arg) &#123; Blog blog = (Blog) o; Question question = (Question) arg; System.out.println(&quot;******************&quot;); System.out.println(this.name + &quot; çœ‹åˆ°äº† &quot; + question.getUserName() + &quot; çš„é—®é¢˜ \\n&quot; + &quot;é—®é¢˜æ˜¯ï¼š &quot; + question.getContent()); &#125;&#125; Client æµ‹è¯•1234567891011public class Client &#123; public static void main(String[] args) &#123; Blog blog = Blog.getInstance(); blog.addObserver(new Student(&quot;Tom&quot;)); blog.addObserver(new Student(&quot;John&quot;)); Question question = new Question(&quot;å°æ˜&quot;,&quot;è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ&quot;); blog.question(question); &#125;&#125; æµ‹è¯•ç»“æœ1234567å°æ˜ åœ¨ blog æäº¤äº†é—®é¢˜ ï¼š è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ******************Johnçœ‹åˆ°äº† å°æ˜ çš„é—®é¢˜ é—®é¢˜æ˜¯ï¼š è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ******************Tomçœ‹åˆ°äº† å°æ˜ çš„é—®é¢˜ é—®é¢˜æ˜¯ï¼š è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ åŸºäºGuavaå®ç°è§‚å¯Ÿè€…æ¨¡å¼Student è¢«è§‚å¯Ÿå¯¹è±¡123456789101112131415161718192021222324252627public class Student &#123; private String name; public Student(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return &quot;Student&#123;&quot; + &quot;name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125; @Subscribe public void Observer(Student str) &#123; System.err.println(&quot;student invoke method + &quot; + str.toString()); &#125;&#125; Teacher è¢«é€šçŸ¥å¯¹è±¡12345678910111213141516171819202122232425262728public class Teacher &#123; private String name; public Teacher(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return &quot;Teacher&#123;&quot; + &quot;name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125; @Subscribe public void Observer(Teacher str) &#123; System.err.println(&quot;teacher invoke method + &quot; + str.toString()); &#125;&#125; Client æµ‹è¯•ç±»123456789101112public class Client &#123; public static void main(String[] args) &#123; EventBus eventBus = new EventBus(); Student student = new Student(&quot;Ibli&quot;); Teacher teacher = new Teacher(&quot;laoshi&quot;); eventBus.register(student); eventBus.register(teacher); eventBus.post(new Student(&quot;xuesheng&quot;)); eventBus.post(new Teacher(&quot;teacher&quot;)); &#125;&#125; æµ‹è¯•ç»“æœ12student invoke method + Student&#123;name=&#x27;xuesheng&#x27;&#125;teacher invoke method + Teacher&#123;name=&#x27;teacher&#x27;&#125; è§‚å¯Ÿè€…æ¨¡å¼ä½¿ç”¨åœºæ™¯1ã€å½“ä¸€ä¸ªæŠ½è±¡æ¨¡å‹åŒ…å«ä¸¤ä¸ªæ–¹é¢å†…å®¹ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–å¦ä¸€ä¸ªæ–¹é¢2ã€å…¶ä»–ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡çš„å˜åŒ–ä¾èµ–å¦ä¸€ä¸ªå¯¹è±¡çš„å˜åŒ–3ã€å®ç°ç±»ä¼¼å¹¿æ’­æœºåˆ¶çš„åŠŸèƒ½ï¼Œæ— éœ€çŸ¥é“å…·ä½“æ”¶å¬è€…ï¼Œåªéœ€è¦å¹¿æ’­ã€‚ç³»ç»Ÿä¸­æ„Ÿå…´è¶£çš„å¯¹è±¡ä¼šè‡ªåŠ¨æ¥å£è¯¥å¹¿æ’­4ã€å¤šå±‚çº§åµŒå¥—æœºåˆ¶ï¼Œå½¢æˆä¸€ç§é“¾å¼å‡ºå‘æœºåˆ¶ï¼Œæ˜¯çš„æ—¶é—´å…·å¤‡è·¨åŸŸï¼ˆè·¨è¶Šä¸¤ç§è§‚å¯Ÿè€…ç±»å‹ï¼‰é€šçŸ¥ è§‚å¯Ÿè€…æ¨¡å¼ä¼˜ç‚¹âœ…1ã€é™ä½äº†ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸¤è€…ä¹‹é—´æ˜¯æŠ½è±¡è€¦åˆå…³ç³»ã€‚ç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ã€‚2ã€ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ç¼ºç‚¹ç›®æ ‡ä¸è§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»å¹¶æ²¡æœ‰å®Œå…¨è§£é™¤ï¼Œè€Œä¸”æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨ã€‚å½“è§‚å¯Ÿè€…å¯¹è±¡å¾ˆå¤šæ—¶ï¼Œé€šçŸ¥çš„å‘å¸ƒä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-è£…é¥°å™¨æ¨¡å¼","date":"2021-08-07T12:15:15.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-è£…é¥°å™¨æ¨¡å¼/","text":"è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰è£…é¥°å™¨æ¨¡å¼ä¹Ÿå«åšåŒ…è£…æ¨¡å¼ï¼Œæ˜¯æŒ‡åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šï¼Œæä¾›æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆæ‰©å±•åŸæœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼‰ï¼Œå¼ºè°ƒä¸€ç‚¹æ˜¯åŸºäºå·²æœ‰å¯¹è±¡çš„åŠŸèƒ½å¢å¼ºï¼›è£…é¥°å™¨æ¨¡å¼å±äºç»“æ„æ€§æ¨¡å¼; è£…é¥°å™¨ç±»å›¾ Component æŠ½è±¡æ„ä»¶ å®šä¹‰ä¸€ä¸ªæŠ½è±¡æ¥å£ä»¥è§„èŒƒå‡†å¤‡æ¥å—é™„åŠ è´£ä»»çš„å¯¹è±¡ 123public abstract class Component &#123; public abstract void operation();&#125; ConcreteComponent å…·ä½“çš„æ„ä»¶ å®ç°æŠ½è±¡æ„ä»¶,é€šè¿‡è£…é¥°è§’è‰²ä¸ºå…¶æ·»åŠ ä¸€äº›èŒè´£ 123456public class ConcreteComponent extends Component&#123; @Override public void operation() &#123; System.err.println(&quot;Do some biz event!&quot;); &#125;&#125; Decorator æŠ½è±¡è£…é¥°è§’è‰² ç»§æ‰¿æŠ½è±¡æ„ä»¶,å¹¶åŒ…å«å…·ä½“æ„ä»¶çš„å®ä¾‹,å¯ä»¥é€šè¿‡å…¶å­ç±»æ‰©å±•å…·ä½“æ„ä»¶çš„åŠŸèƒ½ 123456789101112131415public abstract class Decorator extends Component&#123; //æŒæœ‰ç»„ä»¶å¯¹è±¡ protected Component component; public Decorator(Component component) &#123; this.component = component; &#125; @Override public void operation() &#123; //è½¬å‘è¯·æ±‚ç»™ç»„ä»¶å¯¹è±¡,å¯ä»¥åœ¨è½¬å‘å‰åæ‰§è¡Œä¸€äº›é™„åŠ åŠ¨ä½œ component.operation(); &#125;&#125; ConcreteDecoratorA å®ç°æŠ½è±¡è£…é¥°çš„ç›¸å…³æ–¹æ³•,å¹¶ç»™å…·ä½“æ„ä»¶å¯¹è±¡æ·»åŠ é™„åŠ çš„è´£ä»» 123456789101112131415161718192021public class ConcreteDecoratorA extends Decorator &#123; public ConcreteDecoratorA(Component component) &#123; super(component); &#125; public void operationFirst() &#123; System.err.println(&quot;ConcreteDecoratorA first!&quot;); &#125; public void operationLast() &#123; System.err.println(&quot;ConcreteDecoratorA last!&quot;); &#125; @Override public void operation() &#123; operationFirst(); super.operation(); operationLast(); &#125;&#125; Client æµ‹è¯•ç±»1234567public class Client &#123; public static void main(String[] args) &#123; Component component = new ConcreteComponent(); Decorator decoratorA = new ConcreteDecoratorA(component); decoratorA.operation(); &#125;&#125; ä¸¾ä¸ªä¾‹å­ä¹°ç…é¥¼çš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¹°ä¸€ä¸ªç…é¥¼,ä½†æœ‰çš„æ—¶å€™è§‰å¾—å‘³é“å•ä¸€æˆ–è€…åƒä¸é¥±,æˆ‘ä»¬å¯ä»¥åŠ ä¸€äº›ä¸œè¥¿,æ¯”å¦‚çƒ¤è‚ ,é¸¡è›‹,é¸¡æ’ç­‰ç­‰; å…ˆçœ‹çœ‹éè£…é¥°å™¨æ¨¡å¼çš„å†™æ³• BatterCake å°±ä¸€ä¸ªæ™®é€šçš„ç…é¥¼ç±»ï¼› 123456public class BatterCake &#123; protected String getMsg()&#123;return &quot;ç…é¥¼&quot;;&#125; public int getPrice()&#123; return 10; &#125;&#125; BatterCakeWithEgg æ·»åŠ ä¸€ä¸ªé¸¡è›‹çš„ç…é¥¼ï¼› 123456789public class BatterCakeWithEgg extends BatterCake&#123; protected String getMsg()&#123; return super.getMsg() + &quot; åŠ ä¸€ä¸ªé¸¡è›‹&quot;; &#125; public int getPrice()&#123; return super.getPrice() + 1; &#125;&#125; BatterCakeWithEggAndSauage åŠ ä¸€ä¸ªé¸¡è›‹ å†åŠ ä¸€è·Ÿçƒ¤è‚ çš„ç…é¥¼ï¼› 123456789public class BatterCakeWithEggAndSauage extends BatterCakeWithEgg&#123; protected String getMsg()&#123; return super.getMsg() + &quot; åŠ ä¸€ä¸ªçƒ¤è‚ &quot;; &#125; public int getPrice()&#123; return super.getPrice() + 2; &#125;&#125; Client å®¢æˆ·123456789101112public class Client &#123; public static void main(String[] args) &#123; BatterCake batterCake = new BatterCake(); System.err.println(batterCake.getMsg() + &quot;ä»·æ ¼ &quot; + batterCake.getPrice()); BatterCakeWithEgg batterCakeWithEgg = new BatterCakeWithEgg(); System.err.println(batterCakeWithEgg.getMsg() + &quot;ä»·æ ¼ &quot; + batterCakeWithEgg.getPrice()); BatterCakeWithEggAndSauage batterCakeWithEggAndSauage = new BatterCakeWithEggAndSauage(); System.err.println(batterCakeWithEggAndSauage.getMsg() + &quot;ä»·æ ¼ &quot; + batterCakeWithEggAndSauage.getPrice()); &#125;&#125; çœ‹åˆ°è¿™ç§å†™æ³•ï¼Œåº”è¯¥èƒ½çœ‹å‡ºå®ƒçš„å¼Šç«¯äº†ï¼Œå°±æ˜¯å®ç°å¾ˆç®€å•ï¼Œé€‚åˆäºéœ€æ±‚å›ºå®šçš„ä¸šåŠ¡å’Œå¤šæ ·æ€§æ¯”è¾ƒç®€å•çš„ä¸šåŠ¡ï¼›ä¸€æ—¦å®¢æˆ·éœ€è¦ä¸€ä¸ªé¸¡è›‹ï¼Œä¸¤æ ¹çƒ¤è‚ ï¼Œé‚£æ˜¯ä¸æ˜¯è¿˜è¦åœ¨BatterCakeWithEggAndSauageç±»ä¸Šç»§ç»­æ‰©å±•å‘¢ï¼Œè¿™å…¶å®æ˜¯å¾ˆlowçš„è®¾è®¡ï¼›è€Œä¸”éå¸¸ä¸çµæ´»ï¼Œæ¯”å¦‚å®¢æˆ·åªéœ€è¦ä¸€è·Ÿçƒ¤è‚ çš„ç…é¥¼ã€‚è¿™ä¸ªæ—¶å€™æ€ä¹ˆè§£å†³å‘¢ï¼› ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ä¼˜åŒ– BatterCake æŠ½è±¡ç»„ä»¶1234public abstract class BatterCake &#123; protected abstract String getMsg(); protected abstract int getPrice();&#125; åŸºç¡€ç±» å®ç°æŠ½è±¡æ¥å£1234567891011public class BaseBatterCake extends BatterCake&#123; @Override protected String getMsg() &#123; return &quot;ç…é¥¼&quot;; &#125; @Override protected int getPrice() &#123; return 5; &#125;&#125; BatterCakeDecorator è£…é¥°å™¨12345678910111213141516171819public class BatterCakeDecorator extends BatterCake&#123; private BatterCake batterCake; public BatterCakeDecorator(BatterCake batterCake) &#123; this.batterCake = batterCake; &#125; @Override protected String getMsg() &#123; return this.batterCake.getMsg(); &#125; @Override protected int getPrice() &#123; return this.batterCake.getPrice(); &#125;&#125; EggDecorator å…·ä½“çš„è£…é¥°å™¨å¯¹è±¡12345678910111213141516public class EggDecorator extends BatterCakeDecorator&#123; public EggDecorator(BatterCake batterCake) &#123; super(batterCake); &#125; @Override protected String getMsg() &#123; return super.getMsg() + &quot; åŠ ä¸€ä¸ªé¸¡è›‹&quot;; &#125; @Override protected int getPrice() &#123; return super.getPrice() + 1; &#125;&#125; SauageDecorator å…·ä½“çš„è£…é¥°å¯¹è±¡12345678910111213141516public class SauageDecorator extends BatterCakeDecorator&#123; public SauageDecorator(BatterCake batterCake) &#123; super(batterCake); &#125; @Override protected String getMsg() &#123; return super.getMsg() + &quot; åŠ ä¸€ä¸ªçƒ¤è‚ &quot;; &#125; @Override protected int getPrice() &#123; return super.getPrice() + 2; &#125;&#125; å®¢æˆ· æµ‹è¯•ç±»123456789101112131415161718public class Client &#123; public static void main(String[] args) &#123; BatterCake batterCake = new BaseBatterCake(); System.err.println(batterCake.getMsg() + &quot;æ€»è®¡ : &quot; + batterCake.getPrice()); batterCake = new EggDecorator(batterCake); System.err.println(batterCake.getMsg() + &quot;æ€»è®¡ : &quot; + batterCake.getPrice()); batterCake = new SauageDecorator(batterCake); System.err.println(batterCake.getMsg() + &quot;æ€»è®¡ : &quot; + batterCake.getPrice()); batterCake = new EggDecorator(batterCake); System.err.println(batterCake.getMsg() + &quot;æ€»è®¡ : &quot; + batterCake.getPrice()); &#125;&#125; ä¸Šé¢è¿™ç§å†™æ³•æ˜¯è¿ç”¨äº†è£…é¥°å™¨æ¨¡å¼çš„å†™æ³•ï¼Œè¿™æ ·ä¼šå¢åŠ ç¨‹åºçš„çµæ´»æ€§ï¼ŒEggDecoratorè¿”å›ä¸€ä¸ªBatterCakeï¼Œåœ¨EggDecoratorä¸­çš„getMsgæ–¹æ³•å’ŒgetPriceæ–¹æ³•ä¸­æ·»åŠ å…³äºEggçš„é€»è¾‘æ¥å®ç°å¯¹BatterCakeçš„å¢å¼ºï¼ŒåŒç†SauageDecoratorä¹Ÿæ˜¯ï¼Œåœ¨å®ƒè‡ªå·±çš„getMsgæ–¹æ³•å’ŒgetPriceæ–¹æ³•ä¸­æ·»åŠ è‡ªå·±çš„é€»è¾‘ï¼Œå½“ç„¶ï¼Œéƒ½æ˜¯åŸºäºè°ƒç”¨superæ–¹æ³•çš„åŸºç¡€ä¸Šæ·»åŠ è‡ªå·±çš„é€»è¾‘ï¼ŒåŒæ—¶å…·ä½“çš„è£…é¥°å¯¹è±¡è¿”å›çˆ¶ç±»ç±»å‹çš„å¯¹è±¡ï¼› 1234@Override protected int getPrice() &#123; return super.getPrice() + 2; &#125; è¿™é‡Œè¿›è¡Œä¸€ä¸‹æ€»ç»“ï¼š1ã€å…·ä½“è£…é¥°å¯¹è±¡(EggDecorator)ä¸€å®šæ˜¯ç»§æ‰¿è‡ªè£…é¥°ç»„ä»¶(BatterCakeDecorator)2ã€ä¸ºäº†å®ç°å¯¹è±¡å¢å¼ºï¼Œå­ç±»ä¸­çš„æ–¹æ³•ä¸€å®šæ˜¯åŸºäºsuperæ–¹æ³•çš„åŸºç¡€ä¸Šï¼Œæ·»åŠ è‡ªå·±çš„é€»è¾‘çš„ ä½¿ç”¨åœºæ™¯ ç”¨äºæ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½æˆ–ç»™ä¸€ä¸ªç±»æ·»åŠ é™„åŠ èŒè´£ åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ åŠŸèƒ½,è¿™äº›åŠŸèƒ½å¯ä»¥åœ¨åŠ¨æ€çš„æ’¤é”€ å®é™…åº”ç”¨Spring TransactionAwareCacheManagerJDK FileInputStream è£…é¥°å™¨æ¨¡å¼ä¸ä»£ç†æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä»£ç†æ¨¡å¼ è£…é¥°å™¨æ¨¡å¼å¼ºè°ƒè‡ªèº«çš„åŠŸèƒ½æ‰©å±•,é€æ˜çš„,åŠ¨æ€çš„æ‰©å±•ä¸å¢å¼º é€æ˜æŒ‡çš„æ˜¯åŠŸèƒ½çš„æ‰©å±•ç”±å®¢æˆ·ç«¯æ§åˆ¶ ä»£ç†æ¨¡å¼å¼ºè°ƒä»£ç†è¿‡ç¨‹çš„æ§åˆ¶ è£…é¥°å™¨æ¨¡å¼çš„ä¼˜ç‚¹1ã€è£…é¥°å™¨æ˜¯ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œæ¯”ç»§æ‰¿çµæ´»ï¼Œåœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ‰©å±•åŠŸèƒ½ï¼Œå³æ’å³ç”¨2ã€é€šè¿‡ä½¿ç”¨ä¸ç”¨è£…é¥°ç±»åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥å®ç°ä¸åŒæ•ˆæœ3ã€è£…é¥°å™¨æ¨¡å¼å®Œå…¨éµå®ˆå¼€é—­åŸåˆ™ è£…é¥°å™¨æ¨¡å¼çš„ç¼ºç‚¹1ã€å¢åŠ äº†ä¸€äº›å­ç±»ï¼Œç³»ç»Ÿä»£ç ä¼šæ˜¾å¾—è‡ƒè‚¿ã€‚2ã€ç»„åˆæ–¹å¼å®¹æ˜“å‡ºé”™ï¼Œä»£ç å¯è¯»æ€§æ¯”è¾ƒå·®ã€‚ å‚è€ƒæ–‡æ¡£1ã€åŒ…è£…æ¨¡å¼å°±æ˜¯è¿™ä¹ˆç®€å•å•¦2ã€è£…é¥°å™¨æ¨¡å¼ï¼ˆè£…é¥°è®¾è®¡æ¨¡å¼ï¼‰è¯¦è§£3ã€javaä¸­çš„è£…é¥°è®¾è®¡æ¨¡å¼ï¼Œæµ…è°ˆä¸ç»§æ‰¿ä¹‹é—´çš„åŒºåˆ«4ã€JDK IOä¸­çš„é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-ç­–ç•¥æ¨¡å¼","date":"2021-08-07T12:09:10.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-ç­–ç•¥æ¨¡å¼/","text":"ç­–ç•¥æ¨¡å¼ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ä¹Ÿå«åšæ”¿ç­–æ¨¡å¼ï¼ˆPolicy Patternï¼‰,å®ƒæ˜¯å°†å®šä¹‰çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä»è€Œè®©ç®—æ³•çš„å˜åŒ–ä¸å½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ï¼›å®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„é¿if-else/switchç­‰ç­–ç•¥æ¨¡å¼ä½¿ç”¨çš„é¢å‘å¯¹è±¡çš„ç»§æ‰¿å’Œå¤šæ€æœºåˆ¶ï¼Œä»è€Œå®ç°åŒä¸€è¡Œä¸ºåœ¨ä¸åŒçš„åœºæ™¯ä¸‹å…·å¤‡ä¸åŒçš„å®ç°ï¼› åº”ç”¨ç­–ç•¥æ¨¡å¼åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­æœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œå‡¡æ˜¯è®¾è®¡åˆ°é€‰æ‹©çš„åœºæ™¯åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°ï¼›æ¯”å¦‚è´­ä¹°ä¸€ä¸ªå•†å“é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼Œæ˜¯é€‰æ‹©é“¶è¡Œå¡è¿˜æ˜¯å¿«æ·æ”¯ä»˜ï¼Œå¾®ä¿¡ï¼Ÿæ”¯ä»˜å®ç­‰ï¼› å‡å¦‚ä¸€ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šç±»ï¼Œè€Œå®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨ä¸å®ƒä»¬çš„è¡Œä¸ºä¸åŒï¼› ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€çš„ä»å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ï¼›ä¸€äº›å¹³å°å‹äº§å“ä¸­è‚¯å®šä¼šç”¨åˆ°çš„ éœ€è¦å±è”½ç®—æ³•è§„åˆ™ï¼› ç­–ç•¥æ¨¡å¼ç±»å›¾ é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œç­–ç•¥æ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š ä¸Šä¸‹æ–‡è§’è‰²ï¼ˆContextï¼‰: ç”¨æ¥æ“ä½œç­–ç•¥çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå±è”½é«˜å±‚æ¨¡å—ï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹ç­–ç•¥/ç®—æ³•çš„ç›´æ¥è®¿é—®ï¼Œå°è£…å¯èƒ½å­˜åœ¨çš„å˜åŒ– æŠ½è±¡ç­–ç•¥è§’è‰²ï¼ˆIStrategyï¼‰: è§„å®šç­–ç•¥æˆ–ç®—æ³•çš„è¡Œä¸º å…·ä½“çš„ç­–ç•¥è§’è‰²ï¼ˆConcreteStrategyï¼‰: å…·ä½“çš„ç­–ç•¥é€»è¾‘æˆ–ç®—æ³• è¿™é‡Œçš„ä¸Šä¸‹æ–‡è§’è‰²ä»…ä»…æ˜¯ä¸€ä¸ªç§°è°“ï¼Œå¤§å®¶åªè¦çŸ¥é“ä»–åœ¨ç­–ç•¥æ¨¡å¼ä¸­çš„ä½œç”¨å°±å¯ä»¥äº†ï¼Œå°±æ˜¯æ¡¥æ¥å®¢æˆ·ç«¯å’Œç­–ç•¥/æ–¹æ³•çš„ä½œç”¨ï¼› ä¸¾ä¸ªä¾‹å­ èƒŒæ™¯ï¼š ç”µå•†åœºæ™¯ä¸‹ï¼Œç”¨æˆ·è´­ä¹°ä¸€ä¸ªå•†å“ï¼Œæ”¯ä»˜æ—¶å¯ä»¥é€‰æ‹©ä¸€ç§ä¼˜æƒ ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰ä¼˜æƒ ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ç­–ç•¥ï¼Œå³æ— ä»»ä½•ä¼˜æƒ ï¼› 1ã€ä¸Šé¢ä¸¤å±‚æ˜¯å®šä¹‰çš„ä¸€ä¸ªè¥é”€ç­–ç•¥çš„æ¥å£ï¼Œç„¶åæä¾›ä¸åŒçš„ç­–ç•¥æ¥å®ç°ï¼›2ã€ç¬¬ä¸‰å±‚æ˜¯ç­–ç•¥ç”Ÿæˆæ‰€ä½¿ç”¨çš„å·¥å‚å’Œå®¢æˆ·ç«¯è°ƒç”¨ç­–ç•¥ä¸­é—´çš„ä¸Šä¸‹æ–‡ï¼Œæ‰¿æ¥ä¸Šä¸‹ï¼Œæ¡¥æ¥æ¨¡å¼ï¼›3ã€æœ€ä¸‹å±‚çš„Demoå¯ä»¥çœ‹æˆæ˜¯å®¢æˆ·ç«¯ï¼› å®šä¹‰ç­–ç•¥æ¥å£ åˆ¶å®šæ ‡å‡†æ–¹æ³•123public interface IPromotionStrategy &#123; void doPromote(); &#125; CashBackStrategy ç°é‡‘æŠ˜è¿”ç­–ç•¥123456public class CashBackStrategy implements IPromotionStrategy&#123; @Override public void doPromote() &#123; System.out.println(&quot;ç›´æ¥è¿”ç°&quot;); &#125;&#125; CouponStrategy ä¼˜æƒ åˆ¸ç­–ç•¥1234567public class CouponStrategy implements IPromotionStrategy&#123; // ä¼˜æƒ åˆ¸ç­–ç•¥ @Override public void doPromote() &#123; System.out.println(&quot;ä½¿ç”¨ä¼˜æƒ åˆ¸æŠµæ‰£&quot;); &#125;&#125; GroupBuyStrategy å›¢è´­ä¼˜æƒ ç­–ç•¥123456public class GroupBuyStrategy implements IPromotionStrategy&#123; @Override public void doPromote() &#123; System.out.println(&quot;å›¢è´­ 5äººæˆå›¢&quot;); &#125;&#125; EmptyStrategy é»˜è®¤ç­–ç•¥123456public class EmptyStrategy implements IPromotionStrategy&#123; @Override public void doPromote() &#123; System.out.println(&quot;æ— ä»»ä½•ä¼˜æƒ &quot;); &#125;&#125; PromoteActivity å®¢æˆ·ç«¯å’Œå…·ä½“ç®—æ³•ä¹‹é—´çš„ä¸Šä¸‹æ–‡ï¼Œç”¨äºæ¡¥æ¥123456789101112public class PromoteActivity &#123; private IPromotionStrategy promotionStrategy; public PromoteActivity(IPromotionStrategy promotionStrategy) &#123; this.promotionStrategy = promotionStrategy; &#125; public void execute()&#123; promotionStrategy.doPromote(); &#125;&#125; PromoteStrategyFactory ç­–ç•¥å·¥å‚123456789101112131415161718192021222324252627282930313233343536public class PromoteStrategyFactory &#123; private PromoteStrategyFactory() &#123; &#125; // ç­–ç•¥å®¹å™¨ private static Map&lt;String, IPromotionStrategy&gt; promotionStrategyMap = new HashMap&lt;&gt;(); // é»˜è®¤ç©ºç­–ç•¥-æ²¡æœ‰ä»»ä½•ä¼˜æƒ  private static IPromotionStrategy emptyStrategy = new EmptyStrategy(); // è¿™ä¸ªå¯ä»¥æ”¾åˆ°é…ç½®æ–‡ä»¶æˆ–è€…æ”¾åˆ°æ•°æ®åº“ï¼Œåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™åŠ è½½åˆ°æœåŠ¡ä¸­å°±å¯ä»¥äº† static &#123; promotionStrategyMap.put(PromoteKey.CASH_BACK, new CashBackStrategy()); promotionStrategyMap.put(PromoteKey.COUPON, new CouponStrategy()); promotionStrategyMap.put(PromoteKey.CROUP_BUY, new GroupBuyStrategy()); &#125; // ç®€å•å·¥å‚åˆ›å»ºè¥é”€ç­–ç•¥ public static IPromotionStrategy createPromoteStrategy(String key) &#123; IPromotionStrategy promotionStrategy = promotionStrategyMap.get(key); if (promotionStrategy == null) &#123; return emptyStrategy; &#125; return promotionStrategy; &#125; // æ‰€æœ‰å®šä¹‰å¥½çš„ç­–ç•¥ private interface PromoteKey &#123; String COUPON = &quot;coupon&quot;; String CROUP_BUY = &quot;groupBuy&quot;; String CASH_BACK = &quot;cashBack&quot;; &#125; // å› ä¸ºç­–ç•¥æ¨¡å¼éœ€è¦ç”¨æˆ·çŸ¥é“æ‰€æœ‰å¯ç”¨çš„ç­–ç•¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æš´éœ²ç»™å®¢æˆ·ç«¯ public static Set&lt;String&gt; getPromoteKeySet() &#123; return promotionStrategyMap.keySet(); &#125;&#125; ç­–ç•¥æ¨¡å¼ä¸‹å®¢æˆ·ç«¯å†™æ³• 12345public static void main(String[] args) &#123; String strategy = PromoteStrategyFactory.getPromoteKeySet().stream().findAny().get(); IPromotionStrategy promoteStrategy = PromoteStrategyFactory.createPromoteStrategy(strategy); promoteStrategy.doPromote();&#125; éç­–ç•¥æ¨¡å¼ä¸‹å®¢æˆ·ç«¯å†™æ³•1234567891011121314public static void main(String[] args) &#123; String strategy = &quot;å®¢æˆ·é€‰æ‹©çš„ç­–ç•¥&quot;; IPromotionStrategy promotionStrategy; if (&quot;å›¢è´­&quot;.equals(strategy))&#123; promotionStrategy = new GroupBuyStrategy(); &#125;else if (&quot;ä¼˜æƒ åˆ¸&quot;.equals(strategy))&#123; promotionStrategy = new CouponStrategy(); &#125;else if (&quot;ç°é‡‘æŠ˜è¿”&quot;.equals(strategy))&#123; promotionStrategy = new CashBackStrategy(); &#125;else &#123; promotionStrategy = new EmptyStrategy(); &#125; promotionStrategy.doPromote();&#125; ä»¥ä¸Šçš„å¯¹æ¯”ï¼Œå“ªç§æ–¹å¼æ¯”è¾ƒä¼˜é›…ï¼Œç«‹è§é«˜ä¸‹äº†å§ğŸ˜„ğŸ˜„ğŸ˜„ ç­–ç•¥æ¨¡å¼çš„ä¼˜ç‚¹ ç­–ç•¥æ¨¡å¼æ˜¯ç¬¦åˆå¼€é—­åŸåˆ™çš„ é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ if-elseè¯­å¥ã€switchè¯­å¥ç­‰ ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥æé«˜ç®—æ³•çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ï¼ˆå®¢æˆ·ç«¯é€šè¿‡ä¸Šä¸‹æ–‡ç»„å»ºæ¥è°ƒç”¨å…·ä½“çš„ç®—æ³•-æ¡¥æ¥ï¼‰ ç­–ç•¥æ¨¡å¼çš„ç¼ºç‚¹ å®¢æˆ·ç«¯å¿…é¡»è¦çŸ¥é“å…¨éƒ¨å¯ç”¨çš„ç­–ç•¥ï¼Œç„¶åç”±ç”¨æˆ·å†³å®šä½¿ç”¨é‚£ä¸ªç­–ç•¥ï¼Œå†³å®šæƒåœ¨äºå®¢æˆ· ä»£ç ä¸­ä¼šäº§ç”Ÿå¾ˆå¤šçš„ç­–ç•¥ç±»ï¼Œå¢åŠ ä»£ç é‡å’Œç³»ç»Ÿçš„ç»´æŠ¤éš¾åº¦ ğŸ‘¤ä¸ªäººä½“ä¼š1ã€ç»“åˆä¸šåŠ¡åœºæ™¯æ¥è®¾è®¡ï¼Œä½“ä¼šè®¾è®¡æ¨¡å¼çš„æ€è·¯ï¼Œå­¦è®¾è®¡æ¨¡å¼æœ€é‡è¦çš„æ˜¯æ€æƒ³ï¼›2ã€è®¾è®¡æ¨¡å¼ä¸€èˆ¬åœ¨æ¡†æ¶ä¸­ä½“ç°çš„æ¯”è¾ƒå¤šï¼Œå¤§å®¶å¯ä»¥å¤šå­¦ä¹ ä¸€äº›æ¡†æ¶æºç çš„è®¾è®¡ç†å¿µï¼Œå¦‚æœä½ æ˜¯åˆçº§ï¼Œå¯èƒ½ä¸€ä¸‹å­ç†è§£ä¸äº†ï¼Œæ…¢æ…¢ä½“ä¼šå§ï¼Œå½“ä½ å·¥ä½œä¸€æ®µæ—¶é—´ä¹‹åï¼Œè§è¿‡ä¸€äº›å·¥ä¸šç”Ÿäº§çš„é¡¹ç›®ï¼Œçœ‹è¿‡ä¸€äº›ä¼˜ç§€çš„æ¡†æ¶æºç çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ª â€œæŸ³æš—èŠ±æ˜åˆä¸€æ‘â€çš„é˜¶æ®µï¼›3ã€ä¸¾ä¸ªä¾‹å­ï¼ŒControlleræˆ‘ä»¬éƒ½å†™è¿‡çš„ï¼Œä¸€ä¸ªé¡¹ç›®ä¸­çš„æ¥å£è·¯å¾„æ˜¯å”¯ä¸€çš„ï¼Œé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œç”±SpringåŠ è½½åˆ°å®¹å™¨ä¸­ï¼Œå½“ç”±è¯·æ±‚è¿›æ¥æ—¶æ˜¯ï¼ŒSpringæ˜¯æ ¹æ®pathæ¥è¿”å›å…·ä½“çš„æ§åˆ¶å™¨ï¼Œä¹Ÿå°±æ˜¯Controllerå…·ä½“çš„æ–¹æ³•ï¼›4ã€è¿˜æœ‰Comparatoræ¯”è¾ƒå™¨ï¼Œä¸åŒçš„å®¹å™¨å†…éƒ¨åšæ•°æ®æ’åºçš„æ—¶å€™ç”±ä¸åŒçš„å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ç­–ç•¥æ¨¡å¼çš„ä½“ç°ï¼›5ã€æœ¬æ–‡ä¸­çš„ä¾‹å­è™½ç„¶ç®€å•ï¼Œä½†æ˜¯åŒ…å«äº†ç®€å•å·¥å‚æ¨¡å¼ï¼Œæ¡¥æ¥æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ã€‚ä»»ä½•ä¸€ç§è®¾è®¡æ¨¡å¼éƒ½éš¾ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œè¿™ä¸ªå¤§å®¶è¦æ³¨æ„ï¼›","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-æ¡¥æ¥æ¨¡å¼","date":"2021-08-07T11:59:32.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-æ¡¥æ¥æ¨¡å¼/","text":"æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰æ¡¥æ¥æ¨¡å¼ä¹Ÿç§°ä¸ºæ¡¥æ¢æ¨¡å¼ï¼Œæ¥å£ï¼ˆIntegerï¼‰æ¨¡å¼æˆ–è€…æŸ„ä½“ï¼ˆHandle and Bodyï¼‰æ¨¡å¼ï¼Œæ˜¯å°†æŠ½è±¡éƒ¨åˆ†å’Œå®ƒçš„å…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œæ˜¯å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ï¼› é€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªç±»ä¹‹é—´çš„è”ç³»ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ï¼› æ¡¥æ¥æ¨¡å¼å±äºç»“æ„å‹æ¨¡å¼ï¼› ç»§æ‰¿ä¸€èˆ¬æ¥ä½œä¸ºå¤šç»§æ‰¿çš„å¤‡ç”¨æ–¹æ¡ˆï¼› æ¡¥æ¥æ¨¡å¼çš„ç»“æ„ æ¡¥æ¥æ¨¡å¼ä¸»è¦åŒ…æ‹¬ä¸€ä¸‹å‡ ä¸ªè§’è‰²ï¼š 1ã€æŠ½è±¡è§’è‰²ï¼ˆAbstractionï¼‰ï¼š å®šä¹‰æŠ½è±¡ç±»ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¯¹å®ç°åŒ–å¯¹è±¡çš„å¼•ç”¨ï¼Œæ­£æ˜¯è¿™ä¸ªå¼•ç”¨ï¼Œèµ·ç€æ¡¥æ¢æ€§çš„ä½œç”¨ï¼›2ã€æ‰©å±•æŠ½è±¡åŒ–ï¼ˆRefined Abstractionï¼‰è§’è‰²ï¼š Abstraction123456789101112public abstract class Abstraction &#123; protected IImplementor iImplementor; public Abstraction(IImplementor iImplementor) &#123; this.iImplementor = iImplementor; &#125; public void operation()&#123; this.iImplementor.operation(); &#125;&#125; IImplementor123public interface IImplementor &#123; void operation();&#125; ConcreteImplementA1234567public class ConcreteImplementA implements IImplementor&#123; @Override public void operation() &#123; &#125;&#125; ConcreteImplementB1234567public class ConcreteImplementB implements IImplementor&#123; @Override public void operation() &#123; &#125;&#125; RefinedAbstraction1234567891011public class RefinedAbstraction extends Abstraction&#123; public RefinedAbstraction(IImplementor iImplementor) &#123; super(iImplementor); &#125; @Override public void operation() &#123; super.operation(); &#125;&#125; ä¸¾ä¸ªä¾‹å­ AbstractMessage123456789101112public abstract class AbstractMessage &#123; private IMessage message; public AbstractMessage(IMessage message) &#123; this.message = message; &#125; void sendMsg(String msg,String toUser)&#123; this.message.send(msg,toUser); &#125;&#125; IMessage123public interface IMessage &#123; void send(String msg,String toUser);&#125; SmsMessage123456public class SmsMessage implements IMessage&#123; @Override public void send(String msg, String toUser) &#123; System.err.println(&quot;ä½¿ç”¨çŸ­ä¿¡æ¶ˆæ¯å‘é€ &quot; + msg + &quot; å‘é€ç»™ &quot; + toUser); &#125;&#125; EmailMessage123456public class EmailMessage implements IMessage&#123; @Override public void send(String msg, String toUser) &#123; System.err.println(&quot;ä½¿ç”¨é‚®ä»¶æ¶ˆæ¯å‘é€ &quot; + msg + &quot; å‘é€ç»™ &quot; + toUser); &#125;&#125; NormalMessage1234567891011public class NormalMessage extends AbstractMessage&#123; public NormalMessage(IMessage message) &#123; super(message); &#125; @Override void sendMsg(String msg, String toUser) &#123; super.sendMsg(msg, toUser); &#125;&#125; UegencyMessage12345678910public class UegencyMessage extends AbstractMessage&#123; void sendMsg(String msg,String toUser)&#123; msg = &quot;[ åŠ æ€¥]&quot; + msg; super.sendMsg(msg,toUser); &#125; public UegencyMessage(IMessage message) &#123; super(message); &#125;&#125; DemoTest123456789101112public class DemoTest &#123; public static void main(String[] args) &#123; IMessage message = new SmsMessage(); AbstractMessage abstractMessage = new NormalMessage(message); abstractMessage.sendMsg(&quot;åŠ ç­ç”³è¯·&quot;,&quot;è€å¤§&quot;); message = new EmailMessage(); abstractMessage = new UegencyMessage(message); abstractMessage.sendMsg(&quot;è°ƒä¼‘ç”³è¯·&quot;,&quot;è€æ€»&quot;); &#125;&#125; 12ä½¿ç”¨çŸ­ä¿¡æ¶ˆæ¯å‘é€ åŠ ç­ç”³è¯· å‘é€ç»™ è€å¤§ä½¿ç”¨é‚®ä»¶æ¶ˆæ¯å‘é€ [ åŠ æ€¥]è°ƒä¼‘ç”³è¯· å‘é€ç»™ è€æ€» æ¡¥æ¥æ¨¡å¼çš„é€‚ç”¨åœºæ™¯1ã€åœ¨æŠ½è±¡å’Œå…·ä½“å®ç°ä¹‹é—´éœ€è¦å¢åŠ æ›´å¤šçš„çµæ´»æ€§çš„åœºæ™¯ï¼›2ã€ä¸€ä¸ªç±»åœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œè€Œè¿™ä¸¤ä¸ªæˆ–å¤šä¸ªç»´åº¦éƒ½éœ€è¦ç‹¬ç«‹çš„è¿›è¡Œæ‹“å±•3ã€ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿ï¼Œæˆ–è€…å› ä¸ºå¤šå±‚ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°å‰§å¢ï¼› æ¡¥æ¥æ¨¡å¼çš„ä¼˜ç‚¹1ã€éµå¾ªè½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œåˆ†ç¦»æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†2ã€æé«˜äº†ç³»ç»Ÿçš„æ‰©å±•æ€§3ã€ç¬¦åˆå¼€é—­åŸåˆ™4ã€ç¬¦åˆåˆæˆå¤ç”¨åŸåˆ™ ä¸ä½¿ç”¨ç»§æ‰¿è€Œä½¿ç”¨ç»„åˆ æ¡¥æ¥æ¨¡å¼1ã€å¢åŠ äº†ç³»ç»Ÿä»£ç å¯è¯»æ€§å’Œå¤æ‚æ€§2ã€éœ€è¦æ­£ç¡®è¯†åˆ«äº¤æ¥çš„ä¸åŒç»´åº¦","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-å»ºé€ è€…æ¨¡å¼","date":"2021-08-07T11:55:36.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-å»ºé€ è€…æ¨¡å¼/","text":"å»ºé€ è€…æ¨¡å¼ å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰å°†ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸å®ƒçš„è¡¨ç¤ºï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºå‡ºä¸åŒçš„è¡¨ç¤ºã€‚ å»ºé€ è€…æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼› å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œä½¿ç”¨å»ºé€ è€…æ¨¡å¼åªéœ€è¦æŒ‡å®šéœ€è¦åˆ›å»ºçš„ç±»å‹å°±å¯ä»¥è·å–å¯¹è±¡ï¼Œåˆ›å»ºçš„è¿‡ç¨‹ä»¥åŠç»†èŠ‚ä¸éœ€è¦äº†è§£ï¼Œæ ¹æ®å»ºé€ è€…æ¨¡å¼çš„å®šä¹‰ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸¤å±‚å«ä¹‰ï¼š1ã€æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ï¼›æ„å»ºä»£è¡¨å¯¹è±¡åˆ›å»ºï¼Œè¡¨ç¤ºä»£è¡¨å¯¹è±¡è¡Œä¸ºï¼Œæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†å¯¹è±¡çš„åˆ›å»ºä¸è¡Œä¸ºåˆ†ç¦»ï¼›ï¼ˆå¯¹åº”åˆ°Javaä»£ç ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨æ¥å£è§„èŒƒè¡Œä¸ºï¼Œç„¶åç”±å…·ä½“çš„å®ç°è¿›è¡Œæ„å»ºï¼‰2ã€åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼›ä¹Ÿå°±æ˜¯å…·å¤‡åŒæ ·çš„è¡Œä¸ºï¼Œä½†æ˜¯å´ç”±äºæ„å»ºçš„è¡Œä¸ºé¡ºåºä¸åŒæˆ–å…¶ä»–åŸå› å¯ä»¥åˆ›å»ºå‡ºä¸åŒçš„è¡¨ç¤ºï¼› Course1234567891011@Data@Getter@Setterpublic class Course &#123; private String name; private String ppt; private String video; private String note; private String homework; &#125; CourseBuilder123456789101112131415161718192021222324252627282930public class CourseBuilder &#123; private Course course = new Course(); public CourseBuilder addName(String name)&#123; course.setName(name); return this; &#125; public CourseBuilder addHomework(String homework)&#123; course.setHomework(homework); return this; &#125; public CourseBuilder addVideo(String video)&#123; course.setVideo(video); return this; &#125; public CourseBuilder addPpt(String ppt)&#123; course.setPpt(ppt); return this; &#125; public CourseBuilder addNote(String note)&#123; course.setNote(note); return this; &#125; public Course builder()&#123; return course; &#125; &#125; DomoTest æµ‹è¯•123456789public class DomoTest &#123; public static void main(String[] args) &#123; CourseBuilder courseBuilder = new CourseBuilder(); courseBuilder.addHomework(&quot;è¯¾åä½œä¸š111&quot;) .addName(&quot;è®¾è®¡æ¨¡å¼&quot;) .addNote(&quot;è¯¾å ‚ç¬”è®°&quot;); System.out.println(&quot;courseBuilder = &quot; + courseBuilder.builder()); &#125;&#125; è¾“å‡ºç»“æœï¼š 1courseBuilder = Course(name=è®¾è®¡æ¨¡å¼, ppt=null, video=null, note=è¯¾å ‚ç¬”è®°, homework=è¯¾åä½œä¸š111) å»ºé€ è€…åœ¨JDKä¸­çš„åº”ç”¨StringBuilder 123public final class StringBuilder extends AbstractStringBuilder implements java.io.Serializable, CharSequence&#123;&#125; java.lang.StringBuilder.append(java.lang.CharSequence)12345@Overridepublic StringBuilder append(CharSequence s) &#123; super.append(s); return this;&#125; è¿™é‡Œçš„StringBuilderå°±æ˜¯ä¸€ä¸ªå®ç°æ„é€ å™¨ï¼Œåªä¸è¿‡å®ƒçš„ä¸Šçº§è¿˜æœ‰ä¸€ä¸ªæŠ½è±¡çš„æ„é€ å™¨AbstractStringBuilder;çœ‹åˆ°è¿™æºç æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­ç±»ä¼¼å‘¢ï¼Œè¿™å°±æ˜¯JDKæºç ä¸­å¾ˆå…¸å‹çš„å»ºé€ è€…æ¨¡å¼çš„åº”ç”¨ï¼›å¤„ç†ä¸Šé¢çš„StringBuilderä¹‹å¤–ï¼Œè¿˜æœ‰åƒMybatisæ¡†æ¶ä¸­çš„CacheBuilderç¼“å­˜æ„é€ å™¨ï¼Œè¿˜æœ‰åƒSqlSessionFactoryè£…è½½æ—¶çš„openSessionæ–¹æ³•éƒ½æ˜¯å»ºé€ è€…æ¨¡å¼ï¼› å»ºé€ è€…æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ é€‚ç”¨äºåˆ›å»ºå¯¹è±¡éœ€è¦å¾ˆå¤šæ­¥éª¤ï¼Œä½†æ˜¯æ­¥éª¤çš„é¡ºåºä¸ä¸€å®šæ˜¯å›ºå®šçš„ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰éå¸¸å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼ˆæœ‰å¾ˆå¤šçš„æˆå‘˜å˜é‡æˆ–å±æ€§ï¼‰ æŠŠå¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦» å»ºé€ è€…æ¨¡å¼çš„ä¼˜ç‚¹ å°è£…è¡Œå¾ˆå¥½ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹å’Œä½¿ç”¨åˆ†ç¦»å¼€ æ‰©å±•æ€§å¥½ï¼Œå»ºé€ ç±»ä¹‹é—´ç‹¬ç«‹ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£è€¦ ä¾¿äºæ§åˆ¶ç»†èŠ‚ï¼Œå»ºé€ è€…å¯ä»¥å¯¹åˆ›å»ºè¿‡ç¨‹é€æ­¥ç»†åŒ–ï¼Œè€Œä¸å¯¹å…¶ä»–æ¨¡å—äº§ç”Ÿä»»ä½•å½±å“ å»ºé€ è€…æ¨¡å¼çš„ç¼ºç‚¹ äº§ç”Ÿäº†å¯¹äºçš„Builderå¯¹è±¡ï¼Œé€ æˆäº†ç±»çš„å†—ä½™ å¦‚æœäº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œå»ºé€ è€…éƒ½è¦ä¿®æ”¹ï¼Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒå¤§ï¼›ä¸é€‚åˆç»å¸¸å˜åŠ¨çš„å¯¹è±¡ï¼Œè¿™æ ·ä¹Ÿæ˜¯ä¸ç¬¦åˆå¼€é—­åŸåˆ™çš„ å»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„å¯¹æ¯” å»ºé€ è€…æ¨¡å¼æ›´åŠ æ³¨é‡æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼Œå·¥å‚æ¨¡å¼æ³¨é‡äºå¯¹è±¡çš„åˆ›å»º åˆ›å»ºå¯¹è±¡çš„åŠ›åº¦ä¸åŒï¼Œå»ºé€ è€…æ¨¡å¼åˆ›å»ºå¤æ‚çš„å¯¹è±¡ï¼Œç”±å„ç§å¤æ‚çš„ç»„ä»¶ç»„æˆï¼Œå·¥å‚æ¨¡å¼åˆ›å»ºå‡ºæ¥å¯¹è±¡çš„éƒ½ä¸€æ · å…³æ³¨ç‚¹ä¸åŒï¼Œå·¥å‚æ¨¡å¼åªéœ€è¦å§å¯¹è±¡åˆ›å»ºå‡ºæ¥å°±å¯ä»¥äº†ï¼Œè€Œå»ºé€ è€…æ¨¡å¼ä¸­ä¸ä»…è¦åˆ›å»ºå‡ºè¿™ä¸ªå¯¹è±¡ï¼Œè¿˜è¦çŸ¥é“è¿™ä¸ªå¯¹è±¡ç”±é‚£äº›ç»„ä»¶ç»„æˆ å»ºé€ è€…æ¨¡å¼æ ¹æ®å»ºé€ è¿‡ç¨‹ä¸­çš„é¡ºåºä¸ä¸€æ ·ï¼Œæœ€ç»ˆçš„å¯¹è±¡ä¸è§ç»„æˆä¹Ÿä¸ä¸€æ ·ï¼Œå¯¹è±¡çš„æ¯ä¸ªéƒ¨ä»¶çš„è®¾ç½®éƒ½æ˜¯å¾ˆçµæ´»çš„","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-å·¥å‚æ¨¡å¼","date":"2021-08-07T11:40:56.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-å·¥å‚æ¨¡å¼/","text":"1. ç®€å•å·¥å‚æ¨¡å¼ç®€å•å·¥å‚æ¨¡å¼æ˜¯æŒ‡æœ‰ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ä¸ªäº§å“ç±»çš„å®ä¾‹ï¼›å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œä½†å®ƒä¸å±äºGOF 23ç§è®¾è®¡æ¨¡å¼ã€‚ UMLç±»å›¾ ç»„æˆè¦ç´ 1ã€ä¸€ä¸ªæŠ½è±¡äº§å“ç±»2ã€å…·ä½“äº§å“ç±»3ã€ä¸€ä¸ªå·¥å‚ è‚¥å®…å–œçˆ±çš„å„ç§å¿«ä¹æ°´ï¼ˆäº§å“æ¥å£ï¼‰ 123public interface Kls &#123; String name();&#125; è‚¥å®…å¿«ä¹æ°´-å¯ä¹ï¼ˆå…·ä½“äº§å“ï¼‰ 123456public class Coke implements Kls &#123; @Override public String name() &#123; return &quot;è‚¥å®…å¿«ä¹æ°´-å¯ä¹&quot;; &#125;&#125; å¿«ä¹æ°´-é›ªç¢§ï¼ˆå…·ä½“äº§å“ï¼‰ 123456public class Sprite implements Kls &#123; @Override public String name() &#123; return &quot;å¿«ä¹æ°´-é›ªç¢§&quot;; &#125;&#125; å¿«ä¹æ°´ç”Ÿäº§å·¥å‚(å·¥å‚ç±») 1234567891011121314public class KlsFactory &#123; public static Kls getFzs(String type) throws Exception &#123; Kls fzs = null; if (&quot;coke&quot;.equalsIgnoreCase(type)) &#123; fzs = new Coke(); &#125; else if (&quot;sprite&quot;.equalsIgnoreCase(type)) &#123; fzs = new Sprite(); &#125; if (Objects.isNull(fzs)) &#123; throw new RuntimeException(&quot;æ²¡æ‰¾åˆ°å¿«ä¹æ°´~&quot;); &#125; return fzs; &#125;&#125; å®¢æˆ·ç«¯ä½¿ç”¨ 12345678910111213public class Fz &#123; @Test public void drink() throws Exception &#123; // åˆ¶é€ å¯ä¹ Kls coke = KlsFactory.getFzs(&quot;coke&quot;); System.out.println(&quot;è‚¥å®…å¼€å§‹å–ï¼š&quot; + coke.name()); // åˆ¶é€ é›ªç¢§ Kls sprite = KlsFactory.getFzs(&quot;sprite&quot;); System.out.println(&quot;è‚¥å®…å¼€å§‹å–ï¼š&quot; + sprite.name()); &#125;&#125; 1.1 ä¼˜ç‚¹ å¯¹å®¢æˆ·ç«¯éšè—çš„å…·ä½“çš„å®ç°ï¼Œå®¢æˆ·ç«¯åªéœ€è¦çŸ¥é“è¦åˆ›å»ºä»€ä¹ˆå¯¹è±¡å³å¯ï¼Œä¸ç”¨å…³å¿ƒå¯¹è±¡æ˜¯æ€ä¹ˆåˆ›å»ºçš„ è§£è€¦ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦é€šè¿‡newæ¥åˆ›å»ºå¯¹è±¡ï¼Œå¦‚æœåæœŸäº§å“ç±»éœ€è¦ä¿®æ”¹ï¼Œåˆ™åªéœ€è¦ä¿®æ”¹å·¥å‚ç±»å³å¯ï¼Œä¸ç”¨æ•´ä¸ªé¡¹ç›®éåœ°å»å¯»æ‰¾å“ªé‡Œæœ‰new 1.2 ç¼ºç‚¹ ç”±ä¸€ä¸ªä¸“é—¨çš„å·¥å‚è´Ÿè´£ç”Ÿäº§ï¼Œå¦‚æœä¸šåŠ¡å˜å¾—å¤æ‚ï¼Œè¿™ä¸ªç±»å°†å˜å¾—ååˆ†è‡ƒè‚¿ å·¥å‚ç±»ç”Ÿäº§ä»€ä¹ˆäº§å“éƒ½æ˜¯å†™æ­»åœ¨å·¥å‚ä¸­çš„ï¼Œå¦‚æœå¢åŠ æ–°çš„äº§å“ï¼Œè¿˜è¦ä¿®æ”¹å·¥å‚ç±»çš„ç”Ÿäº§é€»è¾‘ 2. å·¥å‚æ–¹æ³•æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰æ˜¯ç®€å•å·¥å‚çš„ä»…ä¸€æ­¥æ·±åŒ–ï¼Œ åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä¸å†æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å·¥å‚ç±»æ¥åˆ›å»ºæ‰€æœ‰çš„å¯¹è±¡ï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒçš„å¯¹è±¡æä¾›ä¸åŒçš„å·¥å‚ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„å·¥å‚ã€‚ ç»„æˆè¦ç´ 1ã€ä¸€ä¸ªæŠ½è±¡äº§å“ç±»2ã€å¤šä¸ªå…·ä½“äº§å“ç±»3ã€ä¸€ä¸ªæŠ½è±¡å·¥å‚4ã€å¤šä¸ªå…·ä½“å·¥å‚ - æ¯ä¸€ä¸ªå…·ä½“äº§å“å¯¹åº”ä¸€ä¸ªå…·ä½“å·¥å‚5ã€ç¬¦åˆ - OCPå¼€æ”¾å°é—­åŸåˆ™ æ¥ç€ä¸Šé¢å¿«ä¹æ°´çš„ä¾‹å­ã€‚å°† å¿«ä¹æ°´å·¥å‚ ï¼ˆKlsFactoryï¼‰ æŠ½è±¡å‡ºå…±æœ‰æ–¹æ³•ï¼Œå†åˆ†åˆ«å®ç°å…·ä½“çš„å¿«ä¹æ°´ç”Ÿäº§å·¥å‚ã€‚ å¿«ä¹æ°´æ€»å·¥å‚ 12345678public interface Factory &#123; /** * åˆ¶é€ å¿«ä¹æ°´ * * @return Kls */ Kls create();&#125; å¯ä¹å·¥å‚ 123456public class CokeFactory implements Factory &#123; @Override public Kls create() &#123; return new Coke(); &#125;&#125; é›ªç¢§å·¥å‚ 123456public class SpriteFactory implements Factory &#123; @Override public Kls create() &#123; return new Sprite(); &#125;&#125; è‚¥å®…(å®¢æˆ·ç«¯) 1234567891011121314public class Fz &#123; @Test public void drink() throws Exception &#123; // åˆ¶é€ å¯ä¹ CokeFactory cokeFactory = new CokeFactory(); Kls coke = cokeFactory.create(); System.out.println(&quot;è‚¥å®…å¼€å§‹å–ï¼š&quot; + coke.name()); // åˆ¶é€ é›ªç¢§ SpriteFactory spriteFactory = new SpriteFactory(); Kls sprite = spriteFactory.create(); System.out.println(&quot;è‚¥å®…å¼€å§‹å–ï¼š&quot; + sprite.name()); &#125;&#125; æ‰©å±•èŠ¬è¾¾å¿«ä¹æ°´ 123456public class Fanta implements Kls &#123; @Override public String name() &#123; return &quot;å¿«ä¹æ°´-èŠ¬è¾¾&quot;; &#125;&#125; å¤åˆ¶ä»£ç èŠ¬è¾¾å·¥å‚ 123456public class FantaFactory implements Factory &#123; @Override public Kls create() &#123; return new Fanta(); &#125;&#125; è‚¥å®…ä½¿ç”¨æ·»åŠ  123FantaFactory fantaFactory = new FantaFactory();Kls fanta = fantaFactory.create();System.out.println(&quot;è‚¥å®…å¼€å§‹å–ï¼š&quot; + fanta.name()); 2.1 ä¼˜ç‚¹1ã€é™ä½äº†ä»£ç è€¦åˆåº¦ï¼Œå¯¹è±¡çš„ç”Ÿæˆäº¤ç»™å­ç±»å»å®Œæˆï¼ˆè¿™é‡Œçš„è€¦åˆåº¦æ˜¯ç›¸å¯¹äºç®€å•å·¥å‚æ¨¡å¼çš„å·¥å‚ç±»æ¯”è¾ƒçš„ï¼‰2ã€é™ä½äº†ä»£ç è€¦åˆåº¦ï¼Œå¯¹è±¡çš„ç”Ÿæˆäº¤ç»™å­ç±»å»å®Œæˆ 2.2 ç¼ºç‚¹1ã€å¢åŠ äº†ä»£ç é‡ï¼Œæ¯ä¸ªå…·ä½“äº§å“éƒ½éœ€è¦ä¸€ä¸ªå…·ä½“å·¥å‚ï¼ˆåœ¨å…·ä½“çš„ä¸šåŠ¡ä¸­å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„é‡å¤ä»£ç ï¼‰2ã€å½“å¢åŠ æŠ½è±¡äº§å“ ä¹Ÿå°±æ˜¯æ·»åŠ ä¸€ä¸ªå…¶ä»–äº§å“æ— éœ€è¦ä¿®æ”¹å·¥å‚ è¿èƒŒOCP 3. æŠ½è±¡å·¥å‚æ¨¡å¼ ç»„æˆè¦ç´ 1ã€å¤šä¸ªæŠ½è±¡äº§å“ç±»2ã€å…·ä½“äº§å“ç±»3ã€æŠ½è±¡å·¥å‚ç±» - å£°æ˜(ä¸€ç»„)è¿”å›æŠ½è±¡äº§å“çš„æ–¹æ³•4ã€å…·ä½“å·¥å‚ç±» - ç”Ÿæˆ(ä¸€ç»„)å…·ä½“äº§å“ ä¸€ä¸ªæŠ½è±¡äº§å“ç±»å’Œä¸¤ä¸ªå…·ä½“çš„äº§å“ï¼ˆå¯ä¹ï¼‰ 1234567891011121314151617public abstract class Coke &#123; public abstract void doCreate();&#125;public class LocalCoke extends Coke&#123; @Override public void doCreate() &#123; System.err.println(&quot;ç”Ÿäº§æœ¬åœŸå¯ä¹&quot;); &#125;&#125;public class ForeignCoke extends Coke&#123; @Override public void doCreate() &#123; System.out.println(&quot;ç”Ÿäº§å¤–å›½å¯ä¹&quot;); &#125;&#125; ä¸€ä¸ªæŠ½è±¡äº§å“ç±»å’Œä¸¤ä¸ªå…·ä½“çš„äº§å“ï¼ˆé›ªç¢§ï¼‰ 1234567891011121314151617public abstract class Sprite &#123; public abstract void doCreate();&#125;public class LocalSprite extends Sprite&#123; @Override public void doCreate() &#123; System.out.println(&quot;ç”Ÿäº§æœ¬åœ°é›ªç¢§&quot;); &#125;&#125;public class ForeignSprite extends Sprite&#123; @Override public void doCreate() &#123; System.err.println(&quot;ç”Ÿäº§å¤–å›½é›ªç¢§&quot;); &#125;&#125; ä¸€ä¸ªæŠ½è±¡å·¥å‚å’Œä¸¤ä¸ªå…·ä½“çš„å·¥å‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public interface IAbstractFactory &#123; /** * æˆäº§å¯ä¹ * * @return å£°æ˜(ä¸€ç»„)è¿”å›æŠ½è±¡äº§å“çš„æ–¹æ³• */ Coke createCoke(); /** * ç”Ÿäº§é›ªç¢§ * * @return å£°æ˜(ä¸€ç»„)è¿”å›æŠ½è±¡äº§å“çš„æ–¹æ³• */ Sprite createSprite();&#125;public class LocalFactory implements IAbstractFactory&#123; /** * æˆäº§å¯ä¹ * * @return ç”Ÿæˆ(ä¸€ç»„)å…·ä½“äº§å“ */ @Override public LocalCoke createCoke() &#123; return new LocalCoke(); &#125; /** * ç”Ÿäº§é›ªç¢§ * * @return ç”Ÿæˆ(ä¸€ç»„)å…·ä½“äº§å“ */ @Override public LocalSprite createSprite() &#123; return new LocalSprite(); &#125;&#125;public class ForeignFactory implements IAbstractFactory&#123; /** * æˆäº§å¯ä¹ * * @return ç”Ÿæˆ(ä¸€ç»„)å…·ä½“äº§å“ */ @Override public ForeignCoke createCoke() &#123; return new ForeignCoke(); &#125; /** * ç”Ÿäº§é›ªç¢§ * * @return ç”Ÿæˆ(ä¸€ç»„)å…·ä½“äº§å“ */ @Override public ForeignSprite createSprite() &#123; return new ForeignSprite(); &#125;&#125; 3.1 æŠ½è±¡å·¥å‚çš„ä½¿ç”¨1234567891011public class FactoryTest &#123; public static void main(String[] args) &#123; LocalFactory localFactory = new LocalFactory(); LocalCoke localCoke = localFactory.createCoke(); localCoke.doCreate(); ForeignFactory foreignFactory = new ForeignFactory(); ForeignSprite foreignSprite = foreignFactory.createSprite(); foreignSprite.doCreate(); &#125;&#125; 3.2 ä¼˜ç‚¹1ã€ä»£ç è§£è€¦2ã€å¾ˆå¥½çš„æ»¡è¶³OCPå¼€æ”¾å°é—­åŸåˆ™3ã€æŠ½è±¡å·¥å‚æ¨¡å¼ä¸­æˆ‘ä»¬å¯ä»¥å®šä¹‰å®ç°ä¸æ­¢ä¸€ä¸ªæ¥å£ï¼Œä¸€ä¸ªå·¥å‚ä¹Ÿå¯ä»¥ç”Ÿæˆä¸æ­¢ä¸€ä¸ªäº§å“ç±» å¯¹äºå¤æ‚å¯¹è±¡çš„ç”Ÿäº§ç›¸å½“çµæ´»æ˜“æ‰©å±•(ç›¸å¯¹äºå·¥å‚æ–¹æ³•æ¨¡å¼çš„ä¼˜åŒ–) 3.3 ç¼ºç‚¹1ã€æ‰©å±•äº§å“æ˜¯éœ€è¦ä¿®æ”¹æ‰€æœ‰å·¥å‚ï¼Œè¿åè¿åOCPåŸåˆ™2ã€æ•´ä½“å®ç°ä¹Ÿæ¯”è¾ƒå¤æ‚ å‚è€ƒæ–‡ç«  è®¾è®¡æ¨¡å¼-ç®€å•å·¥å‚ã€å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ è®¾è®¡æ¨¡å¼ â€”â€” å·¥å‚æ¨¡å¼ è¿˜æœ‰å¤šå°‘ä¸ªåå¹´ ç»§ç»­åšçƒ­è¡€å°‘å¹´","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-åŸå‹æ¨¡å¼","date":"2021-08-07T11:31:43.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-åŸå‹æ¨¡å¼/","text":"åŸå‹æ¨¡å¼åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰æŒ‡åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡å¤åˆ¶è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå±äºåˆ›å»ºå‹æ¨¡å¼ï¼› åŸå‹æ¨¡å¼çš„æ ¸å¿ƒåœ¨äºå¤åˆ¶åŸå‹å¯¹è±¡ã€‚ä»¥ç³»ç»Ÿä¸­å·²å­˜åœ¨çš„ä¸€ä¸ªå¯¹è±¡ä¸ºåŸå‹ï¼Œç›´æ¥åŸºäºå†…å­˜äºŒè¿›åˆ¶æµè¿›è¡Œå¤åˆ¶ï¼Œä¸éœ€è¦å†ç²¾åŠ›è€—æ—¶çš„å¯¹è±¡åˆå§‹åŒ–è¿‡ç¨‹ï¼ˆä¸è°ƒç”¨æ„é€ å‡½æ•°ï¼‰ï¼Œæ€§èƒ½æå‡å¾ˆå¤šã€‚å½“å¯¹è±¡çš„æ„é€ è¿‡ç¨‹æ¯”è¾ƒè€—æ—¶æ—¶ï¼Œå¯ä»¥æŠŠå½“å‰ç³»ç»Ÿå·²å­˜åœ¨çš„å¯¹è±¡ä½œä¸ºåŸå‹ï¼Œå¯¹å…¶è¿›è¡Œå¤åˆ¶ï¼ˆä¸€èˆ¬æ˜¯åŸºäºäºŒè¿›åˆ¶æµçš„å¤åˆ¶ï¼‰ï¼Œèº²é¿åˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿å¾—æ–°å¯¹è±¡çš„åˆ›å»ºæ—¶é—´å¤§å¤§ç¼©çŸ­ï¼› åŸå‹æ¨¡å¼ç±»å›¾ IPrototype å®šä¹‰å…‹éš†çš„æ–¹æ³• ç±»ä¼¼äºJDKè‡ªå¸¦çš„Cloneable123public interface IPrototype&lt;T&gt; &#123; T clone();&#125; ConcretePrototype å…·ä½“çš„è¦å…‹éš†çš„å¯¹è±¡1234567891011121314151617181920212223242526272829303132333435363738public class ConcretePrototype implements IPrototype &#123; private int age; private String name; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; // å¯èƒ½æˆ‘ä»¬å¹³æ—¶éƒ½è¿™ä¹ˆå»å¤åˆ¶å¯¹è±¡ @Override public ConcretePrototype clone() &#123; ConcretePrototype concretePrototype = new ConcretePrototype(); concretePrototype.setAge(this.age); concretePrototype.setName(this.name); return concretePrototype; &#125; @Override public String toString() &#123; return &quot;ConcretePrototype&#123;&quot; + &quot;age=&quot; + age + &quot;, name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; Client å®¢æˆ·ç«¯ æµ‹è¯•123456789101112public static void main(String[] args) &#123; //åˆ›å»ºåŸå‹å¯¹è±¡ ConcretePrototype prototype = new ConcretePrototype(); prototype.setAge(18); prototype.setName(&quot;Tom&quot;); System.out.println(prototype); //æ‹·è´åŸå‹å¯¹è±¡ ConcretePrototype cloneType = prototype.clone(); System.out.println(cloneType); System.err.println(cloneType == prototype); &#125; è¿è¡Œç»“æœï¼š 123ConcretePrototype&#123;age=18, name=&#x27;Tom&#x27;&#125;ConcretePrototype&#123;age=18, name=&#x27;Tom&#x27;&#125;false å®ç°JDK Cloneableçš„å…‹éš†å¯¹è±¡å†™æ³•1234567891011121314151617181920212223242526272829303132333435363738394041public class ConcretePrototype1 implements Cloneable &#123; private int age; private String name; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; @Override public ConcretePrototype1 clone() &#123; Object clone = null; try &#123; clone = super.clone(); &#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace(); System.err.println(&quot;Clone Error!&quot;); &#125; return (ConcretePrototype1) clone; &#125; @Override public String toString() &#123; return &quot;ConcretePrototype&#123;&quot; + &quot;age=&quot; + age + &quot;, name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; è¾“å‡ºç»“æœåŒä¸Šï¼›ä»¥ä¸Šçš„ä¸¤ä¸ªå±æ€§éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’ŒStringï¼Œå¹¶æ²¡æœ‰å¼•ç”¨ç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å±æ€§æµ‹è¯•ä»¥ä¸‹ğŸ‘‡ğŸ‘‡ ConcretePrototypeæ·»åŠ ä¸€ä¸ªListç±»å‹å±æ€§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public class ConcretePrototype implements IPrototype &#123; private int age; private String name; private List&lt;String&gt; hobbies; public List&lt;String&gt; getHobbies() &#123; return hobbies; &#125; public void setHobbies(List&lt;String&gt; hobbies) &#123; this.hobbies = hobbies; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; @Override public ConcretePrototype clone() &#123; ConcretePrototype concretePrototype = new ConcretePrototype(); concretePrototype.setAge(this.age); concretePrototype.setName(this.name); concretePrototype.setHobbies(this.hobbies); return concretePrototype; &#125; @Override public String toString() &#123; return &quot;ConcretePrototype&#123;&quot; + &quot;age=&quot; + age + &quot;, name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &quot;, hobbies=&quot; + hobbies + &#x27;&#125;&#x27;; &#125;&#125; SETTERæ–¹æ³•å®ç°æµ…å…‹éš† æµ…å…‹éš†ä¹Ÿå«æµ…æ‹·è´ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œä»æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ 123456789101112131415161718192021222324public static void main(String[] args) &#123; //åˆ›å»ºåŸå‹å¯¹è±¡ ConcretePrototype1 prototype = new ConcretePrototype1(); prototype.setAge(18); prototype.setName(&quot;Tom&quot;); ArrayList&lt;String&gt; strings = Lists.newArrayList(&quot;æ•°å­¦&quot;, &quot;è‹±è¯­&quot;); prototype.setHobbies(strings); System.out.println(prototype); //æ‹·è´åŸå‹å¯¹è±¡ ConcretePrototype1 cloneType = prototype.clone(); cloneType.getHobbies().add(&quot;è¯­æ–‡&quot;); System.out.println(cloneType); System.out.println(prototype); System.err.println(cloneType == prototype); System.err.println(cloneType.getHobbies() == prototype.getHobbies()); &#125;è¾“å‡ºç»“æœï¼šConcretePrototype1&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­]&#125;ConcretePrototype1&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­, è¯­æ–‡]&#125;ConcretePrototype1&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­, è¯­æ–‡]&#125;false// è¿™é‡Œä¸ºä»€ä¹ˆç»“æœæ˜¯trueçœ‹åˆ°ä¸Šé¢ç”»çš„å›¾åº”è¯¥å¯ä»¥çœ‹æ‡‚å§ï¼Œsetæ–¹æ³•å…¶å®æ˜¯å°†listçš„å¼•ç”¨è®¾ç½®è¿‡å»ï¼Œå¹¶ä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„listå†èµ‹å€¼ï¼true é€šè¿‡å†…å­˜å­—èŠ‚æµâ€å…‹éš†â€å¯¹è±¡ï¼Œå®ç°æ·±å…‹éš† æ·±å…‹éš†ä¹Ÿå«æ·±æ‹·è´ï¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå±æ€§ä¸­å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ä¹Ÿä¼šè¢«å…‹éš†ï¼Œä¸å†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public class ConcretePrototypeDeep implements Cloneable,Serializable &#123; private int age; private String name; private List&lt;String&gt; hobbies; public List&lt;String&gt; getHobbies() &#123; return hobbies; &#125; public void setHobbies(List&lt;String&gt; hobbies) &#123; this.hobbies = hobbies; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; // åŸºäºå†…å­˜å­—èŠ‚æµç”Ÿæˆå¯¹è±¡ public ConcretePrototypeDeep deepClone() &#123; try &#123; //å°†å½“å‰å¯¹è±¡ä¿¡æ¯å†™åˆ°å†…å­˜ ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(this); //ä»å†…å­˜ä¸­è¯»å–å¯¹è±¡ä¿¡æ¯ï¼Œå¼ºåˆ¶è½¬æ¢æˆå½“å‰ç±»å‹ ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return (ConcretePrototypeDeep) objectInputStream.readObject(); &#125; catch (IOException ioException) &#123; ioException.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; return null; &#125; @Override public String toString() &#123; return &quot;ConcretePrototype&#123;&quot; + &quot;age=&quot; + age + &quot;, name=&#x27;&quot; + name + &#x27;\\&#x27;&#x27; + &quot;, hobbies=&quot; + hobbies + &#x27;&#125;&#x27;; &#125;&#125; è¾“å‡ºç»“æœï¼š 12345ConcretePrototype&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­]&#125;ConcretePrototype&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­, è¯­æ–‡]&#125;ConcretePrototype&#123;age=18, name=&#x27;Tom&#x27;, hobbies=[æ•°å­¦, è‹±è¯­]&#125;falsefalse åœ¨Javaè¯­è¨€ä¸­ï¼Œå¦‚æœéœ€è¦å®ç°æ·±å…‹éš†ï¼Œå¯ä»¥é€šè¿‡è¦†ç›–Objectç±»çš„clone()æ–¹æ³•å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åºåˆ—åŒ–(Serialization)ç­‰æ–¹å¼æ¥å®ç°ã€‚ è¦å®ç°æ·±æ‹·è´ï¼Œå¿…é¡»å®ç°Cloneableæ¥å£ï¼Œå»é‡å†™cloneæ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºCloneNotSupportedExceptionå¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡ä¸­åŒ…å«å¾ˆå¤šå¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œè¿™æ ·å»è¦†ç›–cloneæ–¹æ³•å…¶å®æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œå¯ä»¥ä¼˜å…ˆä½¿ç”¨åºåˆ—åŒ–çš„æ–¹å¼å®ç°ï¼ å…‹éš†ç ´åå•ä¾‹æ¨¡å¼å¦‚æœæˆ‘ä»¬å…‹éš†çš„ç›®æ ‡çš„å¯¹è±¡æ˜¯å•ä¾‹å¯¹è±¡ï¼Œè¿™ä¾¿æ„å‘³ç€ï¼Œæ·±å…‹éš†ä¼šç ´åå•ä¾‹ã€‚è§£å†³ä»¥ä¸Šé—®é¢˜çš„æ€è·¯ï¼š ç¦æ­¢æ·±å…‹éš† åœ¨å•ä¾‹å¯¹è±¡çš„getInstanceæ–¹æ³•ï¼Œè¿”å›å½“å‰å¯¹è±¡ï¼Œè€Œä¸æ˜¯å»æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡æˆ–è€…é€šè¿‡å†…å­˜å­—èŠ‚æµç­‰æ–¹æ³•ç”Ÿæˆå¯¹è±¡ åŸå‹æ¨¡å¼åœ¨Javaä¸­çš„åº”ç”¨ArrayListåº•å±‚æ˜¯åŸºäºæ•°ç»„ç»“æœçš„ï¼Œå®ƒçš„åŠ¨æ€æ‰©å®¹è¿‡ç¨‹æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶æŠŠæ•°ç»„ä¸­çš„å…ƒç´ æ‹·è´è¿‡å»ï¼Œç”¨æ–°çš„æ•°ç»„æ¥ç»§ç»­å­˜æ”¾å…ƒç´ ï¼›åœ¨åˆ›å»ºæ–°æ•°ç»„çš„è¿‡ç¨‹ä¸­ä¾¿ä½¿ç”¨äº†åŸå‹æ¨¡å¼ã€‚ java.util.ArrayList.clone1234567891011public Object clone() &#123; try &#123; ArrayList&lt;?&gt; v = (ArrayList&lt;?&gt;) super.clone(); v.elementData = Arrays.copyOf(elementData, size); v.modCount = 0; return v; &#125; catch (CloneNotSupportedException e) &#123; // this shouldn&#x27;t happen, since we are Cloneable throw new InternalError(e); &#125;&#125; java.util.Arrays.copyOf(T[], int)123public static &lt;T&gt; T[] copyOf(T[] original, int newLength) &#123; return (T[]) copyOf(original, newLength, original.getClass()); &#125; java.util.Arrays.copyOf(U[], int, java.lang.Class&lt;? extends T[]&gt;)123456789public static &lt;T,U&gt; T[] copyOf(U[] original, int newLength, Class&lt;? extends T[]&gt; newType) &#123; @SuppressWarnings(&quot;unchecked&quot;) T[] copy = ((Object)newType == (Object)Object[].class) ? (T[]) new Object[newLength] : (T[]) Array.newInstance(newType.getComponentType(), newLength); System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); return copy; &#125; æœ€ç»ˆè¿˜æ˜¯System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength));è¿™ä¸ªæ–¹æ³•æ¥å®Œæˆæ•°ç»„çš„æ‹·è´ï¼åƒæˆ‘ä»¬ä½¿ç”¨çš„ com.alibaba.fastjson.JSON#parseObject org.springframework.beans.BeanUtils#copyProperties(java.lang.Object, java.lang.Object)` ç­‰éƒ½æ˜¯åŸå‹æ¨¡å¼ï¼› åŸå‹æ¨¡å¼é€‚ç”¨åœºæ™¯ ç±»åˆå§‹åŒ–æ¶ˆè€—èµ„æºè¿‡å¤š newä¸€ä¸ªå¯¹è±¡éœ€è¦å¾ˆå¤šç¹ççš„è¿‡ç¨‹ï¼ˆæ•°æ®å‡†å¤‡ï¼Œè®¿é—®æƒé™ç­‰ï¼‰ æ„é€ å‡½æ•°æ¯”è¾ƒå¤æ‚ å¾ªç¯ä½“å†…äº§ç”Ÿå¤§é‡å¯¹è±¡æ—¶ åŸå‹æ¨¡å¼çš„ä¼˜ç‚¹ Javaè‡ªå¸¦çš„åŸå‹æ¨¡å¼æ˜¯åŸºäºå†…å­˜äºŒè¿›åˆ¶æµçš„å¤åˆ¶ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯”ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ›´åŠ ä¼˜è‰¯ å¯ä»¥ä½¿ç”¨æ·±å…‹éš†çš„æ–¹å¼ä¿å­˜å¯¹è±¡çš„çŠ¶æ€ï¼Œä½¿ç”¨åŸå‹æ¨¡å¼å°†å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜èµ·æ¥ï¼Œç®€åŒ–äº†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Œä»¥ä¾¿åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ï¼Œå¯è¾…åŠ©å®ç°æ’¤é”€æ“ä½œã€‚ åŸå‹æ¨¡å¼çš„ç¼ºç‚¹ éœ€è¦ä¸ºæ¯ä¸€ä¸ªç±»éƒ½é…ç½®ä¸€ä¸ª clone æ–¹æ³• clone æ–¹æ³•ä½äºç±»çš„å†…éƒ¨ï¼Œå½“å¯¹å·²æœ‰ç±»è¿›è¡Œæ”¹é€ çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹ä»£ç ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ å½“å®ç°æ·±å…‹éš†æ—¶ï¼Œéœ€è¦ç¼–å†™è¾ƒä¸ºå¤æ‚çš„ä»£ç ï¼Œè€Œä¸”å½“å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤šé‡åµŒå¥—å¼•ç”¨æ—¶ï¼Œä¸ºäº†å®ç°æ·±å…‹éš†ï¼Œæ¯ä¸€å±‚å¯¹è±¡å¯¹åº”çš„ç±»éƒ½å¿…é¡»æ”¯æŒæ·±å…‹éš†ï¼Œå®ç°èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤ï¼Œæ·±å…‹éš†ã€æµ…å…‹éš†éœ€è¦è¿ç”¨å¾—å½“","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-å•ä¾‹æ¨¡å¼","date":"2021-08-07T11:22:11.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-å•ä¾‹æ¨¡å¼/","text":"å•ä¾‹æ¨¡å¼æ¦‚å¿µå•ä¾‹æ¨¡å¼ï¼šæŒ‡ä¸€ä¸ªç±»åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ç»å¯¹åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼ˆgetInstanceæ–¹æ³•ï¼‰ã€‚å¤§æ¦‚å®ç°å°±æ˜¯éšè—å…¶æ„é€ æ–¹æ³•ï¼Œå•ä¾‹æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ã€‚ä¸€äº›å®é™…çš„åº”ç”¨åœºæ™¯æ¯”å¦‚ï¼ŒDBpool, ServletContext,ServletConfigç­‰ å•ä¾‹æ¨¡å¼å†™æ³•é¥¿æ±‰å¼å•ä¾‹åœ¨å•ä¾‹ç±»é¦–æ¬¡åŠ è½½æ—¶åˆ›å»ºå®ä¾‹ï¼› 123456789public class HungrySingleton &#123; private static final HungrySingleton hungrySingleton = new HungrySingleton(); private HungrySingleton()&#123;&#125; public static HungrySingleton getInstance()&#123; return hungrySingleton; &#125;&#125; ä¼˜ç‚¹æ‰§è¡Œæ•ˆç‡é«˜ï¼Œæ²¡æœ‰åŠ ä»»ä½•é” ç¼ºç‚¹ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜æµªè´¹ï¼›å¦‚æœå‡ºç°ç±»çš„æ•°é‡å¾ˆå¤šçš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–å¾ˆå¤šç±»ï¼Œå ç”¨å¤§é‡å†…å­˜ï¼› å±€é™æ€§Springå°±ä¸èƒ½ä½¿ç”¨ï¼ŒSpringå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæœ‰å¤§é‡çš„ç±»åŠ è½½ã€‚ é¥¿æ±‰å¼çš„ç¬¬äºŒç§å†™æ³• 1234567891011121314public class HungryStaticSingleton &#123; private static final HungryStaticSingleton hungrySingleton ; static &#123; hungrySingleton = new HungryStaticSingleton(); &#125; private HungryStaticSingleton()&#123;&#125; public static HungryStaticSingleton getInstance()&#123; return hungrySingleton; &#125;&#125; åŒºåˆ«ä»…ä»…å®åœ¨ä¸ç±»åŠ è½½çš„é¡ºåºä¸åŒã€‚ğŸ‘‡ æ‡’æ±‰å¼å•ä¾‹è¢«å¤–éƒ¨ç±»è°ƒç”¨æ—¶æ‰åˆ›å»ºå®ä¾‹ï¼› 123456789101112131415public class LazySingleton &#123; private static LazySingleton instance = null; private LazySingleton() &#123; &#125; public static LazySingleton getInstance() &#123; if (instance == null) &#123; instance = new LazySingleton(); &#125; return instance; &#125;&#125; ä¼˜ç‚¹èŠ‚çœäº†å†…å­˜ ç¼ºç‚¹ä¸èƒ½ä¿è¯çœŸå®å•ä¾‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨ çº¿ç¨‹ä¸å®‰å…¨çš„åŸå›  åé¢çš„çº¿ç¨‹è¦†ç›–æ‰å‰é¢çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹ åŒæ—¶è¿›å…¥åˆ¤æ–­æ¡ä»¶ï¼ŒæŒ‰é¡ºåºè¿”å›ï¼Œæ²¡æœ‰è¦†ç›–çš„æ—¶å€™ï¼Œå°±è¿”å›å®ä¾‹ è§£å†³æ–¹æ³•ï¼š 123456public static synchorized LazySingleton getInstance() &#123; if (instance == null) &#123; instance = new LazySingleton(); &#125; return instance;&#125; ä½†æ˜¯getInstanceæ–¹æ³•æ·»åŠ ä¸Šé”ä¹‹åï¼Œæ€§èƒ½ä¸‹é™ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¯·æ±‚è®¿é—®ï¼Œé™¤äº†è·å¾—é”çš„çº¿ç¨‹ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹éƒ½è¦ç­‰å¾…ã€‚ å¦‚ä½•ä¼˜åŒ–ï¼Ÿ 12345678910111213141516public class LazyDclSingleton &#123; private static LazyDclSingleton instance = null; private LazyDclSingleton() &#123; &#125; // åé¢çš„çº¿ç¨‹è¦†ç›–æ‰å‰é¢çº¿ç¨‹åˆ›å»ºçš„å®ä¾‹ public static LazyDclSingleton getInstance() &#123; if (instance == null) &#123; synchronized (LazyDclSingleton.class) &#123; instance = new LazyDclSingleton(); &#125; &#125; return instance; &#125;&#125; åŒé‡æ£€æŸ¥é”1234567891011121314151617181920public class LazyDclSingleton &#123; private static volatile LazyDclSingleton instance = null; private LazyDclSingleton() &#123; &#125; public static LazyDclSingleton getInstance() &#123; // æ£€æŸ¥æ˜¯å¦è¦é˜»å¡ if (instance == null) &#123; synchronized (LazyDclSingleton.class) &#123; // æ£€æŸ¥æ˜¯å¦è¦åˆ›å»ºå®ä¾‹ if (instance == null) &#123; instance = new LazyDclSingleton(); &#125; &#125; &#125; return instance; &#125;&#125; å±€é™æ€§ä¼šå‡ºç°æŒ‡ä»¤é‡æ’åºçš„é—®é¢˜ï¼Œæœ‰å¯èƒ½è¿”å›ä¸€ä¸ªä¸å®Œæ•´çš„å®ä¾‹è§£å†³æ–¹æ¡ˆï¼šprivate static volatile LazyDclSingleton instance = null;ï¼ˆvolatileç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼‰ ä¼˜ç‚¹æ€§èƒ½é«˜ï¼Œèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ ç¼ºç‚¹ä»£ç å¯è¯»æ€§æŸ¥ï¼Œä¸å¤Ÿç¾è§‚ï¼Œä»£ç ä¸å¤Ÿä¼˜é›… é™æ€å†…éƒ¨ç±»å†™æ³•12345678910111213141516171819/** * é™æ€å†…éƒ¨ç±» * é™æ€å†…éƒ¨ç±»åœ¨ä½¿ç”¨æ—¶æ‰è¿›è¡Œæ„å»º * classPath: ../LazyInnerClassSingleton.class * ../LazyInnerClassSingleton$LazyHolder.class * * ä¼˜ç‚¹ï¼šå†™æ³•ä¼˜é›…ï¼Œåˆ©ç”¨äº†javaè¯­è¨€è¯­æ³•ï¼Œæ€§èƒ½ä¹Ÿé«˜ï¼Œé¿å…å†…å­˜çš„æµªè´¹ * ç¼ºç‚¹ï¼šèƒ½å¤Ÿè¢«åå°„ç ´å */public class LazyInnerClassSingleton &#123; private LazyInnerClassSingleton()&#123;&#125; public static LazyInnerClassSingleton getInstance()&#123; return LazyHolder.instance; &#125; private static class LazyHolder&#123; private static final LazyInnerClassSingleton instance = new LazyInnerClassSingleton(); &#125;&#125; ä¼˜ç‚¹1ã€å†™æ³•ä¼˜é›…ï¼Œåˆ©ç”¨äº†javaè¯­è¨€è¯­æ³•2ã€æ€§èƒ½ä¹Ÿé«˜3ã€é¿å…å†…å­˜çš„æµªè´¹ ç¼ºç‚¹1ã€èƒ½å¤Ÿè¢«åå°„ç ´åå•ä¾‹ 12345678910111213/** * åå°„ç ´åå•ä¾‹æ¨¡å¼ */public class ReflectTest &#123; public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123; Class&lt;?&gt; clazz = LazyInnerClassSingleton.class; Constructor&lt;?&gt; declaredConstructor = clazz.getDeclaredConstructor(null); declaredConstructor.setAccessible(true); Object instance = declaredConstructor.newInstance(); System.err.println(instance); &#125;&#125;// æ‰“å°ç»“æœ com.ibli.javaBase.pattern.singleton.LazyInnerClassSingleton@38af3868 è§£å†³åŠæ³•ï¼š åœ¨æ„é€ å™¨ä¸­æ·»åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœå®ä¾‹å·²ç»åˆ›å»ºï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ç»ˆæ­¢åˆ›å»ºï¼› 12345private LazyInnerClassSingleton()&#123; if (LazyHolder.instance != null)&#123; throw new IllegalArgumentException(); &#125; &#125; æ³¨å†Œå¼å•ä¾‹ å°†æ¯ä¸€ä¸ªå®ä¾‹éƒ½ç¼“å­˜åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œä½¿ç”¨å”¯ä¸€æ ‡å¿—è·å–å®ä¾‹ æšä¸¾å†™æ³•123456789101112131415161718public enum EnumSingleton &#123; INSTANCE; private Object object; public Object getObject() &#123; return object; &#125; public void setObject(Object object) &#123; this.object = object; &#125; public static EnumSingleton getInstance()&#123; return INSTANCE; &#125;&#125; ä½¿ç”¨ä¸æµ‹è¯• 123456789101112131415public class EnumSingletonTest &#123; public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123; EnumSingleton enumSingleton = EnumSingleton.getInstance(); enumSingleton.setObject(new Object()); // å°è¯•ä½¿ç”¨åå°„ç ´å Class&lt;?&gt; clazz = EnumSingleton.class; Constructor&lt;?&gt; declaredConstructor = clazz.getDeclaredConstructor(String.class,int.class); System.err.println(declaredConstructor); declaredConstructor.setAccessible(true); Object object = declaredConstructor.newInstance(); System.err.println(object); &#125;&#125; æµ‹è¯•ç»“æœï¼š 1234private com.ibli.javaBase.pattern.singleton.EnumSingleton(java.lang.String,int)Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Cannot reflectively create enum objects at java.lang.reflect.Constructor.newInstance(Constructor.java:417) at com.ibli.javaBase.pattern.singleton.EnumSingletonTest.main(EnumSingletonTest.java:17) åŸå› åœ¨JDKåº•å±‚æºç ä¸­å·²ç»åšäº†é™åˆ¶ 12345678910111213141516171819202122@CallerSensitive public T newInstance(Object ... initargs) throws InstantiationException, IllegalAccessException, IllegalArgumentException, InvocationTargetException &#123; if (!override) &#123; if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123; Class&lt;?&gt; caller = Reflection.getCallerClass(); checkAccess(caller, clazz, null, modifiers); &#125; &#125; // ä¸èƒ½åˆ›å»ºæšä¸¾ç±»å‹ if ((clazz.getModifiers() &amp; Modifier.ENUM) != 0) throw new IllegalArgumentException(&quot;Cannot reflectively create enum objects&quot;); ConstructorAccessor ca = constructorAccessor; // read volatile if (ca == null) &#123; ca = acquireConstructorAccessor(); &#125; @SuppressWarnings(&quot;unchecked&quot;) T inst = (T) ca.newInstance(initargs); return inst; &#125; ä¼˜ç‚¹å†™æ³•ä¼˜é›…ï¼Œä½¿ç”¨æ–¹ä¾¿ ç¼ºç‚¹å’Œé¥¿æ±‰å¼ä¸€æ ·ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€ æˆå¤§é‡å†…å­˜æµªè´¹ å®¹å™¨å¼å•ä¾‹å†™æ³•12345678910111213141516171819202122public class ContainerSingleton &#123; private ContainerSingleton() &#123; &#125; private static Map&lt;String, Object&gt; ioc = new ConcurrentHashMap&lt;&gt;(); public static Object getInstance(String className) &#123; Object instance = null; if (!ioc.containsKey(className)) &#123; try &#123; instance = Class.forName(className).newInstance(); ioc.put(className, instance); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return instance; &#125; else &#123; return ioc.get(className); &#125; &#125;&#125; æµ‹è¯•ç±»ï¼š 1234567public class ContainerSingletonTest &#123; public static void main(String[] args) &#123; Object o1 = ContainerSingleton.getInstance(&quot;com.ibli.javaBase.pattern.singleton.Pojo&quot;); Object o2 = ContainerSingleton.getInstance(&quot;com.ibli.javaBase.pattern.singleton.Pojo&quot;); System.err.println(o1 == o2); // true &#125;&#125; å®¹å™¨å¼å•ä¾‹å†™æ³•é€‚åˆåˆ›å»ºå¤§é‡å•ä¾‹å®ä¾‹çš„åœºæ™¯ï¼Œç±»ä¼¼ä¸Springçš„IOCå®¹å™¨ã€‚å½“ç„¶ä¸Šé¢çš„å†™æ³•ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ªçº¿ç¨‹å®‰å…¨é—®é¢˜ åºåˆ—åŒ–ç ´åå•ä¾‹æ¨¡å¼123456789101112131415/** * åºåˆ—åŒ–ï¼šæŠŠå†…å­˜ä¸­å¯¹è±¡çš„çŠ¶æ€è½¬æ¢ä¸ºå­—èŠ‚ç çš„å½¢å¼ï¼Œç„¶ååœ¨æŠŠå­—èŠ‚ç ä»¥IOè¾“å‡ºæµå†™åˆ°ç£ç›˜ä¸Š * ååºåˆ—åŒ–ï¼š å°†æŒä¹…åŒ–çš„å­—èŠ‚ç å†…å®¹ï¼Œé€šè¿‡IOæµçš„æ–¹å¼è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨è½¬æ¢æˆJavaå¯¹è±¡ */public class SerializableSingleton implements Serializable &#123; private static final SerializableSingleton serializableSingleton = new SerializableSingleton(); private SerializableSingleton() &#123; &#125; public static SerializableSingleton getInstance() &#123; return serializableSingleton; &#125;&#125; æµ‹è¯•ç±»ï¼š 123456789101112131415161718192021222324252627public class SerializableSingletonTest &#123; public static void main(String[] args) &#123; SerializableSingleton s1; SerializableSingleton s2 = SerializableSingleton.getInstance(); FileOutputStream fos; try &#123; fos = new FileOutputStream(&quot;SerializableSingleton.obj&quot;); ObjectOutputStream oos = new ObjectOutputStream(fos); oos.writeObject(s2); oos.flush(); oos.close(); FileInputStream fis = new FileInputStream(&quot;SerializableSingleton.obj&quot;); ObjectInputStream ois = new ObjectInputStream(fis); s1 = (SerializableSingleton) ois.readObject(); ois.close(); System.out.println(s1); System.out.println(s2); System.out.println(s1 == s2); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; ç»“æœï¼š 123com.ibli.javaBase.pattern.singleton.SerializableSingleton@20ad9418com.ibli.javaBase.pattern.singleton.SerializableSingleton@681a9515false è§£å†³æ–¹æ³•ï¼šåœ¨SerializableSingletonä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³• 1234// æ¡¥æ¥æ¨¡å¼private Object readResolve() &#123; return serializableSingleton;&#125; ç»“æœ: 123com.ibli.javaBase.pattern.singleton.SerializableSingleton@681a9515com.ibli.javaBase.pattern.singleton.SerializableSingleton@681a9515true åŸå› ï¼šois.readObject();æ–¹æ³•åº•å±‚æœ‰å¯¹readResolveæ–¹æ³•çš„åˆ¤æ–­ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼šåˆ©ç”¨åå°„ç”Ÿæˆä¸€ä¸ªæ–°çš„å®ä¾‹ï¼› ThreadLocalå•ä¾‹ä¸‹é¢ä»‹ç»ä¸€ç§æ¯”è¾ƒå°‘è§çš„ä¸€ç§å•ä¾‹æ¨¡å¼ 12345678910111213141516public class ThreadLocalSingleton &#123; private static final ThreadLocal&lt;ThreadLocalSingleton&gt; threadLocalSingleton = new ThreadLocal&lt;ThreadLocalSingleton&gt;() &#123; @Override protected ThreadLocalSingleton initialValue() &#123; return new ThreadLocalSingleton(); &#125; &#125;; private ThreadLocalSingleton()&#123;&#125; public static ThreadLocalSingleton getInstance()&#123; return threadLocalSingleton.get(); &#125;&#125; 123456public class ThreadLocalExector implements Runnable&#123; @Override public void run() &#123; System.err.println(ThreadLocalSingleton.getInstance()); &#125;&#125; æµ‹è¯•ï¼š 123456789101112public class ThreadLocalSingletonTest &#123; public static void main(String[] args) &#123; System.out.println(ThreadLocalSingleton.getInstance()); System.out.println(ThreadLocalSingleton.getInstance()); Thread thread1 = new Thread(new ThreadLocalExector()); Thread thread2 = new Thread(new ThreadLocalExector()); thread1.start(); thread2.start();; &#125;&#125; ç»“æœï¼š 12345com.ibli.javaBase.pattern.singleton.ThreadLocalSingleton@38af3868 1com.ibli.javaBase.pattern.singleton.ThreadLocalSingleton@38af3868 2com.ibli.javaBase.pattern.singleton.ThreadLocalSingleton@10c69a60 3com.ibli.javaBase.pattern.singleton.ThreadLocalSingleton@2f1eeb2f 4 ä»¥ä¸Š3å’Œ4çš„ç»“æœè™½ç„¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯å…¶å®ä¹Ÿæ˜¯å®ç°äº†ã€å•ä¾‹ã€‘çš„æ•ˆæœã€‚ å±±è„šå¤ªæ‹¥æŒ¤ æˆ‘ä»¬æ›´é«˜å¤„è§ã€‚","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹ç¾-äº«å…ƒæ¨¡å¼","date":"2021-08-07T11:16:35.000Z","path":"wiki/è®¾è®¡æ¨¡å¼ä¹‹ç¾-äº«å…ƒæ¨¡å¼/","text":"äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰å‰è¨€åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶ä¼šé¢ä¸´è¦åˆ›å»ºå¤§é‡ç›¸åŒæˆ–ç›¸ä¼¼å¯¹è±¡å®ä¾‹çš„é—®é¢˜ã€‚åˆ›å»ºé‚£ä¹ˆå¤šçš„å¯¹è±¡å°†ä¼šè€—è´¹å¾ˆå¤šçš„ç³»ç»Ÿèµ„æºï¼Œå®ƒæ˜¯ç³»ç»Ÿæ€§èƒ½æé«˜çš„ä¸€ä¸ªç“¶é¢ˆã€‚ å®šä¹‰äº«å…ƒæ¨¡å¼ï¼Œåˆç§°ä¸ºè½»é‡çº§æ¨¡å¼ï¼Œè¿ç”¨å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚å®ƒé€šè¿‡å…±äº«å·²ç»å­˜åœ¨çš„å¯¹è±¡æ¥å¤§å¹…åº¦å‡å°‘éœ€è¦åˆ›å»ºçš„å¯¹è±¡æ•°é‡ã€é¿å…å¤§é‡ç›¸ä¼¼ç±»çš„å¼€é”€ï¼Œä»è€Œæé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ã€‚å®ƒæ˜¯å¯¹è±¡æ± çš„ä¸€ç§å®ç°ï¼Œç±»ä¼¼äºçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± å¯ä»¥é¿å…ä¸åœçš„åˆ›å»ºä¸ªé”€æ¯å¤šä¸ªå¯¹è±¡ï¼Œæ¶ˆè€—æ€§èƒ½ï¼ˆç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼‰ï¼›ã€å®—æ—¨ã€‘ï¼šå…±äº«ç»†ç²’åº¦å¯¹è±¡ï¼Œå°†å¤šä¸ªå¯¹åŒä¸€å¯¹è±¡çš„è®¿é—®é›†ä¸­èµ·æ¥ï¼›å±äºç»“æ„æ€§æ¨¡å¼ï¼› å†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€åœ¨å…±äº«å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œåˆä¸¤ç§çŠ¶æ€ï¼šå†…éƒ¨çŠ¶æ€ï¼š å†…éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å…±äº«å‡ºæ¥çš„ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨äº«å…ƒä¿¡æ¯å†…éƒ¨ï¼Œå¹¶ä¸”ä¸å›éšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼› å°±æ˜¯å¯¹è±¡æ‰€å…±æœ‰çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç«è½¦ç¥¨ï¼Œå¤šæœ‰ä»åŒ—äº¬-ä¸Šæµ·çš„å¯¹è±¡å¯ä»¥å…±ç”¨ä¸€ä¸ªï¼Œè€Œä¸æ˜¯æœ‰1000å¼ ç¥¨ï¼Œåˆ›å»º1000ä¸ªå¯¹è±¡ï¼› å¤–éƒ¨çŠ¶æ€ï¼š å¤–éƒ¨çŠ¶æ€æŒ‡å¯¹è±¡å¾—ä»¥ä¾èµ–çš„ä¸€ä¸ªæ ‡è®°ï¼Œéšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ï¼Œä¸å¯å…±äº«ï¼› ä¹Ÿæ˜¯ä¸å«å¥½ç†è§£çš„ï¼Œå½“ç«è½¦ç¥¨è¢«ä½ è´­ä¹°ä¹‹åï¼Œå°±å’Œä½ çš„èº«ä»½è¯å·ï¼ˆå”¯ä¸€ï¼‰ç»‘å®šäº†ï¼Œè¿™å±äºå¤–éƒ¨çŠ¶æ€ï¼› ä½¿ç”¨åœºæ™¯1ã€å¸¸å¸¸åº”ç”¨äºç³»ç»Ÿåº•å±‚çš„å¼€å‘ï¼Œä»¥ä¾¿è§£å†³ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ï¼›2ã€ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œéœ€è¦ç¼“å†²æ± çš„åœ°æ–¹ï¼› ä¸¾ä¸ªä¾‹å­ğŸŒ°äº«å…ƒå®ä½“ç±»123456789101112131415161718192021222324252627282930313233public class Examination &#123; private String name; private String phone; private String subject; public Examination(String subject) &#123; super(); this.subject = subject; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPhone() &#123; return phone; &#125; public void setPhone(String phone) &#123; this.phone = phone; &#125; @Override public String toString() &#123; return &quot;Examination [name=&quot; + name + &quot;, phone=&quot; + phone + &quot;, subject=&quot; + subject + &quot;]&quot;; &#125;&#125; äº«å…ƒå·¥å‚1234567891011121314151617181920212223public class ExaminationFactory &#123; // å¯¹è±¡æ±  private static Map&lt;String, Examination&gt; pool = new HashMap&lt;&gt;(); public static Examination getexExamination(String name, String phone, String subject) &#123; // é€šè¿‡å­¦ç§‘åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå¯¹è±¡ if (pool.containsKey(subject)) &#123; Examination examination = pool.get(subject); examination.setName(name); examination.setPhone(phone); System.out.println(&quot;åœ¨ç¼“å­˜æ± å–ç”¨å¯¹è±¡:&quot; + examination.toString()); return examination; &#125; else &#123; Examination examination = new Examination(subject); pool.put(subject, examination); examination.setName(name); examination.setPhone(phone); System.out.println(&quot;æ–°å»ºå¯¹è±¡:&quot; + examination.toString()); return examination; &#125; &#125;&#125; æµ‹è¯•ç±»123456789101112public class Client &#123; public static void main(String[] args) &#123; Examination A = ExaminationFactory.getexExamination(&quot;A&quot;, &quot;13812345678&quot;, &quot;è½¯ä»¶å·¥ç¨‹&quot;); Examination B = ExaminationFactory.getexExamination(&quot;B&quot;, &quot;13812341234&quot;, &quot;è½¯ä»¶å·¥ç¨‹&quot;); Examination C = ExaminationFactory.getexExamination(&quot;C&quot;, &quot;13812341328&quot;, &quot;ç”µå­ä¿¡æ¯å·¥ç¨‹&quot;); Examination D = ExaminationFactory.getexExamination(&quot;D&quot;, &quot;13812345111&quot;, &quot;æ¡¥æ¢å·¥ç¨‹å·¥ç¨‹&quot;); Examination E = ExaminationFactory.getexExamination(&quot;E&quot;, &quot;13812345444&quot;, &quot;è½¯ä»¶å·¥ç¨‹&quot;); System.err.println(A.hashCode()); System.err.println(B.hashCode()); &#125;&#125; æµ‹è¯•ç»“æœ1234567æ–°å»ºå¯¹è±¡:Examination [name=A, phone=13812345678, subject=è½¯ä»¶å·¥ç¨‹]åœ¨ç¼“å­˜æ± å–ç”¨å¯¹è±¡:Examination [name=B, phone=13812341234, subject=è½¯ä»¶å·¥ç¨‹]æ–°å»ºå¯¹è±¡:Examination [name=C, phone=13812341328, subject=ç”µå­ä¿¡æ¯å·¥ç¨‹]æ–°å»ºå¯¹è±¡:Examination [name=D, phone=13812345111, subject=æ¡¥æ¢å·¥ç¨‹å·¥ç¨‹]åœ¨ç¼“å­˜æ± å–ç”¨å¯¹è±¡:Examination [name=E, phone=13812345444, subject=è½¯ä»¶å·¥ç¨‹]15289025771528902577 å®é™…åº”ç”¨1ã€JDK â€“ String 123456789101112131415161718192021222324252627282930313233public static void main(String[] args) &#123; // &quot;hello&quot;æ˜¯ç¼–è¯‘å™¨å¸¸é‡ï¼Œ String s1æ˜¯è¿è¡Œæ—¶ï¼ŒæŠŠå¸¸é‡åœ°å€èµ‹å€¼ç»™ä»–&lt;br&gt; String s1 = &quot;hello&quot;; String s2 = &quot;hello&quot;; // &quot;he&quot; + &quot;llo&quot; ä¸¤ä¸ªå¸¸é‡ç›¸åŠ ï¼Œä¼šåœ¨ç¼–è¯‘æœŸå¤„ç†&lt;br&gt; String s3 = &quot;he&quot; + &quot;llo&quot;; // &quot;hel&quot; &quot;lo&quot; new String å…±å»ºäº†3ä¸ªç©ºé—´ï¼Œç„¶åæ‹¼æ¥èµ·æ¥æ˜¯ä¸€ä¸ªæ–°çš„ç©ºé—´ï¼ˆwhy?ï¼‰ String s4 = &quot;hel&quot; + new String(&quot;lo&quot;); String s5 = new String(&quot;hello&quot;); // s5å­˜æ”¾çš„æ˜¯å †ä¸­ä¸­é—´ String s6 = s5.intern(); //æ‹¿åˆ°å¸¸é‡ä¸­çš„åœ°å€ï¼Œ String s7 = &quot;h&quot;; String s8 = &quot;ello&quot;; String s9 = s7 + s8; //ä¸ºä»€ä¹ˆè¿™ä¸ªä¸ä¸€æ ·ï¼Œå› ä¸ºæ˜¯å˜é‡ç›¸åŠ æ‰€ä»¥ç¼–è¯‘æœŸæ²¡æœ‰åšä¼˜åŒ– System.out.println(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;); System.out.println(&quot;s1 &quot; + System.identityHashCode(s1)); System.out.println(&quot;s2 &quot; + System.identityHashCode(s2)); System.out.println(&quot;s3 &quot; + System.identityHashCode(s3)); System.out.println(&quot;s4 &quot; + System.identityHashCode(s4)); System.out.println(&quot;s5 &quot; + System.identityHashCode(s5)); //s6ä¸ºs5.intern()æ‹¿åˆ°çš„æ˜¯å¸¸é‡æ± é‡Œçš„â€œhelloâ€ System.out.println(&quot;s6 &quot; + System.identityHashCode(s6)); System.out.println(&quot;s7 &quot; + System.identityHashCode(s7)); System.out.println(&quot;s8 &quot; + System.identityHashCode(s8)); System.out.println(&quot;s9 &quot; + System.identityHashCode(s9)); System.out.print(&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;); System.out.println(s1==s2);//true System.out.println(s1==s3);//true System.out.println(s1==s4);//false System.out.println(s1==s9);//false System.out.println(s4==s5);//false System.out.println(s1==s6);//true &#125; 2ã€JDK â€“ Integer 123456789101112131415161718192021222324252627282930313233private static class IntegerCache &#123; static final int low = -128; static final int high; static final Integer cache[]; static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty(&quot;java.lang.Integer.IntegerCache.high&quot;); if (integerCacheHighPropValue != null) &#123; try &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; catch( NumberFormatException nfe) &#123; // If the property cannot be parsed into an int, ignore it. &#125; &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); // range [-128, 127] must be interned (JLS7 5.1.7) assert IntegerCache.high &gt;= 127; &#125; private IntegerCache() &#123;&#125; &#125; 3ã€çº¿ç¨‹æ± 4ã€Tomcatè¿æ¥æ±  äº«å…ƒæ¨¡å¼çš„ä¼˜ç‚¹âœ…1ã€å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ï¼Œé™ä½ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨ï¼Œæå‡æ•ˆç‡ï¼›2ã€å‡å°‘å†…å­˜ä¹‹å¤–çš„å…¶ä»–èµ„æºå ç”¨ï¼ŒIO,å¸¦å®½ç­‰ï¼› äº«å…ƒæ¨¡å¼çš„ç¼ºç‚¹1ã€å…³æ³¨å†…éƒ¨ï¼Œå¤–éƒ¨çŠ¶æ€ï¼Œå…³æ³¨ç¨‹åºçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›2ã€ä½¿ç³»ç»Ÿã€ç¨‹åºçš„é€»è¾‘å˜å¾—å¤æ‚ï¼› å‚è€ƒèµ„æ–™1ã€[è®¾è®¡æ¨¡å¼] - äº«å…ƒæ¨¡å¼2ã€è®¾è®¡æ¨¡å¼-äº«å…ƒæ¨¡å¼3ã€è®¾è®¡æ¨¡å¼-äº«å…ƒè®¾è®¡æ¨¡å¼","tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹ConcurrentHashMapå®ç°åŸç†","date":"2021-08-05T07:35:46.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹ConcurrentHashMapå®ç°åŸç†/","text":"ConcurrentHashMapMapåº”è¯¥æ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­é™¤äº†Listä½¿ç”¨çš„ç¬¬äºŒé¢‘ç¹çš„æ•°æ®ç»“æ„äº†å§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“HashMapæ— æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿è¯å®‰å…¨ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»€ä¹ˆæ¥ä»£æ›¿HashMapå‘¢ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼ŒHashTableå’ŒConcurrentHashMap,ç”±äºHashTableçš„æ€§èƒ½ç›¸å¯¹æ¯”è¾ƒä½ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä½¿ç”¨ConcurrentHashMapæ¥ä»£æ›¿HashMapã€‚ å‰è¨€HashTable&amp;HashMapHashTableçš„put, get,removeç­‰æ–¹æ³•æ˜¯é€šè¿‡synchronizedæ¥ä¿®é¥°ä¿è¯å…¶çº¿ç¨‹å®‰å…¨æ€§çš„ã€‚ HashTableæ˜¯ ä¸å…è®¸keyè·Ÿvalueä¸ºnullçš„ã€‚ é—®é¢˜æ˜¯synchronizedæ˜¯ä¸ªå…³é”®å­—çº§åˆ«çš„==é‡é‡é”==ï¼Œåœ¨getæ•°æ®çš„æ—¶å€™ä»»ä½•å†™å…¥æ“ä½œéƒ½ä¸å…è®¸ã€‚ç›¸å¯¹æ¥è¯´æ€§èƒ½ä¸å¥½ã€‚ ConcurrentHashMapæ¦‚è¿°åœ¨ConcurrentHashMapä¸­é€šè¿‡ä¸€ä¸ªNode&lt;K,V&gt;[]æ•°ç»„æ¥ä¿å­˜æ·»åŠ åˆ°mapä¸­çš„é”®å€¼å¯¹ï¼Œè€Œåœ¨åŒä¸€ä¸ªæ•°ç»„ä½ç½®æ˜¯é€šè¿‡é“¾è¡¨å’Œçº¢é»‘æ ‘çš„å½¢å¼æ¥ä¿å­˜çš„ã€‚ä½†æ˜¯è¿™ä¸ªæ•°ç»„åªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ï¼Œå¦åˆ™åªæ˜¯åˆå§‹åŒ–ä¸€ä¸ªConcurrentHashMapå¯¹è±¡çš„è¯ï¼Œåªæ˜¯è®¾å®šäº†ä¸€ä¸ªsizeCtlå˜é‡ï¼Œè¿™ä¸ªå˜é‡ç”¨æ¥åˆ¤æ–­å¯¹è±¡çš„ä¸€äº›çŠ¶æ€å’Œæ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Šã€‚ ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé»˜è®¤åˆæœŸé•¿åº¦ä¸º16ï¼Œå½“å¾€mapä¸­ç»§ç»­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé€šè¿‡hashå€¼è·Ÿæ•°ç»„é•¿åº¦å–ä¸æ¥å†³å®šæ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®ï¼Œå¦‚æœå‡ºç°æ”¾åœ¨åŒä¸€ä¸ªä½ç½®çš„æ—¶å€™ï¼Œä¼˜å…ˆä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾ï¼Œåœ¨åŒä¸€ä¸ªä½ç½®çš„ä¸ªæ•°åˆè¾¾åˆ°äº†8ä¸ªä»¥ä¸Šï¼Œå¦‚æœæ•°ç»„çš„é•¿åº¦è¿˜å°äº64çš„æ—¶å€™ï¼Œåˆ™ä¼šæ‰©å®¹æ•°ç»„ã€‚å¦‚æœæ•°ç»„çš„é•¿åº¦å¤§äºç­‰äº64äº†çš„è¯ï¼Œåœ¨ä¼šå°†è¯¥èŠ‚ç‚¹çš„é“¾è¡¨è½¬æ¢æˆæ ‘ã€‚ é€šè¿‡æ‰©å®¹æ•°ç»„çš„æ–¹å¼æ¥æŠŠè¿™äº›èŠ‚ç‚¹ç»™åˆ†æ•£å¼€ã€‚ç„¶åå°†è¿™äº›å…ƒç´ å¤åˆ¶åˆ°æ‰©å®¹åçš„æ–°çš„æ•°ç»„ä¸­ï¼ŒåŒä¸€ä¸ªé“¾è¡¨ä¸­çš„å…ƒç´ é€šè¿‡hashå€¼çš„æ•°ç»„é•¿åº¦ä½æ¥åŒºåˆ†ï¼Œæ˜¯è¿˜æ˜¯æ”¾åœ¨åŸæ¥çš„ä½ç½®è¿˜æ˜¯æ”¾åˆ°æ‰©å®¹çš„é•¿åº¦çš„ç›¸åŒä½ç½®å» ã€‚åœ¨æ‰©å®¹å®Œæˆä¹‹åï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹çš„æ˜¯æ ‘ï¼ŒåŒæ—¶ç°åœ¨è¯¥èŠ‚ç‚¹çš„ä¸ªæ•°åˆå°äºç­‰äº6ä¸ªäº†ï¼Œåˆ™ä¼šå°†è¯¥æ ‘è½¬ä¸ºé“¾è¡¨ã€‚ å–å…ƒç´ çš„æ—¶å€™ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡è®¡ç®—hashæ¥ç¡®å®šè¯¥å…ƒç´ åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®ï¼Œç„¶ååœ¨é€šè¿‡éå†é“¾è¡¨æˆ–æ ‘æ¥åˆ¤æ–­keyå’Œkeyçš„hashï¼Œå–å‡ºvalueå€¼ã€‚ ConcurrentHashMap åŸç†è§£æConcurrentHashMapå±æ€§123456789101112131415161718private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;private static final int DEFAULT_CAPACITY = 16;static final int TREEIFY_THRESHOLD = 8;static final int UNTREEIFY_THRESHOLD = 6;static final int MIN_TREEIFY_CAPACITY = 64;static final int MOVED = -1; // è¡¨ç¤ºæ­£åœ¨è½¬ç§»static final int TREEBIN = -2; // è¡¨ç¤ºå·²ç»è½¬æ¢æˆæ ‘static final int RESERVED = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hashtransient volatile Node&lt;K,V&gt;[] table;//é»˜è®¤æ²¡åˆå§‹åŒ–çš„æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å…ƒç´ private transient volatile Node&lt;K,V&gt;[] nextTable;//è½¬ç§»çš„æ—¶å€™ç”¨çš„æ•°ç»„/** * ç”¨æ¥æ§åˆ¶è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹çš„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå½“åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šäº†å¤§å°ï¼Œè¿™ä¼šå°†è¿™ä¸ªå¤§å°ä¿å­˜åœ¨sizeCtlä¸­ï¼Œå¤§å°ä¸ºæ•°ç»„çš„0.75 * å½“ä¸ºè´Ÿçš„æ—¶å€™ï¼Œè¯´æ˜è¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å¼ ï¼Œ * -1è¡¨ç¤ºåˆå§‹åŒ– * -(1+n) n:è¡¨ç¤ºæ´»åŠ¨çš„æ‰©å¼ çº¿ç¨‹ */private transient volatile int sizeCtl; Node&lt;K,V&gt;,è¿™æ˜¯æ„æˆæ¯ä¸ªå…ƒç´ çš„åŸºæœ¬ç±»ã€‚12345678910111213141516static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; //keyçš„hashå€¼ final K key; //key volatile V val; //value volatile Node&lt;K,V&gt; next; //è¡¨ç¤ºé“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ Node(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.val = val; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return val; &#125; public final int hashCode() &#123; return key.hashCode() ^ val.hashCode(); &#125;&#125; TreeNodeï¼Œæ„é€ æ ‘çš„èŠ‚ç‚¹12345678910111213static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next, TreeNode&lt;K,V&gt; parent) &#123; super(hash, key, val, next); this.parent = parent; &#125;&#125; TreeBin ç”¨ä½œæ ‘çš„å¤´ç»“ç‚¹åªå­˜å‚¨rootå’ŒfirstèŠ‚ç‚¹ï¼Œä¸å­˜å‚¨èŠ‚ç‚¹çš„keyã€valueå€¼ã€‚ 12345678910static final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; root; volatile TreeNode&lt;K,V&gt; first; volatile Thread waiter; volatile int lockState; // values for lockState static final int WRITER = 1; // set while holding write lock static final int WAITER = 2; // set when waiting for write lock static final int READER = 4; // increment value for setting read lock&#125; ForwardingNodeåœ¨è½¬ç§»çš„æ—¶å€™æ”¾åœ¨å¤´éƒ¨çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ 1234567static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; final Node&lt;K,V&gt;[] nextTable; ForwardingNode(Node&lt;K,V&gt;[] tab) &#123; super(MOVED, null, null, null); this.nextTable = tab; &#125;&#125; ConcurrentHashMapå‡ ä¸ªé‡è¦æ–¹æ³•123456789101112131415161718192021/* * ç”¨æ¥è¿”å›èŠ‚ç‚¹æ•°ç»„çš„æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹çš„åŸå­æ“ä½œ */@SuppressWarnings(&quot;unchecked&quot;)static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) &#123; return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);&#125;/* * casåŸå­æ“ä½œï¼Œåœ¨æŒ‡å®šä½ç½®è®¾å®šå€¼ */static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) &#123; return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);&#125;/* * åŸå­æ“ä½œï¼Œåœ¨æŒ‡å®šä½ç½®è®¾å®šå€¼ */static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) &#123; U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);&#125; ConcurrentHashMapçš„åˆå§‹åŒ–å…ˆçœ‹ä¸€ä¸‹ConcurrentHashMapçš„æ„é€ å™¨ 1234567891011121314151617//ç©ºçš„æ„é€ public ConcurrentHashMap() &#123;&#125;//å¦‚æœåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æŒ‡å®šäº†å®¹é‡ï¼Œåˆ™åˆå§‹åŒ–sizeCtlpublic ConcurrentHashMap(int initialCapacity) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException(); int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); this.sizeCtl = cap;&#125;//å½“å‡ºå…¥ä¸€ä¸ªMapçš„æ—¶å€™ï¼Œå…ˆè®¾å®šsizeCtlä¸ºé»˜è®¤å®¹é‡ï¼Œåœ¨æ·»åŠ å…ƒç´ public ConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; this.sizeCtl = DEFAULT_CAPACITY; putAll(m);&#125; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ²¡æœ‰å¯¹å­˜å‚¨Mapå…ƒç´ Nodeçš„tableå˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚è€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡putæ“ä½œçš„æ—¶å€™åœ¨è¿›è¡Œåˆå§‹åŒ–ã€‚ ä¸‹é¢æ¥çœ‹çœ‹æ•°ç»„çš„åˆå§‹åŒ–æ–¹æ³•initTable 1234567891011121314151617181920212223242526272829/** * åˆå§‹åŒ–æ•°ç»„tableï¼Œ * å¦‚æœsizeCtlå°äº0ï¼Œè¯´æ˜åˆ«çš„æ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™è®©å‡ºæ‰§è¡Œæƒ * å¦‚æœsizeCtlå¤§äº0çš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtlçš„æ•°ç»„ * å¦åˆ™çš„è¯åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å¤§å°(16)çš„æ•°ç»„ * ç„¶åè®¾ç½®sizeCtlçš„å€¼ä¸ºæ•°ç»„é•¿åº¦çš„3/4 */private final Node&lt;K,V&gt;[] initTable() &#123; Node&lt;K,V&gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) &#123; //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™ï¼Œtableè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè¿›å…¥while if ((sc = sizeCtl) &lt; 0) //sizeCtlåˆå§‹å€¼ä¸º0ï¼Œå½“å°äº0çš„æ—¶å€™è¡¨ç¤ºåœ¨åˆ«çš„çº¿ç¨‹åœ¨åˆå§‹åŒ–è¡¨æˆ–æ‰©å±•è¡¨ Thread.yield(); // lost initialization race; just spin else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; //SIZECTLï¼šè¡¨ç¤ºå½“å‰å¯¹è±¡çš„å†…å­˜åç§»é‡ï¼Œscè¡¨ç¤ºæœŸæœ›å€¼ï¼Œ-1è¡¨ç¤ºè¦æ›¿æ¢çš„å€¼ï¼Œè®¾å®šä¸º-1è¡¨ç¤ºè¦åˆå§‹åŒ–è¡¨äº† try &#123; if ((tab = table) == null || tab.length == 0) &#123; int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; //æŒ‡å®šäº†å¤§å°çš„æ—¶å€™å°±åˆ›å»ºæŒ‡å®šå¤§å°çš„Nodeæ•°ç»„ï¼Œå¦åˆ™åˆ›å»ºæŒ‡å®šå¤§å°(16)çš„Nodeæ•°ç»„ @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; //åˆå§‹åŒ–åï¼ŒsizeCtlé•¿åº¦ä¸ºæ•°ç»„é•¿åº¦çš„3/4 &#125; break; &#125; &#125; return tab;&#125; ConcurrentHashMapçš„putæ“ä½œè¯¦è§£ğŸ‘‡ä¸‹é¢æ˜¯putæ–¹æ³•çš„æºç ï¼š 12345678/* * å•çº¯çš„é¢è°ƒç”¨putValæ–¹æ³•ï¼Œå¹¶ä¸”putValçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºfalse * å½“è®¾ç½®ä¸ºfalseçš„æ—¶å€™è¡¨ç¤ºè¿™ä¸ªvalueä¸€å®šä¼šè®¾ç½® * trueçš„æ—¶å€™ï¼Œåªæœ‰å½“è¿™ä¸ªkeyçš„valueä¸ºç©ºçš„æ—¶å€™æ‰ä¼šè®¾ç½® */ public V put(K key, V value) &#123; return putVal(key, value, false); &#125; ä¸‹é¢çœ‹ä¸€ä¸‹putValæ–¹æ³•å®ç°ï¼š å½“æ·»åŠ ä¸€å¯¹é”®å€¼å¯¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå»åˆ¤æ–­ä¿å­˜è¿™äº›é”®å€¼å¯¹çš„æ•°ç»„æ˜¯ä¸æ˜¯åˆå§‹åŒ–äº†ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±åˆå§‹åŒ–æ•°ç»„, ç„¶åé€šè¿‡è®¡ç®—hashå€¼æ¥ç¡®å®šæ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½®ã€‚ å¦‚æœè¿™ä¸ªä½ç½®ä¸ºç©ºåˆ™ç›´æ¥æ·»åŠ ï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™å–å‡ºè¿™ä¸ªèŠ‚ç‚¹æ¥ï¼Œå–å‡ºæ¥çš„èŠ‚ç‚¹çš„hashå€¼æ˜¯MOVED(-1)çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ­£åœ¨å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¤åˆ¶åˆ°æ–°çš„æ•°ç»„ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿå»å¸®åŠ©å¤åˆ¶ã€‚ å¦‚æœè¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸ä¸ºç©ºï¼Œä¹Ÿä¸åœ¨æ‰©å®¹ï¼Œåˆ™é€šè¿‡synchronizedæ¥åŠ é”ï¼Œè¿›è¡Œæ·»åŠ æ“ä½œã€‚ ç„¶ååˆ¤æ–­å½“å‰å–å‡ºçš„èŠ‚ç‚¹ä½ç½®å­˜æ”¾çš„æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘ï¼Œå¦‚æœæ˜¯é“¾è¡¨çš„è¯ï¼Œåˆ™éå†æ•´ä¸ªé“¾è¡¨ï¼Œç›´åˆ°å–å‡ºæ¥çš„èŠ‚ç‚¹çš„keyæ¥ä¸ªè¦æ”¾çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœkeyç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„hashå€¼ä¹Ÿç›¸ç­‰çš„è¯ï¼Œåˆ™è¯´æ˜æ˜¯åŒä¸€ä¸ªkeyï¼Œåˆ™è¦†ç›–æ‰valueï¼Œå¦åˆ™çš„è¯åˆ™æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ã€‚å¦‚æœæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æŠŠè¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å»ã€‚ æœ€ååœ¨æ·»åŠ å®Œæˆä¹‹åï¼Œä¼šåˆ¤æ–­åœ¨è¯¥èŠ‚ç‚¹å¤„å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ˆæ³¨æ„æ˜¯æ·»åŠ å‰çš„ä¸ªæ•°ï¼‰ï¼Œå¦‚æœè¾¾åˆ°8ä¸ªä»¥ä¸Šäº†çš„è¯ï¼Œåˆ™è°ƒç”¨treeifyBinæ–¹æ³•æ¥å°è¯•å°†å¤„çš„é“¾è¡¨è½¬ä¸ºæ ‘ï¼Œæˆ–è€…æ‰©å®¹æ•°ç»„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293final V putVal (K key, V value,boolean onlyIfAbsent)&#123; if (key == null || value == null) throw new NullPointerException(); //å–å¾—keyçš„hashå€¼ int hash = spread(key.hashCode()); //ç”¨æ¥è®¡ç®—åœ¨è¿™ä¸ªèŠ‚ç‚¹æ€»å…±æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œç”¨æ¥æ§åˆ¶æ‰©å®¹æˆ–è€…è½¬ç§»ä¸ºæ ‘ int binCount = 0; for (Node&lt;K, V&gt;[] tab = table; ; ) &#123; Node&lt;K, V&gt; f; int n, i, fh; if (tab == null || (n = tab.length) == 0) //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™tableæ²¡æœ‰åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–table tab = initTable(); //é€šè¿‡å“ˆå¸Œè®¡ç®—å‡ºä¸€ä¸ªè¡¨ä¸­çš„ä½ç½®å› ä¸ºnæ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œæ‰€ä»¥(n-1)&amp;hashè‚¯å®šä¸ä¼šå‡ºç°æ•°ç»„è¶Šç•Œ else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; //å¦‚æœè¿™ä¸ªä½ç½®æ²¡æœ‰å…ƒç´ çš„è¯ï¼Œåˆ™é€šè¿‡casçš„æ–¹å¼å°è¯•æ·»åŠ ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”çš„ if (casTabAt(tab, i, null, //åˆ›å»ºä¸€ä¸ªNodeæ·»åŠ åˆ°æ•°ç»„ä¸­åŒºï¼Œnullè¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º new Node&lt;K, V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin &#125; /* * å¦‚æœæ£€æµ‹åˆ°æŸä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯MOVEDï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ•°ç»„æ‰©å¼ çš„æ•°æ®å¤åˆ¶é˜¶æ®µï¼Œ * åˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šå‚ä¸å»å¤åˆ¶ï¼Œé€šè¿‡å…è®¸å¤šçº¿ç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œä¸€æ¬¡æ¥å‡å°‘æ•°ç»„çš„å¤åˆ¶æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤± */ else if ((fh = f.hash) == MOVED) tab = helpTransfer(tab, f); else &#123; /* * å¦‚æœåœ¨è¿™ä¸ªä½ç½®æœ‰å…ƒç´ çš„è¯ï¼Œå°±é‡‡ç”¨synchronizedçš„æ–¹å¼åŠ é”ï¼Œ * å¦‚æœæ˜¯é“¾è¡¨çš„è¯(hashå¤§äº0)ï¼Œå°±å¯¹è¿™ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œéå†ï¼Œ * å¦‚æœæ‰¾åˆ°äº†keyå’Œkeyçš„hashå€¼éƒ½ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™æŠŠå®ƒçš„å€¼æ›¿æ¢åˆ° * å¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œåˆ™æ·»åŠ åœ¨é“¾è¡¨çš„æœ€åé¢ * å¦åˆ™ï¼Œæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æ·»åŠ åˆ°æ ‘ä¸­å» * * åœ¨æ·»åŠ å®Œä¹‹åï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹ä¸Šå…³è”çš„çš„æ•°ç›®è¿›è¡Œåˆ¤æ–­ï¼Œ * å¦‚æœåœ¨8ä¸ªä»¥ä¸Šçš„è¯ï¼Œåˆ™ä¼šè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œæ¥å°è¯•è½¬åŒ–ä¸ºæ ‘ï¼Œæˆ–è€…æ˜¯æ‰©å®¹ */ V oldVal = null; synchronized (f) &#123; //å†æ¬¡å–å‡ºè¦å­˜å‚¨çš„ä½ç½®çš„å…ƒç´ ï¼Œè·Ÿå‰é¢å–å‡ºæ¥çš„æ¯”è¾ƒ if (tabAt(tab, i) == f) &#123; //å–å‡ºæ¥çš„å…ƒç´ çš„hashå€¼å¤§äº0ï¼Œå½“è½¬æ¢ä¸ºæ ‘ä¹‹åï¼Œhashå€¼ä¸º-2 if (fh &gt;= 0) &#123; binCount = 1; //éå†è¿™ä¸ªé“¾è¡¨ for (Node&lt;K, V&gt; e = f; ; ++binCount) &#123; K ek; //è¦å­˜çš„å…ƒç´ çš„hashï¼Œkeyè·Ÿè¦å­˜å‚¨çš„ä½ç½®çš„èŠ‚ç‚¹çš„ç›¸åŒçš„æ—¶å€™ï¼Œæ›¿æ¢æ‰è¯¥èŠ‚ç‚¹çš„valueå³å¯ if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; //å½“ä½¿ç”¨putIfAbsentçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è¿™ä¸ªkeyæ²¡æœ‰è®¾ç½®å€¼å¾—æ—¶å€™æ‰è®¾ç½® if (!onlyIfAbsent) e.val = value; break; &#125; Node&lt;K, V&gt; pred = e; //å¦‚æœä¸æ˜¯åŒæ ·çš„hashï¼ŒåŒæ ·çš„keyçš„æ—¶å€™ï¼Œåˆ™åˆ¤æ–­è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºï¼Œ if ((e = e.next) == null) &#123; //ä¸ºç©ºçš„è¯æŠŠè¿™ä¸ªè¦åŠ å…¥çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ pred.next = new Node&lt;K, V&gt;(hash, key, value, null); break; &#125; &#125; //è¡¨ç¤ºå·²ç»è½¬åŒ–æˆçº¢é»‘æ ‘ç±»å‹äº† &#125; else if (f instanceof TreeBin) &#123; Node&lt;K, V&gt; p; binCount = 2; //è°ƒç”¨putTreeValæ–¹æ³•ï¼Œå°†è¯¥å…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å» if ((p = ((TreeBin&lt;K, V&gt;) f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; if (binCount != 0) &#123; //å½“åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®è¾¾åˆ°8ä¸ªçš„æ—¶å€™ï¼Œåˆ™æ‰©å¼ æ•°ç»„æˆ–å°†ç»™èŠ‚ç‚¹çš„æ•°æ®è½¬ä¸ºtree if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; addCount(1L, binCount); //è®¡æ•° return null;&#125; ConcurrentHashMapçš„æ‰©å®¹è¯¦è§£åœ¨putæ–¹æ³•çš„è¯¦è§£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸ªæ•°è¶…è¿‡8ä¸ªçš„æ—¶å€™ï¼Œä¼šè°ƒç”¨treeifyBinæ–¹æ³•æ¥çœ‹çœ‹æ˜¯æ‰©å®¹è¿˜æ˜¯è½¬åŒ–ä¸ºä¸€æ£µæ ‘ï¼ŒåŒæ—¶åœ¨æ¯æ¬¡æ·»åŠ å®Œå…ƒç´ çš„addCountæ–¹æ³•ä¸­ï¼Œä¹Ÿä¼šåˆ¤æ–­å½“å‰æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦è¾¾åˆ°äº†sizeCtlçš„é‡ï¼Œå¦‚æœè¾¾åˆ°äº†çš„è¯ï¼Œåˆ™ä¼šè¿›å…¥transferæ–¹æ³•å»æ‰©å®¹ã€‚ 12345678910111213141516171819202122232425262728293031/** * Replaces all linked nodes in bin at given index unless table is * too small, in which case resizes instead. * å½“æ•°ç»„é•¿åº¦å°äº64çš„æ—¶å€™ï¼Œæ‰©å¼ æ•°ç»„é•¿åº¦ä¸€å€ï¼Œå¦åˆ™çš„è¯æŠŠé“¾è¡¨è½¬ä¸ºæ ‘ */private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) &#123; Node&lt;K,V&gt; b; int n, sc; if (tab != null) &#123; System.out.println(&quot;treeifyBinæ–¹\\t==&gt;æ•°ç»„é•¿ï¼š&quot;+tab.length); if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) //MIN_TREEIFY_CAPACITY 64 tryPresize(n &lt;&lt; 1); // æ•°ç»„æ‰©å®¹ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; synchronized (b) &#123; //ä½¿ç”¨synchronizedåŒæ­¥å™¨ï¼Œå°†è¯¥èŠ‚ç‚¹å‡ºçš„é“¾è¡¨è½¬ä¸ºæ ‘ if (tabAt(tab, index) == b) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null; //hdï¼šæ ‘çš„å¤´(head) for (Node&lt;K,V&gt; e = b; e != null; e = e.next) &#123; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val, null, null); if ((p.prev = tl) == null) //æŠŠNodeç»„æˆçš„é“¾è¡¨ï¼Œè½¬åŒ–ä¸ºTreeNodeçš„é“¾è¡¨ï¼Œå¤´ç»“ç‚¹ä»»ç„¶æ”¾åœ¨ç›¸åŒçš„ä½ç½® hd = p; //è®¾ç½®head else tl.next = p; tl = p; &#125; setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd));//æŠŠTreeNodeçš„é“¾è¡¨æ”¾å…¥å®¹å™¨TreeBinä¸­ &#125; &#125; &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°å½“éœ€è¦æ‰©å®¹çš„æ—¶å€™ï¼Œè°ƒç”¨çš„æ—¶å€™tryPresizeæ–¹æ³•ï¼Œçœ‹çœ‹trePresizeçš„æºç  trePresizeçš„æºç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182/** * æ‰©å®¹è¡¨ä¸ºæŒ‡å¯ä»¥å®¹çº³æŒ‡å®šä¸ªæ•°çš„å¤§å°ï¼ˆæ€»æ˜¯2çš„Næ¬¡æ–¹ï¼‰ * å‡è®¾åŸæ¥çš„æ•°ç»„é•¿åº¦ä¸º16ï¼Œåˆ™åœ¨è°ƒç”¨tryPresizeçš„æ—¶å€™ï¼Œsizeå‚æ•°çš„å€¼ä¸º16&lt;&lt;1(32)ï¼Œæ­¤æ—¶sizeCtlçš„å€¼ä¸º12 * è®¡ç®—å‡ºæ¥cçš„å€¼ä¸º64,åˆ™è¦æ‰©å®¹åˆ°sizeCtlâ‰¥ä¸ºæ­¢ * ç¬¬ä¸€æ¬¡æ‰©å®¹ä¹‹å æ•°ç»„é•¿ï¼š32 sizeCtlï¼š24 * ç¬¬äºŒæ¬¡æ‰©å®¹ä¹‹å æ•°ç»„é•¿ï¼š64 sizeCtlï¼š48 * ç¬¬äºŒæ¬¡æ‰©å®¹ä¹‹å æ•°ç»„é•¿ï¼š128 sizeCtlï¼š94 --&gt; è¿™ä¸ªæ—¶å€™æ‰ä¼šé€€å‡ºæ‰©å®¹ */private final void tryPresize(int size) &#123; /* * MAXIMUM_CAPACITY = 1 &lt;&lt; 30 * å¦‚æœç»™å®šçš„å¤§å°å¤§äºç­‰äºæ•°ç»„å®¹é‡çš„ä¸€åŠï¼Œåˆ™ç›´æ¥ä½¿ç”¨æœ€å¤§å®¹é‡ï¼Œ * å¦åˆ™ä½¿ç”¨tableSizeForç®—å‡ºæ¥ * åé¢tableä¸€ç›´è¦æ‰©å®¹åˆ°è¿™ä¸ªå€¼å°äºç­‰äºsizeCtrl(æ•°ç»„é•¿åº¦çš„3/4)æ‰é€€å‡ºæ‰©å®¹ */ int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) &#123; Node&lt;K,V&gt;[] tab = table; int n; // printTable(tab); è°ƒè¯•ç”¨çš„ /* * å¦‚æœæ•°ç»„tableè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtrlå’Œåˆšåˆšç®—å‡ºæ¥çš„cä¸­è¾ƒå¤§çš„ä¸€ä¸ªå¤§å°çš„æ•°ç»„ * åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®¾ç½®sizeCtrlä¸º-1ï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åæŠŠsizeCtrlè®¾ç½®ä¸ºæ•°ç»„é•¿åº¦çš„3/4 * ä¸ºä»€ä¹ˆè¦åœ¨æ‰©å¼ çš„åœ°æ–¹æ¥åˆå§‹åŒ–æ•°ç»„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æœç¬¬ä¸€æ¬¡putçš„æ—¶å€™ä¸æ˜¯putå•ä¸ªå…ƒç´ ï¼Œ * è€Œæ˜¯è°ƒç”¨putAllæ–¹æ³•ç›´æ¥putä¸€ä¸ªmapçš„è¯ï¼Œåœ¨putALlæ–¹æ³•ä¸­æ²¡æœ‰è°ƒç”¨initTableæ–¹æ³•å»åˆå§‹åŒ–tableï¼Œ * è€Œæ˜¯ç›´æ¥è°ƒç”¨äº†tryPresizeæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åšä¸€ä¸ªæ˜¯ä¸æ˜¯éœ€è¦åˆå§‹åŒ–tableçš„åˆ¤æ–­ */ if (tab == null || (n = tab.length) == 0) &#123; n = (sc &gt; c) ? sc : c; if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; //åˆå§‹åŒ–tabçš„æ—¶å€™ï¼ŒæŠŠsizeCtlè®¾ä¸º-1 try &#123; if (table == tab) &#123; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; &#125; &#125; /* * ä¸€ç›´æ‰©å®¹åˆ°çš„cå°äºç­‰äºsizeCtlæˆ–è€…æ•°ç»„é•¿åº¦å¤§äºæœ€å¤§é•¿åº¦çš„æ—¶å€™ï¼Œåˆ™é€€å‡º * æ‰€ä»¥åœ¨ä¸€æ¬¡æ‰©å®¹ä¹‹åï¼Œä¸æ˜¯åŸæ¥é•¿åº¦çš„ä¸¤å€ï¼Œè€Œæ˜¯2çš„næ¬¡æ–¹å€ */ else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) &#123; break; //é€€å‡ºæ‰©å¼  &#125; else if (tab == table) &#123; int rs = resizeStamp(n); /* * å¦‚æœæ­£åœ¨æ‰©å®¹Tableçš„è¯ï¼Œåˆ™å¸®åŠ©æ‰©å®¹ * å¦åˆ™çš„è¯ï¼Œå¼€å§‹æ–°çš„æ‰©å®¹ * åœ¨transferæ“ä½œï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°çš„tableä¸­çš„å…ƒç´ ï¼Œç§»åŠ¨åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„tableä¸­å»ï¼Œ * è™½ç„¶æ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®çš„æ˜¯nullï¼Œä½†æ˜¯ï¼Œåœ¨transferæ–¹æ³•ä¸­ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°ä¸ºnullçš„æ—¶å€™ï¼Œ * ä¼šåˆ›å»ºä¸€ä¸ªä¸¤å€å¤§å°çš„table */ if (sc &lt; 0) &#123; Node&lt;K,V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; /* * transferçš„çº¿ç¨‹æ•°åŠ ä¸€,è¯¥çº¿ç¨‹å°†è¿›è¡Œtransferçš„å¸®å¿™ * åœ¨transferçš„æ—¶å€™ï¼Œscè¡¨ç¤ºåœ¨transferå·¥ä½œçš„çº¿ç¨‹æ•° */ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); &#125; /* * æ²¡æœ‰åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œåˆ™å¼€å§‹æ‰©å®¹ */ else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) &#123; transfer(tab, null); &#125; &#125; &#125;&#125; åœ¨tryPresizeæ–¹æ³•ä¸­ï¼Œå¹¶æ²¡æœ‰åŠ é”ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹è¿›å…¥ï¼Œå¦‚æœæ•°ç»„æ­£åœ¨æ‰©å¼ ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿå»å¸®åŠ©æ‰©å®¹ã€‚ transferæ–¹æ³•æ•°ç»„æ‰©å®¹çš„ä¸»è¦æ–¹æ³•å°±æ˜¯transferæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187/** * Moves and/or copies the nodes in each bin to new table. See * above for explanation. * æŠŠæ•°ç»„ä¸­çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ–°çš„æ•°ç»„çš„ç›¸åŒä½ç½®ï¼Œæˆ–è€…ç§»åŠ¨åˆ°æ‰©å¼ éƒ¨åˆ†çš„ç›¸åŒä½ç½® * åœ¨è¿™é‡Œé¦–å…ˆä¼šè®¡ç®—ä¸€ä¸ªæ­¥é•¿ï¼Œè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°ç»„é•¿åº¦ï¼Œç”¨æ¥æ§åˆ¶å¯¹CPUçš„ä½¿ç”¨ï¼Œ * æ¯ä¸ªCPUæœ€å°‘å¤„ç†16ä¸ªé•¿åº¦çš„æ•°ç»„å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„çš„é•¿åº¦åªæœ‰16ï¼Œé‚£åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå¯¹å…¶è¿›è¡Œæ‰©å®¹çš„å¤åˆ¶ç§»åŠ¨æ“ä½œ * æ‰©å®¹çš„æ—¶å€™ä¼šä¸€ç›´éå†ï¼ŒçŸ¥é“å¤åˆ¶å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ²¡å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šåœ¨é“¾è¡¨çš„å¤´éƒ¨è®¾ç½®ä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±ä¼šè·³è¿‡ä»–ï¼Œ * å¤åˆ¶ååœ¨æ–°æ•°ç»„ä¸­çš„é“¾è¡¨ä¸æ˜¯ç»å¯¹çš„ååºçš„ */private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) &#123; int n = tab.length, stride; if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) //MIN_TRANSFER_STRIDE ç”¨æ¥æ§åˆ¶ä¸è¦å ç”¨å¤ªå¤šCPU stride = MIN_TRANSFER_STRIDE; // subdivide range //MIN_TRANSFER_STRIDE=16 /* * å¦‚æœå¤åˆ¶çš„ç›®æ ‡nextTabä¸ºnullçš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªtableä¸¤å€é•¿çš„nextTab * æ­¤æ—¶nextTableè¢«è®¾ç½®å€¼äº†(åœ¨åˆå§‹æƒ…å†µä¸‹æ˜¯ä¸ºnullçš„) * å› ä¸ºå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å§‹äº†è¡¨çš„æ‰©å¼ çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šè¿›æ¥å¸®å¿™æ‰©å¼ ï¼Œ * è€Œåªæ˜¯ç¬¬ä¸€ä¸ªå¼€å§‹æ‰©å¼ çš„çº¿ç¨‹éœ€è¦åˆå§‹åŒ–ä¸‹ç›®æ ‡æ•°ç»„ */ if (nextTab == null) &#123; // initiating try &#123; @SuppressWarnings(&quot;unchecked&quot;) Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; &#125; catch (Throwable ex) &#123; // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; &#125; nextTable = nextTab; transferIndex = n; &#125; int nextn = nextTab.length; /* * åˆ›å»ºä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥æ§åˆ¶å¹¶å‘çš„ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©ºæˆ–å·²ç»è¢«è½¬ç§»ä¹‹åï¼Œå°±è®¾ç½®ä¸ºfwdèŠ‚ç‚¹ * è¿™æ˜¯ä¸€ä¸ªç©ºçš„æ ‡å¿—èŠ‚ç‚¹ */ ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); boolean advance = true; //æ˜¯å¦ç»§ç»­å‘å‰æŸ¥æ‰¾çš„æ ‡å¿—ä½ boolean finishing = false; // to ensure sweep(æ¸…æ‰«) before committing nextTab,åœ¨å®Œæˆä¹‹å‰é‡æ–°åœ¨æ‰«æä¸€éæ•°ç»„ï¼Œçœ‹çœ‹æœ‰æ²¡å®Œæˆçš„æ²¡ for (int i = 0, bound = 0;;) &#123; Node&lt;K,V&gt; f; int fh; while (advance) &#123; int nextIndex, nextBound; if (--i &gt;= bound || finishing) &#123; advance = false; &#125; else if ((nextIndex = transferIndex) &lt;= 0) &#123; i = -1; advance = false; &#125; else if (U.compareAndSwapInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) &#123; bound = nextBound; i = nextIndex - 1; advance = false; &#125; &#125; if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) &#123; int sc; if (finishing) &#123; //å·²ç»å®Œæˆè½¬ç§» nextTable = null; table = nextTab; sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); //è®¾ç½®sizeCtlä¸ºæ‰©å®¹åçš„0.75 return; &#125; if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123; if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) &#123; return; &#125; finishing = advance = true; i = n; // recheck before commit &#125; &#125; else if ((f = tabAt(tab, i)) == null) //æ•°ç»„ä¸­æŠŠnullçš„å…ƒç´ è®¾ç½®ä¸ºForwardingNodeèŠ‚ç‚¹(hashå€¼ä¸ºMOVED[-1]) advance = casTabAt(tab, i, null, fwd); else if ((fh = f.hash) == MOVED) advance = true; // already processed else &#123; synchronized (f) &#123; //åŠ é”æ“ä½œ if (tabAt(tab, i) == f) &#123; Node&lt;K,V&gt; ln, hn; if (fh &gt;= 0) &#123; //è¯¥èŠ‚ç‚¹çš„hashå€¼å¤§äºç­‰äº0ï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªNodeèŠ‚ç‚¹ /* * å› ä¸ºnçš„å€¼ä¸ºæ•°ç»„çš„é•¿åº¦ï¼Œä¸”æ˜¯power(2,x)çš„ï¼Œæ‰€ä»¥ï¼Œåœ¨&amp;æ“ä½œçš„ç»“æœåªå¯èƒ½æ˜¯0æˆ–è€…n * æ ¹æ®è¿™ä¸ªè§„åˆ™ * 0--&gt; æ”¾åœ¨æ–°è¡¨çš„ç›¸åŒä½ç½® * n--&gt; æ”¾åœ¨æ–°è¡¨çš„ï¼ˆn+åŸæ¥ä½ç½®ï¼‰ */ int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; /* * lastRun è¡¨ç¤ºçš„æ˜¯éœ€è¦å¤åˆ¶çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ * æ¯å½“æ–°èŠ‚ç‚¹çš„hash&amp;n -&gt; b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±æŠŠrunBitè®¾ç½®ä¸ºè¿™ä¸ªç»“æœb * è¿™æ ·forå¾ªç¯ä¹‹åï¼ŒrunBitçš„å€¼å°±æ˜¯æœ€åä¸å˜çš„hash&amp;nçš„å€¼ * è€ŒlastRunçš„å€¼å°±æ˜¯æœ€åä¸€æ¬¡å¯¼è‡´hash&amp;n å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹(å‡è®¾ä¸ºpèŠ‚ç‚¹) * ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºpèŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹çš„hash&amp;n å€¼è·ŸpèŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œ * æ‰€ä»¥åœ¨å¤åˆ¶åˆ°æ–°çš„tableçš„æ—¶å€™ï¼Œå®ƒè‚¯å®šè¿˜æ˜¯è·ŸpèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªä½ç½® * åœ¨å¤åˆ¶å®ŒpèŠ‚ç‚¹ä¹‹åï¼ŒpèŠ‚ç‚¹çš„nextèŠ‚ç‚¹è¿˜æ˜¯æŒ‡å‘å®ƒåŸæ¥çš„èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦è¿›è¡Œå¤åˆ¶äº†ï¼Œè‡ªå·±å°±è¢«å¸¦è¿‡å»äº† * è¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤åˆ¶åçš„é“¾è¡¨çš„é¡ºåºå¹¶ä¸ä¸€å®šæ˜¯åŸæ¥çš„å€’åº */ for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) &#123; int b = p.hash &amp; n; //nçš„å€¼ä¸ºæ‰©å¼ å‰çš„æ•°ç»„çš„é•¿åº¦ if (b != runBit) &#123; runBit = b; lastRun = p; &#125; &#125; if (runBit == 0) &#123; ln = lastRun; hn = null; &#125; else &#123; hn = lastRun; ln = null; &#125; /* * æ„é€ ä¸¤ä¸ªé“¾è¡¨ï¼Œé¡ºåºå¤§éƒ¨åˆ†å’ŒåŸæ¥æ˜¯åçš„ * åˆ†åˆ«æ”¾åˆ°åŸæ¥çš„ä½ç½®å’Œæ–°å¢åŠ çš„é•¿åº¦çš„ç›¸åŒä½ç½®(i/n+i) */ for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123; int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) /* * å‡è®¾runBitçš„å€¼ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else /* * å‡è®¾runBitçš„å€¼ä¸ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸ä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸ä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); &#125; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; &#125; else if (f instanceof TreeBin) &#123; //å¦åˆ™çš„è¯æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹ TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) &#123; int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) &#123; if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; &#125; else &#123; if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; &#125; &#125; /* * åœ¨å¤åˆ¶å®Œæ ‘èŠ‚ç‚¹ä¹‹åï¼Œåˆ¤æ–­è¯¥èŠ‚ç‚¹å¤„æ„æˆçš„æ ‘è¿˜æœ‰å‡ ä¸ªèŠ‚ç‚¹ï¼Œ * å¦‚æœâ‰¤6ä¸ªçš„è¯ï¼Œå°±è½¬å›ä¸ºä¸€ä¸ªé“¾è¡¨ */ ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; &#125; &#125; &#125; &#125; &#125;&#125; åˆ°è¿™é‡Œï¼ŒConcurrentHashMapçš„putæ“ä½œå’Œæ‰©å®¹éƒ½ä»‹ç»çš„å·®ä¸å¤šäº†ï¼Œ ä¸‹é¢çš„ä¸¤ç‚¹ä¸€å®šè¦æ³¨æ„ï¼š 1ã€å¤åˆ¶ä¹‹åçš„æ–°é“¾è¡¨ä¸æ˜¯æ—§é“¾è¡¨çš„ç»å¯¹å€’åº 2ã€åœ¨æ‰©å®¹çš„æ—¶å€™æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å¤„ç†çš„æ­¥é•¿ï¼Œæœ€å°‘ä¸º16ï¼Œåœ¨è¿™ä¸ªæ­¥é•¿èŒƒå›´å†…çš„æ•°ç»„èŠ‚ç‚¹åªæœ‰è‡ªå·±ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç† ConcurrentHashMapçš„getæ“ä½œè¯¦è§£1234567891011121314151617181920212223242526/* * ç›¸æ¯”putæ–¹æ³•ï¼Œgetå°±å¾ˆå•çº¯äº†ï¼Œæ”¯æŒå¹¶å‘æ“ä½œï¼Œ * å½“keyä¸ºnullçš„æ—¶å€™å›æŠ›å‡ºNullPointerExceptionçš„å¼‚å¸¸ * getæ“ä½œé€šè¿‡é¦–å…ˆè®¡ç®—keyçš„hashå€¼æ¥ç¡®å®šè¯¥å…ƒç´ æ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½® * ç„¶åéå†è¯¥ä½ç½®çš„æ‰€æœ‰èŠ‚ç‚¹ * å¦‚æœä¸å­˜åœ¨çš„è¯è¿”å›null */public V get(Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123; if ((eh = e.hash) == h) &#123; if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; &#125; else if (eh &lt; 0) return (p = e.find(h, key)) != null ? p.val : null; while ((e = e.next) != null) &#123; if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; &#125; &#125; return null;&#125; é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘çš„è¿‡ç¨‹å‰é¢åœ¨è®²è§£tryifyBinçš„æºç çš„æ—¶å€™è®²åˆ°è¿‡ï¼Œå¦‚æœåœ¨å½“ä¸ªbinä¸Šçš„å…ƒç´ è¶…è¿‡äº†8ä¸ªçš„æ—¶å€™ï¼Œå°±ä¼šå°è¯•å»æ‰©å®¹æ•°ç»„æˆ–è€…æ˜¯å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ã€‚ æºç ï¼šğŸ‘‡ 12345678910111213141516171819202122232425262728private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) &#123; Node&lt;K,V&gt; b; int n, sc; if (tab != null) &#123; if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) //MIN_TREEIFY_CAPACITY 64 tryPresize(n &lt;&lt; 1); // æ•°ç»„æ‰©å®¹ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; //ä½¿ç”¨synchronizedåŒæ­¥å™¨ï¼Œå°†è¯¥èŠ‚ç‚¹å‡ºçš„é“¾è¡¨è½¬ä¸ºæ ‘ synchronized (b) &#123; if (tabAt(tab, index) == b) &#123; TreeNode&lt;K,V&gt; hd = null, tl = null; //hdï¼šæ ‘çš„å¤´(head) for (Node&lt;K,V&gt; e = b; e != null; e = e.next) &#123; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val, null, null); //æŠŠNodeç»„æˆçš„é“¾è¡¨ï¼Œè½¬åŒ–ä¸ºTreeNodeçš„é“¾è¡¨ï¼Œå¤´ç»“ç‚¹ä»»ç„¶æ”¾åœ¨ç›¸åŒçš„ä½ç½® if ((p.prev = tl) == null) hd = p; //è®¾ç½®head else tl.next = p; tl = p; &#125; //æŠŠTreeNodeçš„é“¾è¡¨æ”¾å…¥å®¹å™¨TreeBin setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd));ä¸­ &#125; &#125; &#125; &#125;&#125; é¦–å…ˆå°†Nodeçš„é“¾è¡¨è½¬åŒ–ä¸ºä¸€ä¸ªTreeNodeçš„é“¾è¡¨ï¼Œç„¶åå°†TreeNodeé“¾è¡¨çš„å¤´ç»“ç‚¹æ¥æ„é€ ä¸€ä¸ªTreeBinã€‚ä¸‹é¢æ˜¯TreeBinæ„é€ æ–¹æ³•çš„æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748TreeBin(TreeNode&lt;K,V&gt; b) &#123; //åˆ›å»ºçš„TreeBinæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œhashå€¼ä¸ºTREEBINï¼ˆ-2ï¼‰ super(TREEBIN, null, null, null); this.first = b; TreeNode&lt;K,V&gt; r = null; for (TreeNode&lt;K,V&gt; x = b, next; x != null; x = next) &#123; next = (TreeNode&lt;K,V&gt;)x.next; x.left = x.right = null; if (r == null) &#123; x.parent = null; x.red = false; r = x; &#125;// else &#123; K k = x.key; int h = x.hash; Class&lt;?&gt; kc = null; //xä»£è¡¨çš„æ˜¯è½¬æ¢ä¸ºæ ‘ä¹‹å‰çš„é¡ºåºéå†åˆ°é“¾è¡¨çš„ä½ç½®çš„èŠ‚ç‚¹ï¼Œrä»£è¡¨çš„æ˜¯æ ¹èŠ‚ç‚¹ for (TreeNode&lt;K,V&gt; p = r;;) &#123; int dir, ph; K pk = p.key; if ((ph = p.hash) &gt; h) // dir = -1; else if (ph &lt; h) dir = 1; else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) //å½“keyä¸å¯ä»¥æ¯”è¾ƒï¼Œæˆ–è€…ç›¸ç­‰çš„æ—¶å€™é‡‡å–çš„ä¸€ç§æ’åºæªæ–½ dir = tieBreakOrder(k, pk); TreeNode&lt;K,V&gt; xp = p; //åœ¨è¿™é‡Œåˆ¤æ–­è¦æ”¾çš„left/rightæ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºç»§ç»­ç”¨left/rightèŠ‚ç‚¹æ¥åˆ¤æ–­ if ((p = (dir &lt;= 0) ? p.left : p.right) == null) &#123; x.parent = xp; if (dir &lt;= 0) xp.left = x; else xp.right = x; //æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™éƒ½è°ƒç”¨balanceInsertionæ¥ä¿æŒçº¢é»‘æ ‘çš„å¹³è¡¡ r = balanceInsertion(r, x); break; &#125; &#125; &#125; &#125; this.root = r; assert checkInvariants(root);&#125; ConcurrentHashMapçš„åŒæ­¥æœºåˆ¶å‰é¢åˆ†æäº†ä¸‹ConcurrentHashMapçš„æºç ï¼Œé‚£ä¹ˆï¼Œå¯¹äºä¸€ä¸ªæ˜ å°„é›†åˆæ¥è¯´ï¼ŒConcurrentHashMapæ˜¯å¦‚æœæ¥åšåˆ°å¹¶å‘å®‰å…¨ï¼Œåˆæ˜¯å¦‚ä½•åšåˆ°é«˜æ•ˆçš„å¹¶å‘çš„å‘¢ï¼Ÿ é¦–å…ˆæ˜¯è¯»æ“ä½œï¼Œä»æºç ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨getæ“ä½œä¸­ï¼Œæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨unsafeæ–¹æ³•ï¼Œæ‰€ä»¥è¯»æ“ä½œæ˜¯æ”¯æŒå¹¶å‘æ“ä½œçš„ã€‚é‚£ä¹ˆå†™æ“ä½œå‘¢ï¼Ÿ åˆ†æè¿™ä¸ªä¹‹å‰ï¼Œå…ˆçœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¼•èµ·æ•°ç»„çš„æ‰©å®¹ï¼Œæ‰©å®¹æ˜¯é€šè¿‡transferæ–¹æ³•æ¥è¿›è¡Œçš„ã€‚è€Œè°ƒç”¨transferæ–¹æ³•çš„åªæœ‰trePresizeã€helpTransferå’ŒaddCountä¸‰ä¸ªæ–¹æ³•ã€‚ è¿™ä¸‰ä¸ªæ–¹æ³•åˆæ˜¯åˆ†åˆ«åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¿›è¡Œè°ƒç”¨çš„å‘¢ï¼Ÿ tryPresizeæ˜¯åœ¨treeIfybinå’ŒputAllæ–¹æ³•ä¸­è°ƒç”¨ï¼ŒtreeIfybinä¸»è¦æ˜¯åœ¨putæ·»åŠ å…ƒç´ å®Œä¹‹åï¼Œåˆ¤æ–­è¯¥æ•°ç»„èŠ‚ç‚¹ç›¸å…³å…ƒç´ æ˜¯ä¸æ˜¯å·²ç»è¶…è¿‡8ä¸ªçš„æ—¶å€™ï¼Œå¦‚æœè¶…è¿‡åˆ™ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥æ‰©å®¹æ•°ç»„æˆ–è€…æŠŠé“¾è¡¨è½¬ä¸ºæ ‘ã€‚ helpTransferæ˜¯åœ¨å½“ä¸€ä¸ªçº¿ç¨‹è¦å¯¹tableä¸­å…ƒç´ è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœæ£€æµ‹åˆ°èŠ‚ç‚¹çš„HASHå€¼ä¸ºMOVEDçš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨helpTransferæ–¹æ³•ï¼Œåœ¨helpTransferä¸­å†è°ƒç”¨transferæ–¹æ³•æ¥å¸®åŠ©å®Œæˆæ•°ç»„çš„æ‰©å®¹ addCountæ˜¯åœ¨å½“å¯¹æ•°ç»„è¿›è¡Œæ“ä½œï¼Œä½¿å¾—æ•°ç»„ä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°å‘ç”Ÿäº†å˜åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨çš„æ–¹æ³•ã€‚ æ‰€ä»¥å¼•èµ·æ•°ç»„æ‰©å®¹çš„æƒ…å†µå¦‚ä¸‹ï¼š 1ã€åªæœ‰åœ¨å¾€mapä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œåœ¨æŸä¸€ä¸ªèŠ‚ç‚¹çš„æ•°ç›®å·²ç»è¶…è¿‡äº†8ä¸ªï¼ŒåŒæ—¶æ•°ç»„çš„é•¿åº¦åˆå°äº64çš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘æ•°ç»„çš„æ‰©å®¹ã€‚ 2ã€å½“æ•°ç»„ä¸­å…ƒç´ è¾¾åˆ°äº†sizeCtlçš„æ•°é‡çš„æ—¶å€™ï¼Œåˆ™ä¼šè°ƒç”¨transferæ–¹æ³•æ¥è¿›è¡Œæ‰©å®¹ é‚£ä¹ˆåœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œå¯ä»¥ä¸å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œè¯»å†™æ“ä½œå‘¢ï¼Ÿ äº‹å®ä¸Šæ˜¯å¯ä»¥çš„ã€‚å½“åœ¨è¿›è¡Œæ•°ç»„æ‰©å®¹çš„æ—¶å€™ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹è¿˜æ²¡æœ‰è¢«å¤„ç†ï¼ˆä¹Ÿå°±æ˜¯è¯´è¿˜æ²¡æœ‰è®¾ç½®ä¸ºfwdèŠ‚ç‚¹ï¼‰ï¼Œé‚£å°±å¯ä»¥è¿›è¡Œè®¾ç½®æ“ä½œã€‚å¦‚æœè¯¥èŠ‚ç‚¹å·²ç»è¢«å¤„ç†äº†ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šåŠ å…¥åˆ°æ‰©å®¹çš„æ“ä½œä¸­å»ã€‚ é‚£ä¹ˆï¼Œå¤šä¸ªçº¿ç¨‹åˆæ˜¯å¦‚ä½•åŒæ­¥å¤„ç†çš„å‘¢ï¼Ÿ åœ¨ConcurrentHashMapä¸­ï¼ŒåŒæ­¥å¤„ç†ä¸»è¦æ˜¯é€šè¿‡Synchronizedå’Œunsafeä¸¤ç§æ–¹å¼æ¥å®Œæˆçš„ã€‚ 1ã€åœ¨å–å¾—sizeCtlã€æŸä¸ªä½ç½®çš„Nodeçš„æ—¶å€™ï¼Œä½¿ç”¨çš„éƒ½æ˜¯unsafeçš„æ–¹æ³•ï¼Œæ¥è¾¾åˆ°å¹¶å‘å®‰å…¨çš„ç›®çš„ 2ã€å½“éœ€è¦åœ¨æŸä¸ªä½ç½®è®¾ç½®èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåˆ™ä¼šé€šè¿‡Synchronizedçš„åŒæ­¥æœºåˆ¶æ¥é”å®šè¯¥ä½ç½®çš„èŠ‚ç‚¹ã€‚ 3ã€åœ¨æ•°ç»„æ‰©å®¹çš„æ—¶å€™ï¼Œåˆ™é€šè¿‡å¤„ç†çš„æ­¥é•¿å’ŒfwdèŠ‚ç‚¹æ¥è¾¾åˆ°å¹¶å‘å®‰å…¨çš„ç›®çš„ï¼Œé€šè¿‡è®¾ç½®hashå€¼ä¸ºMOVED 4ã€å½“æŠŠæŸä¸ªä½ç½®çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ‰©å¼ åçš„tableçš„æ—¶å€™ï¼Œä¹Ÿé€šè¿‡Synchronizedçš„åŒæ­¥æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ å‚è€ƒèµ„æ–™https://juejin.cn/search?query=concurrenthashmap&amp;utm_source=gold_browser_extension&amp;utm_medium=search https://juejin.cn/post/6844904136937308168 https://www.cnblogs.com/zerotomax/p/8687425.html#go0 https://juejin.cn/post/6844903520957644808 https://processon.com/view/6049998ae401fd39d6fffbaa?fromnew=1 https://juejin.cn/post/6871793103020556295 https://juejin.cn/post/6844903641866846222 https://juejin.cn/post/6844903602423595015 ConcurrentHashMapåŸºäºJDK1.8","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹CountDownLatchå·¥å…·","date":"2021-08-04T09:00:07.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹CountDownLatchå·¥å…·/","text":"CountDownLatchä½ è¦é—®ä»€ä¹ˆæ˜¯CountDownLatch? é‚£æˆ‘å¯æœ‰çš„è¯´äº†ã€‚ ä¹‹å‰å¹²æ´»çš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šå¤„ç†æ•°æ®çš„ä»»åŠ¡ï¼Œä½†æ˜¯å‘¢ï¼Œæ•°æ®é‡å¾ˆå¤§ï¼Œå†™çš„javaè„šæœ¬æ‰§è¡Œä¸‹æ¥è‚¯å®šä¼šæ¯”è¾ƒæ…¢ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Œæƒ³èµ·æ¥åˆšæ¯•ä¸šé‚£ä¼šï¼Œæœ‰ä¸ªåŒäº‹å†™äº†ä¸€ä¸ªå¹¶å‘è°ƒç”¨çš„å·¥å…·ï¼Œå½“æ—¶æ„Ÿè§‰ç¢‰å ¡äº†ã€‚ å½“æˆ‘æŸ¥çœ‹è¿™ä¸ªå·¥å…·çš„å…·ä½“å®ç°æ—¶ï¼Œå‘ç°å®ƒæ˜¯åŸºäºCountDownLatchæ¥å°è£…çš„ï¼Œå’±å½“æ—¶ä¹Ÿæ²¡ç”¨è¿‡CountDownLatchï¼Œæ„Ÿè§‰åº”è¯¥æŒºéš¾ï¼Œå°±ç›´æ¥ç”¨äº†é‚£ä¸ªå·¥å…·ã€‚ åæ¥å‘ç°é‚£ä¸ªå·¥å…·ä½¿ç”¨èµ·æ¥æœ‰äº›ç¹çï¼Œå°±æ¯”å¦‚æˆ‘åˆ·æ•°æ®è¿™ä¸ªäº‹ï¼ŒCountDownLatchç›´æ¥å¹²æ˜¯æœ€ç®€å•çš„ã€‚ CountDownLatchæ˜¯ä»€ä¹ˆA synchronization aid that allows one or more threads to wait until a set of operations being performed in other threads completes. æŒ‰ç…§å®˜æ–¹APIæ–‡æ¡£ä¸Šçš„ä»‹ç»å‘¢ï¼ŒCountDownLatchå°±æ˜¯ä¸€ä¸ªåŒæ­¥æœºåˆ¶ï¼Œç”¨æ¥å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸€ç›´waitçŸ¥é“å¦ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¸€ç³»åˆ—åŠ¨ä½œã€‚ CountDownLatchä½¿ç”¨1234567891011121314151617181920212223242526272829public class CountDownLatchDemo &#123; public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(2); new Thread(()-&gt;&#123; try &#123; Thread.sleep(1000); latch.countDown(); System.out.println(Thread.currentThread().getName() + &quot; execute 111&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); new Thread(()-&gt;&#123; try &#123; Thread.sleep(5000); System.out.println(Thread.currentThread().getName() + &quot; execute 222&quot;); latch.countDown(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); System.out.println(&quot;main thread invoke await&quot;); latch.await(); System.out.println(&quot;subThread execute end&quot;); &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 1234main thread invoke awaitThread-0 execute 111Thread-1 execute 222subThread execute end ä¸‹é¢æˆ‘ä»¬å°±ä»countDownå’Œawaitä¸¤ä¸ªæ–¹æ³•è§£æCountDownLatchçš„è¿è¡Œæœºåˆ¶å§ CountDownLatchå®ç°åŸç†å’ŒReentrantLockå®ç°ç‹¬å é”ä¸åŒçš„æ˜¯ï¼ŒCountDownLatchæ˜¯å…¸å‹çš„å…±äº«é”ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCountDownLatchçš„é™æ€å†…éƒ¨ç±»Syncç»§æ‰¿äº†AbstractQueuedSynchronizerå¹¶å®ç°äº†tryAcquireSharedæ–¹æ³•å’ŒtryReleaseSharedæ–¹æ³•ã€‚ ä¸‹é¢å…ˆä»æ„é€ æ–¹æ³•å…¥æ‰‹å¼€å§‹å­¦ä¹  ğŸ‘‡ 1234public CountDownLatch(int count) &#123; if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;); this.sync = new Sync(count);&#125; åˆå§‹åŒ–countå­—æ®µï¼Œå…¶å€¼æ˜¯è®¾ç½®åœ¨AQSçš„stateå­—æ®µä¸Šé¢çš„ï¼Œå½“æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œäº†countDown()ä¹‹åï¼Œstate = state - 1 å½“state = 0 æ—¶ï¼Œå”¤é†’ä¹‹å‰awaitçš„çº¿ç¨‹ã€‚ await()ä¸‹é¢æ˜¯awaitæ–¹æ³•ï¼š 123public void await() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125; AQS#acquireSharedInterruptibly(int arg) 12345678public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) // è·å–ä¸­æ–­æ ‡å¿—ï¼ŒæŠŠä¸­æ–­æ ‡å¿—å¤ä½ï¼Œç„¶åæŠŠä¸­æ–­å¼‚å¸¸å¾€ä¸Šå±‚æŠ› throw new InterruptedException(); if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg);&#125; tryAcquireShared(arg)è¿™ä¸ªæ–¹æ³•å’Œä¹‹å‰å­¦ä¹ ReentrantLockæ—¶æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯AQSæä¾›çš„æ¨¡ç‰ˆæ–¹æ³•ã€‚ AQSæä¾›æ¨¡ç‰ˆæ–¹æ³•ï¼Œæœ‰æ¯ä¸ªå­ç±»è‡ªå·±å»å®ç°é€»è¾‘ï¼Œç„¶åå†ç”±AQSæœ¬èº«è°ƒç”¨ã€‚ CountDownLatch#tryAcquireShared(int acquires) 123protected int tryAcquireShared(int acquires) &#123; return (getState() == 0) ? 1 : -1;&#125; getState()è¿”å›çš„æ˜¯AQSçš„stateå€¼ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è·å–æ˜¯è‚¯å®šä¸æ˜¯0 å¦‚æœgetState()æ–¹æ³•è¿”å›-1çš„è¯ï¼Œä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ï¼š AQS#doAcquireSharedInterruptibly 1234567891011121314151617181920212223242526272829private void doAcquireSharedInterruptibly(int arg) throws InterruptedException &#123; final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; // è¡¨ç¤ºaqs state = 0 // éœ€è¦æŠŠå½“å‰çº¿ç¨‹è®¾ç½®æˆå¤´èŠ‚ç‚¹ï¼Œå¹¶å‘ä¸‹ä¼ æ’­ setHeadAndPropagate(node, r); p.next = null; // help GC failed = false; return; &#125; &#125; // é¿å…ä¸€ç›´ç©ºè½¬ï¼Œå°†å‰ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€è®¾ç½®æˆSIGNAL,ç„¶åæŒ‚èµ·å½“å‰çº¿ç¨‹ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) // å¦‚æœçº¿ç¨‹ä¸­æ–­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ throw new InterruptedException(); &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; å½“countDownLatchçš„countå˜æˆ0çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹awaitå®Œæˆï¼Œç„¶åè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œã€‚ setHeadAndPropagate(Node node, int propagate) 123456789101112131415161718192021222324252627private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; // Record old head for check below setHead(node); /* * Try to signal next queued node if: * Propagation was indicated by caller, * or was recorded (as h.waitStatus either before * or after setHead) by a previous operation * (note: this uses sign-check of waitStatus because * PROPAGATE status may transition to SIGNAL.) * and * The next node is waiting in shared mode, * or we don&#x27;t know, because it appears null * * The conservatism in both of these checks may cause * unnecessary wake-ups, but only when there are multiple * racing acquires/releases, so most need signals now or soon * anyway. */ if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; if (s == null || s.isShared()) // å¦‚æœåç»­èŠ‚ç‚¹æ˜¯shardèŠ‚ç‚¹ï¼Œé‡Šæ”¾ doReleaseShared(); &#125;&#125; countDown()123public void countDown() &#123; sync.releaseShared(1);&#125; AQS#releaseShared(int arg) é‡Šæ”¾å…±äº«é” 12345678public final boolean releaseShared(int arg) &#123; // æœ‰å­ç±»å®ç° if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false;&#125; CountDownLatch#tryReleaseShared(int releases) è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡countDown(), state = state - 1 æœ€åè¿”å›stateæ˜¯å¦ç­‰äº0 å¦‚æœä¸ç­‰äº0 è¯´æ˜å…±äº«é”ä¸èƒ½é‡Šæ”¾ 1234567891011protected boolean tryReleaseShared(int releases) &#123; // Decrement count; signal when transition to zero for (;;) &#123; int c = getState(); if (c == 0) return false; int nextc = c-1; if (compareAndSetState(c, nextc)) return nextc == 0; &#125;&#125; doReleaseShared() é‡Šæ”¾å…±äº«é”æ–¹æ³• 12345678910111213141516171819202122232425262728293031private void doReleaseShared() &#123; /* * Ensure that a release propagates, even if there are other * in-progress acquires/releases. This proceeds in the usual * way of trying to unparkSuccessor of head if it needs * signal. But if it does not, status is set to PROPAGATE to * ensure that upon release, propagation continues. * Additionally, we must loop in case a new node is added * while we are doing this. Also, unlike other uses of * unparkSuccessor, we need to know if CAS to reset status * fails, if so rechecking. */ for (;;) &#123; Node h = head; if (h != null &amp;&amp; h != tail) &#123; // è·å–å¤´ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = h.waitStatus; if (ws == Node.SIGNAL) &#123; if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases // é‡Šæ”¾åç»§ç»“ç‚¹ unparkSuccessor(h); &#125; else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; if (h == head) // loop if head changed break; &#125;&#125; unparkSuccessor()æ‰§è¡Œçº¿ç¨‹å”¤é†’çš„æ–¹æ³• 1234567891011121314151617181920212223242526private void unparkSuccessor(Node node) &#123; /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; å‚è€ƒæ–‡ç« https://www.jianshu.com/p/128476015902 https://segmentfault.com/a/1190000015807573","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹ææ‡‚çº¿ç¨‹æ± ","date":"2021-08-04T08:43:19.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹ææ‡‚çº¿ç¨‹æ± -1/","text":"ThreadPool1. ä¸ºä»€ä¹ˆå­˜åœ¨çº¿ç¨‹æ± 1.1 é™ä½èµ„æºæ¶ˆè€—é€šè¿‡å¤ç”¨å·²å­˜åœ¨çš„çº¿ç¨‹å’Œé™ä½çº¿ç¨‹å…³é—­çš„æ¬¡æ•°æ¥å°½å¯èƒ½é™ä½ç³»ç»Ÿæ€§èƒ½æŸè€—ï¼›ï¼ˆäº«å…ƒæ¨¡å¼ï¼‰ 1.2 æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦é€šè¿‡å¤ç”¨çº¿ç¨‹ï¼Œçœå»åˆ›å»ºçº¿ç¨‹çš„è¿‡ç¨‹ï¼Œå› æ­¤æ•´ä½“ä¸Šæå‡äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼› 1.3 æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå› æ­¤ï¼Œéœ€è¦ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ã€‚ è‡³äºä¸ºä»€ä¹ˆä¸å…è®¸æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± ï¼Œè¯·å‚è§https://dayarch.top/p/why-we-need-to-use-threadpool.html 2. çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹çº¿ç¨‹æ± é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”±å¾ˆå¤šçº¿ç¨‹æ„æˆçš„æ± å­ï¼Œæ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå°±ä»æ± å­ä¸­å–ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç†è§£ï¼Œå®é™…ä¸Šçº¿ç¨‹æ± çš„å®ç°å’Œè¿è½¬æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹ã€‚ ä¾‹å¦‚çº¿ç¨‹æ± è‚¯å®šä¸ä¼šæ— é™æ‰©å¤§çš„ï¼Œå¦åˆ™èµ„æºä¼šè€—å°½ï¼›å½“çº¿ç¨‹æ•°åˆ°è¾¾ä¸€ä¸ªé˜¶æ®µï¼Œæäº¤çš„ä»»åŠ¡ä¼šè¢«æš‚æ—¶å­˜å‚¨åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜Ÿåˆ—å†…å®¹å¯ä»¥ä¸æ–­æ‰©å¤§ï¼Œæç«¯ä¸‹ä¹Ÿä¼šè€—å°½èµ„æºï¼Œé‚£é€‰æ‹©ä»€ä¹ˆç±»å‹çš„é˜Ÿåˆ—ï¼Œå½“é˜Ÿåˆ—æ»¡å¦‚ä½•å¤„ç†ä»»åŠ¡ï¼Œéƒ½æœ‰æ¶‰åŠå¾ˆå¤šå†…å®¹ã€‚çº¿ç¨‹æ± æ€»ä½“çš„å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š çº¿ç¨‹æ± å†…çš„çº¿ç¨‹æ•°çš„å¤§å°ç›¸å…³çš„æ¦‚å¿µæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ ¸å¿ƒæ± å¤§å°ï¼Œè¿˜æœ‰æœ€å¤§æ± å¤§å°ã€‚å¦‚æœå½“å‰çš„çº¿ç¨‹ä¸ªæ•°æ¯”æ ¸å¿ƒæ± ä¸ªæ•°å°ï¼Œå½“ä»»åŠ¡åˆ°æ¥ï¼Œä¼šä¼˜å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡ã€‚å½“å·²ç»åˆ°è¾¾æ ¸å¿ƒæ± å¤§å°ï¼Œåˆ™æŠŠä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œä¸ºäº†èµ„æºä¸è¢«è€—å°½ï¼Œé˜Ÿåˆ—çš„æœ€å¤§å®¹é‡å¯èƒ½ä¹Ÿæ˜¯æœ‰ä¸Šé™çš„ï¼Œå¦‚æœè¾¾åˆ°é˜Ÿåˆ—ä¸Šé™åˆ™è€ƒè™‘ç»§ç»­åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœæ­¤åˆ»çº¿ç¨‹çš„ä¸ªæ•°å·²ç»åˆ°è¾¾æœ€å¤§æ± ä¸Šé™ï¼Œåˆ™è€ƒè™‘æŠŠä»»åŠ¡ä¸¢å¼ƒã€‚ åœ¨ java.util.concurrent åŒ…ä¸­ï¼Œæä¾›äº† ThreadPoolExecutor çš„å®ç°ã€‚ 12345678public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123;&#125; 3. çº¿ç¨‹æ± å‚æ•°æ—¢ç„¶æœ‰äº†åˆšåˆšå¯¹çº¿ç¨‹æ± å·¥ä½œåŸç†å¯¹æ¦‚è¿°ï¼Œè¿™äº›å‚æ•°å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼š 3.1 corePoolSize æ ¸å¿ƒæ± å¤§å°ï¼Œæ—¢ç„¶å¦‚å‰åŸç†éƒ¨åˆ†æ‰€è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨åˆåˆ›å»ºçº¿ç¨‹æ± æ—¶çº¿ç¨‹ä¸ä¼šç«‹å³å¯åŠ¨ï¼Œç›´åˆ°æœ‰ä»»åŠ¡æäº¤æ‰å¼€å§‹å¯åŠ¨çº¿ç¨‹å¹¶é€æ¸æ—¶çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeã€‚è‹¥æƒ³ä¸€å¼€å§‹å°±åˆ›å»ºæ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹éœ€è°ƒç”¨prestartAllCoreThreadsæ–¹æ³•ã€‚ 3.2 maximumPoolSizeæ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å½“æ ¸å¿ƒçº¿ç¨‹æ»¡ä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿæ»¡æ—¶æ‰ä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶å†³å®šæ˜¯å¦åˆ›å»ºæ–°çº¿ç¨‹ã€‚ 3.3 keepAliveTimeå½“çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒæ—¶ï¼Œå¤šäºçš„ç©ºé—²çº¿ç¨‹æœ€å¤šå­˜æ´»æ—¶é—´ 3.4 unitkeepAliveTime å‚æ•°çš„æ—¶é—´å•ä½ã€‚ 3.5 workQueueå½“çº¿ç¨‹æ•°ç›®è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ç”¨äºä¿å­˜ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚ä¸»è¦æœ‰3ç§ç±»å‹çš„BlockingQueueå¯ä¾›é€‰æ‹©ï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œæœ‰ç•Œé˜Ÿåˆ—å’ŒåŒæ­¥ç§»äº¤ã€‚å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†é˜è¿°ã€‚ä»å‚æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ­¤é˜Ÿåˆ—ä»…ä¿å­˜å®ç°Runnableæ¥å£çš„ä»»åŠ¡ã€‚ åˆ«çœ‹è¿™ä¸ªå‚æ•°ä½ç½®å¾ˆé åï¼Œä½†æ˜¯çœŸçš„å¾ˆé‡è¦ï¼Œå› ä¸ºæ¥¼ä¸»çš„å‘å°±å› è¿™ä¸ªå‚æ•°è€Œèµ·ï¼Œè¿™äº›ç»†èŠ‚æœ‰å¿…è¦ä»”ç»†äº†è§£æ¸…æ¥šã€‚ 3.6 threadFactoryæ‰§è¡Œç¨‹åºåˆ›å»ºæ–°çº¿ç¨‹æ—¶ä½¿ç”¨çš„å·¥å‚ã€‚ 3.7 handleré˜»å¡é˜Ÿåˆ—å·²æ»¡ä¸”çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æ—¶æ‰€é‡‡å–çš„é¥±å’Œç­–ç•¥ã€‚javaé»˜è®¤æä¾›äº†4ç§é¥±å’Œç­–ç•¥çš„å®ç°æ–¹å¼ï¼šä¸­æ­¢ã€æŠ›å¼ƒã€æŠ›å¼ƒæœ€æ—§çš„ã€è°ƒç”¨è€…è¿è¡Œã€‚å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†é˜è¿°ã€‚ 4. å¯é€‰æ‹©çš„é˜»å¡é˜Ÿåˆ—BlockingQueueè¯¦è§£å†é‡å¤ä¸€ä¸‹æ–°ä»»åŠ¡è¿›å…¥æ—¶çº¿ç¨‹æ± çš„æ‰§è¡Œç­–ç•¥ï¼š1ã€å¦‚æœè¿è¡Œçš„çº¿ç¨‹å°‘äºcorePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰æ·»åŠ æ–°çš„çº¿ç¨‹ï¼Œè€Œä¸è¿›è¡Œæ’é˜Ÿã€‚ï¼ˆå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹å°äºcorePoolSizeï¼Œåˆ™ä»»åŠ¡æ ¹æœ¬ä¸ä¼šå­˜å…¥queueä¸­ï¼Œè€Œæ˜¯ç›´æ¥è¿è¡Œï¼‰ 2ã€å¦‚æœè¿è¡Œçš„çº¿ç¨‹å¤§äºç­‰äº corePoolSizeï¼Œåˆ™ Executorå§‹ç»ˆé¦–é€‰å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œè€Œä¸æ·»åŠ æ–°çš„çº¿ç¨‹ã€‚å¦‚æœæ— æ³•å°†è¯·æ±‚åŠ å…¥é˜Ÿåˆ—ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œé™¤éåˆ›å»ºæ­¤çº¿ç¨‹è¶…å‡º maximumPoolSizeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»åŠ¡å°†è¢«æ‹’ç»ã€‚ä¸»è¦æœ‰3ç§ç±»å‹çš„BlockingQueueï¼š 4.1 æ— ç•Œé˜Ÿåˆ—é˜Ÿåˆ—å¤§å°æ— é™åˆ¶ï¼Œå¸¸ç”¨çš„ä¸ºæ— ç•Œçš„LinkedBlockingQueueï¼Œä½¿ç”¨è¯¥é˜Ÿåˆ—åšä¸ºé˜»å¡é˜Ÿåˆ—æ—¶è¦å°¤å…¶å½“å¿ƒï¼Œå½“ä»»åŠ¡è€—æ—¶è¾ƒé•¿æ—¶å¯èƒ½ä¼šå¯¼è‡´å¤§é‡æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯æœ€ç»ˆå¯¼è‡´OOMã€‚é˜…è¯»ä»£ç å‘ç°ï¼ŒExecutors.newFixedThreadPool é‡‡ç”¨å°±æ˜¯ LinkedBlockingQueueï¼Œè€Œæ¥¼ä¸»è¸©åˆ°çš„å°±æ˜¯è¿™ä¸ªå‘ï¼Œå½“QPSå¾ˆé«˜ï¼Œå‘é€æ•°æ®å¾ˆå¤§ï¼Œå¤§é‡çš„ä»»åŠ¡è¢«æ·»åŠ åˆ°è¿™ä¸ªæ— ç•ŒLinkedBlockingQueue ä¸­ï¼Œå¯¼è‡´cpuå’Œå†…å­˜é£™å‡æœåŠ¡å™¨æŒ‚æ‰ã€‚ 4.2 æœ‰ç•Œé˜Ÿåˆ—å¸¸ç”¨çš„æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯éµå¾ªFIFOåŸåˆ™çš„é˜Ÿåˆ—å¦‚ArrayBlockingQueueä¸æœ‰ç•Œçš„LinkedBlockingQueueï¼Œå¦ä¸€ç±»æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—å¦‚PriorityBlockingQueueã€‚PriorityBlockingQueueä¸­çš„ä¼˜å…ˆçº§ç”±ä»»åŠ¡çš„Comparatorå†³å®šã€‚ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—æ—¶é˜Ÿåˆ—å¤§å°éœ€å’Œçº¿ç¨‹æ± å¤§å°äº’ç›¸é…åˆï¼Œçº¿ç¨‹æ± è¾ƒå°æœ‰ç•Œé˜Ÿåˆ—è¾ƒå¤§æ—¶å¯å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œé™ä½cpuä½¿ç”¨ç‡å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ˜¯å¯èƒ½ä¼šé™åˆ¶ç³»ç»Ÿååé‡ã€‚ åœ¨æˆ‘ä»¬çš„ä¿®å¤æ–¹æ¡ˆä¸­ï¼Œé€‰æ‹©çš„å°±æ˜¯è¿™ä¸ªç±»å‹çš„é˜Ÿåˆ—ï¼Œè™½ç„¶ä¼šæœ‰éƒ¨åˆ†ä»»åŠ¡è¢«ä¸¢å¤±ï¼Œä½†æ˜¯æˆ‘ä»¬çº¿ä¸Šæ˜¯æ’åºæ—¥å¿—æœé›†ä»»åŠ¡ï¼Œæ‰€ä»¥å¯¹éƒ¨åˆ†å¯¹ä¸¢å¤±æ˜¯å¯ä»¥å®¹å¿çš„ã€‚ 4.3 åŒæ­¥ç§»äº¤é˜Ÿåˆ—å¦‚æœä¸å¸Œæœ›ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…è€Œæ˜¯å¸Œæœ›å°†ä»»åŠ¡ç›´æ¥ç§»äº¤ç»™å·¥ä½œçº¿ç¨‹ï¼Œå¯ä½¿ç”¨SynchronousQueueä½œä¸ºç­‰å¾…é˜Ÿåˆ—ã€‚SynchronousQueueä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œè€Œæ˜¯ä¸€ç§çº¿ç¨‹ä¹‹é—´ç§»äº¤çš„æœºåˆ¶ã€‚è¦å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥SynchronousQueueä¸­ï¼Œå¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥æ”¶è¿™ä¸ªå…ƒç´ ã€‚åªæœ‰åœ¨ä½¿ç”¨æ— ç•Œçº¿ç¨‹æ± æˆ–è€…æœ‰é¥±å’Œç­–ç•¥æ—¶æ‰å»ºè®®ä½¿ç”¨è¯¥é˜Ÿåˆ—ã€‚ 5. å¯é€‰æ‹©çš„é¥±å’Œç­–ç•¥RejectedExecutionHandlerè¯¦è§£JDKä¸»è¦æä¾›äº†4ç§é¥±å’Œç­–ç•¥ä¾›é€‰æ‹©ã€‚4ç§ç­–ç•¥éƒ½åšä¸ºé™æ€å†…éƒ¨ç±»åœ¨ThreadPoolExcutorä¸­è¿›è¡Œå®ç°ã€‚ 5.1 AbortPolicyä¸­æ­¢ç­–ç•¥è¯¥ç­–ç•¥æ˜¯é»˜è®¤é¥±å’Œç­–ç•¥ã€‚ 12345public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123; throw new RejectedExecutionException(&quot;Task &quot; + r.toString() + &quot; rejected from &quot; + e.toString()); &#125; ä½¿ç”¨è¯¥ç­–ç•¥æ—¶åœ¨é¥±å’Œæ—¶ä¼šæŠ›å‡ºRejectedExecutionExceptionï¼ˆç»§æ‰¿è‡ªRuntimeExceptionï¼‰ï¼Œè°ƒç”¨è€…å¯æ•è·è¯¥å¼‚å¸¸è‡ªè¡Œå¤„ç†ã€‚ 5.2 DiscardPolicyæŠ›å¼ƒç­–ç•¥12public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123;&#125; å¦‚ä¸Šæ‰€ç¤ºï¼Œä»€ä¹ˆéƒ½ä¸åšã€‚ 5.3 DiscardOldestPolicyæŠ›å¼ƒæ—§ä»»åŠ¡ç­–ç•¥123456public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123; if (!e.isShutdown()) &#123; e.getQueue().poll(); e.execute(r); &#125;&#125; å¦‚ä»£ç ï¼Œå…ˆå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„å¤´å…ƒç´ å‡ºé˜ŸæŠ›å¼ƒï¼Œå†å°è¯•æäº¤ä»»åŠ¡ã€‚å¦‚æœæ­¤æ—¶é˜»å¡é˜Ÿåˆ—ä½¿ç”¨PriorityBlockingQueueä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œå°†ä¼šå¯¼è‡´ä¼˜å…ˆçº§æœ€é«˜çš„ä»»åŠ¡è¢«æŠ›å¼ƒï¼Œå› æ­¤ä¸å»ºè®®å°†è¯¥ç§ç­–ç•¥é…åˆä¼˜å…ˆçº§é˜Ÿåˆ—ä½¿ç”¨ã€‚ 5.4 CallerRunsPolicyè°ƒç”¨è€…è¿è¡Œ12345public void rejectedExecution(Runnable r, ThreadPoolExecutor e) &#123; if (!e.isShutdown()) &#123; r.run(); &#125;&#125; æ—¢ä¸æŠ›å¼ƒä»»åŠ¡ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç›´æ¥è¿è¡Œä»»åŠ¡çš„runæ–¹æ³•ï¼Œæ¢è¨€ä¹‹å°†ä»»åŠ¡å›é€€ç»™è°ƒç”¨è€…æ¥ç›´æ¥è¿è¡Œã€‚ä½¿ç”¨è¯¥ç­–ç•¥æ—¶çº¿ç¨‹æ± é¥±å’Œåå°†ç”±è°ƒç”¨çº¿ç¨‹æ± çš„ä¸»çº¿ç¨‹è‡ªå·±æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå› æ­¤åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿™æ®µæ—¶é—´é‡Œä¸»çº¿ç¨‹æ— æ³•å†æäº¤æ–°ä»»åŠ¡ï¼Œä»è€Œä½¿çº¿ç¨‹æ± ä¸­å·¥ä½œçº¿ç¨‹æœ‰æ—¶é—´å°†æ­£åœ¨å¤„ç†çš„ä»»åŠ¡å¤„ç†å®Œæˆã€‚ 6. Javaæä¾›çš„å››ç§å¸¸ç”¨çº¿ç¨‹æ± è§£ææ—¢ç„¶æ¥¼ä¸»è¸©å‘å°±æ˜¯ä½¿ç”¨äº† JDK çš„é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆå†æ¥çœ‹çœ‹è¿™äº›é»˜è®¤å®ç°åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œå°è£…äº†å“ªäº›å‚æ•°ã€‚ç®€è€Œè¨€ä¹‹ Executors å·¥å‚æ–¹æ³•Executors.newCachedThreadPool() æä¾›äº†æ— ç•Œçº¿ç¨‹æ± ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨çº¿ç¨‹å›æ”¶ï¼›Executors.newFixedThreadPool(int) æä¾›äº†å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œå†…éƒ¨ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼›Executors.newSingleThreadExecutor() æä¾›äº†å•ä¸ªåå°çº¿ç¨‹ã€‚ è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä¸Šè¿°å››ç§çº¿ç¨‹æ± ã€‚ 6.1 newCachedThreadPool12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; åœ¨newCachedThreadPoolä¸­å¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹ã€‚åˆçœ‹è¯¥æ„é€ å‡½æ•°æ—¶æˆ‘æœ‰è¿™æ ·çš„ç–‘æƒ‘ï¼šæ ¸å¿ƒçº¿ç¨‹æ± ä¸º0ï¼Œé‚£æŒ‰ç…§å‰é¢æ‰€è®²çš„çº¿ç¨‹æ± ç­–ç•¥æ–°ä»»åŠ¡æ¥ä¸´æ—¶æ— æ³•è¿›å…¥æ ¸å¿ƒçº¿ç¨‹æ± ï¼Œåªèƒ½è¿›å…¥ SynchronousQueueä¸­è¿›è¡Œç­‰å¾…ï¼Œè€ŒSynchronousQueueçš„å¤§å°ä¸º1ï¼Œé‚£å²‚ä¸æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡åˆ°è¾¾æ—¶åªèƒ½ç­‰å¾…åœ¨é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ç¬¬äºŒä¸ªä»»åŠ¡åˆ°è¾¾å‘ç°æ— æ³•è¿›å…¥é˜Ÿåˆ—æ‰èƒ½åˆ›å»ºç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Ÿè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåœ¨ä¸Šé¢è®²SynchronousQueueæ—¶å…¶å®å·²ç»ç»™å‡ºäº†ï¼Œè¦å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥SynchronousQueueä¸­ï¼Œå¿…é¡»æœ‰å¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¥æ”¶è¿™ä¸ªå…ƒç´ ã€‚å› æ­¤å³ä¾¿SynchronousQueueä¸€å¼€å§‹ä¸ºç©ºä¸”å¤§å°ä¸º1ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡ä¹Ÿæ— æ³•æ”¾å…¥å…¶ä¸­ï¼Œå› ä¸ºæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ä»SynchronousQueueä¸­å–èµ°å…ƒç´ ã€‚å› æ­¤ç¬¬ä¸€ä¸ªä»»åŠ¡åˆ°è¾¾æ—¶ä¾¿ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ 6.2 newFixedThreadPool12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125; çœ‹ä»£ç ä¸€ç›®äº†ç„¶äº†ï¼Œçº¿ç¨‹æ•°é‡å›ºå®šï¼Œä½¿ç”¨æ— é™å¤§çš„é˜Ÿåˆ—ã€‚ 6.3 newScheduledThreadPoolåˆ›å»ºä¸€ä¸ªå®šé•¿çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶åŠå‘¨æœŸæ€§ä»»åŠ¡æ‰§è¡Œã€‚ 123public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123; return new ScheduledThreadPoolExecutor(corePoolSize);&#125; åœ¨æ¥çœ‹çœ‹ScheduledThreadPoolExecutorï¼ˆï¼‰çš„æ„é€ å‡½æ•° 1234public ScheduledThreadPoolExecutor(int corePoolSize) &#123; super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS, new DelayedWorkQueue()); &#125; ScheduledThreadPoolExecutorçš„çˆ¶ç±»å³ThreadPoolExecutorï¼Œå› æ­¤è¿™é‡Œå„å‚æ•°å«ä¹‰å’Œä¸Šé¢ä¸€æ ·ã€‚å€¼å¾—å…³å¿ƒçš„æ˜¯DelayedWorkQueueè¿™ä¸ªé˜»å¡å¯¹åˆ—ï¼Œåœ¨ä¸Šé¢æ²¡æœ‰ä»‹ç»ï¼Œå®ƒä½œä¸ºé™æ€å†…éƒ¨ç±»å°±åœ¨ScheduledThreadPoolExecutorä¸­è¿›è¡Œäº†å®ç°ã€‚ç®€å•çš„è¯´ï¼ŒDelayedWorkQueueæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œå®ƒèƒ½æŒ‰ä¸€å®šçš„é¡ºåºå¯¹å·¥ä½œé˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œæ’åˆ—ã€‚ 6.4 newSingleThreadExecutoråˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹åŒ–çš„çº¿ç¨‹æ± ï¼Œå®ƒåªä¼šç”¨å”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº(FIFO, LIFO, ä¼˜å…ˆçº§)æ‰§è¡Œã€‚ 1234public static ScheduledExecutorService newSingleThreadScheduledExecutor() &#123; return new DelegatedScheduledExecutorService (new ScheduledThreadPoolExecutor(1)); &#125; é¦–å…ˆnewäº†ä¸€ä¸ªçº¿ç¨‹æ•°ç›®ä¸º 1 çš„ScheduledThreadPoolExecutorï¼Œå†æŠŠè¯¥å¯¹è±¡ä¼ å…¥DelegatedScheduledExecutorServiceä¸­ï¼Œçœ‹çœ‹DelegatedScheduledExecutorServiceçš„å®ç°ä»£ç ï¼š 1234DelegatedScheduledExecutorService(ScheduledExecutorService executor) &#123; super(executor); e = executor;&#125; åœ¨çœ‹çœ‹å®ƒçš„çˆ¶ç±» 123DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125; å…¶å®å°±æ˜¯ä½¿ç”¨è£…é¥°æ¨¡å¼å¢å¼ºäº†ScheduledExecutorServiceï¼ˆ1ï¼‰çš„åŠŸèƒ½ï¼Œä¸ä»…ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹é¡ºåºæ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿä¿è¯çº¿ç¨‹æ„å¤–ç»ˆæ­¢åä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚ 7. ä¸ºä»€ä¹ˆç¦æ­¢ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ? 7.1 å®éªŒè¯æ˜Executorsç¼ºé™·12345678910111213141516171819202122public class ExecutorsDemo &#123; private static ExecutorService executor = Executors.newFixedThreadPool(15); public static void main(String[] args) &#123; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; executor.execute(new SubThread()); &#125; &#125; &#125; class SubThread implements Runnable &#123; @Override public void run() &#123; try &#123; Thread.sleep(10000); &#125; catch (InterruptedException e) &#123; //do nothing &#125; &#125; &#125; &#125; é€šè¿‡æŒ‡å®šJVMå‚æ•°:-Xmx8m -Xms8mè¿è¡Œä»¥ä¸Šä»£ç ï¼Œä¼šæŠ›å‡ºOOM: 1234Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: GC overhead limit exceededat java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue. java:416)at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor. java:1371)at com.hollis.ExecutorsDemo.main(ExecutorsDemo.java:16) ä»¥ä¸Šä»£ç æŒ‡å‡ºï¼ŒExecutorsDemo.java çš„ç¬¬ 16 è¡Œï¼Œå°±æ˜¯ä»£ç ä¸­çš„ execu- tor.execute(new SubThread());ã€‚ 7.2 Executors ä¸ºä»€ä¹ˆå­˜åœ¨ç¼ºé™·é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“äº† Executors åˆ›å»ºçš„çº¿ç¨‹æ± å­˜åœ¨ OOM çš„é£é™©ï¼Œé‚£ ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„å‘¢?æˆ‘ä»¬éœ€è¦æ·±å…¥ Executors çš„æºç æ¥åˆ†æä¸€ä¸‹ã€‚ å…¶å®ï¼Œåœ¨ä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥çœ‹å‡ºè››ä¸é©¬è¿¹çš„ï¼Œåœ¨ä»¥ä¸Šçš„ä»£ç ä¸­å…¶å® å·²ç»è¯´äº†ï¼ŒçœŸæ­£çš„å¯¼è‡´ OOM çš„å…¶å®æ˜¯ LinkedBlockingQueue.offer æ–¹æ³•ã€‚ å¦‚æœè¯»è€…ç¿»çœ‹ä»£ç çš„è¯ï¼Œä¹Ÿå¯ä»¥å‘ç°ï¼Œå…¶å®åº•å±‚ç¡®å®æ˜¯é€šè¿‡ LinkedBlock- ingQueue å®ç°çš„: 123public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()); å¦‚æœè¯»è€…å¯¹ Java ä¸­çš„é˜»å¡é˜Ÿåˆ—æœ‰æ‰€äº†è§£çš„è¯ï¼Œçœ‹åˆ°è¿™é‡Œæˆ–è®¸å°±èƒ½å¤Ÿæ˜ç™½åŸå› äº†ã€‚ Java ä¸­ çš„ BlockingQueue ä¸» è¦ æœ‰ ä¸¤ ç§ å® ç°ï¼Œ åˆ† åˆ« æ˜¯ ArrayBlockingQ- ueue å’Œ LinkedBlockingQueueã€‚ ArrayBlockingQueue æ˜¯ä¸€ä¸ªç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå¿…é¡»è®¾ç½®å®¹é‡ã€‚ LinkedBlockingQueue æ˜¯ä¸€ä¸ªç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œå®¹é‡å¯ä»¥é€‰æ‹© è¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸º Integer.MAX_ VALUEã€‚ è¿™é‡Œçš„é—®é¢˜å°±å‡ºåœ¨:ä¸è®¾ç½®çš„è¯ï¼Œå°†æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä¸è®¾ç½® LinkedBlockingQueue çš„ å®¹é‡çš„è¯ï¼Œå…¶é»˜è®¤å®¹é‡å°†ä¼šæ˜¯ Integer.MAX_VALUEã€‚ è€Œ newFixedThreadPool ä¸­åˆ›å»º LinkedBlockingQueue æ—¶ï¼Œå¹¶æœªæŒ‡å®šå®¹ é‡ã€‚æ­¤æ—¶ï¼ŒLinkedBlockingQueue å°±æ˜¯ä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ—ï¼Œå¯¹äºä¸€ä¸ªæ— è¾¹ç•Œé˜Ÿåˆ— æ¥è¯´ï¼Œæ˜¯å¯ä»¥ä¸æ–­çš„å‘é˜Ÿåˆ—ä¸­åŠ å…¥ä»»åŠ¡çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æœ‰å¯èƒ½å› ä¸ºä»»åŠ¡è¿‡å¤šè€Œå¯¼ è‡´å†…å­˜æº¢å‡ºé—®é¢˜ã€‚ ä¸Šé¢æåˆ°çš„é—®é¢˜ä¸»è¦ä½“ç°åœ¨newFixedThreadPool å’Œ newSingleThreadExecutor ä¸¤ä¸ªå·¥å‚æ–¹æ³•ä¸Šï¼Œå¹¶ä¸æ˜¯è¯´ newCachedThreadPool å’Œ newScheduledThreadPool è¿™ä¸¤ä¸ªæ–¹æ³•å°±å®‰å…¨äº†ï¼Œè¿™ä¸¤ç§æ–¹å¼åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°å¯èƒ½æ˜¯ Integer.MAX_VALUEï¼Œè€Œåˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹ï¼Œå¿…ç„¶å°±æœ‰å¯èƒ½å¯¼è‡´ OOMã€‚ 7.3 åˆ›å»ºçº¿ç¨‹æ± çš„æ­£ç¡®å§¿åŠ¿é¿å…ä½¿ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¸»è¦æ˜¯é¿å…ä½¿ç”¨å…¶ä¸­çš„é»˜è®¤å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ å¯ä»¥è‡ªå·±ç›´æ¥è°ƒç”¨ ThreadPoolExecutor çš„æ„é€ å‡½æ•°æ¥è‡ªå·±åˆ›å»ºçº¿ç¨‹æ± ã€‚åœ¨åˆ›å»ºçš„ åŒæ—¶ï¼Œç»™ BlockQueue æŒ‡å®šå®¹é‡å°±å¯ä»¥äº†ã€‚ 12private static ExecutorService executor = new ThreadPoolExecutor(10, 10, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue(10)); è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦æäº¤çš„çº¿ç¨‹æ•°è¶…è¿‡å½“å‰å¯ç”¨çº¿ç¨‹æ•°æ—¶ï¼Œå°±ä¼šæŠ›å‡º java.util. concurrent.RejectedExecutionExceptionï¼Œè¿™æ˜¯å› ä¸ºå½“å‰çº¿ç¨‹æ± ä½¿ç”¨çš„é˜Ÿåˆ— æ˜¯æœ‰è¾¹ç•Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å·²ç»æ»¡äº†ä¾¿æ— æ³•ç»§ç»­å¤„ç†æ–°çš„è¯·æ±‚ã€‚ä½†æ˜¯å¼‚å¸¸(Exception)æ€»æ¯” å‘ç”Ÿé”™è¯¯(Error)è¦å¥½ã€‚ é™¤äº†è‡ªå·±å®šä¹‰ ThreadPoolExecutor å¤–ã€‚è¿˜æœ‰å…¶ä»–æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ç¬¬ä¸€æ—¶é—´ å°±åº”è¯¥æƒ³åˆ°å¼€æºç±»åº“ï¼Œå¦‚ apache å’Œ guava ç­‰ã€‚ ä½œè€…æ¨èä½¿ç”¨ guava æä¾›çš„ ThreadFactoryBuilder æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚ 12345678910public class ExecutorsDemo &#123; private static ThreadFactory namedThreadFactory = new ThreadFactoryBuilder() .setNameFormat(&quot;demo-pool-%d&quot;).build(); private static ExecutorService pool = new ThreadPoolExecutor(5, 200, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(1024), namedThreadFactory, new ThreadPoolExecutor. AbortPolicy()); public static void main(String[] args) &#123; for (int i = 0; i &lt; Integer.MAX_VALUE; i++) &#123; pool.execute(new SubThread()); &#125; &#125;&#125; é€šè¿‡ä¸Šè¿°æ–¹å¼åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œä¸ä»…å¯ä»¥é¿å… OOM çš„é—®é¢˜ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹å ç§°ï¼Œæ›´åŠ æ–¹ä¾¿çš„å‡ºé”™çš„æ—¶å€™æº¯æºã€‚ 8ã€ThreadPoolExecutoræºç è§£æ8.1 ThreadPoolExecutorç±»é‡è¦å±æ€§1234567891011121314151617//è¿™ä¸ªå±æ€§æ˜¯ç”¨æ¥å­˜æ”¾ å½“å‰è¿è¡Œçš„workeræ•°é‡ä»¥åŠçº¿ç¨‹æ± çŠ¶æ€çš„//intæ˜¯32ä½çš„ï¼Œè¿™é‡ŒæŠŠintçš„é«˜3ä½æ‹¿æ¥è®°å½•çº¿ç¨‹æ± çŠ¶æ€çš„æ ‡å¿—ä½,å29ä½æ‹¿æ¥è®°å½•å½“å‰è¿è¡Œworkerçš„æ•°é‡private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));//å­˜æ”¾ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—private final BlockingQueue&lt;Runnable&gt; workQueue;//workerçš„é›†åˆ,ç”¨setæ¥å­˜æ”¾private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;();//å†å²è¾¾åˆ°çš„workeræ•°æœ€å¤§å€¼private int largestPoolSize;//å½“é˜Ÿåˆ—æ»¡äº†å¹¶ä¸”workerçš„æ•°é‡è¾¾åˆ°maxSizeçš„æ—¶å€™,æ‰§è¡Œå…·ä½“çš„æ‹’ç»ç­–ç•¥private volatile RejectedExecutionHandler handler;//è¶…å‡ºcoreSizeçš„workerçš„ç”Ÿå­˜æ—¶é—´private volatile long keepAliveTime;//å¸¸é©»workerçš„æ•°é‡private volatile int corePoolSize;//æœ€å¤§workerçš„æ•°é‡,ä¸€èˆ¬å½“workQueueæ»¡äº†æ‰ä¼šç”¨åˆ°è¿™ä¸ªå‚æ•°private volatile int maximumPoolSize; 8.2 ThreadPoolExecutorå®šä¹‰çš„å†…éƒ¨çŠ¶æ€12345678910111213141516private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));private static final int COUNT_BITS = Integer.SIZE - 3;private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1;// runState is stored in the high-order bitsprivate static final int RUNNING = -1 &lt;&lt; COUNT_BITS;private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;private static final int STOP = 1 &lt;&lt; COUNT_BITS;private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS;// Packing and unpacking ctlprivate static int runStateOf(int c) &#123; return c &amp; ~CAPACITY; &#125;private static int workerCountOf(int c) &#123; return c &amp; CAPACITY; &#125;private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; å…¶ä¸­AtomicIntegerå˜é‡ctlçš„åŠŸèƒ½éå¸¸å¼ºå¤§: åˆ©ç”¨ä½29ä½è¡¨ç¤ºçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ï¼Œé€šè¿‡é«˜3ä½è¡¨ç¤ºçº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€: RUNNING: -1 &lt;&lt; COUNT_BITSï¼Œå³é«˜3ä½ä¸º111ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œå¹¶å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼› SHUTDOWN: 0 &lt;&lt; COUNT_BITSï¼Œå³é«˜3ä½ä¸º000ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹æ± ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼› STOP : 1 &lt;&lt; COUNT_BITSï¼Œå³é«˜3ä½ä¸º001ï¼Œè¯¥çŠ¶æ€çš„çº¿ç¨‹ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè€Œä¸”ä¼šä¸­æ–­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼› TIDYING : 2 &lt;&lt; COUNT_BITSï¼Œå³é«˜3ä½ä¸º010, æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ç»ˆæ­¢ï¼› TERMINATED: 3 &lt;&lt; COUNT_BITSï¼Œå³é«˜3ä½ä¸º011, terminated()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæˆ 8.3 executeæºç è§£æ1234567891011121314151617181920212223242526public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); int c = ctl.get(); if (workerCountOf(c) &lt; corePoolSize) &#123; // æ·»åŠ ä»»åŠ¡é˜Ÿåˆ—å¹¶åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹ï¼Œç„¶ååœ¨æ‰§è¡Œ if (addWorker(command, true)) return; c = ctl.get(); &#125; // çº¿ç¨‹æ± æ˜¯è¿è¡ŒçŠ¶æ€å¹¶ä¸”ä»»åŠ¡æˆåŠŸæ·»åŠ åˆ°é˜Ÿåˆ— if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); // recheck and if necessary å›æ»šåˆ°å…¥é˜Ÿæ“ä½œå‰ï¼Œå³å€˜è‹¥çº¿ç¨‹æ± shutdownçŠ¶æ€ï¼Œå°±remove(command) //å¦‚æœçº¿ç¨‹æ± æ²¡æœ‰RUNNINGï¼ŒæˆåŠŸä»é˜»å¡é˜Ÿåˆ—ä¸­åˆ é™¤ä»»åŠ¡ï¼Œæ‰§è¡Œrejectæ–¹æ³•å¤„ç†ä»»åŠ¡ if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) // ä½¿ç”¨æ™®é€šçº¿ç¨‹è¿è¡Œä»»åŠ¡ addWorker(null, false); &#125; // å¾€çº¿ç¨‹æ± ä¸­åˆ›å»ºæ–°çš„çº¿ç¨‹å¤±è´¥ï¼Œåˆ™rejectä»»åŠ¡ else if (!addWorker(command, false)) reject(command);&#125; æ€è€ƒğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦double checkçº¿ç¨‹æ± çš„çŠ¶æ€? åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œçº¿ç¨‹æ± çš„çŠ¶æ€æ—¶åˆ»åœ¨å˜åŒ–ï¼Œè€Œctl.get()æ˜¯éåŸå­æ“ä½œï¼Œå¾ˆæœ‰å¯èƒ½åˆšè·å–äº†çº¿ç¨‹æ± çŠ¶æ€åçº¿ç¨‹æ± çŠ¶æ€å°±æ”¹å˜äº†ã€‚åˆ¤æ–­æ˜¯å¦å°†commandåŠ å…¥workqueæ˜¯çº¿ç¨‹æ± ä¹‹å‰çš„çŠ¶æ€ã€‚å€˜è‹¥æ²¡æœ‰double checkï¼Œä¸‡ä¸€çº¿ç¨‹æ± å¤„äºérunningçŠ¶æ€(åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¾ˆæœ‰å¯èƒ½å‘ç”Ÿ)ï¼Œé‚£ä¹ˆcommandæ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ addWorkeræ–¹æ³• å…ˆçœ‹çœ‹addWorkeræ–¹æ³•çš„æ³¨é‡Šï¼Œæ–¹ä¾¿æˆ‘ä»¬ç†è§£æºç  1234567891011121314151617181920212223242526272829303132Checks if a new worker can be added with respect to current * pool state and the given bound (either core or maximum). If so, * the worker count is adjusted accordingly, and, if possible, a * new worker is created and started, running firstTask as its * first task. This method returns false if the pool is stopped or * eligible to shut down. It also returns false if the thread * factory fails to create a thread when asked. If the thread * creation fails, either due to the thread factory returning * null, or due to an exception (typically OutOfMemoryError in * Thread.start()), we roll back cleanly. * // å¤§æ¦‚ç¿»è¯‘å¦‚ä¸‹ï¼š //1ã€é¦–å…ˆå…ˆæ£€æŸ¥çº¿ç¨‹æ± çš„çŠ¶æ€å’Œçº¿ç¨‹æ•°é‡æ˜¯å¦è¶…è¿‡ç•Œé™ //2ã€å¦‚æœå¯ä»¥åˆ›å»ºçš„è¯ï¼Œéœ€è¦æ›´æ–°ä»»åŠ¡çš„æ•°é‡ï¼Œç„¶åè¿è¡Œä»»åŠ¡ //3ã€æœ‰ä¸¤ç§æƒ…å†µè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›falseï¼Œçº¿ç¨‹æ± stopçŠ¶æ€æˆ–è€…shut downçŠ¶æ€ //è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯å…±åˆ›åˆ›å»ºçº¿ç¨‹å¤±è´¥ 4ã€ä¸ç®¡æ˜¯å‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œä¾‹å¦‚çº¿ç¨‹å·¥å‚è¿”å›nullæˆ–è€…æ˜¯å‘ç”Ÿäº†OOM,ç›´æ¥å›æ»š * @param firstTask the task the new thread should run first (or * null if none). Workers are created with an initial first task * (in method execute()) to bypass queuing when there are fewer * than corePoolSize threads (in which case we always start one), * or when the queue is full (in which case we must bypass queue). * Initially idle threads are usually created via * prestartCoreThread or to replace other dying workers. * * @param core if true use corePoolSize as bound, else * maximumPoolSize. (A boolean indicator is used here rather than a * value to ensure reads of fresh values after checking other pool * state). * @return true if successful ä¸‹é¢æ˜¯æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869private boolean addWorker(Runnable firstTask, boolean core) &#123; retry: for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) &#123; int wc = workerCountOf(c); if (wc &gt;= CAPACITY || wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; // casä¿®æ”¹cçš„å€¼ if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop &#125; &#125; boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try &#123; w = new Worker(firstTask); final Thread t = w.thread; if (t != null) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) &#123; if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); workers.add(w); int s = workers.size(); // largestPoolSizeè®°å½•çš„æœ€å¤§workersé•¿åº¦ if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; &#125; &#125; finally &#123; mainLock.unlock(); &#125; if (workerAdded) &#123; // çº¿ç¨‹å¯åŠ¨ï¼Œæ‰§è¡Œä»»åŠ¡(Worker.thread(firstTask).start()); t.start(); workerStarted = true; &#125; &#125; &#125; finally &#123; if (! workerStarted) addWorkerFailed(w); &#125; return workerStarted;&#125; çº¿ç¨‹startä¹‹åä¼šæ‰§è¡Œå¦‚ä¸‹runæ–¹æ³•ï¼š 1234 /** Delegates main run loop to outer runWorker */ public void run() &#123; runWorker(this);&#125; ä¸‹é¢æ˜¯runWorkeræ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243final void runWorker(Worker w) &#123; Thread wt = Thread.currentThread(); Runnable task = w.firstTask; w.firstTask = null; w.unlock(); // allow interrupts boolean completedAbruptly = true; try &#123; while (task != null || (task = getTask()) != null) &#123; w.lock(); // If pool is stopping, ensure thread is interrupted; // if not, ensure thread is not interrupted. This // requires a recheck in second case to deal with // shutdownNow race while clearing interrupt if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try &#123; beforeExecute(wt, task); Throwable thrown = null; try &#123; task.run(); &#125; catch (RuntimeException x) &#123; thrown = x; throw x; &#125; catch (Error x) &#123; thrown = x; throw x; &#125; catch (Throwable x) &#123; thrown = x; throw new Error(x); &#125; finally &#123; afterExecute(task, thrown); &#125; &#125; finally &#123; task = null; w.completedTasks++; w.unlock(); &#125; &#125; completedAbruptly = false; &#125; finally &#123; processWorkerExit(w, completedAbruptly); &#125; &#125; é€šè¿‡getTaskæ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡ï¼ŒgetTaskæ–¹æ³•ä¼šè¢«é˜»å¡å¹¶æŒ‚èµ·ï¼Œä¸ä¼šå ç”¨cpuèµ„æºï¼› getTask()æ–¹æ³•æºç å¦‚ä¸‹ ä¸‹é¢æ¥çœ‹ä¸€ä¸‹getTask()æ–¹æ³•ï¼Œè¿™é‡Œé¢æ¶‰åŠåˆ°keepAliveTimeçš„ä½¿ç”¨ï¼Œä»è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå…ˆåƒæ± æ˜¯æ€ä¹ˆè®©è¶…è¿‡corePoolSizeçš„é‚£éƒ¨åˆ†workeré”€æ¯çš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637private Runnable getTask() &#123; boolean timedOut = false; // Did the last poll() time out? for (;;) &#123; int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) &#123; decrementWorkerCount(); return null; &#125; int wc = workerCountOf(c); // Are workers subject to culling? boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) &#123; if (compareAndDecrementWorkerCount(c)) return null; continue; &#125; try &#123; Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; timedOut = true; &#125; catch (InterruptedException retry) &#123; timedOut = false; &#125; &#125;&#125; allowCoreThreadTimeOutä¸ºfalseï¼Œçº¿ç¨‹å³ä½¿ç©ºé—²ä¹Ÿä¸ä¼šè¢«é”€æ¯ï¼›å€˜è‹¥ä¸ºtureï¼Œåœ¨keepAliveTimeå†…ä»ç©ºé—²åˆ™ä¼šè¢«é”€æ¯ã€‚ å¦‚æœçº¿ç¨‹å…è®¸ç©ºé—²ç­‰å¾…è€Œä¸è¢«é”€æ¯timed == falseï¼ŒworkQueue.takeä»»åŠ¡: å¦‚æœé˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ç­‰å¾…ï¼›å½“é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡åŠ å…¥æ—¶ï¼Œçº¿ç¨‹è¢«å”¤é†’ï¼Œtakeæ–¹æ³•è¿”å›ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œï¼› å¦‚æœçº¿ç¨‹ä¸å…è®¸æ— ä¼‘æ­¢ç©ºé—²timed == true, workQueue.pollä»»åŠ¡: å¦‚æœåœ¨keepAliveTimeæ—¶é—´å†…ï¼Œé˜»å¡é˜Ÿåˆ—è¿˜æ˜¯æ²¡æœ‰ä»»åŠ¡ï¼Œåˆ™è¿”å›nullï¼›","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹Blocking Queue","date":"2021-08-03T08:48:32.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹Blocking-Queue/","text":"Blocking QueueA blocking queue is a queue that blocks when you try to dequeue from it and the queue is empty, or if you try to enqueue items to it and the queue is already full. A thread trying to dequeue from an empty queue is blocked until some other thread inserts an item into the queue. A thread trying to enqueue an item in a full queue is blocked until some other thread makes space in the queue, either by dequeuing one or more items or clearing the queue completely. é˜»å¡é˜Ÿåˆ—ä¸¤å¤§ç‰¹æ€§ï¼š å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å‘é˜Ÿåˆ— put å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šä¸€ç›´é˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—å¯ç”¨æˆ–è€…å“åº”ä¸­æ–­é€€å‡º å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…çº¿ç¨‹ ä»é˜Ÿåˆ—é‡Œé¢ take å…ƒç´ ï¼Œé˜Ÿåˆ—ä¼šé˜»å¡æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©º é˜»å¡é˜Ÿåˆ—æœ€å¸¸ä½¿ç”¨åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ï¼Œå°†æ•°æ®å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ï¼Œåœ¨é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®ã€‚ é˜»å¡é˜Ÿåˆ—åœ¨ä¸å¯ç”¨æ—¶ï¼Œä¸‹é¢æ˜¯å„ç§å¤„ç†æ“ä½œçš„ç»“æœï¼šğŸ‘‡ æ–¹æ³•/å¤„ç†æ–¹å¼ æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ ä¸€ç›´é˜»å¡ è¶…æ—¶é€€å‡º æ’å…¥æ–¹æ³• add(e) offer(e) put(e) offer(e, time,unit) ç§»é™¤æ–¹æ³• remove() poll() take() poll(time,unit) æ£€æŸ¥æ–¹æ³• element() peek() ä¸å¯ç”¨ ä¸å¯ç”¨ add æŠ›å‡ºå¼‚å¸¸IllegalStateException12345678public class ArrayBlockingQueueDemo &#123; public static void main(String[] args) &#123; ArrayBlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(1); queue.add(&quot;a&quot;); queue.add(&quot;b&quot;); System.err.println(&quot;queue size -&gt; &quot; + queue.size()); &#125;&#125; å¼‚å¸¸ä¿¡æ¯ï¼š 1234Exception in thread &quot;main&quot; java.lang.IllegalStateException: Queue full at java.util.AbstractQueue.add(AbstractQueue.java:98) at java.util.concurrent.ArrayBlockingQueue.add(ArrayBlockingQueue.java:312) at com.ibli.note.ArrayBlockingQueueDemo.main(ArrayBlockingQueueDemo.java:15) elementæŠ›å‡ºå¼‚å¸¸NoSuchElementException1234567public class ArrayBlockingQueueDemo &#123; public static void main(String[] args) &#123; ArrayBlockingQueue&lt;String&gt; queue = new ArrayBlockingQueue&lt;String&gt;(1); System.err.println(&quot;queue size -&gt; &quot; + queue.size()); queue.element(); &#125;&#125; å¼‚å¸¸ä¿¡æ¯ï¼š 1234queue size -&gt; 0Exception in thread &quot;main&quot; java.util.NoSuchElementException at java.util.AbstractQueue.element(AbstractQueue.java:136) at com.ibli.note.ArrayBlockingQueueDemo.main(ArrayBlockingQueueDemo.java:14) ArrayBlockingQueueåº•å±‚ç”±æ•°ç»„å®ç°çš„æœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ƒçš„å®¹é‡åœ¨åˆ›å»ºçš„æ—¶å€™å°±å·²ç»ç¡®è®¤äº†ï¼Œå¹¶ä¸”ä¸èƒ½ä¿®æ”¹ã€‚ 12345678public ArrayBlockingQueue(int capacity, boolean fair) &#123; if (capacity &lt;= 0) throw new IllegalArgumentException(); this.items = new Object[capacity]; lock = new ReentrantLock(fair); notEmpty = lock.newCondition(); notFull = lock.newCondition();&#125; é»˜è®¤æƒ…å†µä¸‹ï¼ŒArrayBlockingQueueæ˜¯ä¸ä¿è¯çº¿ç¨‹å…¬å¹³è®¿é—®é˜Ÿåˆ—çš„ï¼Œè¿™é‡Œæ‰€è°“çš„å…¬å¹³ä¸å¦æ˜¯æŒ‡ï¼Œé˜»å¡çš„çº¿ç¨‹èƒ½å¦æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå…ˆé˜»å¡å…ˆè®¿é—®ï¼Œåé˜»å¡åè®¿é—®ã€‚ æ€è€ƒä¸ºä»€ä¹ˆé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³çš„æ–¹å¼è®¿é—®å‘¢ï¼Ÿ ğŸ¤” è¿™ä¸ªæ˜¯ä¸ºäº†å¢åŠ ç³»ç»Ÿèµ„æºåˆ©ç”¨ç‡ï¼Œåœ¨ä¸ä¿è¯å…¬å¹³çš„æƒ…å†µä¸‹ï¼Œå¤šçº¿ç¨‹ä¹‹é—´ä¹‹é—´æ‰§è¡Œçš„æ•ˆç‡è¦æ¯”å…¬å¹³æ¨¡å¼ä¸‹é«˜çš„å¤šã€‚ ArrayBlovkingQueue#putæ–¹æ³• ä¸‹é¢æ˜¯putæ–¹æ³•æºç ï¼š 12345678910111213141516public void put(E e) throws InterruptedException &#123; checkNotNull(e); final ReentrantLock lock = this.lock; // åŠ é” lock.lockInterruptibly(); try &#123; while (count == items.length) // é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œé˜»å¡ notFull.await(); // å‘é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´  enqueue(e); &#125; finally &#123; // æ‰§è¡Œå®Œæœ€åé‡Šæ”¾é” lock.unlock(); &#125;&#125; ä¸‹é¢æ˜¯æ·»åŠ æ•°æ®çš„æ–¹æ³•æºç ï¼š 1234567891011private void enqueue(E x) &#123; // assert lock.getHoldCount() == 1; // assert items[putIndex] == null; final Object[] items = this.items; items[putIndex] = x; if (++putIndex == items.length) putIndex = 0; count++; // æ•°æ®æ·»åŠ å®Œä¹‹åï¼Œå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹åˆ°åŒæ­¥é˜Ÿåˆ— notEmpty.signal();&#125; â€¼ï¸å”¤é†’çš„çº¿ç¨‹èƒ½å¤ŸæŠ¢åˆ°é”æ˜¯ä¸ç¡®å®šçš„ï¼Œsignalä¼šæ·»åŠ èŠ‚ç‚¹åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”ã€‚è¿™ä¸ªå¯ä»¥çœ‹ä¸€ä¸‹Conditioné‚£ç¯‡æ–‡ç« ã€‚ ArrayBlockingQueueæ›´å¤šè¯¦ç»†ç»†èŠ‚ä»¥åŠåŸç†è·³è½¬é“¾æ¥https://www.jianshu.com/p/a636b3d83911 LinkedBlockingQueueLinkedBlockingQueueæ˜¯ç”¨é“¾è¡¨å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒåŒæ ·æ»¡è¶³FIFOçš„ç‰¹æ€§ï¼Œä¸ArrayBlockingQueueç›¸æ¯”èµ·æ¥å…·æœ‰æ›´é«˜çš„ååé‡ï¼Œä¸ºäº†é˜²æ­¢LinkedBlockingQueueå®¹é‡è¿…é€Ÿå¢ï¼ŒæŸè€—å¤§é‡å†…å­˜ã€‚é€šå¸¸åœ¨åˆ›å»ºLinkedBlockingQueueå¯¹è±¡æ—¶ï¼Œä¼šæŒ‡å®šå…¶å¤§å°ï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå®¹é‡ç­‰äºInteger.MAX_VALUE; Executors.newFixedThreadPool é˜¿é‡Œå·´å·´ç¦æ­¢ä½¿ç”¨Executorsæ¥åˆ›å»ºçº¿ç¨‹æ±  é˜Ÿåˆ—å¤§å°æ— é™åˆ¶ï¼Œå¸¸ç”¨çš„ä¸ºæ— ç•Œçš„LinkedBlockingQueueï¼Œä½¿ç”¨è¯¥é˜Ÿåˆ—åšä¸ºé˜»å¡é˜Ÿåˆ—æ—¶è¦å°¤å…¶å½“å¿ƒï¼Œå½“ä»»åŠ¡è€—æ—¶è¾ƒé•¿æ—¶å¯èƒ½ä¼šå¯¼è‡´å¤§é‡æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯æœ€ç»ˆå¯¼è‡´OOMã€‚é˜…è¯»ä»£ç å‘ç°ï¼ŒExecutors.newFixedThreadPool é‡‡ç”¨å°±æ˜¯ LinkedBlockingQueueï¼Œå½“QPSå¾ˆé«˜ï¼Œå‘é€æ•°æ®å¾ˆå¤§ï¼Œå¤§é‡çš„ä»»åŠ¡è¢«æ·»åŠ åˆ°è¿™ä¸ªæ— ç•ŒLinkedBlockingQueue ä¸­ï¼Œå¯¼è‡´cpuå’Œå†…å­˜é£™å‡æœåŠ¡å™¨æŒ‚æ‰ã€‚ å±æ€§ä¿¡æ¯12345678910111213141516171819202122232425262728293031323334353637/** * èŠ‚ç‚¹ç±»ï¼Œç”¨äºå­˜å‚¨æ•°æ® */static class Node&lt;E&gt; &#123; E item; Node&lt;E&gt; next; Node(E x) &#123; item = x; &#125;&#125;/** é˜»å¡é˜Ÿåˆ—çš„å¤§å°ï¼Œé»˜è®¤ä¸ºInteger.MAX_VALUE */private final int capacity;/** å½“å‰é˜»å¡é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ªæ•° */private final AtomicInteger count = new AtomicInteger();/** * é˜»å¡é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ */transient Node&lt;E&gt; head;/** * é˜»å¡é˜Ÿåˆ—çš„å°¾èŠ‚ç‚¹ */private transient Node&lt;E&gt; last;/** è·å–å¹¶ç§»é™¤å…ƒç´ æ—¶ä½¿ç”¨çš„é”ï¼Œå¦‚take, poll, etc */private final ReentrantLock takeLock = new ReentrantLock();/** notEmptyæ¡ä»¶å¯¹è±¡ï¼Œå½“é˜Ÿåˆ—æ²¡æœ‰æ•°æ®æ—¶ç”¨äºæŒ‚èµ·æ‰§è¡Œåˆ é™¤çš„çº¿ç¨‹ */private final Condition notEmpty = takeLock.newCondition();/** æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨çš„é”å¦‚ put, offer, etc */private final ReentrantLock putLock = new ReentrantLock();/** notFullæ¡ä»¶å¯¹è±¡ï¼Œå½“é˜Ÿåˆ—æ•°æ®å·²æ»¡æ—¶ç”¨äºæŒ‚èµ·æ‰§è¡Œæ·»åŠ çš„çº¿ç¨‹ */private final Condition notFull = putLock.newCondition(); æ„é€ å‡½æ•°123456789101112131415161718192021222324252627282930public LinkedBlockingQueue() &#123; // é»˜è®¤å¤§å°ä¸ºInteger.MAX_VALUE this(Integer.MAX_VALUE);&#125;public LinkedBlockingQueue(int capacity) &#123; if (capacity &lt;= 0) throw new IllegalArgumentException(); this.capacity = capacity; last = head = new Node&lt;E&gt;(null);&#125;public LinkedBlockingQueue(Collection&lt;? extends E&gt; c) &#123; this(Integer.MAX_VALUE); final ReentrantLock putLock = this.putLock; putLock.lock(); try &#123; int n = 0; for (E e : c) &#123; if (e == null) throw new NullPointerException(); if (n == capacity) throw new IllegalStateException(&quot;Queue full&quot;); enqueue(new Node&lt;E&gt;(e)); ++n; &#125; count.set(n); &#125; finally &#123; putLock.unlock(); &#125;&#125; LinkedBlockingQueue#putæ–¹æ³•1234567891011121314151617181920212223242526public void put(E e) throws InterruptedException &#123; if (e == null) throw new NullPointerException(); int c = -1; Node&lt;E&gt; node = new Node&lt;E&gt;(e); final ReentrantLock putLock = this.putLock; final AtomicInteger count = this.count; // è·å–é”ä¸­æ–­ putLock.lockInterruptibly(); try &#123; //åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œå¦‚æœå·²æ»¡é˜»å¡ç­‰å¾… while (count.get() == capacity) &#123; notFull.await(); &#125; // æŠŠnodeæ”¾å…¥é˜Ÿåˆ—ä¸­ enqueue(node); c = count.getAndIncrement(); // å†æ¬¡åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æœ‰å¯ç”¨ç©ºé—´ï¼Œå¦‚æœæœ‰å”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œæ·»åŠ æ“ä½œ if (c + 1 &lt; capacity) notFull.signal(); &#125; finally &#123; putLock.unlock(); &#125; // å¦‚æœé˜Ÿåˆ—ä¸­æœ‰ä¸€æ¡æ•°æ®ï¼Œå”¤é†’æ¶ˆè´¹çº¿ç¨‹è¿›è¡Œæ¶ˆè´¹ if (c == 0) signalNotEmpty();&#125; é˜Ÿåˆ—å·²æ»¡ï¼Œé˜»å¡ç­‰å¾…ã€‚ é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ›å»ºä¸€ä¸ªnodeèŠ‚ç‚¹æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœæ”¾å®Œä»¥åé˜Ÿåˆ—è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œç»§ç»­å”¤é†’ä¸‹ä¸€ä¸ªæ·»åŠ çº¿ç¨‹è¿›è¡Œæ·»åŠ ã€‚å¦‚æœæ”¾ä¹‹å‰é˜Ÿåˆ—ä¸­æ²¡æœ‰å…ƒç´ ï¼Œæ”¾å®Œä»¥åè¦å”¤é†’æ¶ˆè´¹çº¿ç¨‹è¿›è¡Œæ¶ˆè´¹ã€‚ ArrayBlockingQueueä¸LinkedBlockingQueueçš„æ¯”è¾ƒç›¸åŒç‚¹ï¼šArrayBlockingQueueå’ŒLinkedBlockingQueueéƒ½æ˜¯é€šè¿‡conditioné€šçŸ¥æœºåˆ¶æ¥å®ç°å¯é˜»å¡å¼æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œå¹¶æ»¡è¶³çº¿ç¨‹å®‰å…¨çš„ç‰¹æ€§ï¼› ä¸åŒç‚¹ï¼š 1ã€ArrayBlockingQueueåº•å±‚æ˜¯é‡‡ç”¨çš„æ•°ç»„è¿›è¡Œå®ç°ï¼Œè€ŒLinkedBlockingQueueåˆ™æ˜¯é‡‡ç”¨é“¾è¡¨æ•°æ®ç»“æ„ï¼› 2ã€ArrayBlockingQueueæ’å…¥å’Œåˆ é™¤æ•°æ®ï¼Œåªé‡‡ç”¨äº†ä¸€ä¸ªlockï¼Œè€ŒLinkedBlockingQueueåˆ™æ˜¯åœ¨æ’å…¥å’Œåˆ é™¤åˆ†åˆ«é‡‡ç”¨äº†putLockå’ŒtakeLockï¼Œè¿™æ ·å¯ä»¥é™ä½çº¿ç¨‹ç”±äºçº¿ç¨‹æ— æ³•è·å–åˆ°lockè€Œè¿›å…¥WAITINGçŠ¶æ€çš„å¯èƒ½æ€§ï¼Œä»è€Œæé«˜äº†çº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ•ˆç‡ æ›´å¤šLinkedBlockingQueueçš„å®ç°ç»†èŠ‚å‚è§https://blog.csdn.net/tonywu1992/article/details/83419448 PriorityBlockingQueuePriorityBlockingQueueæ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡ç”¨è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ç±»å®ç°compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ æ’åºè§„åˆ™ï¼Œæˆ–è€…åˆå§‹åŒ–æ—¶é€šè¿‡æ„é€ å™¨å‚æ•°Comparatoræ¥æŒ‡å®šæ’åºè§„åˆ™ã€‚ 123456789public PriorityBlockingQueue(int initialCapacity, Comparator&lt;? super E&gt; comparator) &#123; if (initialCapacity &lt; 1) throw new IllegalArgumentException(); this.lock = new ReentrantLock(); this.notEmpty = lock.newCondition(); this.comparator = comparator; this.queue = new Object[initialCapacity]; &#125; ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—éœ€è¦æ³¨æ„çš„ç‚¹ï¼š 1ã€é˜Ÿåˆ—ä¸­ä¸å…è®¸å‡ºç°nullå€¼ï¼Œä¹Ÿä¸å…è®¸å‡ºç°ä¸èƒ½æ’åºçš„å…ƒç´ ã€‚ 2ã€é˜Ÿåˆ—å®¹é‡æ˜¯æ²¡æœ‰ä¸Šé™çš„ï¼Œä½†æ˜¯å¦‚æœæ’å…¥çš„å…ƒç´ è¶…è¿‡è´Ÿè½½ï¼Œæœ‰å¯èƒ½ä¼šå¼•èµ·OutOfMemoryå¼‚å¸¸ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—æ˜¯éƒ½åº”è¯¥æ³¨æ„çš„ç‚¹ï¼Œä¸èƒ½åœ¨é˜Ÿåˆ—ä¸­æ— é™å­˜æ”¾æ•°æ® 3ã€PriorityBlockingQueueç”±äºæ˜¯æ— ç•Œçš„ï¼Œæ‰€ä»¥putæ–¹æ³•æ˜¯éé˜»å¡çš„ã€‚ 123public void put(E e) &#123; offer(e); // never need to block è¯·è‡ªè¡Œå¯¹ç…§ä¸Šé¢è¡¨æ ¼&#125; å¯ä»¥ç»™å®šåˆå§‹å®¹é‡ï¼Œè¿™ä¸ªå®¹é‡ä¼šæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è‡ªåŠ¨æ‰©å…… 123456// Default array capacity.private static final int DEFAULT_INITIAL_CAPACITY = 11;public PriorityBlockingQueue() &#123; this(DEFAULT_INITIAL_CAPACITY, null);&#125; è¿™é‡Œé»˜è®¤çš„å®¹é‡æ˜¯ 11ï¼Œç”±äºä¹Ÿæ˜¯åŸºäºæ•°ç»„ã€‚ 4ã€å†…éƒ¨åªæœ‰ä¸€ä¸ªLockï¼Œæ‰€ä»¥ç”Ÿäº§æ¶ˆè´¹è€…ä¸èƒ½åŒæ—¶ä½œä¸š è¯¦æƒ…å¯ä»¥å‚ç…§https://www.cnblogs.com/wyq1995/p/12289462.html DelayQueueDelayQueueé¡¾åæ€ä¹‰ï¼Œå…·æœ‰å»¶æ—¶ä½œç”¨çš„é˜Ÿåˆ—ã€‚ è®°å¾—ç¬¬ä¸€æ¬¡æ¥è§¦å»¶æ—¶é˜Ÿåˆ—çš„æ—¶å€™æ˜¯åœ¨çœ‹åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦æ—¶çœ‹åˆ°åº•å±‚æœ‰å…³å»¶æ—¶é˜Ÿåˆ—çš„å®ç°ã€‚ DelayQueue ä¹Ÿæ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œä½¿ç”¨æ—¶è¦æ³¨æ„OOMã€‚ åªæœ‰delayæ—¶é—´å°äº0çš„å…ƒç´ æ‰èƒ½å¤Ÿè¢«å–å‡ºã€‚ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹åˆ›å»ºä¸€ä¸ªç±»ï¼Œå®ç°Delayedæ–¹æ³•ï¼Œé‡å†™getDelayæ–¹æ³•å’ŒcompareToæ–¹æ³•ï¼› 12345678910111213141516171819202122232425262728293031323334353637public class DelayData implements Delayed &#123; private long second; private String val; public DelayData(long second, String val) &#123; long l = System.currentTimeMillis(); System.err.println(second + &quot; &quot; + l); this.second = second + l; this.val = val; &#125; public long getSecond() &#123; return second; &#125; @Override public long getDelay(TimeUnit unit) &#123; long diffTime = second - System.currentTimeMillis(); return unit.convert(diffTime,TimeUnit.MILLISECONDS); &#125; @Override public int compareTo(Delayed o) &#123; DelayData tmp = (DelayData) o; long result = second - tmp.getSecond() ; return (int) result; &#125; @Override public String toString() &#123; return &quot;DelayData&#123;&quot; + &quot;second=&quot; + second + &quot;, val=&#x27;&quot; + val + &#x27;\\&#x27;&#x27; + &#x27;&#125;&#x27;; &#125;&#125; ç„¶ååˆ›å»ºä¸¤ä¸ªçº¿ç¨‹æ¨¡æ‹Ÿç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… 123456789101112131415161718192021222324252627282930313233public class DelayQueueDemo &#123; public static void main(String[] args) &#123; DelayQueue&lt;DelayData&gt; delayQueue = new DelayQueue&lt;DelayData&gt;(); new Thread(() -&gt; &#123; delayQueue.put(new DelayData(5000, &quot;a&quot;)); delayQueue.put(new DelayData(10000, &quot;b&quot;)); delayQueue.put(new DelayData(15000, &quot;c&quot;)); &#125;).start(); new Thread(() -&gt; &#123; boolean flag = true; while (true &amp;&amp; flag) &#123; try &#123; Thread.sleep(1000); System.err.println(&quot;æ‰§è¡Œä¸€æ¬¡å¾ªç¯ é˜Ÿåˆ—é•¿åº¦&quot; + delayQueue.size()); DelayData poll = delayQueue.take(); if (poll != null)&#123; System.err.println(poll.toString()); &#125; if (delayQueue.size() == 0)&#123; flag = false; break; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125;&#125; SynchronousQueueSynchronousQueueå®é™…ä¸Šå®ƒä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œå› ä¸ºå®ƒä¸ä¼šç»´æŠ¤é˜Ÿåˆ—ä¸­å…ƒç´ çš„å­˜å‚¨ç©ºé—´ï¼Œä¸å…¶ä»–é˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œå®ƒç»´æŠ¤ä¸€ç»„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹åœ¨ç­‰å¾…æŠŠå…ƒç´ åŠ å…¥æˆ–ç§»é™¤é˜Ÿåˆ—ã€‚é€‚ç”¨äºç”Ÿäº§è€…å°‘æ¶ˆè´¹è€…å¤šçš„æƒ…å†µã€‚ SynchronousQueueæ˜¯ç”Ÿäº§è€…ç›´æ¥æŠŠæ•°æ®ç»™æ¶ˆè´¹è€…ï¼ˆæ¶ˆè´¹è€…ç›´æ¥ä»ç”Ÿäº§è€…è¿™é‡Œæ‹¿æ•°æ®ï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸€ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹å¯¹åº”çš„ç§»é™¤æ“ä½œã€‚SynchronousQueueåˆæœ‰ä¸¤ç§æ¨¡å¼ï¼š 1ã€å…¬å¹³æ¨¡å¼ é‡‡ç”¨å…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼ˆQueueï¼‰æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… 2ã€éå…¬å¹³æ¨¡å¼ é‡‡ç”¨éå…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ªLIFOæ ˆï¼ˆStackï¼‰æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè¿™ä¹Ÿæ˜¯SynchronousQueueé»˜è®¤çš„æ¨¡å¼ æ„é€ æ–¹æ³•123456 public SynchronousQueue() &#123; this(false); &#125;public SynchronousQueue(boolean fair) &#123; transferer = fair ? new TransferQueue() : new TransferStack();&#125; transferer æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ç”¨äºåœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´ä¼ é€’æ•°æ® å®ç°ç”Ÿäº§è€…æ¶ˆè´¹è€…ä¸‹é¢æ¨¡æ‹Ÿä¸€ä¸ªç”Ÿäº§è€…ç”Ÿäº§æ•°æ®ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142public class SynchronousQueueDemo &#123; public static void main(String[] args) throws InterruptedException &#123; SynchronousQueue queue = new SynchronousQueue(); new Thread(() -&gt; &#123; try &#123; Thread.sleep(2000L); while (true) &#123; Thread.sleep(100); long l = System.currentTimeMillis(); queue.put(l); System.out.println(Thread.currentThread().getName() + &quot; ç”Ÿäº§è€…ç”Ÿäº§æ•°æ® :&quot; + l); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); new Thread(() -&gt; &#123; try &#123; Thread.sleep(1000); while (true) &#123; Thread.sleep(300); System.out.println(Thread.currentThread().getName() + &quot;æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ® ï¼š &quot; + queue.take()); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); new Thread(() -&gt; &#123; try &#123; Thread.sleep(1000); while (true) &#123; Thread.sleep(300); System.out.println(Thread.currentThread().getName() + &quot;æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ® ï¼š &quot; + queue.take()); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;).start(); &#125;&#125; ä»£ç è¿è¡Œç»“æœï¼š 1234567Thread-0 ç”Ÿäº§è€…ç”Ÿäº§æ•°æ® :1628055947404Thread-1æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ® ï¼š 1628055947404Thread-0 ç”Ÿäº§è€…ç”Ÿäº§æ•°æ® :1628055947506Thread-2æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ® ï¼š 1628055947506Thread-0 ç”Ÿäº§è€…ç”Ÿäº§æ•°æ® :1628055947608Thread-2æ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ® ï¼š 1628055947608Thread-0 ç”Ÿäº§è€…ç”Ÿäº§æ•°æ® :1628055947713 SynchronousQueueè¯¦ç»†å®ç°ç»†èŠ‚å‚è§https://blog.csdn.net/yanyan19880509/article/details/52562039 å‚è€ƒèµ„æ–™https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/BlockingQueue.html http://tutorials.jenkov.com/java-concurrency/index.html https://www.baeldung.com/java-blocking-queue https://blog.csdn.net/tonywu1992/article/details/83419448","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹ä¸­æ–­æœºåˆ¶","date":"2021-08-03T07:56:37.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹ä¸­æ–­æœºåˆ¶/","text":"ä¸­æ–­æœºåˆ¶Javaè¯­è¨€æä¾›ä¸€ç§æœºåˆ¶æ¥è¯•å›¾â€œç»ˆæ­¢â€ä¸€äº›ç‰¹æ®Šçš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä¸€ä¸‹ç©ºè½¬çš„çº¿ç¨‹ä¸€ç›´æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå¯ä»¥ä½¿ç”¨ä¸­æ–­çš„æ–¹å¼æ¥åœæ­¢è¿™ä¸€ç±»çš„çº¿ç¨‹ï¼Œè¿™å°±æ˜¯Javaä¸­æ–­æœºåˆ¶ã€‚ 1ã€ä¸­æ–­æ³¨æ„çš„åœ°æ–¹1ã€Javaä¸­çº¿ç¨‹é—´æ˜¯åä½œå¼ï¼Œè€ŒéæŠ¢å å¼. è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹çš„interrupt() æ–¹æ³•ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸æ˜¯å¼ºè¡Œå…³é—­è¿™ä¸ªçº¿ç¨‹ï¼Œåªæ˜¯è·Ÿè¿™ä¸ªçº¿ç¨‹æ‰“ä¸ªæ‹›å‘¼ï¼Œå°†çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ç½®ä¸ºtrueï¼Œçº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œç”±çº¿ç¨‹æœ¬èº«å†³å®šã€‚ 2ã€isInterrupted() åˆ¤å®šå½“å‰çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ã€‚ 3ã€é™æ€æ–¹æ³• interrupted() åˆ¤å®šå½“å‰çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ï¼ŒåŒæ—¶ä¸­æ–­æ ‡å¿—ä½æ”¹ä¸º falseã€‚ 4ã€å¦‚æœæ–¹æ³•é‡Œå¦‚æœæŠ›å‡ºä¸­æ–­å¼‚å¸¸ InterruptedExceptionï¼Œåˆ™çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¼šè¢«å¤ä½æˆfalseï¼Œå¦‚æœç¡®å®æ˜¯éœ€è¦ä¸­æ–­çº¿ç¨‹ï¼Œè¦æ±‚æˆ‘ä»¬è‡ªå·±åœ¨catchè¯­å¥å—é‡Œå†æ¬¡è°ƒç”¨interrupt()ã€‚ 5ã€Java ä¸­æ‰€æœ‰çš„é˜»å¡æ–¹æ³•éƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œæ¯”å¦‚wait(), join(),sleep()ã€‚ 2ã€Javaä¸­æ–­æä¾›çš„æ–¹æ³•åœ¨Javaä¸­æä¾›äº†3ä¸ªæœ‰å…³ä¸­æ–­çš„æ–¹æ³•ï¼š Thread.currentThread().isInterrupted() åˆ¤æ–­å½“å‰çš„çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ thread.interrupt(); ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹ï¼Œå°†ä¸­æ–­æ ‡å¿—è®¾ç½®æˆtrue 1234567891011121314public void interrupt() &#123; if (this != Thread.currentThread()) checkAccess(); synchronized (blockerLock) &#123; Interruptible b = blocker; if (b != null) &#123; interrupt0(); // Just to set the interrupt flag b.interrupt(this); return; &#125; &#125; interrupt0();&#125; Thread.interrupted()123public static boolean interrupted() &#123; return currentThread().isInterrupted(true);&#125; åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¹¶æ¸…é™¤ä¸­æ–­æ ‡å¿—ï¼Œæ”¹æˆfalseï¼› éªŒè¯ä¸€ä¸‹å°±å¯ä»¥äº† ğŸ‘‡ 12345678public static void main(String[] args) &#123; System.err.println(Thread.currentThread().isInterrupted()); Thread.currentThread().interrupt(); System.err.println(Thread.currentThread().isInterrupted()); boolean interrupted = Thread.interrupted(); System.err.println(&quot;interrupted &quot; + interrupted); System.err.println(Thread.currentThread().isInterrupted());&#125; 3ã€ä¸­æ–­ä¾‹å­1234567891011121314151617181920212223242526272829public class InterrupterDemo &#123; public static void main(String[] args) throws InterruptedException &#123; Thread thread = new Thread(() -&gt; &#123; while (true &amp;&amp; !Thread.currentThread().isInterrupted())&#123; System.err.println(1); System.err.println(Thread.interrupted()); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; System.err.println(&quot;after sleep &quot;+ Thread.currentThread().isInterrupted()); Thread.currentThread().interrupt(); boolean interrupted = Thread.interrupted(); System.err.println(&quot;interrupted &quot;+ Thread.currentThread().isInterrupted() + &quot;/ &quot; + interrupted); Thread.currentThread().interrupt(); System.err.println(&quot;final sleep &quot;+ Thread.currentThread().isInterrupted()); break; &#125; System.err.println(2); &#125; &#125;); thread.start(); Thread.sleep(3000); thread.interrupt(); &#125;&#125; æ³¨æ„ï¼Œä¸­æ–­ä¸€åœºä¸è¦ã€ åæ‰ ã€‘ï¼Œè¦ä¸åœ¨ç¨‹åºä¸­ç›¸åº”ä¸­æ–­ä¸€åœºï¼Œè¿›è¡Œç›¸åº”çš„é€»è¾‘å¤„ç†ï¼Œæˆ–è€…å°†ä¸€åœºç»§ç»­å‘ä¸ŠæŠ›ï¼Œç”±ä¸Šå±‚å¤„ç†ã€‚ å‚è€ƒèµ„æ–™https://dayarch.top/p/java-concurrency-interrupt-mechnism.html","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹Conditionæœºåˆ¶åº•å±‚","date":"2021-08-03T04:00:16.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹Conditionæœºåˆ¶åº•å±‚/","text":"Lockæ¡†æ¶ä¸­çš„Conditionæœºåˆ¶è¿˜æ˜¯çœ‹ä¸€ä¸‹ä¹‹å‰ReentrantLockä¸­è°ƒç”¨conditionæ–¹æ³•çš„æµç¨‹å›¾ ğŸ‘‡ ä»»ä½•ä¸€ä¸ªjavaå¯¹è±¡éƒ½å¤©ç„¶ç»§æ‰¿äºObjectç±»ï¼Œåœ¨çº¿ç¨‹é—´å®ç°é€šä¿¡çš„å¾€å¾€ä¼šåº”ç”¨åˆ°Objectçš„å‡ ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚wait(),wait(long timeout),wait(long timeout, int nanos)ä¸notify(),notifyAll()å‡ ä¸ªæ–¹æ³•å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼ŒåŒæ ·çš„ï¼Œ åœ¨java Lockä½“ç³»ä¸‹ä¾ç„¶ä¼šæœ‰åŒæ ·çš„æ–¹æ³•å®ç°ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚ ä»æ•´ä½“ä¸Šæ¥çœ‹Objectçš„waitå’Œnotify/notifyæ˜¯ä¸å¯¹è±¡ç›‘è§†å™¨é…åˆå®Œæˆçº¿ç¨‹é—´çš„ç­‰å¾…/é€šçŸ¥æœºåˆ¶ï¼Œè€ŒConditionä¸Locké…åˆå®Œæˆç­‰å¾…é€šçŸ¥æœºåˆ¶ï¼Œå‰è€…æ˜¯javaåº•å±‚çº§åˆ«çš„ï¼Œåè€…æ˜¯è¯­è¨€çº§åˆ«çš„ï¼Œå…·æœ‰æ›´é«˜çš„å¯æ§åˆ¶æ€§å’Œæ‰©å±•æ€§ã€‚ä¸¤è€…é™¤äº†åœ¨ä½¿ç”¨æ–¹å¼ä¸Šä¸åŒå¤–ï¼Œåœ¨åŠŸèƒ½ç‰¹æ€§ä¸Šè¿˜æ˜¯æœ‰å¾ˆå¤šçš„ä¸åŒï¼š Conditionèƒ½å¤Ÿæ”¯æŒä¸å“åº”ä¸­æ–­ï¼Œè€Œé€šè¿‡ä½¿ç”¨Objectæ–¹å¼ä¸æ”¯æŒï¼› Conditionèƒ½å¤Ÿæ”¯æŒå¤šä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆnew å¤šä¸ªConditionå¯¹è±¡ï¼‰ï¼Œè€ŒObjectæ–¹å¼åªèƒ½æ”¯æŒä¸€ä¸ªï¼› Conditionèƒ½å¤Ÿæ”¯æŒè¶…æ—¶æ—¶é—´çš„è®¾ç½®ï¼Œè€ŒObjectä¸æ”¯æŒ 1. Conditionæ¥å£æä¾›çš„æ–¹æ³•1.1 awaitæ–¹æ³•void await() throws InterruptedException å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹è°ƒç”¨conditionçš„signalæˆ–è€…signalAllæ–¹æ³•å¹¶ä¸”å½“å‰çº¿ç¨‹è·å–Lockä»awaitæ–¹æ³•è¿”å›ï¼Œå¦‚æœåœ¨ç­‰å¾…çŠ¶æ€ä¸­è¢«ä¸­æ–­ä¼šæŠ›å‡ºè¢«ä¸­æ–­å¼‚å¸¸ï¼› long awaitNanos(long nanosTimeout) å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°è¢«é€šçŸ¥ï¼Œä¸­æ–­æˆ–è€…è¶…æ—¶ï¼› boolean await(long time, TimeUnit unit)throws InterruptedException åŒç¬¬äºŒç§ï¼Œæ”¯æŒè‡ªå®šä¹‰æ—¶é—´å•ä½ boolean awaitUntil(Date deadline) throws InterruptedException å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°è¢«é€šçŸ¥ï¼Œä¸­æ–­æˆ–è€…åˆ°äº†æŸä¸ªæ—¶é—´ 1.2 signalæ–¹æ³•void signal() å”¤é†’ä¸€ä¸ªç­‰å¾…åœ¨conditionä¸Šçš„çº¿ç¨‹ï¼Œå°†è¯¥çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èƒ½å¤Ÿç«äº‰åˆ°Lockåˆ™å¯ä»¥ä»ç­‰å¾…æ–¹æ³•ä¸­è¿”å›ã€‚ void signalAll() ä¸1çš„åŒºåˆ«åœ¨äºèƒ½å¤Ÿå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨conditionä¸Šçš„çº¿ç¨‹ã€‚ 2. Conditionåœ¨ReentrantLockä¸­çš„ä½¿ç”¨ä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªä¾‹å­çœ‹ä¸€ä¸‹Conditionçš„ä½¿ç”¨ ğŸ‘‡ 1ã€å¤§è‡´æµç¨‹å°±æ˜¯çº¿ç¨‹1å…ˆè·å–lockä¹‹åï¼Œæ‰§è¡Œçº¿ç¨‹1çš„æ–¹æ³•ï¼Œç„¶åè°ƒç”¨condition.await();æ–¹æ³•é˜»å¡å½“å‰çº¿ç¨‹ï¼›åŒæ—¶åŠ å…¥Conditionç­‰å¾…é˜Ÿåˆ— 2ã€çº¿ç¨‹1é‡Šæ”¾lockä¹‹åï¼Œçº¿ç¨‹2è€Œå·²ç»åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­äº†ï¼Œçº¿ç¨‹2è·å–lockæ‰§è¡Œæƒï¼Œæ‰§è¡Œcondition.signal()æ–¹æ³•å”¤é†’çº¿ç¨‹1 3ã€çº¿ç¨‹1è¢«å”¤é†’ä¹‹åï¼ŒnodeèŠ‚ç‚¹é‡æ–°æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è·å–æ‰§è¡Œæƒé™ï¼Œåœ¨çº¿ç¨‹2è°ƒç”¨äº†unlock()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹1é‡æ–°è·å–åˆ°lockä¹‹åï¼Œæ‰§è¡Œåç»­æµç¨‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536public class ReentrantLockDemo &#123; static Lock lock = new ReentrantLock(); public static void main(String[] args) &#123; Condition condition = lock.newCondition(); new Thread(()-&gt;&#123; System.err.println(&quot;enter thread 1 &quot;); lock.lock(); try &#123; try &#123; System.err.println(&quot;thread 1 invoke await&quot;); condition.await(); System.err.println(&quot;thread 1 invoked signal&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.err.println(&quot;exit thread 1 &quot;); &#125;finally &#123; lock.unlock(); &#125; &#125;).start(); new Thread(()-&gt;&#123; System.err.println(&quot;enter thread 2 &quot;); lock.lock(); try &#123; System.err.println(&quot;thread 2 invoke signal&quot;); condition.signal(); System.err.println(&quot;exit thread 2 &quot;); &#125;finally &#123; lock.unlock(); &#125; &#125;).start(); &#125;&#125; ä¸Šé¢ä»£ç çš„æ‰§è¡Œç»“æœå¯ä»¥çŒœæƒ³ä¸€ä¸‹ 1234567enter thread 1 thread 1 invoke awaitenter thread 2 thread 2 invoke signalexit thread 2 thread 1 invoked signalexit thread 1 3. Conditionç­‰å¾…/é€šçŸ¥å®ç°åŸç†è¦æƒ³èƒ½å¤Ÿæ·±å…¥çš„æŒæ¡conditionè¿˜æ˜¯åº”è¯¥çŸ¥é“å®ƒçš„å®ç°åŸç†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹condiitonçš„æºç ã€‚åˆ›å»ºä¸€ä¸ªconditionå¯¹è±¡æ˜¯é€šè¿‡lock.newCondition(),è€Œè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯ä¼šnewå‡ºä¸€ä¸ªConditionObjectå¯¹è±¡ï¼Œè¯¥ç±»æ˜¯AQSçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå’ŒNodeç±»ä¸€æ ·ï¼Œéå¸¸é‡è¦ã€‚ conditionæ˜¯è¦å’Œlocké…åˆä½¿ç”¨çš„ä¹Ÿå°±æ˜¯conditionå’ŒLockæ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œè€Œlockçš„å®ç°åŸç†åˆä¾èµ–äºAQSï¼Œè‡ªç„¶è€Œç„¶ConditionObjectä½œä¸ºAQSçš„ä¸€ä¸ªå†…éƒ¨ç±»æ— å¯åšéã€‚ æˆ‘ä»¬çŸ¥é“åœ¨é”æœºåˆ¶çš„å®ç°ä¸Šï¼ŒAQSå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯ç‹¬å å¼é”çš„è¯ï¼Œæ‰€æœ‰è·å–é”å¤±è´¥çš„çº¿ç¨‹çš„å°¾æ’å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ ·çš„ï¼Œconditionå†…éƒ¨ä¹Ÿæ˜¯ä½¿ç”¨åŒæ ·çš„æ–¹å¼ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª ç­‰å¾…é˜Ÿåˆ—ï¼Œæ‰€æœ‰è°ƒç”¨condition.awaitæ–¹æ³•çš„çº¿ç¨‹ä¼šåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”çº¿ç¨‹çŠ¶æ€è½¬æ¢ä¸ºç­‰å¾…çŠ¶æ€ã€‚ å¦å¤–æ³¨æ„åˆ°ConditionObjectä¸­æœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡ï¼š private transient Node firstWaiter; private transient Node lastWaiter; åœ¨AQSä¸­conditioné˜Ÿåˆ—å¯ä»¥å­˜åœ¨å¤šä¸ªå¦‚ä¸‹æ‰€ç¤ºï¼Œä½†æ˜¯åŒæ­¥é˜Ÿåˆ—ä¹‹å¯èƒ½æ˜¯ä¸€ä¸ªï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨é˜Ÿåˆ—ï¼Œè€Œç­‰å¾…é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå•å‘çš„é˜Ÿåˆ—ã€‚ ä¸‹é¢ä»awaitæ–¹æ³•å…¥æ‰‹æ¥å­¦ä¹ Conditionçš„æœºåˆ¶æ˜¯å¦‚ä½•è¿è½¬çš„ã€‚ 3.1 ç­‰å¾…awaitpublic class ConditionObject implements Condition AQS#ConditionObjectå†…éƒ¨ç±»å®ç°äº†Conditionæ¥å£çš„awaitæ–¹æ³•ï¼š 1234567891011121314151617181920212223242526public final void await() throws InterruptedException &#123; // åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­ if (Thread.interrupted()) throw new InterruptedException(); // å°†èŠ‚ç‚¹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ— Node node = addConditionWaiter(); // è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹éœ€è¦é‡Šæ”¾lockè®©ç»™åˆ«çš„çº¿ç¨‹ int savedState = fullyRelease(node); int interruptMode = 0; // å¦‚æœèŠ‚ç‚¹ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ï¼Œåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼ŒçŸ¥é“è¿›å…¥åŒæ­¥é˜Ÿåˆ—æˆ–è€…è¢«ä¸­æ–­ while (!isOnSyncQueue(node)) &#123; LockSupport.park(this); if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; // è°ƒç”¨awaitçš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨ä¸Šé¢çš„whileå¾ªç¯ï¼ŒçŸ¥é“è¢«å”¤é†’æˆ–è€…ç›¸åº”ä¸­æ–­ï¼Œæ‰ä¼šæ‰§è¡Œä¸‹é¢çš„æ–¹æ³• // è¿›å…¥åŒæ­¥é˜Ÿåˆ—å°è¯•è·å–lockï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œä¸ºäº†é™åˆ¶ä¸€ç›´ç©ºè½¬ï¼Œä¼šåœ¨ç¬¬äºŒæ¬¡å¾ªç¯ä¹‹åï¼Œparkæ­¤èŠ‚ç‚¹ï¼ŒçŸ¥é“é˜Ÿåˆ—ä¸­è½®åˆ°è¿™ä¸ªçº¿ç¨‹å‡ºé˜Ÿ if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; if (node.nextWaiter != null) // clean up if cancelled // æ¸…é™¤æ‰å–æ¶ˆçš„èŠ‚ç‚¹ï¼Œè¸¢å‡ºç­‰å¾…é˜Ÿåˆ— unlinkCancelledWaiters(); //å¤„ç†è¢«ä¸­æ–­çš„æƒ…å†µ if (interruptMode != 0) reportInterruptAfterWait(interruptMode);&#125; AQS#addConditionWaiter æ·»åŠ èŠ‚ç‚¹åˆ°ç­‰å¾…é˜Ÿåˆ— 123456789101112131415private Node addConditionWaiter() &#123; Node t = lastWaiter; // If lastWaiter is cancelled, clean out. if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; unlinkCancelledWaiters(); t = lastWaiter; &#125; Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node;&#125; è¿™ä¸ªæ–¹æ³•åº”è¯¥æ¯”è¾ƒå¥½ç†è§£å§ï¼Œå°±æ˜¯æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ°ç­‰å¾…é˜Ÿåˆ—ã€‚ âš ï¸ è¿™é‡Œå’ŒæŠŠèŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—è¿˜æœ‰ç‚¹åŒºåˆ«ï¼Œä¸çŸ¥é“å¤§å®¶è¿˜æœ‰æ²¡æœ‰å°è±¡ï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—æ·»åŠ èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­tailæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸æ˜¯ç©ºï¼Œåˆ™ç›´æ¥æ·»åŠ ï¼›å¦‚æœæ˜¯ç©ºï¼Œåˆ™è°ƒç”¨äº†enq(Node node)æ–¹æ³•ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªheadèŠ‚ç‚¹ï¼Œç„¶ååœ¨æŠŠå½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°åé¢ï¼Œå¾ªç¯äº†ä¸¤éçš„ã€‚ è¿™é‡Œæ˜¯ç›´æ¥åˆ›å»ºå½“å‰èŠ‚ç‚¹ï¼Œç„¶åå°†firstWaiteræŒ‡é’ˆæŒ‡å‘äº†nodeï¼› AQS#fullyRelease é‡Šæ”¾lock 123456789101112131415final int fullyRelease(Node node) &#123; boolean failed = true; try &#123; int savedState = getState(); if (release(savedState)) &#123; failed = false; return savedState; &#125; else &#123; throw new IllegalMonitorStateException(); &#125; &#125; finally &#123; if (failed) node.waitStatus = Node.CANCELLED; &#125;&#125; è¿™ä¸ªæ–¹æ³•ä¹Ÿä¸éš¾ï¼Œæƒ³ä¸€ä¸‹ï¼Œçº¿ç¨‹éƒ½å·²ç»è°ƒç”¨awaitæ–¹æ³•äº†ï¼Œè€Œä¸”ä¸Šä¸€æ­¥å°±å·²ç»æŠŠèŠ‚ç‚¹æ·»åŠ åˆ°äº†ç­‰å¾…é˜Ÿåˆ—ä¸­äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦åšä»€ä¹ˆå‘¢ï¼Ÿé‚£è‚¯å®šæ˜¯é‡Šæ”¾é”lockäº†ã€‚å¯¹ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åšè¿™ä¸ªçš„ã€‚releaseæ–¹æ³•ä¹‹å‰å·²ç»ä»‹ç»äº†ï¼Œæ— éå°±æ˜¯å¯¹stateåšä¸€ä¸‹å‡æ³•ï¼ŒæŠŠå¯¹æˆ˜çº¿ç¨‹æ¸…ç©ºä¸€ä¸‹ï¼Œç»™æ–°æ¥çš„çº¿ç¨‹è…¾åœ°æ–¹ã€‚ ä¸‹é¢æ‰æ˜¯awaitçš„å…³é”®æ ¸å¿ƒä»£ç ï¼šâ€¼ï¸ 12345while (!isOnSyncQueue(node)) &#123; LockSupport.park(this); if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; isOnSyncQueue(node)åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¸ªåˆ¤æ–­å‘¢ï¼ŸåŸå› å¾ˆç®€å•ï¼Œå½“åˆ«çš„çº¿ç¨‹æˆ–è€…è‡ªå·±è°ƒç”¨äº†signalæ–¹æ³•ä¹‹åï¼Œä¼šæŠŠå½“å‰èŠ‚ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è¯´æ˜ä»€ä¹ˆå‘¢ï¼Œè¯´æ˜æ¥ä¸‹æ¥è¿™ä¸ªçº¿ç¨‹è¦å»ç«äº‰é”äº†ï¼Œä¹Ÿå°±æ˜¯è¢«å”¤é†’äº†ï¼Œå½“ç«äº‰é”æˆåŠŸä¹‹åï¼Œè¿™ä¸ªçº¿ç¨‹å°±å¯ä»¥awaitåé¢çš„æ–¹æ³•äº†ã€‚ (interruptMode = checkInterruptWhileWaiting(node)) != 0 å¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ï¼Œåˆ™å¯ä»¥ç›´æ¥è·³å‡ºå¾ªç¯ï¼Œå»ç«äº‰é”ã€‚ 3.2 é€šçŸ¥signalè°ƒç”¨conditionçš„signalæˆ–è€…signalAllæ–¹æ³•å¯ä»¥å°†ç­‰å¾…é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä½¿å¾—è¯¥èŠ‚ç‚¹èƒ½å¤Ÿæœ‰æœºä¼šè·å¾—lockã€‚æŒ‰ç…§ç­‰å¾…é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„ï¼Œæ‰€ä»¥ç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹å¿…ç„¶ä¼šæ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡è°ƒç”¨conditionçš„signalæ–¹æ³•æ˜¯å°†å¤´èŠ‚ç‚¹ç§»åŠ¨åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚signalæ–¹æ³•æºç ä¸ºï¼š 123456789public final void signal() &#123; //1. å…ˆæ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»è·å–lockï¼Œå¦‚æœæ²¡æœ‰è·å¾—é”ï¼Œè‚¯å®šæ˜¯è¯´ä¸é€šçš„ if (!isHeldExclusively()) throw new IllegalMonitorStateException(); //2. è·å–ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹‹åçš„æ“ä½œéƒ½æ˜¯é’ˆå¯¹è¿™ä¸ªèŠ‚ç‚¹ Node first = firstWaiter; if (first != null) doSignal(first);&#125; signalæ–¹æ³•é¦–å…ˆä¼šæ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»è·å–lockï¼Œå¦‚æœæ²¡æœ‰è·å–lockä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœè·å–çš„è¯å†å¾—åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å¤´æŒ‡é’ˆå¼•ç”¨çš„èŠ‚ç‚¹ï¼Œä¹‹åçš„æ“ä½œçš„doSignalæ–¹æ³•ä¹Ÿæ˜¯åŸºäºè¯¥èŠ‚ç‚¹ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹doSignalæ–¹æ³•åšäº†äº›ä»€ä¹ˆäº‹æƒ…ã€‚ AQS#doSignal 12345678910private void doSignal(Node first) &#123; do &#123; if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; //1. å°†å¤´ç»“ç‚¹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ first.nextWaiter = null; //2. whileä¸­transferForSignalæ–¹æ³•å¯¹å¤´ç»“ç‚¹åšçœŸæ­£çš„å¤„ç† &#125; while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null);&#125; å…·ä½“é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼ŒçœŸæ­£å¯¹å¤´èŠ‚ç‚¹åšå¤„ç†çš„é€»è¾‘åœ¨transferForSignalæ”¾ï¼Œè¯¥æ–¹æ³•æºç ä¸ºï¼š 12345678910111213141516171819202122final boolean transferForSignal(Node node) &#123; /* * If cannot change waitStatus, the node has been cancelled. */ //1. æ›´æ–°çŠ¶æ€ä¸º0ï¼ŒåŠ å…¥åŒæ­¥é˜Ÿåˆ—çš„èŠ‚ç‚¹çš„åˆå§‹çŠ¶æ€æ˜¯0 if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; /* * Splice onto queue and try to set waitStatus of predecessor to * indicate that thread is (probably) waiting. If cancelled or * attempt to set waitStatus fails, wake up to resync (in which * case the waitStatus can be transiently and harmlessly wrong). */ //2.å°†è¯¥èŠ‚ç‚¹ç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å» Node p = enq(node); int ws = p.waitStatus; // pèŠ‚ç‚¹æ˜¯nodeçš„å‰ç½®èŠ‚ç‚¹ï¼Œéœ€è¦å°†å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®æˆNode.SIGNAL if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) LockSupport.unpark(node.thread); return true;&#125; å…³é”®é€»è¾‘è¯·çœ‹æ³¨é‡Šï¼Œè¿™æ®µä»£ç ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ… 1.å°†å¤´ç»“ç‚¹çš„çŠ¶æ€æ›´æ”¹ä¸ºCONDITIONï¼› 2.è°ƒç”¨enqæ–¹æ³•ï¼Œå°†è¯¥èŠ‚ç‚¹å°¾æ’å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”æŠŠå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®æˆNode.SIGNAL ç°åœ¨æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šè°ƒç”¨conditionçš„signalçš„å‰ææ¡ä»¶æ˜¯å½“å‰çº¿ç¨‹å·²ç»è·å–äº†lockï¼Œè¯¥æ–¹æ³•ä¼šä½¿å¾—ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¤´èŠ‚ç‚¹å³ç­‰å¾…æ—¶é—´æœ€é•¿çš„é‚£ä¸ªèŠ‚ç‚¹ç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè€Œç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—åæ‰æœ‰æœºä¼šä½¿å¾—ç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ï¼Œå³ä»awaitæ–¹æ³•ä¸­çš„LockSupport.park(this)æ–¹æ³•ä¸­è¿”å›ï¼Œä»è€Œæ‰æœ‰æœºä¼šä½¿å¾—è°ƒç”¨awaitæ–¹æ³•çš„çº¿ç¨‹æˆåŠŸé€€å‡ºã€‚ signalAllæ–¹æ³•é€šçŸ¥æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ sigllAllä¸sigalæ–¹æ³•çš„åŒºåˆ«ä½“ç°åœ¨doSignalAllæ–¹æ³•ä¸Šï¼Œå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“doSignalæ–¹æ³•åªä¼šå¯¹ç­‰å¾…é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹è¿›è¡Œæ“ä½œï¼Œè€ŒdoSignalAllçš„æºç ä¸ºï¼š 123456789private void doSignalAll(Node first) &#123; lastWaiter = firstWaiter = null; do &#123; Node next = first.nextWaiter; first.nextWaiter = null; transferForSignal(first); first = next; &#125; while (first != null);&#125; è¯¥æ–¹æ³•åªä¸è¿‡æ—¶é—´ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç§»å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå³â€œé€šçŸ¥â€å½“å‰è°ƒç”¨condition.await()æ–¹æ³•çš„æ¯ä¸€ä¸ªçº¿ç¨‹ã€‚ é¢è¯•é¢˜ ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿é¡ºåºæ‰“å°1ï½10012345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.ibli.note;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;public class WaitNotifyDemo implements Runnable &#123; int count = 1; private Condition condition; private Lock lock; public WaitNotifyDemo(Condition condition, Lock lock) &#123; this.condition = condition; this.lock = lock; &#125; @Override public void run() &#123; while (true) &#123; lock.lock(); try &#123; condition.signal(); if (count &gt; 100) &#123; break; &#125; System.err.println(Thread.currentThread().getName() + &quot; =&gt; &quot; + count); count++; try &#123; condition.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;finally &#123; lock.unlock(); &#125; &#125; &#125; public static void main(String[] args) &#123; Lock lock = new ReentrantLock(); Condition condition = lock.newCondition(); WaitNotifyDemo waitNotifyDemo = new WaitNotifyDemo(condition, lock); new Thread(waitNotifyDemo).start(); new Thread(waitNotifyDemo).start(); &#125;&#125; å‚è€ƒèµ„æ–™https://juejin.cn/post/6844903602419400718 https://juejin.cn/post/6844903654873382925","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹æ·±å…¥ç†è§£ReentrantLock","date":"2021-08-02T08:00:33.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹æ·±å…¥ç†è§£ReetrantLock/","text":"ReentrantLockReentrantLocké‡å…¥é”ï¼Œæ˜¯å®ç°Lockæ¥å£çš„ä¸€ä¸ªç±»ï¼Œä¹Ÿæ˜¯åœ¨å®é™…ç¼–ç¨‹ä¸­ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„ä¸€ä¸ªé”ï¼Œæ”¯æŒé‡å…¥æ€§ï¼Œè¡¨ç¤ºèƒ½å¤Ÿå¯¹å…±äº«èµ„æºèƒ½å¤Ÿé‡å¤åŠ é”ï¼Œå³å½“å‰çº¿ç¨‹è·å–è¯¥é”å†æ¬¡è·å–ä¸ä¼šè¢«é˜»å¡ åŠ é”æ“ä½œæ”¯æŒé‡å…¥æ€§ï¼Œè¡¨ç¤ºèƒ½å¤Ÿå¯¹å…±äº«èµ„æºèƒ½å¤Ÿé‡å¤åŠ é”ï¼Œå³å½“å‰çº¿ç¨‹è·å–è¯¥é”å†æ¬¡è·å–ä¸ä¼šè¢«é˜»å¡ ä¸‹é¢ä»¥éå…¬å¹³é”çš„lockæ–¹æ³•ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹ReentrantLockæºç çš„å®ç° ğŸ‘‡ é¦–å…ˆæ˜¯lockæ–¹æ³•1ã€è¿›å…¥lockæ–¹æ³•é¦–å…ˆå¯¹è°ƒç”¨compareAndSetState(0,1)å»å°è¯•è·å–é”ï¼Œè¿™ä¸€ç‚¹æ­£æ˜¯ä½“ç°äº†éå…¬å¹³é” 2ã€å¦‚æœç¬¬ä¸€æ­¥æ²¡æœ‰è·å–åˆ°é”ï¼Œç„¶åæ‰§è¡Œç¬¬äºŒæ­¥acquire(1) 1234567final void lock() &#123; // éå…¬å¹³é” if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; lockæ–¹æ³•é¦–å…ˆä¼šå»casä¿®æ”¹AQSçš„stateçŠ¶æ€ï¼Œç‹¬å é”æ¨¡å¼ä¸‹stateå¢åŠ 1è¡¨ç¤ºè·å–é”æˆåŠŸï¼›stateè®¾ç½®æˆåŠŸä¹‹åï¼Œéœ€è¦å°†ç‹¬å çº¿ç¨‹å­—æ®µè®¾ç½®æˆå½“å‰çº¿ç¨‹ï¼šexclusiveOwnerThread = thread; AQS#acquire(1)å¦‚æœæ²¡æœ‰æŠ¢å åˆ°é”ï¼Œé‚£ä¹ˆæ‰§è¡Œä¸‹é¢çš„acquireæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åœ¨AQSç±»ä¸­ 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt();&#125; tryAcquireæ–¹æ³•æ˜¯åœ¨å­ç±»å®ç°çš„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ReentrantLockçš„nonfairTryAcquireï¼Œä¹Ÿå°±æ˜¯éå…¬å¹³é”çš„å®ç°ã€‚ nonfairTryAcquire(int acquires)æ–¹æ³•ä¸‹é¢æ˜¯ReentrantLockï¼Œéå…¬å¹³é”çš„lockå®ç°ä»£ç ï¼š 1234567891011121314151617181920final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); // è·å–é” if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; // é”å†²å…¥ else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125; int c = getState() == 0 åˆ™è¡¨ç¤ºæ²¡æœ‰çº¿ç¨‹å æœ‰é”ï¼Œå½“å‰çº¿ç¨‹æ¥åŠ é”æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨caså°è¯•è·å–é”ã€‚ current == getExclusiveOwnerThread() è¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æŒæœ‰çº¿ç¨‹é”äº†ï¼Œ int nextc = c + acquires;åˆ™è¡¨ç¤ºæ”¯æŒé”é‡å…¥ï¼Œnextcçš„å€¼åˆ™è¡¨ç¤ºé”é‡å…¥çš„æ¬¡æ•°ï¼› ä»¥ä¸Šå¦‚æœæ²¡æœ‰åŠ é”æˆåŠŸï¼Œåˆ™è¿”å›falseï¼Œç„¶åæ‰§è¡ŒAQSçš„acquireQueueæ–¹æ³•ï¼Œé¦–å…ˆå°†å½“å‰èŠ‚ç‚¹å°è£…æˆaddWaiter(Node.EXCLUSIVE), arg) æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ï¼ŒåŒæ—¶åˆ¤æ–­å¤´èŠ‚ç‚¹æ˜¯å¦è·å–é”æˆåŠŸï¼Œå¦‚æœæˆåŠŸäº†ï¼Œå°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°å¤´ä¸Šï¼› AQS#addWaiter(Node mode)æ·»åŠ èŠ‚ç‚¹åˆ°é˜Ÿåˆ—ä¸­ï¼ŒNode.EXCLUSIVEç‹¬å é”ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯å°¾æ’æ³•ï¼Œåœ¨é˜Ÿåˆ—çš„é˜Ÿå°¾æ·»åŠ æ–°çš„èŠ‚ç‚¹ã€‚ 12345678910111213141516private Node addWaiter(Node mode) &#123; Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; // å¦‚æœé˜Ÿåˆ—ä¸æ˜¯ç©ºçš„ï¼Œåˆ™ç›´æ¥æ·»åŠ åˆ°é˜Ÿå°¾ if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; // å¦‚æœæ˜¯ç©ºçš„ï¼Œåˆ™è°ƒç”¨enqæ–¹æ³•ï¼Œåˆ›å»ºé˜Ÿåˆ—ï¼Œå¹¶æ·»åŠ åˆ°é˜Ÿå°¾ enq(node); return node;&#125; AQS#enq(final Node node)ç¬¬ä¸€ä¸ªçº¿ç¨‹è·å–é”çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æ— é”çš„çŠ¶æ€ï¼Œæ ¹æœ¬èµ°ä¸åˆ°è¿™ä¸€æ­¥ï¼Œæœ€æ—©èµ°åˆ°è¿™é‡Œçš„æ˜¯ç¬¬äºŒä¸ªå»è·å–é”çš„çº¿ç¨‹ã€‚ å½“ç¬¬äºŒä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¯¥æ–¹æ³•æ˜¯éœ€è¦æ‰§è¡Œä¸¤æ¬¡å¾ªç¯ï¼š 1ã€t == nullæ—¶ï¼Œéœ€è¦åˆå§‹åŒ–é˜Ÿåˆ— 2ã€æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œå°†nodeæ·»åŠ åˆ°tail,ç”±äºè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯å¤„åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„ï¼Œæ‰€ä»¥ï¼Œè®¾ç½®é˜Ÿå°¾çš„æ—¶å€™è¿˜æ˜¯éœ€è¦casæ“ä½œã€‚ 123456789101112131415private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125;&#125; AQS#acquireQueued(final Node node, int arg)è¿™ä¸ªæ–¹æ³•ç»å¯¹æ˜¯ç»å¯¹çš„AQSæ ¸å¿ƒæ–¹æ³• â€¼ï¸ è¿™ä¸ªæ–¹æ³•ä¸»è¦æœ‰3ä¸ªé‡è¦æ“ä½œï¼š 1ã€åˆ¤æ–­å‰ç½®èŠ‚ç‚¹æ˜¯ä¸æ˜¯headï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå»å°è¯•è·å–é”ï¼› 2ã€å¦‚æœå‰ç½®èŠ‚ç‚¹ä¸æ˜¯headï¼Œè¦æŠŠå‰ç½®èŠ‚ç‚¹çš„waitStateè®¾ç½®æˆSIGNALï¼ŒåŒæ—¶parkå½“å‰çº¿ç¨‹ï¼Œé¿å…ä¸€ç›´ç©ºè½¬ï¼Œå› ä¸ºè¿™é‡Œæ˜¯ç”¨çš„ for (;;) {} 3ã€å¦‚æœè·å–é”å’Œparkéƒ½å¤±è´¥äº†ï¼Œåˆ™æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®æˆcancelçŠ¶æ€ã€‚ 123456789101112131415161718192021final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; AQS.cancelAcquire(Node node)è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒéš¾ç†è§£ï¼Œæ€»ç»“ä¸€ä¸‹å°±å¹²äº†ä¸‹é¢å‡ ä¸ªäº‹ï¼š 1ã€æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•çš„nodeè‚¯å®šæ˜¯è¦å–æ¶ˆçš„ï¼Œé‚£ä¸ªéœ€è¦threadè®¾ç½®æˆnull 2ã€æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ä¹‹å‰çš„èŠ‚ç‚¹æœ‰æ²¡æœ‰æ˜¯å–æ¶ˆçŠ¶æ€çš„ï¼Œä¸€èµ·è¸¢å‡ºé˜Ÿåˆ— 3ã€æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®æˆNode.CANCELLEDçŠ¶æ€ 4ã€åˆ¤æ–­nodeåœ¨é˜Ÿåˆ—ä¸­çš„ä½ç½®ï¼Œå¦‚æœæ˜¯é˜Ÿå°¾çš„è¯ï¼ŒæŠŠtailæŒ‡å‘nodeçš„å‰ç½®èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠå‰é©±èŠ‚ç‚¹çš„nextæŒ‡å‘null 5ã€å¦‚æœä¸æ˜¯tailèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåˆ¤æ–­æ˜¯ä¸æ˜¯headï¼Œå¦‚æœä¸æ˜¯headï¼Œé‚£ä¹ˆï¼Œå°†nodeçš„å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®æˆNode.SIGNALï¼Œå¹¶ä¸”æŠŠnodeçš„å‰é©±èŠ‚ç‚¹nodeçš„nextèŠ‚ç‚¹ 6ã€å¦‚æœnodeæ˜¯headèŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥unparkæ­¤çº¿ç¨‹å»æ‰§è¡Œacquire 12345678910111213141516171819202122232425262728293031323334353637383940414243444546private void cancelAcquire(Node node) &#123; // Ignore if node doesn&#x27;t exist if (node == null) return; node.thread = null; // Skip cancelled predecessors Node pred = node.prev; while (pred.waitStatus &gt; 0) //cancelled node.prev = pred = pred.prev; // predNext is the apparent node to unsplice. CASes below will // fail if not, in which case, we lost race vs another cancel // or signal, so no further action is necessary. Node predNext = pred.next; // Can use unconditional write instead of CAS here. // After this atomic step, other Nodes can skip past us. // Before, we are free of interference from other threads. node.waitStatus = Node.CANCELLED; // If we are the tail, remove ourselves. if (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123; compareAndSetNext(pred, predNext, null); &#125; else &#123; // If successor needs signal, try to set pred&#x27;s next-link // so it will get one. Otherwise wake it up to propagate. int ws; if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) &#123; // ifæ‰§è¡Œçš„é€»è¾‘æ˜¯æŠŠå‰ç½®èŠ‚ç‚¹è®¾ç½®æˆNode.SIGNAL Node next = node.next; if (next != null &amp;&amp; next.waitStatus &lt;= 0) // æŠŠnodeçš„å‰ç½®å‰ç½®èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘nodeçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› ä¸ºä¸Šé¢nodeå·²ç»æ˜¯Node.CANCELLEDçŠ¶æ€äº†ï¼Œéœ€è¦è¸¢å‡ºé˜Ÿåˆ— compareAndSetNext(pred, predNext, next); &#125; else &#123; // å‰ç½®èŠ‚ç‚¹æ˜¯headï¼Œæ­¤æ—¶æ²¡æœ‰è¢«äººç«äº‰é”èµ„æºï¼Œç›´æ¥å”¤é†’å½“å‰èŠ‚ç‚¹ unparkSuccessor(node); &#125; node.next = node; // help GC &#125; &#125; ä¸Šé¢æ˜¯ä»¥ReentrantLockçš„éå…¬å¹³é”ä¸ºä¾‹å­¦ä¹ äº†ä¸€ä¸‹ReentrantLockåŠ é”çš„è¿‡ç¨‹ã€‚é‚£ä¹ˆæ€è€ƒä¸€ä¸‹å…¬å¹³é”å’Œéå…¬å¹³é”çš„æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼ŸğŸ¤” ç†è§£äº†ä¸Šé¢çš„æµç¨‹ä¹‹åï¼Œä¸‹é¢ç›´æ¥æ¯”è¾ƒæºç éå¾ˆå¥½ç†è§£ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼ å…¬å¹³é”å’Œéå…¬å¹³é”å¦‚ä½•åˆ¶å®šReentarntLockçš„å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ 123public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync();&#125; ä¸Šé¢çœ‹äº†NonfairSync#lockçš„å®ç°ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹FairSync#lockçš„å®ç°ï¼šğŸ‘‡ 12345678910111213141516171819202122232425262728293031static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; final void lock() &#123; acquire(1); &#125; /** * Fair version of tryAcquire. Don&#x27;t grant access unless * recursive call or no waiters or is first. */ protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125;&#125; FairSyncå’ŒNonfairSyncéƒ½æ˜¯ReentrantLockçš„é™æ€å†…éƒ¨ç±»ï¼Œåœ¨FairSyncçš„lockæ–¹æ³•ä¸­ï¼Œæ²¡æœ‰ä¸‹é¢çš„ä»£ç ï¼š 12if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ç›´æ¥è°ƒç”¨AQS#acquire(1)æ–¹æ³•ï¼Œè€Œä¸”åœ¨ReentrantLock#FairSync#FairSync(int acquires)çš„å®ç°ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªåˆ¤æ–­ 12345if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; ä¹Ÿå°±æ˜¯hasQueuedPredecessorsæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰èŠ‚ç‚¹åœ¨ç­‰å¾…ï¼Œå¦‚æœæœ‰çš„è¯ï¼ŒReentrantLock#FairSync#FairSync(int acquires)ç›´æ¥è¿”å›falseï¼Œå½“å‰èŠ‚ç‚¹æ™ºèƒ½è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚è¿™ä¸¤ç‚¹å°±æ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”çš„æ˜æ˜¾åŒºåˆ«ä½“ç°ã€‚ é‡Šæ”¾é”æ“ä½œ unlock()123public void unlock() &#123; sync.release(1);&#125; AQS#release(int arg)123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; tryReleaseçš„å…·ä½“å®ç°ä»æ˜¯æœ‰å…·ä½“çš„å­ç±»æ¥å®ç°çš„ã€‚ ReentrantLock#tryRelease(int releases)æ–¹æ³•1ã€é‡Šæ”¾é”çš„é€»è¾‘åº”è¯¥æ¯”è¾ƒå¥½ç†è§£ï¼Œæ˜¯å°†stateåšå‡æ³•ã€‚ 2ã€åˆ¤æ–­state == 0 , åˆ™è¡¨ç¤ºæ— é”çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯0ï¼Œåˆ™è¡¨ç¤ºè¿˜åœ¨çº¿ç¨‹é‡å…¥çš„çŠ¶æ€ä¸‹ï¼ŒåŒæ—¶è®¾ç½®state 123456789101112protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œè®¾ç½®stateçš„æ—¶å€™æ˜¯ç›´æ¥èµ‹å€¼çš„ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨casï¼Œä¸ºä»€ä¹ˆï¼Ÿ 123protected final void setState(int newState) &#123; state = newState;&#125; å…¶å®è€ƒè™‘åˆ°ä¸Šä¸‹æ–‡å°±å¾ˆç®€å•äº†ï¼Œæ­¤æ—¶è®¾ç½®stateçš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§çŠ¶æ€ï¼Œæ— é”å’Œé‡å…¥é”ï¼Œè‚¯å®šä¸ä¼šæ˜¯å¤šçº¿ç¨‹çš„åœºæ™¯ã€‚æ‰€ä»¥ä¸éœ€è¦casæ“ä½œã€‚ æ¥ç€åˆ†æä¸Šé¢çš„AQS#releaseæ–¹æ³•: å½“stateè®¾ç½®æˆåŠŸä¹‹åï¼Œéœ€è¦åˆ¤æ–­headèŠ‚ç‚¹ï¼Œç„¶åå”¤é†’headçš„åé©±èŠ‚ç‚¹çš„çº¿ç¨‹ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚ 12345678910111213141516171819202122232425262728private void unparkSuccessor(Node node) &#123; /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; // if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ Node s = node.next; if (s == null || s.waitStatus &gt; 0) &#123; s = null; // è¿™é‡Œæ˜¯å…±äº«é”ï¼Œåœ¨ReentarntLockå…ˆè·³è¿‡ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; tryLock(long time, TimeUnit unit)æ–¹æ³•æè¿°å¦‚ä¸‹ï¼šåœ¨ç»™å®šçš„ç­‰å¾…æ—¶é—´å†…å¹¶ä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­ä»¥åŠé”å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå»è·å–é”ã€‚å¦‚æœé”å¯ç”¨ï¼Œæ–¹æ³•ä¼šç›´æ¥è¿”å›ã€‚å¦‚æœé”ä¸å¯ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹å°†ä¼šå¤„äºä¸å¯ç”¨çŠ¶æ€ä»¥è¾¾åˆ°çº¿ç¨‹è°ƒåº¦ç›®çš„ï¼Œå¹¶ä¸”ä¼‘çœ ç›´åˆ°ä¸‹é¢ä¸‰ä¸ªäº‹ä»¶ä¸­çš„ä¸€ä¸ªå‘ç”Ÿï¼šâ‘ ã€å½“å‰çº¿ç¨‹è·å–åˆ°é”â‘¡ã€å…¶ä»–çº¿ç¨‹ä¸­æ–­å½“å‰çº¿ç¨‹â‘¢ã€æŒ‡å®šçš„ç­‰å¾…æ—¶é—´å·²è¿‡å‡å¦‚å½“å‰çº¿ç¨‹ï¼šåœ¨è¯¥æ–¹æ³•çš„æ¡ç›®ä¸Šè®¾ç½®å…¶ä¸­æ–­çŠ¶æ€æˆ–åœ¨è·å–é”æ—¶ä¸­æ–­ï¼Œå¹¶ä¸”æ”¯æŒé”è·å–ä¸­æ–­æ—¶ï¼Œå°†æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼Œå½“å‰çº¿ç¨‹ä¸­æ–­çŠ¶æ€ä¼šè¢«æ¸…é™¤ã€‚å‡å¦‚ç»™å®šçš„ç­‰å¾…æ—¶é—´å·²è¿‡ï¼Œå°†ä¼šè¿”å›falseã€‚ ä¸‹é¢å…·ä½“é˜…è¯»æºç å®ç°,æ–¹æ³•çš„å…¥å‚æŒ‡å®šäº†ç­‰å¾…æ—¶é—´ï¼Œå’Œæ—¶é—´çš„å•ä½ï¼Œæœ‰NANOSECONDSã€MICROSECONDSã€MILLISECONDSã€SECONDSâ€¦ç­‰å•ä½ã€‚ ä¸‹é¢å…·ä½“é˜…è¯»æºç å®ç°,æ–¹æ³•çš„å…¥å‚æŒ‡å®šäº†ç­‰å¾…æ—¶é—´ï¼Œå’Œæ—¶é—´çš„å•ä½ï¼Œæœ‰NANOSECONDSã€MICROSECONDSã€MILLISECONDSã€SECONDSâ€¦ç­‰å•ä½ã€‚ 1234public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(timeout));&#125; æ–¹æ³•çš„å†…éƒ¨è°ƒç”¨äº†Syncçš„tryAcquireNanosï¼Œç»§ç»­å¾€ä¸‹ 123456789public final boolean tryAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; //åˆ¤æ–­ä¸­æ–­çŠ¶æ€å¹¶å†³å®šæ˜¯å¦æŠ›å‡ºä¸­æ–­å¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); //å°è¯•è·å–é”ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œå¤±è´¥åˆ™è°ƒç”¨doAcquireNanosè¿›è¡Œç­‰å¾… return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout);&#125; tryAcqureå’Œä¹‹å‰åˆ†æçš„æ˜¯åŒä¸€ä¸ªæ–¹æ³•ï¼Œä¸å†èµ˜è¿°ã€‚æ¥ä¸‹æ¥æ˜¯doAcquireNanosæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940private boolean doAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; //å¦‚æœç»™å®šçš„æ—¶é—´å€¼å°äºç­‰äº0ï¼Œåˆ™ç›´æ¥è¿”å›false if (nanosTimeout &lt;= 0L) return false; //æ ¹æ®ç»™å®šå‚æ•°è®¡ç®—æˆªæ­¢æ—¶é—´ final long deadline = System.nanoTime() + nanosTimeout; //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°CLHç­‰å¾…é˜Ÿåˆ— final Node node = addWaiter(Node.EXCLUSIVE); //åˆå§‹å¤±è´¥æ ‡å¿— boolean failed = true; try &#123; //åœ¨ç»™å®šæ—¶é—´å†…å¾ªç¯/è‡ªæ—‹å°è¯•è·å–é” for (;;) &#123; //å–å‡ºå‰ç½®èŠ‚ç‚¹ final Node p = node.predecessor(); //å¦‚æœå‰ç½®èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹èƒ½å¤ŸæˆåŠŸè·å–é” if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC å‰é¦–èŠ‚ç‚¹å‡ºé˜Ÿï¼Œå¸®åŠ©GC failed = false; return true; &#125; //åˆ¤æ–­æ˜¯å¦ç­‰å¾…è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™è¿”å›false nanosTimeout = deadline - System.nanoTime(); if (nanosTimeout &lt;= 0L) return false; //è¿™é‡Œåˆ¤æ–­æ˜¯å¦å¯ä»¥é˜»å¡çº¿ç¨‹å¹¶åšç›¸åº”æ“ä½œï¼Œè·Ÿä¹‹å‰åˆ†æçš„å‡ ä¸ªæ–¹æ³•ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™é‡Œçš„é˜»å¡å¤šäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¹¶ä¸”æ˜¯åœ¨æœ‰é™æ—¶é—´å†…é˜»å¡ï¼Œç±»ä¼¼äºsleep if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) LockSupport.parkNanos(this, nanosTimeout); //åˆ¤æ–­ä¸­æ–­çŠ¶æ€ï¼Œå¹¶å†³å®šæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; doAcquireNanosçš„é˜»å¡æ˜¯æœ‰æ—¶é—´é™åˆ¶çš„ï¼Œæ‰€ä»¥èƒ½åœ¨ç»™å®šçš„æ—¶é—´å†…ï¼Œè¿”å›è·å–é”çš„æ“ä½œç»“æœã€‚ å‚è€ƒèµ„æ–™https://juejin.cn/post/6870099231361728525 https://www.processon.com/view/5f047c16f346fb1ae598b4dd?fromnew=1 https://www.imooc.com/article/51118","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹AQSåº•å±‚å®ç°ä¸åŸç†","date":"2021-08-02T07:17:07.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹AQSåº•å±‚å®ç°ä¸åŸç†/","text":"AQSé”é™æ—¶ç­‰å¾…æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ å…¬å¹³é”ä¸éå…¬å¹³é”æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ ç‹¬å é”&amp;å…±äº«é”ç‹¬å é”å³åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€ï¼Œå½“è¿™ä¸ªçº¿ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾åŒæ­¥çŠ¶æ€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ˜¯è·å–ä¸äº†çš„ï¼Œåªèƒ½åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè¿›è¡Œç­‰å¾…ã€‚ å…¬å¹³é”&amp;éå…¬å¹³é”å…¬å¹³é”å…¬å¹³ç­–ç•¥ï¼šåœ¨å¤šä¸ªçº¿ç¨‹äº‰ç”¨é”çš„æƒ…å†µä¸‹ï¼Œå…¬å¹³ç­–ç•¥å€¾å‘äºå°†è®¿é—®æƒæˆäºˆç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸å½“äºæœ‰ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼Œå…ˆè¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹åç»­ä¼šå…ˆè·å¾—é”ï¼Œè¿™æ ·æŒ‰ç…§â€œå…ˆæ¥ååˆ°â€çš„åŸåˆ™ï¼Œå¯¹äºæ¯ä¸€ä¸ªç­‰å¾…çº¿ç¨‹éƒ½æ˜¯å…¬å¹³çš„ã€‚ éå…¬å¹³é”åœ¨å¤šä¸ªçº¿ç¨‹äº‰ç”¨é”çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿæœ€ç»ˆè·å¾—é”çš„çº¿ç¨‹æ˜¯éšæœºçš„ï¼ˆç”±åº•å±‚OSè°ƒåº¦ï¼‰ã€‚ æ³¨æ„ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…¬å¹³ç­–ç•¥çš„ç¨‹åºåœ¨å¤šçº¿ç¨‹è®¿é—®æ—¶ï¼Œæ€»ä½“ååé‡ï¼ˆå³é€Ÿåº¦å¾ˆæ…¢ï¼Œå¸¸å¸¸æå…¶æ…¢ï¼‰æ¯”è¾ƒä½ï¼Œå› ä¸ºæ­¤æ—¶åœ¨çº¿ç¨‹è°ƒåº¦ä¸Šé¢çš„å¼€é”€æ¯”è¾ƒå¤§ã€‚ AQSæ˜¯ä»€ä¹ˆåŒæ­¥å™¨æ˜¯ç”¨æ¥æ„å»ºé”å’Œå…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼Œå®ƒçš„å®ç°ä¸»è¦ä¾èµ–äºä¸€ä¸ªintç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ä»¥åŠä¸€ä¸ªFIFOé˜Ÿåˆ—æ„å»ºç­‰å¾…é˜Ÿåˆ—ã€‚å®ƒçš„å­ç±»å¿…é¡»é‡å†™AQSå®šä¹‰çš„å‡ ä¸ªprotectedä¿®é¥°çš„ç”¨æ¥æ”¹å˜åŒæ­¥çŠ¶æ€çš„æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ä¸»è¦æ˜¯ç”¨æ¥å®ç°æ’é˜Ÿå’Œé˜»å¡æœºåˆ¶çš„ã€‚ åŒæ­¥å™¨æ˜¯å®ç°é”çš„å…³é”®ï¼Œåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨ï¼Œåˆ©ç”¨åŒæ­¥å™¨å®ç°é”çš„è¯­ä¹‰ï¼Œå¯ä»¥è¿™æ ·ç†è§£ä¸¤è€…çš„å…³ç³»ï¼š é”æ˜¯é¢å‘ä½¿ç”¨è€…çš„ï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨è€…å’Œé”äº¤äº’çš„æ¥å£ï¼Œéšè—äº†å®ç°çš„ç»†èŠ‚ï¼ŒåŒæ­¥å™¨æ˜¯é¢å‘é”çš„å®ç°è€…ï¼Œå®ƒç®€åŒ–äº†é”çš„å®ç°æ–¹å¼ï¼Œå±è”½äº†åŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œçº¿ç¨‹çš„æ’é˜Ÿï¼Œç­‰å¾…å’Œå”¤é†’ç­‰åº•å±‚æ“ä½œã€‚ AQSçš„è®¾è®¡æ˜¯ä½¿ç”¨æ¨¡ç‰ˆæ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†ä¸€ä¸ªæ–¹æ³•å¼€æ”¾ç»™å­ç±»é‡å†™ï¼Œè€ŒåŒæ­¥å™¨ç»™åŒæ­¥ç»„ä»¶æ‰€æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•åˆä¼šé‡æ–°è°ƒç”¨å­ç±»æ‰€é‡å†™çš„æ–¹æ³•ã€‚ AQSæ ¸å¿ƒæ€æƒ³å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå¹¶ä¸”å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ã€‚ å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºè¢«å ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶AQSæ˜¯ç”¨CLHé˜Ÿåˆ—é”å®ç°çš„ï¼Œå³å°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚ 1ã€AQSä½¿ç”¨ä¸€ä¸ªintæˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ 2ã€ä½¿ç”¨Nodeå®ç°FIFOé˜Ÿåˆ—ï¼Œå¯ä»¥ç”¨äºæ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥è£…ç½® AQSèµ„æºå…±äº«æ–¹å¼ï¼šç‹¬å Exclusiveï¼ˆæ’å®ƒé”æ¨¡å¼ï¼‰å’Œå…±äº«Shareï¼ˆå…±äº«é”æ¨¡å¼ï¼‰ AQSå®ƒçš„æ‰€æœ‰å­ç±»ä¸­ï¼Œè¦ä¹ˆå®ç°å¹¶ä½¿ç”¨äº†å®ƒçš„ç‹¬å åŠŸèƒ½çš„apiï¼Œè¦ä¹ˆä½¿ç”¨äº†å…±äº«é”çš„åŠŸèƒ½ï¼Œè€Œä¸ä¼šåŒæ—¶ä½¿ç”¨ä¸¤å¥—apiï¼Œå³ä¾¿æ˜¯æœ€æœ‰åçš„å­ç±»ReentrantReadWriteLockä¹Ÿæ˜¯é€šè¿‡ä¸¤ä¸ªå†…éƒ¨ç±»è¯»é”å’Œå†™é”åˆ†åˆ«å®ç°äº†ä¸¤å¥—apiæ¥å®ç°çš„ stateçŠ¶æ€stateçŠ¶æ€ä½¿ç”¨volatile intç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºå½“å‰åŒæ­¥çŠ¶æ€ã€‚stateçš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§: getState() setState() compareAndSetState() Nodeå†…éƒ¨ç±»Nodeç±»æ˜¯AQSçš„ç»å¯¹æ ¸å¿ƒç±»ï¼ŒAQSåŸºäºNodeæ¥æ„å»ºåŒæ­¥é˜Ÿåˆ—å’ŒConditioné˜Ÿåˆ—ï¼› æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051static final class Node &#123; /** Marker to indicate a node is waiting in shared mode */ static final Node SHARED = new Node(); /** Marker to indicate a node is waiting in exclusive mode */ static final Node EXCLUSIVE = null; /** waitStatus value to indicate thread has cancelled */ static final int CANCELLED = 1; /** waitStatus value to indicate successor&#x27;s thread needs unparking */ static final int SIGNAL = -1; /** waitStatus value to indicate thread is waiting on condition */ static final int CONDITION = -2; /** * waitStatus value to indicate the next acquireShared should * unconditionally propagate */ static final int PROPAGATE = -3; volatile int waitStatus; volatile Node prev; volatile Node next; volatile Thread thread; Node nextWaiter; /** * Returns true if node is waiting in shared mode. */ final boolean isShared() &#123; return nextWaiter == SHARED; &#125; // è·å–å‰ç½®èŠ‚ç‚¹ final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) throw new NullPointerException(); else return p; &#125; Node() &#123; // Used to establish initial head or SHARED marker &#125; Node(Thread thread, Node mode) &#123; // Used by addWaiter this.nextWaiter = mode; this.thread = thread; &#125; Node(Thread thread, int waitStatus) &#123; // Used by Condition this.waitStatus = waitStatus; this.thread = thread; &#125; &#125; CANCELLED waitStatuså€¼ä¸º1æ—¶è¡¨ç¤ºè¯¥çº¿ç¨‹èŠ‚ç‚¹å·²é‡Šæ”¾ï¼ˆè¶…æ—¶ã€ä¸­æ–­ï¼‰ï¼Œå·²å–æ¶ˆçš„èŠ‚ç‚¹ä¸ä¼šå†é˜»å¡ã€‚ SIGNAL waitStatusä¸º-1æ—¶è¡¨ç¤ºè¯¥çº¿ç¨‹çš„åç»­çº¿ç¨‹éœ€è¦é˜»å¡ï¼Œå³åªè¦å‰ç½®èŠ‚ç‚¹é‡Šæ”¾é”ï¼Œå°±ä¼šé€šçŸ¥æ ‡è¯†ä¸º SIGNAL çŠ¶æ€çš„åç»­èŠ‚ç‚¹çš„çº¿ç¨‹ CONDITION waitStatusä¸º-2æ—¶ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹åœ¨conditioné˜Ÿåˆ—ä¸­é˜»å¡ï¼ˆConditionæœ‰ä½¿ç”¨ï¼‰ PROPAGATE waitStatusä¸º-3æ—¶ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹ä»¥åŠåç»­çº¿ç¨‹è¿›è¡Œæ— æ¡ä»¶ä¼ æ’­ï¼ˆCountDownLatchä¸­æœ‰ä½¿ç”¨ï¼‰å…±äº«æ¨¡å¼ä¸‹ï¼Œ PROPAGATE çŠ¶æ€çš„çº¿ç¨‹å¤„äºå¯è¿è¡ŒçŠ¶æ€ AQSä¹‹ç‹¬å +éå…¬å¹³è·å–é”acquire ReentrantLockæ˜¯AQSç‹¬å æ¨¡å¼çš„ç»å…¸å®ç°ï¼ŒReentrantLockåœ¨æ„é€ å®ä¾‹æ˜¯å¯ä»¥æŒ‡å®šæ˜¯å¦æ˜¯fair lockã€‚ 123456789/** * Creates an instance of &#123;@code ReentrantLock&#125; with the * given fairness policy. * * @param fair &#123;@code true&#125; if this lock should use a fair ordering policy */ public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync(); &#125; acquireæ–¹æ³•è·å–è®¸å¯ä¸‹é¢æˆ‘ä»¬å°±ä»é”çš„è·å–å…¥æ‰‹å¼€å§‹è§£è¯»AQSï¼š 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); &#125; tryAcquireæŠ½è±¡æ–¹æ³•tryAcquireæ˜¯ä¸ªprotectedæ–¹æ³•ï¼Œå…·ä½“æ˜¯å®ç°åœ¨å¯¹åº”çš„å­ç±»ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•çš„åŠŸèƒ½å°±æ˜¯å°è¯•å»ä¿®æ”¹stateçš„çŠ¶æ€å€¼ 123protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException();&#125; nonfairTryAcquireéå…¬å¹³é”è·å–è®¸å¯1234567// ReentrantLock éå…¬å¹³é”è¿›æ¥å°±å¼€å§‹æŠ¢å é”ï¼Œä½“ç°éå…¬å¹³æ€§final void lock() &#123; if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else acquire(1); &#125; ä»¥ReentrantLockæ–¹æ³•çš„å®ç°ä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸‹æºç ï¼š 123456789101112131415161718192021222324final boolean nonfairTryAcquire(int acquires) &#123; // è·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); // getState()è¿”å›çš„å°±æ˜¯AQSç±»ä¸­çš„stateå­—æ®µçš„å€¼ int c = getState(); // c == 0 è¯´æ˜å½“å‰é”æ²¡æœ‰è¢«ä»»ä½•çº¿ç¨‹å æœ‰ if (c == 0) &#123; // ä½¿ç”¨caså»ä¿®æ”¹stateçš„å€¼ï¼Œç‹¬å æ¨¡å¼ä¸‹acquires = 1 if (compareAndSetState(0, acquires)) &#123; // ä¿®æ”¹stateæˆåŠŸä¹‹åï¼Œå°†ç‹¬å çº¿ç¨‹è®¾ç½®æˆå½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è¿”å›trueï¼Œè¡¨ç¤ºæŠ¢å é”æˆåŠŸ setExclusiveOwnerThread(current); return true; &#125; &#125; // å¦‚æœstate ï¼= 0 å¹¶ä¸”ç‹¬å çº¿ç¨‹å°±æ˜¯å½“å‰çº¿ç¨‹ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹æŒæœ‰å¯¹è±¡çš„é”ï¼Œæ­¤æ—¶ï¼Œéœ€è¦é”é‡å…¥ï¼Œstateç»§ç»­ç´¯åŠ  else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125; AQSçš„acquire(int arg)æ–¹æ³•ä¸­è¿˜æœ‰ä¸€éƒ¨åˆ†å°±æ˜¯ acquireQueued(addWaiter(Node.EXCLUSIVE), arg) addWaiteræ·»åŠ ç­‰å¾…é˜Ÿåˆ—æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹addWaiteræ–¹æ³•ï¼Œjava.util.concurrent.locks.AbstractQueuedSynchronizer#addWaiter å¦‚æœtryAcquireè¿”å›FALSEï¼ˆè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼‰ï¼Œåˆ™è°ƒç”¨è¯¥æ–¹æ³•å°†å½“å‰çº¿ç¨‹åŠ å…¥åˆ°CLHåŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚ 1234567891011121314151617private Node addWaiter(Node mode) &#123; // é¦–å…ˆåˆ›å»ºä¸€ä¸ªNodeèŠ‚ç‚¹ Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure Node pred = tail; // cas å°†å½“å‰èŠ‚ç‚¹è®¾ç½®åˆ°åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; pred.next = node; return node; &#125; &#125; // å¦‚æœä¸Šé¢casè®¾ç½®æ²¡æœ‰æˆåŠŸï¼Œåˆ™é€šè¿‡enqæ–¹æ³•å°†èŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿå°¾ enq(node); return node; &#125; java.util.concurrent.locks.AbstractQueuedSynchronizer#enq 12345678910111213141516private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // Must initialize åˆå§‹åŒ–å¤´èŠ‚ç‚¹ if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125; &#125; é€šè¿‡è‡ªæ—‹ï¼Œæœ€ç»ˆå°†nodeèŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ acquireQueuedè·å–è®¸å¯èŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¹‹ä¸­ï¼Œç„¶åæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³• â€¼ï¸ acquireQueuedæ–¹æ³•ä¸ºä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰çº¿ç¨‹ï¼ˆNodeï¼‰è¿›å…¥åŒæ­¥é˜Ÿåˆ—åï¼Œå°±ä¼šè¿›å…¥ä¸€ä¸ªè‡ªæ—‹çš„è¿‡ç¨‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè‡ªçœåœ°è§‚å¯Ÿï¼Œå½“æ¡ä»¶æ»¡è¶³ï¼Œè·å–åˆ°åŒæ­¥çŠ¶æ€åï¼Œå°±å¯ä»¥ä»è¿™ä¸ªè‡ªæ—‹è¿‡ç¨‹ä¸­é€€å‡ºï¼Œå¦åˆ™ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ã€‚ 1234567891011121314151617181920212223242526final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; // å¦‚æœnodeèŠ‚ç‚¹æ˜¯é˜Ÿåˆ—ä¸­ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªæ­£åœ¨æ‰§è¡ŒçŠ¶æ€ï¼‰è‚¯å®šè¦é˜Ÿåˆ—ä¸­ä»ç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹å°è¯•è·å–é” final Node p = node.predecessor(); // ç¬¬äºŒä¸ªèŠ‚ç‚¹è°ƒç”¨tryAcquireæ–¹æ³• if (p == head &amp;&amp; tryAcquire(arg)) &#123; //æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®æˆé˜Ÿåˆ—å¤´èŠ‚ç‚¹ setHead(node); p.next = null; // help GC failed = false; return interrupted; &#125; //åˆ¤æ–­æ˜¯å¦éœ€è¦æŒ‚èµ·é˜Ÿåˆ—ä¸­åç»­çš„èŠ‚ç‚¹ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; // å¦‚æœè·å–é”å¤±è´¥ if (failed) cancelAcquire(node); &#125; &#125; shouldParkAfterFailedAcquireæ–¹æ³•shouldParkAfterFailedAcquireå°†é˜Ÿåˆ—åç»­èŠ‚ç‚¹æŒ‚èµ· 12345678910111213141516171819private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; int ws = pred.waitStatus; if (ws == Node.SIGNAL) // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„waitStatus == Node.SIGNAL åˆ™ç›´æ¥è¿”å›true // å› ä¸ºå‰ä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€æ˜¯Node.SIGNALæ—¶ï¼Œæ‰ä¼šé€šçŸ¥åç»­èŠ‚ç‚¹è¿›è¡Œparkæˆ–è€…unpark return true; if (ws &gt; 0) &#123; // static final int CANCELLED = 1; // å–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹ç›´æ¥åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­å»é™¤ do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; // å°†å‰ä¸€ä¸ªèŠ‚ç‚¹çš„waitStatusè®¾ç½®æˆNode.SIGNAL compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false; &#125; 12345private final boolean parkAndCheckInterrupt() &#123; // æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œèµ°åˆ°è¿™è‚¯å®šæ˜¯æ²¡æœ‰æ‹¿åˆ°æ‰§è¡Œæƒçš„ï¼Œçº¿ç¨‹éœ€è¦æŒ‚èµ·ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾é” LockSupport.park(this); return Thread.interrupted();&#125; æœ€åå¦‚æœè·å–å¤±è´¥çš„è¯ï¼Œä¼šè°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š cancelAcquireå–æ¶ˆè·å–123456789101112131415161718192021222324252627282930313233343536373839private void cancelAcquire(Node node) &#123; // å¦‚æœèŠ‚ç‚¹ä¸ºç©ºï¼Œç›´æ¥è¿”å› if (node == null) return; // ç”±äºçº¿ç¨‹è¦è¢«å–æ¶ˆäº†ï¼Œæ‰€ä»¥å°† thread çº¿ç¨‹æ¸…æ‰ node.thread = null; // ä¸‹é¢è¿™æ­¥è¡¨ç¤ºå°† node çš„ pre æŒ‡å‘ä¹‹å‰ç¬¬ä¸€ä¸ªéå–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ï¼ˆå³è·³è¿‡æ‰€æœ‰å–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ï¼‰,waitStatus &gt; 0 è¡¨ç¤ºå½“å‰ç»“ç‚¹çŠ¶æ€ä¸ºå–æ¶ˆçŠ¶æ€ Node pred = node.prev; while (pred.waitStatus &gt; 0) node.prev = pred = pred.prev; // è·å–ç»è¿‡è¿‡æ»¤åçš„ pre çš„ next ç»“ç‚¹ï¼Œè¿™ä¸€æ­¥ä¸»è¦ç”¨åœ¨åé¢çš„ CAS è®¾ç½® pre çš„ next èŠ‚ç‚¹ä¸Š Node predNext = pred.next; // å°†å½“å‰ç»“ç‚¹è®¾ç½®ä¸ºå–æ¶ˆçŠ¶æ€ node.waitStatus = Node.CANCELLED; // å¦‚æœå½“å‰å–æ¶ˆç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ï¼Œä½¿ç”¨ CAS åˆ™å°†å°¾ç»“ç‚¹è®¾ç½®ä¸ºå…¶å‰é©±èŠ‚ç‚¹ï¼Œå¦‚æœè®¾ç½®æˆåŠŸï¼Œåˆ™å°¾ç»“ç‚¹çš„ next æŒ‡é’ˆè®¾ç½®ä¸ºç©º if (node == tail &amp;&amp; compareAndSetTail(node, pred)) &#123; compareAndSetNext(pred, predNext, null); &#125; else &#123; // è¿™ä¸€æ­¥çœ‹å¾—æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬æƒ³æƒ³ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹å–æ¶ˆäº†ï¼Œé‚£æ˜¯ä¸æ˜¯è¦æŠŠå½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ // ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰ä¹Ÿè¯´äº†ï¼Œè¦å”¤é†’æˆ–é˜»å¡ç»“ç‚¹ï¼Œé¡»åœ¨å…¶å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€ä¸º SIGNAL çš„æ¡ä»¶æ‰èƒ½æ“ä½œï¼Œ //æ‰€ä»¥åœ¨è®¾ç½® pre çš„ next èŠ‚ç‚¹æ—¶è¦ä¿è¯ pre ç»“ç‚¹çš„çŠ¶æ€ä¸º SIGNALï¼Œæƒ³é€šäº†è¿™ä¸€ç‚¹ç›¸ä¿¡ä½ ä¸éš¾ç†è§£ä»¥ä¸‹ä»£ç ã€‚ int ws; if (pred != head &amp;&amp; ((ws = pred.waitStatus) == Node.SIGNAL || (ws &lt;= 0 &amp;&amp; compareAndSetWaitStatus(pred, ws, Node.SIGNAL))) &amp;&amp; pred.thread != null) &#123; Node next = node.next; if (next != null &amp;&amp; next.waitStatus &lt;= 0) compareAndSetNext(pred, predNext, next); &#125; else &#123; // å¦‚æœ pre ä¸º headï¼Œæˆ–è€… pre çš„çŠ¶æ€è®¾ç½® SIGNAL å¤±è´¥ï¼Œåˆ™ç›´æ¥å”¤é†’åç»§ç»“ç‚¹å»ç«äº‰é”ï¼Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œ SIGNAL çš„ç»“ç‚¹å–æ¶ˆï¼ˆæˆ–é‡Šæ”¾é”ï¼‰åå¯ä»¥å”¤é†’åç»§ç»“ç‚¹ unparkSuccessor(node); &#125; node.next = node; // help GC &#125;&#125; é‡Šæ”¾é”release123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; tryReleaseæ–¹æ³•ä¹Ÿæ˜¯ç”±å­ç±»æ¥å®ç°çš„ã€‚ 1234567891011121314protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; // åˆ¤æ–­å½“å‰çº¿ç¨‹ if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; // å°†ç‹¬å çº¿ç¨‹è®¾ç½®æˆnullï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°é”æ—¶ä¼šè®¾ç½®æˆè‡ªå·±çš„ setExclusiveOwnerThread(null); &#125; setState(c); return free; &#125; ä¸‹é¢æ˜¯æ‰§è¡ŒunparkSuccessor(h);æ–¹æ³•äº†ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾äº†é”ä¹‹åï¼Œéœ€è¦å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬äºŒä¸ªèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ã€‚è¿™é‡Œæ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œè¦æ‰§è¡Œçš„NodeèŠ‚ç‚¹çš„waitStatusè‚¯å®šæ˜¯0ï¼›ï¼Ÿï¼Ÿ 1234567891011121314151617private void unparkSuccessor(Node node) &#123; int ws = node.waitStatus; if (ws &lt; 0) //ç½®é›¶å½“å‰çº¿ç¨‹æ‰€åœ¨çš„ç»“ç‚¹çŠ¶æ€ï¼Œå…è®¸å¤±è´¥ compareAndSetWaitStatus(node, ws, 0);// ä»ç¬¬äºŒä¸ªèŠ‚ç‚¹å¼€å§‹å¾€åæ‰¾waitStatus&lt;=0çš„èŠ‚ç‚¹ï¼Œç„¶åæ‰§è¡Œunpark Node s = node.next; // æ‰¾åˆ°ä¸‹ä¸€ä¸ªéœ€è¦å”¤é†’çš„ç»“ç‚¹ if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread);&#125; Conditionåœ¨AQSä¸­çš„å®ç°ä¸Šé¢å·²ç»ä»‹ç»äº†AQSæ‰€æä¾›çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå½“ç„¶å®ƒè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„ç‰¹æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥ç»§ç»­è¯´ä¸‹Conditionè¿™ä¸ªç»„ä»¶ã€‚ Conditionæ˜¯åœ¨java 1.5ä¸­æ‰å‡ºç°çš„ï¼Œå®ƒç”¨æ¥æ›¿ä»£ä¼ ç»Ÿçš„Objectçš„wait()ã€notify()å®ç°çº¿ç¨‹é—´çš„åä½œï¼Œç›¸æ¯”ä½¿ç”¨Objectçš„wait()ã€notify()ï¼Œä½¿ç”¨Conditionä¸­çš„await()ã€signal()è¿™ç§æ–¹å¼å®ç°çº¿ç¨‹é—´åä½œæ›´åŠ å®‰å…¨å’Œé«˜æ•ˆã€‚å› æ­¤é€šå¸¸æ¥è¯´æ¯”è¾ƒæ¨èä½¿ç”¨`Condition å…¶ä¸­AbstractQueueSynchronizerä¸­å®ç°äº†Conditionä¸­çš„æ–¹æ³•ï¼Œä¸»è¦å¯¹å¤–æä¾›awaite(Object.wait())å’Œsignal(Object.notify())è°ƒç”¨ã€‚ Conditionåœ¨javaä»£ç ä¸­çš„åº”ç”¨12345678910111213141516171819202122232425262728293031323334public class ReentrantLockDemo &#123; static ReentrantLock lock = new ReentrantLock(); public static void main(String[] args) &#123; Condition condition = lock.newCondition(); new Thread(() -&gt; &#123; lock.lock(); try &#123; System.out.println(&quot;çº¿ç¨‹ä¸€åŠ é”æˆåŠŸ&quot;); System.out.println(&quot;çº¿ç¨‹ä¸€æ‰§è¡Œawaitè¢«æŒ‚èµ·&quot;); condition.await(); System.out.println(&quot;çº¿ç¨‹ä¸€è¢«å”¤é†’æˆåŠŸ&quot;); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; lock.unlock(); System.out.println(&quot;çº¿ç¨‹ä¸€é‡Šæ”¾é”æˆåŠŸ&quot;); &#125; &#125;).start(); new Thread(() -&gt; &#123; lock.lock(); try &#123; System.out.println(&quot;çº¿ç¨‹äºŒåŠ é”æˆåŠŸ&quot;); condition.signal(); System.out.println(&quot;çº¿ç¨‹äºŒå”¤é†’çº¿ç¨‹ä¸€&quot;); &#125; finally &#123; lock.unlock(); System.out.println(&quot;çº¿ç¨‹äºŒé‡Šæ”¾é”æˆåŠŸ&quot;); &#125; &#125;).start(); &#125;&#125; çº¿ç¨‹ä¸€è°ƒç”¨äº†condition.await();ä¹‹åï¼Œçº¿ç¨‹äºŒæ‰å¯ä»¥è·å–åˆ°é”å¹¶ä¸”æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ï¼Œçº¿ç¨‹äºŒè°ƒç”¨ condition.signal();ä¹‹åå”¤é†’çº¿ç¨‹ä¸€ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œåªæœ‰åœ¨çº¿ç¨‹äºŒæ‰§è¡Œå®Œæˆä¹‹åè°ƒç”¨lock.unlock();ä¹‹åï¼Œçº¿ç¨‹ä¸€é‡æ–°å›å»åˆ°é”ï¼Œç„¶åæ‰§è¡Œçº¿ç¨‹ä¸€åç»­çš„æµç¨‹ã€‚ awaitæ–¹æ³•awaitä½¿å½“å‰çº¿ç¨‹é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œè®¸å¯ï¼Œç„¶åè¿›å…¥Conditioné˜Ÿåˆ—ï¼Œç­‰å¾…åœ¨æŸä¸ªæ—¶åˆ»è¢«æŸä¸ªçº¿ç¨‹å”¤é†’ã€‚ 12345678910111213141516171819202122232425public final void await() throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); // å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeèŠ‚ç‚¹æ·»åŠ çš„Conditioné˜Ÿåˆ—ä¸­ Node node = addConditionWaiter(); // æ·»åŠ åˆ°Conditioné˜Ÿåˆ—ä¸­çš„çº¿ç¨‹éœ€è¦é‡Šæ”¾é”èµ„æº int savedState = fullyRelease(node); int interruptMode = 0; // æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ˜¯ä¸æ˜¯åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ while (!isOnSyncQueue(node)) &#123; // å½“å‰èŠ‚ç‚¹ä¸åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œé‚£ä¹ˆç›´æ¥parkæŒ‚èµ· LockSupport.park(this); if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; // è¡¨æ˜å·²ç»æœ‰çš„çº¿ç¨‹è°ƒç”¨äº†signalå”¤é†’å½“å‰çº¿ç¨‹ï¼Œ // å¹¶ä¸”èŠ‚ç‚¹å·²ç»å­˜æ”¾åˆ°äº†åŒæ­¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨å¦‚æœacquireQueuedè¯·æ±‚è®¸å¯äº† // savedStateæ˜¯è·å–è®¸å¯çš„ä¸ªæ•° è¿™ä¸ªè¦å’Œä¹‹å‰é‡Šæ”¾çš„è®¸å¯ä¸ªæ•°ä¸€è‡´ if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; if (node.nextWaiter != null) // clean up if cancelled unlinkCancelledWaiters(); if (interruptMode != 0) reportInterruptAfterWait(interruptMode); &#125; addConditionWaiteræ–¹æ³•æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°Conditioné˜Ÿåˆ—ä¸­ java.util.concurrent.locks.AbstractQueuedSynchronizer.ConditionObject#addConditionWaiter 1234567891011121314151617private Node addConditionWaiter() &#123; Node t = lastWaiter; // If lastWaiter is cancelled, clean out. if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; // å…ˆæ£€æŸ¥ä¸€éæœ‰æ²¡æœ‰å–æ¶ˆçŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œæ¸…é™¤æ‰ unlinkCancelledWaiters(); t = lastWaiter; &#125; // å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeæ·»åŠ åˆ°Conditioné˜Ÿåˆ—ä¸­ Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node; &#125; signalæ–¹æ³•å”¤é†’ä¸€ä¸ªçº¿ç¨‹ 1234567 public final void signal() &#123; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignal(first);&#125; doSignalæ–¹æ³•123456789private void doSignal(Node first) &#123; do &#123; if ( (firstWaiter = first.nextWaiter) == null) lastWaiter = null; first.nextWaiter = null; // å°†Conditioné˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹çŠ¶æ€è®¾ç½®æˆSIGNALï¼Œå¹¶å°†èŠ‚ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ &#125; while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null); &#125; transferForSignalæ–¹æ³•1234567891011121314151617181920212223final boolean transferForSignal(Node node) &#123; /* * If cannot change waitStatus, the node has been cancelled. */ // å°†èŠ‚ç‚¹çŠ¶æ€æ”¹æˆ0 if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; /* * Splice onto queue and try to set waitStatus of predecessor to * indicate that thread is (probably) waiting. If cancelled or * attempt to set waitStatus fails, wake up to resync (in which * case the waitStatus can be transiently and harmlessly wrong). */ // æŠŠå½“å‰æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶è¿”å›å‰ä¸€ä¸ªèŠ‚ç‚¹ Node p = enq(node); int ws = p.waitStatus; // è®¾ç½®å‰ä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¸ºSIGNAL if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) // å”¤é†’å½“å‰èŠ‚ç‚¹çš„çº¿ç¨‹ LockSupport.unpark(node.thread); return true; &#125; å‚è€ƒèµ„æ–™https://mp.weixin.qq.com/s/hB5ncpe7_tVovQj1sNlDRA https://mp.weixin.qq.com/s/iNz6sTen2CSOdLE0j7qu9A https://github.com/AobingJava/JavaFamily https://segmentfault.com/a/1190000015804888/ https://juejin.cn/post/6844903997438951437 https://juejin.cn/post/6870099231361728525","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—åˆé›†","date":"2021-08-02T03:22:49.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ç³»åˆ—åˆé›†/","text":"Lockæ¡†æ¶ç»§æ‰¿å…³ç³»å›¾ çŸ¥è¯†æ¸…å• Javaå¤šçº¿ç¨‹ä¸å¹¶å‘åŸºç¡€ Javaå†…å­˜æ¨¡å‹ æ·±å…¥ç†è§£åŒæ­¥é”-synchronizedå…³é”®å­— synchronizedå®ç°åŸç†æ¦‚è¿° æ·±å…¥ç†è§£volatileå…³é”®å­— æ·±å…¥ç†è§£finalå…³é”®å­— æ·±å…¥ç†è§£å¹¶å‘ç¼–ç¨‹ä¹‹Blocking Queue æ·±å…¥ç†è§£å¹¶å‘ç¼–ç¨‹ä¹‹AQS æ·±å…¥ç†è§£ReentrantLockåº”ç”¨åŠå®ç° æ·±å…¥Conditionæœºåˆ¶çš„åº•å±‚åŸç† Javaå¤šçº¿ç¨‹ä¹‹ä¸­æ–­æœºåˆ¶ æ·±å…¥ç†è§£å¹¶å‘å®¹å™¨ä¹‹concurrentHashMap æ·±å…¥ç†è§£å¹¶å‘ç¼–ç¨‹ä¹‹ThreadLocal æ·±å…¥ç†è§£Atomicåº•å±‚åŠåŸç† å¦‚ä½•æ„å»ºä¸€ä¸ªå®‰å…¨å¯ç”¨çš„çº¿ç¨‹æ±  JUC-CountDownLatch JUC-CyclicBarrier LockSupportå·¥å…· å¹¶å‘ç¼–ç¨‹ä¹‹Unsafeç±» å­¦ä¹ æ–‡æ¡£https://www.codercc.com/backend/basic/juc/ https://segmentfault.com/a/1190000015558984 https://www.pdai.tech/md/java/thread/java-thread-x-juc-overview.html https://github.com/AobingJava/JavaFamily https://dayarch.top/categories/Coding/Java-Concurrency/ http://tutorials.jenkov.com/java-concurrency/blocking-queues.html","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"JVM-åƒåœ¾æ”¶é›†å™¨","date":"2021-07-31T06:13:17.000Z","path":"wiki/JVM-åƒåœ¾æ”¶é›†å™¨/","text":"1ã€ä»€ä¹ˆæ˜¯åƒåœ¾æ”¶é›†å™¨å¦‚æœè¯´åƒåœ¾æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚ JVMè§„èŒƒå¯¹äºåƒåœ¾æ”¶é›†å™¨çš„åº”è¯¥å¦‚ä½•å®ç°æ²¡æœ‰ä»»ä½•è§„å®šï¼Œå› æ­¤ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨å·®åˆ«è¾ƒå¤§ï¼Œè¿™é‡Œåªçœ‹HotSpotè™šæ‹Ÿæœºã€‚ å°±åƒæ²¡æœ‰æœ€å¥½çš„ç®—æ³•ä¸€æ ·ï¼Œåƒåœ¾æ”¶é›†å™¨ä¹Ÿæ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€åˆé€‚ã€‚æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨ã€‚ â€‹ ä¸Šå›¾å±•ç¤ºäº†7ç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå…¶ä¸­ç”¨äºå›æ”¶æ–°ç”Ÿä»£çš„æ”¶é›†å™¨åŒ…æ‹¬Serialã€PraNewã€Parallel Scavengeï¼Œå›æ”¶è€å¹´ä»£çš„æ”¶é›†å™¨åŒ…æ‹¬Serial Oldã€Parallel Oldã€CMSï¼Œè¿˜æœ‰ç”¨äºå›æ”¶æ•´ä¸ªJavaå †çš„G1æ”¶é›†å™¨ã€‚ä¸åŒæ”¶é›†å™¨ä¹‹é—´çš„è¿çº¿è¡¨ç¤ºå®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚ 2ã€ä¸²è¡Œï¼Œå¹¶è¡Œå’Œå¹¶å‘2.1 ä¸²è¡Œè®¡ç®—æœºä¸­çš„ä¸²è¡Œæ˜¯ç”¨ Serial è¡¨ç¤ºã€‚A å’Œ B ä¸¤ä¸ªä»»åŠ¡è¿è¡Œåœ¨ä¸€ä¸ª CPU çº¿ç¨‹ä¸Šï¼Œåœ¨ A ä»»åŠ¡æ‰§è¡Œå®Œä¹‹å‰ä¸å¯ä»¥æ‰§è¡Œ Bã€‚å³ï¼Œåœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä»…å­˜åœ¨ä¸€ä¸ªè¿è¡Œä¸Šä¸‹æ–‡ï¼Œå³ä¸€ä¸ªè°ƒç”¨æ ˆä¸€ä¸ªå †ã€‚ç¨‹åºä¼šæŒ‰é¡ºåºæ‰§è¡Œæ¯ä¸ªæŒ‡ä»¤ã€‚ 2.2 å¹¶è¡Œå¹¶è¡Œæ€§æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šäº‹ä»¶æˆ–æ´»åŠ¨åœ¨åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¹¶è¡Œæ€§ä½¿å¤šä¸ªç¨‹åºåŒä¸€æ—¶åˆ»å¯åœ¨ä¸åŒ CPU ä¸ŠåŒæ—¶æ‰§è¡Œã€‚æ¯”å¦‚ï¼ŒA å’Œ B ä¸¤ä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶è¿è¡Œåœ¨ä¸åŒçš„ CPU çº¿ç¨‹ä¸Šï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œä½†å—é™äº CPU çº¿ç¨‹æ•°ï¼Œå¦‚æœä»»åŠ¡æ•°é‡è¶…è¿‡äº† CPU çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹ä¸Šçš„ä»»åŠ¡ä»ç„¶æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚ 2.3 å¹¶å‘å¹¶å‘æŒ‡å¤šä¸ªçº¿ç¨‹åœ¨å®è§‚(ç›¸å¯¹äºè¾ƒé•¿çš„æ—¶é—´åŒºé—´è€Œè¨€)ä¸Šè¡¨ç°ä¸ºåŒæ—¶æ‰§è¡Œï¼Œè€Œå®é™…ä¸Šæ˜¯è½®æµç©¿æ’ç€æ‰§è¡Œï¼Œå¹¶å‘çš„å®è´¨æ˜¯ä¸€ä¸ªç‰©ç† CPU åœ¨è‹¥å¹²é“ç¨‹åºä¹‹é—´å¤šè·¯å¤ç”¨ï¼Œå…¶ç›®çš„æ˜¯æé«˜æœ‰é™ç‰©ç†èµ„æºçš„è¿è¡Œæ•ˆç‡ã€‚ å¹¶å‘ä¸å¹¶è¡Œä¸²è¡Œå¹¶ä¸æ˜¯äº’æ–¥çš„æ¦‚å¿µï¼Œå¦‚æœæ˜¯åœ¨ä¸€ä¸ªCPUçº¿ç¨‹ä¸Šå¯ç”¨å¹¶å‘ï¼Œé‚£ä¹ˆè‡ªç„¶å°±è¿˜æ˜¯ä¸²è¡Œçš„ï¼Œè€Œå¦‚æœåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¯ç”¨å¹¶å‘ï¼Œé‚£ä¹ˆç¨‹åºçš„æ‰§è¡Œå°±å¯ä»¥æ˜¯æ—¢å¹¶å‘åˆå¹¶è¡Œçš„ã€‚ 2.4 JVM åƒåœ¾æ”¶é›†ä¸­çš„ä¸²è¡Œã€å¹¶è¡Œå’Œå¹¶å‘åœ¨ JVM åƒåœ¾æ”¶é›†å™¨ä¸­ä¹Ÿæ¶‰åŠåˆ°å¦‚ä¸Šçš„ä¸‰ä¸ªæ¦‚å¿µã€‚ ä¸²è¡Œï¼ˆSerialï¼‰ï¼šä½¿ç”¨å•çº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶çš„å›æ”¶å™¨ã€‚ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ª CPU ä¸Šã€‚ åœ¨äº†è§£äº†è¿™äº›æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å…·ä½“ä»‹ç»å¸¸ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚ 3ã€ä¸»æµçš„åƒåœ¾æ”¶é›†å™¨3.1 Serialæ”¶é›†å™¨Serialï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨æ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ï¼ˆæ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€ç”Ÿä»£é‡‡ç”¨æ ‡å¿—æ•´ç†ç®—æ³•ï¼‰ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚ å®ƒçš„ â€œå•çº¿ç¨‹â€ çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ â€œStop The Worldâ€ ï¼šå°†ç”¨æˆ·æ­£å¸¸å·¥ä½œçš„çº¿ç¨‹å…¨éƒ¨æš‚åœæ‰ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚ ä¸Šå›¾ä¸­ï¼š æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼ŒStop-The-World è€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼ŒStop-The-World å½“å®ƒè¿›è¡ŒGCå·¥ä½œçš„æ—¶å€™ï¼Œè™½ç„¶ä¼šé€ æˆStop-The-Worldï¼Œæ­£å¦‚æ¯ç§ç®—æ³•éƒ½æœ‰å­˜åœ¨çš„åŸå› ï¼Œè¯¥ä¸²è¡Œæ”¶é›†å™¨ä¹Ÿæœ‰å­˜åœ¨çš„åŸå› ï¼šå› ä¸ºç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼Œæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšGCï¼Œè‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ•ˆç‡ã€‚ æ‰€ä»¥Serialæ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨clientæ¨¡å¼ä¸‹çš„åº”ç”¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®ƒä¾ç„¶æ˜¯è™šæ‹Ÿæœºè¿è¡Œåœ¨clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼‰ ä¸²è¡Œæ”¶é›†å™¨çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œè™šæ‹Ÿæœºçš„å¼€å‘è€…å½“ç„¶ä¹Ÿæ˜¯çŸ¥é“è¿™ä¸ªç¼ºç‚¹çš„ï¼Œæ‰€ä»¥ä¸€ç›´éƒ½åœ¨ç¼©å‡Stop The Worldçš„æ—¶é—´ã€‚ åœ¨åç»­çš„åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´åœ¨ä¸æ–­ç¼©çŸ­ï¼ˆä½†æ˜¯ä»ç„¶è¿˜æœ‰åœé¡¿ï¼Œå¯»æ‰¾æœ€ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ 3.1.1 ç‰¹ç‚¹ é’ˆå¯¹æ–°ç”Ÿä»£çš„æ”¶é›†å™¨ï¼› é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼› å•çº¿ç¨‹æ”¶é›†ï¼› è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœæ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®Œæˆï¼› å³ä¼šâ€Stop The Worldâ€ï¼› 3.1.2 åº”ç”¨åœºæ™¯ ä¾ç„¶æ˜¯HotSpotåœ¨Clientæ¨¡å¼ä¸‹é»˜è®¤çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼› ä¹Ÿæœ‰ä¼˜äºå…¶ä»–æ”¶é›†å™¨çš„åœ°æ–¹ï¼š ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼› å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨æ²¡æœ‰çº¿ç¨‹äº¤äº’ï¼ˆåˆ‡æ¢ï¼‰å¼€é”€ï¼Œå¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ï¼› åœ¨ç”¨æˆ·çš„æ¡Œé¢åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ç”¨å†…å­˜ä¸€èˆ¬ä¸å¤§ï¼ˆå‡ åMè‡³ä¸€ä¸¤ç™¾Mï¼‰ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆåƒåœ¾æ”¶é›†ï¼ˆå‡ åMSè‡³ä¸€ç™¾å¤šMSï¼‰,åªè¦ä¸é¢‘ç¹å‘ç”Ÿï¼Œè¿™æ˜¯å¯ä»¥æ¥å—çš„ 3.1.3 å‚æ•°è®¾ç½®æ·»åŠ è¯¥å‚æ•°æ¥æ˜¾å¼çš„ä½¿ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨: â€œ-XX:+UseSerialGCâ€ 3.2 ParNewæ”¶é›†å™¨ Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬-ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡ŒGC ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’ŒSerialæ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚ å®ƒæ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚ CMSæ”¶é›†å™¨æ˜¯ä¸€ä¸ªè¢«è®¤ä¸ºå…·æœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„å¹¶å‘æ”¶é›†å™¨ï¼Œå› æ­¤å¦‚æœæœ‰ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨èƒ½å’Œå®ƒä¸€èµ·æ­é…ä½¿ç”¨è®©å…¶æ›´åŠ å®Œç¾ï¼Œé‚£è¿™ä¸ªæ”¶é›†å™¨å¿…ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†äº†ã€‚ æ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 3.2.1 åº”ç”¨åœºæ™¯ï¼šåœ¨Serveræ¨¡å¼ä¸‹ï¼ŒParNewæ”¶é›†å™¨æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ”¶é›†å™¨ï¼Œå› ä¸ºé™¤Serialå¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œï¼› ä½†åœ¨å•ä¸ªCPUç¯å¢ƒä¸­ï¼Œä¸ä¼šæ¯”Serailæ”¶é›†å™¨æœ‰æ›´å¥½çš„æ•ˆæœï¼Œå› ä¸ºå­˜åœ¨çº¿ç¨‹äº¤äº’å¼€é”€ã€‚ 3.2.2 è®¾ç½®å‚æ•°æŒ‡å®šä½¿ç”¨CMSåï¼Œä¼šé»˜è®¤ä½¿ç”¨ParNewä½œä¸ºæ–°ç”Ÿä»£æ”¶é›†: â€œ-XX:+UseConcMarkSweepGCâ€ å¼ºåˆ¶æŒ‡å®šä½¿ç”¨ParNew:â€œ-XX:+UseParNewGCâ€ æŒ‡å®šåƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°é‡ï¼ŒParNewé»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹ä¸CPUçš„æ•°é‡ç›¸: â€œ-XX:ParallelGCThreadsâ€ 3.2.3 ä¸ºä»€ä¹ˆåªæœ‰ParNewèƒ½ä¸CMSæ”¶é›†å™¨é…åˆ CMSæ˜¯HotSpotåœ¨JDK1.5æ¨å‡ºçš„ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆConcurrentï¼‰æ”¶é›†å™¨ï¼Œç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œï¼› CMSä½œä¸ºè€å¹´ä»£æ”¶é›†å™¨ï¼Œä½†å´æ— æ³•ä¸JDK1.4å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼› å› ä¸ºParallel Scavengeï¼ˆä»¥åŠG1ï¼‰éƒ½æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„GCæ”¶é›†å™¨ä»£ç æ¡†æ¶ï¼Œè€Œå¦å¤–ç‹¬ç«‹å®ç°ï¼›è€Œå…¶ä½™å‡ ç§æ”¶é›†å™¨åˆ™å…±ç”¨äº†éƒ¨åˆ†çš„æ¡†æ¶ä»£ç ï¼› 3.3 Parallel Scavengeæ”¶é›†å™¨Parallel Scavengeæ”¶é›†å™¨æ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒä¹Ÿæ˜¯ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„æ”¶é›†å™¨ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ Parallel Scavengeæ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯ååé‡ï¼ˆå¦‚ä½•é«˜æ•ˆç‡çš„åˆ©ç”¨CPUï¼‰ã€‚ CMSç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚ æ‰€è°“ååé‡å°±æ˜¯CPUä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ã€‚ï¼ˆååé‡ï¼šCPUç”¨äºç”¨æˆ·ä»£ç çš„æ—¶é—´/CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³=è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´/(è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´+åƒåœ¾æ”¶é›†æ—¶é—´)ã€‚æ¯”å¦‚ï¼Œè™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚ï¼‰ è¿è¡Œç¤ºæ„å›¾ï¼š 3.3.1 ç‰¹ç‚¹ æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼› é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼› å¤šçº¿ç¨‹æ”¶é›†ï¼› CMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼›è€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ï¼› 3.3.2 åº”ç”¨åœºæ™¯ é«˜ååé‡ä¸ºç›®æ ‡ï¼Œå³å‡å°‘åƒåœ¾æ”¶é›†æ—¶é—´ï¼Œè®©ç”¨æˆ·ä»£ç è·å¾—æ›´é•¿çš„è¿è¡Œæ—¶é—´ï¼› å½“åº”ç”¨ç¨‹åºè¿è¡Œåœ¨å…·æœ‰å¤šä¸ªCPUä¸Šï¼Œå¯¹æš‚åœæ—¶é—´æ²¡æœ‰ç‰¹åˆ«é«˜çš„è¦æ±‚æ—¶ï¼Œå³ç¨‹åºä¸»è¦åœ¨åå°è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸éœ€è¦ä¸ç”¨æˆ·è¿›è¡Œå¤ªå¤šäº¤äº’ï¼› ä¾‹å¦‚ï¼Œé‚£äº›æ‰§è¡Œæ‰¹é‡å¤„ç†ã€è®¢å•å¤„ç†ï¼ˆå¯¹è´¦ç­‰ï¼‰ã€å·¥èµ„æ”¯ä»˜ã€ç§‘å­¦è®¡ç®—çš„åº”ç”¨ç¨‹åºï¼› 3.3.3 è®¾ç½®å‚æ•°Parallel Scavengeæ”¶é›†å™¨æä¾›ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼š æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ â€œ-XX:MaxGCPauseMillisâ€ æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ï¼Œå¤§äº0çš„æ¯«ç§’æ•°ï¼› MaxGCPauseMillisè®¾ç½®å¾—ç¨å°ï¼Œåœé¡¿æ—¶é—´å¯èƒ½ä¼šç¼©çŸ­ï¼Œä½†ä¹Ÿå¯èƒ½ä¼šä½¿å¾—ååé‡ä¸‹é™ï¼›å› ä¸ºå¯èƒ½å¯¼è‡´åƒåœ¾æ”¶é›†å‘ç”Ÿå¾—æ›´é¢‘ç¹ï¼› è®¾ç½®åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ â€œ-XX:GCTimeRatioâ€ è®¾ç½®åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„æ¯”ç‡ï¼Œ0 &lt; n &lt; 100çš„æ•´æ•°ï¼› GCTimeRatioç›¸å½“äºè®¾ç½®ååé‡å¤§å°ï¼› åƒåœ¾æ”¶é›†æ‰§è¡Œæ—¶é—´å åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶é—´çš„æ¯”ä¾‹çš„è®¡ç®—æ–¹æ³•æ˜¯ï¼š 1 / (1 + n) ã€‚ ä¾‹å¦‚ï¼Œé€‰é¡¹-XX:GCTimeRatio=19ï¼Œè®¾ç½®äº†åƒåœ¾æ”¶é›†æ—¶é—´å æ€»æ—¶é—´çš„5% = 1/(1+19)ï¼›é»˜è®¤å€¼æ˜¯1% = 1/(1+99)ï¼Œå³n=99ï¼› åƒåœ¾æ”¶é›†æ‰€èŠ±è´¹çš„æ—¶é—´æ˜¯å¹´è½»ä¸€ä»£å’Œè€å¹´ä»£æ”¶é›†çš„æ€»æ—¶é—´ï¼› å¦‚æœæ²¡æœ‰æ»¡è¶³ååé‡ç›®æ ‡ï¼Œåˆ™å¢åŠ ä»£çš„å†…å­˜å¤§å°ä»¥å°½é‡å¢åŠ ç”¨æˆ·ç¨‹åºè¿è¡Œçš„æ—¶é—´ï¼› 3.4 Serial Oldæ”¶é›†å™¨Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚ å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨JDK1.5ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆ 3.4.1 ç‰¹ç‚¹ é’ˆå¯¹è€å¹´ä»£ï¼› é‡‡ç”¨â€æ ‡è®°-æ•´ç†-å‹ç¼©â€ç®—æ³•ï¼ˆMark-Sweep-Compactï¼‰ï¼› å•çº¿ç¨‹æ”¶é›†ï¼› 3.4.2 åº”ç”¨åœºæ™¯ ä¸»è¦ç”¨äºClientæ¨¡å¼ï¼› è€Œåœ¨Serveræ¨¡å¼æœ‰ä¸¤å¤§ç”¨é€”ï¼šï¼ˆAï¼‰ã€åœ¨JDK1.5åŠä¹‹å‰ï¼Œä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼ˆJDK1.6æœ‰Parallel Oldæ”¶é›†å™¨å¯æ­é…Parallel Scavengeæ”¶é›†å™¨ï¼‰ï¼›ï¼ˆBï¼‰ã€ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ï¼› 3.5 Parallel Oldæ”¶é›†å™¨Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚ ä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavengeæ”¶é›†å™¨å’ŒParallel Oldæ”¶é›†å™¨ã€‚ åœ¨JDK1.6æ‰æœ‰çš„ã€‚ 3.5.1 ç‰¹ç‚¹ é’ˆå¯¹è€å¹´ä»£ï¼› é‡‡ç”¨â€æ ‡è®°-æ•´ç†-å‹ç¼©â€ç®—æ³•ï¼› å¤šçº¿ç¨‹æ”¶é›†ï¼› Parallel Scavenge/Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾å¦‚ä¸‹ 3.5.2 åº”ç”¨åœºæ™¯ JDK1.6åŠä¹‹åç”¨æ¥ä»£æ›¿è€å¹´ä»£çš„Serial Oldæ”¶é›†å™¨ï¼› ç‰¹åˆ«æ˜¯åœ¨Serveræ¨¡å¼ï¼Œå¤šCPUçš„æƒ…å†µä¸‹ï¼› è¿™æ ·åœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºæ•æ„Ÿçš„åœºæ™¯ï¼Œå°±æœ‰äº†Parallel Scavengeï¼ˆæ–°ç”Ÿä»£ï¼‰åŠ Parallel Oldï¼ˆè€å¹´ä»£ï¼‰æ”¶é›†å™¨çš„â€ç»™åŠ›â€åº”ç”¨ç»„åˆï¼› 3.5.3 è®¾ç½®å‚æ•°æŒ‡å®šä½¿ç”¨Parallel Oldæ”¶é›†å™¨: â€œ-XX:+UseParallelOldGCâ€ 3.6 CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚å®ƒéå¸¸é€‚åˆåœ¨æ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨ä¸Šä½¿ç”¨ã€‚ 3.6.1 ç‰¹ç‚¹ é’ˆå¯¹è€å¹´ä»£ åŸºäºâ€æ ‡è®°-æ¸…é™¤â€ç®—æ³•(ä¸è¿›è¡Œå‹ç¼©æ“ä½œï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡) ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ éœ€è¦æ›´å¤šçš„å†…å­˜ CMSæ˜¯HotSpotåœ¨JDK1.5æ¨å‡ºçš„ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼ˆConcurrentï¼‰æ”¶é›†å™¨ï¼› ç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œï¼› 3.6.2 åº”ç”¨åœºæ™¯ ä¸ç”¨æˆ·äº¤äº’è¾ƒå¤šçš„åœºæ™¯ï¼›ï¼ˆå¦‚å¸¸è§WEBã€B/S-æµè§ˆå™¨/æœåŠ¡å™¨æ¨¡å¼ç³»ç»Ÿçš„æœåŠ¡å™¨ä¸Šçš„åº”ç”¨ï¼‰ å¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼› ä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒï¼› 3.6.3 CMSæ”¶é›†å™¨è¿ä½œè¿‡ç¨‹ä»åå­—ä¸­çš„Mark Sweepè¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMSæ”¶é›†å™¨æ˜¯ä¸€ç§ â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸æ¯”äºå‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ•´ä¸ªè¿‡ç¨‹å¯åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼š æš‚åœæ‰€æœ‰çš„å…¶ä»–çº¿ç¨‹ï¼Œåˆå§‹æ ‡è®°ä»…ä»…æ ‡è®°GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼› å¹¶å‘æ ‡è®° å¹¶å‘æ ‡è®°å°±æ˜¯è¿›è¡ŒGC Roots Tracingçš„è¿‡ç¨‹ï¼› åŒæ—¶å¼€å¯GCå’Œç”¨æˆ·çº¿ç¨‹ï¼Œç”¨ä¸€ä¸ªé—­åŒ…ç»“æ„å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥GCçº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ï¼› é‡æ–°æ ‡è®°ï¼š é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼ˆé‡‡ç”¨å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œæ¥æå‡æ•ˆç‡ï¼‰ï¼›éœ€è¦â€Stop The Worldâ€ï¼Œä¸”åœé¡¿æ—¶é—´æ¯”åˆå§‹æ ‡è®°ç¨é•¿ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çŸ­ï¼› å¹¶å‘æ¸…é™¤ï¼š å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶GCçº¿ç¨‹å¼€å§‹å¯¹ä¸ºæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ï¼Œå›æ”¶æ‰€æœ‰çš„åƒåœ¾å¯¹è±¡ï¼› ç”±äºæ•´ä¸ªè¿‡ç¨‹è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œã€‚ æ‰€ä»¥æ€»ä½“æ¥è¯´ï¼ŒCMSçš„å†…å­˜å›æ”¶æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·â€œå¹¶å‘â€æ‰§è¡Œçš„ã€‚ 3.6.4å‚æ•°è®¾ç½®æŒ‡å®šä½¿ç”¨CMSæ”¶é›†å™¨ â€œ-XX:+UseConcMarkSweepGCâ€ 3.6.5 CMSæ”¶é›†å™¨ç¼ºç‚¹3.6.5.1 å¯¹CPUèµ„æºæ•æ„Ÿé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿï¼ˆå¹¶å‘ç¨‹åºçš„ç‰¹ç‚¹ï¼‰ã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´CPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚ï¼ˆåœ¨å¯¹è´¦ç³»ç»Ÿä¸­ï¼Œä¸é€‚åˆä½¿ç”¨CMSæ”¶é›†å™¨ï¼‰ã€‚ CMSçš„é»˜è®¤æ”¶é›†çº¿ç¨‹æ•°é‡æ˜¯=(CPUæ•°é‡+3)/4ï¼› å½“CPUæ•°é‡è¶Šå¤šï¼Œå›æ”¶çš„çº¿ç¨‹å ç”¨CPUå°±å°‘ã€‚ ä¹Ÿå°±æ˜¯å½“CPUåœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº25%çš„CPUèµ„æºï¼Œå¯¹ç”¨æˆ·ç¨‹åºå½±å“å¯èƒ½è¾ƒå¤§ï¼›ä¸è¶³4ä¸ªæ—¶ï¼Œå½±å“æ›´å¤§ï¼Œå¯èƒ½æ— æ³•æ¥å—ã€‚ï¼ˆæ¯”å¦‚ CPU=2æ—¶ï¼Œé‚£ä¹ˆå°±å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å›æ”¶ï¼Œå äº†50%çš„CPUèµ„æºã€‚ï¼‰ ï¼ˆä¸€ä¸ªå›æ”¶çº¿ç¨‹ä¼šåœ¨å›æ”¶æœŸé—´ä¸€ç›´å ç”¨CPUèµ„æºï¼‰ é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæ›¾å‡ºç°äº†â€å¢é‡å¼å¹¶å‘æ”¶é›†å™¨â€ï¼ˆIncremental Concurrent Mark Sweep/i-CMSï¼‰ï¼› ç±»ä¼¼ä½¿ç”¨æŠ¢å å¼æ¥æ¨¡æ‹Ÿå¤šä»»åŠ¡æœºåˆ¶çš„æ€æƒ³ï¼Œè®©æ”¶é›†çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹äº¤æ›¿è¿è¡Œï¼Œå‡å°‘æ”¶é›†çº¿ç¨‹è¿è¡Œæ—¶é—´ï¼› ä½†æ•ˆæœå¹¶ä¸ç†æƒ³ï¼ŒJDK1.6åå°±å®˜æ–¹ä¸å†æå€¡ç”¨æˆ·ä½¿ç”¨ã€‚ 3.6.5.2 æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾,å¯èƒ½å‡ºç°â€Concurrent Mode Failureâ€å¤±è´¥ åœ¨å¹¶å‘æ¸…é™¤æ—¶ï¼Œç”¨æˆ·çº¿ç¨‹æ–°äº§ç”Ÿçš„åƒåœ¾ï¼Œç§°ä¸ºæµ®åŠ¨åƒåœ¾ï¼› è§£å†³åŠæ³•ï¼š è¿™ä½¿å¾—å¹¶å‘æ¸…é™¤æ—¶éœ€è¦é¢„ç•™ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨åœ¨è€å¹´ä»£å‡ ä¹å¡«æ»¡å†è¿›è¡Œæ”¶é›†ï¼› ä¹Ÿå¯ä»¥è®¤ä¸ºCMSæ‰€éœ€è¦çš„ç©ºé—´æ¯”å…¶ä»–åƒåœ¾æ”¶é›†å™¨å¤§ï¼› å¯ä»¥ä½¿ç”¨â€-XX:CMSInitiatingOccupancyFractionâ€ï¼Œè®¾ç½®CMSé¢„ç•™è€å¹´ä»£å†…å­˜ç©ºé—´ï¼› 3.6.5.3 äº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡ç”±äºCMSæ˜¯åŸºäºâ€œæ ‡è®°+æ¸…é™¤â€ç®—æ³•æ¥å›æ”¶è€å¹´ä»£å¯¹è±¡çš„ï¼Œå› æ­¤é•¿æ—¶é—´è¿è¡Œåä¼šäº§ç”Ÿå¤§é‡çš„ç©ºé—´ç¢ç‰‡é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´æ–°ç”Ÿä»£å¯¹è±¡æ™‹å‡åˆ°è€ç”Ÿä»£å¤±è´¥ã€‚ ç”±äºç¢ç‰‡è¿‡å¤šï¼Œå°†ä¼šç»™å¤§å¯¹è±¡çš„åˆ†é…å¸¦æ¥éº»çƒ¦ã€‚å› æ­¤ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œè€å¹´ä»£è¿˜æœ‰å¾ˆå¤šå‰©ä½™çš„ç©ºé—´ï¼Œä½†æ˜¯æ‰¾ä¸åˆ°è¿ç»­çš„ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œè¿™æ ·ä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡Full GCã€‚ è§£å†³åŠæ³• ä½¿ç”¨â€-XX:+UseCMSCompactAtFullCollectionâ€å’Œâ€-XX:+CMSFullGCsBeforeCompactionâ€ï¼Œéœ€è¦ç»“åˆä½¿ç”¨ã€‚ UseCMSCompactAtFullCollection â€œ-XX:+UseCMSCompactAtFullCollectionâ€ ä¸ºäº†è§£å†³ç©ºé—´ç¢ç‰‡é—®é¢˜ï¼ŒCMSæ”¶é›†å™¨æä¾›âˆ’XX:+UseCMSCompactAlFullCollectionæ ‡å¿—ï¼Œä½¿å¾—CMSå‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µæ—¶ä¸è¿›è¡ŒFull GCï¼Œè€Œå¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†è¿‡ç¨‹ï¼› ä½†åˆå¹¶æ•´ç†è¿‡ç¨‹æ— æ³•å¹¶å‘ï¼Œåœé¡¿æ—¶é—´ä¼šå˜é•¿ï¼› é»˜è®¤å¼€å¯ï¼ˆä½†ä¸ä¼šè¿›è¡Œï¼Œéœ€è¦ç»“åˆCMSFullGCsBeforeCompactionä½¿ç”¨ï¼‰ï¼› CMSFullGCsBeforeCompaction ç”±äºåˆå¹¶æ•´ç†æ˜¯æ— æ³•å¹¶å‘æ‰§è¡Œçš„ï¼Œç©ºé—´ç¢ç‰‡é—®é¢˜æ²¡æœ‰äº†ï¼Œä½†æ˜¯æœ‰å¯¼è‡´äº†è¿ç»­çš„åœé¡¿ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå‚æ•°âˆ’XX:CMSFullGCsBeforeCompactionï¼Œè¡¨ç¤ºåœ¨å¤šå°‘æ¬¡ä¸å‹ç¼©çš„Full GCä¹‹åï¼Œå¯¹ç©ºé—´ç¢ç‰‡è¿›è¡Œå‹ç¼©æ•´ç†ã€‚ å¯ä»¥å‡å°‘åˆå¹¶æ•´ç†è¿‡ç¨‹çš„åœé¡¿æ—¶é—´ï¼› é»˜è®¤ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡éƒ½æ‰§è¡ŒFull GCï¼Œä¸ä¼šè¿›è¡Œå‹ç¼©æ•´ç†ï¼› ç”±äºç©ºé—´ä¸å†è¿ç»­ï¼ŒCMSéœ€è¦ä½¿ç”¨å¯ç”¨â€ç©ºé—²åˆ—è¡¨â€å†…å­˜åˆ†é…æ–¹å¼ï¼Œè¿™æ¯”ç®€å•å®ç”¨â€ç¢°æ’æŒ‡é’ˆâ€åˆ†é…å†…å­˜æ¶ˆè€—å¤§ï¼› 3.6.6 CMS&amp;Parallel Oldæ€»ä½“æ¥çœ‹ï¼ŒCMSä¸Parallel Oldåƒåœ¾æ”¶é›†å™¨ç›¸æ¯”ï¼ŒCMSå‡å°‘äº†æ‰§è¡Œè€å¹´ä»£åƒåœ¾æ”¶é›†æ—¶åº”ç”¨æš‚åœçš„æ—¶é—´ï¼› ä½†å´å¢åŠ äº†æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†æ—¶åº”ç”¨æš‚åœçš„æ—¶é—´ã€é™ä½äº†ååé‡è€Œä¸”éœ€è¦å ç”¨æ›´å¤§çš„å †ç©ºé—´ï¼› ï¼ˆåŸå› ï¼šCMSä¸è¿›è¡Œå†…å­˜ç©ºé—´æ•´ç†èŠ‚çœäº†æ—¶é—´ï¼Œä½†æ˜¯å¯ç”¨ç©ºé—´ä¸å†æ˜¯è¿ç»­çš„äº†ï¼Œåƒåœ¾æ”¶é›†ä¹Ÿä¸èƒ½ç®€å•çš„ä½¿ç”¨æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€æ¬¡å¯ç”¨æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜çš„åœ°å€äº†ã€‚ ç›¸åï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨å¯ç”¨ç©ºé—´åˆ—è¡¨ã€‚å³ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å‘æœªåˆ†é…åŒºåŸŸçš„åˆ—è¡¨ï¼Œæ¯æ¬¡ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œä¼šä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªåˆé€‚å¤§å°çš„å†…å­˜åŒºåŸŸæ¥ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜ã€‚è¿™æ ·åšçš„ç»“æœæ˜¯ï¼Œè€å¹´ä»£ä¸Šçš„å†…å­˜çš„åˆ†é…æ¯”ç®€å•å®ç”¨ç¢°æ’æŒ‡é’ˆåˆ†é…å†…å­˜æ¶ˆè€—å¤§ã€‚è¿™ä¹Ÿä¼šå¢åŠ å¹´è½»ä»£åƒåœ¾æ”¶é›†çš„é¢å¤–è´Ÿæ‹…ï¼Œå› ä¸ºè€å¹´ä»£ä¸­çš„å¤§éƒ¨åˆ†å¯¹è±¡æ˜¯åœ¨æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†çš„æ—¶å€™ä»æ–°ç”Ÿä»£æå‡ä¸ºè€å¹´ä»£çš„ã€‚ï¼‰ å½“æ–°ç”Ÿä»£å¯¹è±¡æ— æ³•åˆ†é…è¿‡å¤§å¯¹è±¡ï¼Œå°±ä¼šæ”¾åˆ°è€å¹´ä»£è¿›è¡Œåˆ†é…ã€‚ 3.7 G1æ”¶é›†å™¨ä¸Šä¸€ä»£çš„åƒåœ¾æ”¶é›†å™¨(ä¸²è¡Œserial, å¹¶è¡Œparallel, ä»¥åŠCMS)éƒ½æŠŠå †å†…å­˜åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„ä¸‰ä¸ªéƒ¨åˆ†: å¹´è½»ä»£(young generation), å¹´è€ä»£(old generation), ä»¥åŠæŒä¹…ä»£(permanent generation)ã€‚ G1ï¼ˆGarbage-Firstï¼‰æ˜¯JDK7-u4æ‰æ¨å‡ºå•†ç”¨çš„æ”¶é›†å™¨ï¼›G1 (Garbage-First)æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨ã€‚ä»¥æé«˜æ¦‚ç‡æ»¡è¶³GCåœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶ï¼Œè¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾ã€‚è¢«è§†ä¸ºJDK1.7ä¸­HotSpotè™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚G1çš„ä½¿å‘½æ˜¯åœ¨æœªæ¥æ›¿æ¢CMSï¼Œå¹¶ä¸”åœ¨JDK1.9å·²ç»æˆä¸ºé»˜è®¤çš„æ”¶é›†å™¨ã€‚ 3.7.1 ç‰¹ç‚¹3.7.1.1 å¹¶è¡Œä¸å¹¶å‘G1èƒ½å……åˆ†åˆ©ç”¨CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUï¼ˆCPUæˆ–è€…CPUæ ¸å¿ƒï¼‰æ¥ç¼©çŸ­stop-The-Worldåœé¡¿æ—¶é—´ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚ 3.7.1.2 åˆ†ä»£æ”¶é›†è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚ èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼ˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰ï¼Œè€Œä¸éœ€è¦ä¸å…¶ä»–æ”¶é›†å™¨æ­é…ï¼› èƒ½å¤Ÿé‡‡ç”¨ä¸åŒæ–¹å¼å¤„ç†ä¸åŒæ—¶æœŸçš„å¯¹è±¡ï¼› è™½ç„¶ä¿ç•™åˆ†ä»£æ¦‚å¿µï¼Œä½†Javaå †çš„å†…å­˜å¸ƒå±€æœ‰å¾ˆå¤§å·®åˆ«ï¼› å°†æ•´ä¸ªå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼› æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆï¼› 3.7.2 ç©ºé—´æ•´åˆä¸CMSçš„â€œæ ‡è®°â€“æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚ ä»æ•´ä½“çœ‹ï¼Œæ˜¯åŸºäºæ ‡è®°-æ•´ç†ç®—æ³•ï¼› ä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegioné—´ï¼‰çœ‹ï¼Œæ˜¯åŸºäºå¤åˆ¶ç®—æ³•ï¼›è¿™æ˜¯ä¸€ç§ç±»ä¼¼ç«è½¦ç®—æ³•çš„å®ç°ï¼›ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæœ‰åˆ©äºé•¿æ—¶é—´è¿è¡Œï¼› ï¼ˆç«è½¦ç®—æ³•æ˜¯åˆ†ä»£æ”¶é›†å™¨æ‰€ç”¨çš„ç®—æ³•ï¼Œç›®çš„æ˜¯åœ¨æˆç†Ÿå¯¹è±¡ç©ºé—´ä¸­æä¾›é™å®šæ—¶é—´çš„æ¸è¿›æ”¶é›†ã€‚åœ¨åé¢ä¸€ç¯‡ä¸­ä¼šä¸“é—¨ä»‹ç»ï¼‰ 3.7.3 å¯é¢„æµ‹çš„åœé¡¿è¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ã€‚å¯ä»¥æ˜ç¡®æŒ‡å®šMæ¯«ç§’æ—¶é—´ç‰‡å†…ï¼Œåƒåœ¾æ”¶é›†æ¶ˆè€—çš„æ—¶é—´ä¸è¶…è¿‡Næ¯«ç§’ã€‚åœ¨ä½åœé¡¿çš„åŒæ—¶å®ç°é«˜ååé‡ã€‚ 3.7.4 G1æ”¶é›†å™¨å»¶ä¼¸3.7.4.1 ä¸ºä»€ä¹ˆG1å¯ä»¥å®ç°å¯é¢„æµ‹åœé¡¿ å¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨Javaå †çš„è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ï¼› G1æ”¶é›†å™¨å°†å†…å­˜åˆ†å¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ¦‚å¿µä¿ç•™ï¼Œä½†æ˜¯å·²ç»ä¸å†ç‰©ç†éš”ç¦»ã€‚ G1è·Ÿè¸ªå„ä¸ªRegionè·å¾—å…¶æ”¶é›†ä»·å€¼å¤§å°ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼› æ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼ˆåç§°Garbage-Firstçš„ç”±æ¥ï¼‰ï¼› è¿™å°±ä¿è¯äº†åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ï¼› 3.7.4.2 ä¸€ä¸ªå¯¹è±¡è¢«ä¸åŒåŒºåŸŸå¼•ç”¨çš„é—®é¢˜ä¸€ä¸ªRegionä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªRegionä¸­çš„å¯¹è±¡å¯èƒ½è¢«å…¶ä»–ä»»æ„Regionä¸­å¯¹è±¡å¼•ç”¨ï¼Œåˆ¤æ–­å¯¹è±¡å­˜æ´»æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªJavaå †æ‰èƒ½ä¿è¯å‡†ç¡®ï¼Ÿ åœ¨å…¶ä»–çš„åˆ†ä»£æ”¶é›†å™¨ï¼Œä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼ˆè€ŒG1æ›´çªå‡ºï¼‰ï¼šå›æ”¶æ–°ç”Ÿä»£ä¹Ÿä¸å¾—ä¸åŒæ—¶æ‰«æè€å¹´ä»£ï¼Ÿ è¿™æ ·çš„è¯ä¼šé™ä½Minor GCçš„æ•ˆç‡ï¼› è§£å†³æ–¹æ³•ï¼š æ— è®ºG1è¿˜æ˜¯å…¶ä»–åˆ†ä»£æ”¶é›†å™¨ï¼ŒJVMéƒ½æ˜¯ä½¿ç”¨Remembered Setæ¥é¿å…å…¨å±€æ‰«æï¼š æ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Remembered Setï¼› æ¯æ¬¡Referenceç±»å‹æ•°æ®å†™æ“ä½œæ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªWrite Barrieræš‚æ—¶ä¸­æ–­æ“ä½œï¼› ç„¶åæ£€æŸ¥å°†è¦å†™å…¥çš„å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å’Œè¯¥Referenceç±»å‹æ•°æ®åœ¨ä¸åŒçš„Regionï¼ˆå…¶ä»–æ”¶é›†å™¨ï¼šæ£€æŸ¥è€å¹´ä»£å¯¹è±¡æ˜¯å¦å¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼‰ï¼› å¦‚æœä¸åŒï¼Œé€šè¿‡CardTableæŠŠç›¸å…³å¼•ç”¨ä¿¡æ¯è®°å½•åˆ°å¼•ç”¨æŒ‡å‘å¯¹è±¡çš„æ‰€åœ¨Regionå¯¹åº”çš„Remembered Setä¸­ï¼› å½“è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œåœ¨GCæ ¹èŠ‚ç‚¹çš„æšä¸¾èŒƒå›´åŠ å…¥Remembered Setï¼› å°±å¯ä»¥ä¿è¯ä¸è¿›è¡Œå…¨å±€æ‰«æï¼Œä¹Ÿä¸ä¼šæœ‰é—æ¼ã€‚ 3.7.5 åº”ç”¨åœºæ™¯ é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œé’ˆå¯¹å…·æœ‰å¤§å†…å­˜ã€å¤šå¤„ç†å™¨çš„æœºå™¨ï¼› æœ€ä¸»è¦çš„åº”ç”¨æ˜¯ä¸ºéœ€è¦ä½GCå»¶è¿Ÿï¼Œå¹¶å…·æœ‰å¤§å †çš„åº”ç”¨ç¨‹åºæä¾›è§£å†³æ–¹æ¡ˆï¼› å¦‚ï¼šåœ¨å †å¤§å°çº¦6GBæˆ–æ›´å¤§æ—¶ï¼Œå¯é¢„æµ‹çš„æš‚åœæ—¶é—´å¯ä»¥ä½äº0.5ç§’ï¼› ï¼ˆå®è·µï¼šå¯¹è´¦ç³»ç»Ÿä¸­å°†CMSåƒåœ¾æ”¶é›†å™¨ä¿®æ”¹ä¸ºG1ï¼Œé™ä½å¯¹è´¦æ—¶é—´20ç§’ä»¥ä¸Šï¼‰ å…·ä½“ä»€ä¹ˆæƒ…å†µä¸‹åº”ç”¨G1åƒåœ¾æ”¶é›†å™¨æ¯”CMSå¥½ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ç‚¹ï¼ˆä½†ä¸æ˜¯ç»å¯¹ï¼‰ï¼š è¶…è¿‡50ï¼…çš„Javaå †è¢«æ´»åŠ¨æ•°æ®å ç”¨ï¼› å¯¹è±¡åˆ†é…é¢‘ç‡æˆ–å¹´ä»£çš„æå‡é¢‘ç‡å˜åŒ–å¾ˆå¤§ï¼› GCåœé¡¿æ—¶é—´è¿‡é•¿ï¼ˆé•¿äº0.5è‡³1ç§’ï¼‰ï¼› å»ºè®®ï¼š å¦‚æœç°åœ¨é‡‡ç”¨çš„æ”¶é›†å™¨æ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œä¸ç”¨æ€¥ç€å»é€‰æ‹©G1ï¼› å¦‚æœåº”ç”¨ç¨‹åºè¿½æ±‚ä½åœé¡¿ï¼Œå¯ä»¥å°è¯•é€‰æ‹©G1ï¼› æ˜¯å¦ä»£æ›¿CMSåªæœ‰éœ€è¦å®é™…åœºæ™¯æµ‹è¯•æ‰çŸ¥é“ã€‚ï¼ˆå¦‚æœä½¿ç”¨G1åå‘ç°æ€§èƒ½è¿˜æ²¡æœ‰ä½¿ç”¨CMSå¥½ï¼Œé‚£ä¹ˆè¿˜æ˜¯é€‰æ‹©CMSæ¯”è¾ƒå¥½ï¼‰ 3.7.6 è®¾ç½®å‚æ•°å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°ï¼Œæ¥è®¾ç½®ä¸€äº›G1ç›¸å…³çš„é…ç½®ã€‚ æŒ‡å®šä½¿ç”¨G1æ”¶é›†å™¨ï¼š â€œ-XX:+UseG1GCâ€ å½“æ•´ä¸ªJavaå †çš„å ç”¨ç‡è¾¾åˆ°å‚æ•°å€¼æ—¶ï¼Œå¼€å§‹å¹¶å‘æ ‡è®°é˜¶æ®µï¼›é»˜è®¤ä¸º45ï¼š â€œ-XX:InitiatingHeapOccupancyPercentâ€ ä¸ºG1è®¾ç½®æš‚åœæ—¶é—´ç›®æ ‡ï¼Œé»˜è®¤å€¼ä¸º200æ¯«ç§’ï¼š â€œ-XX:MaxGCPauseMillisâ€ è®¾ç½®æ¯ä¸ªRegionå¤§å°ï¼ŒèŒƒå›´1MBåˆ°32MBï¼›ç›®æ ‡æ˜¯åœ¨æœ€å°Javaå †æ—¶å¯ä»¥æ‹¥æœ‰çº¦2048ä¸ªRegion: â€œ-XX:G1HeapRegionSizeâ€ æ–°ç”Ÿä»£æœ€å°å€¼ï¼Œé»˜è®¤å€¼5%: â€œ-XX:G1NewSizePercentâ€ æ–°ç”Ÿä»£æœ€å¤§å€¼ï¼Œé»˜è®¤å€¼60%: â€œ-XX:G1MaxNewSizePercentâ€ è®¾ç½®STWæœŸé—´ï¼Œå¹¶è¡ŒGCçº¿ç¨‹æ•°: â€œ-XX:ParallelGCThreadsâ€ è®¾ç½®å¹¶å‘æ ‡è®°é˜¶æ®µï¼Œå¹¶è¡Œæ‰§è¡Œçš„çº¿ç¨‹æ•°: â€œ-XX:ConcGCThreadsâ€ G1åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸçš„å¯¹è±¡æ´»æ€§éƒ½è¢«è®¡ç®—ï¼Œåœ¨å›æ”¶æ—¶å€™ï¼Œå°±å¯ä»¥æ ¹æ®ç”¨æˆ·è®¾ç½®çš„åœé¡¿æ—¶é—´ï¼Œé€‰æ‹©æ´»æ€§è¾ƒä½çš„åŒºåŸŸæ”¶é›†ï¼Œè¿™æ ·æ—¢èƒ½ä¿è¯åƒåœ¾å›æ”¶ï¼Œåˆèƒ½ä¿è¯åœé¡¿æ—¶é—´ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šé™ä½å¤ªå¤šçš„ååé‡ã€‚Remarkï¼ˆé‡æ–°æ ‡è®°ï¼‰é˜¶æ®µæ–°ç®—æ³•çš„è¿ç”¨ï¼Œä»¥åŠæ”¶é›†è¿‡ç¨‹ä¸­çš„å‹ç¼©ï¼Œéƒ½å¼¥è¡¥äº†CMSä¸è¶³ã€‚ å¼•ç”¨Oracleå®˜ç½‘çš„ä¸€å¥è¯ï¼šâ€œG1 is planned as the long term replacement for the Concurrent Mark-Sweep Collector (CMS)â€ã€‚ G1è®¡åˆ’ä½œä¸ºå¹¶å‘æ ‡è®°-æ¸…é™¤æ”¶é›†å™¨(CMS)çš„é•¿æœŸæ›¿ä»£å“ 4ã€å¦‚ä½•é€‰æ‹©åƒåœ¾æ”¶é›†å™¨åƒåœ¾æ”¶é›†å™¨ä¸»è¦å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰å¤§ç±»ï¼š ä¸²è¡Œæ”¶é›†å™¨ï¼šSerialå’ŒSerial Oldåªèƒ½æœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹æ‰§è¡Œï¼Œç”¨æˆ·çº¿ç¨‹æš‚åœã€‚ é€‚ç”¨äºå†…å­˜æ¯”è¾ƒå°çš„åµŒå…¥å¼è®¾å¤‡ ã€‚ å¹¶è¡Œæ”¶é›†å™¨[ååé‡ä¼˜å…ˆ]ï¼šParallel Scanvengeå’ŒParallel Oldå¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ é€‚ç”¨äºç§‘å­¦è®¡ç®—ã€åå°å¤„ç†ç­‰è‹¥äº¤äº’åœºæ™¯ ã€‚ å¹¶å‘æ”¶é›†å™¨[åœé¡¿æ—¶é—´ä¼˜å…ˆ]ï¼šCMSå’ŒG1ã€‚ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ(ä½†å¹¶ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½æ˜¯äº¤æ›¿æ‰§è¡Œçš„)ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸ä¼šåœé¡¿ç”¨æˆ·çº¿ç¨‹çš„è¿è¡Œã€‚ é€‚ç”¨äºå¯¹æ—¶é—´æœ‰è¦æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚Webåº”ç”¨ã€‚ å‚è€ƒèµ„æ–™https://zhuanlan.zhihu.com/p/142273073 https://juejin.cn/post/6844903877024677901 é¢è¯•å®˜ï¼šä½ å¯¹JVMåƒåœ¾æ”¶é›†å™¨äº†è§£å—ï¼Ÿ13è¿é—®ä½ æ˜¯å¦æŠ—çš„ä½ï¼ https://juejin.cn/post/6874060477031579661#heading-32 https://juejin.cn/post/6844904041080684552 https://juejin.cn/post/6844904159817236494#heading-14 https://juejin.cn/post/6844903892774289421#heading-20","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[]},{"title":"JVM-åƒåœ¾å›æ”¶æœºåˆ¶","date":"2021-07-30T11:49:33.000Z","path":"wiki/JVM-åƒåœ¾å›æ”¶æœºåˆ¶/","text":"åƒåœ¾å›æ”¶æ€»ä½“æ€è·¯ï¼š 1ã€ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼Œä¸ºä»€ä¹ˆéœ€è¦åƒåœ¾å›æ”¶ï¼› 2ã€å›æ”¶çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿç”±è°æ¥å›æ”¶è°ï¼Ÿ 3ã€å›æ”¶çš„åˆ¤æ–­æ ‡å‡†æ˜¯ä»€ä¹ˆ 4ã€ä»€ä¹ˆæ—¶å€™å›æ”¶ï¼Œå›æ”¶çš„ç§ç±»å’Œæµç¨‹æ˜¯æ€æ ·çš„ 5ã€åœ¨å“ªäº›åœ°æ–¹è¿›è¡Œå›æ”¶ 1. ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ä»»ä½•è¯­è¨€åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éƒ½ä¼šåˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿå°±æ„å‘³ç€éœ€è¦åœ¨å†…å­˜ä¸­ä¸ºè¿™äº›å¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œåœ¨è¿™äº›å¯¹è±¡å¤±å»ä½¿ç”¨çš„æ„ä¹‰çš„æ—¶å€™ï¼Œéœ€è¦é‡Šæ”¾æ‰è¿™äº›å†…å®¹ï¼Œä¿è¯å†…å­˜èƒ½å¤Ÿæä¾›ç»™æ–°çš„å¯¹è±¡ä½¿ç”¨ã€‚å¯¹äºå¯¹è±¡å†…å­˜çš„é‡Šæ”¾å°±æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä¹Ÿå«åšgcã€‚ å¯¹äºjavaå¼€å‘è€…æ¥è¯´gcæ˜¯ä¸€ä¸ªåŒåˆƒå‰‘ï¼Œä¸€æ–¹é¢ï¼Œjavaç¨‹åºå‘˜åœ¨å¼€å‘ç¨‹åºçš„æ—¶å€™ä¸éœ€è¦åƒå¼€å‘C++é‚£æ ·æ‰‹åŠ¨åˆ†é…å¯¹è±¡çš„å†…å­˜ï¼Œè¿˜è¦åœ¨åˆé€‚çš„æ—¶æœºæ‰‹åŠ¨é‡Šæ”¾ï¼Œä¸€å®šç¨‹åº¦åœ°é™ä½äº†javaç¨‹åºå‘˜çš„å¼€å‘éš¾åº¦ã€‚å¦ä¸€æ–¹é¢ï¼Œè™šæ‹Ÿæœºå¯ä»¥å¸®åŠ©ç¨‹åºå¼€å‘äººå‘˜ç®¡ç†å†…å­˜ï¼Œå¦‚æœç¨‹åºå‘˜ä¸äº†è§£è™šæ‹Ÿæœºåƒåœ¾å›æ”¶çš„åŸç†ï¼Œå¾ˆå®¹æ˜“å¼•èµ·OOMï¼Œé€ æˆæœåŠ¡çš„å´©æºƒå’Œç³»ç»Ÿçš„å®•æœºï¼› 2ã€å¯¹è±¡å¦‚ä½•åˆ¤æ´»å¯¹è±¡å­˜æ´»è¡¨ç¤ºçš„æ˜¯å½“å‰å¯¹è±¡æ˜¯å¦è¿˜åœ¨è¢«ä½¿ç”¨ï¼Œæ²¡æœ‰è¢«ä½¿ç”¨çš„å¯¹è±¡æˆ‘ä»¬å¯ä»¥ç§°å…¶ä¸ºå·²ç»â€œæ­»äº¡â€ï¼Œå¦‚æœå¯¹è±¡ä¾ç„¶åœ¨è¢«ä½¿ç”¨ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºâ€œå­˜æ´»â€çŠ¶æ€ï¼Œå¯¹è±¡æ˜¯å¦è¢«ä½¿ç”¨åˆ™æ˜¯é€šè¿‡å¯¹è±¡çš„å¼•ç”¨è¿›è¡Œåˆ¤æ–­çš„ã€‚è€Œåƒåœ¾å›æ”¶æœºåˆ¶å°±æ˜¯è´Ÿè´£å°†å·²ç»æ­»äº¡çš„å¯¹è±¡è¿›è¡Œæ¸…ç†ã€‚ ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ3ä¸ªåŒºåŸŸéšçº¿ç¨‹è€Œç”Ÿï¼Œéšçº¿ç¨‹è€Œç­ï¼Œæ ˆä¸­çš„æ ˆå¸§éšç€æ–¹æ³•çš„è¿›å…¥å’Œé€€å‡ºè€Œæœ‰æ¡ä¸ç´Šåœ°æ‰§è¡Œç€å‡ºæ ˆå’Œå…¥æ ˆçš„æ“ä½œã€‚æ¯ä¸€ä¸ªæ ˆå¸§ä¸­åˆ†é…å¤šå°‘å†…å­˜åŸºæœ¬ä¸Šæ˜¯åœ¨ç±»ç»“æ„ç¡®å®šä¸‹æ¥æ—¶å°±å·²çŸ¥çš„ï¼Œå› æ­¤è¿™å‡ ä¸ªåŒºåŸŸçš„å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½å…·å¤‡ç¡®å®šæ€§ï¼Œåœ¨è¿™å‡ ä¸ªåŒºåŸŸä¸éœ€è¦è¿‡å¤šçš„è€ƒè™‘å›æ”¶çš„é—®é¢˜ï¼Œå½“æ–¹æ³•ç»“æŸæˆ–è€…çº¿ç¨‹ç»“æŸçš„æ—¶å€™ï¼Œå†…å­˜è‡ªç„¶å°±è·Ÿç€å›æ”¶äº†ã€‚ Javaå †åˆ™å’Œä¸Šè¿°ä¸‰ç§åŒºåŸŸä¸åŒï¼ŒJavaä¸­ä¸€ä¸ªæ¥å£çš„å¤šä¸ªå®ç°ç±»éœ€è¦çš„å†…å­˜å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ–¹æ³•ä¸­çš„å¤šä¸ªåˆ†æ”¯éœ€è¦çš„å†…å­˜ä¹Ÿä¸ä¸€æ ·ï¼Œè€Œ**åªæœ‰å½“Javaç¨‹åºè¿è¡Œæ—¶æˆ‘ä»¬æ‰èƒ½çŸ¥é“å“ªäº›å¯¹è±¡ä¼šè¢«åˆ›å»º**ï¼Œæ‰€ä»¥å †ä¸­çš„å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€è¿›è¡Œçš„ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨æ‰€å…³æ³¨çš„ä¹Ÿæ˜¯è¿™éƒ¨åˆ†çš„å†…å­˜ã€‚ åƒåœ¾å›æ”¶å™¨åœ¨å¯¹å †è¿›è¡Œå›æ”¶å‰ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯è¦åˆ¤æ–­å †ä¸­çš„å¯¹è±¡å“ªäº›æ˜¯ä¾æ—§åœ¨ä½¿ç”¨çš„ï¼Œå“ªäº›å·²ç»ä¸å¯èƒ½å†è¢«ä½¿ç”¨äº†ã€‚è¿™é‡Œçš„åˆ¤æ–­ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œç¬¬äºŒç§æ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚ 2.1 å¼•ç”¨è®¡æ•°ç®—æ³•å¼•ç”¨è®¡æ•°ç®—æ³•ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ 1ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡1ï¼Œä»»ä½•æ—¶åˆ»è®¡æ•°å™¨ä¸º0çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚è¿™ç§ç®—æ³•å®ç°ç®€å•ï¼Œåˆ¤å®šæ•ˆç‡ä¹Ÿå¾ˆé«˜ï¼Œä½†æ˜¯å®ƒéš¾ä»¥è§£å†³å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¾‹å¦‚å¯¹è±¡Aå’Œå¯¹è±¡Bç›¸äº’å¼•ç”¨äº†å¯¹æ–¹ï¼Œè€ŒAå’ŒBéƒ½æ²¡æœ‰åœ¨è¢«ä½¿ç”¨äº†ï¼Œä½†è¿™ä¸¤ä¸ªå¯¹è±¡å´ä¹Ÿä¸ä¼šè¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚ 2.2 å¯è¾¾æ€§åˆ†æä¸»æµçš„åˆ¤æ–­æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚è¿™ä¸ªç®—æ³•éœ€è¦é€‰æ‹©ä¸€äº›å¯¹è±¡ä½œä¸ºâ€œGC Rootsâ€ï¼Œæ¯æ¬¡éƒ½é€šè¿‡è¿™äº›rootsèŠ‚ç‚¹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsä¸å­˜åœ¨å¼•ç”¨é“¾çš„æ—¶å€™ï¼Œåˆ™è¯æ˜è¿™ä¸ªå¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ åœ¨Javaè¯­è¨€ä¸­ï¼Œå¯ä½œä¸ºGC Rootsçš„å¯¹è±¡åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š 1ã€è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡2ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡3ã€æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡4ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­æ ¹æ®GC Rootsæ‰¾å¼•ç”¨é“¾ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸»è¦çš„é—®é¢˜ã€‚ ä¸€ä¸ªæ˜¯å¯ä½œä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨ï¼ˆä¾‹å¦‚å¸¸é‡æˆ–è€…ç±»é™æ€å±æ€§ï¼‰äºä¸Šä¸‹æ–‡(ä¾‹å¦‚æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­ï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨ä»…ä»…æ–¹æ³•åŒºå°±æœ‰æ•°ç™¾å…†ï¼Œå¦‚æœè¦é€ä¸ªæ£€æŸ¥è¿™é‡Œé¢çš„å¼•ç”¨ï¼Œå°†ä¼šæ¶ˆè€—å¾ˆå¤šçš„æ—¶é—´ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯GCåœé¡¿ï¼Œå¯è¾¾æ€§åˆ†æå¿…é¡»ç¡®ä¿åœ¨æ•´ä¸ªçš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œç³»ç»Ÿå°±åƒè¢«å†»ç»“åœ¨æŸä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œæ•´ä¸ªåˆ†æè¿‡ç¨‹ä¸­å¯¹è±¡çš„å¼•ç”¨å…³ç³»ä¸èƒ½å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯åˆ†æç»“æœçš„å‡†ç¡®æ€§ï¼Œå› æ­¤åœ¨è¿›è¡ŒGCæ—¶ï¼Œéœ€è¦åœé¡¿æ‰€æœ‰çš„Javaçº¿ç¨‹ã€‚ï¼ˆStop The Worldï¼‰ 3.3 å¯¹è±¡ä¸¤æ¬¡æ ‡è®°åˆ¤æ´»å³ä½¿åœ¨å¯è¾¾æ€§åˆ†æç®—æ³•ä¸­ä¸å¯è¾¾çš„å¯¹è±¡ï¼Œä¹Ÿå¹¶éæ˜¯â€éæ­»ä¸å¯â€œçš„ï¼Œè¿™æ—¶å€™å®ƒä»¬æš‚æ—¶å¤„äºâ€ç¼“åˆ‘â€œé˜¶æ®µï¼Œè¦å®£å‘Šä¸€ä¸ªå¯¹è±¡æ­»äº¡ï¼Œè‡³å°‘è¦ç»å†ä¸¤æ¬¡æ ‡è®°è¿‡ç¨‹ï¼š å¦‚æœå¯¹è±¡åœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æåå‘ç°æ²¡æœ‰ä¸GC Rootsç›¸è¿æ¥çš„å¼•ç”¨é“¾ï¼Œé‚£å®ƒå°†ä¼šè¢«ç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ï¼Œç­›é€‰çš„æ¡ä»¶æ˜¯æ­¤å¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•(å½“å¯¹è±¡æ²¡æœ‰è¦†ç›–finalize()æ–¹æ³•ï¼Œæˆ–è€…finalize()æ–¹æ³•å·²ç»è¢«è™šæ‹Ÿæœºè°ƒç”¨è¿‡ï¼Œè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æƒ…å†µéƒ½è§†ä¸ºâ€æ²¡æœ‰å¿…è¦æ‰§è¡Œâ€œ)ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åˆ¤å®šä¸ºæœ‰å¿…è¦æ‰§è¡Œfinalize()æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†ä¼šæ”¾ç½®åœ¨ä¸€ä¸ªå«åšF-Queueçš„é˜Ÿåˆ—ä¹‹ä¸­ï¼Œå¹¶åœ¨ç¨åç”±ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ã€ä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»æ‰§è¡Œå®ƒã€‚è¿™é‡Œçš„æ‰§è¡Œæ˜¯æŒ‡ç”±è™šæ‹Ÿæœºå»è§¦å‘è¿™ä¸ªæ–¹æ³•ï¼Œä½†å¹¶ä¸ä¸€å®šä¼šç­‰å¾…è¯¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼ˆä¸ºäº†é¿å…finalizeæ–¹æ³•ä¸­å‡ºç°ç±»ä¼¼æ­»å¾ªç¯éƒ½æ“ä½œï¼Œå¯¼è‡´å†…å­˜æ— æ³•è¢«å›æ”¶ï¼ŒåŒæ—¶å¯¼è‡´F-Queueé˜Ÿåˆ—ä¸­çš„å…¶ä»–å¯¹è±¡ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼‰ã€‚ å½“æ‰§è¡Œå®Œfinalze()æ–¹æ³•åï¼ŒGCå°†ä¼šå¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡çš„æ ‡è®°ï¼Œå¦‚æœå¯¹è±¡åœ¨finalize()æ–¹æ³•ä¸­åˆé‡æ–°è·å¾—äº†å¼•ç”¨ï¼Œå¯¹è±¡å°†ä¼šè¢«ç§»å‡ºå¯¹åˆ—å¹¶ä¸”ç»§ç»­å­˜æ´»ï¼Œå¦‚æœå¯¹è±¡ä¾æ—§å­˜åœ¨äºé˜Ÿåˆ—ä¸­å¹¶ä¸”è¢«è¿›è¡Œç¬¬äºŒæ¬¡æ ‡è®°ï¼Œå¯¹è±¡å°†è¢«GCå›æ”¶ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ä»»ä½•ä¸€ä¸ªå¯¹è±¡çš„finalize()æ–¹æ³•åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœç¬¬ä¸€æ¬¡é€šè¿‡finalize()æ–¹æ³•æ•‘æ´»äº†å¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ç›¸åŒçš„æ–¹æ³•å°±ä¼šå¤±æ•ˆã€‚åŒæ—¶ç”±äºfinalize()æ–¹æ³•çš„è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤åº”å½“å°½é‡é¿å…ä½¿ç”¨finalize()æ–¹æ³•ã€‚ 3. å¯¹è±¡å¼•ç”¨åˆ†ç±»JDK1.2ä»¥å‰ï¼ŒJavaä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼Œå¦‚æœreferenceç±»å‹çš„æ•°æ®ä¸­å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå°±ç§°è¿™å—å†…å­˜ä»£è¡¨ç€ä¸€ä¸ªå¼•ç”¨ã€‚è¿™ç§å®šä¹‰ä¸‹çš„å¯¹è±¡åªå­˜åœ¨ä¸¤ç§çŠ¶æ€ï¼Œè¢«å¼•ç”¨å’Œæœªè¢«å¼•ç”¨çŠ¶æ€ã€‚ä½†æœ‰äº›å¯¹è±¡æˆ‘ä»¬å¸Œæœ›å½“å†…å­˜å­˜å¤Ÿçš„æ—¶å€™èƒ½å¤Ÿä¿ç•™è¿™äº›å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³çš„æ—¶å€™åˆ™èƒ½å¤Ÿå¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè¿™ä¸€ç±»å¯¹è±¡åˆ™æ— æ³•ä½¿ç”¨è¿™ç§ä¼ ç»Ÿçš„å®šä¹‰æ¥è¡¨ç¤ºã€‚ JDK1.2ä¹‹åï¼ŒJavaå¯¹å¼•ç”¨è¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨å’Œè™šå¼•ç”¨å››ç§ï¼Œè¿™å››ç§å¼•ç”¨çš„å¼ºåº¦ä¾æ¬¡é€æ¸å‡å¼±ã€‚ 3.1 å¼ºå¼•ç”¨å°±æ˜¯æŒ‡åœ¨ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„ï¼Œç±»ä¼¼ Object obj = new Object() è¿™ç±»çš„å¼•ç”¨ï¼Œåªè¦å¼ºå¼•ç”¨è¿˜å­˜åœ¨ï¼Œåƒåœ¾æ”¶é›†å™¨æ°¸è¿œä¸ä¼šå›æ”¶è¢«å¼•ç”¨çš„å¯¹è±¡ã€‚å³ä½¿å†…å­˜ä¸è¶³æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä¼šç›´æ¥æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚å¦‚æœæƒ³è®©å¼ºå¼•ç”¨å¯¹è±¡è¢«å›æ”¶ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®obj = null;æ¥å®ç°ã€‚ 3.2 è½¯å¼•ç”¨ç”¨æ¥æè¿°ä¸€äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…éœ€çš„å¯¹è±¡ã€‚å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåœ¨å†…å­˜è¶³å¤Ÿçš„æ—¶å€™ï¼Œæ˜¯ä¸ä¼šå›æ”¶è½¯å¼•ç”¨çš„å¯¹è±¡çš„ï¼Œè€Œåœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´ä¹‹ä¸­è¿›è¡Œç¬¬äºŒæ¬¡å›æ”¶ï¼Œå¦‚æœè½¯å¼•ç”¨å›æ”¶åä¾ç„¶å†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†SoftReferenceç±»æ¥å®ç°è½¯å¼•ç”¨ã€‚è½¯å¼•ç”¨å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜æŠ€æœ¯ã€‚ 3.3 å¼±å¼•ç”¨å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨ä¸€æ ·ç”¨æ¥æè¿°éå¿…é¡»çš„å¯¹è±¡ï¼Œä½†æ˜¯å®ƒçš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´å¼±ä¸€äº›ï¼Œè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚å½“åƒåœ¾æ”¶é›†å™¨å·¥ä½œæ—¶ï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†WeakReferenceç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚ 3.4 è™šå¼•ç”¨è™šå¼•ç”¨ä¹Ÿè¢«ç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨å…³ç³»ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚åœ¨JDK1.2ä¹‹åï¼Œæä¾›äº†PhantomReferenceç±»æ¥å®ç°è™šå¼•ç”¨ã€‚ 4.åƒåœ¾å›æ”¶ç®—æ³•åƒåœ¾æ”¶é›†ç®—æ³•çš„ç›®çš„æ˜¯åœ¨å·²ç»æ˜ç¡®äº†å“ªäº›å†…å­˜å—éœ€è¦å›æ”¶ä»¥åï¼Œå¦‚ä½•é«˜æ•ˆçš„å›æ”¶è¿™äº›å†…å­˜ç©ºé—´ã€‚ 4.1 æ ‡è®°æ¸…é™¤ç®—æ³•æ ‡è®°-æ¸…é™¤ç®—æ³•é‡‡ç”¨ä»æ ¹é›†åˆè¿›è¡Œæ‰«æï¼Œå¯¹å­˜æ´»çš„å¯¹è±¡å¯¹è±¡æ ‡è®°ï¼Œæ ‡è®°å®Œæ¯•åï¼Œå†æ‰«ææ•´ä¸ªç©ºé—´ä¸­æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼Œè¿›è¡Œå›æ”¶ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸éœ€è¦è¿›è¡Œå¯¹è±¡çš„ç§»åŠ¨ï¼Œå¹¶ä¸”ä»…å¯¹ä¸å­˜æ´»çš„å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œåœ¨å­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æä¸ºé«˜æ•ˆã€‚ æ ‡è®°æ¸…é™¤ç®—æ³•ä¸»è¦æœ‰ä¸¤ä¸ªä¸è¶³ä¹‹å¤„ï¼šä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›å¦ä¸€ä¸ªé—®é¢˜æ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šé€ æˆå†…å­˜ç©ºé—´ä¸­å­˜åœ¨å¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šæ—¶ï¼Œå½“è¦åˆ†é…ä¸€ç‰‡å¤§å†…å­˜ç©ºé—´æ—¶å¯èƒ½ä¼šæ‰¾ä¸åˆ°åˆé€‚çš„è¿ç»­å†…å­˜ç©ºé—´è¿›è¡Œåˆ†é…ï¼Œä»è€Œè§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚ 4.2 æ ‡è®°å¤åˆ¶ç®—æ³•è¯¥ç®—æ³•çš„æå‡ºæ˜¯ä¸ºäº†å…‹æœå¥æŸ„çš„å¼€é”€å’Œè§£å†³å †ç¢ç‰‡çš„åƒåœ¾å›æ”¶ã€‚å»ºç«‹åœ¨å­˜æ´»å¯¹è±¡å°‘ï¼Œåƒåœ¾å¯¹è±¡å¤šçš„å‰æä¸‹ã€‚æ­¤ç®—æ³•æ¯æ¬¡åªå¤„ç†æ­£åœ¨ä½¿ç”¨ä¸­çš„å¯¹è±¡ï¼Œå› æ­¤å¤åˆ¶æˆæœ¬æ¯”è¾ƒå°ï¼ŒåŒæ—¶å¤åˆ¶è¿‡å»åè¿˜èƒ½è¿›è¡Œç›¸åº”çš„å†…å­˜æ•´ç†ï¼Œä¸ä¼šå‡ºç°ç¢ç‰‡é—®é¢˜ã€‚ä½†ç¼ºç‚¹ä¹Ÿæ˜¯å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯éœ€è¦ä¸¤å€å†…å­˜ç©ºé—´ã€‚ å®ƒå¼€å§‹æ—¶æŠŠå †åˆ†æˆ ä¸€ä¸ªå¯¹è±¡é¢å’Œå¤šä¸ªç©ºé—²é¢ï¼Œ ç¨‹åºä»å¯¹è±¡é¢ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ï¼Œå½“å¯¹è±¡æ»¡äº†ï¼ŒåŸºäºcopyingç®—æ³•çš„åƒåœ¾ æ”¶é›†å°±ä»æ ¹é›†ä¸­æ‰«ææ´»åŠ¨å¯¹è±¡ï¼Œå¹¶å°†æ¯ä¸ªæ´»åŠ¨å¯¹è±¡å¤åˆ¶åˆ°ç©ºé—²é¢(ä½¿å¾—æ´»åŠ¨å¯¹è±¡æ‰€å çš„å†…å­˜ä¹‹é—´æ²¡æœ‰ç©ºé—²æ´)ï¼Œè¿™æ ·ç©ºé—²é¢å˜æˆäº†å¯¹è±¡é¢ï¼ŒåŸæ¥çš„å¯¹è±¡é¢å˜æˆäº†ç©ºé—²é¢ï¼Œç¨‹åºä¼šåœ¨æ–°çš„å¯¹è±¡é¢ä¸­åˆ†é…å†…å­˜ã€‚ä¸€ç§å…¸å‹çš„åŸºäºcopingç®—æ³•çš„åƒåœ¾å›æ”¶æ˜¯stop-and-copyç®—æ³•ï¼Œå®ƒå°†å †åˆ†æˆå¯¹è±¡é¢å’Œç©ºé—²åŒºåŸŸé¢ï¼Œåœ¨å¯¹è±¡é¢ä¸ç©ºé—²åŒºåŸŸé¢çš„åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œç¨‹åºæš‚åœæ‰§è¡Œã€‚ ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½ä¼šé‡‡ç”¨è¿™ç§ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼Œæ ¹æ®ç»Ÿè®¡æ–°ç”Ÿä»£ä¸­98%çš„å¯¹è±¡éƒ½æ˜¯â€œæœå¤•ç”Ÿæ­»â€çš„ï¼Œå› æ­¤å¯¹äºæ–°ç”Ÿä»£çš„å›æ”¶ä¸ç”¨æŒ‰ç…§1:1çš„æ¯”ä¾‹æ¥è¿›è¡Œå†…å­˜åˆ’åˆ†ï¼Œå¯ä»¥å°†å†…å­˜åˆ’åˆ†ä¸ºä¸€å—EdenåŒºåŸŸå’Œä¸¤å—Survivorç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éƒ½é€‰æ‹©EdenåŒºåŸŸå’Œä¸€å—SurvivoråŒºåŸŸè¿›è¡Œå†…å­˜åˆ†é…ã€‚å½“å›æ”¶æ—¶ï¼Œå°†EdenåŒºåŸŸå’ŒSurvivoråŒºåŸŸä¸­è¿˜å­˜æ´»çš„å¯¹è±¡å…¨éƒ¨ç§»åŠ¨åˆ°å¦ä¸€å—SurvivoråŒºåŸŸï¼Œç„¶åæ¸…ç†æ‰EdenåŒºåŸŸå’Œåˆšåˆšä½¿ç”¨çš„SurvivoråŒºåŸŸã€‚ HotSpotè™šæ‹Ÿæœºä¸­Edenå’ŒSurvivorçš„æ¯”ä¾‹æ˜¯1:8ï¼Œå³æ¯æ¬¡éƒ½æœ‰90%çš„å†…å­˜ç©ºé—´åœ¨è¿›è¡Œä½¿ç”¨ï¼Œåªæœ‰10%çš„å†…å­˜ç©ºé—´è¢«æµªè´¹äº†ã€‚å½“ç„¶ï¼Œå¦‚æœæ¯æ¬¡å†…å­˜éƒ½æœ‰98%è¢«å›æ”¶ï¼Œé‚£ä¹ˆæ¯æ¬¡è¢«ç§»åŠ¨åˆ°å¦ä¸€å—SurvivoråŒºåŸŸçš„å†…å­˜åªæœ‰2%ï¼Œè¿™æ ·æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœç§»åŠ¨åˆ°å¦ä¸€å—SurvivoråŒºåŸŸçš„å†…å­˜è¶…è¿‡äº†10%ï¼Œå°±éœ€è¦ä¾èµ–å…¶ä»–çš„å†…å­˜ï¼ˆè¿™é‡ŒæŒ‡è€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿äº†ï¼ˆå°†å¤šå‡ºçš„å¯¹è±¡åˆ†é…åˆ°è€å¹´ä»£ï¼‰ã€‚ 4.3 æ ‡è®°æ•´ç†ç®—æ³• æ­¤ç®—æ³•æ˜¯ç»“åˆäº†â€œæ ‡è®°-æ¸…é™¤â€å’Œâ€œå¤åˆ¶ç®—æ³•â€ä¸¤ä¸ªç®—æ³•çš„ä¼˜ç‚¹ã€‚é¿å…äº†â€œæ ‡è®°-æ¸…é™¤â€çš„ç¢ç‰‡é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†â€œå¤åˆ¶â€ç®—æ³•çš„ç©ºé—´é—®é¢˜ã€‚ æ ‡è®°-æ•´ç†ç®—æ³•çš„æ ‡è®°è¿‡ç¨‹å’Œæ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ ‡è®°è¿‡ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯åœ¨æ ‡è®°å®Œä»¥åï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ä¼šå°†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½ç§»åŠ¨åˆ°ä¸€ç«¯ï¼Œç„¶åå†è¿›è¡Œæ¸…é™¤ã€‚è¿™ç§ç®—æ³•é€‚ç”¨äºè€å¹´ä»£ï¼Œå› ä¸ºè€å¹´ä»£çš„å¯¹è±¡å­˜æ´»ç‡éƒ½ä¼šæ¯”è¾ƒé«˜ï¼Œå¦‚æœåƒä¹‹å‰ä¸€æ ·è¿›è¡Œå¤åˆ¶ç§»åŠ¨ï¼Œå°†ä¼šäº§ç”Ÿå¤§é‡çš„å¤åˆ¶æ“ä½œå¯¼è‡´æ•ˆç‡å˜ä½ï¼ŒåŒæ—¶æ¯æ¬¡éƒ½ä¼šå­˜æ´»ä¸‹å¤§é‡å¯¹è±¡å¯¼è‡´éœ€è¦å¾ˆå¤šçš„å†…å­˜ç©ºé—´æ¥è¿›è¡Œåˆ†é…æ‹…ä¿ã€‚ 4.4 åˆ†ä»£æ”¶é›†ç®—æ³• å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨â€œåˆ†ä»£æ”¶é›†â€ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ’åˆ†ä½æ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚æ–°ç”Ÿä»£ä¸­æ¯æ¬¡éƒ½ä¼šæœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤å¯ä»¥é€‰ç”¨å¤åˆ¶ç®—æ³•ã€‚ è€å¹´ä»£æ¯æ¬¡éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤é€‰æ‹©æ ‡è®°-æ¸…ç†æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•æ¥è¿›è¡Œã€‚","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[]},{"title":"JVM-å¯¹è±¡åˆ›å»º","date":"2021-07-30T06:42:55.000Z","path":"wiki/JVM-å¯¹è±¡åˆ›å»º/","text":"1.å¯¹è±¡åˆ›å»ºæ–¹å¼Javaä¸­æœ‰ä¸€ä¸‹å‡ ç§æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼š æ–¹å¼ å®è´¨ ä½¿ç”¨newå…³é”® è°ƒç”¨æ— å‚æˆ–æœ‰å‚æ„é€ å™¨å‡½æ•°åˆ›å»º ä½¿ç”¨Classçš„newInstanceæ–¹æ³• è°ƒç”¨æ— å‚æˆ–æœ‰å‚æ„é€ å™¨å‡½æ•°åˆ›å»ºï¼Œä¸”éœ€è¦æ˜¯publiçš„æ„é€ å‡½æ•° ä½¿ç”¨Constructorç±»çš„newInstanceæ–¹æ³• è°ƒç”¨æœ‰å‚å’Œç§æœ‰privateæ„é€ å™¨å‡½æ•°åˆ›å»ºï¼Œå®ç”¨æ€§æ›´å¹¿ ä½¿ç”¨Cloneæ–¹æ³• ä¸è°ƒç”¨ä»»ä½•å‚æ„é€ å™¨å‡½æ•°ï¼Œä¸”å¯¹è±¡éœ€è¦å®ç°Cloneableæ¥å£å¹¶å®ç°å…¶å®šä¹‰çš„cloneæ–¹æ³•ï¼Œä¸”é»˜è®¤ä¸ºæµ…å¤åˆ¶ ç¬¬ä¸‰æ–¹åº“Objenesis åˆ©ç”¨äº†asmå­—èŠ‚ç æŠ€æœ¯ï¼ŒåŠ¨æ€ç”ŸæˆConstructorå¯¹è±¡ 2ã€å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ 2.1 ç±»çš„åŠ è½½è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡newæŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚ 2.2 åˆ†é…å†…å­˜ç±»çš„åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥æ˜¯ä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ã€‚ä½†ç±»åŠ è½½å®Œæˆåæ‰€éœ€çš„å†…å­˜å¤§å°å°±å·²ç»å®Œå…¨ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä»javaå †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚åˆ†é…å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰ï¼šå‡è®¾javaå †ä¸­å†…å­˜æ˜¯ç»å¯¹è§„æ•´çš„ï¼Œæ‰€æœ‰ç”¨è¿‡å¾—å†…å­˜éƒ½æ”¾åœ¨ä¸€è¾¹ï¼Œç©ºé—²çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æ”¾ç€ä¸€ä¸ªæŒ‡é’ˆä½œä¸ºåˆ†ç•Œç‚¹çš„æŒ‡ç¤ºå™¨ï¼Œé‚£æ‰€åˆ†é…å†…å­˜å°±ä»…ä»…æ˜¯æŠŠé‚£ä¸ªæŒ‡é’ˆå‘ç©ºé—²ç©ºé—´é‚£è¾¹æŒªåˆ°ä¸€æ®µä¸å¯¹è±¡å¤§å°ç›¸ç­‰çš„è·ç¦» ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰ï¼šå¦‚æœjavaå †ä¸­çš„å†…å­˜å¹¶ä¸æ˜¯å®Œæ•´çš„ï¼Œå·²ä½¿ç”¨çš„å†…å­˜å’Œç©ºé—²çš„å†…å­˜ç›¸äº’äº¤é”™ï¼Œé‚£å°±æ²¡æœ‰åŠæ³•ç®€å•åœ°è¿›è¡ŒæŒ‡é’ˆç¢°æ’äº†ï¼Œè™šæ‹Ÿæœºå°±å¿…é¡»ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè®°å½•ä¸Šå“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ä»åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œå¹¶æ›´æ–°åˆ—è¡¨ä¸Šçš„è®°å½•ã€‚ é€‰æ‹©å“ªç§åˆ†é…æ–¹å¼ç”±javaå †æ˜¯å¦å®Œæ•´å†³å®šï¼Œè€Œjavaå †æ˜¯å¦è§„æ•´åˆç”±æ‰€é‡‡ç”¨çš„åƒåœ¾æ”¶é›†å™¨æ˜¯å¦å¸¦æœ‰å‹ç¼©æ•´ç†ï¼ˆæ ‡è®°-æ•´ç†ï¼‰åŠŸèƒ½å†³å®šã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨Serialã€ParNewç­‰å¸¦æœ‰Compactè¿‡ç¨‹çš„æ”¶é›†å™¨æ—¶ï¼Œç³»ç»Ÿé‡‡ç”¨çš„åˆ†é…ç®—æ³•æ˜¯æŒ‡é’ˆç¢°æ’ï¼Œè€Œä½¿ç”¨CMSè¿™ç§åŸºäºMark-Sweepç®—æ³•çš„æ”¶é›†å™¨æ—¶ï¼Œé€šå¸¸é‡‡ç”¨ç©ºé—²åˆ—è¡¨ã€‚ è¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å¯¹è±¡é¢‘ç¹çš„åˆ›å»ºï¼ˆå³ä½¿æ˜¯ä¿®æ”¹ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡çš„ä½ç½®ï¼‰ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ä¼šå¸¦æ¥çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ä½œä¸ºè™šæ‹Ÿæœºæ¥è¯´ï¼Œå¿…é¡»ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€æœ‰è™šæ‹Ÿæœºé‡‡ç”¨ä¸¤ç§æ–¹å¼ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š CAS+å¤±è´¥é‡è¯•ï¼šCASæ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚è™šæ‹Ÿæœºé‡‡ç”¨CASé…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ï¼šä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨EdenåŒºåˆ†é…ä¸€å—å†…å­˜ï¼ŒJVMåœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨TLABåˆ†é…ï¼Œå½“å¯¹è±¡å¤§äºTLABä¸­å‰©ä½™å†…å­˜æˆ–TLABçš„å†…å­˜å·²ç”¨å°½æ—¶ï¼Œåœ¨é‡‡ç”¨ä¸Šè¿°çš„CASè¿›è¡Œå†…å­˜åˆ†é… 2.3 åˆå§‹åŒ–é›¶å€¼å†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™â¼€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿â½¤ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚ 2.4 è®¾ç½®å¯¹è±¡å¤´åˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›â¾å¿…è¦çš„è®¾ç½®ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚ è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨å¯¹è±¡å¤´ä¸­ã€‚ å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿â¾çŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯â½¤åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®â½…å¼ã€‚ 2.5 æ‰§è¡ŒInitæ–¹æ³•åœ¨ä¸Šâ¾¯â¼¯ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†â»†æ¥çœ‹ï¼Œâ¼€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§â½£äº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†â»†æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹ï¼Œ &lt;init&gt; â½…æ³•è¿˜æ²¡æœ‰æ‰§â¾ï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ã€‚æ‰€ä»¥â¼€èˆ¬æ¥è¯´ï¼Œæ‰§â¾ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§â¾ &lt;init&gt;â½…æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›â¾åˆå§‹åŒ–ï¼Œè¿™æ ·â¼€ä¸ªçœŸæ­£å¯â½¤çš„å¯¹è±¡æ‰ç®—å®Œå…¨äº§â½£å‡ºæ¥ã€‚ 3.å¯¹è±¡åœ¨å†…å­˜å¸ƒå±€ å¯¹è±¡å¤´(Header)ï¼šåŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œ32 ä½è™šæ‹Ÿæœºå  32 bitï¼Œ64 ä½è™šæ‹Ÿæœºå  64 bitã€‚å®˜æ–¹ç§°ä¸º â€˜Mark Wordâ€™ã€‚ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»çš„å…ƒæ•°æ®æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚å¦å¤–ï¼Œå¦‚æœæ˜¯ Java æ•°ç»„ï¼Œå¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸ºæ™®é€šå¯¹è±¡å¯ä»¥é€šè¿‡ Java å¯¹è±¡å…ƒæ•°æ®ç¡®å®šå¤§å°ï¼Œè€Œæ•°ç»„å¯¹è±¡ä¸å¯ä»¥ã€‚ å®ä¾‹æ•°æ®(Instance Data)ï¼šç¨‹åºä»£ç ä¸­æ‰€å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µå†…å®¹(åŒ…å«çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å’Œå­ç±»ä¸­å®šä¹‰çš„)ã€‚ å¯¹é½å¡«å……(Padding)ï¼šä¸æ˜¯å¿…ç„¶éœ€è¦ï¼Œä¸»è¦æ˜¯å ä½ï¼Œä¿è¯å¯¹è±¡å¤§å°æ˜¯æŸä¸ªå­—èŠ‚çš„æ•´æ•°å€ã€‚ 4. å¯¹è±¡è®¿é—®å»ºâ½´å¯¹è±¡å°±æ˜¯ä¸ºäº†ä½¿â½¤å¯¹è±¡ï¼Œæˆ‘ä»¬çš„Javaç¨‹åºé€šè¿‡æ ˆä¸Šçš„ reference æ•°æ®æ¥æ“ä½œå †ä¸Šçš„å…·ä½“å¯¹è±¡ã€‚å¯¹è±¡çš„è®¿é—®â½…å¼æœ‰è™šæ‹Ÿæœºå®ç°â½½å®šï¼Œâ½¬å‰ä¸»æµçš„è®¿é—®â½…å¼æœ‰ä½¿â½¤å¥æŸ„å’Œç›´æ¥æŒ‡é’ˆä¸¤ç§ï¼š 4.1 å¥æŸ„è®¿é—® å¦‚æœä½¿â½¤å¥æŸ„çš„è¯ï¼Œé‚£ä¹ˆJavaå †ä¸­å°†ä¼šåˆ’åˆ†å‡ºâ¼€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œâ½½å¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸ç±»å‹æ•°æ®å„â¾ƒçš„å…·ä½“åœ°å€ä¿¡æ¯ï¼› 4 .2 ç›´æ¥æŒ‡é’ˆ å¦‚æœä½¿â½¤ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œé‚£ä¹ˆ Java å †å¯¹è±¡çš„å¸ƒå±€ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œâ½½reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡çš„åœ°å€ã€‚ è¿™ä¸¤ç§å¯¹è±¡è®¿é—®â½…å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿â½¤å¥æŸ„æ¥è®¿é—®çš„æœ€â¼¤å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œâ½½ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿â½¤ç›´æ¥æŒ‡é’ˆè®¿é—®â½…å¼æœ€â¼¤çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†â¼€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚ 5ã€å¯¹è±¡å†…å­˜åˆ†é… Javaå†…å­˜ä½“ç³»ä¸­æ‰€æå€¡çš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€ç»ˆå¯ä»¥å½’ç»“ä¸ºè‡ªåŠ¨åŒ–åœ°è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼šç»™å¯¹è±¡åˆ†é…å†…å­˜å’Œå›æ”¶åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜ã€‚ å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œå¾€å¤§æ–¹å‘è®²ï¼Œå°±æ˜¯åœ¨å †ä¸Šåˆ†é…ï¼Œå¯¹è±¡ä¸»è¦åˆ†é…åœ¨æ–°ç”Ÿä»£çš„EdenåŒºåŸŸï¼Œå¦‚æœå¯åŠ¨äº†æœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼Œå°†æŒ‰çº¿ç¨‹ä¼˜å…ˆåˆ†é…åœ¨TLABä¸Šã€‚å°‘æ•°æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ã€‚å…·ä½“çš„åˆ†é…è§„åˆ™å–å†³äºåƒåœ¾æ”¶é›†å™¨çš„ç±»å‹ä»¥åŠè™šæ‹Ÿæœºä¸­å‚æ•°çš„é…ç½®ã€‚ä½†æ˜¯æœ‰å‡ æ¡æœ€æ™®éçš„å†…å­˜åˆ†é…è§„åˆ™å¦‚ä¸‹ï¼š 5.1 å¯¹è±¡ä¼˜å…ˆåœ¨Edenåˆ†é…å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£EdenåŒºè¿›è¡Œåˆ†é…ã€‚å½“EdenåŒºæ²¡æœ‰è¶³å¤Ÿå†…å­˜è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†ä¼šå‘èµ·ä¸€æ¬¡Minor GCã€‚ 5.2 å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£æ‰€è°“å¤§å¯¹è±¡ï¼Œæ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å­˜å‚¨ç©ºé—´çš„Javaå¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡å°±æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ã€‚å¤§å¯¹è±¡å¯¹è™šæ‹Ÿæœºåˆ†é…æ¥è¯´æ˜¯ä¸€ä¸ªåæ¶ˆæ¯ï¼Œç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šå¯¼è‡´è™šæ‹Ÿæœºéœ€è¦ç»å¸¸è°ƒç”¨GCæ¥ä¸ºè¿™äº›å¤§å¯¹è±¡æ•´ç†å‡ºè¶³å¤Ÿçš„è¿ç»­ç©ºé—´ã€‚ 5.3é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£æ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†ä»£æ”¶é›†çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”è¯¥æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”è¯¥æ”¾åœ¨è€å¹´ä»£ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œè™šæ‹Ÿæœºç»™æ¯ä¸€ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡å¹´é¾„è®¡æ•°å™¨ã€‚å¦‚æœå¯¹è±¡åœ¨Edenå‡ºç”Ÿå¹¶ä¸”ç»è¿‡äº†ç¬¬ä¸€æ¬¡Minor GCåä»ç„¶å­˜æ´»ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«Survivorå®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ°Survivorç©ºé—´ä¸­ï¼Œå¹¶ä¸”å¯¹è±¡å¹´é¾„è®¾ç½®ä¸º1ã€‚å¯¹è±¡åœ¨SurvivoråŒºåŸŸä¸­æ¯ç†¬è¿‡ä¸€æ¬¡Minor GCï¼Œå¹´é¾„å°±å¢åŠ 1å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º15å²ï¼‰å¯¹è±¡å°†ä¼šè¢«æ™‹èº«åˆ°è€å¹´ä»£ä¸­ã€‚ 5.4 åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„é€‚åº”ä¸åŒç¨‹åºçš„å†…å­˜çŠ¶å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ¯æ¬¡éƒ½è¦ç­‰åˆ°å¯¹è±¡çš„å¹´é¾„åˆ°è¾¾é˜ˆå€¼æ‰å°†å¯¹è±¡ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚å¦‚æœåœ¨Survivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰å¾…å¹´é¾„å¢é•¿ã€‚ 5.6 ç©ºé—´åˆ†é…æ‹…ä¿åœ¨å‘ç”ŸMinor GCä¹‹å‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆæ£€æŸ¥è€å¹´ä»£ä¸­æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡ç©ºé—´ç»¼åˆï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£ä¹ˆMinor GCå¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹ï¼Œåˆ™è™šæ‹Ÿæœºä¼šæŸ¥çœ‹HandlePromotionFailureè®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ã€‚å¦‚æœå…è®¸ï¼Œé‚£ä¹ˆä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡Minor GCï¼Œå°½ç®¡è¿™æ¬¡GCæ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äºï¼Œæˆ–è€…è®¾ç½®ä¸å…è®¸ï¼Œé‚£è¿™æ—¶å°†æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡Full GCã€‚","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[]},{"title":"JVM-å†…å­˜ç»“æ„","date":"2021-07-30T03:53:42.000Z","path":"wiki/JVM-å†…å­˜ç»“æ„/","text":"ä½œä¸ºç¨‹åºå‘˜ï¼Œæœ€å¸¸æ¥è§¦åˆ°Javaè™šæ‹Ÿæœºçš„éƒ¨åˆ†åº”è¯¥æ˜¯å†…å­˜ç»“æ„è¿™ä¸€éƒ¨åˆ†äº†ï¼ŒåŒæ ·è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å¾ˆå¤šï¼Œé¢è¯•ä¹Ÿæ˜¯æœ€å¸¸è¢«é—®åˆ°çš„ã€‚è™½ç„¶JDKå·²ç»å‘å¸ƒäº†16ç‰ˆæœ¬ï¼Œä½†æ˜¯å›½å†…å¤§éƒ¨åˆ†ä¼ä¸šéƒ½è¿˜åœ¨ä½¿ç”¨JDK8ã€‚ ä»Šå¤©å­¦ä¹ ä¸€ä¸‹è™šæ‹Ÿæœºçš„è¿è¡Œæ—¶æ•°æ®åŒºçš„ç»„æˆå’Œå„ä¸ªç»„ä»¶çš„åŠŸèƒ½ã€‚ JDK8å®˜æ–¹ç½‘ç«™æ–‡æ¡£é“¾æ¥ â€“ ã€‹ JDK è¿è¡Œæ—¶æ•°æ®åŒºJavaè™šæ‹Ÿæœºåœ¨æ‰§è¡ŒJavaç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚è¿™äº›æ•°æ®åŒºåŸŸæœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚ ç¨‹åºè®¡æ•°å™¨ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒæ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¨¡å‹æ¦‚å¿µä¸­ï¼Œå­—èŠ‚ç è§£é‡Šå™¨çš„å·¥ä½œå°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œä¸€ä¸ª Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨çš„å€¼åˆ™ä¸º (Undefined)ã€‚ ç”±äºJavaè™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼å®ç°çš„ï¼Œåœ¨ä»»ä½•ä¸€ä¸ªç¡®å®šçš„æ—¶åˆ»ï¼Œä¸€ä¸ªå¤„ç†å™¨çš„ä¸€ä¸ªæ ¸åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ï¼Œå› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½å¤Ÿæ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯ä¸€æ¡çº¿ç¨‹éƒ½éœ€è¦æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œè¿™ç±»å†…å­˜åŒºåŸŸç§°ä¸ºâ€œçº¿ç¨‹ç§æœ‰â€çš„å†…å­˜ï¼Œå³å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šæ‹¥æœ‰è‡ªå·±çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚ ç¨‹åºè®¡æ•°å™¨åœ¨æ‰§è¡Œæœ¬åœ°æ–¹æ³•æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨Cè¯­è¨€ä»£ç ï¼‰è®¡æ•°å™¨å€¼ä¸ºç©ºï¼Œå…¶ä»–æ—¶å€™åˆ™æ˜¯æŒ‡å‘æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ ç¨‹åºè®¡æ•°å™¨æ˜¯åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å”¯ä¸€ä¸€ä¸ªæ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸï¼Œå› ä¸ºJavaç¨‹åºè®¡æ•°å™¨å®ƒæ‰€éœ€è¦å­˜å‚¨çš„å†…å®¹ä»…ä»…å°±æ˜¯ä¸‹ä¸€ä¸ªéœ€è¦å¾…æ‰§è¡Œçš„å‘½ä»¤çš„åœ°å€ï¼Œå…¶æ‰€éœ€å†…å­˜æ˜¯åˆ›å»ºæ—¶å³å¯åªæ™“çš„ï¼Œä¸éœ€è¦åæœŸè¿›è¡Œæ‰©å®¹ç­‰å…¶ä»–çš„æ“ä½œã€‚ Javaè™šæ‹Ÿæœºæ ˆJavaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰ï¼ŒJavaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„,å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚Javaæ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ–¹æ³•æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹ã€‚ è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ä¸Javaå¯¹è±¡å†…å­˜åˆ†é…å…³ç³»å¯†åˆ‡ï¼Œå±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘å™¨å¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼Œè¯¥ç±»å‹å¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–äºæ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’ŒreturnAddressç±»å‹ï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚ å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œ64ä½é•¿åº¦çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨ä¸€ä¸ªã€‚å±€éƒ¨å˜é‡è¡¨æ‰€éœ€çš„å†…å­˜ç©ºé—´åœ¨ç¼–è¯‘æœŸé—´å®Œæˆåˆ†é…ï¼Œå½“è¿›å…¥ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åœ¨å¸§ä¸­åˆ†é…å¤šå¤§çš„å±€éƒ¨å˜é‡ç©ºé—´æ˜¯å®Œå…¨ç¡®å®šçš„ï¼Œåœ¨æ–¹æ³•è¿è¡ŒæœŸé—´ä¸ä¼šæ”¹å˜å±€éƒ¨å˜é‡è¡¨çš„å¤§å°ã€‚ åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­ï¼Œå¯¹è¿™ä¸ªåŒºåŸŸè§„å®šäº†ä¸¤ç§å¼‚å¸¸çŠ¶å†µï¼š å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦ï¼Œå°†æŠ›å‡ºStackOverflowErrorå¼‚å¸¸ï¼›å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‹“å±•ï¼Œå¦‚æœæ‹“å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ä¸è™šæ‹Ÿæœºæ ˆä½œç”¨ç±»ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯è™šæ‹Ÿæœºæ ˆä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒJavaæ–¹æ³•ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆåˆ™ä¸ºè™šæ‹Ÿæœºæ‰§è¡ŒNativeæ–¹æ³•æœåŠ¡ã€‚æœ‰äº›è™šæ‹Ÿæœºä¼šå°†æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡ºStackOverflowErroå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚ Javaå †Javaå †ï¼ˆJava Heapï¼‰ï¼Œå¯¹äºå¤§å¤šæ•°çš„åº”ç”¨æ¥è¯´ï¼ŒJavaå †æ˜¯è™šæ‹Ÿæœºæ‰€ç®¡ç†çš„æœ€å¤§çš„ä¸€å—å†…å­˜ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çš„çº¿ç¨‹æ‰€å…±äº«çš„ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åœ¨è¿™é‡Œåˆ†é…å†…å­˜çš„ï¼ˆJavaè™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°ä¸ºæ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å’Œæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼‰ã€‚ Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤å¾ˆå¤šæ—¶å€™ä¹Ÿè¢«ç§°ä¸ºGCå †ã€‚ä»å†…å­˜å›æ”¶çš„è§’åº¦æ¥çœ‹ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†ä»£ç®—æ³•æ”¶é›†å™¨ï¼Œæ‰€ä»¥Javaå †ä¸­è¿˜å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼›å†ç»†è‡´ä¸€ç‚¹å¯ä»¥åˆ†ä¸ºEdenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ç­‰ã€‚ä»å†…å­˜åˆ†é…çš„è§’åº¦æ¥çœ‹ï¼Œçº¿ç¨‹å…±äº«çš„Javaå †ä¸­å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒºï¼ˆThread Local Allocation Bufferï¼ŒTLABï¼‰ã€‚ æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒï¼ŒJavaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œåœ¨å®ç°æ—¶æ—¢å¯ä»¥æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯æ‹“å±•çš„ï¼Œå½“å‰ä¸»æµçš„è™šæ‹Ÿæœºéƒ½æ˜¯æŒ‰ç…§å¯æ‹“å±•æ¥å®ç°çš„ã€‚å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œå¹¶ä¸”å †ä¹Ÿæ— æ³•å†æ‹“å±•æ—¶ï¼Œå°†ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ åœ¨ Java ä¸­ï¼Œå †è¢«åˆ’åˆ†æˆä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼šæ–°ç”Ÿä»£ ( Young )ã€è€å¹´ä»£ ( Old )ã€‚æ–°ç”Ÿä»£ ( Young ) åˆè¢«åˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼šEdenã€**From Survivor(S0)ã€To Survivor(S1)**ã€‚å¦‚å›¾æ‰€ç¤ºï¼š è¿™æ ·åˆ’åˆ†çš„ç›®çš„æ˜¯ä¸ºäº†ä½¿JVMèƒ½å¤Ÿæ›´å¥½çš„ç®¡ç†å†…å­˜ä¸­çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å†…å­˜çš„åˆ†é…ä»¥åŠå›æ”¶ã€‚ è€Œæ–°ç”Ÿä»£æŒ‰edenå’Œä¸¤ä¸ªsurvivorçš„åˆ†æ³•ï¼Œæ˜¯ä¸ºäº† æœ‰æ•ˆç©ºé—´å¢å¤§ï¼Œeden+1ä¸ªsurvivorï¼› æœ‰åˆ©äºå¯¹è±¡ä»£çš„è®¡ç®—ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åœ¨S0/S1ä¸­è¾¾åˆ°è®¾ç½®çš„XX:MaxTenuringThresholdå€¼åï¼Œä¼šå°†å…¶æŒªåˆ°è€å¹´ä»£ä¸­ï¼Œå³åªéœ€æ‰«æå…¶ä¸­ä¸€ä¸ªsurvivorã€‚å¦‚æœæ²¡æœ‰S0/S1,ç›´æ¥åˆ†æˆä¸¤ä¸ªåŒºï¼Œè¯¥å¦‚ä½•è®¡ç®—å¯¹è±¡ç»è¿‡äº†å¤šå°‘æ¬¡GCè¿˜æ²¡è¢«é‡Šæ”¾ã€‚ ä¸¤ä¸ªSurvivoråŒºå¯è§£å†³å†…å­˜ç¢ç‰‡åŒ– å †æ ˆç›¸å…³å‚æ•° å‚æ•° æè¿° -Xms å †å†…å­˜åˆå§‹å¤§å°ï¼Œå•ä½mã€g -Xmx å †å†…å­˜æœ€å¤§å…è®¸å¤§å°ï¼Œä¸€èˆ¬ä¸è¦å¤§äºç‰©ç†å†…å­˜çš„80% -Xmn å¹´è½»ä»£å†…å­˜åˆå§‹å¤§å° -Xss æ¯ä¸ªçº¿ç¨‹çš„å †æ ˆå¤§å°ï¼Œå³JVMæ ˆçš„å¤§å° -XX:NewRatio å¹´è½»ä»£(åŒ…æ‹¬Edenå’Œä¸¤ä¸ªSurvivoråŒº)ä¸å¹´è€ä»£çš„æ¯”å€¼ -XX:NewSzie(-Xns) å¹´è½»ä»£å†…å­˜åˆå§‹å¤§å°,å¯ä»¥ç¼©å†™-Xns -XX:MaxNewSize(-Xmx) å¹´è½»ä»£å†…å­˜æœ€å¤§å…è®¸å¤§å°ï¼Œå¯ä»¥ç¼©å†™-Xmx -XX:SurvivorRatio å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å®¹é‡æ¯”ä¾‹å€¼ï¼Œé»˜è®¤ä¸º8ï¼Œå³8:1 -XX:MinHeapFreeRatio GCåï¼Œå¦‚æœå‘ç°ç©ºé—²å †å†…å­˜å åˆ°æ•´ä¸ªé¢„ä¼°å †å†…å­˜çš„40%ï¼Œåˆ™æ”¾å¤§å †å†…å­˜çš„é¢„ä¼°æœ€å¤§å€¼ï¼Œä½†ä¸è¶…è¿‡å›ºå®šæœ€å¤§å€¼ã€‚ -XX:MaxHeapFreeRatio é¢„ä¼°å †å†…å­˜æ˜¯å †å¤§å°åŠ¨æ€è°ƒæ§çš„é‡è¦é€‰é¡¹ä¹‹ä¸€ã€‚å †å†…å­˜é¢„ä¼°æœ€å¤§å€¼ä¸€å®šå°äºæˆ–ç­‰äºå›ºå®šæœ€å¤§å€¼(-XmxæŒ‡å®šçš„æ•°å€¼)ã€‚å‰è€…ä¼šæ ¹æ®ä½¿ç”¨æƒ…å†µåŠ¨æ€è°ƒå¤§æˆ–ç¼©å°ï¼Œä»¥æé«˜GCå›æ”¶çš„æ•ˆç‡ï¼Œé»˜è®¤70% -XX:MaxTenuringThreshold åƒåœ¾æœ€å¤§å¹´é¾„ï¼Œè®¾ç½®ä¸º0çš„è¯,åˆ™å¹´è½»ä»£å¯¹è±¡ä¸ç»è¿‡SurvivoråŒº,ç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚å¯¹äºå¹´è€ä»£æ¯”è¾ƒå¤šçš„åº”ç”¨,å¯ä»¥æé«˜æ•ˆç‡.å¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå¤§å€¼,åˆ™å¹´è½»ä»£å¯¹è±¡ä¼šåœ¨SurvivoråŒºè¿›è¡Œå¤šæ¬¡å¤åˆ¶,è¿™æ ·å¯ä»¥å¢åŠ å¯¹è±¡å†å¹´è½»ä»£çš„å­˜æ´» æ—¶é—´,å¢åŠ åœ¨å¹´è½»ä»£å³è¢«å›æ”¶çš„æ¦‚ç‡ -XX:InitialTenuringThreshold å¯ä»¥è®¾å®šè€å¹´ä»£é˜€å€¼çš„åˆå§‹å€¼ -XX:+PrintTenuringDistribution æŸ¥çœ‹æ¯æ¬¡minor GCåæ–°çš„å­˜æ´»å‘¨æœŸçš„é˜ˆå€¼ Noteï¼š æ¯æ¬¡GC åä¼šè°ƒæ•´å †çš„å¤§å°ï¼Œä¸ºäº†é˜²æ­¢åŠ¨æ€è°ƒæ•´å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä¸€èˆ¬è®¾ç½®-Xmsã€-Xmx ç›¸ç­‰ã€‚ æ–°ç”Ÿä»£çš„ä¸‰ä¸ªè®¾ç½®å‚æ•°ï¼š-Xmnï¼Œ-XX:NewSizeï¼Œ-XX:NewRatioçš„ä¼˜å…ˆçº§ï¼š ï¼ˆ1ï¼‰.æœ€é«˜ä¼˜å…ˆçº§ï¼š -XX:NewSize=1024må’Œ-XX:MaxNewSize=1024m ï¼ˆ2ï¼‰.æ¬¡é«˜ä¼˜å…ˆçº§ï¼š -Xmn1024m ï¼ˆé»˜è®¤ç­‰æ•ˆæ•ˆæœæ˜¯ï¼š-XX:NewSize==-XX:MaxNewSize==1024mï¼‰ ï¼ˆ3ï¼‰.æœ€ä½ä¼˜å…ˆçº§ï¼š-XX:NewRatio=2 æ¨èä½¿ç”¨çš„æ˜¯-Xmnå‚æ•°ï¼ŒåŸå› æ˜¯è¿™ä¸ªå‚æ•°å¾ˆç®€æ´ï¼Œç›¸å½“äºä¸€æ¬¡æ€§è®¾å®šNewSizeå’ŒMaxNewSIzeï¼Œè€Œä¸”ä¸¤è€…ç›¸ç­‰ã€‚ æ–¹æ³•åŒºæ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¸Javaå †ä¸€æ ·ï¼Œæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ç±»åŠ è½½çš„ä¿¡æ¯å’Œæ•°æ®å°±æ”¾åœ¨æ–¹æ³•åŒºã€‚ Javaè™šæ‹Ÿæœºè§„èŒƒå †æ–¹æ³•åŒºçš„é™åˆ¶éå¸¸å®½æ¾ï¼Œé™¤äº†å’ŒJavaå †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜å’Œå¯ä»¥é€‰æ‹©å›ºå®šå¤§å°æˆ–è€…å¯æ‹“å±•å¤–ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†ã€‚ç›¸å¯¹è€Œè¨€ï¼Œåƒåœ¾æ”¶é›†è¡Œä¸ºåœ¨è¿™ä¸ªåŒºåŸŸæ˜¯æ¯”è¾ƒå°‘å‡ºç°çš„ï¼Œè¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ç›®æ ‡ä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»å‹çš„å¸è½½ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶æˆç»©æ¯”è¾ƒä»¤äººéš¾ä»¥æ»¡æ„ï¼Œå°¤å…¶æ—¶ç±»å‹å¸è½½ï¼Œæ¡ä»¶ç›¸å½“è‹›åˆ»ï¼Œä½†æ˜¯è¿™ä¸ªåŒºåŸŸçš„å†…å­˜å›æ”¶ä¹Ÿæ˜¯å¿…è¦çš„ã€‚ æ ¹æ®Javaè™šæ‹Ÿæœºè§„èŒƒè§„å®šï¼Œå½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œå°†æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼ŒClassæ–‡ä»¶ä¸­é™¤äº†ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºClassæ–‡ä»¶å¸¸é‡æ± çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯å…·å¤‡åŠ¨æ€æ€§ï¼ŒJavaè¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰ç¼–è¯‘å™¨æ‰èƒ½äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯å¹¶éé¢„ç½®å…¥Classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹æ‰èƒ½è¿›å…¥æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ± æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯Stringç±»çš„intern()æ–¹æ³•ã€‚ å½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ ç›´æ¥å†…å­˜ç›´æ¥å†…å­˜ï¼ˆDirect Memory)å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒæ‰€å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹çš„ä½¿ç”¨ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‡ºç°ã€‚ åœ¨JDK1.4ä¸­æ–°åŠ å…¥çš„NIOï¼ˆNew Input/Outputï¼‰ç±»ï¼Œå¼•å…¥äº†ä¸€ç§åŸºäºé€šé“ä¸ç¼“å†²åŒºçš„I/Oæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œï¼Œè¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †ä¸­å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚ ç›´æ¥å†…å­˜è™½ç„¶ä¸ä¼šå—åˆ°Javaå †å¤§å°çš„é™åˆ¶ï¼Œä½†æ˜¯å—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶ï¼Œå¦‚æœå¿½ç•¥äº†ç›´æ¥å†…å­˜ï¼Œå½“å„ä¸ªåŒºåŸŸå†…å­˜æ€»å’Œå¤§äºæœåŠ¡å™¨å†…å­˜æ—¶ï¼Œå°†ä¼šå¯¼è‡´åŠ¨æ€æ‹“å±•æ—¶å‡ºç°OutOfMemoryErrorå¼‚å¸¸ã€‚ å‚è€ƒèµ„æ–™https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-2.html#jvms-2.5 https://blog.csdn.net/qq_21122519/article/details/94408118 https://www.processon.com/view/5ec5d7c60791290fe0768668?fromnew=1","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[]},{"title":"JVM-æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº","date":"2021-07-30T02:35:12.000Z","path":"wiki/JVM-æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº/","text":"JVMç»“æ„å›¾ çŸ¥è¯†æ¸…å• Javaå†…å­˜ç»“æ„ Javaå¯¹è±¡åˆ›å»º Javaå†…å­˜æ¨¡å‹ ç±»åŠ è½½æœºåˆ¶ åƒåœ¾å›æ”¶æœºåˆ¶ åƒåœ¾æ”¶é›†å™¨ è™šæ‹Ÿæœºè°ƒä¼˜ å­¦ä¹ èµ„æ–™JAVAè™šæ‹Ÿæœºæ¦‚è¿°Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰å·¥ä½œåŸç†æ¨èæ”¶è—ç³»åˆ—ï¼šä¸€æ–‡ç†è§£JVMè™šæ‹Ÿæœºï¼ˆå†…å­˜ã€åƒåœ¾å›æ”¶ã€æ€§èƒ½ä¼˜åŒ–ï¼‰è§£å†³é¢è¯•ä¸­é‡åˆ°é—®é¢˜Javaè™šæ‹Ÿæœºå†…å­˜ç®¡ç†å’Œæ€§èƒ½è°ƒä¼˜é‡è¯» JVMã€2021æœ€æ–°ç‰ˆã€‘JVMé¢è¯•é¢˜æ€»ç»“ï¼ˆ87é“é¢˜å«ç­”æ¡ˆè§£æï¼‰JVM åŸºç¡€ - Java ç±»åŠ è½½æœºåˆ¶JVMçŸ¥è¯†ç‚¹æ•´ç†https://www.processon.com/view/5ec5d7c60791290fe0768668?fromnew=1","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[]},{"title":"Javaå¹¶å‘ç¼–ç¨‹-æ·±å…¥ç†è§£volatile","date":"2021-07-29T08:25:05.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹-æ·±å…¥ç†è§£volatile/","text":"volatileç‰¹æ€§æ­£ç¡®ç†è§£volatile å¤šçº§cacheç»“æ„ -&gt; ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆMESIï¼‰-&gt; store bufferå’Œinvalidate queue -&gt; å†…å­˜å±éšœ å¯è§æ€§volatileçš„å¯è§æ€§ä¾èµ–äºJavaå†…å­˜æ¨¡å‹ã€‚ å¯ä»¥å‚è§ä¹‹å‰çš„æ–‡ç«  ğŸ‘‰ Javaå†…å­˜æ¨¡å‹ Javaå†…å­˜æ¨¡å‹(JavaMemoryModel)æè¿°äº†Javaç¨‹åºä¸­å„ç§å˜é‡(çº¿ç¨‹å…±äº«å˜é‡)çš„è®¿é—®è§„åˆ™ï¼Œä»¥åŠåœ¨JVMä¸­å°†å˜é‡ï¼Œå­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­è¯»å–å˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚ã€‚ æ‰€æœ‰çš„å…±äº«å˜é‡éƒ½å­˜å‚¨äºä¸»å†…å­˜ï¼Œè¿™é‡Œæ‰€è¯´çš„å˜é‡æŒ‡çš„æ˜¯å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œä¸åŒ…å«å±€éƒ¨å˜é‡ï¼Œå› ä¸ºå±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå› æ­¤ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚ æ¯ä¸€ä¸ªçº¿ç¨‹è¿˜å­˜åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ï¼Œä¿ç•™äº†è¢«çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„å·¥ä½œå‰¯æœ¬ã€‚ çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰çš„æ“ä½œ(è¯»ï¼Œå–)éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­å®Œæˆï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ ä¸åŒçº¿ç¨‹ä¹‹é—´ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„å€¼çš„ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜ä¸­è½¬æ¥å®Œæˆã€‚ volatileå®ç°å¯è§æ€§ æ¯ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®çš„æ—¶å€™ä¼šæŠŠæ•°æ®ä»ä¸»å†…å­˜è¯»å–åˆ°è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå¦‚æœä»–æ“ä½œäº†æ•°æ®å¹¶ä¸”å†™ä¼šäº†ï¼Œä»–å…¶ä»–å·²ç»è¯»å–çš„çº¿ç¨‹çš„å˜é‡å‰¯æœ¬å°±ä¼šå¤±æ•ˆäº†ï¼Œéœ€è¦éƒ½æ•°æ®è¿›è¡Œæ“ä½œåˆè¦å†æ¬¡å»ä¸»å†…å­˜ä¸­è¯»å–äº†ã€‚ volatileä¿è¯ä¸åŒçº¿ç¨‹å¯¹å…±äº«å˜é‡æ“ä½œçš„å¯è§æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†volatileä¿®é¥°çš„å˜é‡ï¼Œå½“ä¿®æ”¹å†™å›ä¸»å†…å­˜æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ã€‚ è‡³äºå…¶ä»–çº¿ç¨‹æ˜¯å¦‚ä½•æ›´æ–°ç¼“å­˜è¡Œä¸­çš„æ•°æ®ä»¥åŠå…¶ä»–çº¿ç¨‹çš„ç¼“å­˜è¡Œæ˜¯å¦‚ä½•å¤±æ•ˆçš„ï¼Œå¯ä»¥å‚è§ä¹‹å‰çš„æ–‡ç« ã€‚ Javaå†…å­˜æ¨¡å‹ å—…æ¢æœºåˆ¶åœ¨ç°ä»£è®¡ç®—æœºä¸­ï¼ŒCPU çš„é€Ÿåº¦æ˜¯æé«˜çš„ï¼Œå¦‚æœ CPU éœ€è¦å­˜å–æ•°æ®æ—¶éƒ½ç›´æ¥ä¸å†…å­˜æ‰“äº¤é“ï¼Œåœ¨å­˜å–è¿‡ç¨‹ä¸­ï¼ŒCPU å°†ä¸€ç›´ç©ºé—²ï¼Œè¿™æ˜¯ä¸€ç§æå¤§çš„æµªè´¹ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†æé«˜å¤„ç†é€Ÿåº¦ï¼ŒCPU ä¸ç›´æ¥å’Œå†…å­˜è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯åœ¨ CPU ä¸å†…å­˜ä¹‹é—´åŠ å…¥å¾ˆå¤šå¯„å­˜å™¨ï¼Œå¤šçº§ç¼“å­˜ï¼Œå®ƒä»¬æ¯”å†…å­˜çš„å­˜å–é€Ÿåº¦é«˜å¾—å¤šï¼Œè¿™æ ·å°±è§£å†³äº† CPU è¿ç®—é€Ÿåº¦å’Œå†…å­˜è¯»å–é€Ÿåº¦ä¸ä¸€è‡´é—®é¢˜ã€‚ ç”±äº CPU ä¸å†…å­˜ä¹‹é—´åŠ å…¥äº†ç¼“å­˜ï¼Œåœ¨è¿›è¡Œæ•°æ®æ“ä½œæ—¶ï¼Œå…ˆå°†æ•°æ®ä»å†…å­˜æ‹·è´åˆ°ç¼“å­˜ä¸­ï¼ŒCPU ç›´æ¥æ“ä½œçš„æ˜¯ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ä½†åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼ˆè¿™ä¹Ÿæ˜¯å¯è§æ€§é—®é¢˜çš„ç”±æ¥ï¼‰ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œè€Œå—…æ¢æ˜¯å®ç°ç¼“å­˜ä¸€è‡´æ€§çš„å¸¸è§æœºåˆ¶ã€‚ å—…æ¢æœºåˆ¶å·¥ä½œåŸç†ï¼šæ¯ä¸ªå¤„ç†å™¨é€šè¿‡ç›‘å¬åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±çš„ç¼“å­˜å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå¦‚æœå¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šé‡æ–°ä»ä¸»å†…å­˜ä¸­æŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜ä¸­ã€‚ æ³¨æ„ï¼š åŸºäº CPU ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ŒJVM å®ç°äº† volatile çš„å¯è§æ€§ï¼Œä½†ç”±äºæ€»çº¿å—…æ¢æœºåˆ¶ï¼Œä¼šä¸æ–­çš„ç›‘å¬æ€»çº¿ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨ volatile ä¼šå¼•èµ·æ€»çº¿é£æš´ã€‚æ‰€ä»¥ï¼Œvolatile çš„ä½¿ç”¨è¦é€‚åˆå…·ä½“åœºæ™¯ã€‚ é‡æ’åºä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’åº? ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æ—¢å®šçš„ä»£ç æ‰§è¡Œé¡ºåºè¿›è¡ŒæŒ‡ä»¤é‡æ’åºã€‚ ã€æºä»£ç ã€‘ -&gt; ã€ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’åºã€‘-&gt; ã€æŒ‡ä»¤é›†å¹¶è¡Œé‡æ’åºã€‘-&gt; ã€å†…å­˜ç³»ç»Ÿé‡æ’åºã€‘-&gt; ã€æœ€ç»ˆæ‰§è¡ŒæŒ‡ä»¤åºåˆ—ã€‘ ä¸€èˆ¬é‡æ’åºå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ï¼š ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº; æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº; å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯»/å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œçš„ã€‚ as-if-serialè¯­ä¹‰ä¸ç®¡æ€ä¹ˆé‡æ’åºï¼Œå•çº¿ç¨‹ä¸‹çš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ã€runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if-serialè¯­ä¹‰ã€‚ javaç¼–è¯‘å™¨ä¼šåœ¨ç”ŸæˆæŒ‡ä»¤ç³»åˆ—æ—¶åœ¨é€‚å½“çš„ä½ç½®ä¼šæ’å…¥å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ ä¸ºäº†å®ç°volatileçš„å†…å­˜è¯­ä¹‰ï¼ŒJMMä¼šé™åˆ¶ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºï¼ŒJMMä¼šé’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®švolatileé‡æ’åºè§„åˆ™è¡¨ï¼š å†…å­˜å±éšœ è¯´æ˜ StoreStore å±éšœ ç¦æ­¢ä¸Šé¢çš„æ™®é€šå†™å’Œä¸‹é¢çš„ volatile å†™é‡æ’åºã€‚ StoreLoad å±éšœ é˜²æ­¢ä¸Šé¢çš„ volatile å†™ä¸ä¸‹é¢å¯èƒ½æœ‰çš„ volatile è¯»/å†™é‡æ’åºã€‚ LoadLoad å±éšœ ç¦æ­¢ä¸‹é¢æ‰€æœ‰çš„æ™®é€šè¯»æ“ä½œå’Œä¸Šé¢çš„ volatile è¯»é‡æ’åºã€‚ LoadStore å±éšœ ç¦æ­¢ä¸‹é¢æ‰€æœ‰çš„æ™®é€šå†™æ“ä½œå’Œä¸Šé¢çš„ volatile è¯»é‡æ’åºã€‚ happens-beforeè§„åˆ™å¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨happens-beforeå…³ç³»ã€‚ volatileåŸŸè§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™æ“ä½œï¼Œhappens-beforeäºä»»æ„çº¿ç¨‹åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚ volatileåœ¨DCLçš„åº”ç”¨1234567891011121314151617public class Singleton &#123; public static volatile Singleton singleton; /** * æ„é€ å‡½æ•°ç§æœ‰ï¼Œç¦æ­¢å¤–éƒ¨å®ä¾‹åŒ– */ private Singleton() &#123;&#125;; public static Singleton getInstance() &#123; if (singleton == null) &#123; synchronized (singleton.class) &#123; if (singleton == null) &#123; singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125;&#125; ç°åœ¨æˆ‘ä»¬åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆè¦åœ¨å˜é‡singletonä¹‹é—´åŠ ä¸Švolatileå…³é”®å­—ã€‚è¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œå…ˆè¦äº†è§£å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å…¶å®å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚ åˆå§‹åŒ–å¯¹è±¡ã€‚ å°†å†…å­˜ç©ºé—´çš„åœ°å€èµ‹å€¼ç»™å¯¹åº”çš„å¼•ç”¨ã€‚ ä½†æ˜¯ç”±äºæ“ä½œç³»ç»Ÿå¯ä»¥å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œæ‰€ä»¥ä¸Šé¢çš„è¿‡ç¨‹ä¹Ÿå¯èƒ½ä¼šå˜æˆå¦‚ä¸‹è¿‡ç¨‹ï¼š åˆ†é…å†…å­˜ç©ºé—´ã€‚ å°†å†…å­˜ç©ºé—´çš„åœ°å€èµ‹å€¼ç»™å¯¹åº”çš„å¼•ç”¨ã€‚ åˆå§‹åŒ–å¯¹è±¡ å¦‚æœæ˜¯è¿™ä¸ªæµç¨‹ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å°±å¯èƒ½å°†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡å¼•ç”¨æš´éœ²å‡ºæ¥ï¼Œä»è€Œå¯¼è‡´ä¸å¯é¢„æ–™çš„ç»“æœã€‚å› æ­¤ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸ªè¿‡ç¨‹çš„é‡æ’åºï¼Œæˆ‘ä»¬éœ€è¦å°†å˜é‡è®¾ç½®ä¸ºvolatileç±»å‹çš„å˜é‡ã€‚ ä¸€æ¬¡æ€§å®‰å…¨å‘å¸ƒ12345678910111213141516171819public class BackgroundFloobleLoader &#123; public volatile Flooble theFlooble; public void initInBackground() &#123; // do lots of stuff theFlooble = new Flooble(); // this is the only write to theFlooble &#125;&#125;public class SomeOtherClass &#123; public void doWork() &#123; while (true) &#123; // do some stuff... // use the Flooble, but only if it is ready if (floobleLoader.theFlooble != null) doSomething(floobleLoader.theFlooble); &#125; &#125;&#125; å¦‚æœ theFlooble å¼•ç”¨ä¸æ˜¯ volatile ç±»å‹ï¼ŒdoWork() ä¸­çš„ä»£ç åœ¨è§£é™¤å¯¹ theFlooble çš„å¼•ç”¨æ—¶ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªä¸å®Œå…¨æ„é€ çš„ Floobleã€‚ è¯¥æ¨¡å¼çš„ä¸€ä¸ªå¿…è¦æ¡ä»¶æ˜¯ï¼šè¢«å‘å¸ƒçš„å¯¹è±¡å¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæˆ–è€…æ˜¯æœ‰æ•ˆçš„ä¸å¯å˜å¯¹è±¡ï¼ˆæœ‰æ•ˆä¸å¯å˜æ„å‘³ç€å¯¹è±¡çš„çŠ¶æ€åœ¨å‘å¸ƒä¹‹åæ°¸è¿œä¸ä¼šè¢«ä¿®æ”¹ï¼‰ã€‚volatile ç±»å‹çš„å¼•ç”¨å¯ä»¥ç¡®ä¿å¯¹è±¡çš„å‘å¸ƒå½¢å¼çš„å¯è§æ€§ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡çš„çŠ¶æ€åœ¨å‘å¸ƒåå°†å‘ç”Ÿæ›´æ”¹ï¼Œé‚£ä¹ˆå°±éœ€è¦é¢å¤–çš„åŒæ­¥ã€‚ æ— æ³•ä¿è¯åŸå­æ€§æ‰€è°“çš„åŸå­æ€§æ˜¯æŒ‡åœ¨ä¸€æ¬¡æ“ä½œæˆ–è€…å¤šæ¬¡æ“ä½œä¸­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œå…¨éƒ¨éƒ½å¾—åˆ°äº†æ‰§è¡Œå¹¶ä¸”ä¸ä¼šå—åˆ°ä»»ä½•å› ç´ çš„å¹²æ‰°è€Œä¸­æ–­ï¼Œè¦ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½ä¸æ‰§è¡Œã€‚ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œvolatile å…³é”®å­—å¯ä»¥ä¿è¯å…±äº«æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å¯¹æ•°æ®æ“ä½œçš„åŸå­æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ volatile ä¿®é¥°çš„å˜é‡æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é”æœºåˆ¶ï¼Œæˆ–è€…ä½¿ç”¨åŸå­ç±»ï¼ˆå¦‚ AtomicIntegerï¼‰ã€‚ è¿™é‡Œç‰¹åˆ«è¯´ä¸€ä¸‹ï¼Œå¯¹ä»»æ„å•ä¸ªä½¿ç”¨ volatile ä¿®é¥°çš„å˜é‡çš„è¯» / å†™æ˜¯å…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äº flag = !flag è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚ç®€å•åœ°è¯´å°±æ˜¯ï¼Œå•çº¯çš„èµ‹å€¼æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚ volatile å’Œ synchronizedvolatileåªèƒ½ä¿®é¥°å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œè€Œsynchronizedå¯ä»¥ä¿®é¥°æ–¹æ³•ï¼Œä»¥åŠä»£ç å—ã€‚ volatileä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯åŸå­æ€§(å¤šçº¿ç¨‹è¿›è¡Œå†™æ“ä½œï¼Œä¸ä¿è¯çº¿ç¨‹å®‰å…¨);è€Œsynchronizedæ˜¯ä¸€ç§æ’ä»–(äº’æ–¥)çš„æœºåˆ¶ã€‚ volatileç”¨äºç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼šå¯ä»¥è§£å†³å•ä¾‹åŒé‡æ£€æŸ¥å¯¹è±¡åˆå§‹åŒ–ä»£ç æ‰§è¡Œä¹±åºé—®é¢˜ã€‚ volatileå¯ä»¥çœ‹åšæ˜¯è½»é‡ç‰ˆçš„synchronizedï¼Œvolatileä¸ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¯¹ä¸€ä¸ªå…±äº«å˜é‡è¿›è¡Œå¤šä¸ªçº¿ç¨‹çš„èµ‹å€¼ï¼Œè€Œæ²¡æœ‰å…¶ä»–çš„æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨volatileæ¥ä»£æ›¿synchronizedï¼Œå› ä¸ºèµ‹å€¼æœ¬èº«æ˜¯æœ‰åŸå­æ€§çš„ï¼Œè€Œvolatileåˆä¿è¯äº†å¯è§æ€§ï¼Œæ‰€ä»¥å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚ æ€»ç»“1ã€volatileä¿®é¥°ç¬¦é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼šæŸä¸ªå±æ€§è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æ­¤å±æ€§ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³å¾—åˆ°ä¿®æ”¹åçš„å€¼ï¼Œæ¯”å¦‚booleanflag;æˆ–è€…ä½œä¸ºè§¦å‘å™¨ï¼Œå®ç°è½»é‡çº§åŒæ­¥ã€‚ 2ã€volatileå±æ€§çš„è¯»å†™æ“ä½œéƒ½æ˜¯æ— é”çš„ï¼Œå®ƒä¸èƒ½æ›¿ä»£synchronizedï¼Œå› ä¸ºå®ƒæ²¡æœ‰æä¾›åŸå­æ€§å’Œäº’æ–¥æ€§ã€‚å› ä¸ºæ— é”ï¼Œä¸éœ€è¦èŠ±è´¹æ—¶é—´åœ¨è·å–é”å’Œé‡Šæ”¾é”_ä¸Šï¼Œæ‰€ä»¥è¯´å®ƒæ˜¯ä½æˆæœ¬çš„ã€‚ 3ã€volatileåªèƒ½ä½œç”¨äºå±æ€§ï¼Œæˆ‘ä»¬ç”¨volatileä¿®é¥°å±æ€§ï¼Œè¿™æ ·compilerså°±ä¸ä¼šå¯¹è¿™ä¸ªå±æ€§åšæŒ‡ä»¤é‡æ’åºã€‚ 4ã€volatileæä¾›äº†å¯è§æ€§ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶çš„ä¿®æ”¹å°†ç«‹é©¬å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼Œvolatileå±æ€§ä¸ä¼šè¢«çº¿ç¨‹ç¼“å­˜ï¼Œå§‹ç»ˆä»ä¸» å­˜ä¸­è¯»å–ã€‚ 5ã€volatileæä¾›äº†happens-beforeä¿è¯ï¼Œå¯¹volatileå˜é‡vçš„å†™å…¥happens-beforeæ‰€æœ‰å…¶ä»–çº¿ç¨‹åç»­å¯¹vçš„è¯»æ“ä½œã€‚ 6ã€volatileå¯ä»¥ä½¿å¾—longå’Œdoubleçš„èµ‹å€¼æ˜¯åŸå­çš„ã€‚ 7ã€volatileå¯ä»¥åœ¨å•ä¾‹åŒé‡æ£€æŸ¥ä¸­å®ç°å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä»è€Œä¿è¯å®‰å…¨æ€§ã€‚ å‚è€ƒèµ„æ–™ é¢è¯•å®˜æƒ³åˆ°ï¼Œä¸€ä¸ªVolatileï¼Œæ•–ä¸™éƒ½èƒ½å¹åŠå°æ—¶ é¢è¯•å®˜æœ€çˆ±çš„volatileå…³é”®å­— ä¸€æ–‡åƒé€Volatileï¼Œå¾æœé¢è¯•å®˜ javaè¯­è¨€çš„çº¿ç¨‹å®‰å…¨volatileç”¨æ³•","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"Java-synchronizedå…³é”®å­—å‰–æ","date":"2021-07-29T05:37:27.000Z","path":"wiki/Java-synchronizedå…³é”®å­—å‰–æ/","text":"ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äºsynchronizedå…³é”®å­—çš„æ–‡ç« ï¼Œæ˜¯å½“æ—¶å¬é©¬å£«å…µè€å¸ˆçš„å…¬å¼€è¯¾æ—¶è®°å½•çš„ä¸€äº›å…³é”®ç¬”è®°ğŸ“’ é“¾æ¥ğŸ”— ä¸‹é¢æˆ‘ä»¬è¿˜æ˜¯è¦å­¦ä¹ å’Œæ€»ç»“ä¸€ä¸‹synchronized synchronized ç‰¹æ€§ æœ‰åºæ€§as-if-serial ä¸ç®¡ç¼–è¯‘å™¨å’ŒCPUå¦‚ä½•é‡æ’åºï¼Œå¿…é¡»ä¿è¯åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ç¨‹åºçš„ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œè¿˜æœ‰å°±æ˜¯æœ‰æ•°æ®ä¾èµ–çš„ä¹Ÿæ˜¯ä¸èƒ½é‡æ’åºçš„ã€‚ 12int a = 1;int b = a; è¿™ä¸¤æ®µæ˜¯æ€ä¹ˆéƒ½ä¸èƒ½é‡æ’åºçš„ï¼Œbçš„å€¼ä¾èµ–açš„å€¼ï¼Œaå¦‚æœä¸å…ˆèµ‹å€¼ï¼Œé‚£å°±ä¸ºç©ºäº†ã€‚ å¯è§æ€§ä¸»è¦ä¾é Javaå†…å­˜æ¨¡å‹å®ç° åŸå­æ€§é€šè¿‡æ±‡ç¼–æŒ‡ä»¤æ§åˆ¶ å¯é‡å…¥synchronizedé”å¯¹è±¡çš„æ—¶å€™æœ‰ä¸ªè®¡æ•°å™¨ï¼Œä»–ä¼šè®°å½•ä¸‹çº¿ç¨‹è·å–é”çš„æ¬¡æ•°ï¼Œåœ¨æ‰§è¡Œå®Œå¯¹åº”çš„ä»£ç å—ä¹‹åï¼Œè®¡æ•°å™¨å°±ä¼š-1ï¼Œç›´åˆ°è®¡æ•°å™¨æ¸…é›¶ï¼Œå°±é‡Šæ”¾é”äº† ä¸å¯ä¸­æ–­ä¸å¯ä¸­æ–­å°±æ˜¯æŒ‡ï¼Œä¸€ä¸ªçº¿ç¨‹è·å–é”ä¹‹åï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¤„äºé˜»å¡æˆ–è€…ç­‰å¾…çŠ¶æ€ï¼Œå‰ä¸€ä¸ªä¸é‡Šæ”¾ï¼Œåä¸€ä¸ªä¹Ÿä¸€ç›´ä¼šé˜»å¡æˆ–è€…ç­‰å¾…ï¼Œä¸å¯ä»¥è¢«ä¸­æ–­ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLockçš„tryLockæ–¹æ³•æ˜¯å¯ä»¥è¢«ä¸­æ–­çš„ã€‚ äº†è§£å¯¹è±¡å¤´Mark Wordï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚ åœ¨64ä½çš„è™šæ‹Ÿæœºä¸­ï¼š 32ä½è™šæ‹Ÿæœºä¸­ï¼š å¯ä»¥å‚è§ä¹‹å‰çš„æ–‡ç«  ğŸ‘‰ Javaå¯¹è±¡å¤´ synchronizedå®ç°ä¹‹å‰çš„æ–‡ç« å·²ç»åœ¨ Javaä»£ç ã€å­—èŠ‚ç ã€JVMçº§åˆ«å’Œæ±‡ç¼–æŒ‡ä»¤å››ä¸ªçº§åˆ«ä»‹ç»äº†synchronziedçš„å®ç°ã€‚JDKå¯¹synchronziedä¸æ–­çš„ä¼˜åŒ–ï¼Œå¤§å®¶ç†Ÿæ‚‰çš„é”å‡çº§è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯åœ¨æºç é‡Œé¢ï¼Œè°ƒç”¨äº†ä¸åŒçš„å®ç°å»è·å–è·å–é”ï¼Œå¤±è´¥å°±è°ƒç”¨æ›´é«˜çº§çš„å®ç°ï¼Œæœ€åå‡çº§å®Œæˆã€‚ å‡çº§æ–¹å‘ï¼šã€ æ— é” ã€‘ -&gt; ã€ åå‘é” ã€‘-&gt; ã€ è½»é‡çº§é” ã€‘-&gt; ã€ é‡é‡çº§é” ã€‘ Tipï¼šåˆ‡è®°è¿™ä¸ªå‡çº§è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼› æ— é”æ— é”æ˜¯æŒ‡æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ æ— é”çš„ç‰¹ç‚¹æ˜¯ä¿®æ”¹æ“ä½œä¼šåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ åå‘é”å¯¹è±¡å¤´æ˜¯ç”± Mark Word å’Œ Class pointer ç»„æˆï¼Œé”äº‰å¤ºä¹Ÿå°±æ˜¯å¯¹è±¡å¤´æŒ‡å‘çš„Monitorå¯¹è±¡çš„äº‰å¤ºï¼Œä¸€æ—¦æœ‰çº¿ç¨‹æŒæœ‰äº†è¿™ä¸ªå¯¹è±¡ï¼Œæ ‡å¿—ä½ä¿®æ”¹ä¸º1ï¼Œå°±è¿›å…¥åå‘æ¨¡å¼ï¼ŒåŒæ—¶ä¼šæŠŠè¿™ä¸ªçº¿ç¨‹çš„IDè®°å½•åœ¨å¯¹è±¡çš„Mark Wordä¸­ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯é‡‡ç”¨äº†CASä¹è§‚é”æ“ä½œçš„ï¼Œæ¯æ¬¡åŒä¸€çº¿ç¨‹è¿›å…¥ï¼Œè™šæ‹Ÿæœºå°±ä¸è¿›è¡Œä»»ä½•åŒæ­¥çš„æ“ä½œäº†ï¼Œå¯¹æ ‡å¿—ä½+1å°±å¥½äº†ï¼Œä¸åŒçº¿ç¨‹è¿‡æ¥ï¼ŒCASä¼šå¤±è´¥ï¼Œä¹Ÿå°±æ„å‘³ç€è·å–é”å¤±è´¥ã€‚ åå‘é”åœ¨1.6ä¹‹åæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œ1.5ä¸­æ˜¯å…³é—­çš„ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯å‚æ•°æ˜¯xx:-UseBiasedLocking=falseã€‚ åˆæ¬¡æ‰§è¡Œåˆ°synchronizedä»£ç å—çš„æ—¶å€™ï¼Œé”å¯¹è±¡å˜æˆåå‘é”ï¼ˆé€šè¿‡CASä¿®æ”¹å¯¹è±¡å¤´é‡Œçš„é”æ ‡å¿—ä½ï¼‰ï¼Œå­—é¢æ„æ€æ˜¯â€œåå‘äºç¬¬ä¸€ä¸ªè·å¾—å®ƒçš„çº¿ç¨‹â€çš„é”ã€‚æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—åï¼Œçº¿ç¨‹å¹¶ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚ å½“ç¬¬äºŒæ¬¡åˆ°è¾¾åŒæ­¥ä»£ç å—æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­æ­¤æ—¶æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å°±æ˜¯è‡ªå·±ï¼ˆæŒæœ‰é”çš„çº¿ç¨‹IDä¹Ÿåœ¨å¯¹è±¡å¤´é‡Œï¼‰ï¼Œå¦‚æœæ˜¯åˆ™æ­£å¸¸å¾€ä¸‹æ‰§è¡Œã€‚ç”±äºä¹‹å‰æ²¡æœ‰é‡Šæ”¾é”ï¼Œè¿™é‡Œä¹Ÿå°±ä¸éœ€è¦é‡æ–°åŠ é”ã€‚å¦‚æœè‡ªå§‹è‡³ç»ˆä½¿ç”¨é”çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¾ˆæ˜æ˜¾åå‘é”å‡ ä¹æ²¡æœ‰é¢å¤–å¼€é”€ï¼Œæ€§èƒ½æé«˜ã€‚ åå‘é”æ˜¯æŒ‡å½“ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«åŒä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®æ—¶ï¼Œå³ä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹çš„ç«äº‰æ—¶ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹åœ¨åç»­è®¿é—®æ—¶ä¾¿ä¼šè‡ªåŠ¨è·å¾—é”ï¼Œä»è€Œé™ä½è·å–é”å¸¦æ¥çš„æ¶ˆè€—ï¼Œå³æé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨ Mark Word é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹ Mark Word é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚è½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡ CAS åŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ ThreadID çš„æ—¶å€™ä¾èµ–ä¸€æ¬¡ CAS åŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”çš„ã€‚ å…³äºåå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼Œå³åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šå…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œç„¶ååˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å°†å¯¹è±¡å¤´è®¾ç½®æˆæ— é”çŠ¶æ€ï¼Œå¹¶æ’¤é”€åå‘é”ï¼Œæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸º01ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸º00ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”å…³é—­ï¼Œæˆ–è€…å¤šä¸ªçº¿ç¨‹ç«äº‰åå‘é”æ€ä¹ˆåŠå‘¢ï¼Ÿ è½»é‡çº§é”è¿˜æ˜¯è·ŸMark Work ç›¸å…³ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯æ— é”çš„ï¼Œjvmå°±ä¼šåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªå«é”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨æ¥å­˜å‚¨é”å¯¹è±¡çš„Mark Word æ‹·è´ï¼Œç„¶åæŠŠLock Recordä¸­çš„owneræŒ‡å‘å½“å‰å¯¹è±¡ã€‚ JVMæ¥ä¸‹æ¥ä¼šåˆ©ç”¨CASå°è¯•æŠŠå¯¹è±¡åŸæœ¬çš„Mark Word æ›´æ–°ä¼šLock Recordçš„æŒ‡é’ˆï¼ŒæˆåŠŸå°±è¯´æ˜åŠ é”æˆåŠŸï¼Œæ”¹å˜é”æ ‡å¿—ä½ï¼Œæ‰§è¡Œç›¸å…³åŒæ­¥æ“ä½œã€‚ å¦‚æœå¤±è´¥äº†ï¼Œå°±ä¼šåˆ¤æ–­å½“å‰å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘äº†å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œæ˜¯åˆ™è¡¨ç¤ºå½“å‰çš„çº¿ç¨‹å·²ç»æŒæœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œå¦åˆ™è¯´æ˜è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰äº†ï¼Œç»§ç»­é”å‡çº§ï¼Œä¿®æ”¹é”çš„çŠ¶æ€ï¼Œä¹‹åç­‰å¾…çš„çº¿ç¨‹ä¹Ÿé˜»å¡ã€‚ è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œå´è¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œæ­¤æ—¶åå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œçº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ è½»é‡çº§é”çš„è·å–ä¸»è¦ç”±ä¸¤ç§æƒ…å†µï¼šâ‘  å½“å…³é—­åå‘é”åŠŸèƒ½æ—¶ï¼›â‘¡ ç”±äºå¤šä¸ªçº¿ç¨‹ç«äº‰åå‘é”å¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ã€‚ ä¸€æ—¦æœ‰ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”ç«äº‰ï¼Œåå‘é”å°±å‡çº§ä¸ºè½»é‡çº§é”ï¼ˆè‡ªæ—‹é”ï¼‰ã€‚è¿™é‡Œè¦æ˜ç¡®ä¸€ä¸‹ä»€ä¹ˆæ˜¯é”ç«äº‰ï¼š å¦‚æœå¤šä¸ªçº¿ç¨‹è½®æµè·å–ä¸€ä¸ªé”ï¼Œä½†æ˜¯æ¯æ¬¡è·å–é”çš„æ—¶å€™éƒ½å¾ˆé¡ºåˆ©ï¼Œæ²¡æœ‰å‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆå°±ä¸å­˜åœ¨é”ç«äº‰ã€‚åªæœ‰å½“æŸçº¿ç¨‹å°è¯•è·å–é”çš„æ—¶å€™ï¼Œå‘ç°è¯¥é”å·²ç»è¢«å ç”¨ï¼Œåªèƒ½ç­‰å¾…å…¶é‡Šæ”¾ï¼Œè¿™æ‰å‘ç”Ÿäº†é”ç«äº‰ã€‚ åœ¨è½»é‡çº§é”çŠ¶æ€ä¸‹ç»§ç»­é”ç«äº‰ï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„çº¿ç¨‹å°†è‡ªæ—‹ï¼Œå³ä¸åœåœ°å¾ªç¯åˆ¤æ–­é”æ˜¯å¦èƒ½å¤Ÿè¢«æˆåŠŸè·å–ã€‚è·å–é”çš„æ“ä½œï¼Œå…¶å®å°±æ˜¯é€šè¿‡CASä¿®æ”¹å¯¹è±¡å¤´é‡Œçš„é”æ ‡å¿—ä½ã€‚å…ˆæ¯”è¾ƒå½“å‰é”æ ‡å¿—ä½æ˜¯å¦ä¸ºâ€œé‡Šæ”¾â€ï¼Œå¦‚æœæ˜¯åˆ™å°†å…¶è®¾ç½®ä¸ºâ€œé”å®šâ€ï¼Œæ¯”è¾ƒå¹¶è®¾ç½®æ˜¯åŸå­æ€§å‘ç”Ÿçš„ã€‚è¿™å°±ç®—æŠ¢åˆ°é”äº†ï¼Œç„¶åçº¿ç¨‹å°†å½“å‰é”çš„æŒæœ‰è€…ä¿¡æ¯ä¿®æ”¹ä¸ºè‡ªå·±ã€‚ é•¿æ—¶é—´çš„è‡ªæ—‹æ“ä½œæ˜¯éå¸¸æ¶ˆè€—èµ„æºçš„ï¼Œä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œå…¶ä»–çº¿ç¨‹å°±åªèƒ½åœ¨åŸåœ°ç©ºè€—CPUï¼Œæ‰§è¡Œä¸äº†ä»»ä½•æœ‰æ•ˆçš„ä»»åŠ¡ï¼Œè¿™ç§ç°è±¡å«åšå¿™ç­‰ï¼ˆbusy-waitingï¼‰ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹ç”¨ä¸€ä¸ªé”ï¼Œä½†æ˜¯æ²¡æœ‰å‘ç”Ÿé”ç«äº‰ï¼Œæˆ–è€…å‘ç”Ÿäº†å¾ˆè½»å¾®çš„é”ç«äº‰ï¼Œé‚£ä¹ˆsynchronizedå°±ç”¨è½»é‡çº§é”ï¼Œå…è®¸çŸ­æ—¶é—´çš„å¿™ç­‰ç°è±¡ã€‚è¿™æ˜¯ä¸€ç§æŠ˜è¡·çš„æƒ³æ³•ï¼ŒçŸ­æ—¶é—´çš„å¿™ç­‰ï¼Œæ¢å–çº¿ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´åˆ‡æ¢çš„å¼€é”€ã€‚ è‡ªæ—‹é”æˆ‘ä¸æ˜¯åœ¨ä¸Šé¢æåˆ°äº†Linuxç³»ç»Ÿçš„ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢å¾ˆè€—èµ„æºï¼Œå…¶å®å°±æ˜¯çº¿ç¨‹çš„ç­‰å¾…å”¤èµ·è¿‡ç¨‹ï¼Œé‚£æ€ä¹ˆæ‰èƒ½å‡å°‘è¿™ç§æ¶ˆè€—å‘¢ï¼Ÿ è‡ªæ—‹ï¼Œè¿‡æ¥çš„ç°åœ¨å°±ä¸æ–­è‡ªæ—‹ï¼Œé˜²æ­¢çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œä¸€æ—¦å¯ä»¥è·å–èµ„æºï¼Œå°±ç›´æ¥å°è¯•æˆåŠŸï¼Œç›´åˆ°è¶…å‡ºé˜ˆå€¼ï¼Œè‡ªæ—‹é”çš„é»˜è®¤å¤§å°æ˜¯10æ¬¡ï¼Œ-XXï¼šPreBlockSpinå¯ä»¥ä¿®æ”¹ã€‚ è‡ªæ—‹éƒ½å¤±è´¥äº†ï¼Œé‚£å°±å‡çº§ä¸ºé‡é‡çº§çš„é”ï¼Œåƒ1.5çš„ä¸€æ ·ï¼Œç­‰å¾…å”¤èµ·å’¯ã€‚ è‡ªé€‚åº”è‡ªæ—‹é”è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šï¼š å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…ä¹‹å‰æˆåŠŸè·å¾—è¿‡çš„é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œå› æ­¤å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚ ç›¸åçš„ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£ä¹ˆä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½å‡å°‘è‡ªæ—‹æ—¶é—´ç”šè‡³çœç•¥è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ è‡ªé€‚åº”è‡ªæ—‹è§£å†³çš„æ˜¯â€œé”ç«äº‰æ—¶é—´ä¸ç¡®å®šâ€çš„é—®é¢˜ã€‚JVMå¾ˆéš¾æ„ŸçŸ¥ç¡®åˆ‡çš„é”ç«äº‰æ—¶é—´ï¼Œè€Œäº¤ç»™ç”¨æˆ·åˆ†æå°±è¿åäº†JVMçš„è®¾è®¡åˆè¡·ã€‚è‡ªé€‚åº”è‡ªæ—‹å‡å®šä¸åŒçº¿ç¨‹æŒæœ‰åŒä¸€ä¸ªé”å¯¹è±¡çš„æ—¶é—´åŸºæœ¬ç›¸å½“ï¼Œç«äº‰ç¨‹åº¦è¶‹äºç¨³å®šã€‚å› æ­¤ï¼Œå¯ä»¥æ ¹æ®ä¸Šä¸€æ¬¡è‡ªæ—‹çš„æ—¶é—´ä¸ç»“æœè°ƒæ•´ä¸‹ä¸€æ¬¡è‡ªæ—‹çš„æ—¶é—´ã€‚ é‡é‡çº§é”å¦‚æœé”ç«äº‰æƒ…å†µä¸¥é‡ï¼ŒæŸä¸ªè¾¾åˆ°æœ€å¤§è‡ªæ—‹æ¬¡æ•°çš„çº¿ç¨‹ï¼Œä¼šå°†è½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ï¼ˆä¾ç„¶æ˜¯CASä¿®æ”¹é”æ ‡å¿—ä½ï¼Œä½†ä¸ä¿®æ”¹æŒæœ‰é”çš„çº¿ç¨‹IDï¼‰ã€‚å½“åç»­çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå‘ç°è¢«å ç”¨çš„é”æ˜¯é‡é‡çº§é”ï¼Œåˆ™ç›´æ¥å°†è‡ªå·±æŒ‚èµ·ï¼ˆè€Œä¸æ˜¯å¿™ç­‰ï¼‰ï¼Œç­‰å¾…å°†æ¥è¢«å”¤é†’ã€‚ é‡é‡çº§é”æ˜¯æŒ‡å½“æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”ä¹‹åï¼Œå…¶ä½™æ‰€æœ‰ç­‰å¾…è·å–è¯¥é”çš„çº¿ç¨‹éƒ½ä¼šå¤„äºé˜»å¡çŠ¶æ€ã€‚ ç®€è¨€ä¹‹ï¼Œå°±æ˜¯æ‰€æœ‰çš„æ§åˆ¶æƒéƒ½äº¤ç»™äº†æ“ä½œç³»ç»Ÿï¼Œç”±æ“ä½œç³»ç»Ÿæ¥è´Ÿè´£çº¿ç¨‹é—´çš„è°ƒåº¦å’Œçº¿ç¨‹çš„çŠ¶æ€å˜æ›´ã€‚è€Œè¿™æ ·ä¼šå‡ºç°é¢‘ç¹åœ°å¯¹çº¿ç¨‹è¿è¡ŒçŠ¶æ€çš„åˆ‡æ¢ï¼Œçº¿ç¨‹çš„æŒ‚èµ·å’Œå”¤é†’ï¼Œä»è€Œæ¶ˆè€—å¤§é‡çš„ç³»ç»Ÿèµ„ å¤§å®¶åœ¨çœ‹ObjectMonitoræºç çš„æ—¶å€™ï¼Œä¼šå‘ç°Atomic::cmpxchg_ptrï¼ŒAtomic::inc_ptrç­‰å†…æ ¸å‡½æ•°ï¼Œå¯¹åº”çš„çº¿ç¨‹å°±æ˜¯park()å’Œupark()ã€‚è¿™ä¸ªæ“ä½œæ¶‰åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è½¬æ¢äº†ï¼Œè¿™ç§åˆ‡æ¢æ˜¯å¾ˆè€—èµ„æºçš„ï¼Œæ‰€ä»¥çŸ¥é“ä¸ºå•¥æœ‰è‡ªæ—‹é”è¿™æ ·çš„æ“ä½œäº†å§ï¼ŒæŒ‰é“ç†ç±»ä¼¼æ­»å¾ªç¯çš„æ“ä½œæ›´è´¹èµ„æºæ‰æ˜¯å¯¹å§ï¼Ÿå…¶å®ä¸æ˜¯ï¼Œå¤§å®¶äº†è§£ä¸€ä¸‹å°±çŸ¥é“äº†ã€‚ é‚£ç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆæ˜¯å•¥å‘¢ï¼Ÿ Linuxç³»ç»Ÿçš„ä½“ç³»ç»“æ„åˆ†ä¸ºç”¨æˆ·ç©ºé—´ï¼ˆåº”ç”¨ç¨‹åºçš„æ´»åŠ¨ç©ºé—´ï¼‰å’Œå†…æ ¸ã€‚æˆ‘ä»¬æ‰€æœ‰çš„ç¨‹åºéƒ½åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œï¼Œè¿›å…¥ç”¨æˆ·è¿è¡ŒçŠ¶æ€ä¹Ÿå°±æ˜¯ï¼ˆç”¨æˆ·æ€ï¼‰ï¼Œä½†æ˜¯å¾ˆå¤šæ“ä½œå¯èƒ½æ¶‰åŠå†…æ ¸è¿è¡Œï¼Œæ¯”å¦‚æ¶‰åŠåˆ°I/Oï¼Œæˆ‘ä»¬å°±ä¼šè¿›å…¥å†…æ ¸è¿è¡ŒçŠ¶æ€ï¼ˆå†…æ ¸æ€ï¼‰ã€‚ è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆå¤æ‚çš„ï¼Œä¹Ÿæ¶‰åŠå¾ˆå¤šå€¼çš„ä¼ é€’ï¼Œæˆ‘ç®€å•æ¦‚æ‹¬ä¸‹æµç¨‹ï¼š ç”¨æˆ·æ€æŠŠä¸€äº›æ•°æ®æ”¾åˆ°å¯„å­˜å™¨ï¼Œæˆ–è€…åˆ›å»ºå¯¹åº”çš„å †æ ˆï¼Œè¡¨æ˜éœ€è¦æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ã€‚ ç”¨æˆ·æ€æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼ˆç³»ç»Ÿè°ƒç”¨æ˜¯æ“ä½œç³»ç»Ÿçš„æœ€å°åŠŸèƒ½å•ä½ï¼‰ã€‚ CPUåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè·³åˆ°å¯¹åº”çš„å†…å­˜æŒ‡å®šçš„ä½ç½®æ‰§è¡ŒæŒ‡ä»¤ã€‚ ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨å»è¯»å–æˆ‘ä»¬å…ˆå‰æ”¾åˆ°å†…å­˜çš„æ•°æ®å‚æ•°ï¼Œæ‰§è¡Œç¨‹åºçš„è¯·æ±‚ã€‚ è°ƒç”¨å®Œæˆï¼Œæ“ä½œç³»ç»Ÿé‡ç½®CPUä¸ºç”¨æˆ·æ€è¿”å›ç»“æœï¼Œå¹¶æ‰§è¡Œä¸‹ä¸ªæŒ‡ä»¤ã€‚ æ‰€ä»¥å¤§å®¶ä¸€ç›´è¯´ï¼Œ1.6ä¹‹å‰æ˜¯é‡é‡çº§é”ï¼Œæ²¡é”™ï¼Œä½†æ˜¯ä»–é‡é‡çš„æœ¬è´¨ï¼Œæ˜¯ObjectMonitorè°ƒç”¨çš„è¿‡ç¨‹ï¼Œä»¥åŠLinuxå†…æ ¸çš„å¤æ‚è¿è¡Œæœºåˆ¶å†³å®šçš„ï¼Œå¤§é‡çš„ç³»ç»Ÿèµ„æºæ¶ˆè€—ï¼Œæ‰€ä»¥æ•ˆç‡æ‰ä½ã€‚è¿˜æœ‰ä¸¤ç§æƒ…å†µä¹Ÿä¼šå‘ç”Ÿå†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ï¼šå¼‚å¸¸äº‹ä»¶å’Œå¤–å›´è®¾å¤‡çš„ä¸­æ–­ å¤§å®¶ä¹Ÿå¯ä»¥äº†è§£ä¸‹ã€‚ æ™®é€šçš„IOè¯»å†™ä¹Ÿä¼šæ¶‰åŠåˆ°ç”¨æˆ·æ€å’Œå†…æ ¸çš„åˆ‡æ¢ï¼Œä½†æ˜¯ä¸ºäº†æå‡IO çš„æ€§èƒ½ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥é€šè¿‡ é›¶æ‹·è´ æ¥å®ç°ï¼ŒRediså’ŒKafka,è¿˜æœ‰nettyçš„åº•å±‚IOæ¨¡å‹éƒ½å­˜åœ¨é›¶æ‹·è´ã€‚ é”å¯¹æ¯” synchronizedå’ŒLockå¯¹æ¯”æˆ‘ä»¬å…ˆçœ‹çœ‹ä»–ä»¬çš„åŒºåˆ«ï¼š synchronizedæ˜¯å…³é”®å­—ï¼Œæ˜¯JVMå±‚é¢çš„åº•å±‚å•¥éƒ½å¸®æˆ‘ä»¬åšäº†ï¼Œè€ŒLockæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ˜¯JDKå±‚é¢çš„æœ‰ä¸°å¯Œçš„APIã€‚ synchronizedä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œè€ŒLockå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾é”ã€‚ synchronizedæ˜¯ä¸å¯ä¸­æ–­çš„ï¼ŒLockå¯ä»¥ä¸­æ–­ä¹Ÿå¯ä»¥ä¸ä¸­æ–­ã€‚ é€šè¿‡Lockå¯ä»¥çŸ¥é“çº¿ç¨‹æœ‰æ²¡æœ‰æ‹¿åˆ°é”ï¼Œè€Œsynchronizedä¸èƒ½ã€‚ synchronizedèƒ½é”ä½æ–¹æ³•å’Œä»£ç å—ï¼Œè€ŒLockåªèƒ½é”ä½ä»£ç å—ã€‚ Lockå¯ä»¥ä½¿ç”¨è¯»é”æé«˜å¤šçº¿ç¨‹è¯»æ•ˆç‡ã€‚ synchronizedæ˜¯éå…¬å¹³é”ï¼ŒReentrantLockå¯ä»¥æ§åˆ¶æ˜¯å¦æ˜¯å…¬å¹³é”ã€‚ ä¸¤è€…ä¸€ä¸ªæ˜¯JDKå±‚é¢çš„ä¸€ä¸ªæ˜¯JVMå±‚é¢çš„ï¼Œæˆ‘è§‰å¾—æœ€å¤§çš„åŒºåˆ«å…¶å®åœ¨ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ä¸°å¯Œçš„apiï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬çš„åœºæ™¯ã€‚ æ¯”å¦‚æˆ‘ç°åœ¨æ˜¯æ»´æ»´ï¼Œæˆ‘æ—©ä¸Šæœ‰æ‰“è½¦é«˜å³°ï¼Œæˆ‘ä»£ç ä½¿ç”¨äº†å¤§é‡çš„synchronizedï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿé”å‡çº§è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œè¿‡äº†é«˜å³°æˆ‘ä»¬è¿˜æ˜¯é‡é‡çº§çš„é”ï¼Œé‚£æ•ˆç‡æ˜¯ä¸æ˜¯å¤§æ‰“æŠ˜æ‰£äº†ï¼Ÿè¿™ä¸ªæ—¶å€™ä½ ç”¨Lockæ˜¯ä¸æ˜¯å¾ˆå¥½ï¼Ÿ synchronizedä½¿ç”¨æ³¨æ„äº‹é¡¹synchronizedæ˜¯é€šè¿‡è½¯ä»¶(JVM)å®ç°çš„ï¼Œç®€å•æ˜“ç”¨ï¼Œå³ä½¿åœ¨JDK5ä¹‹åæœ‰äº†Lockï¼Œä»ç„¶è¢«å¹¿æ³›åœ°ä½¿ç”¨ã€‚ ä½¿ç”¨Synchronizedæœ‰å“ªäº›è¦æ³¨æ„çš„ï¼Ÿ é”å¯¹è±¡ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºé”çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¯¹è±¡å¤´é‡Œ ä½œç”¨åŸŸä¸å®œè¿‡å¤§ï¼Œå½±å“ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ï¼Œæ§åˆ¶èŒƒå›´è¿‡å¤§ï¼Œç¼–å†™ä»£ç ä¹Ÿå®¹æ˜“å‡ºé”™ é¿å…æ­»é” åœ¨èƒ½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ—¢ä¸è¦ç”¨Lockä¹Ÿä¸è¦ç”¨synchronizedå…³é”®å­—ï¼Œç”¨java.util.concurrentåŒ…ä¸­çš„å„ç§å„æ ·çš„ç±»ï¼Œå¦‚æœä¸ç”¨è¯¥åŒ…ä¸‹çš„ç±»ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨synchronizedå…³é”®ï¼Œå› ä¸ºä»£ç é‡å°‘ï¼Œé¿å…å‡ºé”™ synchronizedæ˜¯å…¬å¹³é”å—ï¼Ÿ synchronizedå®é™…ä¸Šæ˜¯éå…¬å¹³çš„ï¼Œæ–°æ¥çš„çº¿ç¨‹æœ‰å¯èƒ½ç«‹å³è·å¾—ç›‘è§†å™¨ï¼Œè€Œåœ¨ç­‰å¾…åŒºä¸­ç­‰å€™å·²ä¹…çš„çº¿ç¨‹å¯èƒ½å†æ¬¡ç­‰å¾…ï¼Œä¸è¿‡è¿™ç§æŠ¢å çš„æ–¹å¼å¯ä»¥é¢„é˜²é¥¥é¥¿ã€‚ å‚è€ƒæ–‡æ¡£Linuxæ¢ç§˜ä¹‹ç”¨æˆ·æ€ä¸å†…æ ¸æ€ å‚»ç“œä¸‰æ­ªè®©æˆ‘æ•™ä»–ã€Œé›¶æ‹·è´ã€ åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ã€è‡ªæ—‹é”ã€è‡ªé€‚åº”è‡ªæ—‹é” å…³äº é”çš„å››ç§çŠ¶æ€ä¸é”å‡çº§è¿‡ç¨‹ å›¾æ–‡è¯¦è§£ æ­»ç£•Synchronizedåº•å±‚å®ç°","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[]},{"title":"åˆ†å¸ƒå¼-ç§’æ€ç³»ç»Ÿè®¾è®¡","date":"2021-07-29T03:03:58.000Z","path":"wiki/åˆ†å¸ƒå¼-ç§’æ€ç³»ç»Ÿè®¾è®¡/","text":"ç§’æ€ç³»ç»Ÿçš„æŒ‘æˆ˜é«˜å¹¶å‘ç§’æ€æ´»åŠ¨çš„ç‰¹ç‚¹å°±æ˜¯çŸ­æ—¶é—´å†…èšé›†å¤§é‡è¯·æ±‚ç¬æ—¶åˆ°è¾¾æœåŠ¡ç«¯ï¼Œæ­¤æ—¶æ•°æ®åº“å·²ç»æ— æ³•æ”¯æ’‘å¦‚æ­¤å¤§æ•°æ®é‡çš„è¯·æ±‚äº†ã€‚å•ä¸ªçš„æ•°æ®åº“QPSä»…æœ‰å‡ ç™¾ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œé‚£æˆ‘æ˜¯ä¸æ˜¯å¯ä»¥éƒ¨ç½²ä¸€ä¸ªæ•°æ®åº“é›†ç¾¤å‘¢ï¼Œåœ¨æ•°æ®åº“é›†ç¾¤å‰ä½¿ç”¨Nginxåˆ†å‘ï¼Œå°†è´Ÿè½½å¹³å‡åˆ†æ‘Šåˆ°æ¯ä¸€ä¸ªæ•°æ®åº“ä¸å°±å¯ä»¥äº†å—ã€‚è¿™ç§æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å›½å†…çœŸæ­£çš„äº’è”ç½‘å¤§å‚è‚¯å®šä¸æ˜¯è¿™æ ·åšçš„ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹å®Œå…¨å¯ä»¥ä½¿ç”¨å†…å­˜æ“ä½œæ¥ä»£æ›¿è®¿é—®æ•°æ®åº“ï¼Œæ¯”å¦‚Redisé›†ç¾¤ã€‚åœ¨ç½‘ç»œå¸¦å®½å…è®¸çš„æƒ…å†µä¸‹ï¼ŒRedisçš„é›†ç¾¤çš„ç³»ç»Ÿååé‡è‚¯å®šå’Œæ•°æ®åº“é›†ç¾¤ä¸æ˜¯ä¸€ä¸ªé‡çº§çš„ï¼Œè¿™é‡Œè¦æŸ¥å‡ åå€å‡ ç™¾å€ã€‚ è¶…å–è¶…å–æœ€ç›´æ¥çš„åæœå°±æ˜¯å¯èƒ½ä¼šå¯¹å…¬å¸é€ æˆç›´æ¥çš„ç»æµæŸå¤±ã€‚é˜²æ­¢è¶…å–æ˜¯ç§’æ€ç³»ç»Ÿå¿…é¡»è¦ä¿è¯çš„ä¸€ç‚¹ã€‚è¶…å–çš„è§£å†³åŠæ³•å°±æ˜¯åŠ é”ï¼Œä¿è¯åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹åº“å­˜å¯ä»¥æ­£å¸¸çš„æ­£ç¡®çš„æ‰£å‡ã€‚ æ¶æ„è¯·æ±‚äº§å“å±‚ç­–ç•¥ç§’æ€å™¨ä¸€èˆ¬ä¸‹å•å’Œè´­ä¹°åŠå…¶è¿…é€Ÿï¼Œæ ¹æ®è´­ä¹°è®°å½•å¯ä»¥ç”„åˆ«å‡ºä¸€éƒ¨åˆ†ã€‚å¯ä»¥é€šè¿‡æ ¡éªŒç è¾¾åˆ°ä¸€å®šçš„æ–¹æ³•ï¼Œè¿™å°±è¦æ±‚æ ¡éªŒç è¶³å¤Ÿå®‰å…¨ï¼Œä¸è¢«ç ´è§£ï¼Œé‡‡ç”¨çš„æ–¹å¼æœ‰ï¼šç§’æ€ä¸“ç”¨éªŒè¯ç ï¼Œç”µè§†å…¬å¸ƒéªŒè¯ç ï¼Œç§’æ€ç­”é¢˜ã€‚ å‰ç«¯æ§åˆ¶é™¤æ­¤ä¹‹å¤–å‰æ®µå¯ä»¥æ·»åŠ ç‚¹å‡»æ¬¡æ•°é™åˆ¶ï¼Œç‚¹å‡»ä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå°†æŒ‰é’®ç½®ç°è‰²ï¼Œæˆ–è€…åœ¨jså±‚çº§è¿›è¡Œæ§åˆ¶ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯æ¯æ¬¡éƒ½ç‚¹å‡»æˆåŠŸäº†ï¼Œä½†æ˜¯ä»…ä»…å‘èµ·ä¸€æ¬¡æœåŠ¡ç«¯è¯·æ±‚ï¼› åç«¯æ§åˆ¶ æ·»åŠ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ‰§è¡Œä¸€å®šæ•°é‡æ—¶ï¼Œé˜Ÿåˆ—åç»­çš„æ¶ˆæ¯ä¸åœ¨æ‰§è¡Œ åç«¯æ¶æ„æŒ‰ç…§æ¨¡å—æ‹†åˆ†ï¼Œç”¨æˆ·ä¸åŒçš„è¯·æ±‚åˆ†æ•£è½¬å‘åˆ°å„ä¸ªæ¨¡å—çš„æœåŠ¡å™¨ï¼Œè´Ÿè½½å‡è¡¡ æ•°æ®åº“åˆ†åº“åˆ†è¡¨ï¼ˆåˆ†ç‰‡ç­–ç•¥ï¼‰å’Œredisé›†ç¾¤ å‡çº§æœåŠ¡å™¨å¸¦å®½ï¼Œå‹åŠ›æµ‹è¯•ï¼Œä¿è¯ç³»ç»Ÿååé‡ è¿‡è½½ä¿æŠ¤ï¼Œé™æµï¼Œè¯·æ±‚æ‹’ç»å’ŒæœåŠ¡é™çº§ é“¾æ¥åŠ ç›é“¾æ¥åŠ ç›ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ä¿æŠ¤æ¶æ„æ”»å‡»ï¼Œæ¯”å¦‚ä¸‹å•æ¥å£ï¼Œå¦‚æœæš´éœ²ä¹‹åï¼Œå°±ä¼šå­˜åœ¨æ¶æ„æ”»å‡»ï¼Œä¸€ä¸ªç”¨æˆ·ä¸‹äº†å‡ ç™¾ä¸ªå•çš„æƒ…å†µæˆ–è€…ä¸€ä¸ªIPä¸‹äº†å¾ˆå¤šå•å­ï¼Œç±»ä¼¼ä¸é»„ç‰›æŠ¢ç¥¨ä¹‹åå†å»å”®å–ã€‚ ç§’æ€ç³»ç»Ÿæ¶æ„å›¾ï¼ˆå‚è€ƒï¼‰ å‚è€ƒèµ„æ–™ æ•–ä¸™å¸¦ä½ è®¾è®¡ã€ç§’æ€ç³»ç»Ÿã€‘ã€ŠåŠæ‰“é¢è¯•å®˜ã€‹ç³»åˆ—-ç§’æ€ç³»ç»Ÿè®¾è®¡è¿™æ˜¯æˆ‘è¯»è¿‡å†™å¾—æœ€å¥½çš„ã€ç§’æ€ç³»ç»Ÿæ¶æ„ã€‘åˆ†æä¸å®æˆ˜ï¼è¿™ä¸€æ¬¡ï¼Œå½»åº•å¼„æ‡‚â€œç§’æ€ç³»ç»Ÿâ€","tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"categories":[]},{"title":"JVM-Xms,Xmxå’ŒXss","date":"2021-07-28T13:04:14.000Z","path":"wiki/JVM-Xms-Xmxå’ŒXss/","text":"æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰-Xssè§„å®šäº†æ¯ä¸ªçº¿ç¨‹è™šæ‹Ÿæœºæ ˆåŠå †æ ˆçš„å¤§å°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ256kæ˜¯è¶³å¤Ÿçš„ï¼Œæ­¤é…ç½®å°†ä¼šå½±å“æ­¤è¿›ç¨‹ä¸­å¹¶å‘çº¿ç¨‹æ•°çš„å¤§å°ã€‚ -Xmsè¡¨ç¤ºåˆå§‹åŒ–JAVAå †çš„å¤§å°åŠè¯¥è¿›ç¨‹åˆšåˆ›å»ºå‡ºæ¥çš„æ—¶å€™ï¼Œä»–çš„ä¸“å±JAVAå †çš„å¤§å°ï¼Œä¸€æ—¦å¯¹è±¡å®¹é‡è¶…è¿‡äº†JAVAå †çš„åˆå§‹å®¹é‡ï¼ŒJAVAå †å°†ä¼šè‡ªåŠ¨æ‰©å®¹åˆ°-Xmxå¤§å°ã€‚ -Xmxè¡¨ç¤ºjavaå †å¯ä»¥æ‰©å±•åˆ°çš„æœ€å¤§å€¼ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé€šå¸¸å°†-Xmså’Œ-Xmxè®¾ç½®æˆä¸€æ ·çš„ï¼Œå› ä¸ºå½“å †ä¸å¤Ÿç”¨è€Œå‘ç”Ÿæ‰©å®¹æ—¶ï¼Œä¼šå‘ç”Ÿå†…å­˜æŠ–åŠ¨å½±å“ç¨‹åºè¿è¡Œæ—¶çš„ç¨³å®šæ€§ã€‚ å †å†…å­˜åˆ†é…ï¼šJVMåˆå§‹åˆ†é…çš„å†…å­˜ç”±-XmsæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64JVMæœ€å¤§åˆ†é…çš„å†…å­˜ç”±-XmxæŒ‡å®šï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4é»˜è®¤ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMå°±ä¼šå¢å¤§å †ç›´åˆ°-Xmxçš„æœ€å¤§é™åˆ¶ï¼›ç©ºä½™å †å†…å­˜å¤§äº70%æ—¶ï¼ŒJVMä¼šå‡å°‘å †ç›´åˆ° -Xmsçš„æœ€å°é™åˆ¶ã€‚å› æ­¤æœåŠ¡å™¨ä¸€èˆ¬è®¾ç½®-Xmsã€-Xmxç›¸ç­‰ä»¥é¿å…åœ¨æ¯æ¬¡GC åè°ƒæ•´å †çš„å¤§å°ã€‚å¯¹è±¡çš„å †å†…å­˜ç”±ç§°ä¸ºåƒåœ¾å›æ”¶å™¨çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ç³»ç»Ÿå›æ”¶ã€‚éå †å†…å­˜åˆ†é…ï¼šJVMä½¿ç”¨-XX:PermSizeè®¾ç½®éå †å†…å­˜åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼›ç”±XX:MaxPermSizeè®¾ç½®æœ€å¤§éå †å†…å­˜çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚-Xmn2Gï¼šè®¾ç½®å¹´è½»ä»£å¤§å°ä¸º2Gã€‚-XX:SurvivorRatioï¼Œè®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„æ¯”å€¼ã€‚ å‚è€ƒèµ„æ–™1ã€ç±»ä¼¼-Xmsã€-Xmnè¿™äº›å‚æ•°çš„å«ä¹‰ï¼š2ã€JVMä¸‰å¤§æ€§èƒ½è°ƒä¼˜å‚æ•°Xmsï¼ŒXmxï¼ŒXssçš„å«ä¹‰ï¼Œä½ åˆçŸ¥é“å¤šå°‘å‘¢","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"JVM-è‡ªå®šä¹‰ç±»åŠ è½½å™¨","date":"2021-07-28T13:02:32.000Z","path":"wiki/JVM-è‡ªå®šä¹‰ç±»åŠ è½½å™¨/","text":"å¦‚ä½•è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰åŠ è½½å™¨ åŸå› ï¼š1ã€å­˜æ”¾åœ¨è‡ªå®šä¹‰è·¯å¾„ä¸Šçš„ç±»ï¼Œéœ€è¦é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»åŠ è½½ã€‚ã€æ³¨æ„ï¼šAppClassLoaderåŠ è½½classpathä¸‹çš„ç±»ã€‘2ã€ç±»ä¸ä¸€å®šä»æ–‡ä»¶ä¸­åŠ è½½ï¼Œä¹Ÿå¯èƒ½ä»ç½‘ç»œä¸­çš„æµä¸­åŠ è½½ï¼Œè¿™å°±éœ€è¦è‡ªå®šä¹‰åŠ è½½å™¨å»å®ç°åŠ å¯†è§£å¯†ã€‚3ã€å¯ä»¥å®šä¹‰ç±»çš„å®ç°æœºåˆ¶ï¼Œå®ç°ç±»çš„çƒ­éƒ¨ç½²,å¦‚OSGiä¸­çš„bundleæ¨¡å—å°±æ˜¯é€šè¿‡å®ç°è‡ªå·±çš„ClassLoaderå®ç°çš„ï¼Œå¦‚tomcatå®ç°çš„è‡ªå®šä¹‰ç±»åŠ è½½æ¨¡å‹ã€‚ å¦‚ä½•å®ç°è‡ªå®šä¹‰åŠ è½½å™¨ å®ç°è‡ªå®šä¹‰ç±»åŠ è½½æœ‰ä»¥ä¸‹ä¸¤æ­¥ï¼š1ã€ç»§æ‰¿ClassLoader2ã€é‡å†™findClassï¼Œåœ¨findClassé‡Œè·å–ç±»çš„å­—èŠ‚ç ï¼Œå¹¶è°ƒç”¨ClassLoaderä¸­çš„defineClassæ–¹æ³•æ¥åŠ è½½ç±»ï¼Œè·å–classå¯¹è±¡ã€‚æ³¨æ„ï¼šå¦‚æœè¦æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶ï¼Œéœ€è¦é‡å†™loadClassæ–¹æ³•ã€‚å¦‚ä¸‹ï¼šæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ çš„ç±»åŠ è½½å™¨ 1234567891011121314151617181920public static class MyClassLoader extends ClassLoader&#123; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] data=null; try &#123; data= loadByte(name); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return this.defineClass(data,0,data.length); &#125; private byte[] loadByte(String name) throws IOException &#123; File file = new File(&quot;/Users/admin/test/&quot;+name); FileInputStream fi = new FileInputStream(file); int len = fi.available(); byte[] b = new byte[len]; fi.read(b); return b; &#125; &#125; ä¸‹é¢æ˜¯è¦åŠ è½½çš„ç±»ï¼š 12345public class Demo&#123;public void say()&#123;System.out.println(&quot;hello&quot;);&#125;&#125; è¯¥ç±»ç¼–è¯‘åçš„class æ–‡ä»¶æ”¾ç½®åœ¨/Users/admin/test/ä¸‹,ç„¶åæ‰§è¡Œå¦‚ä¸‹ä»£ç å»åŠ è½½ï¼š 1234567MyClassLoader classLoader = new MyClassLoader(); Class clazz = classLoader.loadClass(&quot;Demo.class&quot;); Object o=clazz.newInstance(); Method method = clazz.getMethod(&quot;say&quot;); method.invoke(o);è¾“å‡º:hello èƒ½ä¸èƒ½è‡ªå·±å†™ä¸€ä¸ªjava.lang.String 1ã€ä»£ç ä¹¦å†™åå¯ä»¥ç¼–è¯‘ä¸ä¼šæŠ¥é”™2ã€åœ¨å¦ä¸€ä¸ªç±»ä¸­åŠ è½½java.lang.Stringï¼Œé€šè¿‡åå°„è°ƒç”¨è‡ªå·±å†™çš„Stringç±»é‡Œçš„æ–¹æ³•ï¼Œå¾—åˆ°ç»“æœNoSuchMethodï¼Œè¯´æ˜åŠ è½½çš„è¿˜æ˜¯åŸæ¥çš„Stringï¼Œå› ä¸ºé€šè¿‡åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¼šæŠŠjava.lang.Stringä¸€ç›´æäº¤ç»™å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œé€šè¿‡ä»–åŠ è½½ï¼ŒåŠ è½½åˆ°çš„æ°¸è¿œæ˜¯/libä¸‹é¢çš„java.lang.String3ã€åœ¨è¿™ä¸ªè‡ªå·±å†™çš„ç±»ä¸­å†™ä¸Šmainæ–¹æ³•public static void main(String[] args)æ‰§è¡Œmainæ–¹æ³•æŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªStringå¹¶ä¸æ˜¯ç³»ç»Ÿçš„java.lang.Stringï¼Œæ‰€ä»¥JVMæ‰¾ä¸åˆ°mainæ–¹æ³•çš„ç­¾å å‚è€ƒèµ„æ–™JVM:å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ŸåŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_28605513/article/details/85014451","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"åˆ†å¸ƒå¼-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•","date":"2021-07-28T13:01:05.000Z","path":"wiki/åˆ†å¸ƒå¼-ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•/","text":"ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•(Consistent Hashing Algorithm)æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç®—æ³•ï¼Œå¸¸ç”¨äºè´Ÿè½½å‡è¡¡ã€‚Memcached clientä¹Ÿé€‰æ‹©è¿™ç§ç®—æ³•ï¼Œè§£å†³å°†key-valueå‡åŒ€åˆ†é…åˆ°ä¼—å¤šMemcached serverä¸Šçš„é—®é¢˜ã€‚å®ƒå¯ä»¥å–ä»£ä¼ ç»Ÿçš„å–æ¨¡æ“ä½œï¼Œè§£å†³äº†å–æ¨¡æ“ä½œæ— æ³•åº”å¯¹å¢åˆ Memcached Serverçš„é—®é¢˜(å¢åˆ serverä¼šå¯¼è‡´åŒä¸€ä¸ªkey,åœ¨getæ“ä½œæ—¶åˆ†é…ä¸åˆ°æ•°æ®çœŸæ­£å­˜å‚¨çš„serverï¼Œå‘½ä¸­ç‡ä¼šæ€¥å‰§ä¸‹é™)ã€‚ å“ˆå¸ŒæŒ‡æ ‡ è¯„ä¼°ä¸€ä¸ªå“ˆå¸Œç®—æ³•çš„ä¼˜åŠ£ï¼Œæœ‰å¦‚ä¸‹æŒ‡æ ‡ï¼Œè€Œä¸€è‡´æ€§å“ˆå¸Œå…¨éƒ¨æ»¡è¶³ï¼š å‡è¡¡æ€§(Balance)ï¼šå°†å…³é”®å­—çš„å“ˆå¸Œåœ°å€å‡åŒ€åœ°åˆ†å¸ƒåœ¨åœ°å€ç©ºé—´ä¸­ï¼Œä½¿åœ°å€ç©ºé—´å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œè¿™æ˜¯è®¾è®¡å“ˆå¸Œçš„ä¸€ä¸ªåŸºæœ¬ç‰¹æ€§ã€‚ å•è°ƒæ€§(Monotonicity): å•è°ƒæ€§æ˜¯æŒ‡å½“åœ°å€ç©ºé—´å¢å¤§æ—¶ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°æ‰€å¾—åˆ°çš„å…³é”®å­—çš„å“ˆå¸Œåœ°å€ä¹Ÿèƒ½æ˜ å°„çš„æ–°çš„åœ°å€ç©ºé—´ï¼Œè€Œä¸æ˜¯ä»…é™äºåŸå…ˆçš„åœ°å€ç©ºé—´ã€‚æˆ–ç­‰åœ°å€ç©ºé—´å‡å°‘æ—¶ï¼Œä¹Ÿæ˜¯åªèƒ½æ˜ å°„åˆ°æœ‰æ•ˆçš„åœ°å€ç©ºé—´ä¸­ã€‚ç®€å•çš„å“ˆå¸Œå‡½æ•°å¾€å¾€ä¸èƒ½æ»¡è¶³æ­¤æ€§è´¨ã€‚ åˆ†æ•£æ€§(Spread): å“ˆå¸Œç»å¸¸ç”¨åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œç»ˆç«¯ç”¨æˆ·é€šè¿‡å“ˆå¸Œå‡½æ•°å°†è‡ªå·±çš„å†…å®¹å­˜åˆ°ä¸åŒçš„ç¼“å†²åŒºã€‚æ­¤æ—¶ï¼Œç»ˆç«¯æœ‰å¯èƒ½çœ‹ä¸åˆ°æ‰€æœ‰çš„ç¼“å†²ï¼Œè€Œæ˜¯åªèƒ½çœ‹åˆ°å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å½“ç»ˆç«¯å¸Œæœ›é€šè¿‡å“ˆå¸Œè¿‡ç¨‹å°†å†…å®¹æ˜ å°„åˆ°ç¼“å†²ä¸Šæ—¶ï¼Œç”±äºä¸åŒç»ˆç«¯æ‰€è§çš„ç¼“å†²èŒƒå›´æœ‰å¯èƒ½ä¸åŒï¼Œä»è€Œå¯¼è‡´å“ˆå¸Œçš„ç»“æœä¸ä¸€è‡´ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ç›¸åŒçš„å†…å®¹è¢«ä¸åŒçš„ç»ˆç«¯æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ã€‚è¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯åº”è¯¥é¿å…çš„ï¼Œå› ä¸ºå®ƒå¯¼è‡´ç›¸åŒå†…å®¹è¢«å­˜å‚¨åˆ°ä¸åŒç¼“å†²ä¸­å»ï¼Œé™ä½äº†ç³»ç»Ÿå­˜å‚¨çš„æ•ˆç‡ã€‚åˆ†æ•£æ€§çš„å®šä¹‰å°±æ˜¯ä¸Šè¿°æƒ…å†µå‘ç”Ÿçš„ä¸¥é‡ç¨‹åº¦ã€‚å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é¿å…ä¸ä¸€è‡´çš„æƒ…å†µå‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯å°½é‡é™ä½åˆ†æ•£æ€§ã€‚ è´Ÿè½½(Load): è´Ÿè½½é—®é¢˜å®é™…ä¸Šæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦çœ‹å¾…åˆ†æ•£æ€§é—®é¢˜ã€‚æ—¢ç„¶ä¸åŒçš„ç»ˆç«¯å¯èƒ½å°†ç›¸åŒçš„å†…å®¹æ˜ å°„åˆ°ä¸åŒçš„ç¼“å†²åŒºä¸­ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªç‰¹å®šçš„ç¼“å†²åŒºè€Œè¨€ï¼Œä¹Ÿå¯èƒ½è¢«ä¸åŒçš„ç”¨æˆ·æ˜ å°„ä¸ºä¸åŒçš„å†…å®¹ã€‚ä¸åˆ†æ•£æ€§ä¸€æ ·ï¼Œè¿™ç§æƒ…å†µä¹Ÿæ˜¯åº”å½“é¿å…çš„ï¼Œå› æ­¤å¥½çš„å“ˆå¸Œç®—æ³•åº”èƒ½å¤Ÿå°½é‡é™ä½ç¼“å†²çš„è´Ÿè· ä¸€è‡´æ€§å“ˆå¸Œ å°†èŠ‚ç‚¹é€šè¿‡hashæ˜ å°„åˆ°hashç¯ä¸Šï¼Œç†æƒ³çš„æƒ…å†µæ˜¯å¤šä¸ªèŠ‚ç‚¹ç›´æ¥åˆ†å¸ƒå‡åŒ€ å½“æˆ‘ä»¬çš„å¯¹è±¡é€šè¿‡hashç®—æ³•åˆ†é…åœ¨hashç¯ä¸Šçš„æ—¶å€™ï¼Œå®ƒæ˜¯å›ºå®šåˆ†é…åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„ç©ºé—´ä¸Šçš„ï¼Œå½“æˆ‘ä»¬åœ¨BCä¹‹é—´æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä»…ä»…ä¼šå½±å“åˆ°BCè¿™ä¸€æ®µç©ºé—´ä¸Šçš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä¸ªç¯ä¸Šçš„æ•°æ®éƒ½è¦è·Ÿç€å˜åŒ–ï¼› ç°å®æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½åˆ†é…ä¸å‡åŒ€ è¿™å’Œä¼ ç»Ÿçš„hashå–æ¨¡ä¸€æ ·ï¼ŒåŒæ ·ä¼šæ•°æ®å€¾æ–œçš„é—®é¢˜ï¼ è™šæ‹ŸèŠ‚ç‚¹ è¿™ä¸ªæ—¶å€™è™šæ‹ŸèŠ‚ç‚¹å°±æ­¤è¯ç”Ÿï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è™šæ‹ŸèŠ‚ç‚¹åœ¨ä¸€è‡´æ€§Hashä¸­çš„ä½œç”¨ã€‚å½“æˆ‘ä»¬åœ¨Hashç¯ä¸Šæ–°å¢è‹¥å¹²ä¸ªç‚¹ï¼Œé‚£ä¹ˆæ¯ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å°±ä¼šæ¥è¿‘ç›¸ç­‰ã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯æˆ‘ä»¬å¯ä»¥æ–°å¢è‹¥å¹²ä¸ªç‰‡/è¡¨ï¼Œä½†æ˜¯æˆæœ¬æœ‰é™ï¼Œæˆ‘ä»¬é€šè¿‡å¤åˆ¶å¤šä¸ªAã€Bã€Cçš„å‰¯æœ¬({A1-An},{B1-Bn},{C1-Cn})ä¸€èµ·å‚ä¸è®¡ç®—ï¼ŒæŒ‰ç…§é¡ºæ—¶é’ˆçš„æ–¹å‘è¿›è¡Œæ•°æ®åˆ†å¸ƒï¼ŒæŒ‰ç…§ä¸‹å›¾ç¤ºæ„: æ­¤æ—¶A=[A,C1)&amp;[A1,C2)&amp;[A2,B4)&amp;[A3,A4)&amp;[A4,B1)ï¼›B=[B,A1)&amp;[B2,C)&amp;[B3,C3)&amp;[B4,C4)&amp;[B1,A)ï¼›C=[C1,B)&amp;[C2,B2)&amp;[C,B3)&amp;[B3,C3)&amp;[C4,A3)ï¼›ç”±å›¾å¯ä»¥çœ‹å‡ºåˆ†å¸ƒç‚¹è¶Šå¯†é›†ï¼Œå¹³è¡¡æ€§çº¦å¥½ã€‚ ç®—æ³•å®ç°ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰å¤šç§å…·ä½“çš„å®ç°ï¼ŒåŒ…æ‹¬ Chord ç®—æ³•ï¼ŒKAD ç®—æ³•ç­‰ï¼Œéƒ½æ¯”è¾ƒå¤æ‚ã€‚ å‚è€ƒèµ„æ–™1 ã€ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„åŸç†ä¸å®ç°2ã€æµ…è°ˆä¸€è‡´æ€§HashåŸç†åŠåº”ç”¨","tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"categories":[{"name":"Distributed Dir","slug":"Distributed-Dir","permalink":"http://example.com/categories/Distributed-Dir/"},{"name":"theory","slug":"Distributed-Dir/theory","permalink":"http://example.com/categories/Distributed-Dir/theory/"}]},{"title":"åˆ†å¸ƒå¼-CAPç†è®º","date":"2021-07-28T10:15:10.000Z","path":"wiki/åˆ†å¸ƒå¼-CAPç†è®º/","text":"CAP åŸåˆ™CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ã€‚CAPåŸåˆ™çš„ç²¾é«“å°±æ˜¯è¦ä¹ˆAPï¼Œè¦ä¹ˆCPï¼Œè¦ä¹ˆACï¼Œä½†æ˜¯ä¸å­˜åœ¨CAPã€‚ ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ˜¯å¦åŒæ ·çš„å€¼ï¼Œå³å†™æ“ä½œä¹‹åçš„è¯»æ“ä½œï¼Œå¿…é¡»è¿”å›è¯¥å€¼ã€‚ï¼ˆåˆ†ä¸ºå¼±ä¸€è‡´æ€§ã€å¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼‰ å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šåœ¨é›†ç¾¤ä¸­ä¸€éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœåï¼Œé›†ç¾¤æ•´ä½“æ˜¯å¦è¿˜èƒ½å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ã€‚ï¼ˆå¯¹æ•°æ®æ›´æ–°å…·å¤‡é«˜å¯ç”¨æ€§ï¼‰ åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰ï¼šä»¥å®é™…æ•ˆæœè€Œè¨€ï¼Œåˆ†åŒºç›¸å½“äºå¯¹é€šä¿¡çš„æ—¶é™è¦æ±‚ã€‚ç³»ç»Ÿå¦‚æœä¸èƒ½åœ¨æ—¶é™å†…è¾¾æˆæ•°æ®ä¸€è‡´æ€§ï¼Œå°±æ„å‘³ç€å‘ç”Ÿäº†åˆ†åŒºçš„æƒ…å†µï¼Œå¿…é¡»å°±å½“å‰æ“ä½œåœ¨Cå’ŒAä¹‹é—´åšå‡ºé€‰æ‹©ã€‚ å–èˆç­–ç•¥ CA without P å¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†æ”¾å¼ƒPçš„åŒæ—¶ä¹Ÿå°±æ„å‘³ç€æ”¾å¼ƒäº†ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼èŠ‚ç‚¹å—é™ï¼Œæ²¡åŠæ³•éƒ¨ç½²å­èŠ‚ç‚¹ï¼Œè¿™æ˜¯è¿èƒŒåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„åˆè¡·çš„ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“RDBMSï¼šOracleã€MySQLå°±æ˜¯CAã€‚ CP without A å¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´ä¿æŒå¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿(ä¹Ÿå°±æ˜¯ç­‰å¾…æ•°æ®åŒæ­¥å®Œæ‰èƒ½æ­£å¸¸è®¿é—®æœåŠ¡)ï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è€…æ¶ˆæ¯ä¸¢å¤±ç­‰æƒ…å†µï¼Œå°±è¦ç‰ºç‰²ç”¨æˆ·çš„ä½“éªŒï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®å…¨éƒ¨ä¸€è‡´äº†ä¹‹åå†è®©ç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚è®¾è®¡æˆCPçš„ç³»ç»Ÿå…¶å®ä¸å°‘ï¼Œæœ€å…¸å‹çš„å°±æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¦‚Redisã€HBaseç­‰ã€‚å¯¹äºè¿™äº›åˆ†å¸ƒå¼æ•°æ®åº“æ¥è¯´ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå› ä¸ºå¦‚æœè¿è¿™ä¸ªæ ‡å‡†éƒ½è¾¾ä¸åˆ°ï¼Œé‚£ä¹ˆç›´æ¥é‡‡ç”¨å…³ç³»å‹æ•°æ®åº“å°±å¥½ï¼Œæ²¡å¿…è¦å†æµªè´¹èµ„æºæ¥éƒ¨ç½²åˆ†å¸ƒå¼æ•°æ®åº“ã€‚ AP wihtout C è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚å…¸å‹çš„åº”ç”¨å°±å¦‚æŸç±³çš„æŠ¢è´­æ‰‹æœºåœºæ™¯ï¼Œå¯èƒ½å‰å‡ ç§’ä½ æµè§ˆå•†å“çš„æ—¶å€™é¡µé¢æç¤ºæ˜¯æœ‰åº“å­˜çš„ï¼Œå½“ä½ é€‰æ‹©å®Œå•†å“å‡†å¤‡ä¸‹å•çš„æ—¶å€™ï¼Œç³»ç»Ÿæç¤ºä½ ä¸‹å•å¤±è´¥ï¼Œå•†å“å·²å”®å®Œã€‚è¿™å…¶å®å°±æ˜¯å…ˆåœ¨ Aï¼ˆå¯ç”¨æ€§ï¼‰æ–¹é¢ä¿è¯ç³»ç»Ÿå¯ä»¥æ­£å¸¸çš„æœåŠ¡ï¼Œç„¶ååœ¨æ•°æ®çš„ä¸€è‡´æ€§æ–¹é¢åšäº†äº›ç‰ºç‰²ï¼Œè™½ç„¶å¤šå°‘ä¼šå½±å“ä¸€äº›ç”¨æˆ·ä½“éªŒï¼Œä½†ä¹Ÿä¸è‡³äºé€ æˆç”¨æˆ·è´­ç‰©æµç¨‹çš„ä¸¥é‡é˜»å¡ã€‚ è§£å†³æ–¹æ¡ˆâ€”â€”BASEBASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’ŒEventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç®€å†™ï¼ŒBASEæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœã€‚ æ ¸å¿ƒæ€æƒ³ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong consistencyï¼‰ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual consistencyï¼‰ã€‚ åŸºæœ¬å¯ç”¨Basically Available åŸºæœ¬å¯ç”¨æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§â€”â€”ä½†è¯·æ³¨æ„ï¼Œè¿™ç»ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ï¼Œä»¥ä¸‹ä¸¤ä¸ªå°±æ˜¯â€œåŸºæœ¬å¯ç”¨â€çš„å…¸å‹ä¾‹å­ã€‚ å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœ¨çº¿æœç´¢å¼•æ“éœ€è¦0.5ç§’å†…è¿”å›ç»™ç”¨æˆ·ç›¸åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°å¼‚å¸¸ï¼ˆæ¯”å¦‚ç³»ç»Ÿéƒ¨åˆ†æœºæˆ¿å‘ç”Ÿæ–­ç”µæˆ–æ–­ç½‘æ•…éšœï¼‰ï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº†1~2ç§’ã€‚åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™ä¸Šè¿›è¡Œè´­ç‰©ï¼Œæ¶ˆè´¹è€…å‡ ä¹èƒ½å¤Ÿé¡ºåˆ©åœ°å®Œæˆæ¯ä¸€ç¬”è®¢å•ï¼Œä½†æ˜¯åœ¨ä¸€äº›èŠ‚æ—¥å¤§ä¿ƒè´­ç‰©é«˜å³°çš„æ—¶å€™ï¼Œç”±äºæ¶ˆè´¹è€…çš„è´­ç‰©è¡Œä¸ºæ¿€å¢ï¼Œä¸ºäº†ä¿æŠ¤è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§é¡µé¢ã€‚ è½¯çŠ¶æ€Soft state è½¯çŠ¶æ€ä¹Ÿç§°å¼±çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨å»¶æ—¶ã€‚ æœ€ç»ˆä¸€è‡´æ€§Eventually consistent æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚ å‚è€ƒèµ„æ–™åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/lixinkuan328/article/details/95535691","tags":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"categories":[{"name":"Distributed Dir","slug":"Distributed-Dir","permalink":"http://example.com/categories/Distributed-Dir/"},{"name":"theory","slug":"Distributed-Dir/theory","permalink":"http://example.com/categories/Distributed-Dir/theory/"}]},{"title":"Mysql-äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†","date":"2021-07-28T10:13:07.000Z","path":"wiki/Mysql-äº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†/","text":"MySQLäº‹åŠ¡ç‰¹æ€§ä¸å®ç°åŸç†1. äº‹åŠ¡ç‰¹æ€§ åŸå­æ€§(Atomicity) äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œä½œä¸ºä¸€ä¸ªæ•´ä½“åƒåŸå­ä¸€æ ·ä¸å¯åˆ†å‰²ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ ä¸€è‡´æ€§(Consistency) äº‹åŠ¡çš„æ‰§è¡Œç»“æœå¿…é¡»ä½¿æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚ä¸€è‡´æ€§çŠ¶æ€æ˜¯æŒ‡:1.ç³»ç»Ÿçš„çŠ¶æ€æ»¡è¶³æ•°æ®çš„å®Œæ•´æ€§çº¦æŸ(ä¸»ç ,å‚ç…§å®Œæ•´æ€§,checkçº¦æŸç­‰) 2.ç³»ç»Ÿçš„çŠ¶æ€ååº”æ•°æ®åº“æœ¬åº”æè¿°çš„ç°å®ä¸–ç•Œçš„çœŸå®çŠ¶æ€,æ¯”å¦‚è½¬è´¦å‰åä¸¤ä¸ªè´¦æˆ·çš„é‡‘é¢æ€»å’Œåº”è¯¥ä¿æŒä¸å˜ã€‚ éš”ç¦»æ€§(Isolation) å¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡ä¸ä¼šç›¸äº’å½±å“,å…¶å¯¹æ•°æ®åº“çš„å½±å“å’Œå®ƒä»¬ä¸²è¡Œæ‰§è¡Œæ—¶ä¸€æ ·ã€‚æ¯”å¦‚å¤šä¸ªç”¨æˆ·åŒæ—¶å¾€ä¸€ä¸ªè´¦æˆ·è½¬è´¦,æœ€åè´¦æˆ·çš„ç»“æœåº”è¯¥å’Œä»–ä»¬æŒ‰å…ˆåæ¬¡åºè½¬è´¦çš„ç»“æœä¸€æ ·ã€‚ æŒä¹…æ€§(Durability) äº‹åŠ¡ä¸€æ—¦æäº¤,å…¶å¯¹æ•°æ®åº“çš„æ›´æ–°å°±æ˜¯æŒä¹…çš„ã€‚ä»»ä½•äº‹åŠ¡æˆ–ç³»ç»Ÿæ•…éšœéƒ½ä¸ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ åœ¨äº‹åŠ¡çš„ACIDç‰¹æ€§ä¸­,Cå³ä¸€è‡´æ€§æ˜¯äº‹åŠ¡çš„æ ¹æœ¬è¿½æ±‚,è€Œå¯¹æ•°æ®ä¸€è‡´æ€§çš„ç ´åä¸»è¦æ¥è‡ªä¸¤ä¸ªæ–¹é¢1.äº‹åŠ¡çš„å¹¶å‘æ‰§è¡Œ2.äº‹åŠ¡æ•…éšœæˆ–ç³»ç»Ÿæ•…éšœ 2. äº‹åŠ¡å®ç°åŸç† å¹¶å‘æ§åˆ¶æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„éš”ç¦»æ€§,ä½¿æ•°æ®åº“çš„ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› ä¸ºå¹¶å‘æ‰§è¡Œçš„æ“ä½œè¢«ç ´åã€‚ æ—¥å¿—æ¢å¤æŠ€æœ¯ä¿è¯äº†äº‹åŠ¡çš„åŸå­æ€§,ä½¿ä¸€è‡´æ€§çŠ¶æ€ä¸ä¼šå› äº‹åŠ¡æˆ–ç³»ç»Ÿæ•…éšœè¢«ç ´åã€‚åŒæ—¶ä½¿å·²æäº¤çš„å¯¹æ•°æ®åº“çš„ä¿®æ”¹ä¸ä¼šå› ç³»ç»Ÿå´©æºƒè€Œä¸¢å¤±,ä¿è¯äº†äº‹åŠ¡çš„æŒä¹…æ€§ã€‚ 2.1 å›æ»šæ—¥å¿—ï¼ˆundoï¼‰undo logå±äº ã€Œ é€»è¾‘æ—¥å¿— ã€ï¼Œå®ƒè®°å½•çš„æ˜¯sqlæ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚å½“å‘ç”Ÿå›æ»šæ—¶ï¼ŒInnoDBä¼šæ ¹æ®undo logçš„å†…å®¹åšä¸ä¹‹å‰ç›¸åçš„å·¥ä½œï¼šå¯¹äºæ¯ä¸ªinsertï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œdeleteï¼›å¯¹äºæ¯ä¸ªdeleteï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œinsertï¼›å¯¹äºæ¯ä¸ªupdateï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œä¸€ä¸ªç›¸åçš„updateï¼ŒæŠŠæ•°æ®æ”¹å›å»ã€‚ undo logç”¨äºå­˜æ”¾æ•°æ®è¢«ä¿®æ”¹å‰çš„å€¼ï¼Œå¦‚æœä¿®æ”¹å‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨undoæ—¥å¿—æ¥å®ç°å›æ»šæ“ä½œï¼Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚å¦å¤–InnoDB MVCCäº‹åŠ¡ç‰¹æ€§ä¹Ÿæ˜¯åŸºäºundoæ—¥å¿—å®ç°çš„ã€‚ å› æ­¤ï¼Œundo logæœ‰ä¸¤ä¸ªä½œç”¨ï¼šæä¾›å›æ»šå’Œå¤šä¸ªè¡Œç‰ˆæœ¬æ§åˆ¶(MVCC)ã€‚ 2.2 é‡åšæ—¥å¿—ï¼ˆredoï¼‰redo logé‡åšæ—¥å¿—è®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ï¼Œå±äºç‰©ç†æ—¥å¿—ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†redo logæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯redo logå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®redo logçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ redo logåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€æ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²(redo log buffer)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æ˜“å¤±æ€§çš„ï¼›äºŒæ˜¯ç£ç›˜ä¸Šçš„é‡åšæ—¥å¿—æ–‡ä»¶(redo log file)ï¼Œè¯¥éƒ¨åˆ†æ—¥å¿—æ˜¯æŒä¹…çš„ã€‚ MySQLä¸­redo logåˆ·æ–°è§„åˆ™é‡‡ç”¨ä¸€ç§ç§°ä¸ºCheckpointçš„æœºåˆ¶ï¼ˆåˆ©ç”¨LSNå®ç°ï¼‰ï¼Œä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼Œåˆå¼•å…¥double writeæœºåˆ¶ã€‚ äº‹åŠ¡åŸºæœ¬æ“ä½œå¼€å¯äº‹åŠ¡ï¼šstart transactionå›æ»šäº‹åŠ¡ï¼šrollbackæäº¤äº‹åŠ¡ï¼šcommit æ•°æ®åº“éš”ç¦»çº§åˆ«SQLæ ‡å‡†å®šä¹‰äº†4ç±»éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å…·ä½“è§„åˆ™ï¼Œç”¨æ¥é™å®šäº‹åŠ¡å†…å¤–çš„å“ªäº›æ”¹å˜æ˜¯å¯è§çš„ï¼Œå“ªäº›æ˜¯ä¸å¯è§çš„ã€‚ä½çº§åˆ«çš„éš”ç¦»çº§ä¸€èˆ¬æ”¯æŒæ›´é«˜çš„å¹¶å‘å¤„ç†ï¼Œå¹¶æ‹¥æœ‰æ›´ä½çš„ç³»ç»Ÿå¼€é”€ã€‚å¦å¤–ï¼Œè¿™ç¯‡åˆ†å¸ƒå¼äº‹åŠ¡ä¸ç†è§£ï¼Ÿä¸€æ¬¡ç»™ä½ è®²æ¸…æ¥šï¼æ¨èå¤§å®¶é˜…è¯»ã€‚ Read Uncommittedï¼ˆè¯»å–æœªæäº¤å†…å®¹ï¼‰åœ¨è¯¥éš”ç¦»çº§åˆ«ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½å¯ä»¥çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœã€‚æœ¬éš”ç¦»çº§åˆ«å¾ˆå°‘ç”¨äºå®é™…åº”ç”¨ï¼Œå› ä¸ºå®ƒçš„æ€§èƒ½ä¹Ÿä¸æ¯”å…¶ä»–çº§åˆ«å¥½å¤šå°‘ã€‚è¯»å–æœªæäº¤çš„æ•°æ®ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºè„è¯»ï¼ˆDirty Readï¼‰ã€‚ Read Committedï¼ˆè¯»å–æäº¤å†…å®¹ï¼‰è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼ˆä½†ä¸æ˜¯MySQLé»˜è®¤çš„ï¼‰ã€‚å®ƒæ»¡è¶³äº†éš”ç¦»çš„ç®€å•å®šä¹‰ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½çœ‹è§å·²ç»æäº¤äº‹åŠ¡æ‰€åšçš„æ”¹å˜ã€‚è¿™ç§éš”ç¦»çº§åˆ« ä¹Ÿæ”¯æŒæ‰€è°“çš„ä¸å¯é‡å¤è¯»ï¼ˆNonrepeatable Readï¼‰ï¼Œå› ä¸ºåŒä¸€äº‹åŠ¡çš„å…¶ä»–å®ä¾‹åœ¨è¯¥å®ä¾‹å¤„ç†å…¶é—´å¯èƒ½ä¼šæœ‰æ–°çš„commitï¼Œæ‰€ä»¥åŒä¸€selectå¯èƒ½è¿”å›ä¸åŒç»“æœã€‚ Repeatable Readï¼ˆå¯é‡è¯»ï¼‰è¿™æ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œå®ƒç¡®ä¿åŒä¸€äº‹åŠ¡çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶å‘è¯»å–æ•°æ®æ—¶ï¼Œä¼šçœ‹åˆ°åŒæ ·çš„æ•°æ®è¡Œã€‚ä¸è¿‡ç†è®ºä¸Šï¼Œè¿™ä¼šå¯¼è‡´å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼šå¹»è¯» ï¼ˆPhantom Readï¼‰ã€‚ç®€å•çš„è¯´ï¼Œå¹»è¯»æŒ‡å½“ç”¨æˆ·è¯»å–æŸä¸€èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°è¡Œï¼Œå½“ç”¨æˆ·å†è¯»å–è¯¥èŒƒå›´çš„æ•°æ®è¡Œæ—¶ï¼Œä¼šå‘ç°æœ‰æ–°çš„â€œå¹»å½±â€ è¡Œã€‚InnoDBå’ŒFalconå­˜å‚¨å¼•æ“é€šè¿‡å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼ŒMultiversion Concurrency Controlï¼‰æœºåˆ¶è§£å†³äº†è¯¥é—®é¢˜ã€‚ Serializableï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®ƒé€šè¿‡å¼ºåˆ¶äº‹åŠ¡æ’åºï¼Œä½¿ä¹‹ä¸å¯èƒ½ç›¸äº’å†²çªï¼Œä»è€Œè§£å†³å¹»è¯»é—®é¢˜ã€‚ç®€è¨€ä¹‹ï¼Œå®ƒæ˜¯åœ¨æ¯ä¸ªè¯»çš„æ•°æ®è¡Œä¸ŠåŠ ä¸Šå…±äº«é”ã€‚åœ¨è¿™ä¸ªçº§åˆ«ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ«äº§ç”Ÿçš„é—®é¢˜ è„è¯»(Drity Read)æŸä¸ªäº‹åŠ¡å·²æ›´æ–°ä¸€ä»½æ•°æ®ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡åœ¨æ­¤æ—¶è¯»å–äº†åŒä¸€ä»½æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ï¼Œå‰ä¸€ä¸ªRollBackäº†æ“ä½œï¼Œåˆ™åä¸€ä¸ªäº‹åŠ¡æ‰€è¯»å–çš„æ•°æ®å°±ä¼šæ˜¯ä¸æ­£ç¡®çš„ã€‚ 12345äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100åŒæ—¶äº‹åŠ¡Bæ›´æ–°update price=120ï¼Œä½†æ˜¯æ­¤æ—¶çš„äº‹åŠ¡Bè¿˜æœªcommitäº‹åŠ¡Aè¯»å–çš„price=120äº‹åŠ¡B-&gt;rollbackæ“ä½œäº‹åŠ¡Aè¯»å–åˆ°çš„æ˜¯è„æ•°æ® ä¸å¯é‡å¤è¯»(Non-repeatable read)åœ¨ä¸€ä¸ªäº‹åŠ¡çš„ä¸¤æ¬¡æŸ¥è¯¢ä¹‹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å¯èƒ½æ˜¯ä¸¤æ¬¡æŸ¥è¯¢è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªäº‹åŠ¡æ›´æ–°çš„åŸæœ‰çš„æ•°æ®ã€‚ 1234äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100åŒæ—¶äº‹åŠ¡Bæ›´æ–°update price=120ï¼Œå¹¶commitäº‹åŠ¡Aè¯»å–çš„price=120äº‹åŠ¡Aå¤šæ¬¡è¯»å–çš„ç»“æœä¸ä¸€è‡´ å¹»è¯»(Phantom Read)å¹»è¯»å’Œä¸å¯é‡å¤è¯»çš„åŒºåˆ«åœ¨äºï¼Œå¹»è¯»ä¸»è¦è¡¨ç°åœ¨æ•°æ®çš„åˆ é™¤å’Œæ’å…¥ï¼Œè€Œä¸å¯é‡å¤è¯»è¡¨ç°åœ¨æ•°æ®çš„æ›´æ–°ã€‚ 1234äº‹åŠ¡Aç¬¬ä¸€æ¬¡è¯»å–åˆ°price=100åŒæ—¶äº‹åŠ¡Bæ›´æ–°delete price=100 è¿™æ¡è®°å½•ï¼Œå¹¶commitäº‹åŠ¡Aè¯»å–çš„price=100priceè¿™æ¡è®°å½•å·²ç»ä¸å­˜åœ¨ï¼Œä½†æ˜¯äº‹åŠ¡Aè¿˜æ˜¯å¯ä»¥è¯»å–åˆ° 1ã€åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šæŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ï¼Œå¹»è¯»åªåœ¨å½“å‰è¯»ä¸‹æ‰ä¼šå‡ºç°ã€‚2ã€å¹»è¯»ä¸“æŒ‡æ–°æ’å…¥çš„è¡Œï¼Œè¯»åˆ°åŸæœ¬å­˜åœ¨è¡Œçš„æ›´æ–°ç»“æœä¸ç®—ã€‚å› ä¸ºå½“å‰è¯»çš„ä½œç”¨å°±æ˜¯èƒ½è¯»åˆ°æ‰€æœ‰å·²ç»æäº¤è®°å½•çš„æœ€æ–°å€¼ã€‚ å‚è€ƒèµ„æ–™è¯¦ç»†åˆ†æMySQLäº‹åŠ¡æ—¥å¿—(redo logå’Œundo log)æ•°æ®åº“äº‹åŠ¡çš„æ¦‚å¿µåŠå…¶å®ç°åŸç†æ•°æ®åº“äº‹åŠ¡å®ç°åŸç†mysqlæ•°æ®åº“çš„éš”ç¦»çº§åˆ«MYSQLæ•°æ®åº“çš„å››ç§éš”ç¦»çº§åˆ«MySQLå¹»è¯»MySQL äº‹åŠ¡&amp;&amp;é”æœºåˆ¶&amp;&amp;MVCC","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"Mysql-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶","date":"2021-07-28T10:12:28.000Z","path":"wiki/Mysql-MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶/","text":"MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶MVCCï¼Œå…¨ç§°Multi-Version Concurrency Controlï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCCæ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚ MVCCåœ¨MySQL InnoDBä¸­çš„å®ç°ä¸»è¦æ˜¯ä¸ºäº† ã€Œ æé«˜æ•°æ®åº“å¹¶å‘æ€§èƒ½ï¼Œç”¨æ›´å¥½çš„æ–¹å¼å»å¤„ç†è¯»-å†™å†²çªï¼Œåšåˆ°å³ä½¿æœ‰è¯»å†™å†²çªæ—¶ï¼Œä¹Ÿèƒ½åšåˆ°ä¸åŠ é”ï¼Œéé˜»å¡å¹¶å‘è¯» ã€ å½“å‰è¯»å’Œå¿«ç…§è¯» å½“å‰è¯» åƒselect lock in share mode(å…±äº«é”), select for update ; update, insert ,delete(æ’ä»–é”)è¿™äº›æ“ä½œéƒ½æ˜¯ä¸€ç§å½“å‰è¯»ï¼Œä¸ºä»€ä¹ˆå«å½“å‰è¯»ï¼Ÿå°±æ˜¯å®ƒè¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚ å¿«ç…§è¯» åƒä¸åŠ é”çš„selectæ“ä½œå°±æ˜¯å¿«ç…§è¯»ï¼Œå³ä¸åŠ é”çš„éé˜»å¡è¯»ï¼›å¿«ç…§è¯»çš„å‰ææ˜¯éš”ç¦»çº§åˆ«ä¸æ˜¯ä¸²è¡Œçº§åˆ«ï¼Œä¸²è¡Œçº§åˆ«ä¸‹çš„å¿«ç…§è¯»ä¼šé€€åŒ–æˆå½“å‰è¯»ï¼›ä¹‹æ‰€ä»¥å‡ºç°å¿«ç…§è¯»çš„æƒ…å†µï¼Œæ˜¯åŸºäºæé«˜å¹¶å‘æ€§èƒ½çš„è€ƒè™‘ï¼Œå¿«ç…§è¯»çš„å®ç°æ˜¯åŸºäºå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå³MVCC,å¯ä»¥è®¤ä¸ºMVCCæ˜¯è¡Œé”çš„ä¸€ä¸ªå˜ç§ï¼Œä½†å®ƒåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œé¿å…äº†åŠ é”æ“ä½œï¼Œé™ä½äº†å¼€é”€ï¼›æ—¢ç„¶æ˜¯åŸºäºå¤šç‰ˆæœ¬ï¼Œå³å¿«ç…§è¯»å¯èƒ½è¯»åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œæœ‰å¯èƒ½æ˜¯ä¹‹å‰çš„å†å²ç‰ˆæœ¬ è¯´ç™½äº†MVCCå°±æ˜¯ä¸ºäº†å®ç°è¯»-å†™å†²çªä¸åŠ é”ï¼Œè€Œè¿™ä¸ªè¯»æŒ‡çš„å°±æ˜¯å¿«ç…§è¯», è€Œéå½“å‰è¯»ï¼Œå½“å‰è¯»å®é™…ä¸Šæ˜¯ä¸€ç§åŠ é”çš„æ“ä½œï¼Œæ˜¯æ‚²è§‚é”çš„å®ç° MVCCæ¨¡å‹åœ¨MySQLä¸­çš„å…·ä½“å®ç°åˆ™æ˜¯ç”± 3ä¸ªéšå¼å­—æ®µï¼Œundoæ—¥å¿— ï¼ŒRead View ç­‰å»å®Œæˆçš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹é¢çš„MVCCå®ç°åŸç† MVCCæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰æ˜¯ä¸€ç§ç”¨æ¥ã€Œ è§£å†³è¯»-å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶ ã€ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº‹åŠ¡åˆ†é…å•å‘å¢é•¿çš„æ—¶é—´æˆ³ï¼Œä¸ºæ¯ä¸ªä¿®æ”¹ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬ï¼Œç‰ˆæœ¬ä¸äº‹åŠ¡æ—¶é—´æˆ³å…³è”ï¼Œè¯»æ“ä½œåªè¯»è¯¥äº‹åŠ¡å¼€å§‹å‰çš„æ•°æ®åº“çš„å¿«ç…§ã€‚ æ‰€ä»¥MVCCå¯ä»¥ä¸ºæ•°æ®åº“è§£å†³ä»¥ä¸‹é—®é¢˜ åœ¨å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åšåˆ°åœ¨è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œï¼Œæé«˜äº†æ•°æ®åº“å¹¶å‘è¯»å†™çš„æ€§èƒ½ åŒæ—¶è¿˜å¯ä»¥è§£å†³è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜ MVCCçš„å®ç°åŸç†MVCCçš„ç›®çš„å°±æ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œåœ¨æ•°æ®åº“ä¸­çš„å®ç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¯»å†™å†²çªï¼Œå®ƒçš„å®ç°åŸç†ä¸»è¦æ˜¯ä¾èµ–è®°å½•ä¸­çš„ 3ä¸ªéšå¼å­—æ®µï¼Œundoæ—¥å¿— ï¼ŒRead View æ¥å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™ä¸ªä¸‰ä¸ªpointçš„æ¦‚å¿µ éšå¼å­—æ®µæ¯è¡Œè®°å½•é™¤äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå¤–ï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„DB_TRX_ID,DB_ROLL_PTR,DB_ROW_IDç­‰å­—æ®µ DB_TRX_ID 6byteï¼Œæœ€è¿‘ä¿®æ”¹(ä¿®æ”¹/æ’å…¥)äº‹åŠ¡IDï¼šè®°å½•åˆ›å»ºè¿™æ¡è®°å½•/æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡ID DB_ROLL_PTR 7byteï¼Œå›æ»šæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™æ¡è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆå­˜å‚¨äºrollback segmenté‡Œï¼‰ DB_ROW_ID 6byteï¼Œéšå«çš„è‡ªå¢IDï¼ˆéšè—ä¸»é”®ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDBä¼šè‡ªåŠ¨ä»¥DB_ROW_IDäº§ç”Ÿä¸€ä¸ªèšç°‡ç´¢å¼•å®é™…è¿˜æœ‰ä¸€ä¸ªåˆ é™¤flagéšè—å­—æ®µ, æ—¢è®°å½•è¢«æ›´æ–°æˆ–åˆ é™¤å¹¶ä¸ä»£è¡¨çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯åˆ é™¤flagå˜äº† undoæ—¥å¿—undo logä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š insert undo log ä»£è¡¨äº‹åŠ¡åœ¨insertæ–°è®°å½•æ—¶äº§ç”Ÿçš„undo log, åªåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥è¢«ç«‹å³ä¸¢å¼ƒ update undo log äº‹åŠ¡åœ¨è¿›è¡Œupdateæˆ–deleteæ—¶äº§ç”Ÿçš„undo log; ä¸ä»…åœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼›æ‰€ä»¥ä¸èƒ½éšä¾¿åˆ é™¤ï¼Œåªæœ‰åœ¨å¿«é€Ÿè¯»æˆ–äº‹åŠ¡å›æ»šä¸æ¶‰åŠè¯¥æ—¥å¿—æ—¶ï¼Œå¯¹åº”çš„æ—¥å¿—æ‰ä¼šè¢«purgeçº¿ç¨‹ç»Ÿä¸€æ¸…é™¤ Read View(è¯»è§†å›¾)ä»€ä¹ˆæ˜¯Read Viewï¼Œè¯´ç™½äº†Read Viewå°±æ˜¯äº‹åŠ¡è¿›è¡Œå¿«ç…§è¯»æ“ä½œçš„æ—¶å€™ç”Ÿäº§çš„è¯»è§†å›¾(Read View)ï¼Œåœ¨è¯¥äº‹åŠ¡æ‰§è¡Œçš„å¿«ç…§è¯»çš„é‚£ä¸€åˆ»ï¼Œä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ID(å½“æ¯ä¸ªäº‹åŠ¡å¼€å¯æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªID, è¿™ä¸ªIDæ˜¯é€’å¢çš„ï¼Œæ‰€ä»¥æœ€æ–°çš„äº‹åŠ¡ï¼ŒIDå€¼è¶Šå¤§) æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ Read Viewä¸»è¦æ˜¯ç”¨æ¥åšå¯è§æ€§åˆ¤æ–­çš„, å³å½“æˆ‘ä»¬æŸä¸ªäº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„æ—¶å€™ï¼Œå¯¹è¯¥è®°å½•åˆ›å»ºä¸€ä¸ªRead Viewè¯»è§†å›¾ï¼ŒæŠŠå®ƒæ¯”ä½œæ¡ä»¶ç”¨æ¥åˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼Œæ—¢å¯èƒ½æ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯è¯¥è¡Œè®°å½•çš„undo logé‡Œé¢çš„æŸä¸ªç‰ˆæœ¬çš„æ•°æ®ã€‚ Read Viewéµå¾ªä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œä¸»è¦æ˜¯å°†è¦è¢«ä¿®æ”¹çš„æ•°æ®çš„æœ€æ–°è®°å½•ä¸­çš„DB_TRX_IDï¼ˆå³å½“å‰äº‹åŠ¡IDï¼‰å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰å…¶ä»–æ´»è·ƒäº‹åŠ¡çš„IDå»å¯¹æ¯”ï¼ˆç”±Read Viewç»´æŠ¤ï¼‰ï¼Œå¦‚æœDB_TRX_IDè·ŸRead Viewçš„å±æ€§åšäº†æŸäº›æ¯”è¾ƒï¼Œä¸ç¬¦åˆå¯è§æ€§ï¼Œé‚£å°±é€šè¿‡DB_ROLL_PTRå›æ»šæŒ‡é’ˆå»å–å‡ºUndo Logä¸­çš„DB_TRX_IDå†æ¯”è¾ƒï¼Œå³éå†é“¾è¡¨çš„DB_TRX_IDï¼ˆä»é“¾é¦–åˆ°é“¾å°¾ï¼Œå³ä»æœ€è¿‘çš„ä¸€æ¬¡ä¿®æ”¹æŸ¥èµ·ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„DB_TRX_ID, é‚£ä¹ˆè¿™ä¸ªDB_TRX_IDæ‰€åœ¨çš„æ—§è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°è€ç‰ˆæœ¬; å‚è€ƒèµ„æ–™1ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶2ã€MVCCæµ…æ3ã€ä¹è§‚é”ã€æ‚²è§‚é”å’ŒMVCCï¼Œä»Šå¤©è®©ä½ ä¸€æ¬¡ææ‡‚4ã€é¢è¯•å®˜ï¼šè°ˆè°ˆä½ å¯¹Mysqlçš„MVCCçš„ç†è§£ï¼Ÿ5ã€Mysqlä¸­MVCCçš„ä½¿ç”¨åŠåŸç†è¯¦è§£","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"Javaå¯¹è±¡å¤´","date":"2021-07-28T09:59:59.000Z","path":"wiki/Javaå¯¹è±¡å¤´/","text":"Javaå¯¹è±¡å¤´JOLæŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯åœ¨é¡¹ç›®ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt; &lt;artifactId&gt;jol-core&lt;/artifactId&gt; &lt;version&gt;0.9&lt;/version&gt;&lt;/dependency&gt; å†™ä¸€ä¸ªmainæ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªObjectï¼Œç„¶åæ‰“å°å¯¹è±¡ä¿¡æ¯ï¼š 1234 public static void main(String[] args) &#123; Object object = new Object(); System.out.println(ClassLayout.parseInstance(object).toPrintable());&#125; æ‰“å°ç»“æœå¦‚ä¸‹ï¼š 12345678java.lang.Object object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 4 (object header) 01 00 00 00 (00000001 00000000 00000000 00000000) (1) 4 4 (object header) 00 00 00 00 (00000000 00000000 00000000 00000000) (0) 8 4 (object header) e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243) 12 4 (loss due to the next object alignment)Instance size: 16 bytesSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total ç”±æ­¤å¯çŸ¥ï¼Œnew Object()åœ¨å†…å­˜ä¸­å 16ä¸ªå­—èŠ‚ï¼Œç»„æˆéƒ¨åˆ†8å­—èŠ‚çš„markword+4å­—èŠ‚çš„class point+4å­—èŠ‚çš„å¯¹é½ï¼› Javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ markword å­˜å‚¨syncé”æ ‡å¿—ï¼Œåˆ†ä»£å¹´é¾„ç­‰ä¸€äº›å…³é”®ä¿¡æ¯ 8å­—èŠ‚ class pointer æŒ‡å‘å½“å‰å¯¹è±¡æ‰€å±ç±»ç±»å‹ 4å­—èŠ‚ æŸ¥çœ‹javaå‘½ä»¤é»˜è®¤å¸¦çš„å‚æ•°å‘½ä»¤ï¼š java -XX:+PrintCommandLineFlags -version -XX:InitialHeapSize=134217728-XX:MaxHeapSize=2147483648-XX:+PrintCommandLineFlags-XX:+UseCompressedClassPointers å‹ç¼©ç±»æŒ‡é’ˆ 4å­—èŠ‚-XX:+UseCompressedOops æ™®é€šå¯¹è±¡æŒ‡é’ˆå‹ç¼© 4å­—èŠ‚-XX:+UseParallelGC instance data å¯¸å°ºå½“å‰å¯¹è±¡çš„å®ä¾‹æ•°æ® padding å¯¹é½å¡«å……ï¼Œå½“å¯¹è±¡æ‰€å å­—èŠ‚æ•°ä¸èƒ½è¢«8æ•´é™¤ä¹‹åï¼Œè¿›è¡Œå¡«å……å¯¹é½ã€‚ ç›®å‰çš„æ“ä½œç³»ç»ŸåŸºæœ¬ä¸Šéƒ½æ˜¯64ä½çš„ï¼› é¡ºä¸°é¢è¯•é¢˜ï¼Œnew Object()åœ¨å†…å­˜ä¸­å å¤šå°‘ä¸ªå­—èŠ‚1ã€å¦‚æœåˆ›å»ºçš„æ˜¯ç©ºå¯¹è±¡ï¼Œæ²¡æœ‰å®ä¾‹æ•°æ® é»˜è®¤å¼€å¯äº†class pointeræŒ‡é’ˆå‹ç¼© 8å­—èŠ‚markword + 4å­—èŠ‚class pointer + 4å­—èŠ‚ padding å¦‚æœå…³é—­äº†ç±»æŒ‡é’ˆå‹ç¼© 8å­—èŠ‚markword + 8å­—èŠ‚class pointer 2ã€å¦‚æœåˆ›å»ºçš„å¯¹è±¡æœ‰å®åŠ›æ•°æ®ï¼Œå¦‚ä¸‹å¯¹è±¡ï¼š 1Personï¼ˆint age , String nameï¼‰ é»˜è®¤å¼€å¯äº†class pointeræŒ‡é’ˆå‹ç¼© 8å­—èŠ‚markword + 4å­—èŠ‚class pointer + 4å­—èŠ‚int + 4å­—èŠ‚String + 4å­—èŠ‚paddingå¯¹é½","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-CASåŸç†å’Œåº•å±‚å®ç°","date":"2021-07-28T09:59:17.000Z","path":"wiki/Java-CASåŸç†å’Œåº•å±‚å®ç°/","text":"CASåŸç†å’Œåº•å±‚å®ç° ä»€ä¹ˆæ˜¯CASCASæ˜¯ï¼ˆcompare and swapï¼‰ çš„ç¼©å†™ï¼Œå®ƒèƒ½åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œä¿è¯å¤šçº¿ç¨‹ä¸€è‡´æ€§çš„æ”¹åŠ¨æŸä¸€å€¼ï¼› ABAé—®é¢˜ABAé—®é¢˜æ˜¯ä¸€ä¸ªçº¿ç¨‹åœ¨CASæ¯”è¾ƒå€¼å’ŒåŸæ¥æ˜¯å¦ç›¸ç­‰çš„è¿‡ç¨‹ä¸­ï¼Œåˆ«çš„çº¿ç¨‹ä¿®æ”¹è¿‡è¿™ä¸ªå€¼ï¼Œä½†æ˜¯åˆæ”¹å›å»äº†ï¼Œå€’ç½®å½“å‰çº¿ç¨‹æ¯”è¾ƒçš„æ—¶å€™ï¼Œå‘ç°æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯ï¼Œä¸­é—´æ˜¯è¢«ä¿®æ”¹è¿‡çš„ï¼› æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯”è¾ƒå€¼çš„æ—¶å€™åŒæ—¶æ¯”è¾ƒç‰ˆæœ¬å· CASåº•å±‚åŸç†AtomicInteger:123456789101112public final int incrementAndGet() &#123; for (;;) &#123; int current = get(); int next = current + 1; if (compareAndSet(current, next)) return next; &#125; &#125;public final boolean compareAndSet(int expect, int update) &#123; return unsafe.compareAndSwapInt(this, valueOffset, expect, update); &#125; Unsafe:1public final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5); è¿ç”¨ï¼š 12345678910111213141516171819202122232425262728package com.mashibing.jol;import sun.misc.Unsafe;import java.lang.reflect.Field;public class T02_TestUnsafe &#123; int i = 0; private static T02_TestUnsafe t = new T02_TestUnsafe(); public static void main(String[] args) throws Exception &#123; //Unsafe unsafe = Unsafe.getUnsafe(); Field unsafeField = Unsafe.class.getDeclaredFields()[0]; unsafeField.setAccessible(true); Unsafe unsafe = (Unsafe) unsafeField.get(null); Field f = T02_TestUnsafe.class.getDeclaredField(&quot;i&quot;); long offset = unsafe.objectFieldOffset(f); System.out.println(offset); boolean success = unsafe.compareAndSwapInt(t, offset, 0, 1); System.out.println(success); System.out.println(t.i); //unsafe.compareAndSwapInt() &#125;&#125; jdk8u: unsafe.cpp: cmpxchg = compare and exchange 123456UNSAFE_ENTRY(jboolean, Unsafe_CompareAndSwapInt(JNIEnv *env, jobject unsafe, jobject obj, jlong offset, jint e, jint x)) UnsafeWrapper(&quot;Unsafe_CompareAndSwapInt&quot;); oop p = JNIHandles::resolve(obj); jint* addr = (jint *) index_oop_from_field_offset_long(p, offset); return (jint)(Atomic::cmpxchg(x, addr, e)) == e;UNSAFE_END jdk8u: atomic_linux_x86.inline.hpp 93è¡Œis_MP = Multi Processor 12345678inline jint Atomic::cmpxchg (jint exchange_value, volatile jint* dest, jint compare_value) &#123; int mp = os::is_MP(); __asm__ volatile (LOCK_IF_MP(%4) &quot;cmpxchgl %1,(%3)&quot; : &quot;=a&quot; (exchange_value) : &quot;r&quot; (exchange_value), &quot;a&quot; (compare_value), &quot;r&quot; (dest), &quot;r&quot; (mp) : &quot;cc&quot;, &quot;memory&quot;); return exchange_value;&#125; jdk8u: os.hpp is_MP() 12345678910static inline bool is_MP() &#123; // During bootstrap if _processor_count is not yet initialized // we claim to be MP as that is safest. If any platform has a // stub generator that might be triggered in this phase and for // which being declared MP when in fact not, is a problem - then // the bootstrap routine for the stub generator needs to check // the processor count directly and leave the bootstrap routine // in place until called after initialization has ocurred. return (_processor_count != 1) || AssumeMP;&#125; jdk8u: atomic_linux_x86.inline.hpp 1#define LOCK_IF_MP(mp) &quot;cmp $0, &quot; #mp &quot;; je 1f; lock; 1: &quot; æœ€ç»ˆå®ç°ï¼šåº•å±‚å¯¹åº”ä¸€ä¸ªæ±‡ç¼–æŒ‡ä»¤ã€Œlock comxchgã€ï¼Œä½†æ˜¯comxchgè¿™æ¡æŒ‡ä»¤ä¸æ˜¯åŸå­æ€§çš„ï¼Œä»–ä¸èƒ½ä¿è¯åœ¨æ¯”è¾ƒçš„æ—¶å€™ï¼Œåˆ«çš„çº¿ç¨‹ä¼šä¸ä¼šæ”¹å˜å€¼ï¼›è€Œä¿è¯çº¿ç¨‹å®‰å…¨çš„åˆ™æ˜¯lockè¿™æ¡æŒ‡ä»¤ï¼Œlockè¿™æ¡æŒ‡ä»¤åœ¨æ‰§è¡Œåé¢æ‰§è¡Œçš„æ—¶å€™é”å®šä¸€ä¸ªã€ŒåŒ—æ¡¥ä¿¡å·ã€ï¼Œè€Œä¸æ˜¯é‡‡ç”¨çºµçº¿é”çš„æ–¹å¼ï¼› CASåœ¨JDKä¸­çš„å®ç°1ã€AtomitInteger2ã€ConcurrentHashMap","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-FutureTaskåŸç†","date":"2021-07-28T09:58:47.000Z","path":"wiki/Java-FutureTaskåŸç†/","text":"FutureTaskFutureæ–¹æ³•ä»‹ç»123456789101112131415161718public interface Future&lt;V&gt; &#123; // å–æ¶ˆä»»åŠ¡ å¯ä¸­æ–­çš„æ–¹å¼å–æ¶ˆ boolean cancel(boolean mayInterruptIfRunning); // åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å¤„äºå–æ¶ˆçŠ¶æ€ boolean isCancelled(); // åˆ¤æ–­å¼‚æ­¥ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ ==è¿™é‡Œä½¿ç”¨è½®è®­çš„æ–¹å¼ç›‘å¬== boolean isDone(); // è·å–å¼‚æ­¥çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™ä¸€ç›´é˜»å¡åˆ°æœ‰ç»“æœè¿”å›ï¼› V get() throws InterruptedException, ExecutionException; // è·å–å¼‚æ­¥çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œå¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™ä¸€ç›´é˜»å¡åˆ°è®¾ç½®çš„æ—¶é—´ï¼Œæœ‰ç»“æœè¿”å›ï¼Œæ²¡æœ‰ç»“æœåˆ™æŠ›å‡ºå¼‚å¸¸ï¼› V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; ç®€å•ç¤ºèŒƒCallable&amp;Futureï¼ˆ1ï¼‰å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡çš„submitæ–¹æ³•ä¸æ˜¯é˜»å¡æ–¹æ³•ï¼Œè€ŒFuture.getæ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•ï¼ˆ2ï¼‰submitæäº¤å¤šä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰èƒ½ä½¿ç”¨getæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºå¾—åˆ°è¿”å›ç»“æœï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦ä½¿ç”¨future.isDoneå…ˆåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œå®Œæˆåå†ä½¿ç”¨future.getå¾—åˆ°ç»“æœã€‚ï¼ˆä¹Ÿå¯ä»¥ç”¨get (long timeout, TimeUnit unit)æ–¹æ³•å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢æ— é™æ—¶é—´çš„ç­‰å¾…ï¼‰ 1234567891011121314151617181920212223242526272829303132333435public class FutureTest implements Callable&lt;Integer&gt; &#123; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ @Override public Integer call() throws Exception &#123; System.err.println(&quot;start call method...&quot;); Thread.sleep(3000); return 1111; &#125; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; System.err.println(&quot;main method start....&quot;); FutureTest futureTest = new FutureTest(); Future1Test future1Test = new Future1Test(); long time = System.currentTimeMillis(); ExecutorService executorService = Executors.newFixedThreadPool(2); Future&lt;String&gt; future = executorService.submit(future1Test); if (!future.isDone()) &#123; System.err.println(&quot;future not done !&quot;); &#125; Future&lt;Integer&gt; future1 = executorService.submit(futureTest); // submitæäº¤å¤šä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œæ‰èƒ½ä½¿ç”¨getæŒ‰ç…§ä»»åŠ¡çš„æäº¤é¡ºåºå¾—åˆ°è¿”å›ç»“æœ // è¿™é‡Œå…ˆæäº¤äº†future1Testï¼Œä¼‘çœ äº†4s, futureTestä¼‘çœ äº†3sï¼Œä½†æ˜¯ç­‰æˆ‘ä»¬getåˆ°ç»“æœçš„æ—¶å€™ï¼Œæ˜¯æ¶ˆè€—çš„4sæ—¶é—´çš„ï¼› System.err.println(&quot;cost time: &quot; + (System.currentTimeMillis() - time)); System.err.println(&quot;future: &quot; + future.get()); System.err.println(&quot;future1: &quot; + future1.get()); System.err.println(&quot;main method end....&quot;); executorService.shutdown(); &#125;&#125; æ‰§è¡Œç»“æœ12345678main method start....future not done !// è¯´æ˜äº†ç¬¬ä¸€ get()æ–¹æ³•æ˜¯é˜»å¡ï¼Œç¬¬äºŒçº¿ç¨‹æ± ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼ŒæŒ‰æäº¤ä»»åŠ¡é¡ºåºgetç»“æœè¿”å›å€¼cost time: 4start call method...future: future 2 testfuture1: 1111main method end.... æ³¨æ„ç‚¹ çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼executeå’Œsubmitï¼Œexecuteæ˜¯ä¸å¸¦è¿”å›å€¼çš„ï¼Œsubmitæ˜¯æœ‰è¿”å›å€¼çš„; mainæ–¹æ³•ä¸­å¯ä»¥ä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè°ƒç”¨startæ–¹æ³•å°±å¯ä»¥ï¼Œåˆ‡è®°åªæœ‰åœ¨æ¼”ç¤ºä»£ç çš„æ—¶å€™åã€‚æ‰‹åŠ¨ç›´æ¥åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼è¿˜æ˜¯ä¸è¦ç”¨ï¼Œå› ä¸ºä¸€æ—¦è¯·æ±‚å˜å¤šï¼Œåˆ™ä¼šåˆ›å»ºæ— æ•°çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ•°å¤§äºCPUæ ¸æ•°ï¼Œè¿›è€Œå¯¼è‡´CPUé¢‘ç¹åˆ‡æ¢ä¸Šä¸‹åˆ†è¿›è¡Œè°ƒåº¦ï¼Œæ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚ è€Œä¸”çº¿ç¨‹çš„æ•°æ®æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ï¼Œå¢åŠ åƒåœ¾å›æ”¶çš„å‹åŠ›ã€‚ä¸¥é‡çš„ä¼šå‘ç”ŸOOM; å¼‚å¸¸mainæ–¹æ³•ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Future futureæ¥æ”¶å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„æ”¾å›ç»“æœï¼Œä½†å®é™…ä¸ŠFutureå…¶å®æ˜¯ä¸€ä¸ªinterfaceï¼Œå¹¶ä¸èƒ½æ¥æ”¶è¿”å›ç»“æœçš„ï¼Œé‚£å®é™…æˆ‘ä»¬è°ƒç”¨future.get()æ˜¯ï¼Œæ˜¯å®ä¾‹äº†ä¸€ä¸ªFutureTaskå¯¹è±¡æ¥æ¥å—çš„ï¼› FutureTaskè®²è§£ä¸‹é¢ä¸»è¦é’ˆå¯¹Futureçš„å®ç°ç±»FutureTaskçš„å‡ ä¸ªé‡è¦æ–¹æ³•å±•å¼€ FutureTaskç»§æ‰¿å…³ç³»1234567891011public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; &#123;...&#125;// ä¸‹é¢æ˜¯RunnableFutureæ¥å£çš„ç»§æ‰¿å…³ç³»public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; &#123; /** * Sets this Future to the result of its computation * unless it has been cancelled. */ void run();&#125; FutureTask é‡è¦çš„æˆå‘˜å˜é‡ 12345678910111213141516171819202122/** The underlying callable; nulled out after running */private Callable&lt;V&gt; callable;/** The result to return or exception to throw from get() *///ä»»åŠ¡æ‰§è¡Œç»“æœæˆ–è€…ä»»åŠ¡å¼‚å¸¸private Object outcome; // non-volatile, protected by state reads/writes/** The thread running the callable; CASed during run() *///æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹private volatile Thread runner;/** Treiber stack of waiting threads *///ç­‰å¾…èŠ‚ç‚¹ï¼Œå…³è”ç­‰å¾…çº¿ç¨‹private volatile WaitNode waiters;private static final sun.misc.Unsafe UNSAFE;//stateå­—æ®µçš„å†…å­˜åç§»é‡ è¿™ä¸ªåœ¨çº¿ç¨‹æ± æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™è¿›è¡ŒçŠ¶æ€åˆ¤æ–­çš„æ—¶å€™ä¼šç”¨åˆ°private static final long stateOffset;//runnerå­—æ®µçš„å†…å­˜åç§»é‡private static final long runnerOffset;//waiterså­—æ®µçš„å†…å­˜åç§»é‡private static final long waitersOffset; å®šä¹‰ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ 12345678private volatile int state;private static final int NEW = 0;private static final int COMPLETING = 1;private static final int NORMAL = 2;private static final int EXCEPTIONAL = 3;private static final int CANCELLED = 4;private static final int INTERRUPTING = 5;private static final int INTERRUPTED = 6; NORMAL:æŒ‡çš„æ˜¯ä»»åŠ¡èƒ½å¤Ÿæ­£å¸¸æ‰§è¡ŒçŠ¶æ€ EXCEPTIONALï¼šè¡¨ç¤ºä»»åŠ¡æ‰§è¡Œå¼‚å¸¸ CANCELLEDï¼šå–æ¶ˆçŠ¶æ€ï¼Œä¹‹åçš„çŠ¶æ€éƒ½è¡¨ç¤ºä»»åŠ¡å–æ¶ˆæˆ–ç»ˆç«¯ ä¸‹é¢çœ‹ä¸€ä¸‹FutureTaskä¸­å‡ ä¸ªé‡è¦çš„æ–¹æ³• æ‰§è¡Œç»“æœ | reportæ–¹æ³• Returns result or throws exception for completed task.ä¸»è¦æ˜¯ä¸ŠæŠ¥å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–è¿”å›ä»»åŠ¡æ‰§è¡Œå‘ç”Ÿçš„å¼‚å¸¸ 1234567891011121314/** * Returns result or throws exception for completed task. * * @param s completed state value */ @SuppressWarnings(&quot;unchecked&quot;) private V report(int s) throws ExecutionException &#123; Object x = outcome; if (s == NORMAL) return (V)x; if (s &gt;= CANCELLED) throw new CancellationException(); throw new ExecutionException((Throwable)x); &#125; åˆ¤æ–­é€»è¾‘å°±æ˜¯æ ¹æ®å‚æ•°ï¼Œä¹Ÿæ˜¯æ˜¯ä»»åŠ¡çŠ¶æ€ï¼Œæ ¹æ®ä¸åŒçš„çŠ¶æ€å¤„ç†ç›¸åº”çš„é€»è¾‘ã€‚æ¯”å¦‚NORNALçŠ¶æ€ï¼Œè¡¨ç¤ºä»»åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œç›´æ¥è¿”å›ç»“æœå°±å¯ä»¥ã€‚å¦‚æœçŠ¶æ€å¤§äºCANCELLEDï¼Œè¯´æ˜ä»»åŠ¡è¢«å–æ¶ˆæˆ–ç»ˆç«¯ï¼Œä¼šæŠ›å‡ºCancellationException()ï¼›å¦‚æœä¸æ˜¯å¼‚å¸¸çŠ¶æ€ï¼Œåˆ™æŠ›å‡ºExecutionExceptionï¼› ä»»åŠ¡æ‰§è¡Œ | run() æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041public void run() &#123; // å¦‚æœçŠ¶æ€ state ä¸æ˜¯ NEWï¼Œæˆ–è€…è®¾ç½® runner å€¼å¤±è´¥ // è¡¨ç¤ºæœ‰åˆ«çš„çº¿ç¨‹åœ¨æ­¤ä¹‹å‰è°ƒç”¨ run æ–¹æ³•ï¼Œå¹¶æˆåŠŸè®¾ç½®äº† runner å€¼ // ä¿è¯äº†åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œ try ä»£ç å—ä¸­çš„ä»£ç ã€‚ if (state != NEW || !UNSAFE.compareAndSwapObject(this, runnerOffset, null, Thread.currentThread())) return; //ä»¥ä¸Šstateå€¼å˜æ›´çš„ç”±CASæ“ä½œä¿è¯åŸå­æ€§ try &#123; Callable&lt;V&gt; c = callable; //åªæœ‰cä¸ä¸ºnullä¸”çŠ¶æ€stateä¸ºNEWçš„æƒ…å†µ if (c != null &amp;&amp; state == NEW) &#123; V result; boolean ran; try &#123; //è°ƒç”¨callableçš„callæ–¹æ³•ï¼Œå¹¶è·å¾—è¿”å›ç»“æœ result = c.call(); //è¿è¡ŒæˆåŠŸ ran = true; &#125; catch (Throwable ex) &#123; result = null; ran = false; setException(ex); &#125; if (ran) //è®¾ç½®ç»“æœ set(result); &#125; &#125; finally &#123; // runner must be non-null until state is settled to // prevent concurrent calls to run() runner = null; // state must be re-read after nulling runner to prevent // leaked interrupts int s = state; if (s &gt;= INTERRUPTING) handlePossibleCancellationInterrupt(s); &#125; &#125; æ ¸å¿ƒé€»è¾‘å°±æ˜¯è°ƒç”¨Callableçš„callæ–¹æ³•ï¼Œ==result=c.call();== å¹¶ä¸”å¯¹ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼› è·å–ç»“æœ | get() throws InterruptedException, ExecutionException è·å–å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæˆ–å¼‚å¸¸ä¿¡æ¯ 123456public V get() throws InterruptedException, ExecutionException &#123; int s = state; if (s &lt;= COMPLETING) s = awaitDone(false, 0L); return report(s);&#125; getæ–¹æ³•æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š åˆ¤æ–­ä»»åŠ¡çš„çŠ¶æ€,å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œè°ƒç”¨awaitDoneæ–¹æ³• ä»»åŠ¡å®Œæˆï¼Œè°ƒç”¨æˆ‘ä»¬ä¸Šé¢è¯´çš„reportæ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœ ä»»åŠ¡é˜»å¡ | awaitDone(boolean timed, long nanos) ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæˆ ä¹Ÿæ˜¯getæ–¹æ³•é˜»å¡ç‰¹æ€§çš„å…³é”®æ‰€åœ¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445private int awaitDone(boolean timed, long nanos) throws InterruptedException &#123; final long deadline = timed ? System.nanoTime() + nanos : 0L; WaitNode q = null; boolean queued = false; // CPUè½®è½¬ for (;;) &#123; // å¦‚æœçº¿ç¨‹ä¸­æ–­äº†ï¼Œå°†çº¿ç¨‹ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ï¼ŒæŠ›å‡ºä¸­æ–­å¼‚å¸¸ if (Thread.interrupted()) &#123; removeWaiter(q); throw new InterruptedException(); &#125; int s = state; // å¦‚æœä»»åŠ¡çŠ¶æ€å¤§äºå®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ï¼› if (s &gt; COMPLETING) &#123; if (q != null) q.thread = null; return s; &#125; // å¦‚æœä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯è¿”å›å€¼outcomeè¿˜æ²¡æœ‰è®¾ç½®ï¼Œå¯ä»¥å…ˆè®©å‡ºçº¿ç¨‹æ‰§è¡Œæƒï¼Œè®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œ else if (s == COMPLETING) // cannot time out yet Thread.yield(); // ä¸‹é¢æ˜¯ä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆçš„çŠ¶æ€ï¼Œå°†çº¿ç¨‹æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ— else if (q == null) q = new WaitNode(); else if (!queued) queued = UNSAFE.compareAndSwapObject(this, waitersOffset, q.next = waiters, q); // åˆ¤æ–­getæ–¹æ³•æ˜¯å¦è®¾ç½®äº†è¶…æ—¶æ—¶é—´ else if (timed) &#123; nanos = deadline - System.nanoTime(); // å¦‚æœè¶…å‡ºè®¾ç½®çš„æ—¶é—´ï¼Œçº¿ç¨‹ç§»é™¤ç­‰åˆ°é˜Ÿåˆ— if (nanos &lt;= 0L) &#123; removeWaiter(q); return state; &#125; LockSupport.parkNanos(this, nanos); &#125; // æ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œçº¿ç¨‹ç›´æ¥é˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆ else LockSupport.park(this); &#125; &#125; ä¸»è¦æ‰§è¡Œæ­¥éª¤ï¼š åˆ¤æ–­çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ï¼Œå¦‚æœè¢«ä¸­æ–­äº†ï¼Œå°±ä»ç­‰å¾…çš„çº¿ç¨‹æ ˆä¸­ç§»é™¤è¯¥ç­‰å¾…èŠ‚ç‚¹ï¼Œç„¶åæŠ›å‡ºä¸­æ–­å¼‚å¸¸ è¯»å–state,åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œå¦‚æœå·²ç»å®Œæˆæˆ–è€…ä»»åŠ¡å·²ç»å–æ¶ˆï¼Œæ­¤æ—¶è°ƒç”¨getæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œä¼šç›´æ¥è·å–åˆ°ç»“æœæˆ–è€…æ‹¿åˆ°å¼‚å¸¸ä¿¡æ¯ï¼› å¦‚æœs == COMPLETINGï¼Œè¯´æ˜ä»»åŠ¡å·²ç»ç»“æŸï¼Œä½†æ˜¯ç»“æœè¿˜æ²¡æœ‰ä¿å­˜åˆ°outcomeä¸­ï¼Œ==æ­¤æ—¶çº¿ç¨‹è®©å‡ºæ‰§è¡Œæƒï¼Œç»™å…¶ä»–çº¿ç¨‹å…ˆæ‰§è¡Œï¼›== å¦‚æœä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™éœ€è¦åˆ›å»ºç­‰å¾…èŠ‚ç‚¹ï¼Œç­‰å¾…æ’å…¥åˆ°é˜»å¡é˜Ÿåˆ— åˆ¤æ–­queuedï¼Œè¿™é‡Œæ˜¯å°†cä¸­åˆ›å»ºèŠ‚ç‚¹qåŠ å…¥é˜Ÿåˆ—å¤´ã€‚ä½¿ç”¨Unsafeçš„CASæ–¹æ³•ï¼Œå¯¹waitersè¿›è¡Œèµ‹å€¼ï¼Œwaitersä¹Ÿæ˜¯ä¸€ä¸ªWaitNodeèŠ‚ç‚¹ï¼Œç›¸å½“äºé˜Ÿåˆ—å¤´ï¼Œæˆ–è€…ç†è§£ä¸ºé˜Ÿåˆ—çš„å¤´æŒ‡é’ˆã€‚é€šè¿‡WaitNodeå¯ä»¥éå†æ•´ä¸ªé˜»å¡é˜Ÿåˆ— ç„¶ååˆ¤æ–­è¶…æ—¶æ—¶é—´ï¼Œæ—¶é—´æ˜¯åœ¨è°ƒç”¨getæ–¹æ³•çš„æ—¶å€™ä¼ è¾“è¿›æ¥çš„ï¼Œå¦‚æœæœ‰è¶…æ—¶æ—¶é—´ï¼Œåˆ™è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…å‡ºæ—¶é—´ï¼Œåˆ™å°†çº¿ç¨‹ç§»é™¤ç­‰å¾…é˜Ÿåˆ—ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®æ—¶é—´ï¼Œåˆ™ç›´æ¥é˜»å¡çº¿ç¨‹ï¼› å–æ¶ˆä»»åŠ¡ | cancel(boolean mayInterruptIfRunning)123456789101112131415161718192021222324252627@Param mayInterruptIfRunning æ˜¯å¦ä¸­æ–­public boolean cancel(boolean mayInterruptIfRunning) &#123; /* * åœ¨çŠ¶æ€è¿˜ä¸ºNEWçš„æ—¶å€™ï¼Œæ ¹æ®å‚æ•°ä¸­çš„æ˜¯å¦å…è®¸ä¼ é€’ï¼Œ * å°†çŠ¶æ€æµè½¬åˆ°INTERRUPTINGæˆ–è€…CANCELLEDã€‚ */ if (!(state == NEW &amp;&amp; UNSAFE.compareAndSwapInt(this, stateOffset, NEW, mayInterruptIfRunning ? INTERRUPTING : CANCELLED))) return false; try &#123; // in case call to interrupt throws exception if (mayInterruptIfRunning) &#123; try &#123; Thread t = runner; if (t != null) t.interrupt(); &#125; finally &#123; // final state UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED); &#125; &#125; &#125; finally &#123; finishCompletion(); &#125; return true; &#125; 123456789101112131415161718192021222324252627282930313233343536private void finishCompletion() &#123; for (WaitNode q; (q = waiters) != null;) &#123; // å¿…é¡»å°†æ ˆé¡¶CASä¸ºnullï¼Œå¦åˆ™é‡è¯»æ ˆé¡¶å¹¶é‡è¯•ã€‚ if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) &#123; // éå†å¹¶å”¤é†’æ ˆä¸­èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ã€‚ for (;;) &#123; Thread t = q.thread; if (t != null) &#123; q.thread = null; LockSupport.unpark(t); &#125; WaitNode next = q.next; if (next == null) break; // å°†nextåŸŸç½®ä¸ºnullï¼Œè¿™æ ·å¯¹GCå‹å¥½ã€‚ q.next = null; q = next; &#125; break; &#125; &#125; /* * doneæ–¹æ³•æ˜¯æš´éœ²ç»™å­ç±»çš„ä¸€ä¸ªé’©å­æ–¹æ³•ã€‚ * * è¿™ä¸ªæ–¹æ³•åœ¨ExecutorCompletionService.QueueingFutureä¸­çš„overrideå®ç°æ˜¯æŠŠç»“æœåŠ åˆ°é˜»å¡é˜Ÿåˆ—é‡Œã€‚ * CompletionServiceè°ç”¨è°çŸ¥é“ï¼Œå¥¥ç§˜å…¨åœ¨è¿™ã€‚ */ done(); /* * callableç½®ä¸ºnullä¸»è¦ä¸ºäº†å‡å°‘å†…å­˜å¼€é”€, * æ›´å¤šå¯ä»¥äº†è§£JVM memory footprintç›¸å…³èµ„æ–™ã€‚ */ callable = null;&#125; Callable&amp;Futureä½¿ç”¨åœºæ™¯ å¼‚æ­¥ä»»åŠ¡éœ€è¦æ‹¿åˆ°è¿”å›å€¼ å¤šçº¿ç¨‹å¹¶å‘è°ƒç”¨ï¼Œé¡ºåºç»„è£…è¿”å›å€¼ï¼Œä¸€äº›å¹¶å‘æ¡†æ¶ä¸­ä¼šçœ‹åˆ°ç›¸åº”ä½“ç° è¿˜æœ‰ä¸€äº›åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„åœºæ™¯ï¼Œè¿œç¨‹è°ƒç”¨éœ€è¦å›å¡«æ‰§è¡Œç»“æœ è¿˜æœ‰å¾ˆå¤šé€šä¿¡æ¡†æ¶ä¸­éƒ½æœ‰ä½“ç° å‚è€ƒèµ„æ–™ (1) future.getæ–¹æ³•é˜»å¡é—®é¢˜çš„è§£å†³ï¼Œå®ç°æŒ‰ç…§ä»»åŠ¡å®Œæˆçš„å…ˆåé¡ºåºè·å–ä»»åŠ¡çš„ç»“æœ(2) Javaå¤šçº¿ç¨‹å¼•å‘çš„æ€§èƒ½é—®é¢˜ä»¥åŠè°ƒä¼˜ç­–ç•¥(3) å¯å–æ¶ˆçš„å¼‚æ­¥ä»»åŠ¡â€”â€”FutureTaskç”¨æ³•åŠè§£æ(4) FutureTaskæºç è§£è¯»","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-joinæ–¹æ³•åŸç†è§£æ","date":"2021-07-28T09:58:22.000Z","path":"wiki/Java-joinæ–¹æ³•åŸç†è§£æ/","text":"joinæ–¹æ³•12345joiné‡è½½æ–¹æ³•1 join()2 join(long millis) //å‚æ•°ä¸ºæ¯«ç§’3 join(long millis,int nanoseconds) //ç¬¬ä¸€å‚æ•°ä¸ºæ¯«ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºçº³ç§’ åŠŸèƒ½æ¼”ç¤º123456789101112131415public class JoinDemo implements Runnable&#123; public void run() &#123; System.err.println(&quot;join thread demo &quot;); &#125; public static void main(String[] args) throws Exception &#123; System.err.println(&quot;main thread start... &quot;); Runnable r = new JoinDemo(); Thread t = new Thread(r); t.setName(&quot;ibli joinTest ...&quot;); t.start();// t.join(); System.err.println(&quot;main thread end... &quot;); &#125;&#125; ä»¥ä¸Šå°†t.join();æ³¨é‡Šæ‰ï¼Œæ‰§è¡Œçš„ä¸€ç§å¯èƒ½ç»“æœå¦‚ä¸‹ï¼š 12345678main thread start... main thread end... join thread demoè¿˜æœ‰å¯èƒ½æ˜¯è¿™ç§ç»“æœï¼šmain thread start... join thread demomain thread end... ä½†æ˜¯æŠŠæ³¨é‡Šå»æ‰ï¼Œç»“æœå¦‚ä¸‹ï¼š 123main thread start... join thread demo main thread end... è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„demo,æ•ˆæœæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å½“mainçº¿ç¨‹å»è°ƒç”¨t.join()æ˜¯ï¼Œä¼šå°†è‡ªå·±å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰åˆ°tçº¿ç¨‹æ‰§è¡Œå®Œæˆåˆ°è¾¾å®Œç»“çŠ¶æ€ï¼Œmainçº¿ç¨‹æ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚ æˆ‘ä»¬çœ‹ä¸€ä¸‹join()è®¾ç½®è¶…æ—¶æ—¶é—´çš„æ–¹æ³•ï¼š 123456789101112131415161718192021222324public class JoinDemo implements Runnable&#123; public void run() &#123; System.err.println(&quot;join thread demo &quot;); try &#123; // çº¿ç¨‹ç¡çœ 4s Thread.sleep(4000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; List&lt;String&gt; strings = null; System.err.println(strings.get(0)); &#125; public static void main(String[] args) throws Exception &#123; System.err.println(&quot;main thread start... &quot;); Runnable r = new JoinDemo(); Thread t = new Thread(r); t.setName(&quot;ibli joinTest ...&quot;); t.start(); // ä½†æ˜¯ä¸»çº¿ç¨‹joinçš„è¶…æ—¶æ—¶é—´æ˜¯1s t.join(1000); System.err.println(&quot;main thread end... &quot;); &#125;&#125; æ‰§è¡Œæ•ˆæœï¼š 123456main thread start... join thread demo main thread end... Exception in thread &quot;ibli joinTest ...&quot; java.lang.NullPointerException at com.ibli.threadTest.api.JoinDemo.run(JoinDemo.java:14) at java.lang.Thread.run(Thread.java:748) ä¸Šé¢çš„æ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå­çº¿ç¨‹è®¾ç½®äº†4sçš„è¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹åœ¨1ç§’è¶…æ—¶åï¼Œå¹¶æ²¡æœ‰ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå°±è¢«å”¤é†’æ‰§è¡Œåç»­æ“ä½œäº†ï¼›è¿™æ ·çš„é¢„æœŸæ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸå‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æŒ‰ç…§joinçš„æºç å»åˆ†æå§ï¼ joinæ–¹æ³•åŸç†ä¸‹é¢æ˜¯joinçš„åŸç†å›¾ join()æºç  é¦–å…ˆä¼šè°ƒç”¨join(0)æ–¹æ³•ï¼Œå…¶å®æ˜¯joinçš„é‡è½½æ–¹æ³•ï¼› 123public final void join() throws InterruptedException &#123; join(0);&#125; ä¸‹é¢æ˜¯joinçš„æ ¸å¿ƒå®ç°ï¼š 1234567891011121314151617181920212223242526public final synchronized void join(long millis) throws InterruptedException &#123; long base = System.currentTimeMillis(); long now = 0; // é¦–å…ˆæ ¡éªŒå‚æ•°æ˜¯å¦åˆæ³• if (millis &lt; 0) &#123; throw new IllegalArgumentException(&quot;timeout value is negative&quot;); &#125; // å¦‚æœjoinæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œåˆ™ç›¸å½“äºç›´æ¥è°ƒç”¨waitæ–¹æ³• if (millis == 0) &#123; while (isAlive()) &#123; wait(0); &#125; &#125; else &#123; while (isAlive()) &#123; long delay = millis - now; if (delay &lt;= 0) &#123; break; &#125; wait(delay); now = System.currentTimeMillis() - base; &#125; &#125; &#125; ä¸‹é¢æ˜¯isAliveæ–¹æ³•çš„æºç  1public final native boolean isAlive(); è¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œä½œç”¨æ˜¯åˆ¤æ–­å½“å‰çš„çº¿ç¨‹æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ä»€ä¹ˆæ˜¯æ´»åŠ¨çŠ¶æ€å‘¢ï¼Ÿæ´»åŠ¨çŠ¶æ€å°±æ˜¯çº¿ç¨‹å·²ç»å¯åŠ¨ä¸”å°šæœªç»ˆæ­¢ã€‚çº¿ç¨‹å¤„äºæ­£åœ¨è¿è¡Œæˆ–å‡†å¤‡å¼€å§‹è¿è¡Œçš„çŠ¶æ€ï¼Œå°±è®¤ä¸ºçº¿ç¨‹æ˜¯â€œå­˜æ´»â€çš„ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹è¦æ³¨æ„ï¼Œjoinä¸ºä»€ä¹ˆé˜»å¡çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œè€Œä¸æ˜¯å­çº¿ç¨‹å‘¢ï¼Ÿ ä¸ç†è§£çš„åŸå› æ˜¯é˜»å¡ä¸»çº¿ç¨‹çš„æ–¹æ³•æ˜¯æ”¾åœ¨previousThreadè¿™ä¸ªå®ä¾‹ä½œç”¨ï¼Œè®©å¤§å®¶è¯¯ä»¥ä¸ºåº”è¯¥é˜»å¡previousThreadçº¿ç¨‹ã€‚å®é™…ä¸Šä¸»çº¿ç¨‹ä¼šæŒæœ‰previousThreadè¿™ä¸ªå¯¹è±¡çš„é”ï¼Œç„¶åè°ƒç”¨waitæ–¹æ³•å»é˜»å¡ï¼Œè€Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­çš„ã€‚æ‰€ä»¥é€ æˆä¸»çº¿ç¨‹é˜»å¡ã€‚ å…¶å®join()æ–¹æ³•çš„æ ¸å¿ƒåœ¨äºwait(),åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨t.join()ç›¸å½“äºåœ¨mainæ–¹æ³•ä¸­æ·»åŠ  new JoinDemo().wait();æ˜¯ä¸€æ ·çš„æ•ˆæœï¼›åœ¨è¿™é‡Œåªä¸è¿‡æ˜¯waitæ–¹æ³•å†™åœ¨äº†å­çº¿ç¨‹çš„æ–¹æ³•ä¸­ã€‚ å†æ¬¡é‡ç”³ä¸€éï¼Œjoinæ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨ä¸»çº¿ç¨‹é˜»å¡ï¼Œç­‰åœ¨å­çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œç”±å­çº¿ç¨‹å”¤é†’ä¸»çº¿ç¨‹ï¼Œå†ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹è°ƒç”¨t.join()æ–¹æ³•ä¹‹åçš„é€»è¾‘ã€‚ é‚£ä¹ˆä¸»çº¿ç¨‹æ˜¯åœ¨ä»€ä¹ˆæƒ…å†µä¸‹çŸ¥é“è¦ç»§ç»­æ‰§è¡Œå‘¢ï¼Ÿå°±æ˜¯ä¸Šé¢è¯´çš„ï¼Œä¸»çº¿ç¨‹å…¶å®æ˜¯ç”±joinçš„å­çº¿ç¨‹åœ¨æ‰§è¡Œå®Œæˆä¹‹åè°ƒç”¨çš„notifyAll()æ–¹æ³•ï¼Œæ¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚æ€ä¹ˆè¯æ˜å‘¢ï¼Ÿ å…¶å®å¤§å®¶å¯ä»¥å»ç¿»çœ‹JVMçš„æºç å®ç°ï¼ŒThread.cppæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€æ®µä»£ç ï¼š 123456void JavaThread::exit(bool destroy_vm, ExitType exit_type) &#123; // Notify waiters on thread object. This has to be done after exit() is called // on the thread (if the thread is the last thread in a daemon ThreadGroup the // group should have the destroyed bit set before waiters are notified). ensure_join(this);&#125; å…¶ä¸­è°ƒç”¨ensure_joinæ–¹æ³• 123456789101112131415161718static void ensure_join(JavaThread* thread) &#123; // We do not need to grap the Threads_lock, since we are operating on ourself. Handle threadObj(thread, thread-&gt;threadObj()); assert(threadObj.not_null(), &quot;java thread object must exist&quot;); ObjectLocker lock(threadObj, thread); // Ignore pending exception (ThreadDeath), since we are exiting anyway thread-&gt;clear_pending_exception(); // Thread is exiting. So set thread_status field in java.lang.Thread class to TERMINATED. java_lang_Thread::set_thread_status(threadObj(), java_lang_Thread::TERMINATED); // Clear the native thread instance - this makes isAlive return false and allows the join() // to complete once we&#x27;ve done the notify_all below //è¿™é‡Œæ˜¯æ¸…é™¤nativeçº¿ç¨‹ï¼Œè¿™ä¸ªæ“ä½œä¼šå¯¼è‡´isAlive()æ–¹æ³•è¿”å›false java_lang_Thread::set_thread(threadObj(), NULL); // åœ¨è¿™é‡Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ lock.notify_all(thread); // Ignore pending exception (ThreadDeath), since we are exiting anyway thread-&gt;clear_pending_exception();&#125; åœ¨JVMçš„ä»£ç ä¸­ï¼Œçº¿ç¨‹æ‰§è¡Œç»“æŸçš„æœ€ç»ˆè°ƒç”¨äº†lock.notify_all(thread)æ–¹æ³•æ¥å”¤é†’æ‰€æœ‰å¤„äºç­‰åˆ°çš„çº¿ç¨‹ ä½¿ç”¨åœºæ™¯ æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨Callableæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œéœ€è¦åœ¨ä¸»çº¿ç¨‹å¤„ç†ä»»åŠ¡çš„è¿”å›å€¼æ—¶ï¼Œå¯ä»¥è°ƒç”¨joinæ–¹æ³•ï¼› è¿˜æœ‰ä¸€äº›åœºæ™¯å¸Œæœ›çº¿ç¨‹ä¹‹é—´é¡ºåºæ‰§è¡Œçš„ï¼› join()æ–¹æ³•ä¸sleep()çš„æ¯”è¾ƒæˆ‘ä»¬å…ˆè¯´ä¸€ä¸‹sleepæ–¹æ³•ï¼š è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ã€‚ ä¼‘çœ æ—¶é—´çš„å‡†ç¡®æ€§ä¾èµ–äºç³»ç»Ÿæ—¶é’Ÿå’ŒCPUè°ƒåº¦æœºåˆ¶ã€‚ ä¸é‡Šæ”¾å·²è·å–çš„é”èµ„æºï¼Œå¦‚æœsleepæ–¹æ³•åœ¨åŒæ­¥ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹æ˜¯æ— æ³•è¿›- å…¥åˆ°å½“å‰åŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­çš„ã€‚ å¯é€šè¿‡è°ƒç”¨interrupt()æ–¹æ³•æ¥å”¤é†’ä¼‘çœ çº¿ç¨‹ã€‚ sleepæ˜¯é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ ç›¸æ¯”ä¸sleepæ–¹æ³•sleepæ˜¯é™æ€æ–¹æ³•ï¼Œè€Œä¸”sleepçš„çº¿ç¨‹ä¸æ˜¯æ”¾é”èµ„æºï¼Œè€Œjoinæ–¹æ³•æ˜¯å¯¹è±¡æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ä¼šé‡Šæ”¾æ‰å¯¹è±¡é”ï¼› å…³äºjoinæ–¹æ³•ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œé‚£åˆ°åº•æ˜¯é‡Šæ”¾çš„é‚£ä¸ªå¯¹è±¡çš„é”å‘¢ï¼Œå¯ä»¥å‚ç…§ å…³äºjoin() æ˜¯å¦ä¼šé‡Šæ”¾é”çš„ä¸€äº›æ€è€ƒ å‚è€ƒèµ„æ–™ 1ã€Javaå¤šçº¿ç¨‹ä¸­joinæ–¹æ³•çš„ç†è§£2ã€Thread.joinçš„ä½œç”¨å’ŒåŸç†3ã€Thread.joinçš„ä½œç”¨å’ŒåŸç† d å±±è„šå¤ªæ‹¥æŒ¤ æˆ‘ä»¬æ›´é«˜å¤„è§ã€‚","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Javaå†…å­˜æ¨¡å‹","date":"2021-07-28T09:57:51.000Z","path":"wiki/Javaå†…å­˜æ¨¡å‹/","text":"Javaå†…å­˜æ¨¡å‹ ä»€ä¹ˆæ˜¯JMM?Java Memory Modelç®€ç§°JMM, æ˜¯ä¸€ç³»åˆ—çš„Javaè™šæ‹Ÿæœºå¹³å°å¯¹å¼€å‘è€…æä¾›çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å†…å­˜å¯è§æ€§ã€æ˜¯å¦å¯ä»¥é‡æ’åºç­‰é—®é¢˜çš„æ— å…³å…·ä½“å¹³å°çš„ç»Ÿä¸€çš„ä¿è¯ã€‚(å¯èƒ½åœ¨æœ¯è¯­ä¸Šä¸Javaè¿è¡Œæ—¶å†…å­˜åˆ†å¸ƒæœ‰æ­§ä¹‰ï¼Œåè€…æŒ‡å †ã€æ–¹æ³•åŒºã€çº¿ç¨‹æ ˆç­‰å†…å­˜åŒºåŸŸ)ã€‚ JMMè§„èŒƒçš„å†…å®¹ æ‰€æœ‰å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ ä¸»å†…å­˜æ˜¯è™šæ‹Ÿæœºå†…å­˜çš„ä¸€éƒ¨åˆ† æ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¿å­˜å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬ çº¿ç¨‹å¯¹å˜é‡çš„æ“ä½œå¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œ ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ JMMå¹¶ä¸æ˜¯ä¸€ä¸ªå®¢è§‚å­˜åœ¨çš„ä¸œè¥¿ï¼Œå®ƒå®é™…æ˜¯ä¸ºäº†è§„èŒƒJavaè™šæ‹Ÿæœºåˆ¶å®šåˆ°ä¸€å¥—æ ‡å‡†ã€‚é‚£ä¸ºä»€ä¹ˆéœ€è¦è¿™å¥—æ ‡å‡†å‘¢ï¼Ÿ å…¶å®æˆ‘ä»¬éƒ½çŸ¥é“JVMæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„ã€‚è€Œç›®å‰çš„æ“ä½œç³»ç»Ÿéƒ½æ˜¯åŸºäºå†¯è¯ºä¼Šæ›¼è®¾ç½®çš„è®¡ç®—æœºç³»ç»Ÿä½“ç³»æ¥çš„ã€‚CPUæ˜¯è®¡ç®—æœºä¸­ç”¨æ¥æ‰§è¡Œæ§åˆ¶å’Œè®¡ç®—çš„æ ¸å¿ƒç»„ä»¶ã€‚ æ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡å…¨éƒ¨åœ¨CPUä¸­å®Œæˆï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ‰€æœ‰å˜é‡çš„æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ã€‚CPUåœ¨æ‰§è¡Œè®¡ç®—æ—¶ï¼Œéœ€è¦å»ä¸»å†…å­˜åŠ è½½æ•°æ®ï¼ŒCPUæ‰§è¡Œè¿ç®—çš„é€Ÿåº¦æå¿«ï¼Œè¿™å°±è®¾è®¡ä¸€ä¸ªCPUæ‰§è¡Œé€Ÿåº¦å’Œæ•°æ®åŠ è½½é€Ÿåº¦ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ åœ¨æ“ä½œç³»ç»Ÿçº§åˆ«è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æ˜¯å¼•å…¥äº†CPUç¼“å­˜ã€‚æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±ç§æœ‰çš„L1ç¼“å­˜å’ŒL2ç¼“å­˜ï¼Œå½“æ‰§è¡Œè®¡ç®—æ—¶ï¼Œä¼šä¼˜å…ˆå»CPUè‡ªå·±çš„ç¼“å­˜ä¸­å¯»æ‰¾æ•°æ®ï¼Œæ²¡æœ‰çš„è¯æ‰ä¼šé‡æ–°åŠ è½½å†…å­˜æ•°æ®ã€‚è¿™ç§æ–¹å¼ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†CPUè®¡ç®—å’Œæ•°æ®åŠ è½½ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ ä½†æ˜¯ä¹Ÿä¼šå¼•å…¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ ç¼“å­˜ä¸€è‡´æ€§ä¸MESIåè®® é¦–å…ˆçœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯MESIåè®® ç¼“å­˜ä¸€è‡´æ€§åè®®ç»™ç¼“å­˜è¡Œï¼ˆé€šå¸¸ä¸º64å­—èŠ‚ï¼‰å®šä¹‰äº†ä¸ªçŠ¶æ€ï¼šç‹¬å ï¼ˆexclusiveï¼‰ã€å…±äº«ï¼ˆshareï¼‰ã€ä¿®æ”¹ï¼ˆmodifiedï¼‰ã€å¤±æ•ˆï¼ˆinvalidï¼‰ï¼Œç”¨æ¥æè¿°è¯¥ç¼“å­˜è¡Œæ˜¯å¦è¢«å¤šå¤„ç†å™¨å…±äº«ã€æ˜¯å¦ä¿®æ”¹ã€‚æ‰€ä»¥ç¼“å­˜ä¸€è‡´æ€§åè®®ä¹Ÿç§°MESIåè®®ã€‚ ç‹¬å ï¼ˆexclusiveï¼‰ï¼šä»…å½“å‰å¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰ä¿®æ”¹è¿‡ï¼Œæ˜¯æœ€æ–°çš„å€¼ã€‚ å…±äº«ï¼ˆshareï¼‰ï¼šæœ‰å¤šä¸ªå¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æ²¡æœ‰ä¿®æ”¹è¿‡ç¼“å­˜ï¼Œæ˜¯æœ€æ–°çš„å€¼ã€‚ ä¿®æ”¹ï¼ˆmodifiedï¼‰ï¼šä»…å½“å‰å¤„ç†å™¨æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œï¼Œå¹¶ä¸”ç¼“å­˜è¡Œè¢«ä¿®æ”¹è¿‡äº†ï¼Œä¸€å®šæ—¶é—´å†…ä¼šå†™å›ä¸»å­˜ï¼Œä¼šå†™æˆåŠŸçŠ¶æ€ä¼šå˜ä¸ºSã€‚ å¤±æ•ˆï¼ˆinvalidï¼‰ï¼šç¼“å­˜è¡Œè¢«å…¶ä»–å¤„ç†å™¨ä¿®æ”¹è¿‡ï¼Œè¯¥å€¼ä¸æ˜¯æœ€æ–°çš„å€¼ï¼Œéœ€è¦è¯»å–ä¸»å­˜ä¸Šæœ€æ–°çš„å€¼ã€‚ å¦‚ä½•è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜å‘¢ï¼Ÿ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…±äº«å˜é‡æ˜¯å­˜å‚¨åœ¨ä¸»å†…å­˜Memoryä¸­ï¼Œåœ¨CPUè®¡ç®—æ—¶ï¼Œæ¯ä¸€ä¸ªCPUéƒ½æœ‰æ”¹å˜é‡çš„ç‹¬ç«‹æ‹·è´ï¼Œæ¯ä¸ªCPUå¯ä»¥å»è¯»å–ç”šè‡³ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸€ä¸ªCPU modifyäº†å˜é‡çš„å€¼ï¼Œéœ€è¦é€šçŸ¥å…¶ä»–çš„CPUè¿™ä¸ªå˜é‡çš„æœ€æ–°å€¼æ˜¯ä»€ä¹ˆã€‚é‚£ä¹ˆå¯ä»¥æ€ä¹ˆåšå‘¢ã€‚ 1ã€åœ¨åˆå§‹çŠ¶æ€ï¼Œæ¯ä¸ªCPUè¿˜æ²¡æœ‰åŠ è½½å…±äº«å˜é‡ï¼Œæ‰€æœ‰æ¯ä¸€ä¸ªCPUçš„ç¼“å­˜è¡Œçš„çŠ¶æ€éƒ½æ˜¯invalidï¼› 2ã€å½“CPU0å»ä½¿ç”¨è¿™ä¸ªå…±äº«å˜é‡çš„æ—¶å€™ï¼Œé¦–å…ˆå»è‡ªå·±çš„ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œè‚¯å®šæ˜¯ç¼“å­˜ä¸å‘½ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯cache miss,è¿™ä¸ªæ—¶å€™å»ä¸»å†…å­˜Memoryä¸­å»åŠ è½½ï¼Œå½“å…±äº«å˜é‡çš„å€¼åŠ è½½åˆ°CPU0çš„ç¼“å­˜åï¼ŒCPUç¼“å­˜è¡ŒçŠ¶æ€å˜æˆshared, ä¹Ÿå°±æ˜¯å…±äº«çŠ¶æ€ï¼› 3ã€å¦‚æœè¿™ä¸ªæ—¶å€™æœ‰å…¶ä»–çš„CPUä¹Ÿè¯»å–äº†å…±äº«å˜é‡çš„å€¼ï¼Œå®ƒä»¬çš„cache line çš„çŠ¶æ€åŒæ ·ä¹Ÿæ˜¯sharedå…±äº«çŠ¶æ€ï¼›æ­¤æ—¶ä¸€ä¸ªCPUå¦‚æœä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œè€Œæ²¡æœ‰é€šçŸ¥å…¶ä»–çš„CPU,å°±ä¼šé€ æˆç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼› 4ã€å½“CPU0å°è¯•å»ä¿®æ”¹å…±äº«å˜é‡çš„å€¼æ—¶ï¼Œå®ƒä¼šå‘å‡ºä¸€ä¸ªread invalidateå‘½ä»¤ï¼ŒåŒæ—¶CPU0çš„ç¼“å­˜è¡ŒçŠ¶æ€è®¾ç½®ä¸ºexclusive(ç‹¬å ),åŒæ—¶å°†å…¶ä»–åŠ è½½äº†è¿™ä¸ªå…±äº«å˜é‡çš„cachelineçš„çŠ¶æ€è®¾ç½®ä¸ºinvalidã€‚é€šä¿—ä¸€ç‚¹å°±æ˜¯CPU0ç‹¬å çš„è¿™ä¸ªå˜é‡çš„ç¼“å­˜è¡Œï¼Œå…¶ä»–çš„CPUç¼“å­˜çš„å…±äº«å˜é‡éƒ½å¤±æ•ˆäº†ï¼› 5ã€CPU0æ¥ä¸‹æ¥ä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå®ƒä¼šå°†cachelineçš„çŠ¶æ€ä¿®æ”¹ä¸ºmodified,å…¶å®ä¹Ÿæ˜¯ç‹¬å å…±äº«å˜é‡çš„cachelineï¼Œåªä¸è¿‡æ˜¯æ­¤æ—¶ç¼“å­˜è¡Œçš„æ•°æ®å’Œä¸»å†…å­˜Memoryçš„æ•°æ®ä¸ä¸€è‡´çš„ï¼Œè€Œexclusiveè™½ç„¶ä¹Ÿæ˜¯ç‹¬å çŠ¶æ€ï¼Œä½†æ˜¯å…±äº«å˜é‡çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œmodifiedçš„å€¼éœ€è¦write backåˆ°Memoryä¸­å»çš„ï¼Œè€Œexclusiveæ˜¯ä¸éœ€è¦çš„ï¼› 6ã€åœ¨cachelineæ²¡æœ‰æ›¿æ¢å‡ºCPU0çš„cacheä¹‹å‰ï¼Œå½“æœ‰å…¶ä»–CPUæ¥è¯»å–å…±äº«å˜é‡ï¼Œæ­¤æ—¶è‚¯å®šæ˜¯cache miss ,å› ä¸ºCPU0çš„modifyæ“ä½œå·²ç»å°†å®ƒçš„ç¼“å­˜å¤±æ•ˆäº†ã€‚å¦‚æœCPU0çš„çŠ¶æ€æ˜¯modifiedçŠ¶æ€ï¼Œå®ƒå¿…é¡»å“åº”å…¶ä»–CPUçš„è¯»æ“ä½œï¼Œä¼šå‘ŠçŸ¥å…¶ä»–CPUä¸»å†…å­˜çš„æ•°æ®æ˜¯dirty dataã€‚æ‰€ä»¥å…¶ä»–çš„CPUçš„çŠ¶æ€å¯èƒ½ä¼šå˜æˆsharedã€‚å¦‚æœCPU0è¿˜æ²¡æœ‰write backæ“ä½œï¼Œå…¶ä»–çš„CPUçŠ¶æ€è¿˜æ˜¯invalidçŠ¶æ€ã€‚ Store Bufferæ­£å¦‚ä¸Šé¢æ‰€æè¿°çš„ï¼Œåœ¨CPU0è¿›è¡Œå…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œä¼šåŒæ­¥ä¿®æ”¹å…¶ä»–CPUçš„cachelineçŠ¶æ€ä¸ºinvalidï¼Œè¿™ä¸ªæ“ä½œæ˜¯å’Œå…±äº«å˜é‡çš„å†™æ“ä½œåŒæ­¥è¿›è¡Œçš„ï¼Œå› æ­¤å…±äº«å˜é‡çš„å†™æ“ä½œçš„æ€§èƒ½æ˜¯éå¸¸å·®çš„ã€‚åœ¨ä¿®æ”¹å…¶ä»–çš„CPU cachelineçŠ¶æ€æ—¶ï¼ŒCPU0å…¶å®æ˜¯å¤„äºé˜»å¡çŠ¶æ€çš„ã€‚æ‰€ä»¥ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†Store Bufferçš„è§£å†³æ–¹æ¡ˆã€‚ è¿™æ ·çš„è¯ï¼Œå†™æ“ä½œä¸å¿…ç­‰åˆ°cachelineè¢«åŠ è½½ï¼Œè€Œæ˜¯ç›´æ¥å†™åˆ°store bufferä¸­ï¼Œç„¶åå»æ‰§è¡Œåç»­çš„æ“ä½œã€‚ç”±äºæ˜¯store bufferç›¸å½“äºæ˜¯å¼‚æ­¥å¤„ç†ï¼Œåœ¨è¿™é‡Œå¯èƒ½ä¼šå‡ºç°å› ä¸ºå¹¶å‘æ‰§è¡Œå¯¼è‡´çš„æ‰§è¡Œæ‰§è¡Œäº¤å‰é—®é¢˜ï¼Œå…·ä½“è§£å†³æ–¹æ³•æ˜¯ä¾èµ–äºå†…å­˜å±éšœã€‚ å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼šLinuxå†…æ ¸åŒæ­¥æœºåˆ¶ä¹‹ï¼ˆä¸‰ï¼‰ï¼šmemory barrier Invalidate Queueå¤„ç†å¤±æ•ˆçš„ç¼“å­˜ä¹Ÿä¸æ˜¯ç®€å•çš„ï¼Œéœ€è¦è¯»å–ä¸»å­˜ã€‚å¹¶ä¸”å­˜å‚¨ç¼“å­˜ä¹Ÿä¸æ˜¯æ— é™å¤§çš„ï¼Œé‚£ä¹ˆå½“å­˜å‚¨ç¼“å­˜æ»¡çš„æ—¶å€™ï¼Œå¤„ç†å™¨è¿˜æ˜¯è¦ç­‰å¾…å¤±æ•ˆå“åº”çš„ã€‚ä¸ºäº†è§£å†³ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œå¼•è¿›äº†å¤±æ•ˆé˜Ÿåˆ—ï¼ˆinvalidate queueï¼‰ã€‚ å¤„ç†å¤±æ•ˆçš„å·¥ä½œå¦‚ä¸‹ï¼š æ”¶åˆ°å¤±æ•ˆæ¶ˆæ¯æ—¶ï¼Œæ”¾åˆ°å¤±æ•ˆé˜Ÿåˆ—ä¸­å»ã€‚ ä¸ºäº†ä¸è®©å¤„ç†å™¨ä¹…ç­‰å¤±æ•ˆå“åº”ï¼Œæ”¶åˆ°å¤±æ•ˆæ¶ˆæ¯éœ€è¦é©¬ä¸Šå›å¤å¤±æ•ˆå“åº”ã€‚ ä¸ºäº†ä¸é¢‘ç¹é˜»å¡å¤„ç†å™¨ï¼Œä¸ä¼šé©¬ä¸Šè¯»ä¸»å­˜ä»¥åŠè®¾ç½®ç¼“å­˜ä¸ºinvlidï¼Œåˆé€‚çš„æ—¶å€™å†ä¸€å—å¤„ç†å¤±æ•ˆé˜Ÿåˆ—ã€‚ happens- beforeåŸåˆ™ è™½ç„¶æŒ‡ä»¤é‡æ’æé«˜äº†å¹¶å‘çš„æ€§èƒ½ï¼Œä½†æ˜¯Javaè™šæ‹Ÿæœºä¼šå¯¹æŒ‡ä»¤é‡æ’åšå‡ºä¸€äº›è§„åˆ™é™åˆ¶ï¼Œå¹¶ä¸èƒ½è®©æ‰€æœ‰çš„æŒ‡ä»¤éƒ½éšæ„çš„æ”¹å˜æ‰§è¡Œä½ç½®ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š 1ã€å•çº¿ç¨‹æ¯ä¸ªæ“ä½œï¼Œhappen-beforeäºè¯¥çº¿ç¨‹ä¸­ä»»æ„åç»­æ“ä½œï¼›2ã€volatileå†™happen-beforeä¸åç»­å¯¹è¿™ä¸ªå˜é‡çš„è¯»ï¼›3ã€synchronizedè§£é”happen-beforeåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”ï¼›4ã€finalå˜é‡çš„å†™happen-beforeäºfinalåŸŸå¯¹è±¡çš„è¯»ï¼Œhappen-beforeåç»­å¯¹finalå˜é‡çš„è¯»ï¼›5ã€ä¼ é€’æ€§è§„åˆ™ï¼ŒAå…ˆäºBï¼ŒBå…ˆäºCï¼Œé‚£ä¹ˆAä¸€å®šå…ˆäºCå‘ç”Ÿï¼› https://www.processon.com/view/5c8b0978e4b0c996d363dcbc?fromnew=1 æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹-3y","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-synchronziedåº•å±‚åŸç†","date":"2021-07-28T09:57:19.000Z","path":"wiki/Java-synchronziedåº•å±‚åŸç†/","text":"synchronziedåº•å±‚åŸç†synchronziedå››ä¸ªå±‚çº§å®ç° Javaä»£ç  é€šè¿‡æ·»åŠ synchronziedç»™å¯¹è±¡æˆ–è€…æ–¹æ³•æˆ–è€…ä»£ç å— å­—èŠ‚ç å±‚çº§é€šè¿‡ä¸€ç»„ MONITORENTER/MONITOREXITæŒ‡ä»¤ JVMå±‚çº§ï¼šé”å‡çº§è¿‡ç¨‹ æ±‡ç¼–æ‰§è¡Œé€šè¿‡ lock comxchgæŒ‡ä»¤ä¿è¯åŸå­æ“ä½œ JDKæ—©æœŸï¼Œsynchronized å«åšé‡é‡çº§é”ï¼Œ å› ä¸ºç”³è¯·é”èµ„æºå¿…é¡»é€šè¿‡kernel, ç³»ç»Ÿè°ƒç”¨ 1234567891011121314151617181920;hello.asm;write(int fd, const void *buffer, size_t nbytes)section data msg db &quot;Hello&quot;, 0xA len equ $ - msgsection .textglobal _start_start: mov edx, len mov ecx, msg mov ebx, 1 ;æ–‡ä»¶æè¿°ç¬¦1 std_out mov eax, 4 ;writeå‡½æ•°ç³»ç»Ÿè°ƒç”¨å· 4 int 0x80 mov ebx, 0 mov eax, 1 ;exitå‡½æ•°ç³»ç»Ÿè°ƒç”¨å· int 0x80 ä¼˜åŒ–åçš„synchronizedå¦‚ä¸‹ğŸ‘‡ï¼š Javaå±‚çº§12345678public static void main(String[] args) &#123; Object object = new Object(); System.out.println(ClassLayout.parseInstance(object).toPrintable()); synchronized (object)&#123; System.out.println(ClassLayout.parseInstance(object).toPrintable()); &#125; &#125; å­—èŠ‚ç å±‚çº§12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// access flags 0x9 public static main([Ljava/lang/String;)V // parameter args TRYCATCHBLOCK L0 L1 L2 null TRYCATCHBLOCK L2 L3 L2 null L4 LINENUMBER 13 L4 NEW java/lang/Object DUP INVOKESPECIAL java/lang/Object.&lt;init&gt; ()V ASTORE 1 L5 LINENUMBER 14 L5 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; ALOAD 1 INVOKESTATIC org/openjdk/jol/info/ClassLayout.parseInstance (Ljava/lang/Object;)Lorg/openjdk/jol/info/ClassLayout; INVOKEVIRTUAL org/openjdk/jol/info/ClassLayout.toPrintable ()Ljava/lang/String; INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V L6 LINENUMBER 16 L6 ALOAD 1 DUP ASTORE 2 MONITORENTER L0 LINENUMBER 17 L0 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; ALOAD 1 INVOKESTATIC org/openjdk/jol/info/ClassLayout.parseInstance (Ljava/lang/Object;)Lorg/openjdk/jol/info/ClassLayout; INVOKEVIRTUAL org/openjdk/jol/info/ClassLayout.toPrintable ()Ljava/lang/String; INVOKEVIRTUAL java/io/PrintStream.println (Ljava/lang/String;)V L7 LINENUMBER 18 L7 ALOAD 2 MONITOREXIT L1 GOTO L8 L2 FRAME FULL [[Ljava/lang/String; java/lang/Object java/lang/Object] [java/lang/Throwable] ASTORE 3 ALOAD 2 MONITOREXIT L3 ALOAD 3 ATHROW L8 LINENUMBER 19 L8 FRAME CHOP 1 RETURN L9 LOCALVARIABLE args [Ljava/lang/String; L4 L9 0 LOCALVARIABLE object Ljava/lang/Object; L5 L9 1 MAXSTACK = 2 MAXLOCALS = 4&#125; ä¸»è¦é€šè¿‡MONITORENTER å’Œ MONITOREXIT ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤æ§åˆ¶åŠ é”è¿‡ç¨‹ JVMå±‚çº§é€šè¿‡é”å‡çº§è¿‡ç¨‹å®ç°åŠ é”ï¼›æ— é” -&gt; åå‘é” -&gt; è‡ªæ—‹é”ï¼ˆè½»é‡çº§é” è‡ªé€‚åº”é”ï¼‰-&gt; é‡é‡çº§é”é”å‡çº§è¿‡ç¨‹å¯ä»¥æŸ¥çœ‹ é”å‡çº§è¿‡ç¨‹ å¤åˆ¶ç†è§£ æ±‡ç¼–æŒ‡ä»¤çº§åˆ«linuxæ“ä½œç³»ç»Ÿå®‰è£…hsdisæ’ä»¶ï¼ŒæŸ¥çœ‹javaä»£ç çš„æ±‡ç¼–æŒ‡ä»¤ï¼š 1234567891011121314public class T &#123; static volatile int i = 0; public static void n() &#123; i++; &#125; public static synchronized void m() &#123;&#125; publics static void main(String[] args) &#123; for(int j=0; j&lt;1000_000; j++) &#123; m(); n(); &#125; &#125;&#125; æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1java -XX:+UnlockDiagnosticVMOptions -XX:+PrintAssembly T C1 Compile Level 1 (ä¸€çº§ä¼˜åŒ–) C2 Compile Level 2 (äºŒçº§ä¼˜åŒ–) æ‰¾åˆ°m() n()æ–¹æ³•çš„æ±‡ç¼–ç ï¼Œä¼šçœ‹åˆ° lock comxchg â€¦..æŒ‡ä»¤","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-é”æ¶ˆé™¤å’Œé”è†¨èƒ€","date":"2021-07-28T09:57:00.000Z","path":"wiki/Java-é”æ¶ˆé™¤å’Œé”è†¨èƒ€/","text":"é”æ¶ˆé™¤å’Œé”ç²—åŒ–é”æ¶ˆé™¤ ï¼ˆlock eliminateï¼‰1234public void add(String str1,String str2)&#123; StringBuffer sb = new StringBuffer(); sb.append(str1).append(str2);&#125; æˆ‘ä»¬éƒ½çŸ¥é“ StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒçš„å…³é”®æ–¹æ³•éƒ½æ˜¯è¢« synchronized ä¿®é¥°è¿‡çš„ï¼Œä½†æˆ‘ä»¬çœ‹ä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œsb è¿™ä¸ªå¼•ç”¨åªä¼šåœ¨ add æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œä¸å¯èƒ½è¢«å…¶å®ƒçº¿ç¨‹å¼•ç”¨ï¼ˆå› ä¸ºæ˜¯å±€éƒ¨å˜é‡ï¼Œæ ˆç§æœ‰ï¼‰ï¼Œå› æ­¤ sb æ˜¯ä¸å¯èƒ½å…±äº«çš„èµ„æºï¼ŒJVM ä¼šè‡ªåŠ¨æ¶ˆé™¤ StringBuffer å¯¹è±¡å†…éƒ¨çš„é”ã€‚ é”ç²—åŒ– ï¼ˆlock coarseningï¼‰123456789public String test(String str)&#123; int i = 0; StringBuffer sb = new StringBuffer(): while(i &lt; 100)&#123; sb.append(str); i++; &#125; return sb.toString():&#125; JVM ä¼šæ£€æµ‹åˆ°è¿™æ ·ä¸€è¿ä¸²çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼ˆwhile å¾ªç¯å†… 100 æ¬¡æ‰§è¡Œ appendï¼Œæ²¡æœ‰é”ç²—åŒ–çš„å°±è¦è¿›è¡Œ 100 æ¬¡åŠ é”/è§£é”ï¼‰ï¼Œæ­¤æ—¶ JVM å°±ä¼šå°†åŠ é”çš„èŒƒå›´ç²—åŒ–åˆ°è¿™ä¸€è¿ä¸²çš„æ“ä½œçš„å¤–éƒ¨ï¼ˆæ¯”å¦‚ while è™šå¹»ä½“å¤–ï¼‰ï¼Œä½¿å¾—è¿™ä¸€è¿ä¸²æ“ä½œåªéœ€è¦åŠ ä¸€æ¬¡é”å³å¯ã€‚ é”é™çº§https://www.zhihu.com/question/63859501 å…¶å®ï¼Œåªè¢«VMThreadè®¿é—®ï¼Œé™çº§ä¹Ÿå°±æ²¡å•¥æ„ä¹‰äº†ã€‚æ‰€ä»¥å¯ä»¥ç®€å•è®¤ä¸ºé”é™çº§ä¸å­˜åœ¨ï¼","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Java-é”å‡çº§è¿‡ç¨‹","date":"2021-07-28T09:56:39.000Z","path":"wiki/Java-é”å‡çº§è¿‡ç¨‹/","text":"é”å‡çº§ä½¿ç”¨JOLæŸ¥çœ‹åŠ é”ä¹‹åçš„å¯¹è±¡ä¿¡æ¯12345678public static void main(String[] args) &#123; Object object = new Object(); System.out.println(ClassLayout.parseInstance(object).toPrintable()); synchronized (object)&#123; System.out.println(ClassLayout.parseInstance(object).toPrintable()); &#125; &#125; æŸ¥çœ‹æ‰“å°ç»“æœï¼š 1234567891011121314151617java.lang.Object object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 4 (object header) 01 00 00 00 (00000001 00000000 00000000 00000000) (1) 4 4 (object header) 00 00 00 00 (00000000 00000000 00000000 00000000) (0) 8 4 (object header) e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243) 12 4 (loss due to the next object alignment)Instance size: 16 bytesSpace losses: 0 bytes internal + 4 bytes external = 4 bytes totaljava.lang.Object object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 4 (object header) f0 b8 d0 0f (11110000 10111000 11010000 00001111) (265337072) 4 4 (object header) 00 70 00 00 (00000000 01110000 00000000 00000000) (28672) 8 4 (object header) e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243) 12 4 (loss due to the next object alignment)Instance size: 16 bytesSpace losses: 0 bytes internal + 4 bytes external = 4 bytes total é”å‡çº§è¿‡ç¨‹ é”å‡çº§è¿‡ç¨‹ï¼š new - åå‘é” - è½»é‡çº§é” ï¼ˆæ— é”, è‡ªæ—‹é”ï¼Œè‡ªé€‚åº”è‡ªæ—‹ï¼‰- é‡é‡çº§é” è‡ªæ—‹é”ä»€ä¹ˆæ—¶å€™å‡çº§ä¸ºé‡é‡çº§é”ï¼Ÿ è¶…è¿‡è‡ªé€‰æ¬¡æ•°ä»æ²¡æœ‰è·å¾—é” ä¸ºä»€ä¹ˆæœ‰è‡ªæ—‹é”è¿˜éœ€è¦é‡é‡çº§é”ï¼Ÿ è‡ªæ—‹æ˜¯æ¶ˆè€—CPUèµ„æºçš„ï¼Œå¦‚æœé”çš„æ—¶é—´é•¿ï¼Œæˆ–è€…è‡ªæ—‹çº¿ç¨‹å¤šï¼ŒCPUä¼šè¢«å¤§é‡æ¶ˆè€—é‡é‡çº§é”æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œæ‰€æœ‰æ‹¿ä¸åˆ°é”çš„è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸éœ€è¦æ¶ˆè€—CPUèµ„æº åå‘é”æ˜¯å¦ä¸€å®šæ¯”è‡ªæ—‹é”æ•ˆç‡é«˜ï¼Ÿ ä¸ä¸€å®šï¼Œåœ¨æ˜ç¡®çŸ¥é“ä¼šæœ‰å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œåå‘é”è‚¯å®šä¼šæ¶‰åŠé”æ’¤é”€ï¼Œè¿™æ—¶å€™ç›´æ¥ä½¿ç”¨è‡ªæ—‹é”JVMå¯åŠ¨è¿‡ç¨‹ï¼Œä¼šæœ‰å¾ˆå¤šçº¿ç¨‹ç«äº‰ï¼ˆæ˜ç¡®ï¼‰ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µå¯åŠ¨æ—¶ä¸æ‰“å¼€åå‘é”ï¼Œè¿‡ä¸€æ®µå„¿æ—¶é—´å†æ‰“å¼€ synchronizedä¼˜åŒ–çš„è¿‡ç¨‹å’Œmarkwordæ¯æ¯ç›¸å…³ç”¨markwordä¸­æœ€ä½çš„ä¸‰ä½ä»£è¡¨é”çŠ¶æ€ å…¶ä¸­1ä½æ˜¯åå‘é”ä½ ä¸¤ä½æ˜¯æ™®é€šé”ä½ Object o = new Object()é” = 0 01 æ— é”æ€æ³¨æ„ï¼šå¦‚æœåå‘é”æ‰“å¼€ï¼Œé»˜è®¤æ˜¯åŒ¿ååå‘çŠ¶æ€ o.hashCode()001 + hashcode 1200000001 10101101 00110100 0011011001011001 00000000 00000000 00000000 little endian big endian 00000000 00000000 00000000 01011001 00110110 00110100 10101101 00000000 é»˜è®¤synchronized(o)00 -&gt; è½»é‡çº§é”é»˜è®¤æƒ…å†µ åå‘é”æœ‰ä¸ªæ—¶å»¶ï¼Œé»˜è®¤æ˜¯4ç§’why? å› ä¸ºJVMè™šæ‹Ÿæœºè‡ªå·±æœ‰ä¸€äº›é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹ï¼Œé‡Œé¢æœ‰å¥½å¤šsyncä»£ç ï¼Œè¿™äº›syncä»£ç å¯åŠ¨æ—¶å°±çŸ¥é“è‚¯å®šä¼šæœ‰ç«äº‰ï¼Œå¦‚æœä½¿ç”¨åå‘é”ï¼Œå°±ä¼šé€ æˆåå‘é”ä¸æ–­çš„è¿›è¡Œé”æ’¤é”€å’Œé”å‡çº§çš„æ“ä½œï¼Œæ•ˆç‡è¾ƒä½ã€‚ 1-XX:BiasedLockingStartupDelay=0 å¦‚æœè®¾å®šä¸Šè¿°å‚æ•°new Object () - &gt; 101 åå‘é” -&gt;çº¿ç¨‹IDä¸º0 -&gt; Anonymous BiasedLockæ‰“å¼€åå‘é”ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œé»˜è®¤å°±æ˜¯ä¸€ä¸ªå¯åå‘åŒ¿åå¯¹è±¡101 å¦‚æœæœ‰çº¿ç¨‹ä¸Šé”ä¸Šåå‘é”ï¼ŒæŒ‡çš„å°±æ˜¯ï¼ŒæŠŠmarkwordçš„çº¿ç¨‹IDæ”¹ä¸ºè‡ªå·±çº¿ç¨‹IDçš„è¿‡ç¨‹åå‘é”ä¸å¯é‡åå‘ æ‰¹é‡åå‘ æ‰¹é‡æ’¤é”€ å¦‚æœæœ‰çº¿ç¨‹ç«äº‰æ’¤é”€åå‘é”ï¼Œå‡çº§è½»é‡çº§é”çº¿ç¨‹åœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆç”ŸæˆLockRecord ï¼Œç”¨CASæ“ä½œå°†markwordè®¾ç½®ä¸ºæŒ‡å‘è‡ªå·±è¿™ä¸ªçº¿ç¨‹çš„LRçš„æŒ‡é’ˆï¼Œè®¾ç½®æˆåŠŸè€…å¾—åˆ°é” å¦‚æœç«äº‰åŠ å‰§ç«äº‰åŠ å‰§ï¼šæœ‰çº¿ç¨‹è¶…è¿‡10æ¬¡è‡ªæ—‹ï¼Œ -XX:PreBlockSpinï¼Œ æˆ–è€…è‡ªæ—‹çº¿ç¨‹æ•°è¶…è¿‡CPUæ ¸æ•°çš„ä¸€åŠï¼Œ 1.6ä¹‹åï¼ŒåŠ å…¥è‡ªé€‚åº”è‡ªæ—‹ Adapative Self Spinning ï¼Œ JVMè‡ªå·±æ§åˆ¶å‡çº§é‡é‡çº§é”ï¼š-&gt; å‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºï¼Œlinux mutex , CPUä»3çº§-0çº§ç³»ç»Ÿè°ƒç”¨ï¼Œçº¿ç¨‹æŒ‚èµ·ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ï¼Œç„¶åå†æ˜ å°„å›ç”¨æˆ·ç©ºé—´ (ä»¥ä¸Šå®éªŒç¯å¢ƒæ˜¯JDK11ï¼Œæ‰“å¼€å°±æ˜¯åå‘é”ï¼Œè€ŒJDK8é»˜è®¤å¯¹è±¡å¤´æ˜¯æ— é”)åå‘é”é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ—¶å»¶ï¼Œå¦‚æœè¦è§‚å¯Ÿåˆ°åå‘é”ï¼Œåº”è¯¥è®¾å®šå‚æ•° å¦‚æœè®¡ç®—è¿‡å¯¹è±¡çš„hashCodeï¼Œåˆ™å¯¹è±¡æ— æ³•è¿›å…¥åå‘çŠ¶æ€ï¼ è½»é‡çº§é”é‡é‡çº§é”çš„hashCodeå­˜åœ¨ä¸ä»€ä¹ˆåœ°æ–¹ï¼Ÿç­”æ¡ˆï¼šçº¿ç¨‹æ ˆä¸­ï¼Œè½»é‡çº§é”çš„LRä¸­ï¼Œæˆ–æ˜¯ä»£è¡¨é‡é‡çº§é”çš„ObjectMonitorçš„æˆå‘˜ä¸­ å…³äºepoch: (ä¸é‡è¦) æ‰¹é‡é‡åå‘ä¸æ‰¹é‡æ’¤é”€æ¸Šæºï¼šä»åå‘é”çš„åŠ é”è§£é”è¿‡ç¨‹ä¸­å¯çœ‹å‡ºï¼Œå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹åå¤è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåå‘é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€åŸºæœ¬å¯ä»¥å¿½ç•¥ï¼Œä½†æ˜¯å½“æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å¾—é”æ—¶ï¼Œå°±éœ€è¦ç­‰åˆ°safe pointæ—¶ï¼Œå†å°†åå‘é”æ’¤é”€ä¸ºæ— é”çŠ¶æ€æˆ–å‡çº§ä¸ºè½»é‡çº§ï¼Œä¼šæ¶ˆè€—ä¸€å®šçš„æ€§èƒ½ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç«äº‰é¢‘ç¹çš„æƒ…å†µä¸‹ï¼Œåå‘é”ä¸ä»…ä¸èƒ½æé«˜æ€§èƒ½ï¼Œè¿˜ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚äºæ˜¯ï¼Œå°±æœ‰äº†æ‰¹é‡é‡åå‘ä¸æ‰¹é‡æ’¤é”€çš„æœºåˆ¶ã€‚ åŸç†ä»¥classä¸ºå•ä½ï¼Œä¸ºæ¯ä¸ªclassç»´æŠ¤è§£å†³åœºæ™¯æ‰¹é‡é‡åå‘ï¼ˆbulk rebiasï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¤§é‡å¯¹è±¡å¹¶æ‰§è¡Œäº†åˆå§‹çš„åŒæ­¥æ“ä½œï¼Œåæ¥å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥å°†è¿™äº›å¯¹è±¡ä½œä¸ºé”å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„åå‘é”æ’¤é”€æ“ä½œã€‚æ‰¹é‡æ’¤é”€ï¼ˆbulk revokeï¼‰æœºåˆ¶æ˜¯ä¸ºäº†è§£å†³ï¼šåœ¨æ˜æ˜¾å¤šçº¿ç¨‹ç«äº‰å‰§çƒˆçš„åœºæ™¯ä¸‹ä½¿ç”¨åå‘é”æ˜¯ä¸åˆé€‚çš„ã€‚ ä¸€ä¸ªåå‘é”æ’¤é”€è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡è¯¥classçš„å¯¹è±¡å‘ç”Ÿåå‘æ’¤é”€æ“ä½œæ—¶ï¼Œè¯¥è®¡æ•°å™¨+1ï¼Œå½“è¿™ä¸ªå€¼è¾¾åˆ°é‡åå‘é˜ˆå€¼ï¼ˆé»˜è®¤20ï¼‰æ—¶ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„åå‘é”æœ‰é—®é¢˜ï¼Œå› æ­¤ä¼šè¿›è¡Œæ‰¹é‡é‡åå‘ã€‚æ¯ä¸ªclasså¯¹è±¡ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„epochå­—æ®µï¼Œæ¯ä¸ªå¤„äºåå‘é”çŠ¶æ€å¯¹è±¡çš„Mark Wordä¸­ä¹Ÿæœ‰è¯¥å­—æ®µï¼Œå…¶åˆå§‹å€¼ä¸ºåˆ›å»ºè¯¥å¯¹è±¡æ—¶classä¸­çš„epochçš„å€¼ã€‚æ¯æ¬¡å‘ç”Ÿæ‰¹é‡é‡åå‘æ—¶ï¼Œå°±å°†è¯¥å€¼+1ï¼ŒåŒæ—¶éå†JVMä¸­æ‰€æœ‰çº¿ç¨‹çš„æ ˆï¼Œæ‰¾åˆ°è¯¥classæ‰€æœ‰æ­£å¤„äºåŠ é”çŠ¶æ€çš„åå‘é”ï¼Œå°†å…¶epochå­—æ®µæ”¹ä¸ºæ–°å€¼ã€‚ä¸‹æ¬¡è·å¾—é”æ—¶ï¼Œå‘ç°å½“å‰å¯¹è±¡çš„epochå€¼å’Œclassçš„epochä¸ç›¸ç­‰ï¼Œé‚£å°±ç®—å½“å‰å·²ç»åå‘äº†å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡CASæ“ä½œå°†å…¶Mark Wordçš„Thread Id æ”¹æˆå½“å‰çº¿ç¨‹Idã€‚å½“è¾¾åˆ°é‡åå‘é˜ˆå€¼åï¼Œå‡è®¾è¯¥classè®¡æ•°å™¨ç»§ç»­å¢é•¿ï¼Œå½“å…¶è¾¾åˆ°æ‰¹é‡æ’¤é”€çš„é˜ˆå€¼åï¼ˆé»˜è®¤40ï¼‰ï¼ŒJVMå°±è®¤ä¸ºè¯¥classçš„ä½¿ç”¨åœºæ™¯å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œä¼šæ ‡è®°è¯¥classä¸ºä¸å¯åå‘ï¼Œä¹‹åï¼Œå¯¹äºè¯¥classçš„é”ï¼Œç›´æ¥èµ°è½»é‡çº§é”çš„é€»è¾‘ã€‚ æ²¡é”™ï¼Œæˆ‘å°±æ˜¯å•æ‰€æ‰€é•¿ åŠ é”ï¼ŒæŒ‡çš„æ˜¯é”å®šå¯¹è±¡ é”å‡çº§çš„è¿‡ç¨‹ JDKè¾ƒæ—©çš„ç‰ˆæœ¬ OSçš„èµ„æº äº’æ–¥é‡ ç”¨æˆ·æ€ -&gt; å†…æ ¸æ€çš„è½¬æ¢ é‡é‡çº§ æ•ˆç‡æ¯”è¾ƒä½ ç°ä»£ç‰ˆæœ¬è¿›è¡Œäº†ä¼˜åŒ– æ— é” - åå‘é” -è½»é‡çº§é”ï¼ˆè‡ªæ—‹é”ï¼‰-é‡é‡çº§é” 1ã€åå‘é” - markword ä¸Šè®°å½•å½“å‰çº¿ç¨‹æŒ‡é’ˆï¼Œä¸‹æ¬¡åŒä¸€ä¸ªçº¿ç¨‹åŠ é”çš„æ—¶å€™ï¼Œä¸éœ€è¦äº‰ç”¨ï¼Œåªéœ€è¦åˆ¤æ–­çº¿ç¨‹æŒ‡é’ˆæ˜¯å¦åŒä¸€ä¸ªï¼Œæ‰€ä»¥ï¼Œåå‘é”ï¼Œåå‘åŠ é”çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ ã€‚hashCodeå¤‡ä»½åœ¨çº¿ç¨‹æ ˆä¸Š çº¿ç¨‹é”€æ¯ï¼Œé”é™çº§ä¸ºæ— é” 2ã€æœ‰äº‰ç”¨ - é”å‡çº§ä¸ºè½»é‡çº§é” - æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„LockRecordåœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆä¸Šï¼Œç”¨CASå»äº‰ç”¨markwordçš„LRçš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘å“ªä¸ªçº¿ç¨‹çš„LRï¼Œå“ªä¸ªçº¿ç¨‹å°±æ‹¥æœ‰é” 3ã€è‡ªæ—‹è¶…è¿‡10æ¬¡ï¼Œå‡çº§ä¸ºé‡é‡çº§é” - å¦‚æœå¤ªå¤šçº¿ç¨‹è‡ªæ—‹ CPUæ¶ˆè€—è¿‡å¤§ï¼Œä¸å¦‚å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆä¸æ¶ˆè€—CPUï¼‰-XX:PreBlockSpin è‡ªæ—‹é”åœ¨ JDK1.4.2 ä¸­å¼•å…¥ï¼Œä½¿ç”¨ -XX:+UseSpinning æ¥å¼€å¯ã€‚JDK 6 ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚ 4ã€è‡ªé€‚åº”è‡ªæ—‹é”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ 5ã€åå‘é”ç”±äºæœ‰é”æ’¤é”€çš„è¿‡ç¨‹revokeï¼Œä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥ï¼Œåœ¨é”äº‰ç”¨ç‰¹åˆ«æ¿€çƒˆçš„æ—¶å€™ï¼Œç”¨åå‘é”æœªå¿…æ•ˆç‡é«˜ã€‚è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨è½»é‡çº§é”ã€‚","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"JVM-strace","date":"2021-07-28T09:52:23.000Z","path":"wiki/JVM-strace/","text":"strace å‘½ä»¤æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—strace -ff -o out java ***.class -ff : è·Ÿè¸ªè¿›ç¨‹ä¸‹æ‰€æœ‰çº¿ç¨‹ç”¨åˆ°çš„ç³»ç»Ÿå‘½ä»¤-o : å°†è·Ÿè¸ªçš„æ“ä½œç³»ç»Ÿæ—¥å¿—è¾“å‡º ä¸‹é¢æŸ¥çœ‹JDK1.8ä¸‹ï¼ŒBIOæ¨¡å¼éƒ½æœ‰å“ªäº›ç³»ç»Ÿå‘½ä»¤çš„æ‰§è¡Œ 123456789101112131415161718192021222324252627282930313233package com.ibli.javaBase.io.bio;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStream;import java.io.InputStreamReader;import java.net.ServerSocket;import java.net.Socket;/** * @Author gaolei * @Date 2021/4/3 2:55 ä¸‹åˆ * @Version 1.0 */public class SockerIo &#123; public static void main(String[] args) throws IOException &#123; ServerSocket serverSocket = new ServerSocket(9090); // é˜»å¡ Socket client = serverSocket.accept(); InputStream inputStream = client.getInputStream(); BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream)); // è¯»é˜»å¡ System.err.println(bufferedReader.readLine()); while (true)&#123; &#125; &#125;&#125; æœåŠ¡ç«¯ 1ã€javac SockerIo.java å¾—åˆ°SockerIo.classç„¶åï¼Œä½¿ç”¨straceå¯åŠ¨javaç¨‹åºğŸ‘‡ï¼š2ã€strace -ff -0 out java SockerIoå¾—åˆ°å¦‚ä¸‹æ—¥å¿—ï¼š å®¢æˆ·ç«¯ä½¿ç”¨ncè¿æ¥9090ç«¯å£ï¼Œç„¶åè¯·æ±‚æ•°æ® nc 127.0.0.1 9090 å‘é€å¦‚ä¸‹æ•°æ® straceæŸ¥çœ‹æ—¥å¿— æŸ¥çœ‹ä¸»çº¿ç¨‹æ—¥å¿—ï¼šå¦‚ä¸Šå›¾ï¼ŒğŸ‘†æ–‡ä»¶æœ€å¤§çš„æ˜¯ä¸»çº¿ç¨‹æ—¥å¿—ï¼š æ ¹æ®ä¸Šé¢ğŸ‘†straceå‘½ä»¤è·Ÿè¸ªçš„æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼ŒJDK1.8ä¸‹çš„BIOçš„å¤šè·¯å¤ç”¨å™¨æ˜¯ä½¿ç”¨çš„ã€Œpollã€","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"Java-NIOæ ¸å¿ƒç»„ä»¶--channel","date":"2021-07-28T09:51:42.000Z","path":"wiki/Java-NIOæ ¸å¿ƒç»„ä»¶-channel/","text":"NIOæ ¸å¿ƒç»„ä»¶ - ChannelSocketChannel å’Œ ServerSocketChannelå­¦ä¹ æ­¤éƒ¨åˆ†å¯ä»¥å¯¹æ¯”Socketå’ŒServerSocket æœåŠ¡ç«¯ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839public class NioSocketServer01 &#123; public static void main(String[] args) &#123; try &#123; // ServerSocketChannel æ”¯æŒé˜»å¡/éé˜»å¡ ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); // è®¾ç½®æˆéé˜»å¡ã€‚é»˜è®¤é˜»å¡true serverSocketChannel.configureBlocking(false); serverSocketChannel.socket().bind(new InetSocketAddress(8080)); // å¾ªç¯ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ while (true) &#123; // å¦‚æœæœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™è¿”å›ä¸€ä¸ªsocketChannelå®ä¾‹ï¼Œå¦åˆ™socketChannel=null SocketChannel socketChannel = serverSocketChannel.accept(); // ä»£ç æ‰§è¡Œåˆ°æ­¤å¤„ï¼Œè¯´æ˜æœ‰å®¢æˆ·ç«¯é“¾æ¥ if (socketChannel != null) &#123; // è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶è¾“å‡º ByteBuffer buffer = ByteBuffer.allocate(1024); socketChannel.read(buffer); System.err.println(new String(buffer.array())); // å°†æ•°æ®åœ¨å†™ä¼šå®¢æˆ·ç«¯ buffer.flip(); socketChannel.write(buffer); //éªŒè¯å®¢æˆ·ç«¯ socketChannelè®¾ç½®æˆfalseæ—¶ï¼Œä»æœåŠ¡ç«¯readæ•°æ®çš„æ“ä½œå˜æˆéé˜»å¡çš„ //ByteBuffer buffer = ByteBuffer.allocate(1024); //buffer.put(&quot;this is server!&quot;); //buffer.flip(); //socketChannel.write(buffer); &#125; else &#123; Thread.sleep(1000L); System.err.println(&quot;no client&quot;); &#125; &#125; &#125; catch (IOException | InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å®¢æˆ·ç«¯ä»£ç  12345678910111213141516171819202122232425262728293031public class NioSocketClient1 &#123; public static void main(String[] args) &#123; try &#123; SocketChannel socketChannel = SocketChannel.open(); // é»˜è®¤é˜»å¡IO true socketChannel.configureBlocking(false); socketChannel.connect(new InetSocketAddress(&quot;localhost&quot;, 8080)); // finishConnectçš„ä¸»è¦ä½œç”¨å°±æ˜¯ç¡®è®¤é€šé“è¿æ¥å·²å»ºç«‹ï¼Œæ–¹ä¾¿åç»­IOæ“ä½œï¼ˆè¯»å†™ï¼‰ä¸ä¼šå› è¿æ¥æ²¡å»ºç«‹è€Œå¯¼è‡´NotYetConnectedExceptionå¼‚å¸¸ã€‚ if (socketChannel.isConnectionPending()) &#123; // finishConnectä¸€ç›´é˜»å¡åˆ°connectå»ºç«‹å®Œæˆ socketChannel.finishConnect(); &#125; ByteBuffer byteBuffer = ByteBuffer.allocate(1024); byteBuffer.put(&quot;hello world&quot;.getBytes()); byteBuffer.flip(); socketChannel.write(byteBuffer); byteBuffer.clear(); int r = socketChannel.read(byteBuffer); // éé˜»å¡æ–¹æ³• byteBufferçš„æ•°æ®è¿˜æ˜¯ä¸Šé¢putçš„ if (r &gt; 0) &#123; System.out.println(&quot;get msg:&#123;&#125;&quot; + new String(byteBuffer.array())); &#125; else &#123; System.out.println(&quot;server no back&quot;); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125;","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"Java-NIOæ ¸å¿ƒç»„ä»¶--selector","date":"2021-07-28T09:51:30.000Z","path":"wiki/Java-NIOæ ¸å¿ƒç»„ä»¶-selector/","text":"å¤šè·¯å¤ç”¨å™¨select1ã€selecté€‰æ‹©å™¨ä¼šå‘Šè¯‰å®¢æˆ·ç«¯å“ªäº›è¿æ¥æœ‰æ•°æ®è¦è¯»å–ï¼Œä½†æ˜¯è¯»å–çš„æ“ä½œè¿˜æ˜¯ç”¨æˆ·è‡ªå·±è§¦å‘çš„ï¼Œè¿™ç§å«åšã€ŒåŒæ­¥ã€ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package com.ibli.javaBase.nio;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.*;import java.util.Iterator;import java.util.Set;/** * @Author gaolei * @Date 2021/4/3 4:09 ä¸‹åˆ * @Version 1.0 */public class SelectMultiple &#123; private ServerSocketChannel server = null; private Selector selector = null; int port = 9090; public void initServer() throws IOException &#123; server = ServerSocketChannel.open(); server.configureBlocking(false); server.bind(new InetSocketAddress(port)); server.register(selector, SelectionKey.OP_ACCEPT); &#125; public void start() throws IOException &#123; initServer(); System.err.println(&quot;server started ....&quot;); while (true) &#123; // selector.select() è°ƒç”¨ç³»ç»Ÿå†…æ ¸çš„select while (selector.select() &gt; 0) &#123; // ä»å¤šè·¯å¤ç”¨å™¨ä¸­é€‰æ‹©æœ‰æ•ˆçš„key Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iter = selectionKeys.iterator(); while (iter.hasNext()) &#123; SelectionKey key = iter.next(); if (key.isAcceptable()) &#123; acceptHandle(key); &#125; else if (key.isReadable()) &#123; readHandle(key); &#125; &#125; &#125; &#125; &#125; public void acceptHandle(SelectionKey key) throws IOException &#123; ServerSocketChannel ssc = (ServerSocketChannel) key.channel(); SocketChannel client = ssc.accept(); client.configureBlocking(false); ByteBuffer byteBuffer = ByteBuffer.allocateDirect(1024); client.register(selector, SelectionKey.OP_READ, byteBuffer); System.err.println(&quot;client arrived &quot; + client.getRemoteAddress()); &#125; public void readHandle(SelectionKey key) throws IOException &#123; SocketChannel client = (SocketChannel) key.channel(); ByteBuffer buffer = (ByteBuffer) key.attachment(); buffer.clear(); int read = 0; while (true) &#123; read = client.read(buffer); if (read &gt; 0) &#123; // æœåŠ¡ç«¯è¯»åˆ°çš„æ•°æ®ï¼Œå†å†™ä¸€éç»™åˆ°å®¢æˆ·ç«¯ buffer.flip(); while (buffer.hasRemaining()) &#123; client.write(buffer); &#125; buffer.clear(); &#125; else if (read == 0) &#123; break; &#125; else &#123; // client å‘ç”Ÿé”™è¯¯ æˆ–è€…æ–­å¼€ read == -1 // å¯¼è‡´ç©ºè½¬ æœ€ç»ˆCPUè¾¾åˆ°100% client.close(); break; &#125; &#125; &#125;&#125; ä¸Šé¢çš„å†™æ³•æ˜¯ä¸€ä¸ªselectoræ—¢æ‹…ä»»bossåˆæ‹…ä»»worker","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"Java-NIOæ ¸å¿ƒç»„ä»¶--buffer","date":"2021-07-28T09:51:10.000Z","path":"wiki/Java-NIOæ ¸å¿ƒç»„ä»¶-buffer/","text":"Buffer è¯»å†™NIOä¹‹BufferBufferä½œä¸ºNIOä¸‰å¤§æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œä»¥åŠä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªbyte[]æ•°æ®,åªæ˜¯åœ¨NIOä¸­è¢«å°è£…æˆäº†NIO Bufferå¯¹è±¡å¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•æ¥è®¿é—®è¿™ä¸ªå†…å­˜å—ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Demo123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475// è¯»å–ä¸€ä¸ªtext.txtæ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„text1.txtæ–‡ä»¶public class FirstNioDemo &#123; public static void main(String[] args) throws IOException &#123; FileInputStream fileInputStream = new FileInputStream(&quot;/Users/gaolei/Desktop/text.txt&quot;); FileOutputStream fileOutputStream = new FileOutputStream(&quot;/Users/gaolei/Desktop/text1.txt&quot;); FileChannel inChannel = fileInputStream.getChannel(); FileChannel outChannel = fileOutputStream.getChannel(); // å£°æ˜ç¼“å†²åŒºå¤§å°ä¸º1024å­—èŠ‚ ByteBuffer byteBuffer = ByteBuffer.allocate(1024); // ä»é€šé“ä¸­è¯»å–æ•°æ® inChannel.read(byteBuffer); // è¯»æ¨¡å¼åˆ‡æ¢ä¸ºå†™æ¨¡å¼ byteBuffer.flip(); //æŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“ outChannel.write(byteBuffer); // æ•°æ®å†™å®Œä¹‹åæ¸…ç©ºå…¨éƒ¨ç¼“å†²åŒº byteBuffer.clear(); //å…³é—­æ–‡ä»¶æµ fileInputStream.close(); fileOutputStream.close(); &#125;&#125;``` &gt; æ‰§è¡Œç»“æœï¼šç”Ÿæˆ/Users/gaolei/Desktop/text1.txtæ–‡ä»¶ **Bufferè¿›è¡Œæ•°æ®è¯»å†™æ“ä½œçš„ä¸€èˆ¬æ­¥éª¤** 1ã€å†™å…¥æ•°æ®åˆ°Buffer 2ã€è°ƒç”¨flip()æ–¹æ³• 3ã€ä»Bufferä¸­è¯»å–æ•°æ® 4ã€è°ƒç”¨clear()æ–¹æ³•æˆ–è€…compact()æ–¹æ³• &gt; clear()æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚compact()æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ·å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚ ### Bufferä¸‰ä¸ªæ ¸å¿ƒçš„å±æ€§ - capacity å®¹é‡ ä¸bufferå¤„åœ¨ä»€ä¹ˆæ¨¡å¼æ— å…³- position æ¸¸æ ‡ä½ç½® æŒ‡å‘ä¸‹ä¸€ä¸ªå­˜æ”¾/è¯»å–æ•°æ®çš„ä½ç½® èŒƒå›´ï¼ˆ0 ï½ capacityâ€“1ï¼‰- limit ### è¯»å†™æ“ä½œä¸­Bufferä¸‰å¤§å±æ€§çš„å˜åŒ–åˆå§‹çŠ¶æ€ &lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-71f90dfd671f80eb9f6142f135b7c2dfc92.png&quot; height=&quot;230&quot; width=&quot;395&quot;&gt; ç¬¬ä¸€æ¬¡è¯»å–æ•°æ® positionå¤„äºèµ·å§‹ä½ç½®ï¼Œlimitå’Œcapacityéƒ½å¤„äºç»“å°¾ &lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-41b47d9e54d58c7b39caf9e514fc9b5261f.png&quot; height=&quot;230&quot; width=&quot;395&quot;&gt; ç¬¬äºŒæ¬¡è¯»å–æ•°æ® &lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-07f3d1aa1f886b592b386cd4d846810911d.png&quot; height=&quot;230&quot; width=&quot;395&quot;&gt; å½“å†™æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨flipæ–¹æ³•ï¼š å½“å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œpositionä¼šè¢«é‡ç½®ä¸º0. å½“ä»Bufferçš„positionå¤„è¯»å–æ•°æ®æ—¶ï¼Œpositionå‘å‰ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯è¯»çš„ä½ç½®ã€‚ å½“åˆ‡æ¢Bufferåˆ°è¯»æ¨¡å¼æ—¶ï¼Œ limitè¡¨ç¤ºä½ æœ€å¤šèƒ½è¯»åˆ°å¤šå°‘æ•°æ®ã€‚å› æ­¤ï¼Œå½“åˆ‡æ¢Bufferåˆ°è¯»æ¨¡å¼æ—¶ï¼Œlimitä¼šè¢«è®¾ç½®æˆå†™æ¨¡å¼ä¸‹çš„positionå€¼ã€‚æ¢å¥è¯è¯´ï¼Œä½ èƒ½è¯»åˆ°ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimitè¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯positionï¼‰ &lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-b9323701bbb34a6c12f61d5ac2652ab7eeb.png&quot; height=&quot;230&quot; width=&quot;395&quot;&gt; Clearæ–¹æ³• &lt;img src=&quot;https://oscimg.oschina.net/oscnet/up-71f90dfd671f80eb9f6142f135b7c2dfc92.png&quot; height=&quot;230&quot; width=&quot;395&quot;&gt; ### JAVA NIOä¸‹çš„Bufferåˆ†ç±»- ByteBuffer- MappedByteBuffer- CharBuffer- DoubleBuffer- FloatBuffer- IntBuffer- LongBuffer- ShortBuffer&gt; JavaåŸºæœ¬ç±»å‹é™¤äº†å¸ƒå°”ç±»å‹ï¼Œéƒ½æœ‰å…¶å¯¹åº”çš„Buffer ### ByteBufferä½¿ç”¨&gt; ä¸‹é¢ä»¥ByteBufferä¸ºä¾‹å­çœ‹ä¸€ä¸‹Bufferå¦‚ä½•ä½¿ç”¨```java// åˆ›å»ºä¸€ä¸ªbyteBufferï¼Œè®¾ç½®å®¹é‡ä¸º1024å­—èŠ‚ByteBuffer byteBuffer = ByteBuffer.allocate(1024); 1ã€å¦‚ä¸‹ä»£ç ï¼Œå…¶å®è°ƒç”¨äº†new HeapByteBuffer(capacity, capacity)æ¥åˆ›å»ºä¸€ä¸ªbuffer 12345public static ByteBuffer allocate(int capacity) &#123; if (capacity &lt; 0) throw new IllegalArgumentException(); return new HeapByteBuffer(capacity, capacity); &#125; 2ã€åˆ›å»ºäº†bufferä¹‹åè¦å¾€é‡Œé¢å†™æ•°æ®ï¼Œé™¤äº†ä¸Šé¢ä»channelä¸­è¯»å–æ•°æ®ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è°ƒç”¨putæ–¹æ³•,å¦‚ä¸‹ 12ByteBuffer byteBuffer = ByteBuffer.allocate(1024);byteBuffer.put(&quot;hello world&quot;.getBytes()); 3ã€å¦‚æœå†™å°†bufferä¸­çš„æ•°æ®å†™å‡ºå»ï¼Œå¿…é¡»å…ˆè°ƒç”¨flapæ–¹æ³• flipæ–¹æ³•å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚è°ƒç”¨flip()æ–¹æ³•ä¼šå°†positionè®¾å›0ï¼Œå¹¶å°†limitè®¾ç½®æˆä¹‹å‰positionçš„å€¼ã€‚ 4ã€å°†æ•°æ®å†™åˆ°é€šé“ä¸­ inChannel.write(buf); 5ã€æ•°æ®å†™å‡ºåˆ°é€šé“ä¹‹åï¼Œè¦å°†ç¼“å­˜æ¸…ç©ºï¼Œä¸€èˆ¬è°ƒç”¨clearæ–¹æ³•clearæ–¹æ³• 12345678public final Buffer clear() &#123; //positionå°†è¢«è®¾å›0 position = 0; //limitè¢«è®¾ç½®æˆ capacityçš„å€¼ limit = capacity; mark = -1; return this; &#125; Bufferä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œå¼€å§‹å¾€Bufferé‡Œå†™æ•°æ®ã€‚compactæ–¹æ³•å¦‚æœBufferä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨compact()æ–¹æ³•ã€‚ 1234567891011public ByteBuffer compact() &#123; //compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferèµ·å§‹å¤„ã€‚ System.arraycopy(hb, ix(position()), hb, ix(0), remaining()); //positionè®¾åˆ°æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ position(remaining()); //limitå±æ€§è®¾ç½®æˆcapacity limit(capacity()); discardMark(); return this; &#125;ç°åœ¨Bufferå‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ® é›¶æ‹·è´åŸç†â€“ é›¶æ‹·è´ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦é›¶æ‹·è´æ˜¯åœ¨kafkaçš„æ•°æ®å­˜å‚¨éƒ¨åˆ†â€“IOæµç¨‹ï¼šå†…å­˜æ˜ å°„ç¼“å†²åŒºæ¯”æ™®é€šIOæ“ä½œæ–‡ä»¶å¿«å¾ˆå¤šï¼Œç”šè‡³æ¯”channelè¿˜è¦å¿«å¾ˆå¤šã€‚å› ä¸ºé¿å…äº†å¾ˆå¤šç³»ç»Ÿè°ƒç”¨ï¼ˆSystem.read System.writeï¼‰ã€‚å‡å°‘äº†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºã€‚ ä¸¾ä¸ªæ —å­ï¼š 123456789101112public static void main(String[] args) throws IOException &#123; FileChannel in = FileChannel.open(Paths.get(&quot;/Users/gaolei/Desktop/text.txt&quot;), StandardOpenOption.READ); FileChannel out = FileChannel.open(Paths.get(&quot;/Users/gaolei/Desktop/text1.txt&quot;), StandardOpenOption.READ, StandardOpenOption.CREATE, StandardOpenOption.WRITE); MappedByteBuffer inBuffer = in.map(FileChannel.MapMode.READ_ONLY, 0, in.size()); MappedByteBuffer outBuffer = out.map(FileChannel.MapMode.READ_WRITE, 0, in.size()); byte[] bytes = new byte[inBuffer.limit()]; inBuffer.get(bytes); outBuffer.put(bytes); in.close(); out.close(); &#125; æ™®é€šçš„ç½‘ç»œIOæ‹·è´æµç¨‹1ã€é¦–å…ˆç³»ç»Ÿä»ç£ç›˜ä¸Šæ‹·è´æ–‡ä»¶åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒº2ã€ç„¶ååœ¨å†…æ ¸ç©ºé—´æ‹·è´æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´3ã€ç¬¬ä¸‰æ¬¡ï¼Œç”¨æˆ·ç¼“å†²åŒºå†å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸éƒ¨åˆ†çš„socketç¼“å†²4ã€å†…æ ¸åœ¨å°†å­˜å‚¨åœ¨socketç¼“å†²åŒºçš„æ•°æ®æ‹·è´å¹¶å‘é€åˆ°ç½‘å¡ç¼“å†²åŒºä»¥ä¸Šä¸€ä¸ªå¸¸è§„çš„ç½‘ç»œIOç»å†äº†4æ¬¡æ•°æ®æ‹·è´ï¼› è®¾ç½®ç¼“å†²åŒºçš„æ„ä¹‰åœ¨äºæå‡æ€§èƒ½ï¼Œå½“ç”¨æˆ·ç©ºé—´ä»…ä»…éœ€è¦ä¸€å°éƒ¨åˆ†æ•°æ®çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨ç£ç›˜ä¸Šè¯»å–ä¸€å—æ•°æ®æ–¹æ³•å†…æ ¸ç¼“å†²åŒºï¼Œè¿™ä¸ªå«åšå±€éƒ¨æ€§åŸç†ã€‚ é›¶æ‹·è´å‡å»äº†å†…æ ¸ç©ºé—´æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´æ•°æ®çš„æ‹·è´ï¼Œä»è€Œæå‡IOæ€§èƒ½ã€‚å‡è®¾è¯»å–çš„æ–‡ä»¶å¾ˆå¤§ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è¯»å–ç£ç›˜å¤§é‡æ•°æ®åˆ°å†…æ ¸ç©ºé—´ï¼Œè¿™æ—¶å€™å†…æ ¸ç¼“å†²åŒºçš„ä½œç”¨æ˜¯å¾ˆéš¾ä½“ç°çš„ã€‚å› ä¸ºå¦‚æœç”¨æˆ·ç©ºé—´éœ€è¦å°‘é‡æ•°æ®çš„æ—¶å€™æ˜¯å¯ä»¥ç›´æ¥åœ¨å†…æ ¸ç©ºé—´è·å–çš„ï¼ˆå±€éƒ¨æ€§åŸç†ï¼‰ã€‚æ­£å¼å› ä¸ºæœ‰äº†é›¶æ‹·è´ï¼Œæ“ä½œç³»ç»Ÿåœ¨ç£ç›˜è¯»å–æ•°æ®ä¹‹åï¼Œå¯ä»¥ç›´æ¥å‘é€åˆ°ç½‘å¡ç¼“å†²åŒºï¼Œä»è€Œå¤§å¤§æå‡IOæ€§èƒ½ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"Java-NIO","date":"2021-07-28T09:50:38.000Z","path":"wiki/Java-NIO/","text":"Java NIO Java NIO å¯¹äºJava BIOçš„ä¼˜åŒ– Java éé˜»å¡IO åŠæ—¶ä¸ä½¿ç”¨çº¿ç¨‹æ± ï¼Œä¹Ÿå¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ 12345678910111213141516171819202122232425262728293031323334353637383940public static void main(String[] args) throws IOException, InterruptedException &#123; LinkedList&lt;SocketChannel&gt; clients = new LinkedList&lt;&gt;(); ServerSocketChannel ss = ServerSocketChannel.open(); ss.bind(new InetSocketAddress(9090)); ss.configureBlocking(false); while (true) &#123; Thread.sleep(1000L); // éé˜»å¡ SocketChannel client = ss.accept(); if (client == null) &#123; System.err.println(&quot;client is null&quot;); &#125; else &#123; client.configureBlocking(false); int port = client.socket().getPort(); System.err.println(&quot;client port &quot; + port); clients.add(client); &#125; ByteBuffer byteBuffer = ByteBuffer.allocateDirect(4096); // ä¸²å‹è¯ // çœŸå®åœºæ™¯ä¸‹ æ¯ä¸€ä¸ªclientä¸€ä¸ªç‹¬è‡ªçš„buffer for (SocketChannel c : clients) &#123; // -1 å‡ºç°ç©ºè½®è®­ int num = c.read(byteBuffer); if (num &gt; 0) &#123; byteBuffer.flip(); byte[] aaa = new byte[byteBuffer.limit()]; byteBuffer.get(aaa); String b = new String(aaa); System.err.println(c.socket().getPort() + &quot; : &quot; + b); // æ¸…ç©º å¾ªç¯ä¸‹ä¸€æ¬¡clientåœ¨ä½¿ç”¨ byteBuffer.clear(); &#125; &#125; &#125;&#125; ä»¥ä¸Šå¯ä»¥å®ç°ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯é“¾æ¥ï¼ŒæœåŠ¡ç«¯éé˜»å¡æ¥æ”¶ï¼Œæ¥æ”¶ä¹‹åï¼Œè¯»å–æ•°æ®ä¹Ÿæ˜¯éé˜»å¡çš„ï¼› NIOçš„éé˜»å¡æ˜¯æ“ä½œç³»ç»Ÿå†…éƒ¨å®ç°çš„ï¼Œåº•å±‚è°ƒç”¨äº†linuxå†…æ ¸çš„acceptå‡½æ•° d Javaçš„NIOæœ‰ä»€ä¹ˆå¼Šç«¯ æœåŠ¡ç«¯è¿˜æ˜¯ä¼šè¿›è¡Œç©ºè½¬ ä¸ç®¡æœ‰æ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥å»ºç«‹ï¼ŒæœåŠ¡ç«¯éƒ½è¦ä¸æ–­æ‰§è¡Œacceptæ–¹æ³• ä¸ç®¡å®¢æˆ·ç«¯è¿æ¥æœ‰æ²¡æœ‰ä¼ è¾“æ•°æ®ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€éreadæ“ä½œ èµ„æºæµªè´¹é—®é¢˜ è¿˜æ˜¯ä¼šå­˜åœ¨C10kçš„é—®é¢˜","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"Java-ä¼ ç»Ÿçš„BIO","date":"2021-07-28T09:50:21.000Z","path":"wiki/Java-ä¼ ç»Ÿçš„BIO/","text":"ä¼ ç»Ÿçš„BIOSocket å’Œ ServerSocket1234567891011121314151617public static void main(String[] args) throws IOException &#123; ServerSocket serverSocket = new ServerSocket(9090); // é˜»å¡ Socket client = serverSocket.accept(); InputStream inputStream = client.getInputStream(); BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream)); // è¯»é˜»å¡ System.err.println(bufferedReader.readLine()); while (true)&#123; &#125; &#125; new ServerSocket(9090); è¿™ä¸ªjavaç¨‹åºåˆ›å»ºnew ServerSocket(9090);ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚linuxæ“ä½œç³»ç»Ÿï¼Œåº”ç”¨è¿›ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaè¿›ç¨‹ï¼Œä¼šè°ƒç”¨linuxçš„å†…æ ¸æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªsocketï¼Œåœ¨linuxç³»ç»Ÿä¸­å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦fdï¼Œæœ€ç»ˆå¯¹å¾—åˆ°ï¼š 123socket() = XXfdbind(XXfd,9090)listen(XXfd) socket çš„readæ–¹æ³• ï¼Œè¯»å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸€ç›´é˜»å¡ serverSocketçš„acceptæ–¹æ³•ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„é“¾æ¥ï¼Œå¦‚æœæ²¡æœ‰é“¾æ¥ï¼Œåˆ™ä¸€ç›´é˜»å¡ç­‰å¾… serverSocket ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ BIOç¨‹åºæœ‰å“ªäº›å¼Šç«¯ï¼Ÿ æœåŠ¡ç«¯ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å‘éå¸¸ä½ æ²¡æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸€ç›´é˜»å¡ï¼Œå ç”¨èµ„æº å¦‚æœåœ¨bioçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Ÿ d C10Ké—®é¢˜ æ¥ä¸€ä¸ªé“¾æ¥ï¼ŒæœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ ï¼Œå»å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ç»§ç»­ç›‘å¬å®¢æˆ·ç«¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¢åŠ å¹¶å‘ï¼Ÿæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ çº¿ç¨‹æ¶ˆè€—å†…å­˜èµ„æº å¦‚æœä¸€ä¸‹å­è¿‡æ¥10ä¸‡ä¸ªè¯·æ±‚å‘¢ï¼ŸæœåŠ¡å™¨è¦åˆ›å»º10ä¸‡ä¸ªçº¿ç¨‹ï¼Œå†…å­˜å°±å´©äº†ã€‚ å¦‚æœæä¸€ä¸ªçº¿ç¨‹æ± å‘¢ï¼Ÿ å¹¶å‘åº¦æœ€å¤§ä¸ºæœ€å¤§çº¿ç¨‹æ•°ï¼Ÿ å¹¶å‘åº¦å·²ç»å®šæ­»äº†ï¼Ÿ","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"JVM-jstat","date":"2021-07-28T09:46:25.000Z","path":"wiki/JVM-jstat/","text":"jstatjstatæ˜¯ä¸€ä¸ªç®€å•çš„å®ç”¨å·¥å…·ï¼Œåœ¨JDKä¸­å­˜åœ¨ï¼Œç”¨äºæä¾›ä¸JVMæ€§èƒ½ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚åƒåœ¾æ”¶é›†ï¼Œç¼–è¯‘æ´»åŠ¨ã€‚ jstatçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒJVMä¸”æ— éœ€ä»»ä½•å…ˆå†³æ¡ä»¶çš„æƒ…å†µä¸‹åŠ¨æ€æ•è·è¿™äº›æŒ‡æ ‡ã€‚ è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ ä¾‹å¦‚ï¼Œå¦‚æœè¦æ•è·ä¸åƒåœ¾å›æ”¶ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåˆ™éœ€è¦åœ¨å¯åŠ¨JVMä¹‹å‰ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š -Xlog:gc*:file={file-path} æ­¤å‚æ•°å°†å¯ç”¨GCæ—¥å¿—å¹¶å°†å…¶æ‰“å°åœ¨æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ä¸­ã€‚ å‡è®¾æ‚¨å°šæœªä¼ é€’æ­¤å‚æ•°ï¼Œé‚£ä¹ˆå°†ä¸ä¼šç”Ÿæˆä¸GCç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ è¿™æ˜¯jstatå¯ä»¥æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚ æ‚¨å¯ä»¥åŠ¨æ€åœ°è¿æ¥åˆ°JVMå¹¶æ•è·GCï¼Œç¼–è¯‘ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚ jstatæ“ä½œæ‰§è¡Œå‘½ä»¤ï¼š 1jstat -gc -t 11656 10000 30 -gc ï¼šå°†æ˜¾ç¤ºä¸åƒåœ¾æ”¶é›†ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ è‡ªJVMå¯åŠ¨ä»¥æ¥çš„-tæ—¶é—´æˆ³å°†è¢«æ‰“å° 11656ï¼šç›®æ ‡JVMè¿›ç¨‹ID 10000ï¼šæ¯10,000æ¯«ç§’ï¼ˆå³10ç§’ï¼‰å°†æ‰“å°ä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯ã€‚ 30 ï¼šå°†æ‰“å°30æ¬¡è¿­ä»£çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ å› æ­¤ï¼Œä»¥ä¸Šé€‰é¡¹å°†å¯¼è‡´JVMæ‰“å°æŒ‡æ ‡300ç§’ï¼ˆå³10ç§’x 30æ¬¡è¿­ä»£ï¼‰ã€‚ ï¼ˆè¯·æ³¨æ„ï¼Œé™¤äº†-gcä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¼ é€’å…¶ä»–å„ç§é€‰é¡¹æ¥ç”Ÿæˆä¸åŒçš„æ•°æ®é›†ã€‚æœ‰å…³ä¸åŒé€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ­¤å¤„ ã€‚ï¼‰æ‰“å°ç»“æœï¼š 1234Timestamp S0C S1C S0U S1U EC EU OC OU MC MU CCSC CCSU YGC YGCT FGC FGCT GCT 34486.1 1536.0 1536.0 0.0 878.8 226816.0 132809.2 218112.0 113086.4 120664.0 111284.9 14464.0 12928.3 355 3.523 6 1.126 4.649 34496.3 1536.0 1536.0 0.0 878.8 226816.0 138030.9 218112.0 113086.4 120664.0 111284.9 14464.0 12928.3 355 3.523 6 1.126 4.649 34506.3 1536.0 1536.0 0.0 878.8 226816.0 195648.1 218112.0 113086.4 120664.0 111284.9 14464.0 12928.3 355 3.523 6 1.126 4.649 å­—æ®µè§£è¯»S0C â€“å¹¸å­˜è€…0åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½ S1C â€“å¹¸å­˜è€…1åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½ S0U â€“å¹¸å­˜è€…0åŒºåŸŸä½¿ç”¨çš„ç©ºé—´ä»¥KBä¸ºå•ä½ S1U â€“å¹¸å­˜è€…1åŒºåŸŸä»¥KBä¸ºå•ä½ä½¿ç”¨ç©ºé—´ EC â€“ä¼Šç”¸å›­åœ°åŒºå®¹é‡ï¼ˆKBï¼‰ æ¬§ç›Ÿâ€“ä¼Šç”¸å›­åœ°åŒºçš„å·²åˆ©ç”¨ç©ºé—´ï¼ˆä»¥KBä¸ºå•ä½ï¼‰ OC â€“æ—§åŒºåŸŸå®¹é‡ï¼ˆKBï¼‰ OU â€“æ—§åŒºåŸŸçš„å·²åˆ©ç”¨ç©ºé—´ï¼Œä»¥KBä¸ºå•ä½ MC â€“å…ƒç©ºé—´åŒºåŸŸå®¹é‡ï¼Œä»¥KBä¸ºå•ä½ MU â€“å…ƒç©ºé—´åŒºåŸŸä½¿ç”¨çš„ç©ºé—´ä»¥KBä¸ºå•ä½ CCSC â€“å‹ç¼©ç±»ç©ºé—´åŒºåŸŸçš„å®¹é‡ï¼Œä»¥KBä¸ºå•ä½ CCSU â€“å‹ç¼©ç±»ç©ºé—´åŒºåŸŸä»¥KBä¸ºå•ä½ä½¿ç”¨ç©ºé—´ YGC â€“è¿„ä»Šä¸ºæ­¢å‘ç”Ÿçš„å¹´è½»GCäº‹ä»¶çš„æ•°é‡ YGCT â€“åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¹´è½»GCèŠ±è´¹çš„æ—¶é—´ FGC â€“è¿„ä»Šä¸ºæ­¢å·²å‘ç”Ÿçš„å®Œå…¨GCäº‹ä»¶çš„æ•°é‡ FGCT â€“åˆ°ç›®å‰ä¸ºæ­¢å·²èŠ±è´¹çš„å®Œæ•´GCæ—¶é—´ GCT â€“åˆ°ç›®å‰ä¸ºæ­¢æ‰€èŠ±è´¹çš„GCæ—¶é—´æ€»é‡ï¼ˆåŸºæœ¬ä¸Šæ˜¯YGCT + FGCTï¼‰ å‚è€ƒèµ„æ–™jstatåˆ†æ_jstat â€“åˆ†æ","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"JVM-jstack","date":"2021-07-28T09:46:12.000Z","path":"wiki/JVM-jstack/","text":"jstackjstack åŠŸèƒ½ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªåŠŸèƒ½ï¼š aï¼ é’ˆå¯¹æ´»ç€çš„è¿›ç¨‹åšæœ¬åœ°çš„æˆ–è¿œç¨‹çš„çº¿ç¨‹dumpï¼› bï¼ é’ˆå¯¹coreæ–‡ä»¶åšçº¿ç¨‹dumpã€‚ jstackç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰javaè™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰ã€‚ çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯, å¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ jstack æ“ä½œæ–¹å¼ jps -l | grep keyword -&gt; pidjstack pid jstackç»“æœå¦‚ä¸‹ï¼› 123456789101112131415161718&quot;lettuce-nioEventLoop-4-1&quot; #639 daemon prio=5 os_prio=0 tid=0x00007ff27025d800 nid=0x258f runnable [0x00007ff262af7000] java.lang.Thread.State: RUNNABLE at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method) at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269) at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93) at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86) - locked &lt;0x000000008988d6a8&gt; (a io.netty.channel.nio.SelectedSelectionKeySet) - locked &lt;0x000000008988d770&gt; (a java.util.Collections$UnmodifiableSet) - locked &lt;0x000000008988d600&gt; (a sun.nio.ch.EPollSelectorImpl) at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97) at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:101) at io.netty.channel.nio.SelectedSelectionKeySetSelector.select(SelectedSelectionKeySetSelector.java:68) at io.netty.channel.nio.NioEventLoop.select(NioEventLoop.java:803) at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:457) at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) at java.lang.Thread.run(Thread.java:748) å‚è€ƒèµ„æ–™åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/weixin_30013175/article/details/113901522","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"JVM-ç±»åŠ è½½æœºåˆ¶","date":"2021-07-28T09:45:58.000Z","path":"wiki/JVM-ç±»åŠ è½½æœºåˆ¶/","text":"ç±»åŠ è½½æœºåˆ¶1. ç±»åŠ è½½æœºåˆ¶å…·ä½“æµç¨‹ Java çš„ç±»åŠ è½½è¿‡ç¨‹å¯ä»¥åˆ†ä¸º 5 ä¸ªé˜¶æ®µï¼šè½½å…¥ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–ã€‚è¿™ 5 ä¸ªé˜¶æ®µä¸€èˆ¬æ˜¯é¡ºåºå‘ç”Ÿçš„ï¼Œä½†åœ¨åŠ¨æ€ç»‘å®šçš„æƒ…å†µä¸‹ï¼Œè§£æé˜¶æ®µå‘ç”Ÿåœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åã€‚ 1.1 Loadingï¼ˆè½½å…¥ï¼‰ JVM åœ¨è¯¥é˜¶æ®µçš„ä¸»è¦ç›®çš„æ˜¯å°†å­—èŠ‚ç ä»ä¸åŒçš„æ•°æ®æºï¼ˆå¯èƒ½æ˜¯ class æ–‡ä»¶ã€ä¹Ÿå¯èƒ½æ˜¯ jar åŒ…ï¼Œç”šè‡³ç½‘ç»œï¼‰è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„ java.lang.Class å¯¹è±¡ã€‚ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ¬¡ç±»çš„äºŒè¿›åˆ¶æµ(ZIP åŒ…ã€ç½‘ç»œã€è¿ç®—ç”Ÿæˆã€JSP ç”Ÿæˆã€æ•°æ®åº“è¯»å–)ã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•å»è¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚ æ•°ç»„ç±»çš„ç‰¹æ®Šæ€§ï¼šæ•°ç»„ç±»æœ¬èº«ä¸é€šè¿‡ç±»åŠ è½½å™¨åˆ›å»ºï¼Œå®ƒæ˜¯ç”± Java è™šæ‹Ÿæœºç›´æ¥åˆ›å»ºçš„ã€‚ä½†æ•°ç»„ç±»ä¸ç±»åŠ è½½å™¨ä»ç„¶æœ‰å¾ˆå¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºæ•°ç»„ç±»çš„å…ƒç´ ç±»å‹æœ€ç»ˆæ˜¯è¦é ç±»åŠ è½½å™¨å»åˆ›å»ºçš„ï¼Œæ•°ç»„åˆ›å»ºè¿‡ç¨‹å¦‚ä¸‹ï¼š å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£å°±é€’å½’é‡‡ç”¨ç±»åŠ è½½åŠ è½½ã€‚ å¦‚æœæ•°ç»„çš„ç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼ŒJava è™šæ‹Ÿæœºä¼šæŠŠæ•°ç»„æ ‡è®°ä¸ºå¼•å¯¼ç±»åŠ è½½å™¨å…³è”ã€‚ æ•°ç»„ç±»çš„å¯è§æ€§ä¸ä»–çš„ç»„ä»¶ç±»å‹çš„å¯è§æ€§ä¸€è‡´ï¼Œå¦‚æœç»„ä»¶ç±»å‹ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œé‚£æ•°ç»„ç±»çš„å¯è§æ€§å°†é»˜è®¤ä¸º publicã€‚ å†…å­˜ä¸­å®ä¾‹çš„ java.lang.Class å¯¹è±¡å­˜åœ¨æ–¹æ³•åŒºä¸­ã€‚ä½œä¸ºç¨‹åºè®¿é—®æ–¹æ³•åŒºä¸­è¿™äº›ç±»å‹æ•°æ®çš„å¤–éƒ¨æ¥å£ã€‚åŠ è½½é˜¶æ®µä¸è¿æ¥é˜¶æ®µçš„éƒ¨åˆ†å†…å®¹æ˜¯äº¤å‰è¿›è¡Œçš„ï¼Œä½†æ˜¯å¼€å§‹æ—¶é—´ä¿æŒå…ˆåé¡ºåºã€‚ 1.2 Verificationï¼ˆéªŒè¯ï¼‰JVM ä¼šåœ¨è¯¥é˜¶æ®µå¯¹äºŒè¿›åˆ¶å­—èŠ‚æµè¿›è¡Œæ ¡éªŒï¼Œåªæœ‰ç¬¦åˆ JVM å­—èŠ‚ç è§„èŒƒçš„æ‰èƒ½è¢« JVM æ­£ç¡®æ‰§è¡Œã€‚è¯¥é˜¶æ®µæ˜¯ä¿è¯ JVM å®‰å…¨çš„é‡è¦å±éšœï¼Œä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦çš„æ£€æŸ¥ã€‚ 1.2.1 æ–‡ä»¶æ ¼å¼éªŒè¯ æ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†… å¸¸é‡æ± çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒå¸¸é‡çš„ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡ tag æ ‡å¿—ï¼‰ æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ CONSTANT_Utf8_info å‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆ UTF8 ç¼–ç çš„æ•°æ® Class æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†é›†æ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„é™„åŠ çš„å…¶ä»–ä¿¡æ¯ â€¦â€¦ åªæœ‰é€šè¿‡è¿™ä¸ªé˜¶æ®µçš„éªŒè¯åï¼Œå­—èŠ‚æµæ‰ä¼šè¿›å…¥å†…å­˜çš„æ–¹æ³•åŒºè¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥åé¢ 3 ä¸ªéªŒè¯é˜¶æ®µå…¨éƒ¨æ˜¯åŸºäºæ–¹æ³•åŒºçš„å­˜å‚¨ç»“æ„è¿›è¡Œçš„ï¼Œä¸å†ç›´æ¥æ“ä½œå­—èŠ‚æµã€‚ 1.2.2 å…ƒæ•°æ®éªŒè¯ è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤ java.lang.Object ä¹‹å¤–ï¼‰ è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆfinal ä¿®é¥°çš„ç±»ï¼‰ å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³• ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆè¦†ç›–çˆ¶ç±» final å­—æ®µã€å‡ºç°ä¸ç¬¦åˆè§„èŒƒçš„é‡è½½ï¼‰ è¿™ä¸€é˜¶æ®µä¸»è¦æ˜¯å¯¹ç±»çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œè¯­ä¹‰æ ¡éªŒï¼Œä¿è¯ä¸å­˜åœ¨ä¸ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ 1.2.3 å­—èŠ‚ç éªŒè¯ ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½é¥é…åˆå·¥ä½œï¼ˆä¸ä¼šå‡ºç°æŒ‰ç…§ long ç±»å‹è¯»ä¸€ä¸ª int å‹æ•°æ®ï¼‰ ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Š ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ï¼ˆå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹æ˜¯å®‰å…¨çš„ï¼Œåè¿‡æ¥ä¸åˆæ³•çš„ï¼‰ â€¦â€¦ è¿™æ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚è¿™ä¸ªé˜¶æ®µå¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä¿è¯æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚ 1.2.4 ç¬¦å·å¼•ç”¨éªŒè¯ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦åˆ›æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±» åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦æ–¹æ³•çš„å­—æ®µæè¿°ç¬¦ä»¥åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—® â€¦â€¦ æœ€åä¸€ä¸ªé˜¶æ®µçš„æ ¡éªŒå‘ç”Ÿåœ¨è¿…ç–¾å°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬åŒ–åŠ¨ä½œå°†åœ¨è¿æ¥çš„ç¬¬ä¸‰é˜¶æ®µâ€”â€”è§£æé˜¶æ®µä¸­å‘ç”Ÿã€‚ç¬¦å·å¼•ç”¨éªŒè¯å¯ä»¥çœ‹åšæ˜¯å¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒï¼Œè¿˜æœ‰ä»¥ä¸ŠæåŠçš„å†…å®¹ã€‚ç¬¦å·å¼•ç”¨çš„ç›®çš„æ˜¯ç¡®ä¿è§£æåŠ¨ä½œèƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯å°†æŠ›å‡ºä¸€ä¸ª java.lang.IncompatibleClass.ChangeError å¼‚å¸¸çš„å­ç±»ã€‚å¦‚ java.lang.IllegalAccessErrorã€java.lang.NoSuchFieldErrorã€java.lang.NoSuchMethodError ç­‰ã€‚ 1.3 Preparationï¼ˆå‡†å¤‡ï¼‰1.3.1 è®¾ç½®é»˜è®¤å€¼JVM ä¼šåœ¨è¯¥é˜¶æ®µå¯¹ç±»å˜é‡ï¼ˆä¹Ÿç§°ä¸ºé™æ€å˜é‡ï¼Œstatic å…³é”®å­—ä¿®é¥°çš„ï¼‰åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ï¼ˆå¯¹åº”æ•°æ®ç±»å‹çš„é»˜è®¤åˆå§‹å€¼ï¼Œå¦‚ 0ã€0Lã€nullã€false ç­‰ï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡å¦‚æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š 123public String chenmo = &quot;æ²‰é»˜&quot;;public static String wanger = &quot;ç‹äºŒ&quot;;public static final String cmower = &quot;æ²‰é»˜ç‹äºŒ&quot;; chenmo ä¸ä¼šè¢«åˆ†é…å†…å­˜ï¼Œè€Œ wanger ä¼šï¼›ä½† wanger çš„åˆå§‹å€¼ä¸æ˜¯â€œç‹äºŒâ€è€Œæ˜¯ nullã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œstatic final ä¿®é¥°çš„å˜é‡è¢«ç§°ä½œä¸ºå¸¸é‡ï¼Œå’Œç±»å˜é‡ä¸åŒã€‚å¸¸é‡ä¸€æ—¦èµ‹å€¼å°±ä¸ä¼šæ”¹å˜äº†ï¼Œæ‰€ä»¥ cmower åœ¨å‡†å¤‡é˜¶æ®µçš„å€¼ä¸ºâ€œæ²‰é»˜ç‹äºŒâ€è€Œä¸æ˜¯ nullã€‚ 1.3.2 å„ç§ç±»å‹é»˜è®¤å€¼ 1.4 Resolutionï¼ˆè§£æï¼‰è¯¥é˜¶æ®µå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ã€‚ **ç¬¦å·å¼•ç”¨** : ä»¥ä¸€ç»„ç¬¦å·ï¼ˆä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦åœ¨ä½¿ç”¨æ—¶èƒ½å¤Ÿæ— æ­§ä¹‰çš„å®šä½åˆ°ç›®æ ‡å³å¯ï¼‰æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ã€‚ **ç›´æ¥å¼•ç”¨** : ç›´æ¥å¼•ç”¨å¯ä»¥ä½¿ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚ç›´æ¥å¼•ç”¨å’Œè¿…ç–¾çš„å†…å­˜å¸ƒå±€å®ç°æœ‰å…³ åœ¨ç¼–è¯‘æ—¶ï¼ŒJava ç±»å¹¶ä¸çŸ¥é“æ‰€å¼•ç”¨çš„ç±»çš„å®é™…åœ°å€ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ç¬¦å·å¼•ç”¨æ¥ä»£æ›¿ã€‚æ¯”å¦‚ com.Wanger ç±»å¼•ç”¨äº† com.Chenmo ç±»ï¼Œç¼–è¯‘æ—¶ Wanger ç±»å¹¶ä¸çŸ¥é“ Chenmo ç±»çš„å®é™…å†…å­˜åœ°å€ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨ç¬¦å· com.Chenmoã€‚ ç›´æ¥å¼•ç”¨é€šè¿‡å¯¹ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æï¼Œæ‰¾åˆ°å¼•ç”¨çš„å®é™…å†…å­˜åœ°å€ã€‚ 1.5 Initializationï¼ˆåˆå§‹åŒ–ï¼‰è¯¥é˜¶æ®µæ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»è¢«èµ‹è¿‡é»˜è®¤åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œç±»å˜é‡å°†è¢«èµ‹å€¼ä¸ºä»£ç æœŸæœ›èµ‹çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•çš„è¿‡ç¨‹ã€‚ ohï¼Œnoï¼Œä¸Šé¢è¿™æ®µè¯è¯´å¾—å¾ˆæŠ½è±¡ï¼Œä¸å¥½ç†è§£ï¼Œå¯¹ä¸å¯¹ï¼Œæˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚ String cmower = new String(&quot;æ²‰é»˜ç‹äºŒ&quot;);ä¸Šé¢è¿™æ®µä»£ç ä½¿ç”¨äº† new å…³é”®å­—æ¥å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ String ç±»çš„æ„é€ æ–¹æ³•å¯¹ cmower è¿›è¡Œå®ä¾‹åŒ–ã€‚ 2. åŒäº²å§”æ´¾æœºåˆ¶èŠå®Œç±»åŠ è½½è¿‡ç¨‹ï¼Œå°±ä¸å¾—ä¸èŠèŠç±»åŠ è½½å™¨ã€‚ 2.1 ä»€ä¹ˆæ˜¯ç±»åŠ è½½ ä¸€èˆ¬æ¥è¯´ï¼ŒJava ç¨‹åºå‘˜å¹¶ä¸éœ€è¦ç›´æ¥åŒç±»åŠ è½½å™¨è¿›è¡Œäº¤äº’ã€‚JVM é»˜è®¤çš„è¡Œä¸ºå°±å·²ç»è¶³å¤Ÿæ»¡è¶³å¤§å¤šæ•°æƒ…å†µçš„éœ€æ±‚äº†ã€‚ä¸è¿‡ï¼Œå¦‚æœé‡åˆ°äº†éœ€è¦å’Œç±»åŠ è½½å™¨è¿›è¡Œäº¤äº’çš„æƒ…å†µï¼Œè€Œå¯¹ç±»åŠ è½½å™¨çš„æœºåˆ¶åˆä¸æ˜¯å¾ˆäº†è§£çš„è¯ï¼Œå°±ä¸å¾—ä¸èŠ±å¤§é‡çš„æ—¶é—´å»è°ƒè¯•ClassNotFoundException å’Œ NoClassDefFoundError ç­‰å¼‚å¸¸ã€‚ å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®å®šå…¶åœ¨ JVM ä¸­çš„å”¯ä¸€æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªç±»çš„åŠ è½½å™¨ä¸åŒï¼Œå³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ï¼ˆæ¯”å¦‚ä¸¤ä¸ªç±»çš„ Class å¯¹è±¡ä¸ equalsï¼‰ã€‚ ç«™åœ¨ç¨‹åºå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒJava ç±»åŠ è½½å™¨å¯ä»¥åˆ†ä¸ºä¸‰ç§ã€‚ 1ï¼‰å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap Class-Loaderï¼‰ï¼ŒåŠ è½½ jre/lib åŒ…ä¸‹é¢çš„ jar æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´å¸¸è§çš„ rt.jarã€‚ 2ï¼‰æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension or Ext Class-Loaderï¼‰ï¼ŒåŠ è½½ jre/lib/ext åŒ…ä¸‹é¢çš„ jar æ–‡ä»¶ã€‚ 3ï¼‰åº”ç”¨ç±»åŠ è½½å™¨ï¼ˆApplication or App Clas-Loaderï¼‰ï¼Œæ ¹æ®ç¨‹åºçš„ç±»è·¯å¾„ï¼ˆclasspathï¼‰æ¥åŠ è½½ Java ç±»ã€‚ æ¥æ¥æ¥ï¼Œé€šè¿‡ä¸€æ®µç®€å•çš„ä»£ç äº†è§£ä¸‹ã€‚ 1234567891011public class Test &#123; public static void main(String[] args) &#123; ClassLoader loader = Test.class.getClassLoader(); while (loader != null) &#123; System.out.println(loader.toString()); loader = loader.getParent(); &#125; &#125;&#125; æ¯ä¸ª Java ç±»éƒ½ç»´æŠ¤ç€ä¸€ä¸ªæŒ‡å‘å®šä¹‰å®ƒçš„ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œé€šè¿‡ ç±»å.class.getClassLoader() å¯ä»¥è·å–åˆ°æ­¤å¼•ç”¨ï¼›ç„¶åé€šè¿‡ loader.getParent() å¯ä»¥è·å–ç±»åŠ è½½å™¨çš„ä¸Šå±‚ç±»åŠ è½½å™¨ã€‚ è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š sun.misc.Launcher$AppClassLoader@73d16e93sun.misc.Launcher$ExtClassLoader@15db9742ç¬¬ä¸€è¡Œè¾“å‡ºä¸º Test çš„ç±»åŠ è½½å™¨ï¼Œå³åº”ç”¨ç±»åŠ è½½å™¨ï¼Œå®ƒæ˜¯ sun.misc.Launcher$AppClassLoader ç±»çš„å®ä¾‹ï¼›ç¬¬äºŒè¡Œè¾“å‡ºä¸ºæ‰©å±•ç±»åŠ è½½å™¨ï¼Œæ˜¯ sun.misc.Launcher$ExtClassLoader ç±»çš„å®ä¾‹ã€‚é‚£å¯åŠ¨ç±»åŠ è½½å™¨å‘¢ï¼Ÿ æŒ‰ç†è¯´ï¼Œæ‰©å±•ç±»åŠ è½½å™¨çš„ä¸Šå±‚ç±»åŠ è½½å™¨æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä½†åœ¨æˆ‘è¿™ä¸ªç‰ˆæœ¬çš„ JDK ä¸­ï¼Œ æ‰©å±•ç±»åŠ è½½å™¨çš„ getParent() è¿”å› nullã€‚æ‰€ä»¥æ²¡æœ‰è¾“å‡ºã€‚ 2.2 åŒäº²å§”æ´¾çš„æ„ä¹‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼ŒJavaç±»éšç€å®ƒçš„åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚æ¬¡æ¨¡å‹ï¼Œå¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œä¹Ÿå¯ä»¥é¿å…æ ¸å¿ƒç±»è¢«ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜ä¸­é€ æˆå†²çªå’Œæ··ä¹±ï¼Œä»è€Œä¿è¯äº†Javaæ ¸å¿ƒåº“çš„å®‰å…¨ã€‚ 3. ç±»åŠ è½½çš„åº”ç”¨https://juejin.cn/post/6931972267609948167 ç±»åŠ è½½ çƒ­éƒ¨ç½² åŠ å¯†ä¿æŠ¤ ä¾èµ–å†²çª 4. åŒäº²å§”æ´¾å¦‚ä½•ç ´åçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ https://enfangzhong.github.io/2019/12/17/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B9%8B%E7%A0%B4%E5%9D%8F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/ https://www.cnblogs.com/joemsu/p/9310226.html#_caption_2","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"JVM-jmap","date":"2021-07-28T09:45:41.000Z","path":"wiki/JVM-jmap/","text":"jmapå‘½ä»¤jmapæ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½çš„å‘½ä»¤ã€‚å®ƒå¯ä»¥ç”Ÿæˆ java ç¨‹åºçš„ dump æ–‡ä»¶ï¼Œ ä¹Ÿå¯ä»¥æŸ¥çœ‹å †å†…å¯¹è±¡ç¤ºä¾‹çš„ç»Ÿè®¡ä¿¡æ¯ã€æŸ¥çœ‹ ClassLoader çš„ä¿¡æ¯ä»¥åŠ finalizer é˜Ÿåˆ—ã€‚ jmap -heap pid1234567891011121314151617181920212223242526272829303132333435363738394041424344454647Attaching to process ID 7183, please wait...Debugger attached successfully.Server compiler detected.JVM version is 25.242-b08using thread-local object allocation.Parallel GC with 4 thread(s)Heap Configuration: MinHeapFreeRatio = 0 MaxHeapFreeRatio = 100 MaxHeapSize = 2051014656 (1956.0MB) NewSize = 42991616 (41.0MB) MaxNewSize = 683671552 (652.0MB) OldSize = 87031808 (83.0MB) NewRatio = 2 SurvivorRatio = 8 MetaspaceSize = 21807104 (20.796875MB) CompressedClassSpaceSize = 1073741824 (1024.0MB) MaxMetaspaceSize = 17592186044415 MB G1HeapRegionSize = 0 (0.0MB)Heap Usage:PS Young GenerationEden Space: capacity = 233308160 (222.5MB) used = 161611280 (154.12452697753906MB) free = 71696880 (68.37547302246094MB) 69.26945032698384% usedFrom Space: capacity = 1572864 (1.5MB) used = 899896 (0.8582077026367188MB) free = 672968 (0.6417922973632812MB) 57.213846842447914% usedTo Space: capacity = 1572864 (1.5MB) used = 0 (0.0MB) free = 1572864 (1.5MB) 0.0% usedPS Old Generation capacity = 223346688 (213.0MB) used = 115841432 (110.4749984741211MB) free = 107505256 (102.5250015258789MB) 51.866196466723515% used41772 interned Strings occupying 4324472 bytes. å‚è€ƒèµ„æ–™jvm æ€§èƒ½è°ƒä¼˜å·¥å…·ä¹‹ jmapJVMè°ƒè¯•å·¥å…·-jmapé€šè¿‡jstackä¸jmapåˆ†æä¸€æ¬¡çº¿ä¸Šæ•…éšœ","tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"}]},{"title":"SpringBeanå¾ªç¯ä¾èµ–","date":"2021-07-28T09:34:20.000Z","path":"wiki/SpringBeanå¾ªç¯ä¾èµ–/","text":"Spring Bean å¾ªç¯ä¾èµ–ä¸ºä»€ä¹ˆä¼šå­˜åœ¨å¾ªç¯ä¾èµ– å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼ŒAå¯¹è±¡çš„ä¸€ä¸ªå±æ€§æ˜¯B,Bå¯¹è±¡çš„ä¸€ä¸ªå±æ€§æ˜¯A,è€ŒSpringä¸­çš„beané»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯å•ä¾‹çš„\bï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªBeanå°±äº§ç”Ÿäº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼ é‚£ä¹ˆå¾ªç¯ä¾èµ–çš„é—®é¢˜å‡ºç°åœ¨ä»€ä¹ˆæƒ…å†µå‘¢ æƒ³ä¸€ä¸‹å±æ€§èµ‹å€¼çš„æ–¹å¼æœ‰å‡ ç§å‘¢ï¼Ÿ æ„é€ å™¨èµ‹å€¼ è¿™ç§å½¢å¼å¾ªç¯ä¾èµ–é—®é¢˜æ— æ³•è§£å†³ GET/SETæ–¹æ³• è°ƒç”¨SETæ–¹æ³•è¿›è¡Œèµ‹å€¼çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ä¸‰çº§ç¼“å­˜çš„ç­–ç•¥æ¥è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ æ‰€ä»¥ï¼Œä¸‰çº§ç¼“å­˜çš„ç­–ç•¥æ˜¯é’ˆå¯¹äºä½¿ç”¨SETæ–¹æ³•å¯¹å±æ€§èµ‹å€¼çš„åœºæ™¯ä¸‹çš„ï¼ å¾ªç¯ä¾èµ–å¦‚ä½•è§£å†³ åœ¨å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå°†å¤„äºåŠæˆå“çš„å¯¹è±¡å…¨éƒ¨æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œæ–¹ä¾¿åç»­æ¥è¿›è¡Œè°ƒç”¨ï¼›åªè¦æœ‰äº†å½“å‰å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œé‚£ä¹ˆåç»­æ¥è¿›è¡Œèµ‹å€¼å³å¯ï¼› d èƒ½ä¸èƒ½å°†åˆ›å»ºå¥½çš„å¯¹è±¡ä¹Ÿæ”¾åˆ°ç¼“å­˜ä¸­å‘¢ï¼Ÿ ä¸èƒ½ï¼Œå¦‚æœæ”¾åœ¨ä¸€èµ·å°†æ— æ³•åŒºåˆ†å¯¹è±¡æ˜¯æˆå“å¯¹è±¡è¿˜æ˜¯åŠæˆå“å¯¹è±¡äº†æ‰€ä»¥å†æ¬¡å¼•å‡ºå¤šçº§ç¼“å­˜çš„æ¦‚å¿µï¼Œå¯ä»¥åˆ›å»ºä¸¤ä¸ªç¼“å­˜å¯¹è±¡ï¼Œä¸€ä¸ªç”¨æ¥å­˜æ”¾å·²ç»å®ä¾‹åŒ–çš„åŠæˆå“å¯¹è±¡ï¼Œå¦ä¸€ä¸ªå­˜æ”¾å®Œæˆå®ä¾‹åŒ–å¹¶ä¸”å®Œæˆåˆå§‹åŒ–çš„æˆå“å¯¹è±¡ï¼Œè¿™ä¸ªåº”è¯¥æ¯”è¾ƒå¥½ç†è§£å§ï¼ æ€è€ƒä¸€ä¸‹ä»¥ä¸Šçš„è®¾è®¡æœ‰æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿ ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼ŸSpringåœ¨è§£å†³å¯¹è±¡Beanå¾ªç¯ä¾èµ–çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨äº†ã€Œä¸‰çº§ç¼“å­˜ã€ï¼›ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªMapå¯¹è±¡ï¼› org.springframework.beans.factory.support.DefaultSingletonBeanRegistry 123456// ä¸€çº§ç¼“å­˜private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap(256);// äºŒçº§ç¼“å­˜private final Map&lt;String, Object&gt; earlySingletonObjects = new HashMap(16);// ä¸‰çº§ç¼“å­˜private final Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = new HashMap(16); ä¸‰çº§ç¼“å­˜ä¸­åˆ†åˆ«ä¿å­˜çš„æ˜¯ä»€ä¹ˆå†…å®¹ ä¸€çº§ç¼“å­˜ï¼š æˆå“å¯¹è±¡ äºŒçº§ç¼“å­˜ï¼š åŠæˆå“å¯¹è±¡ ä¸‰çº§ç¼“å­˜ï¼› lambdaè¡¨è¾¾å¼ å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜å¯ä¸å¯è¡Œ åœ¨Springæºç ä¸­ï¼Œåªæœ‰addSingletonæ–¹æ³•å’ŒdoCreateBeanæ–¹æ³•ä¸­å‘ä¸‰çº§ç¼“å­˜ä¸­æ·»åŠ ä¸œè¥¿çš„ï¼› org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#addSingletonFactory 123456789protected void addSingleton(String beanName, Object singletonObject) &#123; synchronized(this.singletonObjects) &#123; this.singletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125; &#125; org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String, boolean) 1234567891011121314151617181920@Nullable protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null &amp;&amp; this.isSingletonCurrentlyInCreation(beanName)) &#123; synchronized(this.singletonObjects) &#123; singletonObject = this.earlySingletonObjects.get(beanName); if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; ObjectFactory&lt;?&gt; singletonFactory = (ObjectFactory)this.singletonFactories.get(beanName); if (singletonFactory != null) &#123; singletonObject = singletonFactory.getObject(); this.earlySingletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; return singletonObject; &#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; Assert.notNull(beanName, &quot;Bean name must not be null&quot;); synchronized(this.singletonObjects) &#123; Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; if (this.singletonsCurrentlyInDestruction) &#123; throw new BeanCreationNotAllowedException(beanName, &quot;Singleton bean creation not allowed while singletons of this factory are in destruction (Do not request a bean from a BeanFactory in a destroy method implementation!)&quot;); &#125; if (this.logger.isDebugEnabled()) &#123; this.logger.debug(&quot;Creating shared instance of singleton bean &#x27;&quot; + beanName + &quot;&#x27;&quot;); &#125; this.beforeSingletonCreation(beanName); boolean newSingleton = false; boolean recordSuppressedExceptions = this.suppressedExceptions == null; if (recordSuppressedExceptions) &#123; this.suppressedExceptions = new LinkedHashSet(); &#125; try &#123; singletonObject = singletonFactory.getObject(); newSingleton = true; &#125; catch (IllegalStateException var16) &#123; singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; throw var16; &#125; &#125; catch (BeanCreationException var17) &#123; BeanCreationException ex = var17; if (recordSuppressedExceptions) &#123; Iterator var8 = this.suppressedExceptions.iterator(); while(var8.hasNext()) &#123; Exception suppressedException = (Exception)var8.next(); ex.addRelatedCause(suppressedException); &#125; &#125; throw ex; &#125; finally &#123; if (recordSuppressedExceptions) &#123; this.suppressedExceptions = null; &#125; this.afterSingletonCreation(beanName); &#125; if (newSingleton) &#123; this.addSingleton(beanName, singletonObject); &#125; &#125; return singletonObject; &#125; &#125;","tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}],"categories":[{"name":"Spring Family","slug":"Spring-Family","permalink":"http://example.com/categories/Spring-Family/"},{"name":"Spring Framework","slug":"Spring-Family/Spring-Framework","permalink":"http://example.com/categories/Spring-Family/Spring-Framework/"}]},{"title":"SpringåŠ è½½é…ç½®æ–‡ä»¶åŸç†","date":"2021-07-28T09:33:48.000Z","path":"wiki/SpringåŠ è½½é…ç½®æ–‡ä»¶åŸç†/","text":"Springå¦‚ä½•åŠ è½½é…ç½®æ–‡ä»¶åˆ°åº”ç”¨ç¨‹åºåŠ è½½Xmlæ–‡ä»¶é…ç½®ï¼Œè·å–å¯¹è±¡ xmlæ–‡ä»¶ 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;user&quot; class=&quot;com.ibli.javaBase.reflection.User&quot;&gt; &lt;property name=&quot;age&quot; value=&quot;12&quot;/&gt; &lt;property name=&quot;name&quot; value=&quot;gaolei&quot;/&gt; &lt;property name=&quot;sex&quot; value=&quot;male&quot;/&gt; &lt;/bean&gt; &lt;/beans&gt; æµ‹è¯•ç±» 1234567public class IocDemo &#123; public static void main(String[] args) &#123; ApplicationContext ac = new ClassPathXmlApplicationContext(&quot;spring-ioc.xml&quot;); User user = (User) ac.getBean(&quot;user&quot;); System.out.println(user); &#125;&#125; Spring åŠ è½½Xmlæ–‡ä»¶æµç¨‹ é¦–å…ˆçŒœæƒ³ä¸€ä¸‹å®è§‚çš„æµç¨‹ æˆ‘ä»¬å¯ä»¥å¤§ä½“çŒœæƒ³æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå¦‚ä¸‹ğŸ‘‡ æ¥ä¸‹æ¥debugæºç çœ‹ä¸€ä¸‹å…·ä½“æµç¨‹ï¼š ClassPathXmlApplicationContextè°ƒç”¨refreshæ–¹æ³• 12345678public ClassPathXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent) throws BeansException &#123; super(parent); this.setConfigLocations(configLocations); if (refresh) &#123; // Spring å¯åŠ¨å…¥å£ this.refresh(); &#125; &#125; Spring å¯åŠ¨å…¥å£ this.refresh(); ğŸ‘† è°ƒç”¨AbstractRefreshableApplicationContextä¸‹çš„refreshBeanFactory org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory 1234567891011121314151617181920protected final void refreshBeanFactory() throws BeansException &#123; if (this.hasBeanFactory()) &#123; this.destroyBeans(); this.closeBeanFactory(); &#125; try &#123; DefaultListableBeanFactory beanFactory = this.createBeanFactory(); beanFactory.setSerializationId(this.getId()); this.customizeBeanFactory(beanFactory); // ä»è¿™é‡Œè¿›å…¥ä¸‹ä¸€æ­¥ ğŸ‘‡ this.loadBeanDefinitions(beanFactory); synchronized(this.beanFactoryMonitor) &#123; this.beanFactory = beanFactory; &#125; &#125; catch (IOException var5) &#123; throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + this.getDisplayName(), var5); &#125; &#125; å…³é”®æ–¹æ³•æ˜¯this.loadBeanDefinitions(beanFactory); æ‰¾åˆ°XmlBeanDefinitionReader è¿™æ˜¯è¯»å–é…ç½®çš„å…³é”®æ‰€åœ¨ å…³é”®å¯¹è±¡ XmlBeanDefinitionReader è¿™ä¸ªåœ¨ ã€Œæ¢³ç†Springå¯åŠ¨è„‰ç»œã€ä¸­æåˆ°äº†ï¼ŒSpringæä¾›çš„æŠ½è±¡æ¥å£ï¼ 12345678910protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123; XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory); beanDefinitionReader.setEnvironment(this.getEnvironment()); beanDefinitionReader.setResourceLoader(this); beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this)); // åˆå§‹åŒ–beanDefinitionReaderå¯¹è±¡ this.initBeanDefinitionReader(beanDefinitionReader); // åŠ è½½é…ç½®æ–‡ä»¶ è·å¾—BeanDefinitions this.loadBeanDefinitions(beanDefinitionReader); &#125; ç»§ç»­è°ƒç”¨ loadBeanDefinitions è¿™ä¸ªæœ‰å¾ˆå¤šé‡è½½æ–¹æ³•ï¼Œä¸€ç›´ç‚¹ä¸‹å»å°±è¡Œï¼ 12345678910111213protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeansException, IOException &#123; Resource[] configResources = this.getConfigResources(); if (configResources != null) &#123; reader.loadBeanDefinitions(configResources); &#125; String[] configLocations = this.getConfigLocations(); //spring-ioc.xml if (configLocations != null) &#123; reader.loadBeanDefinitions(configLocations); &#125; &#125; configLocations å°±æ˜¯æˆ‘ä»¬Xmlé…ç½®æ–‡ä»¶çš„è·¯å¾„ æ¥ä¸‹æ¥ä¸€ç›´è°ƒç”¨loadBeanDefinitionsæ–¹æ³• ç›´åˆ°è¿™ä¸€æ­¥ ğŸ‘‡ org.springframework.beans.factory.xml.XmlBeanDefinitionReader#loadBeanDefinitions(org.springframework.core.io.support.EncodedResource) 1234567891011121314151617181920212223242526272829try &#123; InputStream inputStream = encodedResource.getResource().getInputStream(); Throwable var4 = null; try &#123; InputSource inputSource = new InputSource(inputStream); if (encodedResource.getEncoding() != null) &#123; inputSource.setEncoding(encodedResource.getEncoding()); &#125; var6 = this.doLoadBeanDefinitions(inputSource, encodedResource.getResource()); &#125; catch (Throwable var24) &#123; var4 = var24; throw var24; &#125; finally &#123; if (inputStream != null) &#123; if (var4 != null) &#123; try &#123; inputStream.close(); &#125; catch (Throwable var23) &#123; var4.addSuppressed(var23); &#125; &#125; else &#123; inputStream.close(); &#125; &#125; &#125; &#125; è¿™é‡Œçœ‹åˆ° nputStream å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæ˜¯é€šè¿‡IOæµè¯»å–åˆ¶å®šä½ç½®çš„æ–‡ä»¶çš„ ! è·å–åˆ°æ–‡ä»¶è¾“å…¥æµä¹‹åï¼Œå°†è¾“å…¥æµè½¬æ¢æˆDocumentæ–‡ä»¶å»è§£æ protected int doLoadBeanDefinitions(InputSource inputSource, Resource resource) throws BeanDefinitionStoreException 12// è½¬æ¢æˆDocumentçš„å…³é”®æ–¹æ³•Document doc = this.doLoadDocument(inputSource, resource); è°ƒç”¨doRegisterBeanDefinitionsæ–¹æ³• org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#doRegisterBeanDefinitionsè°ƒç”¨parseBeanDefinitionsæ–¹æ³•å»è§£ææ•°æ® è°ƒç”¨DefaultBeanDefinitionDocumentReaderçš„parseBeanDefinitionsæ–¹æ³• æ¥è§£æElement org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseBeanDefinitions 1234567891011121314151617181920protected void parseBeanDefinitions(Element root, BeanDefinitionParserDelegate delegate) &#123; if (delegate.isDefaultNamespace(root)) &#123; NodeList nl = root.getChildNodes(); for(int i = 0; i &lt; nl.getLength(); ++i) &#123; Node node = nl.item(i); if (node instanceof Element) &#123; Element ele = (Element)node; if (delegate.isDefaultNamespace(ele)) &#123; this.parseDefaultElement(ele, delegate); &#125; else &#123; delegate.parseCustomElement(ele); &#125; &#125; &#125; &#125; else &#123; delegate.parseCustomElement(root); &#125; &#125; è°ƒç”¨parseDefaultElementæ–¹æ³• org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader#parseDefaultElement 123456789101112private void parseDefaultElement(Element ele, BeanDefinitionParserDelegate delegate) &#123; if (delegate.nodeNameEquals(ele, &quot;import&quot;)) &#123; this.importBeanDefinitionResource(ele); &#125; else if (delegate.nodeNameEquals(ele, &quot;alias&quot;)) &#123; this.processAliasRegistration(ele); &#125; else if (delegate.nodeNameEquals(ele, &quot;bean&quot;)) &#123; this.processBeanDefinition(ele, delegate); &#125; else if (delegate.nodeNameEquals(ele, &quot;beans&quot;)) &#123; this.doRegisterBeanDefinitions(ele); &#125; &#125; è¿™é‡Œçœ‹åˆ°if (delegate.nodeNameEquals(ele, &quot;bean&quot;)) ä¼šä¸ä¼šå¾ˆå…´å¥‹å‘¢ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è§£æçš„æ–¹æ³•äº†ğŸ‘‡ è·³è½¬åˆ° processBeanDefinition(ele, delegate); 12345678910111213141516protected void processBeanDefinition(Element ele, BeanDefinitionParserDelegate delegate) &#123; // æ˜¯çš„ å°±æ˜¯è¿™ä¸ªæ–¹æ³•äº† ğŸ‘‰ BeanDefinitionHolder bdHolder = delegate.parseBeanDefinitionElement(ele); if (bdHolder != null) &#123; bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder); try &#123; BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, this.getReaderContext().getRegistry()); &#125; catch (BeanDefinitionStoreException var5) &#123; this.getReaderContext().error(&quot;Failed to register bean definition with name &#x27;&quot; + bdHolder.getBeanName() + &quot;&#x27;&quot;, ele, var5); &#125; this.getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bdHolder)); &#125; &#125; parseBeanDefinitionElement å°†å…ƒç´ æ•°æ®è§£æåˆ°beanDefinition org.springframework.beans.factory.xml.BeanDefinitionParserDelegate#parseBeanDefinitionElement(org.w3c.dom.Element, org.springframework.beans.factory.config.BeanDefinition) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152@Nullable public BeanDefinitionHolder parseBeanDefinitionElement(Element ele, @Nullable BeanDefinition containingBean) &#123; String id = ele.getAttribute(&quot;id&quot;); String nameAttr = ele.getAttribute(&quot;name&quot;); List&lt;String&gt; aliases = new ArrayList(); if (StringUtils.hasLength(nameAttr)) &#123; String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, &quot;,; &quot;); aliases.addAll(Arrays.asList(nameArr)); &#125; String beanName = id; if (!StringUtils.hasText(id) &amp;&amp; !aliases.isEmpty()) &#123; beanName = (String)aliases.remove(0); if (this.logger.isTraceEnabled()) &#123; this.logger.trace(&quot;No XML &#x27;id&#x27; specified - using &#x27;&quot; + beanName + &quot;&#x27; as bean name and &quot; + aliases + &quot; as aliases&quot;); &#125; &#125; if (containingBean == null) &#123; this.checkNameUniqueness(beanName, aliases, ele); &#125; // å°†elementæ•°æ®æœ€ç»ˆè½¬æ¢æˆä¸€ä¸ªbeanDefinitionå¯¹è±¡ æ˜¯ä¸æ˜¯å¾ˆæƒŠå¥‡ å“ˆå“ˆå“ˆ ğŸ‘‰ AbstractBeanDefinition beanDefinition = this.parseBeanDefinitionElement(ele, beanName, containingBean); if (beanDefinition != null) &#123; if (!StringUtils.hasText(beanName)) &#123; try &#123; if (containingBean != null) &#123; beanName = BeanDefinitionReaderUtils.generateBeanName(beanDefinition, this.readerContext.getRegistry(), true); &#125; else &#123; beanName = this.readerContext.generateBeanName(beanDefinition); String beanClassName = beanDefinition.getBeanClassName(); if (beanClassName != null &amp;&amp; beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp; !this.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123; aliases.add(beanClassName); &#125; &#125; if (this.logger.isTraceEnabled()) &#123; this.logger.trace(&quot;Neither XML &#x27;id&#x27; nor &#x27;name&#x27; specified - using generated bean name [&quot; + beanName + &quot;]&quot;); &#125; &#125; catch (Exception var9) &#123; this.error(var9.getMessage(), ele); return null; &#125; &#125; String[] aliasesArray = StringUtils.toStringArray(aliases); return new BeanDefinitionHolder(beanDefinition, beanName, aliasesArray); &#125; else &#123; return null; &#125; &#125;","tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}],"categories":[{"name":"Spring Family","slug":"Spring-Family","permalink":"http://example.com/categories/Spring-Family/"},{"name":"Spring Framework","slug":"Spring-Family/Spring-Framework","permalink":"http://example.com/categories/Spring-Family/Spring-Framework/"}]},{"title":"Springæ¢³ç†å¯åŠ¨è„‰ç»œ","date":"2021-07-28T09:33:20.000Z","path":"wiki/Springæ¢³ç†å¯åŠ¨è„‰ç»œ/","text":"Springæ˜¯å¦‚ä½•å¯åŠ¨çš„Springæœ€å¤§çš„æ ¸å¿ƒå°±æ˜¯Beanå®¹å™¨ï¼›å®¹å™¨ï¼š ä»å¯¹è±¡åˆ›å»ºï¼Œä½¿ç”¨å’Œé”€æ¯å…¨éƒ¨ç”±å®¹å™¨å¸®æˆ‘ä»¬æ§åˆ¶ï¼Œç”¨æˆ·ä»…ä»…ä½¿ç”¨å°±å¯ä»¥ã€‚ ä¸¤å¤§æ ¸å¿ƒ IOC æ§åˆ¶åè½¬ AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ æ€è€ƒï¼šæˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨Springçš„å‘¢ï¼Ÿ åŠ å…¥ä»é…ç½®æ–‡ä»¶ä¸­åŠ è½½bean æˆ‘ä»¬çŒœæƒ³ä¸€ä¸‹å¤§è‡´æµç¨‹æ˜¯æ€æ ·çš„ 123&lt;bean id=getPerson class=com.ibli.Person&gt;&lt;property name=id value=1&gt;&lt;property name=age value=20&gt; é…ç½®æ–‡ä»¶å¦‚ä¸ŠğŸ‘†ï¼Œè¿™é‡Œæ˜¯ä¼ªä»£ç ï¼ å…ˆçŒœæƒ³å¤§è‡´æµç¨‹ï¼š é€šè¿‡ä¸Šé¢çŒœæƒ³åˆ›å»ºçš„å¯¹è±¡æµç¨‹ï¼Œåˆ›å»ºå‡ºå¯¹è±¡ï¼Œå¯¹è±¡å·²ç»å¥½äº†ï¼Œå°±æ˜¯ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œå†™ä¸€ä¸‹ä¼ªä»£ç å§ğŸ‘‡ï¼š 12åˆ›å»ºä¸€ä¸ªApplicationContextå¯¹è±¡Object obj = applicationContext.getBean(&quot;bean name); æ€è€ƒï¼Œåˆ›å»ºçš„å¯¹è±¡å¦‚ä½•å­˜å‚¨ï¼Ÿ æˆ–è€…å®¹å™¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åº”è¯¥å¯ä»¥çŒœåˆ°æ˜¯Mapç»“æ„ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆMap,å…ˆä¸ç®¡ï¼› 1ã€é¦–å…ˆå®¹å™¨æ˜¯åˆ›å»ºå¥½çš„ï¼Œå®¹å™¨åˆ›å»ºå¥½ä¹‹åï¼Œæ‰å¯ä»¥åŠ è½½é…ç½®æ–‡ä»¶ ä¹Ÿå°±æ˜¯æˆ‘ä»¬çŒœæƒ³çš„Map 2ã€åŠ è½½é…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶å¯èƒ½ä¼šæœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚XMLæ ¼å¼ï¼Œpropertyæ ¼å¼ï¼Œyamlæ ¼å¼ï¼Œæ³¨è§£æ ¼å¼ï¼Œè¿™ä¸ªæ ¼å¼å„ä¸ç›¸åŒï¼Œåˆæ˜¯å¦‚ä½•åŠ è½½çš„å‘¢ï¼ŸSpringæä¾›äº†ä¸€ä¸ªæ¥å£ï¼ŒBeanDefinitionReader,å®ƒæœ‰ä¸€ä¸ªæŠ½è±¡å®ç°ç±»AbstractBeanDefinitionReaderï¼Œä¸åŒé…ç½®æ–‡ä»¶çš„Readeræ¥ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå®ç°å®ƒä»¬è‡ªå·±çš„é€»è¾‘ï¼› 123public class PropertiesBeanDefinitionReader extends AbstractBeanDefinitionReaderpublic class GroovyBeanDefinitionReader extends AbstractBeanDefinitionReader implements GroovyObjectpublic class XmlBeanDefinitionReader extends AbstractBeanDefinitionReader 3ã€è¯»å–çš„é…ç½®æ–‡ä»¶ä¼šè½¬æ¢æˆSpringå®šä¹‰çš„æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯BeanDefinitionï¼› BeanDefinitionå®šä¹‰äº†ç±»çš„æ‰€æœ‰ç›¸å…³çš„æ•°æ®ï¼› æ­¤æ—¶å¾—åˆ°çš„BeanDefinitionçš„å±æ€§å€¼åªæ˜¯ã€Œç¬¦å·ç±»å‹ã€,å¹¶ä¸æ˜¯çœŸæ­£çš„å±æ€§å€¼ï¼› æˆ‘ä»¬å¯èƒ½ä¼šè§è¿‡è¿™ä¸­åŠ è½½æ•°æ®æºçš„æ–¹å¼ğŸ‘‡ 12345&lt;bean id=dataSource class=com.alibab.durid.pool.DruidDataSource&gt;&lt;property name=url value=$&#123;jdbc.url&#125;&gt;&lt;property name=username value=$&#123;jdbc.username&#125;&gt;&lt;property name=password value=$&#123;jdbc.password&#125;&gt;&lt;/bean&gt; æ•°æ®æºçš„å…·ä½“é…ç½®æ˜¯æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ï¼Œå½“é€šè¿‡XmlBeanDefinitionReaderè¯»å–å¹¶è§£æåˆ°çš„BeanDefinitionï¼Œä»…ä»…æ˜¯å°†Xmlä¸­çš„æ–‡ä»¶æ•°æ®å­˜æ”¾åˆ°BeanDefinitionä¸­ï¼Œå±æ€§çš„å€¼æ˜¯${jdbc.url}è€Œä¸æ˜¯çœŸæ­£çš„æˆ‘ä»¬æ•°æ®æºçš„åœ°å€ï¼› 4ã€å¾—åˆ°æ‰€æœ‰çš„BeanDefinitionä¹‹åï¼Œé€šè¿‡BeanFactoryPostProcessoræ¥å¤„ç†ä¸Šä¸€æ­¥éª¤ä¸­ï¼Œå±æ€§valueä¸æ˜¯çœŸå®æ•°æ®çš„é—®é¢˜ æ¯”å¦‚PlaceHolderConfigurerSupport(å ä½ç¬¦å¤„ç†) ç»è¿‡å·¥å‚åç½®å¤„ç†å™¨å¤„ç†ä¹‹åï¼ŒBeanDefinitionçš„å±æ€§å€¼å°±æ˜¯çœŸå®éœ€è¦çš„æ•°æ®äº†ï¼› 5ã€BeanDefinitionæ•°æ®å‡†å¤‡å®Œæˆä¹‹åï¼Œç”±BeanFactoryæ¥å®ŒæˆBeançš„åˆ›å»º å®ä¾‹åŒ– å¯¹è±¡ä¸­åˆ†é…å †å†…å­˜ç­‰æ“ä½œ åå°„è°ƒç”¨æ— å‚æ„é€ å‡½æ•° åˆ›å»ºå¯¹è±¡ ä½†æ˜¯å±æ€§æ˜¯ç©ºçš„ åˆå§‹åŒ– 6ã€åˆå§‹åŒ–ä¹‹å‰éœ€è¦å‡†å¤‡çš„å·¥ä½œ 1ã€å‡†å¤‡BeanPostProcessors2ã€è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå‡†å¤‡ç›‘å¬å™¨ äº‹ä»¶ å¹¿æ’­å™¨ 7ã€åˆå§‹åŒ–ç¯èŠ‚æœ‰å¾ˆå¤šæ­¥éª¤ å¯¹è±¡çš„å¡«å…… å…¶å®å°±æ˜¯è°ƒç”¨get/setæ–¹æ³•å¯¹å±æ€§èµ‹å€¼ è°ƒç”¨awareæ–¹æ³• å¦‚æœæˆ‘ä»¬çš„å¯¹è±¡ä¸­çš„å±æ€§æ˜¯BeanFactory æˆ‘ä»¬ä¸ç”¨è‡ªå·±å»å®ŒæˆsetBeanFactoryæ–¹æ³•ï¼Œåªéœ€è¦å½“å‰ç±»å®ç°BeanFactoryAwareæ–¹æ³•å³å¯ 123public interface BeanFactoryAware extends Aware &#123; void setBeanFactory(BeanFactory var1) throws BeansException;&#125; å¤„ç†beforeæ“ä½œ è°ƒç”¨initæ–¹æ³• æ‰§è¡Œafteræ–¹æ³• beforeå’Œafteræ­¤å¤„æ˜¯è°ƒç”¨çš„BeanPostProcessorçš„æ–¹æ³• 1234// å‰ç½®æ–¹æ³•postProcessBeforeInitialization// åç½®æ–¹æ³•postProcessAfterInitialization 8ã€æ‰§è¡Œåˆ°æ­¤ï¼Œå®Œæˆå¯¹è±¡çš„åˆ›å»ºï¼Œå¾—åˆ°ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„å¯¹è±¡","tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}],"categories":[{"name":"Spring Family","slug":"Spring-Family","permalink":"http://example.com/categories/Spring-Family/"},{"name":"Spring Framework","slug":"Spring-Family/Spring-Framework","permalink":"http://example.com/categories/Spring-Family/Spring-Framework/"}]},{"title":"","date":"2021-07-28T09:32:41.602Z","path":"wiki/Spring-Overview/","text":"title: Spring-Overviewtoc: truedate: 2021-07-28 17:32:41tags: Springcategories: [Spring Family , Spring Framework] SpringThe Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform. A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments. å­¦ä¹ æ–¹æ³• å…ˆæ¢³ç†è„‰ç»œï¼Œå…ˆå®è§‚ï¼Œå†ç»†èŠ‚ Springæºç æ³¨é‡Šå¾ˆé‡è¦ è§åçŸ¥æ„ å­¦ä¹ springçš„å‘½åè§„èŒƒ çŒœæµ‹å’ŒéªŒè¯ åšæŒçœ‹ ä¸è¦ä¸‰åˆ†é’Ÿçƒ­åº¦ å­¦ä¹ èµ„æ–™ Springæ¡†æ¶å®˜æ–¹ç½‘ç«™ ã€å®˜ç½‘ã€‘å¯ä»¥ä¸‹è½½Spirngæºç åœ¨æœ¬åœ°æŸ¥çœ‹æ›´èˆ’æœï¼ æºç è¯·æˆ³ ğŸ‘‰ğŸ‘‰ ã€æºç ã€‘ ğŸ‘ˆğŸ‘ˆ Spring5æœ€æ–°å®Œæ•´æ•™ç¨‹IDEAç‰ˆé€šä¿—æ˜“æ‡‚ è§†é¢‘æ•™ç¨‹ ç‹‚ç¥è¯´ ï¼ˆè¿™ä¸ªå¤§ä½¬åœ¨Bç«™å¾ˆç«çš„ï¼‰åŸé“¾æ¥è¯·ç‚¹å‡»ğŸ‘‰ ã€ä¼ é€ã€‘ 24é›†å½»åº•ææ‡‚aop ioc mvcåº•å±‚åŸç† è§†é¢‘ç›®å½•æ¯”è¾ƒå¥½ ğŸ‘‰ ã€2020å¹´å²ä¸Šæœ€æ–°Springæºç åˆé›†ï¼Œ24é›†å½»åº•ææ‡‚aop ioc mvcåº•å±‚åŸç†ã€‚ã€‘ æ‰‹æ’•SpringIOCæºç  é©¬å£«å…µæ•™è‚² ã€400åˆ†é’Ÿå­¦å®ŒSpringæºç è®¾è®¡åŠåŸç†ï¼Œæ‰‹æ’•SpringIOCæºç ï¼Œä»æˆ‘åšèµ·ã€‘ å›¾çµå­¦é™¢å…¬å¼€è¯¾ è¯¾ç¨‹ç›®å½•è¿˜ä¸é”™ 5ä¸ªå°æ—¶ 21å¹´å½•åˆ¶æ¯”è¾ƒæ–° ã€2021å¹´æ–°ç‰ˆJava-Springåº•å±‚åŸç†ï¼Œé˜¿é‡ŒP8å¤§ä½¬å…¨å¥—è®²è§£ã€‘ Mybatis + Spring æºç è§£è¯» VIPå…¬å¼€è¯¾ã€ç»ˆäºæœ‰å­—èŠ‚è·³åŠ¨æŠ€æœ¯å¤§ç‰›æŠŠã€mybatisåº•å±‚åŸç†ï¼šspringæ•´ç†mybatisã€‘è®²æ˜ç™½äº†ã€‘","tags":[],"categories":[]},{"title":"mysqlä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”","date":"2021-07-28T09:21:46.000Z","path":"wiki/mysqlä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”/","text":"åŸºäºæ•°æ®è¡¨ä¹è§‚é”å®ç°åˆ†å¸ƒå¼é”æ•´ä½“çš„å®é™…æ€è·¯è¦å®ç°åˆ†å¸ƒå¼é”ï¼Œæœ€ç®€å•çš„æ–¹å¼å¯èƒ½å°±æ˜¯ç›´æ¥åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°äº†ã€‚å½“æˆ‘ä»¬è¦é”ä½æŸä¸ªæ–¹æ³•æˆ–èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•ã€‚ åŸºäºæ•°æ®è¡¨å®ç°åˆ†å¸ƒå¼é”çš„å‡ ä¸ªè¦ç‚¹1ã€è¿™æŠŠé”ä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚2ã€è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£å†³æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•åœ¨è·å¾—é”ã€‚3ã€è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„insertæ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”çš„æ“ä½œã€‚4ã€è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®åº“è¡¨ä¸­æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æœ‰å…¶å®ƒæ–¹å¼è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼š 1ã€æ•°æ®åº“æ˜¯å•ç‚¹ï¼Ÿé‚£å°±æä¸¤ä¸ªæ•°æ®åº“ï¼Œæ•°æ®åº“ä¹‹å‰åŒå‘åŒæ­¥ï¼Œä¸€æ—¦æŒ‚æ‰å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡åº“ä¸Šã€‚2ã€æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Ÿå¯ä»¥åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŠŠæ•°æ®åº“ä¸­çš„è¶…æ—¶æ•°æ®æ¸…ç†ä¸€éã€‚3ã€éé˜»å¡ï¼Ÿå¯ä»¥å†™ä¸€ä¸ªwhileå¾ªç¯ï¼Œç›´åˆ°insertæˆåŠŸå†è¿”å›æˆåŠŸã€‚4ã€éé‡å…¥ï¼Ÿå¯ä»¥åœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸€ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“ä¸­å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œå°±ç›´æ¥æŠŠé”åˆ†é…ç»™å®ƒå³å¯ã€‚ ä¹è§‚é”&amp;æ‚²è§‚é”ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“å¦‚æœæä¾›ç±»ä¼¼äºwrite_conditionæœºåˆ¶çš„å…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚ å®ƒå‡è®¾å¤šç”¨æˆ·å¹¶å‘çš„äº‹åŠ¡åœ¨å¤„ç†æ—¶ä¸ä¼šå½¼æ­¤äº’ç›¸å½±å“ï¼Œå„äº‹åŠ¡èƒ½å¤Ÿåœ¨ä¸äº§ç”Ÿé”çš„æƒ…å†µä¸‹å¤„ç†å„è‡ªå½±å“çš„é‚£éƒ¨åˆ†æ•°æ®ã€‚åœ¨æäº¤æ•°æ®æ›´æ–°ä¹‹å‰ï¼Œæ¯ä¸ªäº‹åŠ¡ä¼šå…ˆæ£€æŸ¥åœ¨è¯¥äº‹åŠ¡è¯»å–æ•°æ®åï¼Œæœ‰æ²¡æœ‰å…¶ä»–äº‹åŠ¡åˆä¿®æ”¹äº†è¯¥æ•°æ®ã€‚å¦‚æœå…¶ä»–äº‹åŠ¡æœ‰æ›´æ–°çš„è¯ï¼Œæ­£åœ¨æäº¤çš„äº‹åŠ¡ä¼šè¿›è¡Œå›æ»šã€‚ç›¸å¯¹äºæ‚²è§‚é”ï¼Œåœ¨å¯¹æ•°æ®åº“è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œä¹è§‚é”å¹¶ä¸ä¼šä½¿ç”¨æ•°æ®åº“æä¾›çš„é”æœºåˆ¶ã€‚ä¸€èˆ¬çš„å®ç°ä¹è§‚é”çš„æ–¹å¼å°±æ˜¯è®°å½•æ•°æ®ç‰ˆæœ¬ã€‚ æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚ ä¸¤ç§é”å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä¸å¯è®¤ä¸ºä¸€ç§å¥½äºå¦ä¸€ç§ï¼Œåƒä¹è§‚é”é€‚ç”¨äºå†™æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œå³å†²çªçœŸçš„å¾ˆå°‘å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™æ ·å¯ä»¥çœå»äº†é”çš„å¼€é”€ï¼ŒåŠ å¤§äº†ç³»ç»Ÿçš„æ•´ä¸ªååé‡ã€‚ä½†å¦‚æœç»å¸¸äº§ç”Ÿå†²çªï¼Œä¸Šå±‚åº”ç”¨ä¼šä¸æ–­çš„è¿›è¡Œretryï¼Œè¿™æ ·åå€’æ˜¯é™ä½äº†æ€§èƒ½ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ç”¨æ‚²è§‚é”å°±æ¯”è¾ƒåˆé€‚ã€‚ ä¹è§‚é”çš„å®ç°å®ç°æ•°æ®ç‰ˆæœ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œç¬¬äºŒç§æ˜¯ä½¿ç”¨æ—¶é—´æˆ³ã€‚ 1ã€ä½¿ç”¨ç‰ˆæœ¬å·å®ç°ä¹è§‚é”ä½¿ç”¨ç‰ˆæœ¬å·æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®åˆå§‹åŒ–æ—¶æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ•°æ®çš„æ›´æ–°æ“ä½œéƒ½å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1æ“ä½œã€‚å¹¶åˆ¤æ–­å½“å‰ç‰ˆæœ¬å·æ˜¯ä¸æ˜¯è¯¥æ•°æ®çš„æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚ 12345671.æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯select (status,status,version) from t_goods where id=#&#123;id&#125;2.æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•3.ä¿®æ”¹å•†å“statusä¸º2update t_goodsset status=2,version=version+1where id=#&#123;id&#125; and version=#&#123;version&#125;; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”æœºåˆ¶å¾€å¾€åŸºäºç³»ç»Ÿä¸­æ•°æ®å­˜å‚¨é€»è¾‘ï¼Œå› æ­¤ä¹Ÿå…·å¤‡ä¸€å®šçš„å±€é™æ€§ã€‚ç”±äºä¹è§‚é”æœºåˆ¶æ˜¯åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­å®ç°çš„ï¼Œå¯¹äºæ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„ç”¨æˆ·æ•°æ®æ›´æ–°æ“ä½œä¸å—æˆ‘ä»¬ç³»ç»Ÿçš„æ§åˆ¶ï¼Œå› æ­¤å¯èƒ½ä¼šé€ æˆè„æ•°æ®è¢«æ›´æ–°åˆ°æ•°æ®åº“ä¸­ã€‚åœ¨ç³»ç»Ÿè®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬åº”è¯¥å……åˆ†è€ƒè™‘åˆ°è¿™äº›æƒ…å†µï¼Œå¹¶è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼ˆå¦‚å°†ä¹è§‚é”ç­–ç•¥åœ¨æ•°æ®åº“å­˜å‚¨è¿‡ç¨‹ä¸­å®ç°ï¼Œå¯¹å¤–åªå¼€æ”¾åŸºäºæ­¤å­˜å‚¨è¿‡ç¨‹çš„æ•°æ®æ›´æ–°é€”å¾„ï¼Œè€Œä¸æ˜¯å°†æ•°æ®åº“è¡¨ç›´æ¥å¯¹å¤–å…¬å¼€ï¼‰ã€‚ è¿™ä¸€ç‚¹å…¶å®åœ¨å¾®æœåŠ¡æ¶æ„ä¸­åªè¦åšå¥½æ•°æ®éš”ç¦»å°±å¯ä»¥é¿å…ï¼Œæ¯”å¦‚userè¿™å¼ æ•°æ®è¡¨ï¼ŒæŒ‰ç…§è¾¹ç•Œåˆ’åˆ†åº”è¯¥å±äºç”¨æˆ·ä¸­å¿ƒæœåŠ¡çš„ï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚ä»“å‚¨ï¼Œç‰©æµç­‰éœ€è¦ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåº”è¯¥æœ‰ç”¨æˆ·ä¸­å¿ƒæš´éœ²å‡ºæ¥å£ï¼Œè€Œä¸æ˜¯ä»“å‚¨å»æ•°æ®åº“æŸ¥è¯¢userè¿™å¼ è¡¨çš„æ•°æ®ï¼Œç”šè‡³update userçš„æ•°æ®ã€‚ 2ã€ä½¿ç”¨æ—¶é—´æˆ³ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨update_timeå­—æ®µï¼Œå¹¶ä¸”è¿™ä¸ªå­—æ®µè‚¯å®šæ˜¯è·Ÿéšæ•°æ®åº“æ—¶é—´é…ç½®çš„ï¼Œå³ update on current_timestamp ï¼› ä¹è§‚é”çš„ä¼˜ç‚¹ä¸ä¸è¶³ä¹è§‚å¹¶å‘æ§åˆ¶ç›¸ä¿¡äº‹åŠ¡ä¹‹é—´çš„æ•°æ®ç«äº‰(data race)çš„æ¦‚ç‡æ˜¯æ¯”è¾ƒå°çš„ï¼Œå› æ­¤å°½å¯èƒ½ç›´æ¥åšä¸‹å»ï¼Œç›´åˆ°æäº¤çš„æ—¶å€™æ‰å»é”å®šï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä»»ä½•é”å’Œæ­»é”ã€‚èƒ½å¤Ÿæå‡æ•°æ®åº“çš„ååé‡ï¼›ä½†å¦‚æœç›´æ¥ç®€å•è¿™ä¹ˆåšï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ä¼šé‡åˆ°ä¸å¯é¢„æœŸçš„ç»“æœï¼Œä¾‹å¦‚ä¸¤ä¸ªäº‹åŠ¡éƒ½è¯»å–äº†æ•°æ®åº“çš„æŸä¸€è¡Œï¼Œç»è¿‡ä¿®æ”¹ä»¥åå†™å›æ•°æ®åº“ï¼Œè¿™æ—¶å°±é‡åˆ°äº†é—®é¢˜ã€‚ å‚è€ƒèµ„æ–™åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”å®ç°åˆ†å¸ƒå¼é”æ–¹å¼ï¼ˆä¸€ã€åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”ï¼‰åˆ†å¸ƒå¼é”çœ‹è¿™ç¯‡å°±å¤Ÿäº†ä¹è§‚é”ä¸æ‚²è§‚é”æ·±å…¥å­¦ä¹ ","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"","date":"2021-07-28T09:05:46.241Z","path":"wiki/mybatisé…ç½®æ–‡ä»¶è§£æ/","text":"title: mybatisé…ç½®æ–‡ä»¶è§£ætoc: truedate: 2021-07-28 17:05:46tags: mybatiscategories: [Spring Family] Mybatisé…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;&lt;configuration&gt; &lt;!-- å¼•å…¥æ•°æ®åº“å±æ€§æ–‡ä»¶ --&gt; &lt;properties resource=&quot;database.properties&quot;&gt; &lt;!-- &lt;property name=&quot;username&quot; value=&quot;sa&quot;&gt;&lt;/property&gt; --&gt; &lt;/properties&gt; &lt;!-- mybatisé…ç½®æ–‡ä»¶ --&gt; &lt;settings&gt; &lt;setting name=&quot;cacheEnabled&quot; value=&quot;false&quot;/&gt; &lt;setting name=&quot;autoMappingBehavior&quot; value=&quot;PARTIAL&quot;/&gt; &lt;/settings&gt; &lt;!-- åˆ«åçš„é…ç½® --&gt; &lt;typeAliases&gt; &lt;!-- &lt;typeAlias type=&quot;com.xit.pojo.User&quot; alias=&quot;user&quot;/&gt; --&gt; &lt;package name=&quot;com.xit.pojo&quot;/&gt; &lt;/typeAliases&gt; &lt;!-- é…ç½®è¿è¡Œç¯å¢ƒ --&gt; &lt;environments default=&quot;default&quot;&gt; &lt;environment id=&quot;default&quot;&gt; &lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt; &lt;!-- ç”±JDBCç®¡ç†äº‹åŠ¡ --&gt; &lt;transactionManager type=&quot;JDBC&quot;/&gt; &lt;!-- é…ç½®æ•°æ®æºï¼šè¿æ¥æ±  --&gt; &lt;dataSource type=&quot;POOLED&quot;&gt; &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt; &lt;/dataSource&gt; &lt;/environment&gt; &lt;/environments&gt; &lt;!-- å¼•å…¥Mapperæ˜ å°„æ–‡ä»¶ --&gt; &lt;mappers&gt; &lt;mapper resource=&quot;com/xit/pojo/UserMapper.xml&quot;/&gt; &lt;!-- URLæ–¹å¼ --&gt; &lt;!-- &lt;mapper url=&quot;file:///C:/eclipse-workspace/mybatis-01/src/com/xit/pojo/UserMapper.xml&quot;/&gt; --&gt; &lt;/mappers&gt;&lt;/configuration&gt; Mybatisæœ‰å‡ éƒ¨åˆ†å…¨å±€é…ç½®properties=&gt;ettings=&gt;typeAliases=&gt;typeHandlers=&gt;objectFactory=&gt;plugins=&gt;environment=&gt;databaseIdProvider=&gt;mappers Mybatis åŠ è½½Mapperæ–‡ä»¶æœ‰å‡ ç§æ–¹å¼ï¼Ÿä»¥ä¸Šæ˜¯Mybatiså®˜æ–¹æ–‡æ¡£ä»‹ç»çš„æ ·ä¾‹ğŸ‘†ï¼ŒåŸæ–‡é“¾æ¥è¯·ç‚¹å‡»è¿™ æœ‰4ç§æ–¹å¼ï¼›æŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°åº•ä¾æ¬¡æ˜¯ï¼š package resource url class ä¸‹é¢æ˜¯MybatisåŠ è½½mybatis-config.xmlæ–‡ä»¶é…ç½®çš„æºç ï¼Œä»ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°åŠ è½½çš„4ä¸­æ–¹å¼å’Œä¼˜å…ˆçº§ï¼ğŸ‘‡org.apache.ibatis.builder.xml.XMLConfigBuilder#typeHandlerElement 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657private void mapperElement(XNode parent) throws Exception &#123; if (parent != null) &#123; Iterator var2 = parent.getChildren().iterator(); while(true) &#123; while(var2.hasNext()) &#123; XNode child = (XNode)var2.next(); String resource; if (&quot;package&quot;.equals(child.getName())) &#123; resource = child.getStringAttribute(&quot;name&quot;); this.configuration.addMappers(resource); &#125; else &#123; resource = child.getStringAttribute(&quot;resource&quot;); String url = child.getStringAttribute(&quot;url&quot;); String mapperClass = child.getStringAttribute(&quot;class&quot;); XMLMapperBuilder mapperParser; InputStream inputStream; if (resource != null &amp;&amp; url == null &amp;&amp; mapperClass == null) &#123; ErrorContext.instance().resource(resource); inputStream = Resources.getResourceAsStream(resource); mapperParser = new XMLMapperBuilder(inputStream, this.configuration, resource, this.configuration.getSqlFragments()); mapperParser.parse(); &#125; else if (resource == null &amp;&amp; url != null &amp;&amp; mapperClass == null) &#123; ErrorContext.instance().resource(url); inputStream = Resources.getUrlAsStream(url); mapperParser = new XMLMapperBuilder(inputStream, this.configuration, url, this.configuration.getSqlFragments()); mapperParser.parse(); &#125; else &#123; if (resource != null || url != null || mapperClass == null) &#123; throw new BuilderException(&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;); &#125; Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass); this.configuration.addMapper(mapperInterface); &#125; &#125; &#125; return; &#125; &#125; &#125;``` ## Mybatisæœ‰å‡ ç§æ‰§è¡Œå™¨mybatisæœ‰3ä¸­æ‰§è¡Œå™¨ï¼› ```textpackage org.apache.ibatis.session;public enum ExecutorType &#123; SIMPLE, // é»˜è®¤ REUSE, BATCH; private ExecutorType() &#123; &#125;&#125;","tags":[],"categories":[]},{"title":"mybatis-å·¥ä½œåŸç†","date":"2021-07-28T08:52:38.000Z","path":"wiki/mybatis-å·¥ä½œåŸç†/","text":"Mybatiså·¥ä½œåŸç†Mybatisæ•´ä½“æ¡†æ¶ å·¥ä½œåŸç†è§£æ 1ï¼‰è¯»å–MyBatisé…ç½®æ–‡ä»¶ï¼šmybatis-config.xml ä¸º MyBatis çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé…ç½®äº† MyBatis çš„è¿è¡Œç¯å¢ƒç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚ è¯»å–é…ç½®æ–‡ä»¶å°†mybatis-config.xmlè½¬æ¢ä¸ºorg.apache.ibatis.session.Configurationç±»ï¼Œè¿™é‡ŒmybatisåŒ…å«9ä¸ªå…¨å±€é…ç½®ï¼› 2ï¼‰åŠ è½½æ˜ å°„æ–‡ä»¶ã€‚æ˜ å°„æ–‡ä»¶å³ SQL æ˜ å°„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­é…ç½®äº†æ“ä½œæ•°æ®åº“çš„ SQL è¯­å¥ï¼Œéœ€è¦åœ¨ MyBatis é…ç½®æ–‡ä»¶ mybatis-config.xml ä¸­åŠ è½½ã€‚mybatis-config.xml æ–‡ä»¶å¯ä»¥åŠ è½½å¤šä¸ªæ˜ å°„æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚ æ‰«æMappingç›®å½•ä¸‹çš„***Mapper.xmlæ–‡ä»¶ï¼› 3ï¼‰æ„é€ ä¼šè¯å·¥å‚ï¼šé€šè¿‡ MyBatis çš„ç¯å¢ƒç­‰é…ç½®ä¿¡æ¯æ„å»ºä¼šè¯å·¥å‚ SqlSessionFactoryã€‚ 1234567@Bean(name = &quot;sqlSessionFactory&quot;)public SqlSessionFactory sqlSessionFactory(HikariDataSource dataSource) throws Exception &#123; SqlSessionFactoryBean bean = new SqlSessionFactoryBean(); bean.setDataSource(dataSource); bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:com/****/mapping/**/*.xml&quot;)); return bean.getObject();&#125; ç”Ÿæˆå·¥å‚å®ä¾‹ï¼š 123456789101112131415161718192021222324252627public class SqlSessionFactoryBean implements FactoryBean&lt;SqlSessionFactory&gt;, InitializingBean, ApplicationListener&lt;ApplicationEvent&gt; &#123; private static final Log LOGGER = LogFactory.getLog(SqlSessionFactoryBean.class); private Resource configLocation; private Configuration configuration; private Resource[] mapperLocations; private DataSource dataSource; private TransactionFactory transactionFactory; private Properties configurationProperties; private SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder(); private SqlSessionFactory sqlSessionFactory; private String environment = SqlSessionFactoryBean.class.getSimpleName(); private boolean failFast; private Interceptor[] plugins; private TypeHandler&lt;?&gt;[] typeHandlers; private String typeHandlersPackage; private Class&lt;?&gt;[] typeAliases; private String typeAliasesPackage; private Class&lt;?&gt; typeAliasesSuperType; private DatabaseIdProvider databaseIdProvider; private Class&lt;? extends VFS&gt; vfs; private Cache cache; private ObjectFactory objectFactory; private ObjectWrapperFactory objectWrapperFactory; public SqlSessionFactoryBean() &#123; &#125;&#125; 4ï¼‰åˆ›å»ºä¼šè¯å¯¹è±¡ï¼šç”±ä¼šè¯å·¥å‚åˆ›å»º SqlSession å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸­åŒ…å«äº†æ‰§è¡Œ SQL è¯­å¥çš„æ‰€æœ‰æ–¹æ³•ã€‚ SqlSessionå¯¹è±¡å®Œæˆå’Œæ•°æ®åº“çš„äº¤äº’ï¼š 5ï¼‰Executor æ‰§è¡Œå™¨ï¼šMyBatis åº•å±‚å®šä¹‰äº†ä¸€ä¸ª Executor æ¥å£æ¥æ“ä½œæ•°æ®åº“ï¼Œå®ƒå°†æ ¹æ® SqlSession ä¼ é€’çš„å‚æ•°åŠ¨æ€åœ°ç”Ÿæˆéœ€è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼ŒåŒæ—¶è´Ÿè´£æŸ¥è¯¢ç¼“å­˜çš„ç»´æŠ¤ã€‚ 3ç§æ‰§è¡ŒæœŸç±»å‹ï¼ˆSimple Pre Batchï¼‰ Executoræ¥å£æœ‰ä¸¤ä¸ªå®ç°ï¼Œä¸€ä¸ªæ˜¯åŸºæœ¬æ‰§è¡Œå™¨ã€ä¸€ä¸ªæ˜¯ç¼“å­˜æ‰§è¡Œå™¨ã€‚ 6ï¼‰MappedStatement å¯¹è±¡ï¼šåœ¨ Executor æ¥å£çš„æ‰§è¡Œæ–¹æ³•ä¸­æœ‰ä¸€ä¸ª MappedStatement ç±»å‹çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯å¯¹æ˜ å°„ä¿¡æ¯çš„å°è£…ï¼Œç”¨äºå­˜å‚¨è¦æ˜ å°„çš„ SQL è¯­å¥çš„ idã€å‚æ•°ç­‰ä¿¡æ¯ã€‚ å€ŸåŠ©MappedStatementä¸­çš„ç»“æœæ˜ å°„å…³ç³»ï¼Œå°†è¿”å›ç»“æœè½¬åŒ–æˆHashMapã€JavaBeanç­‰å­˜å‚¨ç»“æ„å¹¶è¿”å›ã€‚ 7ï¼‰è¾“å…¥å‚æ•°æ˜ å°„ï¼šè¾“å…¥å‚æ•°ç±»å‹å¯ä»¥æ˜¯ Mapã€List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å…¥å‚æ•°æ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ preparedStatement å¯¹è±¡è®¾ç½®å‚æ•°çš„è¿‡ç¨‹ã€‚8ï¼‰è¾“å‡ºç»“æœæ˜ å°„ï¼šè¾“å‡ºç»“æœç±»å‹å¯ä»¥æ˜¯ Mapã€ List ç­‰é›†åˆç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œ POJO ç±»å‹ã€‚è¾“å‡ºç»“æœæ˜ å°„è¿‡ç¨‹ç±»ä¼¼äº JDBC å¯¹ç»“æœé›†çš„è§£æè¿‡ç¨‹ã€‚ å‚è€ƒèµ„æ–™ã€1ã€‘MyBatisçš„å·¥ä½œåŸç† Cè¯­è¨€ç½‘","tags":[{"name":"mybatis","slug":"mybatis","permalink":"http://example.com/tags/mybatis/"}],"categories":[{"name":"Spring Family","slug":"Spring-Family","permalink":"http://example.com/categories/Spring-Family/"},{"name":"mybatis","slug":"Spring-Family/mybatis","permalink":"http://example.com/categories/Spring-Family/mybatis/"}]},{"title":"Redis-ç¼“å­˜ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©","date":"2021-07-28T08:51:22.000Z","path":"wiki/Redis-ç¼“å­˜ç©¿é€ã€å‡»ç©¿å’Œé›ªå´©/","text":"ç¼“å­˜å‡»ç©¿ï¼Œç©¿é€å’Œé›ªå´©èƒŒæ™¯é¦–å…ˆè¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå†™è¿™ç‰‡æ–‡ç« ï¼Œå› ä¸ºè¿™ä¸ªå¯¹æˆ‘æ¥è¯´æ˜¯å°è±¡éå¸¸æ·±åˆ»çš„ï¼Œé‚£æ˜¯è¿˜åœ¨å®ä¹ çš„æ—¶å€™ï¼Œå½“æ—¶æ¥äº†ä¸€ä¸ªä»»åŠ¡ï¼ˆå…¶å®å°±æ˜¯ç»ƒæ‰‹çš„ï¼‰ï¼Œå¤§è‡´éœ€æ±‚æ˜¯å†™ä¸€ä¸ªç™½åå•ï¼Œç„¶åæœ‰ä¸€ä¸ªåŠŸèƒ½å¯¹ç™½åå•å¼€æ”¾ã€‚å› ä¸ºæ˜¯æ–°åŠŸèƒ½ï¼Œéœ€è¦åœ¨éƒ¨åˆ†åœ°åŒºè¯•ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜æ‰ä¼šæ”¾å¼€åˆ°å…¨å›½åŸå¸‚è¿è¡Œã€‚å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œè®©å½“æ—¶çš„æˆ‘ï¼Œå‘µå‘µã€‚æˆ‘è®°å¾—é‚£æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨Redis,æ ¹æœ¬ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©å•Šï¼Œç¼“å­˜å‡»ç©¿å•Šï¼Œç©¿é€å‘€è¿™äº›ï¼Œè¿˜æœ‰æ›´å¯æ€•çš„ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼ˆTODO ä¸‹æœŸå†è¯´ï¼‰ã€‚ å½“æ—¶å›¢é˜Ÿåå‡ ä½å¤§ä½¬reviewæˆ‘çš„ä»£ç ï¼Œå“¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°è±¡ä¼šæ·±åˆ»ä¸€äº›å§ï¼Œå…³é”®é‚£æ˜¯æˆ‘ç¬¬ä¸€ä¸ªreviewä»£ç ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨redisï¼Œæ•´ä¸ªreviewå°±åƒæ˜¯åå‡ ä¸ªå¤§ä½¬åœ¨é¢è¯•æˆ‘ã€‚çœŸæ˜¯æ€€ç–‘äººç”Ÿäº†ã€‚ã€‚æˆ‘æ˜¯åºŸç‰©ï¼Œåˆ«ç¬‘ã€‚ 12345678910// å¤§è‡´ä¼ªä»£ç public boolean isPermit(String cityCode)&#123; // å…ˆæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ String tmpCity = getCache(cityCode); if(StringUtil.isNotBlank(tmpCity))&#123; reture Boolean.TRUE; &#125; // ç¼“å­˜ä¸­æ²¡æœ‰åœ¨å»æŸ¥æ•°æ®åº“ reture judgeForDb(cityCode);&#125; æˆ‘ä¸Šé¢çš„ä¾‹å­å…¶å®å°±æ˜¯å…¸å‹çš„ç¼“å­˜ç©¿é€çš„é—®é¢˜ã€‚å› ä¸ºä»…ä»…æ˜¯å¼€æ”¾äº†åå‡ ä¸ªåŸå¸‚æ¥è¯•ç‚¹åŠŸèƒ½ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†çš„æŸ¥è¯¢éƒ½æ˜¯ç¼“å­˜ä¸å‘½ä¸­çš„ã€‚ ä¸‹é¢å¼•å‡ºä»Šå¤©æˆ‘ä»¬çš„ä¸‰ä¸ªå…³é”®è¯ï¼š ç¼“å­˜ç©¿é€ è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œç¼“å­˜ä¸­åŸºæœ¬ä¸Šæ²¡æœ‰ï¼Œæ‰€ä»¥å¤§æ¦‚ç‡æƒ…å†µä¸‹ç¼“å­˜æ˜¯ä¸å‘½ä¸­çš„ï¼Œè€Œæ˜¯å»æ•°æ®åº“ä¸­å»æŸ¥è¯¢æ•°æ®ï¼Œå¯¼è‡´ç¼“å­˜ç›¸å½“äºæ˜¯ä¸€ä¸ªæ‘†è®¾ã€‚å¦‚æœKeyä¸æ˜¯çƒ­ç‚¹è®¿é—®è¿˜å¯ä»¥ï¼Œå¦‚æœæ˜¯çƒ­ç‚¹Keyï¼Œè€Œä¸”å¹¶å‘é‡ä¹Ÿä¼šå¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œç»å¤§å¤šæ•°çš„è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¾ˆå®¹æ˜“é€ æˆæ•°æ®åº“å®•æœºã€‚ è§£å†³æ–¹æ¡ˆ1ã€å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œæ ¡éªŒï¼Œbloom filterå…¸å‹åº”ç”¨åœºæ™¯ï¼ˆç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œé»‘åå•æœºåˆ¶ï¼Œå•è¯é”™è¯¯æ£€æµ‹ï¼‰2ã€ç¼“å­˜ç©ºå€¼æ–¹æ³•ï¼Œè¿™ä¸ªç½‘ä¸Šä¹Ÿæ˜¯è¯´çš„æ¯”è¾ƒå¤šçš„ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥çš„ åœ¨æ­¤æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š1ã€æ ¡éªŒä¸€ä¸ªåŸå¸‚æ˜¯å¦æ˜¯åŸå¸‚ç™½åå•çš„åŸå¸‚æ—¶ï¼Œç›´æ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯ä½¿ç”¨çš„hashï¼›2ã€å¦‚æœæ²¡æœ‰æŸ¥åˆ°è¿™ä¸ªåŸå¸‚ï¼Œåˆ™è®¤ä¸ºè¿™ä¸ªåŸå¸‚ä¸åœ¨ç™½åå•ä¸­ï¼Œå› ä¸ºæˆ‘æ˜¯å…ˆæŸ¥çš„hashï¼Œç„¶ååœ¨æŸ¥è¯¢hashä¸­çš„å…·ä½“åŸå¸‚ã€‚å¦‚æœhashçš„å€¼éƒ½æ²¡æœ‰æŸ¥åˆ°ï¼Œé‚£è¯´æ˜ç¼“å­˜å¤±æ•ˆäº†ï¼›3ã€é’ˆå¯¹ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼Œå¯ä»¥å†æŸ¥DBæ¥æ›´æ–°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™æœ‰äººè¦è¾ƒçœŸäº†ï¼Œä¼šä¸ä¼šå‡ºçº¿ç¼“å­˜å‡»ç©¿çš„æƒ…å†µå‘€ï¼Œè¿™ä¸ªçœ‹å…·ä½“åœºæ™¯ï¼Œå› ä¸ºæˆ‘çš„ä¸šåŠ¡æ˜¯ä¸éœ€è¦çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥æŸ¥åº“æ›´æ–°ç¼“å­˜äº†ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œé‚£å¯ä»¥ä¸Šç¼“å­˜å‡»ç©¿çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è€…çœ‹çœ‹ä¸Šé¢ä¸¤ç§è§£å†³æ–¹æ¡ˆæœ‰æ²¡æœ‰åˆé€‚çš„ï¼Œå“ˆå“ˆå“ˆï¼›4ã€å› ä¸ºåŸå¸‚æ˜¯åœ¨åå°è¿›è¡Œé…ç½®çš„ï¼Œæ‰€ä»¥æˆ‘æ˜¯åœ¨å¢åˆ æ”¹çš„æ“ä½œæ—¶ï¼Œä¿è¯äº†ç¼“å­˜æ•°æ®çš„ä¸€è‡´æ€§çš„å‰æä¸‹ï¼Œæ‰é€‰æ‹©ç›¸ä¿¡ç¼“å­˜çš„ã€‚è¿™æ˜¯æˆ‘å½“æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚ ç¼“å­˜å‡»ç©¿ æŸä¸ªçƒ­ç‚¹Keyåœ¨ä¸€æ®µæ—¶é—´å†…å¤±æ•ˆäº†ï¼Œæ­¤æ—¶æœ‰å¤§é‡è¯·æ±‚ç¬æ—¶æŠµè¾¾ï¼Œä¼šä¸¥é‡å¢åŠ æ•°æ®åº“çš„å‹åŠ›ã€‚å› ä¸ºæˆ‘ä»¬çš„ç¼“å­˜æ•°æ®ä¸€èˆ¬éƒ½æ˜¯è¦è®¾ç½®è¿‡æœŸæ—¶é—´çš„ï¼Œå½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¼šå»æŸ¥è¯¢æ•°æ®åº“åŒæ—¶æ›´æ–°ç¼“å­˜æ•°æ®ã€‚ è§£å†³æ–¹æ¡ˆ1ã€å¯ä»¥åŠ é”ï¼Œæ¥ä¿è¯åªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚è¿›æ¥æ—¶è¾¾åˆ°æ•°æ®åº“ä¸Šï¼Œç„¶åæ›´æ–°ç¼“å­˜ï¼Œç¬¬äºŒä¸ªè¯·æ±‚è¿›æ¥æ˜¯å°±ä¼šå‘½ä¸­ç¼“å­˜ï¼Œå½“ç„¶å¦‚æœæ˜¯åˆ†å¸ƒå¼æœåŠ¡ï¼Œé‚£å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”äº†ã€‚2ã€åˆç†è®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œå¯ä»¥å°†çƒ­ç‚¹Keyæ—¶é—´è®¾ç½®é•¿ä¸€äº›ï¼Œæˆ–è€…æ ¹æ®ä¸šåŠ¡å°†å¤±æ•ˆæ—¶é—´è®¾ç½®åœ¨ä¸šåŠ¡é‡æ¯”è¾ƒå°çš„æ³¢æ®µï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚æœ‰çš„è§£å†³æ–¹æ¡ˆä¼šä¸è®¾ç½®Keyçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªï¼Œçœ‹æƒ…å†µå§ï¼Œä¸å»ºè®®è¿™æ ·ã€‚ å¦‚æœå¤§é‡çš„keyä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåˆ™é•¿æœŸå ç”¨å†…å­˜ä¹Ÿæ˜¯ä¸å¥½çš„ã€‚ ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¤§é‡Keyåœ¨ä¸€æ®µæ—¶é—´æˆ–è€…ç¬æ—¶å¤±æ•ˆï¼Œæˆ–è€…RedisæœåŠ¡é‡å¯ï¼ˆæ‰€æœ‰Keyå¤±æ•ˆï¼Œå› ä¸ºæ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼‰ï¼Œä»è€Œå¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œå¢åŠ æ•°æ®åº“å‹åŠ› è§£å†³æ–¹æ¡ˆ1ã€å°†çƒ­ç‚¹keyè®¾ç½®ä¸åŒæ³¢æ®µçš„è¿‡æœŸæ—¶é—´ï¼ŒæŠŠè¿‡æœŸæ—¶é—´æ•£åˆ—å¼€ã€‚2ã€ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥é™åˆ¶é«˜å¹¶å‘çš„è¯·æ±‚ï¼Œå’Œç¼“å­˜å‡»ç©¿çš„è§£å†³æ–¹æ¡ˆåŒç†ã€‚3ã€å¯¹äºRedisé‡å¯æˆ–å®•æœºçš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘é›†ç¾¤éƒ¨ç½²ï¼Œå¹¶ä¿è¯æ•°æ®çš„åŒæ­¥å’Œä¸€è‡´æ€§ï¼› ç”Ÿæ´»è¿œä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”","tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"}]},{"title":"Redis-å­—ç¬¦ä¸²åº•å±‚åŸç†","date":"2021-07-28T08:50:26.000Z","path":"wiki/Redis-å­—ç¬¦ä¸²åº•å±‚åŸç†/","text":"Redisåº•å±‚å®ç°åŠåŸç† å…³é”®è¯ SDS embstr äºŒè¿›åˆ¶å®‰å…¨ ç©ºé—´é¢„åˆ†é… Stringç±»å‹ä¸åŒçš„ç¼–ç æ–¹å¼ ä½¿ç”¨æ•´æ•°å­˜å‚¨ï¼š åªå¯¹é•¿åº¦å°äºæˆ–ç­‰äº 21 å­—èŠ‚ï¼Œå¹¶ä¸”å¯ä»¥è¢«è§£é‡Šä¸ºæ•´æ•°çš„å­—ç¬¦ä¸²è¿›è¡Œç¼–ç  ä½¿ç”¨EMBSTR ç¼–ç ï¼š å°è¯•å°† RAW ç¼–ç çš„å­—ç¬¦ä¸²ç¼–ç ä¸º EMBSTR ç¼–ç ï¼Œ ä½¿ç”¨SDSç¼–ç : è¿™ä¸ªå¯¹è±¡æ²¡åŠæ³•è¿›è¡Œç¼–ç ï¼Œå°è¯•ä» SDS ä¸­ç§»é™¤æ‰€æœ‰ç©ºä½™ç©ºé—´ ä¸‹é¢ä¸¾ä¸ªä¾‹å­çœ‹ä¸€ä¸‹ğŸ‘‡ embsträ¸åŠ¨æ€å­—ç¬¦ä¸² embstrçš„åˆ›å»ºåªéœ€åˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œè€Œrawä¸ºä¸¤æ¬¡ï¼ˆä¸€æ¬¡ä¸ºsdsåˆ†é…å¯¹è±¡ï¼Œå¦ä¸€æ¬¡ä¸ºredisObjectåˆ†é…å¯¹è±¡ï¼Œembstrçœå»äº†ç¬¬ä¸€æ¬¡ï¼‰ã€‚ ç›¸å¯¹åœ°ï¼Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°ä¹Ÿç”±ä¸¤æ¬¡å˜ä¸ºä¸€æ¬¡ã€‚ embstrçš„redisObjectå’Œsdsæ”¾åœ¨ä¸€èµ·ï¼Œæ›´å¥½åœ°åˆ©ç”¨ç¼“å­˜å¸¦æ¥çš„ä¼˜åŠ¿ ä½†æ˜¯rediså¹¶æœªæä¾›ä»»ä½•ä¿®æ”¹embstrçš„æ–¹å¼ï¼Œå³embstræ˜¯åªè¯»çš„å½¢å¼ã€‚å¯¹embstrçš„ä¿®æ”¹å®é™…ä¸Šæ˜¯å…ˆè½¬æ¢ä¸ºrawå†è¿›è¡Œä¿®æ”¹ã€‚ SDS(simple dynamic string)SDSå®šä¹‰123456789struct sdshdr&#123; //è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ //ç­‰äº SDS ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦ int len; //è®°å½• buf æ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ int free; //å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸² char buf[];&#125; SDSæœ‰ä»€ä¹ˆä¼˜ç‚¹1ã€å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦sdshdr ä¸­ç”±äº len å±æ€§çš„å­˜åœ¨ï¼Œè·å– SDS å­—ç¬¦ä¸²çš„é•¿åº¦åªéœ€è¦è¯»å– len å±æ€§ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œè€Œå¯¹äº C è¯­è¨€æ¥è¯´ï¼Œ è·å–å­—ç¬¦ä¸²çš„é•¿åº¦é€šå¸¸æ˜¯éå†å­—ç¬¦ä¸²è®¡æ•°æ¥å®ç°çš„ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚ 2ã€æœç»ç¼“å†²åŒºæº¢å‡ºæˆ‘ä»¬çŸ¥é“åœ¨ C è¯­è¨€ä¸­ä½¿ç”¨ strcat å‡½æ•°æ¥è¿›è¡Œä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œä¸€æ—¦æ²¡æœ‰åˆ†é…è¶³å¤Ÿé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå°±ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚è€Œå¯¹äº SDS æ•°æ®ç±»å‹ï¼Œåœ¨è¿›è¡Œå­—ç¬¦ä¿®æ”¹çš„æ—¶å€™ï¼Œ ä¼šé¦–å…ˆæ ¹æ®è®°å½•çš„ lenå±æ€§æ£€æŸ¥å†…å­˜ç©ºé—´æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œä¼šè¿›è¡Œç›¸åº”çš„ç©ºé—´æ‰©å±•ï¼Œç„¶ååœ¨è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºã€‚ 3ã€å‡å°‘ä¿®æ”¹å­—ç¬¦ä¸²æ—¶å¸¦æ¥çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°Cè¯­è¨€ç”±äºä¸è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®æ”¹å­—ç¬¦ä¸²ï¼Œå¿…é¡»è¦é‡æ–°åˆ†é…å†…å­˜ï¼ˆå…ˆé‡Šæ”¾å†ç”³è¯·ï¼‰ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰é‡æ–°åˆ†é…ï¼Œå­—ç¬¦ä¸²é•¿åº¦å¢å¤§æ—¶ä¼šé€ æˆå†…å­˜ç¼“å†²åŒºæº¢å‡ºï¼Œå­—ç¬¦ä¸²é•¿åº¦å‡å°æ—¶ä¼šé€ æˆå†…å­˜æ³„éœ²ã€‚è€Œå¯¹äºSDSï¼Œç”±äºlenå±æ€§å’Œfreeå±æ€§çš„å­˜åœ¨ï¼Œå¯¹äºä¿®æ”¹å­—ç¬¦ä¸²SDSå®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ç­–ç•¥ï¼š 3.1 å­—ç¬¦ä¸²é•¿åº¦å¢åŠ æ“ä½œæ—¶ï¼Œè¿›è¡Œç©ºé—´é¢„åˆ†é… å¯¹å­—ç¬¦ä¸²è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œæ‰©å±•çš„å†…å­˜æ¯”å®é™…éœ€è¦çš„å¤šï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ã€‚ 3.2 å­—ç¬¦ä¸²é•¿åº¦å‡å°‘æ“ä½œæ—¶ï¼Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼©çŸ­æ“ä½œæ—¶ï¼Œç¨‹åºä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡æ–°åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šä½™çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨ free å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•ä¸‹æ¥ï¼Œç­‰å¾…åç»­ä½¿ç”¨ã€‚ï¼ˆå½“ç„¶SDSä¹Ÿæä¾›äº†ç›¸åº”çš„APIï¼Œå½“æˆ‘ä»¬æœ‰éœ€è¦æ—¶ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡Šæ”¾è¿™äº›æœªä½¿ç”¨çš„ç©ºé—´ã€‚ 4ã€äºŒè¿›åˆ¶å®‰å…¨å› ä¸ºCå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡è¯†ï¼Œè€Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ç­‰ï¼‰ï¼Œå†…å®¹å¯èƒ½åŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼Œå› æ­¤Cå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®å­˜å–ï¼› è€Œæ‰€æœ‰ SDS çš„API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† buf é‡Œé¢çš„å…ƒç´ ï¼Œå¹¶ä¸” SDSä¸æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²æ¥åˆ¤æ–­æ˜¯å¦ç»“æŸï¼Œè€Œæ˜¯ä»¥ len å±æ€§è¡¨ç¤ºçš„é•¿åº¦æ¥åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ç»“æŸã€‚ 5ã€å…¼å®¹éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°è™½ç„¶ SDS æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸€æ ·éµä»æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ç©ºå­—ç¬¦ä¸²ç»“å°¾çš„æƒ¯ä¾‹ï¼Œè¿™æ ·å¯ä»¥é‡ç”¨ C è¯­è¨€åº“&lt;string.h&gt; ä¸­çš„ä¸€éƒ¨åˆ†å‡½æ•°ã€‚ ä¸ºä»€ä¹ˆå­—ç¬¦ä¸²é•¿åº¦å¤§äº44å°±æ˜¯ç”¨rawæ–¹å¼ç¼–ç è¿™ä¸ªæ˜¯å› ä¸ºCè¯­è¨€å‡½æ•°åº“åˆ†é…å†…å­˜çš„é•¿åº¦åªèƒ½æ˜¯2/4/8/16/32/64ï¼›æœ€å¤§åˆ†é…64ä½çš„é•¿åº¦ï¼›ä½†æ˜¯redisObjçš„é•¿åº¦åŠ ä¸Šå­—ç¬¦ä¸²å¯¹è±¡å¤´çš„é•¿åº¦ï¼Œå ç”¨20ä½ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²é•¿åº¦æœ€å¤šæ˜¯44ä½ï¼Œè¶…è¿‡è¿™ä¸ªé•¿åº¦ï¼Œå°±æ˜¯ç”¨rawæ–¹å¼è¿›è¡Œç¼–ç ï¼› â€“ ã€ŠRedisæ·±åº¦å†é™©-Stringæ•°æ®ç»“æ„ã€‹ å‚è€ƒèµ„æ–™1ã€ã€Šé—²æ‰¯RedisäºŒã€‹Stringæ•°æ®ç±»å‹ä¹‹åº•å±‚è§£æ2ã€æ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„RedisçŸ¥è¯† - Stringåº•å±‚åŸç†3ã€Redisè¯¦è§£ï¼ˆå››ï¼‰â€”â€” redisçš„åº•å±‚æ•°æ®ç»“æ„4ã€redis stringåº•å±‚æ•°æ®ç»“æ„","tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"}]},{"title":"Redis-overview","date":"2021-07-28T08:49:42.000Z","path":"wiki/Redis-overview/","text":"Redis ï¼ˆRemote Dictionary Serverï¼‰Redisç®€ä»‹Redis æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Key-Value ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒ memcachedï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ® flush åˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„ Key-Value DBã€‚Redis çš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedis æœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ª value çš„æœ€å¤§é™åˆ¶æ˜¯ 1GBï¼Œä¸åƒ memcached åªèƒ½ä¿å­˜ 1MB çš„æ•°æ®ï¼Œå› æ­¤ Redis å¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚æ¯”æ–¹è¯´ç”¨ä»–çš„ List æ¥åš FIFO åŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§ èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨ä»–çš„ Set å¯ä»¥åšé«˜æ€§èƒ½çš„ tag ç³»ç»Ÿç­‰ç­‰ã€‚å¦å¤– Redis ä¹Ÿå¯ä»¥å¯¹å­˜å…¥çš„ Key-Value è®¾ç½® expire æ—¶é—´ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«å½“ä½œä¸€ ä¸ªåŠŸèƒ½åŠ å¼ºç‰ˆçš„ memcached æ¥ç”¨ã€‚Redis çš„ä¸»è¦ç¼ºç‚¹æ˜¯æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤ Redis é€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚ Redis å¦‚ä½•è®¾ç½®å¯†ç åŠéªŒè¯å¯†ç ï¼Ÿè®¾ç½®å¯†ç ï¼šconfig set requirepass 123456æˆæƒå¯†ç ï¼šauth 123456 Redis æœ‰å“ªå‡ ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼Ÿnoeviction:è¿”å›é”™è¯¯å½“å†…å­˜é™åˆ¶è¾¾åˆ°å¹¶ä¸”å®¢æˆ·ç«¯å°è¯•æ‰§è¡Œä¼šè®©æ›´å¤šå†…å­˜è¢«ä½¿ç”¨çš„å‘½ä»¤ï¼ˆå¤§éƒ¨åˆ†çš„å†™å…¥æŒ‡ä»¤ï¼Œä½† DEL å’Œå‡ ä¸ªä¾‹å¤–ï¼‰allkeys-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚volatile-lru: å°è¯•å›æ”¶æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆLRUï¼‰ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚allkeys-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚volatile-random: å›æ”¶éšæœºçš„é”®ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ï¼Œä½†ä»…é™äºåœ¨è¿‡æœŸé›†åˆçš„é”®ã€‚volatile-ttl: å›æ”¶åœ¨è¿‡æœŸé›†åˆçš„é”®ï¼Œå¹¶ä¸”ä¼˜å…ˆå›æ”¶å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰è¾ƒçŸ­çš„é”®,ä½¿å¾—æ–°æ·»åŠ çš„æ•°æ®æœ‰ç©ºé—´å­˜æ”¾ã€‚ Redis æœ‰å“ªäº›é€‚åˆçš„åœºæ™¯ï¼Ÿï¼ˆ1ï¼‰ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨ Redis çš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨ Redis ç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚ Memcachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedis æä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨ Redis æ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸ºäººçŸ¥çš„å•†ä¸šå¹³å° Magento ä¹Ÿæä¾› Redis çš„æ’ä»¶ã€‚ ï¼ˆ2ï¼‰å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰é™¤åŸºæœ¬çš„ä¼šè¯ token ä¹‹å¤–ï¼ŒRedis è¿˜æä¾›å¾ˆç®€ä¾¿çš„ FPC å¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº† Redis å®ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼ PHP æœ¬åœ° FPCã€‚å†æ¬¡ä»¥ Magento ä¸ºä¾‹ï¼ŒMagento æä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨ Redis ä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚æ­¤å¤–ï¼Œå¯¹ WordPress çš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheon æœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚ ï¼ˆ3ï¼‰é˜Ÿåˆ—Redis åœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾— Redis èƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redis ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚ Pythonï¼‰å¯¹ list çš„ push/popæ“ä½œã€‚å¦‚æœä½ å¿«é€Ÿçš„åœ¨ Google ä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯åˆ©ç”¨ Redis åˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCelery æœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨ Redis ä½œä¸º brokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚ ï¼ˆ4ï¼‰æ’è¡Œæ¦œ/è®¡æ•°å™¨Redis åœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedis åªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„ 10 ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼šå½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§è¡Œï¼šZRANGE user_scores 0 10 WITHSCORESAgora Games å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨ Ruby å®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨ Redis æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚###ï¼ˆ5ï¼‰å‘å¸ƒ/è®¢é˜…æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯ Redis çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ/è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ/è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨ Redis çš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½æ¥å»ºç«‹èŠå¤©ç³»ç»Ÿï¼ Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ1ã€master æœ€å¥½ä¸è¦åšæŒä¹…åŒ–å·¥ä½œï¼Œå¦‚ RDB å†…å­˜å¿«ç…§å’Œ AOF æ—¥å¿—æ–‡ä»¶2ã€å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ª slave å¼€å¯ AOF å¤‡ä»½ï¼Œç­–ç•¥è®¾ç½®æˆæ¯ç§’åŒæ­¥ä¸€æ¬¡3ã€ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼Œmaster å’Œ Slave æœ€å¥½åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…4ã€å°½é‡é¿å…åœ¨å‹åŠ›å¤§å¾—ä¸»åº“ä¸Šå¢åŠ ä»åº“5ã€ä¸»ä»å¤åˆ¶ä¸è¦é‡‡ç”¨ç½‘çŠ¶ç»“æ„ï¼Œå°½é‡æ˜¯çº¿æ€§ç»“æ„ï¼ŒMaster&lt;â€“Slave1&lt;â€”-Slave2 â€¦.","tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"}]},{"title":"Redis-å“ˆå¸Œè¡¨å®ç°","date":"2021-07-28T08:46:45.000Z","path":"wiki/Redis-å“ˆå¸Œè¡¨å®ç°/","text":"Redisä¹‹Hashè¡¨åº•å±‚å®ç° å…³é”®è¯ å­—æ®µdict | æ¸è¿›å¼å“ˆå¸Œ | ziplist | å“ˆå¸Œè¡¨ å­—å…¸åº•å±‚ç»“æ„ dict å­—å…¸ç»“æ„ä½“12345678typedf struct dict&#123; dictType *type;//ç±»å‹ç‰¹å®šå‡½æ•°ï¼ŒåŒ…æ‹¬ä¸€äº›è‡ªå®šä¹‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°ä½¿å¾—keyå’Œ //valueèƒ½å¤Ÿå­˜å‚¨ void *private;//ç§æœ‰æ•°æ® dictht ht[2];//ä¸¤å¼ hashè¡¨ int rehashidx;//rehashç´¢å¼•ï¼Œå­—å…¸æ²¡æœ‰è¿›è¡Œrehashæ—¶ï¼Œæ­¤å€¼ä¸º-1 unsigned long iterators; //æ­£åœ¨è¿­ä»£çš„è¿­ä»£å™¨æ•°é‡&#125;dict; typeå’Œprivateè¿™ä¸¤ä¸ªå±æ€§æ˜¯ä¸ºäº†å®ç°å­—å…¸å¤šæ€è€Œè®¾ç½®çš„ï¼Œå½“å­—å…¸ä¸­å­˜æ”¾ç€ä¸åŒç±»å‹çš„å€¼ï¼Œå¯¹åº”çš„ä¸€äº›å¤åˆ¶ï¼Œæ¯”è¾ƒå‡½æ•°ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™ä¸¤ä¸ªå±æ€§é…åˆèµ·æ¥å¯ä»¥å®ç°å¤šæ€çš„æ–¹æ³•è°ƒç”¨ï¼› ht[2]ï¼Œä¸¤ä¸ªhashè¡¨ rehashidxï¼Œè¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å˜é‡ï¼Œç”¨äºè®°å½•rehashè¿‡ç¨‹çš„è¿›åº¦ï¼Œä»¥åŠæ˜¯å¦æ­£åœ¨è¿›è¡Œrehashç­‰ä¿¡æ¯ï¼Œå½“æ­¤å€¼ä¸º-1æ—¶ï¼Œè¡¨ç¤ºè¯¥dictæ­¤æ—¶æ²¡æœ‰rehashè¿‡ç¨‹ iteratorsï¼Œè®°å½•æ­¤æ—¶dictæœ‰å‡ ä¸ªè¿­ä»£å™¨æ­£åœ¨è¿›è¡Œéå†è¿‡ç¨‹ dictht å“ˆå¸Œè¡¨ç»“æ„ä½“1234567typedf struct dictht&#123; dictEntry **table;//å­˜å‚¨æ•°æ®çš„æ•°ç»„ äºŒç»´ unsigned long size;//æ•°ç»„çš„å¤§å° unsigned long sizemask;//å“ˆå¸Œè¡¨çš„å¤§å°çš„æ©ç ï¼Œç”¨äºè®¡ç®—ç´¢å¼•å€¼ï¼Œæ€»æ˜¯ç­‰äº //size-1 unsigned long used;//// å“ˆå¸Œè¡¨ä¸­ä¸­å…ƒç´ ä¸ªæ•°&#125;dictht; dictEntry å“ˆå¸Œæ•°ç»„ç»“æ„12345678910typedf struct dictEntry&#123; void *key;//é”® union&#123; void val; unit64_t u64; int64_t s64; double d; &#125;v;//å€¼ struct dictEntry *nextï¼›//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆ&#125;dictEntry; æ³¨æ„è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬çŸ¥é“å“ˆå¸Œè¡¨æœ€å¤§çš„é—®é¢˜æ˜¯å­˜åœ¨å“ˆå¸Œå†²çªï¼Œå¦‚ä½•è§£å†³å“ˆå¸Œå†²çªï¼Œæœ‰å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ã€‚è¿™é‡Œé‡‡ç”¨çš„ä¾¿æ˜¯é“¾åœ°å€æ³•ï¼Œé€šè¿‡nextè¿™ä¸ªæŒ‡é’ˆå¯ä»¥å°†å¤šä¸ªå“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨æ¥è§£å†³å“ˆå¸Œå†²çªã€‚ æ‰©å®¹ä¸ç¼©å®¹å½“å“ˆå¸Œè¡¨ä¿å­˜çš„é”®å€¼å¯¹å¤ªå¤šæˆ–è€…å¤ªå°‘æ—¶ï¼Œå°±è¦é€šè¿‡ rerehash(é‡æ–°æ•£åˆ—ï¼‰æ¥å¯¹å“ˆå¸Œè¡¨è¿›è¡Œç›¸åº”çš„æ‰©å±•æˆ–è€…æ”¶ç¼©ã€‚å…·ä½“æ­¥éª¤ï¼š 1ã€å¦‚æœæ‰§è¡Œæ‰©å±•æ“ä½œï¼Œä¼šåŸºäºåŸå“ˆå¸Œè¡¨åˆ›å»ºä¸€ä¸ªå¤§å°ç­‰äº ht[0].used*2n çš„å“ˆå¸Œè¡¨ï¼ˆä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰©å±•éƒ½æ˜¯æ ¹æ®åŸå“ˆå¸Œè¡¨å·²ä½¿ç”¨çš„ç©ºé—´æ‰©å¤§ä¸€å€åˆ›å»ºå¦ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼‰ã€‚ç›¸åå¦‚æœæ‰§è¡Œçš„æ˜¯æ”¶ç¼©æ“ä½œï¼Œæ¯æ¬¡æ”¶ç¼©æ˜¯æ ¹æ®å·²ä½¿ç”¨ç©ºé—´ç¼©å°ä¸€å€åˆ›å»ºä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨ã€‚2ã€é‡æ–°åˆ©ç”¨ä¸Šé¢çš„å“ˆå¸Œç®—æ³•ï¼Œè®¡ç®—ç´¢å¼•å€¼ï¼Œç„¶åå°†é”®å€¼å¯¹æ”¾åˆ°æ–°çš„å“ˆå¸Œè¡¨ä½ç½®ä¸Šã€‚3ã€æ‰€æœ‰é”®å€¼å¯¹éƒ½è¿å¾™å®Œæ¯•åï¼Œé‡Šæ”¾åŸå“ˆå¸Œè¡¨çš„å†…å­˜ç©ºé—´ã€‚ è§¦å‘æ‰©å®¹çš„æ¡ä»¶ï¼š 1ã€æœåŠ¡å™¨ç›®å‰æ²¡æœ‰æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œå¹¶ä¸”è´Ÿè½½å› å­å¤§äºç­‰äº1ã€‚ 2ã€æœåŠ¡å™¨ç›®å‰æ­£åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œå¹¶ä¸”è´Ÿè½½å› å­å¤§äºç­‰äº5ã€‚psï¼šè´Ÿè½½å› å­ = å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°ã€‚ ä¸ºä»€ä¹ˆæ‰©å®¹çš„æ—¶å€™è¦è€ƒè™‘BIGSAVEçš„å½±å“ï¼Œè€Œç¼©å®¹æ—¶ä¸éœ€è¦ï¼Ÿ BGSAVEæ—¶ï¼Œdictè¦æ˜¯è¿›è¡Œæ‰©å®¹ï¼Œåˆ™æ­¤æ—¶å°±éœ€è¦ä¸ºdictht[1]åˆ†é…å†…å­˜ï¼Œè‹¥æ˜¯dictht[0]çš„æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå°±ä¼šå ç”¨æ›´å¤šç³»ç»Ÿå†…å­˜ï¼Œé€ æˆå†…å­˜é¡µè¿‡å¤šåˆ†ç¦»ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç³»ç»Ÿè€—è´¹æ›´å¤šçš„å¼€é”€å»å›æ”¶å†…å­˜ï¼Œæ­¤æ—¶æœ€å¥½ä¸è¦è¿›è¡Œæ‰©å®¹ï¼› ç¼©å®¹æ—¶ï¼Œç»“åˆç¼©å®¹çš„æ¡ä»¶ï¼Œæ­¤æ—¶è´Ÿè½½å› å­&lt;0.1ï¼Œè¯´æ˜æ­¤æ—¶dictä¸­æ•°æ®å¾ˆå°‘ï¼Œå°±ç®—ä¸ºdictht[1]åˆ†é…å†…å­˜ï¼Œä¹Ÿæ¶ˆè€—ä¸äº†å¤šå°‘èµ„æºï¼› æ¸è¿›å¼å“ˆå¸Œä»€ä¹ˆå«æ¸è¿›å¼ rehashï¼Ÿä¹Ÿå°±æ˜¯è¯´æ‰©å®¹å’Œæ”¶ç¼©æ“ä½œä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼å®Œæˆçš„ï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼å®Œæˆçš„ã€‚å¦‚æœä¿å­˜åœ¨Redisä¸­çš„é”®å€¼å¯¹åªæœ‰å‡ ä¸ªå‡ åä¸ªï¼Œé‚£ä¹ˆ rehash æ“ä½œå¯ä»¥ç¬é—´å®Œæˆï¼Œä½†æ˜¯å¦‚æœé”®å€¼å¯¹æœ‰å‡ ç™¾ä¸‡ï¼Œå‡ åƒä¸‡ç”šè‡³å‡ äº¿ï¼Œé‚£ä¹ˆè¦ä¸€æ¬¡æ€§çš„è¿›è¡Œ rehashï¼ŒåŠ¿å¿…ä¼šé€ æˆRedisä¸€æ®µæ—¶é—´å†…ä¸èƒ½è¿›è¡Œåˆ«çš„æ“ä½œã€‚æ‰€ä»¥Redisé‡‡ç”¨æ¸è¿›å¼ rehash,è¿™æ ·åœ¨è¿›è¡Œæ¸è¿›å¼rehashæœŸé—´ï¼Œå­—å…¸çš„åˆ é™¤æŸ¥æ‰¾æ›´æ–°ç­‰æ“ä½œå¯èƒ½ä¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡Œï¼Œç¬¬ä¸€ä¸ªå“ˆå¸Œè¡¨æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¼šå»ç¬¬äºŒä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡ŒæŸ¥æ‰¾ã€‚ä½†æ˜¯è¿›è¡Œå¢åŠ æ“ä½œï¼Œä¸€å®šæ˜¯åœ¨æ–°çš„å“ˆå¸Œè¡¨ä¸Šè¿›è¡Œçš„ã€‚ æ¸è¿›å¼å“ˆå¸Œå…¶å®å°±æ˜¯æ…¢æ…¢çš„ï¼Œä¸€æ­¥ä¸€æ­¥çš„å°†hashè¡¨çš„æ•°æ®è¿ç§»åˆ°å¦ä¸€ä¸ªhashè¡¨ä¸­ redisä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»æ£€æµ‹æ˜¯å¦éœ€è¦è¿›è¡Œrehash rehashçš„è¿‡ç¨‹ä¸­ä¼šåœ¨å­—å…¸dictä¸­ç»´æŠ¤ä¸€ä¸ªrehashidxçš„æ ‡å¿— åœ¨rehashçš„è¿‡ç¨‹ä¸­ï¼Œä¸¤ä¸ªhashè¡¨ä¸­éƒ½ä¼šæœ‰æ•°æ®ï¼Œæ­¤æ—¶å¦‚æœæœ‰æ•°æ®æ–°å¢ï¼Œå°†ä¼šå­˜åœ¨ht[1]ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªå“ˆå¸Œè¡¨ä¸Šï¼› åœ¨rehashçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰åˆ æ”¹æŸ¥ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©ç¬¬ä¸€å¼ è¡¨ï¼Œå¦‚æœç¬¬ä¸€å¼ è¡¨æ²¡æœ‰æŸ¥åˆ°æ•°æ®ï¼Œåˆ™æŸ¥æ‰¾ç¬¬äºŒç« å“ˆå¸Œè¡¨ï¼› å‚è€ƒèµ„æ–™1ã€Redisè¯¦è§£ï¼ˆå››ï¼‰â€”â€” redisçš„åº•å±‚æ•°æ®ç»“æ„2ã€Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹hash3ã€Redis Hashæ•°æ®ç»“æ„çš„åº•å±‚å®ç°4ã€å›¾è§£redisäº”ç§æ•°æ®ç»“æ„åº•å±‚å®ç°(åŠ¨å›¾å“¦)5ã€redis hashåº•å±‚æ•°æ®ç»“æ„6ã€Redisåº•å±‚æ•°æ®ç»“æ„ä¹‹hash","tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"}]},{"title":"Redis-liståº•å±‚å®ç°","date":"2021-07-28T08:45:33.000Z","path":"wiki/Redis-liståº•å±‚å®ç°/","text":"Redis List åº•å±‚å®ç° å…³é”®å­— è¿é”æ›´æ–°é—®é¢˜ | quicklist | ziplist | linkedlist Liståº•å±‚æ•°æ®ç»“æ„åœ¨ 3.0 ç‰ˆæœ¬çš„ Redis ä¸­ï¼ŒList ç±»å‹æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šæ•°æ®ç»“æ„åº•å±‚é‡‡ç”¨å‹ç¼©åˆ—è¡¨ziplistæˆ–linkedlistä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨ï¼Œé¦–å…ˆä»¥ziplistè¿›è¡Œå­˜å‚¨ï¼Œåœ¨ä¸æ»¡è¶³ziplistçš„å­˜å‚¨è¦æ±‚åè½¬æ¢ä¸ºlinkedliståˆ—è¡¨ã€‚å½“åˆ—è¡¨å¯¹è±¡åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œåˆ—è¡¨å¯¹è±¡ä½¿ç”¨ziplistè¿›è¡Œå­˜å‚¨ï¼Œå¦åˆ™ç”¨linkedlistå­˜å‚¨ã€‚ ziplistè½¬æ¢æˆlinkedlistçš„æ¡ä»¶1ã€è§¦å‘ä¸€ä¸‹ä»»æ„ä¸€æ¡å³è¿›è¡Œè½¬æ¢ï¼š åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å°äº64å­—èŠ‚ åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚ 2ã€redis.confé…ç½®æ–‡ä»¶ 12list-max-ziplist-value 64 list-max-ziplist-entries 512 3ã€ziplistå’Œlinkedliståº•å±‚å®ç°1ã€ä½¿ç”¨å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰å®ç°çš„åˆ—è¡¨å¯¹è±¡ã€‚2ã€ä½¿ç”¨åŒç«¯é“¾è¡¨ï¼ˆlinkedlistï¼‰å®ç°çš„åˆ—è¡¨å¯¹è±¡ã€‚ åœ¨ 3.2 ç‰ˆæœ¬åæ–°å¢äº† quicklist æ•°æ®ç»“æ„å®ç°äº† listï¼Œç°åœ¨å°±æ¥åˆ†æä¸‹ quicklist çš„ç»“æ„ã€‚ quicklistziplistä¼šå¼•å…¥é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾ï¼Œè€Œlinkedlistç”±äºæŒ‡é’ˆä¹Ÿä¼šé€ æˆå†…å­˜çš„æµªè´¹ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹æ˜¯å•ç‹¬å­˜åœ¨çš„ï¼Œä¼šé€ æˆå¾ˆå¤šå†…å­˜ç¢ç‰‡ï¼Œæ‰€ä»¥ç»“åˆä¸¤ä¸ªç»“æ„çš„ç‰¹ç‚¹ï¼Œè®¾è®¡äº†quickListã€‚quickList æ˜¯ä¸€ä¸ª ziplist ç»„æˆçš„åŒå‘é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ä½¿ç”¨ ziplist æ¥ä¿å­˜æ•°æ®ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œ quicklist é‡Œé¢ä¿å­˜ç€ä¸€ä¸ªä¸€ä¸ªå°çš„ ziplistã€‚ quicklistè¡¨å¤´ç»“æ„12345678910111213141516171819typedef struct quicklist &#123; //æŒ‡å‘å¤´éƒ¨(æœ€å·¦è¾¹)quicklistèŠ‚ç‚¹çš„æŒ‡é’ˆ quicklistNode *head; //æŒ‡å‘å°¾éƒ¨(æœ€å³è¾¹)quicklistèŠ‚ç‚¹çš„æŒ‡é’ˆ quicklistNode *tail; //ziplistä¸­çš„entryèŠ‚ç‚¹è®¡æ•°å™¨ unsigned long count; /* total count of all entries in all ziplists */ //quicklistçš„quicklistNodeèŠ‚ç‚¹è®¡æ•°å™¨ unsigned int len; /* number of quicklistNodes */ //ä¿å­˜ziplistçš„å¤§å°ï¼Œé…ç½®æ–‡ä»¶è®¾å®šï¼Œå 16bits int fill : 16; /* fill factor for individual nodes */ //ä¿å­˜å‹ç¼©ç¨‹åº¦å€¼ï¼Œé…ç½®æ–‡ä»¶è®¾å®šï¼Œå 16bitsï¼Œ0è¡¨ç¤ºä¸å‹ç¼© unsigned int compress : 16; /* depth of end nodes not to compress;0=off */&#125; quicklist; head å’Œ tail åˆ†åˆ«æŒ‡å‘è¿™ä¸ªåŒç«¯é“¾è¡¨çš„è¡¨å¤´å’Œè¡¨å°¾, quicklist å­˜å‚¨çš„èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå«åš quicklistNode çš„ç»“æ„, å¦‚æœè¿™ä¸ª quicklist æ˜¯ç©ºçš„,é‚£ä¹ˆ head å’Œ tail ä¼šåŒæ—¶æˆä¸ºç©ºæŒ‡é’ˆ, å¦‚æœè¿™ä¸ªåŒç«¯é“¾è¡¨çš„å¤§å°ä¸º 1, é‚£ä¹ˆ head å’Œ tail ä¼šåŒæ—¶æŒ‡å‘ä¸€ä¸ªç›¸åŒçš„èŠ‚ç‚¹ count æ˜¯ä¸€ä¸ªè®¡æ•°å™¨, è¡¨ç¤ºå½“å‰è¿™ä¸ª list ç»“æ„ä¸€å…±å­˜å‚¨äº†å¤šå°‘ä¸ªå…ƒç´ , å®ƒçš„ç±»å‹æ˜¯ unsigned long, æ‰€ä»¥ä¸€ä¸ª list èƒ½å­˜å‚¨çš„æœ€å¤šçš„å…ƒç´ åœ¨ å­—é•¿ä¸º 64 bit çš„æœºå™¨ä¸Šæ˜¯ (1 &lt;&lt; 64) - 1, å­—é•¿ä¸º 32 bit çš„æœºå™¨ä¸Šæ˜¯ (1 &lt;&lt; 32) - 1 len è¡¨ç¤ºäº†è¿™ä¸ªåŒç«¯é“¾è¡¨çš„é•¿åº¦(quicklistNodes çš„æ•°é‡) fill è¡¨ç¤ºäº†å•ä¸ªèŠ‚ç‚¹(quicklistNode)çš„è´Ÿè½½æ¯”ä¾‹(fill factor), è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ Lists ç»“æ„ä½¿ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„ç¼–ç æ–¹å¼æ¥èŠ‚çœç©ºé—´, Lists ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹æ‰€èƒ½å­˜å‚¨çš„ä¸œè¥¿å¯ä»¥é€šè¿‡æœ€å¤§é•¿åº¦æˆ–è€…ä¸€ä¸ªæœ€å¤§å­˜å‚¨çš„ç©ºé—´å¤§å°æ¥é™åˆ¶,å¯¹äºæƒ³é™åˆ¶æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§å­˜å‚¨ç©ºé—´çš„ç”¨æˆ·, ç”¨ -5 åˆ° -1 æ¥è¡¨ç¤ºè¿™ä¸ªé™åˆ¶å€¼ 5: æœ€å¤§å­˜å‚¨ç©ºé—´: 64 Kb &lt;â€“ é€šå¸¸æƒ…å†µä¸‹ä¸è¦è®¾ç½®è¿™ä¸ªå€¼ 4: æœ€å¤§å­˜å‚¨ç©ºé—´: 32 Kb &lt;â€“ éå¸¸ä¸æ¨è 3: æœ€å¤§å­˜å‚¨ç©ºé—´: 16 Kb &lt;â€“ ä¸æ¨è 2: æœ€å¤§å­˜å‚¨ç©ºé—´: 8 Kb &lt;â€“ æ¨è 1: æœ€å¤§å­˜å‚¨ç©ºé—´: 4 Kb &lt;â€“ æ¨è å¯¹äºæ­£æ•´æ•°åˆ™è¡¨ç¤ºæœ€å¤šèƒ½å­˜å‚¨åˆ°ä½ è®¾ç½®çš„é‚£ä¸ªå€¼, å½“å‰çš„èŠ‚ç‚¹å°±è£…æ»¡äº†é€šå¸¸åœ¨ -2 (8 Kb size) æˆ– -1 (4 Kb size) æ—¶, æ€§èƒ½è¡¨ç°æœ€å¥½ä½†æ˜¯å¦‚æœä½ çš„ä½¿ç”¨åœºæ™¯éå¸¸ç‹¬ç‰¹çš„è¯, è°ƒæ•´åˆ°é€‚åˆä½ çš„åœºæ™¯çš„å€¼ï¼ï¼ï¼ï¼ redis.conf, å…¶ä¸­æœ‰ä¸€ä¸ªå¯é…ç½®çš„å‚æ•°å«åš list-max-ziplist-size, é»˜è®¤å€¼ä¸º -2, å®ƒæ§åˆ¶äº† quicklist ä¸­çš„ fill å­—æ®µçš„å€¼, è´Ÿæ•°é™åˆ¶ quicklistNode ä¸­çš„ ziplist çš„å­—èŠ‚é•¿åº¦, æ­£æ•°é™åˆ¶ quicklistNode ä¸­çš„ ziplist çš„æœ€å¤§é•¿åº¦ compress åˆ™è¡¨ç¤º quicklist ä¸­çš„èŠ‚ç‚¹ quicklistNode, é™¤å¼€æœ€ä¸¤ç«¯çš„ compress ä¸ªèŠ‚ç‚¹ä¹‹å, ä¸­é—´çš„èŠ‚ç‚¹éƒ½ä¼šè¢«å‹ç¼© Lists åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šè¢«å‹ç¼©çš„, å‹ç¼©æ·±åº¦æ˜¯è¡¨ç¤ºé™¤å¼€ list ä¸¤ä¾§çš„è¿™ä¹ˆå¤šä¸ªèŠ‚ç‚¹ä¸ä¼šè¢«å‹ç¼©, å‰©ä¸‹çš„èŠ‚ç‚¹éƒ½ä¼šè¢«å°è¯•è¿›è¡Œå‹ç¼©, å¤´å°¾ä¸¤ä¸ªèŠ‚ç‚¹ä¸€å®šä¸ä¼šè¢«è¿›è¡Œå‹ç¼©,å› ä¸ºè¦ä¿è¯ push/pop æ“ä½œçš„æ€§èƒ½, æœ‰ä»¥ä¸‹çš„å€¼å¯ä»¥è®¾ç½®:0: å…³é—­å‹ç¼©åŠŸèƒ½ 1: æ·±åº¦ 1 è¡¨ç¤ºè‡³å°‘åœ¨ 1 ä¸ªèŠ‚ç‚¹ä»¥åæ‰ä¼šå¼€å§‹å°è¯•å‹ç¼©, æ–¹å‘ä¸ºä»å¤´åˆ°å°¾æˆ–è€…ä»å°¾åˆ°å¤´ 12[head]-&gt;node-&gt;node-&gt;â€¦-&gt;node-&gt;[tail][head], [tail] æ°¸è¿œéƒ½æ˜¯ä¸ä¼šè¢«å‹ç¼©çš„çŠ¶æ€; ä¸­é—´çš„èŠ‚ç‚¹åˆ™ä¼šè¢«å‹ç¼© 2 ä¸ä¼šå°è¯•å‹ç¼© head æˆ–è€… head-&gt;next æˆ–è€… tail-&gt;prev æˆ–è€… tail ä½†æ˜¯ä¼šå‹ç¼©è¿™ä¸­é—´çš„æ‰€æœ‰èŠ‚ç‚¹ 1[head]-&gt;[next]-&gt;node-&gt;node-&gt;â€¦-&gt;node-&gt;[prev]-&gt;[tail] 3: ä»¥æ­¤ç±»æ¨ï¼Œæœ€å¤§ä¸º2çš„16æ¬¡æ–¹ã€‚ quicklistNode èŠ‚ç‚¹123456789101112131415161718192021222324252627282930typedef struct quicklistNode &#123; struct quicklistNode *prev; //å‰é©±èŠ‚ç‚¹æŒ‡é’ˆ struct quicklistNode *next; //åç»§èŠ‚ç‚¹æŒ‡é’ˆ //ä¸è®¾ç½®å‹ç¼©æ•°æ®å‚æ•°recompressæ—¶æŒ‡å‘ä¸€ä¸ªziplistç»“æ„ //è®¾ç½®å‹ç¼©æ•°æ®å‚æ•°recompressæŒ‡å‘quicklistLZFç»“æ„ unsigned char *zl; //å‹ç¼©åˆ—è¡¨ziplistçš„æ€»é•¿åº¦ unsigned int sz; /* ziplist size in bytes */ //ziplistä¸­åŒ…çš„èŠ‚ç‚¹æ•°ï¼Œå 16 bitsé•¿åº¦ unsigned int count : 16; /* count of items in ziplist */ //è¡¨ç¤ºæ˜¯å¦é‡‡ç”¨äº†LZFå‹ç¼©ç®—æ³•å‹ç¼©quicklistèŠ‚ç‚¹ï¼Œ1è¡¨ç¤ºå‹ç¼©è¿‡ï¼Œ2è¡¨ç¤ºæ²¡å‹ç¼©ï¼Œå 2 bitsé•¿åº¦ unsigned int encoding : 2; /* RAW==1 or LZF==2 */ //è¡¨ç¤ºä¸€ä¸ªquicklistNodeèŠ‚ç‚¹æ˜¯å¦é‡‡ç”¨ziplistç»“æ„ä¿å­˜æ•°æ®ï¼Œ2è¡¨ç¤ºå‹ç¼©äº†ï¼Œ1è¡¨ç¤ºæ²¡å‹ç¼©ï¼Œé»˜è®¤æ˜¯2ï¼Œå 2bitsé•¿åº¦ unsigned int container : 2; /* NONE==1 or ZIPLIST==2 */ //æ ‡è®°quicklistèŠ‚ç‚¹çš„ziplistä¹‹å‰æ˜¯å¦è¢«è§£å‹ç¼©è¿‡ï¼Œå 1bité•¿åº¦ //å¦‚æœrecompressä¸º1ï¼Œåˆ™ç­‰å¾…è¢«å†æ¬¡å‹ç¼© unsigned int recompress : 1; /* was this node previous compressed? */ //æµ‹è¯•æ—¶ä½¿ç”¨ unsigned int attempted_compress : 1; /* node can&#x27;t compress; too small */ //é¢å¤–æ‰©å±•ä½ï¼Œå 10bitsé•¿åº¦ unsigned int extra : 10; /* more bits to steal for future usage */&#125; quicklistNode; prev å’Œ next åˆ†åˆ«æŒ‡å‘å½“å‰ quicklistNode çš„å‰ä¸€ä¸ªå’Œåä¸€ä¸ªèŠ‚ç‚¹ zl æŒ‡å‘å®é™…çš„ ziplist sz å­˜å‚¨äº†å½“å‰è¿™ä¸ª ziplist çš„å ç”¨ç©ºé—´çš„å¤§å°, å•ä½æ˜¯å­—èŠ‚ count è¡¨ç¤ºå½“å‰æœ‰å¤šå°‘ä¸ªå…ƒç´ å­˜å‚¨åœ¨è¿™ä¸ªèŠ‚ç‚¹çš„ ziplist ä¸­, å®ƒæ˜¯ä¸€ä¸ª 16 bit å¤§å°çš„å­—æ®µ, æ‰€ä»¥ä¸€ä¸ª quicklistNode æœ€å¤šä¹Ÿåªèƒ½å­˜å‚¨ 65536 ä¸ªå…ƒç´  encoding è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸­çš„ ziplist çš„ç¼–ç æ–¹å¼, 1(RAW) è¡¨ç¤ºé»˜è®¤çš„æ–¹å¼å­˜å‚¨, 2(LZF) è¡¨ç¤ºç”¨ LZF ç®—æ³•å‹ç¼©åè¿›è¡Œçš„å­˜å‚¨ container è¡¨ç¤º quicklistNode å½“å‰ä½¿ç”¨å“ªç§æ•°æ®ç»“æ„è¿›è¡Œå­˜å‚¨çš„, ç›®å‰æ”¯æŒçš„ä¹Ÿæ˜¯é»˜è®¤çš„å€¼ä¸º 2(ZIPLIST), æœªæ¥ä¹Ÿè®¸ä¼šå¼•å…¥æ›´å¤šå…¶ä»–çš„ç»“æ„ recompress æ˜¯ä¸€ä¸ª 1 bit å¤§å°çš„å¸ƒå°”å€¼, å®ƒè¡¨ç¤ºå½“å‰çš„ quicklistNode æ˜¯ä¸æ˜¯å·²ç»è¢«è§£å‹å‡ºæ¥ä½œä¸´æ—¶ä½¿ç”¨ attempted_compress åªåœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ extra æ˜¯å‰©ä¸‹å¤šå‡ºæ¥çš„ bit, å¯ä»¥ç•™ä½œæœªæ¥ä½¿ç”¨ quicklistLZF ç»“æ„å®šä¹‰1234Copytypedef struct quicklistLZF &#123; unsigned int sz; //å‹ç¼©åçš„ziplistå¤§å° char compressed[];//æŸ”æ€§æ•°ç»„ï¼Œå­˜æ”¾å‹ç¼©åçš„ziplistå­—èŠ‚æ•°ç»„&#125; quicklistLZF; å½“æŒ‡å®šä½¿ç”¨lzfå‹ç¼©ç®—æ³•å‹ç¼©ziplistçš„entryèŠ‚ç‚¹æ—¶ï¼ŒquicklistNodeç»“æ„çš„zlæˆå‘˜æŒ‡å‘quicklistLZFç»“æ„; å‚è€ƒèµ„æ–™1ã€Redisåˆ—è¡¨list åº•å±‚åŸç†2ã€Redisä¸­stringã€listçš„åº•å±‚æ•°æ®ç»“æ„åŸç†3ã€ã€Šé—²æ‰¯Redisäº”ã€‹Listæ•°æ®ç±»å‹åº•å±‚ä¹‹quicklist4ã€Redisæºç å‰–æå’Œæ³¨é‡Šï¼ˆä¸ƒï¼‰â€” å¿«é€Ÿåˆ—è¡¨(quicklist)5ã€redis åˆ—è¡¨ç»“æ„ åº•å±‚å®ç°(quicklist)","tags":[{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"}]},{"title":"kafkaå®‰è£…ä¸åˆä½“éªŒ","date":"2021-07-28T08:43:24.000Z","path":"wiki/kafkaå®‰è£…ä¸åˆä½“éªŒ/","text":"Kafkaçš„å®‰è£…å®‰è£…zookeeper1brew install zookeeper é»˜è®¤ç«¯å£ï¼š2181é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/local/Cellar/zookeeperé…ç½®æ–‡ä»¶ä½ç½®ï¼š/usr/local/etc/zookeeperæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/usr/local/var/log/zookeeper/zookeeper.log å¯åŠ¨zookeeper1nohup zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties &amp; å®‰è£…Kafka1brew install kafka é»˜è®¤ç«¯å£ï¼š9092é»˜è®¤å®‰è£…ä½ç½®ï¼š/usr/local/Cellar/kafkaé…ç½®æ–‡ä»¶ä½ç½®ï¼š/usr/local/etc/kafkaæ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š/usr/local/var/lib/kafka-logs å¯åŠ¨kafkanohup kafka-server-start /usr/local/etc/kafka/server.properties &amp; è®¢é˜…å‘å¸ƒDemoåˆ›å»ºä¸€ä¸ªTopic1kafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test æŸ¥çœ‹åˆ›å»ºçš„Topic1kafka-topics --list --zookeeper localhost:2181 ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯1kafka-console-producer --broker-list localhost:9092 --topic test æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯1kafka-console-consumer --bootstrap-server 127.0.0.1:9092 --topic test1 --from-beginning â€“from-beginning: å°†ä»ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹æ¥æ”¶ SpringBooté›†æˆKafkaæºç åœ°å€ï¼šhttps://gitee.com/IBLiplus/kafka-demo.gité¡¹ç›®å¯åŠ¨å‰æŒ‰ç…§ä¸Šè¿°å®‰è£…å¯åŠ¨æ­¥éª¤ï¼Œåœ¨æœ¬åœ°å¯åŠ¨kafka.åˆ›å»ºMavené¡¹ç›®ï¼Œå¼•å…¥ä¸€ä¸‹ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;pring-kafka&lt;/artifactId&gt; &lt;version&gt;2.5.7.RELEASE&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œç«¯å£å·å¯ä»¥è‡ªå·±å®šé…ç½®æ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233server.port=9010spring.kafka.bootstrap-servers= 127.0.0.1:9092# å‘ç”Ÿé”™è¯¯åï¼Œæ¶ˆæ¯é‡å‘çš„æ¬¡æ•°ã€‚spring.kafka.producer.retries= 0#å½“æœ‰å¤šä¸ªæ¶ˆæ¯éœ€è¦è¢«å‘é€åˆ°åŒä¸€ä¸ªåˆ†åŒºæ—¶ï¼Œç”Ÿäº§è€…ä¼šæŠŠå®ƒä»¬æ”¾åœ¨åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œã€‚è¯¥å‚æ•°æŒ‡å®šäº†ä¸€ä¸ªæ‰¹æ¬¡å¯ä»¥ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼ŒæŒ‰ç…§å­—èŠ‚æ•°è®¡ç®—ã€‚spring.kafka.producer.batch-size= 16384# è®¾ç½®ç”Ÿäº§è€…å†…å­˜ç¼“å†²åŒºçš„å¤§å°ã€‚spring.kafka.producer.buffer-memory= 33554432# é”®çš„åºåˆ—åŒ–æ–¹å¼spring.kafka.producer.key-serializer= org.apache.kafka.common.serialization.StringSerializer# å€¼çš„åºåˆ—åŒ–æ–¹å¼spring.kafka.producer.value-serializer = org.apache.kafka.common.serialization.StringSerializer# acks=0 ï¼š ç”Ÿäº§è€…åœ¨æˆåŠŸå†™å…¥æ¶ˆæ¯ä¹‹å‰ä¸ä¼šç­‰å¾…ä»»ä½•æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚# acks=1 ï¼š åªè¦é›†ç¾¤çš„é¦–é¢†èŠ‚ç‚¹æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…å°±ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨æˆåŠŸå“åº”ã€‚# acks=all ï¼šåªæœ‰å½“æ‰€æœ‰å‚ä¸å¤åˆ¶çš„èŠ‚ç‚¹å…¨éƒ¨æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ‰ä¼šæ”¶åˆ°ä¸€ä¸ªæ¥è‡ªæœåŠ¡å™¨çš„æˆåŠŸå“åº”ã€‚spring.kafka.producer.acks= 1# è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš” åœ¨spring boot 2.X ç‰ˆæœ¬ä¸­è¿™é‡Œé‡‡ç”¨çš„æ˜¯å€¼çš„ç±»å‹ä¸ºDuration éœ€è¦ç¬¦åˆç‰¹å®šçš„æ ¼å¼ï¼Œå¦‚1S,1M,2H,5Dspring.kafka.consumer.auto-commit-interval= 1S# è¯¥å±æ€§æŒ‡å®šäº†æ¶ˆè´¹è€…åœ¨è¯»å–ä¸€ä¸ªæ²¡æœ‰åç§»é‡çš„åˆ†åŒºæˆ–è€…åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹è¯¥ä½œä½•å¤„ç†ï¼š# latestï¼ˆé»˜è®¤å€¼ï¼‰åœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»æœ€æ–°çš„è®°å½•å¼€å§‹è¯»å–æ•°æ®ï¼ˆåœ¨æ¶ˆè´¹è€…å¯åŠ¨ä¹‹åç”Ÿæˆçš„è®°å½•ï¼‰# earliest ï¼šåœ¨åç§»é‡æ— æ•ˆçš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…å°†ä»èµ·å§‹ä½ç½®è¯»å–åˆ†åŒºçš„è®°å½•spring.kafka.consumer.auto-offset-reset= earliest# æ˜¯å¦è‡ªåŠ¨æäº¤åç§»é‡ï¼Œé»˜è®¤å€¼æ˜¯true,ä¸ºäº†é¿å…å‡ºç°é‡å¤æ•°æ®å’Œæ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥æŠŠå®ƒè®¾ç½®ä¸ºfalse,ç„¶åæ‰‹åŠ¨æäº¤åç§»é‡spring.kafka.consumer.enable-auto-commit= false# é”®çš„ååºåˆ—åŒ–æ–¹å¼spring.kafka.consumer.key-deserializer= org.apache.kafka.common.serialization.StringDeserializer# å€¼çš„ååºåˆ—åŒ–æ–¹å¼spring.kafka.consumer.value-deserializer= org.apache.kafka.common.serialization.StringDeserializer# åœ¨ä¾¦å¬å™¨å®¹å™¨ä¸­è¿è¡Œçš„çº¿ç¨‹æ•°ã€‚spring.kafka.listener.concurrency= 5#listnerè´Ÿè´£ackï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±ç«‹å³commitspring.kafka.listener.ack-mode= manual_immediatespring.kafka.listener.missing-topics-fatal= false ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯ï¼š 123456789101112131415161718192021222324252627282930@Componentpublic class ProductDemo &#123; Logger log = LoggerFactory.getLogger(ProductDemo.class); @Resource private KafkaTemplate&lt;String, Object&gt; kafkaTemplate; //è‡ªå®šä¹‰topic public static final String TOPIC_TEST = &quot;topic.test&quot;; public static final String TOPIC_GROUP1 = &quot;topic.group1&quot;; public static final String TOPIC_GROUP2 = &quot;topic.group2&quot;; public void send(String obj) &#123; log.info(&quot;å‡†å¤‡å‘é€æ¶ˆæ¯ä¸ºï¼š&#123;&#125;&quot;, obj); //å‘é€æ¶ˆæ¯ ListenableFuture&lt;SendResult&lt;String, Object&gt;&gt; future = kafkaTemplate.send(TOPIC_TEST, obj); future.addCallback(new ListenableFutureCallback&lt;SendResult&lt;String, Object&gt;&gt;() &#123; @Override public void onFailure(Throwable throwable) &#123; //å‘é€å¤±è´¥çš„å¤„ç† log.info(TOPIC_TEST + &quot; - ç”Ÿäº§è€… å‘é€æ¶ˆæ¯å¤±è´¥ï¼š&quot; + throwable.getMessage()); &#125; @Override public void onSuccess(SendResult&lt;String, Object&gt; stringObjectSendResult) &#123; //æˆåŠŸçš„å¤„ç† log.info(TOPIC_TEST + &quot; - ç”Ÿäº§è€… å‘é€æ¶ˆæ¯æˆåŠŸï¼š&quot; + stringObjectSendResult.toString()); &#125; &#125;); &#125;&#125; æ¶ˆè´¹æ¶ˆæ¯ 1234567891011121314151617181920212223242526@Componentpublic class ConsumerDemo &#123; Logger log = LoggerFactory.getLogger(ConsumerDemo.class); @KafkaListener(topics = ProductDemo.TOPIC_TEST, groupId = ProductDemo.TOPIC_GROUP1) public void topic_test(ConsumerRecord&lt;?, ?&gt; record, Acknowledgment ack, @Header(KafkaHeaders.RECEIVED_TOPIC) String topic) &#123; Optional message = Optional.ofNullable(record.value()); if (message.isPresent()) &#123; Object msg = message.get(); log.info(&quot;topic_test æ¶ˆè´¹äº†ï¼š Topic:&quot; + topic + &quot;,Message:&quot; + msg); ack.acknowledge(); &#125; &#125; @KafkaListener(topics = ProductDemo.TOPIC_TEST, groupId = ProductDemo.TOPIC_GROUP2) public void topic_test1(ConsumerRecord&lt;?, ?&gt; record, Acknowledgment ack, @Header(KafkaHeaders.RECEIVED_TOPIC) String topic) &#123; Optional message = Optional.ofNullable(record.value()); if (message.isPresent()) &#123; Object msg = message.get(); log.info(&quot;topic_test1 æ¶ˆè´¹äº†ï¼š Topic:&quot; + topic + &quot;,Message:&quot; + msg); ack.acknowledge(); &#125; &#125;&#125; æµ‹è¯•æ¥å£ï¼š 123456789@Resourceprivate ProductDemo productDemo;@GetMapping(&quot;/kafka/test&quot;)public void testKafka()&#123; logger.info(&quot;start test&quot;); productDemo.send(&quot;hello kafka&quot;); logger.info(&quot;end test&quot;);&#125; å±±è„šå¤ªæ‹¥æŒ¤ æˆ‘ä»¬æ›´é«˜å¤„è§ã€‚","tags":[{"name":"kafka","slug":"kafka","permalink":"http://example.com/tags/kafka/"}],"categories":[{"name":"Distributed Dir","slug":"Distributed-Dir","permalink":"http://example.com/categories/Distributed-Dir/"},{"name":"Kafka","slug":"Distributed-Dir/Kafka","permalink":"http://example.com/categories/Distributed-Dir/Kafka/"}]},{"title":"dockeræ•´ä½“æ¶æ„å›¾","date":"2021-07-28T08:20:03.000Z","path":"wiki/dockeræ•´ä½“æ¶æ„å›¾/","text":"Dockerçš„æ€»æ¶æ„å›¾ dockeræ˜¯ä¸€ä¸ªC/Sæ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œæ¨¡å—å„å¸å…¶èŒã€‚ 1ã€ç”¨æˆ·æ˜¯ä½¿ç”¨Docker Clientä¸Docker Daemonå»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚2ã€Docker Daemonä½œä¸ºDockeræ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾›Serverçš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å—Docker Clientçš„è¯·æ±‚ï¼›3ã€Engineæ‰§è¡ŒDockerå†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ªJobçš„å½¢å¼çš„å­˜åœ¨ã€‚4ã€Jobçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä»Docker Registryä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨graphdriverå°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ï¼›5ã€å½“éœ€è¦ä¸ºDockeråˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨networkdriveråˆ›å»ºå¹¶é…ç½®Dockerå®¹å™¨ç½‘ç»œç¯å¢ƒï¼›6ã€å½“éœ€è¦é™åˆ¶Dockerå®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡execdriveræ¥å®Œæˆã€‚7ã€libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼Œnetworkdriverä»¥åŠexecdriveréƒ½æ˜¯é€šè¿‡libcontaineræ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚","tags":[{"name":"docker","slug":"docker","permalink":"http://example.com/tags/docker/"}],"categories":[{"name":"Develop Tools","slug":"Develop-Tools","permalink":"http://example.com/categories/Develop-Tools/"},{"name":"docker","slug":"Develop-Tools/docker","permalink":"http://example.com/categories/Develop-Tools/docker/"}]},{"title":"dockerå¸¸ç”¨æ‰‹å†Œ","date":"2021-07-28T07:54:20.000Z","path":"wiki/dockerå¸¸ç”¨æ‰‹å†Œ/","text":"dockerä¸­æ–‡æ–‡æ¡£ http://www.dockerinfo.net/documentdocker doc https://docs.docker.com/engine/reference/commandline/docker/docker ä¸­æ–‡ç¤¾åŒº https://www.docker.org.cn/ æœç´¢å¯ç”¨é•œåƒdocker search tutorial æ£€æŸ¥è¿è¡Œçš„é•œåƒdocker inspect efe å‘å¸ƒé•œåƒdocker push ä¸‹è½½é•œåƒdocker pull åœ¨å®¹å™¨ä¸­å®‰è£…æ–°çš„ç¨‹åºapt-get updateapt-get install vim ä¿å­˜å¯¹å®¹å™¨çš„ä¿®æ”¹docker commit pid","tags":[{"name":"docker","slug":"docker","permalink":"http://example.com/tags/docker/"}],"categories":[{"name":"Develop Tools","slug":"Develop-Tools","permalink":"http://example.com/categories/Develop-Tools/"},{"name":"docker","slug":"Develop-Tools/docker","permalink":"http://example.com/categories/Develop-Tools/docker/"}]},{"title":"docker-compostå®‰è£…mongodb","date":"2021-07-28T07:24:01.000Z","path":"wiki/docker-compostå®‰è£…mongodb/","text":"mongo é…ç½®æ–‡ä»¶ -&gt; https://www.cnblogs.com/xibuhaohao/p/12580331.html docker-compose é…ç½®æ–‡ä»¶123456789mongo: image: mongo:4.4.7 #æ ¹æ®éœ€è¦é€‰æ‹©è‡ªå·±çš„é•œåƒ ports: - 27017:27017 #å¯¹å¤–æš´éœ²åœä¾›æœåŠ¡çš„ç«¯å£ï¼Œæ­£å¼ç”Ÿäº§çš„æ—¶å€™ç†è®ºä¸ç”¨æš´éœ²ã€‚ volumes: - ./mongodb/data/db:/data/db # æŒ‚è½½æ•°æ®ç›®å½• - ./mongodb/data/log:/var/log/mongodb # æŒ‚è½½æ—¥å¿—ç›®å½• - ./mongodb/data/config:/etc/mongo # æŒ‚è½½é…ç½®ç›®å½• # command: --config /docker/mongodb/mongod.conf # é…ç½®æ–‡ä»¶ æŒ‰ç…§ä¸Šé¢ğŸ‘†é…ç½®æ–‡ä»¶è®¾ç½®ç›®å½•/data/db/mongodb/datals -lconfig db log mongo é…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526272829303132333435363738# Where and how to store data.storage: dbPath: /data/db/mongodb/data/db journal: enabled: true# engine:# mmapv1:# wiredTiger:# where to write logging data.systemLog: destination: file logAppend: true path: /data/db/mongodb/data/log# network interfacesnet: port: 27017 bindIp: 0.0.0.0# how the process runsprocessManagement: timeZoneInfo: /usr/share/zoneinfo#security:#operationProfiling:#replication:#sharding:## Enterprise-Only Options:#auditLog:#snmp: bindIp: 0.0.0.0 å…è®¸è¿œç¨‹è®¿é—® docker-composeå¯åŠ¨mongodocker-compose up -ddocker ps è¿›å…¥dockerdocker psdocker exec -it xxxxxxxxxx bash mongoåˆ›å»ºæ•°æ®åº“ç™»å½•mongo æŸ¥çœ‹æ•°æ®åº“show dbs åˆ›å»ºæ•°æ®åº“use wechat_spider ç„¶å db æŸ¥çœ‹ åˆ›å»ºç”¨æˆ·1234567db.createUser( &#123; user:&quot;wechat&quot;, pwd:&quot;123456&quot;, roles:[&#123;role:&quot;readWrite&quot;,db:&quot;wechat_spider&quot;&#125;] &#125; ) Javaå®¢æˆ·ç«¯é“¾æ¥é…ç½®mvn12345678910&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;pring-boot-starter-data-mongodb&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mongodb&lt;/groupId&gt; &lt;artifactId&gt;mongo-java-driver&lt;/artifactId&gt; &lt;version&gt;3.0.2&lt;/version&gt;&lt;/dependency&gt; é…ç½®æ–‡ä»¶12345678910111213spring: data: mongodb: username: &#x27;wechat&#x27; password: &#x27;123456&#x27;# port: 3333 port: 27017 database: wechat_spider# host: 123.56.77.177 host: 39.107.117.232 repositories: type: auto domain1234567891011121314151617181920212223242526272829import org.springframework.data.mongodb.core.mapping.Document;/** * @Author gaolei * @Date 2021/7/28 ä¸Šåˆ10:02 * @Version 1.0 */@Document(collection = &quot;passenger&quot;)public class Passenger &#123; private String name; private String password; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125;&#125; controller12345678910111213141516171819@RestControllerpublic class TestContoller &#123; @Autowired private MongoTemplate mongoTemplate; @RequestMapping(&quot;/insert&quot;) public String insert() &#123; Passenger passenger = new Passenger(); passenger.setName(&quot;hello&quot;); passenger.setPassword(&quot;world1&quot;); passenger = mongoTemplate.insert(passenger); if (passenger != null) &#123; return &quot;success&quot;; &#125; else &#123; return &quot;false&quot;; &#125; &#125;&#125;","tags":[{"name":"mongodb","slug":"mongodb","permalink":"http://example.com/tags/mongodb/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MongoDB","slug":"DataBase/MongoDB","permalink":"http://example.com/categories/DataBase/MongoDB/"}]},{"title":"åŸºäºBIOå®ç°ç®€æ˜“tomcat","date":"2021-07-28T07:11:55.000Z","path":"wiki/åŸºäºBIOå®ç°ç®€æ˜“tomcat/","text":"åŸºäºä¼ ç»Ÿçš„BIOæ‰‹å†™ä¸€ä¸ªç®€æ˜“Tomcatæœ¬æ–‡ä¸»è¦åŸºäºä¼ ç»Ÿçš„BIOæ¥å®ç°ä¸€ä¸ªç®€å•çš„Httpè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼›1ã€Servletè¯·æ±‚æ— éå°±æ˜¯doGet/doPostï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰æŠ½è±¡Servletè®°å¿†GET/POSTæ–¹æ³•ï¼›2ã€åŸºäºSocketå’ŒServerSocketå®ç°CSé€šä¿¡ï¼›3ã€æ¨¡æ‹ŸSpringåŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ³¨å†Œè¯·æ±‚ä»¥åŠæ§åˆ¶å™¨ï¼› GlRequest å°è£…ä¸€ä¸ªè¯·æ±‚ å½“ç„¶æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„è¯·æ±‚ï¼Œè¿™é‡Œåªå¤„ç†è¯·æ±‚çš„URLå’Œè¯·æ±‚æ–¹æ³•ï¼›è·å–è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥æµï¼Œè§£ææ•°æ®Urlå’ŒMethodï¼Œå¹¶åšç›¸åº”çš„å¤„ç†ï¼› 12345678910111213141516171819202122232425262728293031public class GlRequest &#123; private String url; private String method; public GlRequest(InputStream is) &#123; try &#123; // è§£æhttpè¯·æ±‚çš„å…·ä½“å†…å®¹ï¼› String content = &quot;&quot;; byte[] buff = new byte[1024]; int len = 0; if ((len = is.read(buff)) &gt; 0) &#123; content = new String(buff, 0, len); &#125; String line = content.split(&quot;\\\\n&quot;)[0]; String [] arr = line.split(&quot;\\\\s&quot;); this.method = arr[0]; this.url = arr[1].split(&quot;\\\\?&quot;)[0]; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public String getUrl() &#123; return this.url; &#125; public String getMethod() &#123; return this.method; &#125;&#125; GlResponse å®šä¹‰è¿”å›å€¼response å¤„ç†è¯·æ±‚è¿”å›å€¼ï¼Œå°†ä¸šåŠ¡å¤„ç†çš„ç»“æœé€šè¿‡è¾“å‡ºæµè¾“å‡ºï¼›è¾“å‡ºå¤§è‡´åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€æ˜¯è¿”å›çš„æ•°æ®ï¼Œç¬¬äºŒæ˜¯è¿”å›æ•°æ®çš„Header; 1234567891011121314151617public class GlResponse &#123; private OutputStream outputStream; public GlResponse(OutputStream os) &#123; this.outputStream = os; &#125; public void write(String string) throws Exception &#123; StringBuffer sb = new StringBuffer(); sb.append(&quot;HTTP/1.1 200 OK\\n&quot;) .append(&quot;Content-Type: text/html;\\n&quot;) .append(&quot;\\r\\n&quot;) .append(string); outputStream.write(sb.toString().getBytes()); &#125;&#125; GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³• å®šä¹‰æŠ½è±¡çš„Servletå’ŒdoGetæ–¹æ³•å’ŒdoPostæ–¹æ³•ï¼Œå…·ä½“çš„ä¸šåŠ¡å»å®ç°è‡ªå·±çš„æ–¹æ³•å’Œé€»è¾‘ï¼› 12345678910111213141516public abstract class GlServlet &#123; private final static String GET = &quot;GET&quot;; public void service(GlRequest request, GlResponse response) throws Exception &#123; if (GET.equals(request.getMethod())) &#123; doGet(request, response); &#125; else &#123; doPost(request, response); &#125; &#125; public abstract void doGet(GlRequest request, GlResponse response) throws Exception; public abstract void doPost(GlRequest request, GlResponse response) throws Exception; &#125; FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•12345678910111213public class FirstServlet extends GlServlet &#123; @Override public void doGet(GlRequest request, GlResponse response) throws Exception &#123; // å…·ä½“çš„é€»è¾‘ this.doPost(request, response); &#125; @Override public void doPost(GlRequest request, GlResponse response) throws Exception &#123; response.write(&quot;This is first servlet from BIO&quot;); &#125;&#125; SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•123456789101112public class SecondServlet extends GlServlet &#123; @Override public void doGet(GlRequest request, GlResponse response) throws Exception &#123; doPost(request,response); &#125; @Override public void doPost(GlRequest request, GlResponse response) throws Exception &#123; response.write(&quot;This second request form BIO&quot;); &#125;&#125; web-bio.properties é…ç½®æ–‡ä»¶ é…ç½®è¯·æ±‚å’Œå¤„ç†å™¨ï¼ŒSpringä¸­æ˜¯é€šè¿‡Controllerä¸‹çš„@XXXMappingæ³¨è§£å»æ‰«æå¹¶åŠ è½½åˆ°å·¥å‚çš„ï¼› 12345servlet.one.className=com.ibli.netty.tomcat.bio.servlet.FirstServletservlet.one.url=/firstServlet.doservlet.two.className=com.ibli.netty.tomcat.bio.servlet.SecondServletservlet.two.url=/secondServlet.do GlTomcatæµ‹è¯•ç±» å¯åŠ¨æœåŠ¡ç«¯ï¼Œåœ¨ç½‘é¡µä¸­è®¿é—®æœ¬åœ°8080ç«¯å£ï¼Œè¾“å…¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„urlè¿›è¡Œæµ‹è¯•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104public class GlTomcat &#123; private ServerSocket server; private final Integer PORT = 8080; private Properties webXml = new Properties(); private Map&lt;String, GlServlet&gt; servletMapping = new HashMap&lt;String, GlServlet&gt;(); /** * æ¨¡æ‹Ÿé¡¹ç›®mainæ–¹æ³•ï¼Œå¯åŠ¨åŠ è½½é…ç½® * * @param args å¯åŠ¨å‚æ•° */ public static void main(String[] args) &#123; new GlTomcat().start(); &#125; /** * Tomcatçš„å¯åŠ¨å…¥å£ */ private void start() &#123; //1ã€åŠ è½½webé…ç½®æ–‡ä»¶ï¼Œè§£æé…ç½® init(); //2ã€å¯åŠ¨æœåŠ¡å™¨socketï¼Œç­‰å¾…ç”¨æˆ·è¯·æ±‚ try &#123; server = new ServerSocket(this.PORT); System.err.println(&quot;Gl tomcat started in port &quot; + this.PORT); while (true) &#123; Socket client = server.accept(); // 3ã€è·å¾—è¯·æ±‚ä¿¡æ¯ï¼Œè§£æHTTPåè®®çš„å†…å®¹ process(client); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * åŠ è½½é…ç½®æ–‡ä»¶ */ private void init() &#123; try &#123; String WEB_INF = this.getClass().getResource(&quot;/&quot;).getPath(); FileInputStream fis = new FileInputStream(WEB_INF + &quot;web-bio.properties&quot;); webXml.load(fis); for (Object k : webXml.keySet()) &#123; String key = k.toString(); if (key.endsWith(&quot;.url&quot;)) &#123; //servlet.two.url String servletName = key.replaceAll(&quot;\\\\.url&quot;, &quot;&quot;); String url = webXml.getProperty(key); //servlet.two.className String className = webXml.getProperty(servletName + &quot;.className&quot;); //åå°„åˆ›å»ºservletå®ä¾‹ // load-on-startup &gt;=1 :webå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ– 0ï¼šç”¨æˆ·è¯·æ±‚çš„æ—¶å€™æ‰å¯åŠ¨ GlServlet obj = (GlServlet) Class.forName(className).newInstance(); // å°†urlå’Œservletå»ºç«‹æ˜ å°„å…³ç³» servletMapping.put(url, obj); &#125; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * è§£æå®¢æˆ·ç«¯è¯·æ±‚ * * @param client å®¢æˆ·ç«¯ */ private void process(Socket client) throws Exception &#123; InputStream is = null; OutputStream os = null; try &#123; //è¯·æ±‚ is = client.getInputStream(); //å°è£…è¿”å›å€¼ os = client.getOutputStream(); GlRequest request = new GlRequest(is); GlResponse response = new GlResponse(os); String url = request.getUrl(); if (servletMapping.containsKey(url)) &#123; servletMapping.get(url).service(request, response); &#125; else &#123; response.write(&quot;404 Not found!&quot;); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; if (os != null) &#123; os.flush(); os.close(); &#125; if (is != null) &#123; is.close(); client.close(); &#125; &#125; &#125;&#125; æ‰“å°è¯·æ±‚ä¿¡æ¯123456789101112Request content : GET /fitstServlet.do HTTP/1.1Host: localhost:8080Connection: keep-aliveUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36 OPR/74.0.3911.160Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflate, brAccept-Language: zh-CN,zh;q=0.9 å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŠç»“æœå±•ç¤º è¯·æ±‚ï¼š http://localhost:8080/firstServlet.do","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"nettyå®ç°ç®€æ˜“RPCè°ƒç”¨","date":"2021-07-27T12:01:08.000Z","path":"wiki/nettyå®ç°ç®€æ˜“RPCè°ƒç”¨/","text":"åŸºäºNettyæ‰‹å†™ä¸€ä¸ªRPCç®€æ˜“è¿œç¨‹è°ƒç”¨ æŠ½è±¡åè®®12345678910111213141516171819202122@Datapublic class InvokerProtocol implements Serializable &#123; // åŸºäºäºŒè¿›åˆ¶æµè°ƒç”¨åè®® /** * ç±»å */ private String className; /** * æ–¹æ³•å */ private String methodName; /** * å½¢å‚ */ private Class&lt;?&gt;[] params; /** * å®å‚ */ private Object[] values;&#125; æ³¨å†Œä¸­å¿ƒRpcRegistry åŸºäºNettyå®ç°çš„RPCæ³¨å†Œä¸­å¿ƒ 1ã€ ServerBootstrap å¯åŠ¨8080ç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯é“¾æ¥ï¼›2ã€ RegisterHandlerç”¨æ¥å¤„ç†RPCæ¥å£çš„å‘ç°å’Œæ³¨å†Œï¼› 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class RpcRegistry &#123; private Integer post; public RpcRegistry(Integer post) &#123; this.post = post; &#125; private void start() &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); ServerBootstrap server = new ServerBootstrap(); server.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new ChannelInitializer() &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; // æ¥å—å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç† ChannelPipeline pipeline = ch.pipeline(); //é…ç½®é€šç”¨è§£ç å™¨ int fieldLength = 4; pipeline.addLast(new LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, 0, fieldLength, 0, fieldLength)); pipeline.addLast(new LengthFieldPrepender(fieldLength)); //å¯¹è±¡ç¼–ç å™¨ pipeline.addLast(&quot;encoder&quot;, new ObjectEncoder()); pipeline.addLast(&quot;decoder&quot;, new ObjectDecoder(Integer.MAX_VALUE, ClassResolvers.cacheDisabled(null))); pipeline.addLast(new RegisterHandler()); &#125; &#125;) .option(ChannelOption.SO_BACKLOG, 128) .childOption(ChannelOption.SO_KEEPALIVE, true); try &#123; ChannelFuture future = server.bind(this.post).sync(); System.out.println(&quot;Rpc registry started in port &quot; + this.post); future.channel().closeFuture().sync(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125; public static void main(String[] args) &#123; new RpcRegistry(8080).start(); &#125; &#125; RegisterHandler æ‰§è¡ŒRPCçš„å‘ç°å’Œæ³¨å†Œ 1ã€æ‰«æå›ºå®šåŒ…ä¸‹æˆ–è€…è·¯å¾„ä¸‹çš„ç±»;2ã€æ¥å£ä¸ºkeyï¼Œå…·ä½“å®ä¾‹ä½œä¸ºvalueï¼› 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class RegisterHandler extends ChannelInboundHandlerAdapter &#123; /** * æ³¨å†Œä¸­å¿ƒå®¹å™¨ */ private static final ConcurrentHashMap&lt;String, Object&gt; REGISTRY_MAP = new ConcurrentHashMap&lt;String, Object&gt;(); private List&lt;String&gt; classNameList = new ArrayList&lt;String&gt;(); public RegisterHandler() &#123; // 1ã€æ‰«ææ‰€æœ‰éœ€è¦æ³¨å†Œçš„ç±» scannerClass(&quot;com.ibli.netty.rpc.provider&quot;); // æ‰§è¡Œæ³¨å†Œ doRegistry(); &#125; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; Object result; InvokerProtocol request = (InvokerProtocol) msg; if (REGISTRY_MAP.containsKey(request.getClassName())) &#123; Object provider = REGISTRY_MAP.get(request.getClassName()); Method method = provider.getClass().getMethod(request.getMethodName(), request.getParams()); result = method.invoke(provider, request.getValues()); ctx.write(result); ctx.flush(); ctx.close(); &#125; &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125; private void doRegistry() &#123; if (classNameList.isEmpty()) &#123; return; &#125; for (String className : classNameList) &#123; try &#123; Class&lt;?&gt; clazz = Class.forName(className); Class&lt;?&gt; i = clazz.getInterfaces()[0]; REGISTRY_MAP.put(i.getName(), clazz.newInstance()); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; &#125; &#125; private void scannerClass(String packageName) &#123; URL url = this.getClass().getClassLoader().getResource(packageName.replaceAll(&quot;\\\\.&quot;, &quot;/&quot;)); File dir = new File(url.getFile()); for (File file : dir.listFiles()) &#123; if (file.isDirectory()) &#123; scannerClass(packageName + &quot;.&quot; + file.getName()); &#125; else &#123; classNameList.add(packageName + &quot;.&quot; + file.getName().replace(&quot;.class&quot;, &quot;&quot;).trim()); &#125; &#125; &#125;&#125; APIä»¥åŠå®ç°RPCæ¥å£ å®šä¹‰ä¸€ä¸ªç®€å•çš„æœåŠ¡æ¥å£ ä½œä¸ºä¸€ä¸ªå¾®æœåŠ¡å¯¹å¤–æš´éœ²çš„API; 123456789public interface IRpcService &#123; int add(int a, int b); int mul(int a, int b); int sub(int a, int b); int div(int a, int b);&#125; RPCæ¥å£å®ç° providerå®ç°å…·ä½“çš„æ¥å£ï¼Œæä¾›å…·ä½“çš„æœåŠ¡ï¼› 1234567891011121314151617public class RpcServiceImpl implements IRpcService &#123; public int add(int a, int b) &#123; return a + b; &#125; public int mul(int a, int b) &#123; return a * b; &#125; public int sub(int a, int b) &#123; return a - b; &#125; public int div(int a, int b) &#123; return a / b; &#125;&#125; RPCè°ƒç”¨æ–¹è°ƒç”¨RPC12345678public class RpcConsumer &#123; public static void main(String[] args) &#123; IRpcService rpc = RpcProxy.create(IRpcService.class); System.err.println(rpc.add(1,3)); System.err.println(rpc.mul(3,3)); System.err.println(rpc.sub(14,3)); &#125;&#125; RpcProxy åŠ¨æ€ä»£ç†å¯¹è±¡è¯·æ±‚RPC é€šè¿‡Netty Bootstrapè®¿é—®8080ç«¯å£ï¼› 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class RpcProxy &#123; public static &lt;T&gt; T create(Class&lt;?&gt; clazz) &#123; MethodProxy proxy = new MethodProxy(clazz); Class&lt;?&gt;[] interfaces = clazz.isInterface() ? new Class[]&#123;clazz&#125; : clazz.getInterfaces(); T result = (T) Proxy.newProxyInstance(clazz.getClassLoader(), interfaces, proxy); return result; &#125; public static class MethodProxy implements InvocationHandler &#123; private Class&lt;?&gt; clazz; public MethodProxy(Class&lt;?&gt; clazz) &#123; this.clazz = clazz; &#125; public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; if (Object.class.equals(method.getDeclaringClass())) &#123; return method.invoke(this, args); &#125; else &#123; return rpcInvoke(proxy, method, args); &#125; &#125; private Object rpcInvoke(Object proxy, Method method, Object[] args) &#123; //å°è£…è¯·æ±‚çš„å†…å®¹ InvokerProtocol msg = new InvokerProtocol(); msg.setClassName(this.clazz.getName()); msg.setMethodName(method.getName()); msg.setParams(method.getParameterTypes()); msg.setValues(args); final RpcProxyHandler consumerHandler = new RpcProxyHandler(); EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap client = new Bootstrap(); client.group(group) .channel(NioSocketChannel.class) .handler(new ChannelInitializer() &#123; @Override protected void initChannel(Channel ch) throws Exception &#123; //æ¥æ”¶è¯¾å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†æµç¨‹ ChannelPipeline pipeline = ch.pipeline(); int fieldLength = 4; //é€šç”¨è§£ç å™¨è®¾ç½® pipeline.addLast(new LengthFieldBasedFrameDecoder(Integer.MAX_VALUE, 0, fieldLength, 0, fieldLength)); //é€šç”¨ç¼–ç å™¨ pipeline.addLast(new LengthFieldPrepender(fieldLength)); //å¯¹è±¡ç¼–ç å™¨ pipeline.addLast(&quot;encoder&quot;, new ObjectEncoder()); //å¯¹è±¡è§£ç å™¨ pipeline.addLast(&quot;decoder&quot;, new ObjectDecoder(Integer.MAX_VALUE, ClassResolvers.cacheDisabled(null))); pipeline.addLast(&quot;handler&quot;, consumerHandler); &#125; &#125;) .option(ChannelOption.TCP_NODELAY, true); ChannelFuture future = client.connect(&quot;localhost&quot;, 8080).sync(); future.channel().writeAndFlush(msg).sync(); future.channel().closeFuture().sync(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; group.shutdownGracefully(); &#125; return consumerHandler.getResponse(); &#125; &#125;&#125; RPCè°ƒç”¨æ–¹æ¥å—å¹¶å¤„ç†è°ƒç”¨ç»“æœ123456789101112131415161718public class RpcProxyHandler extends ChannelInboundHandlerAdapter &#123; private Object response; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; this.response = msg; &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); &#125; public Object getResponse() &#123; return this.response; &#125;&#125;","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"nettyå®ç°ç®€æ˜“tomcat","date":"2021-07-27T11:54:15.000Z","path":"wiki/nettyå®ç°ç®€æ˜“tomcat/","text":"åŸºäºNettyæ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„Tomcatå®¹å™¨æœ¬æ–‡ä¸»è¦åŸºäºä¼ ç»Ÿçš„BIOæ¥å®ç°ä¸€ä¸ªç®€å•çš„Httpè¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼›1ã€Servletè¯·æ±‚æ— éå°±æ˜¯doGet/doPostï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰æŠ½è±¡Servletè®°å¿†GET/POSTæ–¹æ³•ï¼›2ã€åŸºäºNetty APIå®ç°CSé€šä¿¡ï¼›3ã€æ¨¡æ‹ŸSpringåŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ³¨å†Œè¯·æ±‚ä»¥åŠæ§åˆ¶å™¨ï¼› Nettyç‰ˆæœ¬12345&lt;dependency&gt; &lt;groupId&gt;o.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;4.1.6.Final&lt;/version&gt;&lt;/dependency&gt; GlRequest åŸºäºNetty&amp;HttpRequestçš„APIæ“ä½œï¼Œéå¸¸ç®€å•1234567891011121314151617181920212223242526272829303132public class GlRequest &#123; private ChannelHandlerContext ctx; private HttpRequest req; public GlRequest(ChannelHandlerContext ctx, HttpRequest req) &#123; this.ctx = ctx; this.req = req; &#125; public String getUrl() &#123; return this.req.uri(); &#125; public String getMethod() &#123; return this.req.method().name(); &#125; public Map&lt;String, List&lt;String&gt;&gt; getParams() &#123; QueryStringDecoder decoder = new QueryStringDecoder(req.uri()); return decoder.parameters(); &#125; public String getParam(String name) &#123; Map&lt;String, List&lt;String&gt;&gt; params = getParams(); List&lt;String&gt; strings = params.get(name); if (strings == null) &#123; return null; &#125; return strings.get(0); &#125;&#125; GlResponse åŸºäºNetty&amp;FullHttpResponseçš„APIæ“ä½œ FullHttpResponseä½œä¸ºè¿”å›è¯·æ±‚çš„ä¸»ä½“ï¼› 123456789101112131415161718192021222324252627282930313233public class GlResponse &#123; private ChannelHandlerContext ctx; private HttpRequest req; public GlResponse(ChannelHandlerContext ctx, HttpRequest req) &#123; this.req = req; this.ctx = ctx; &#125; public void write(String string) throws Exception &#123; if (string == null || string.length() == 0) &#123; return; &#125; try &#123; FullHttpResponse response = new DefaultFullHttpResponse( HttpVersion.HTTP_1_1, HttpResponseStatus.OK, Unpooled.wrappedBuffer(string.getBytes(&quot;UTF-8&quot;)) ); response.headers().set(&quot;Content-Type&quot;, &quot;text/html&quot;); ctx.write(response); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; ctx.flush(); ctx.close(); &#125; &#125;&#125; GlServlet å®šä¹‰æŠ½è±¡servletï¼Œå®šä¹‰GETæ–¹æ³•å’ŒPOSTæ–¹æ³• å®šä¹‰æŠ½è±¡çš„Servletå’ŒdoGetæ–¹æ³•å’ŒdoPostæ–¹æ³•ï¼Œå…·ä½“çš„ä¸šåŠ¡å»å®ç°è‡ªå·±çš„æ–¹æ³•å’Œé€»è¾‘ï¼› 12345678910111213141516public abstract class GlServlet &#123; private final static String GET = &quot;GET&quot;; public void service(GlRequest request, GlResponse response) throws Exception &#123; if (GET.equals(request.getMethod())) &#123; doGet(request, response); &#125; else &#123; doPost(request, response); &#125; &#125; public abstract void doGet(GlRequest request, GlResponse response) throws Exception; public abstract void doPost(GlRequest request, GlResponse response) throws Exception; &#125; FirstServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletçš„æ–¹æ³•12345678910111213public class FirstServlet extends GlServlet &#123; @Override public void doGet(GlRequest request, GlResponse response) throws Exception &#123; // å…·ä½“çš„é€»è¾‘ this.doPost(request, response); &#125; @Override public void doPost(GlRequest request, GlResponse response) throws Exception &#123; response.write(&quot;This is first servlet from NIO&quot;); &#125;&#125; SecondServlet å…·ä½“çš„ä¸šåŠ¡Servletå®ç°æŠ½è±¡Servletæ–¹æ³•123456789101112public class SecondServlet extends GlServlet &#123; @Override public void doGet(GlRequest request, GlResponse response) throws Exception &#123; doPost(request,response); &#125; @Override public void doPost(GlRequest request, GlResponse response) throws Exception &#123; response.write(&quot;This second request form NIO&quot;); &#125;&#125; web-nio.properties é…ç½®æ–‡ä»¶ é…ç½®è¯·æ±‚å’Œå¤„ç†å™¨ï¼ŒSpringä¸­æ˜¯é€šè¿‡Controllerä¸‹çš„@XXXMappingæ³¨è§£å»æ‰«æå¹¶åŠ è½½åˆ°å·¥å‚çš„ï¼› 12345servlet.one.className=com.ibli.netty.tomcat.nio.servlet.FirstServletservlet.one.url=/firstServlet.doservlet.two.className=com.ibli.netty.tomcat.nio.servlet.SecondServletservlet.two.url=/secondServlet.do GlTomcat å¯åŠ¨æœåŠ¡ç«¯ï¼Œåœ¨ç½‘é¡µä¸­è®¿é—®æœ¬åœ°8080ç«¯å£ï¼Œè¾“å…¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„urlè¿›è¡Œæµ‹è¯•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110public class GlTomcat &#123; private final Integer PORT = 8080; private Properties webXml = new Properties(); private Map&lt;String, GlServlet&gt; servletMapping = new HashMap&lt;String, GlServlet&gt;(); public static void main(String[] args) &#123; new GlTomcat().start(); &#125; /** * Tomcatçš„å¯åŠ¨å…¥å£ */ private void start() &#123; //1ã€åŠ è½½webé…ç½®æ–‡ä»¶ï¼Œè§£æé…ç½® init(); // Bossçº¿ç¨‹ EventLoopGroup bossGroup = new NioEventLoopGroup(); // Workerçº¿ç¨‹ EventLoopGroup workGroup = new NioEventLoopGroup(); //2ã€åˆ›å»ºNettyæœåŠ¡ç«¯å¯¹è±¡ ServerBootstrap server = new ServerBootstrap(); //3ã€ é…ç½®æœåŠ¡ç«¯å‚æ•° server.group(bossGroup, workGroup) // é…ç½®ä¸»çº¿ç¨‹çš„å¤„ç†é€»è¾‘ .channel(NioServerSocketChannel.class) // å­çº¿ç¨‹çš„å›è°ƒé€»è¾‘ .childHandler(new ChannelInitializer() &#123; @Override protected void initChannel(Channel client) &#123; // å¤„ç†å…·ä½“çš„å›è°ƒé€»è¾‘ // è´£ä»»é“¾æ¨¡å¼ //è¿”å›-ç¼–ç  client.pipeline().addLast(new HttpResponseEncoder()); //è¯·æ±‚-è§£ç  client.pipeline().addLast(new HttpRequestDecoder()); //ç”¨æˆ·è‡ªå·±çš„é€»è¾‘å¤„ç† client.pipeline().addLast(new GlTomcatHandler()); &#125; &#125;) // é…ç½®ä¸»çº¿ç¨‹å¯åˆ†é…çš„æœ€å¤§çº¿ç¨‹æ•° .option(ChannelOption.SO_BACKLOG, 128) //ä¿æŒé•¿é“¾æ¥ .childOption(ChannelOption.SO_KEEPALIVE, true); ChannelFuture future = null; try &#123; future = server.bind(this.PORT).sync(); System.err.println(&quot;Gl tomcat started in pory &quot; + this.PORT); future.channel().closeFuture().sync(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; bossGroup.shutdownGracefully(); workGroup.shutdownGracefully(); &#125; &#125; /** * åŠ è½½é…ç½®æ–‡ä»¶ * è¿™å…¶å®ä½¿ç”¨äº†ç­–ç•¥æ¨¡å¼ */ private void init() &#123; try &#123; String WEB_INF = this.getClass().getResource(&quot;/&quot;).getPath(); FileInputStream fis = new FileInputStream(WEB_INF + &quot;web-nio.properties&quot;); webXml.load(fis); for (Object k : webXml.keySet()) &#123; String key = k.toString(); if (key.endsWith(&quot;.url&quot;)) &#123; //servlet.two.url String servletName = key.replaceAll(&quot;\\\\.url&quot;, &quot;&quot;); String url = webXml.getProperty(key); //servlet.two.className String className = webXml.getProperty(servletName + &quot;.className&quot;); //åå°„åˆ›å»ºservletå®ä¾‹ // load-on-startup &gt;=1 :webå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ– 0ï¼šç”¨æˆ·è¯·æ±‚çš„æ—¶å€™æ‰å¯åŠ¨ GlServlet obj = (GlServlet) Class.forName(className).newInstance(); // å°†urlå’Œservletå»ºç«‹æ˜ å°„å…³ç³» servletMapping.put(url, obj); &#125; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * å¤„ç†ç”¨æˆ·è¯·æ±‚ */ public class GlTomcatHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; if (msg instanceof HttpRequest) &#123; HttpRequest req = (HttpRequest) msg; GlRequest request = new GlRequest(ctx,req); GlResponse response = new GlResponse(ctx,req); String url = request.getUrl(); if (servletMapping.containsKey(url))&#123; servletMapping.get(url).service(request,response); &#125; else &#123; response.write(&quot;404 Not Fount&quot;); &#125; &#125; &#125; &#125;&#125; æµ‹è¯•ç»“æœ è¯·æ±‚ : http://localhost:8080/secoundServlet.do è¿™çš„åœ°å€å†™é”™è¯¯ âš ï¸ è¯·æ±‚ : http://localhost:8080/secondServlet.do","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"}]},{"title":"Javaä½è¿ç®—","date":"2021-07-27T11:47:25.000Z","path":"wiki/Javaä½è¿ç®—/","text":"åœ¨è®¡ç®—æœºä¸­æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å‚¨å­˜çš„ã€‚ä½è¿ç®—å…¶å®å°±æ˜¯ç›´æ¥å¯¹åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œå› æ­¤å¤„ç†æ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ã€‚åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œå¦‚æœèƒ½å·§å¦™è¿ç”¨ä½æ“ä½œï¼Œå®Œå…¨å¯ä»¥è¾¾åˆ°å››ä¸¤æ‹¨åƒæ–¤çš„æ•ˆæœï¼Œæ­£å› ä¸ºä½æ“ä½œçš„è¿™äº›ä¼˜ç‚¹ï¼Œæ‰€ä»¥ä½æ“ä½œåœ¨å„å¤§ITå…¬å¸çš„ç¬”è¯•é¢è¯•ä¸­ä¸€ç›´æ˜¯ä¸ªçƒ­ç‚¹é—®é¢˜ã€‚ ä½æ“ä½œåŸºç¡€åŸºæœ¬çš„ä½æ“ä½œç¬¦æœ‰ä¸ã€æˆ–ã€å¼‚æˆ–ã€å–åã€å·¦ç§»ã€å³ç§»è¿™6ç§ï¼Œå®ƒä»¬çš„è¿ç®—è§„åˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š åœ¨è¿™6ç§æ“ä½œç¬¦ï¼Œåªæœ‰~å–åæ˜¯å•ç›®æ“ä½œç¬¦ï¼Œå…¶å®ƒ5ç§éƒ½æ˜¯åŒç›®æ“ä½œç¬¦ã€‚ ä½æ“ä½œåªèƒ½ç”¨äºæ•´å½¢æ•°æ®ï¼Œå¯¹floatå’Œdoubleç±»å‹è¿›è¡Œä½æ“ä½œä¼šè¢«ç¼–è¯‘å™¨æŠ¥é”™ã€‚ ä½æ“ä½œç¬¦çš„è¿ç®—ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œå› ä¸ºå°½é‡ä½¿ç”¨æ‹¬å·æ¥ç¡®ä¿è¿ç®—é¡ºåºï¼Œå¦åˆ™å¾ˆå¯èƒ½ä¼šå¾—åˆ°è«æ˜å…¶å¦™çš„ç»“æœã€‚æ¯”å¦‚è¦å¾—åˆ°åƒ1ï¼Œ3ï¼Œ 5ï¼Œ9è¿™äº›2^i+1çš„æ•°å­—ã€‚å†™æˆint a = 1 Â« i + 1;æ˜¯ä¸å¯¹çš„ï¼Œç¨‹åºä¼šå…ˆæ‰§è¡Œi + 1ï¼Œå†æ‰§è¡Œå·¦ç§»æ“ä½œã€‚åº”è¯¥å†™æˆint a = (1 Â« i) + 1; å¦å¤–ä½æ“ä½œè¿˜æœ‰ä¸€äº›å¤åˆæ“ä½œç¬¦ï¼Œå¦‚&amp;=ã€|=ã€ ^=ã€Â«=ã€Â»=ã€‚ 12345678package com.king.bit;public class BitMain &#123; public static void main(String [] args) &#123; int a = -15, b = 15; System.out.println(a &gt;&gt; 2); // -4ï¼š-15 = 1111 0001(äºŒè¿›åˆ¶)ï¼Œå³ç§»äºŒä½ï¼Œæœ€é«˜ä½ç”±ç¬¦å·ä½å¡«å……å°†å¾—åˆ°1111 1100å³-4 System.out.println(b &gt;&gt; 2); // 3ï¼š15=0000 1111(äºŒè¿›åˆ¶)ï¼Œå³ç§»äºŒä½ï¼Œæœ€é«˜ä½ç”±ç¬¦å·ä½å¡«å……å°†å¾—åˆ°0000 0011å³3 &#125;&#125; å¸¸ç”¨ä½æ“ä½œå°æŠ€å·§ä¸‹é¢å¯¹ä½æ“ä½œçš„ä¸€äº›å¸¸è§åº”ç”¨ä½œä¸ªæ€»ç»“ï¼Œæœ‰åˆ¤æ–­å¥‡å¶ã€äº¤æ¢ä¸¤æ•°ã€å˜æ¢ç¬¦å·åŠæ±‚ç»å¯¹å€¼ã€‚è¿™äº›å°æŠ€å·§åº”ç”¨æ˜“è®°ï¼Œåº”å½“ç†Ÿç»ƒæŒæ¡ã€‚ åˆ¤æ–­å¥‡å¶åªè¦æ ¹æ®æœ€æœªä½æ˜¯0è¿˜æ˜¯1æ¥å†³å®šï¼Œä¸º0å°±æ˜¯å¶æ•°ï¼Œä¸º1å°±æ˜¯å¥‡æ•°ã€‚å› æ­¤å¯ä»¥ç”¨if ((a &amp; 1) == 0)ä»£æ›¿if (a % 2 == 0)æ¥åˆ¤æ–­aæ˜¯ä¸æ˜¯å¶æ•°ã€‚ä¸‹é¢ç¨‹åºå°†è¾“å‡º0åˆ°100ä¹‹é—´çš„æ‰€æœ‰å¶æ•°ï¼š 12345for (int i = 0; i &lt; 100; i ++) &#123; if ((i &amp; 1) == 0) &#123; // å¶æ•° System.out.println(i); &#125;&#125; äº¤æ¢ä¸¤æ•°123456int c = 1, d = 2;c ^= d;d ^= c;c ^= d;System.out.println(&quot;c=&quot; + c);System.out.println(&quot;d=&quot; + d); å¯ä»¥è¿™æ ·ç†è§£ï¼š ç¬¬ä¸€æ­¥ a=b å³a=(ab)ï¼›ç¬¬äºŒæ­¥ b=a å³b=b(ab)ï¼Œç”±äºè¿ç®—æ»¡è¶³äº¤æ¢å¾‹ï¼Œb(ab)=bbaã€‚ç”±äºä¸€ä¸ªæ•°å’Œè‡ªå·±å¼‚æˆ–çš„ç»“æœä¸º0å¹¶ä¸”ä»»ä½•æ•°ä¸0å¼‚æˆ–éƒ½ä¼šä¸å˜çš„ï¼Œæ‰€ä»¥æ­¤æ—¶bè¢«èµ‹ä¸Šäº†açš„å€¼ï¼›ç¬¬ä¸‰æ­¥ a=b å°±æ˜¯a=abï¼Œç”±äºå‰é¢äºŒæ­¥å¯çŸ¥a=(ab)ï¼Œb=aï¼Œæ‰€ä»¥a=abå³a=(ab)aã€‚æ•…aä¼šè¢«èµ‹ä¸Šbçš„å€¼ï¼› å˜æ¢ç¬¦å·å˜æ¢ç¬¦å·å°±æ˜¯æ­£æ•°å˜æˆè´Ÿæ•°ï¼Œè´Ÿæ•°å˜æˆæ­£æ•°ã€‚å¦‚å¯¹äº-11å’Œ11ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å˜æ¢æ–¹æ³•å°†-11å˜æˆ11 11111 0101(äºŒè¿›åˆ¶) â€“å–å-&gt; 0000 1010(äºŒè¿›åˆ¶) â€“åŠ 1-&gt; 0000 1011(äºŒè¿›åˆ¶) åŒæ ·å¯ä»¥è¿™æ ·çš„å°†11å˜æˆ-11 10000 1011(äºŒè¿›åˆ¶) â€“å–å-&gt; 0000 0100(äºŒè¿›åˆ¶) â€“åŠ 1-&gt; 1111 0101(äºŒè¿›åˆ¶) å› æ­¤å˜æ¢ç¬¦å·åªéœ€è¦å–åååŠ 1å³å¯ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123int a = -15, b = 15;System.out.println(~a + 1);System.out.println(~b + 1); æ±‚ç»å¯¹å€¼ä½æ“ä½œä¹Ÿå¯ä»¥ç”¨æ¥æ±‚ç»å¯¹å€¼ï¼Œå¯¹äºè´Ÿæ•°å¯ä»¥é€šè¿‡å¯¹å…¶å–åååŠ 1æ¥å¾—åˆ°æ­£æ•°ã€‚å¯¹-6å¯ä»¥è¿™æ ·ï¼š 11111 1010(äºŒè¿›åˆ¶) â€“å–å-&gt;0000 0101(äºŒè¿›åˆ¶) -åŠ 1-&gt; 0000 0110(äºŒè¿›åˆ¶) æ¥å¾—åˆ°6ã€‚ å› æ­¤å…ˆç§»ä½æ¥å–ç¬¦å·ä½ï¼Œint i = a Â» 31;è¦æ³¨æ„å¦‚æœaä¸ºæ­£æ•°ï¼Œiç­‰äº0ï¼Œä¸ºè´Ÿæ•°ï¼Œiç­‰äº-1ã€‚ç„¶åå¯¹iè¿›è¡Œåˆ¤æ–­â€”â€”å¦‚æœiç­‰äº0ï¼Œç›´æ¥è¿”å›ã€‚å¦ä¹‹ï¼Œè¿”å›~a+1ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 12int i = a &gt;&gt; 31;System.out.println(i == 0 ? a : (~a + 1)); ç°åœ¨å†åˆ†æä¸‹ã€‚å¯¹äºä»»ä½•æ•°ï¼Œä¸0å¼‚æˆ–éƒ½ä¼šä¿æŒä¸å˜ï¼Œä¸-1å³0xFFFFFFFFå¼‚æˆ–å°±ç›¸å½“äºå–åã€‚å› æ­¤ï¼Œaä¸iå¼‚æˆ–åå†å‡iï¼ˆå› ä¸ºiä¸º0æˆ–-1ï¼Œæ‰€ä»¥å‡iå³æ˜¯è¦ä¹ˆåŠ 0è¦ä¹ˆåŠ 1ï¼‰ä¹Ÿå¯ä»¥å¾—åˆ°ç»å¯¹å€¼ã€‚æ‰€ä»¥å¯ä»¥å¯¹ä¸Šé¢ä»£ç ä¼˜åŒ–ä¸‹ï¼š 12int j = a &gt;&gt; 31;System.out.println((a ^ j) - j); æ³¨æ„è¿™ç§æ–¹æ³•æ²¡ç”¨ä»»ä½•åˆ¤æ–­è¡¨è¾¾å¼ï¼Œè€Œä¸”æœ‰äº›ç¬”é¢è¯•é¢˜å°±è¦æ±‚è¿™æ ·åšï¼Œå› æ­¤å»ºè®®è¯»è€…è®°ä½è¯¥æ–¹æ³•ï¼ˆ_è®²è§£è¿‡ååº”è¯¥æ˜¯æ¯”è¾ƒå¥½è®°äº†ï¼‰ã€‚ ä½æ“ä½œä¸ç©ºé—´å‹ç¼©ç­›ç´ æ•°æ³•åœ¨è¿™é‡Œä¸å°±è¯¦ç»†ä»‹ç»äº†ï¼Œæœ¬æ–‡ç€é‡å¯¹ç­›ç´ æ•°æ³•æ‰€ä½¿ç”¨çš„ç´ æ•°è¡¨è¿›è¡Œä¼˜åŒ–æ¥å‡å°å…¶ç©ºé—´å ç”¨ã€‚è¦å‹ç¼©ç´ æ•°è¡¨çš„ç©ºé—´å ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä½æ“ä½œã€‚ä¸‹é¢æ˜¯ç”¨ç­›ç´ æ•°æ³•è®¡ç®—100ä»¥å†…çš„ç´ æ•°ç¤ºä¾‹ä»£ç ï¼ˆæ³¨2ï¼‰ï¼š 1234567891011121314151617// æ‰“å°100ä»¥å†…ç´ æ•°ï¼š// ï¼ˆ1ï¼‰å¯¹æ¯ä¸ªç´ æ•°ï¼Œå®ƒçš„å€æ•°å¿…å®šä¸æ˜¯ç´ æ•°ï¼›// ï¼ˆ2ï¼‰æœ‰å¾ˆå¤šé‡å¤è®¿é—®å¦‚flag[10]ä¼šåœ¨è®¿é—®flag[2]å’Œflag[5]æ—¶å„è®¿é—®ä¸€æ¬¡ï¼›int max = 100;boolean[] flags = new boolean[max];int [] primes = new int[max / 3 + 1];int pi = 0;for (int m = 2; m &lt; max ; m ++) &#123; if (!flags[m]) &#123; primes[pi++] = m; for(int n = m; n &lt; max; n += m) &#123; flags[n] = true; &#125; &#125;&#125;System.out.println(Arrays.toString(primes)); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 1[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 0, 0, 0, 0, 0, 0, 0, 0, 0] åœ¨ä¸Šé¢ç¨‹åºæ˜¯ç”¨boolæ•°ç»„æ¥ä½œæ ‡è®°çš„ï¼Œboolå‹æ•°æ®å 1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰ï¼Œå› æ­¤ç”¨ä½æ“ä½œæ¥å‹ç¼©ä¸‹ç©ºé—´å ç”¨å°†ä¼šä½¿ç©ºé—´çš„å ç”¨å‡å°‘å…«åˆ†ä¹‹ä¸ƒã€‚ ä¸‹é¢è€ƒè™‘ä¸‹å¦‚ä½•åœ¨æ•°ç»„ä¸­å¯¹æŒ‡å®šä½ç½®ç½®1ï¼Œå…ˆè€ƒè™‘å¦‚ä½•å¯¹ä¸€ä¸ªæ•´æ•°åœ¨æŒ‡å®šä½ç½®ä¸Šç½®1ã€‚å¯¹äºä¸€ä¸ªæ•´æ•°å¯ä»¥é€šè¿‡å°†1å‘å·¦ç§»ä½åä¸å…¶ç›¸æˆ–æ¥è¾¾åˆ°åœ¨æŒ‡å®šä½ä¸Šç½®1çš„æ•ˆæœï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š 1234// åœ¨ä¸€ä¸ªæ•°æŒ‡å®šä½ä¸Šç½®1int e = 0;e |= 1 &lt;&lt; 10;System.out.println(e); åŒæ ·ï¼Œå¯ä»¥1å‘å·¦ç§»ä½åä¸åŸæ•°ç›¸ä¸æ¥åˆ¤æ–­æŒ‡å®šä½ä¸Šæ˜¯0è¿˜æ˜¯1ï¼ˆä¹Ÿå¯ä»¥å°†åŸæ•°å³ç§»è‹¥å¹²ä½å†ä¸1ç›¸ä¸ï¼‰ã€‚ 12345//åˆ¤æ–­æŒ‡å®šä½ä¸Šæ˜¯0è¿˜æ˜¯1if ((e &amp; (1 &lt;&lt; 10)) != 0) System.out.println(&quot;æŒ‡å®šä½ä¸Šä¸º1&quot;);else System.out.println(&quot;æŒ‡å®šä½ä¸Šä¸º0&quot;); æ‰©å±•åˆ°æ•°ç»„ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºæ•°ç»„åœ¨å†…å­˜ä¸Šä¹Ÿæ˜¯è¿ç»­åˆ†é…çš„ä¸€æ®µç©ºé—´ï¼Œå®Œå…¨å¯ä»¥â€œè®¤ä¸ºâ€æ˜¯ä¸€ä¸ªå¾ˆé•¿çš„æ•´æ•°ã€‚å…ˆå†™ä¸€ä»½æµ‹è¯•ä»£ç ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨æ•°ç»„ä¸­ä½¿ç”¨ä½æ“ä½œï¼š 1234567891011int[] bits = new int[40];for (int m = 0; m &lt; 40; m += 3) &#123; bits[m / 32] |= (1 &lt;&lt; (m % 32));&#125;// è¾“å‡ºæ•´ä¸ªbitsfor (int m = 0; m &lt; 40; m++) &#123; if (((bits[m / 32] &gt;&gt; (m % 32)) &amp; 1) != 0) System.out.print(&#x27;1&#x27;); else System.out.print(&#x27;0&#x27;);&#125; è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 11001001001001001001001001001001001001001 å¯ä»¥çœ‹å‡ºè¯¥æ•°ç»„æ¯3ä¸ªå°±ç½®æˆäº†1ï¼Œè¯æ˜æˆ‘ä»¬ä¸Šé¢å¯¹æ•°ç»„è¿›è¡Œä½æ“ä½œçš„æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚å› æ­¤å¯ä»¥å°†ä¸Šé¢ç­›ç´ æ•°æ–¹æ³•æ”¹æˆä½¿ç”¨ä½æ“ä½œå‹ç¼©åçš„ç­›ç´ æ•°æ–¹æ³•ï¼š 12345678910111213int[] flags2 = new int[max / 32 + 1];pi = 0;for (int m = 2; m &lt; max ; m ++) &#123; if ((((flags2[m / 32] &gt;&gt; (m % 32)) &amp; 1) == 0)) &#123; primes[pi++] = m; for(int n = m; n &lt; max; n += m) &#123; flags2[n / 32] |= (1 &lt;&lt; (n % 32)); &#125; &#125;&#125; System.out.println();System.out.println(Arrays.toString(primes)); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 1[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97, 0, 0, 0, 0, 0, 0, 0, 0, 0] ä½æ“ä½œå·¥å…·ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111package com.king.bit; /** * Java ä½è¿ç®—çš„å¸¸ç”¨æ–¹æ³•å°è£… */public class BitUtils &#123; /** * è·å–è¿ç®—æ•°æŒ‡å®šä½ç½®çš„å€¼ * ä¾‹å¦‚ï¼š 0000 1011 è·å–å…¶ç¬¬ 0 ä½çš„å€¼ä¸º 1, ç¬¬ 2 ä½ çš„å€¼ä¸º 0 * * @param source * éœ€è¦è¿ç®—çš„æ•° * @param pos * æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7) * @return æŒ‡å®šä½ç½®çš„å€¼(0 or 1) */ public static byte getBitValue(byte source, int pos) &#123; return (byte) ((source &gt;&gt; pos) &amp; 1); &#125; /** * å°†è¿ç®—æ•°æŒ‡å®šä½ç½®çš„å€¼ç½®ä¸ºæŒ‡å®šå€¼ * ä¾‹: 0000 1011 éœ€è¦æ›´æ–°ä¸º 0000 1111, å³ç¬¬ 2 ä½çš„å€¼éœ€è¦ç½®ä¸º 1 * * @param source * éœ€è¦è¿ç®—çš„æ•° * @param pos * æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7) * @param value * åªèƒ½å–å€¼ä¸º 0, æˆ– 1, æ‰€æœ‰å¤§äº0çš„å€¼ä½œä¸º1å¤„ç†, æ‰€æœ‰å°äº0çš„å€¼ä½œä¸º0å¤„ç† * * @return è¿ç®—åçš„ç»“æœæ•° */ public static byte setBitValue(byte source, int pos, byte value) &#123; byte mask = (byte) (1 &lt;&lt; pos); if (value &gt; 0) &#123; source |= mask; &#125; else &#123; source &amp;= (~mask); &#125; return source; &#125; /** * å°†è¿ç®—æ•°æŒ‡å®šä½ç½®å–åå€¼ * ä¾‹ï¼š 0000 1011 æŒ‡å®šç¬¬ 3 ä½å–å, ç»“æœä¸º 0000 0011; æŒ‡å®šç¬¬2ä½å–å, ç»“æœä¸º 0000 1111 * * @param source * * @param pos * æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7) * * @return è¿ç®—åçš„ç»“æœæ•° */ public static byte reverseBitValue(byte source, int pos) &#123; byte mask = (byte) (1 &lt;&lt; pos); return (byte) (source ^ mask); &#125; /** * æ£€æŸ¥è¿ç®—æ•°çš„æŒ‡å®šä½ç½®æ˜¯å¦ä¸º1 * * @param source * éœ€è¦è¿ç®—çš„æ•° * @param pos * æŒ‡å®šä½ç½® (0&lt;=pos&lt;=7) * @return true è¡¨ç¤ºæŒ‡å®šä½ç½®å€¼ä¸º1, false è¡¨ç¤ºæŒ‡å®šä½ç½®å€¼ä¸º 0 */ public static boolean checkBitValue(byte source, int pos) &#123; source = (byte) (source &gt;&gt;&gt; pos); return (source &amp; 1) == 1; &#125; /** * å…¥å£å‡½æ•°åšæµ‹è¯• * * @param args */ public static void main(String[] args) &#123; // å–åè¿›åˆ¶ 11 (äºŒçº§åˆ¶ 0000 1011) ä¸ºä¾‹å­ byte source = 11; // å–ç¬¬2ä½å€¼å¹¶è¾“å‡º, ç»“æœåº”ä¸º 0000 1011 for (byte i = 7; i &gt;= 0; i--) &#123; System.out.printf(&quot;%d &quot;, getBitValue(source, i)); &#125; // å°†ç¬¬6ä½ç½®ä¸º1å¹¶è¾“å‡º , ç»“æœä¸º 75 (0100 1011) System.out.println(&quot;\\n&quot; + setBitValue(source, 6, (byte) 1)); // å°†ç¬¬6ä½å–åå¹¶è¾“å‡º, ç»“æœåº”ä¸º75(0100 1011) System.out.println(reverseBitValue(source, 6)); // æ£€æŸ¥ç¬¬6ä½æ˜¯å¦ä¸º1ï¼Œç»“æœåº”ä¸ºfalse System.out.println(checkBitValue(source, 6)); // è¾“å‡ºä¸º1çš„ä½, ç»“æœåº”ä¸º 0 1 3 for (byte i = 0; i &lt; 8; i++) &#123; if (checkBitValue(source, i)) &#123; System.out.printf(&quot;%d &quot;, i); &#125; &#125; &#125;&#125; BitSetç±»BitSetç±»ï¼šå¤§å°å¯åŠ¨æ€æ”¹å˜, å–å€¼ä¸ºtrueæˆ–falseçš„ä½é›†åˆã€‚ç”¨äºè¡¨ç¤ºä¸€ç»„å¸ƒå°”æ ‡å¿—ã€‚ æ­¤ç±»å®ç°äº†ä¸€ä¸ªæŒ‰éœ€å¢é•¿çš„ä½å‘é‡ã€‚ä½ set çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ª boolean å€¼ã€‚ç”¨éè´Ÿçš„æ•´æ•°å°† BitSet çš„ä½ç¼–å…¥ç´¢å¼•ã€‚å¯ä»¥å¯¹æ¯ä¸ªç¼–å…¥ç´¢å¼•çš„ä½è¿›è¡Œæµ‹è¯•ã€è®¾ç½®æˆ–è€…æ¸…é™¤ã€‚é€šè¿‡é€»è¾‘ä¸ã€é€»è¾‘æˆ–å’Œé€»è¾‘å¼‚æˆ–æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª BitSet ä¿®æ”¹å¦ä¸€ä¸ª BitSet çš„å†…å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œset ä¸­æ‰€æœ‰ä½çš„åˆå§‹å€¼éƒ½æ˜¯ falseã€‚ æ¯ä¸ªä½ set éƒ½æœ‰ä¸€ä¸ªå½“å‰å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯¥ä½ set å½“å‰æ‰€ç”¨ç©ºé—´çš„ä½æ•°ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå¤§å°ä¸ä½ set çš„å®ç°æœ‰å…³ï¼Œæ‰€ä»¥å®ƒå¯èƒ½éšå®ç°çš„ä¸åŒè€Œæ›´æ”¹ã€‚ä½ set çš„é•¿åº¦ä¸ä½ set çš„é€»è¾‘é•¿åº¦æœ‰å…³ï¼Œå¹¶ä¸”æ˜¯ä¸å®ç°æ— å…³è€Œå®šä¹‰çš„ã€‚ é™¤éå¦è¡Œè¯´æ˜ï¼Œå¦åˆ™å°† null å‚æ•°ä¼ é€’ç»™ BitSet ä¸­çš„ä»»ä½•æ–¹æ³•éƒ½å°†å¯¼è‡´ NullPointerExceptionã€‚ åœ¨æ²¡æœ‰å¤–éƒ¨åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ª BitSet æ˜¯ä¸å®‰å…¨çš„ã€‚ æ„é€ å‡½æ•°: BitSet() or BitSet(int nbits)ï¼Œé»˜è®¤åˆå§‹å¤§å°ä¸º64ã€‚ 123456789101112131415161718192021222324252627282930public void set(int pos): ä½ç½®posçš„å­—ä½è®¾ç½®ä¸ºtrueã€‚public void set(int bitIndex, boolean value): å°†æŒ‡å®šç´¢å¼•å¤„çš„ä½è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚public void clear(int pos): ä½ç½®posçš„å­—ä½è®¾ç½®ä¸ºfalseã€‚public void clear(): å°†æ­¤ BitSet ä¸­çš„æ‰€æœ‰ä½è®¾ç½®ä¸º falseã€‚public int cardinality(): è¿”å›æ­¤ BitSet ä¸­è®¾ç½®ä¸º true çš„ä½æ•°ã€‚public boolean get(int pos): è¿”å›ä½ç½®æ˜¯posçš„å­—ä½å€¼ã€‚public void and(BitSet other): otheråŒè¯¥å­—ä½é›†è¿›è¡Œä¸æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚public void or(BitSet other): otheråŒè¯¥å­—ä½é›†è¿›è¡Œæˆ–æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚public void xor(BitSet other): otheråŒè¯¥å­—ä½é›†è¿›è¡Œå¼‚æˆ–æ“ä½œï¼Œç»“æœä½œä¸ºè¯¥å­—ä½é›†çš„æ–°å€¼ã€‚public void andNot(BitSet set): æ¸…é™¤æ­¤ BitSet ä¸­æ‰€æœ‰çš„ä½,set â€“ ç”¨æ¥å±è”½æ­¤ BitSet çš„ BitSetpublic int size(): è¿”å›æ­¤ BitSet è¡¨ç¤ºä½å€¼æ—¶å®é™…ä½¿ç”¨ç©ºé—´çš„ä½æ•°ã€‚public int length(): è¿”å›æ­¤ BitSet çš„â€œé€»è¾‘å¤§å°â€ï¼šBitSet ä¸­æœ€é«˜è®¾ç½®ä½çš„ç´¢å¼•åŠ  1ã€‚public int hashCode(): è¿”å›è¯¥é›†åˆHash ç ï¼Œ è¿™ä¸ªç åŒé›†åˆä¸­çš„å­—ä½å€¼æœ‰å…³ã€‚public boolean equals(Object other): å¦‚æœotherä¸­çš„å­—ä½åŒé›†åˆä¸­çš„å­—ä½ç›¸åŒï¼Œè¿”å›trueã€‚public Object clone(): å…‹éš†æ­¤ BitSetï¼Œç”Ÿæˆä¸€ä¸ªä¸ä¹‹ç›¸ç­‰çš„æ–° BitSetã€‚public String toString(): è¿”å›æ­¤ä½ set çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ ä¾‹1ï¼šæ ‡æ˜ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ç”¨äº†å“ªäº›å­—ç¬¦ 1234567891011121314151617181920212223242526package com.king.bit;import java.util.BitSet;public class WhichChars &#123; private BitSet used = new BitSet(); public WhichChars(String str) &#123; for (int i = 0; i &lt; str.length(); i++) used.set(str.charAt(i)); // set bit for char &#125; public String toString() &#123; String desc = &quot;[&quot;; int size = used.size(); for (int i = 0; i &lt; size; i++) &#123; if (used.get(i)) desc += (char) i; &#125; return desc + &quot;]&quot;; &#125; public static void main(String args[]) &#123; WhichChars w = new WhichChars(&quot;How do you do&quot;); System.out.println(w); &#125;&#125; ä¾‹2ï¼š 1234567891011121314151617181920package com.king.bit;import java.util.BitSet;public class MainTestThree &#123; /** * @param args */ public static void main(String[] args) &#123; BitSet bm = new BitSet(); System.out.println(bm.isEmpty() + &quot;--&quot; + bm.size()); bm.set(0); System.out.println(bm.isEmpty() + &quot;--&quot; + bm.size()); bm.set(1); System.out.println(bm.isEmpty() + &quot;--&quot; + bm.size()); System.out.println(bm.get(65)); System.out.println(bm.isEmpty() + &quot;--&quot; + bm.size()); bm.set(65); System.out.println(bm.isEmpty() + &quot;--&quot; + bm.size()); &#125;&#125; ä¾‹3ï¼š 12345678910111213141516171819202122package com.king.bit;import java.util.BitSet;public class MainTestFour &#123; /** * @param args */ public static void main(String[] args) &#123; BitSet bm1 = new BitSet(7); System.out.println(bm1.isEmpty() + &quot;--&quot; + bm1.size()); BitSet bm2 = new BitSet(63); System.out.println(bm2.isEmpty() + &quot;--&quot; + bm2.size()); BitSet bm3 = new BitSet(65); System.out.println(bm3.isEmpty() + &quot;--&quot; + bm3.size()); BitSet bm4 = new BitSet(111); System.out.println(bm4.isEmpty() + &quot;--&quot; + bm4.size()); &#125; &#125; ä½æ“ä½œæŠ€å·§123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172// 1. è·å¾—intå‹æœ€å¤§å€¼System.out.println((1 &lt;&lt; 31) - 1);// 2147483647ï¼Œ ç”±äºä¼˜å…ˆçº§å…³ç³»ï¼Œæ‹¬å·ä¸å¯çœç•¥System.out.println(~(1 &lt;&lt; 31));// 2147483647 // 2. è·å¾—intå‹æœ€å°å€¼System.out.println(1 &lt;&lt; 31);System.out.println(1 &lt;&lt; -1); // 3. è·å¾—longç±»å‹çš„æœ€å¤§å€¼System.out.println(((long)1 &lt;&lt; 127) - 1); // 4. ä¹˜ä»¥2è¿ç®—System.out.println(10&lt;&lt;1); // 5. é™¤ä»¥2è¿ç®—(è´Ÿå¥‡æ•°çš„è¿ç®—ä¸å¯ç”¨)System.out.println(10&gt;&gt;1); // 6. ä¹˜ä»¥2çš„mæ¬¡æ–¹System.out.println(10&lt;&lt;2); // 7. é™¤ä»¥2çš„mæ¬¡æ–¹System.out.println(16&gt;&gt;2); // 8. åˆ¤æ–­ä¸€ä¸ªæ•°çš„å¥‡å¶æ€§System.out.println((10 &amp; 1) == 1);System.out.println((9 &amp; 1) == 1); // 9. ä¸ç”¨ä¸´æ—¶å˜é‡äº¤æ¢ä¸¤ä¸ªæ•°ï¼ˆé¢è¯•å¸¸è€ƒï¼‰a ^= b;b ^= a;a ^= b; // 10. å–ç»å¯¹å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”n&gt;0 ? n:-n é«˜ï¼‰int n = -1;System.out.println((n ^ (n &gt;&gt; 31)) - (n &gt;&gt; 31));/* n&gt;&gt;31 å–å¾—nçš„ç¬¦å·ï¼Œè‹¥nä¸ºæ­£æ•°ï¼Œn&gt;&gt;31ç­‰äº0ï¼Œè‹¥nä¸ºè´Ÿæ•°ï¼Œn&gt;&gt;31ç­‰äº-1è‹¥nä¸ºæ­£æ•° n^0-0æ•°ä¸å˜ï¼Œè‹¥nä¸ºè´Ÿæ•°n^-1 éœ€è¦è®¡ç®—nå’Œ-1çš„è¡¥ç ï¼Œå¼‚æˆ–åå†å–è¡¥ç ï¼Œç»“æœnå˜å·å¹¶ä¸”ç»å¯¹å€¼å‡1ï¼Œå†å‡å»-1å°±æ˜¯ç»å¯¹å€¼ */ // 11. å–ä¸¤ä¸ªæ•°çš„æœ€å¤§å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”a&gt;b ? a:bé«˜ï¼‰System.out.println(b&amp;((a-b)&gt;&gt;31) | a&amp;(~(a-b)&gt;&gt;31)); // 12. å–ä¸¤ä¸ªæ•°çš„æœ€å°å€¼ï¼ˆæŸäº›æœºå™¨ä¸Šï¼Œæ•ˆç‡æ¯”a&gt;b ? b:aé«˜ï¼‰System.out.println(a&amp;((a-b)&gt;&gt;31) | b&amp;(~(a-b)&gt;&gt;31)); // 13. åˆ¤æ–­ç¬¦å·æ˜¯å¦ç›¸åŒ(true è¡¨ç¤º xå’Œyæœ‰ç›¸åŒçš„ç¬¦å·ï¼Œ falseè¡¨ç¤ºxï¼Œyæœ‰ç›¸åçš„ç¬¦å·ã€‚)System.out.println((a ^ b) &gt; 0); // 14. è®¡ç®—2çš„næ¬¡æ–¹ n &gt; 0System.out.println(2&lt;&lt;(n-1)); // 15. åˆ¤æ–­ä¸€ä¸ªæ•°næ˜¯ä¸æ˜¯2çš„å¹‚System.out.println((n &amp; (n - 1)) == 0);/*å¦‚æœæ˜¯2çš„å¹‚ï¼Œnä¸€å®šæ˜¯100... n-1å°±æ˜¯1111....æ‰€ä»¥åšä¸è¿ç®—ç»“æœä¸º0*/ // 16. æ±‚ä¸¤ä¸ªæ•´æ•°çš„å¹³å‡å€¼System.out.println((a+b) &gt;&gt; 1); // 17. ä»ä½ä½åˆ°é«˜ä½,å–nçš„ç¬¬mä½int m = 2;System.out.println((n &gt;&gt; (m-1)) &amp; 1); // 18. ä»ä½ä½åˆ°é«˜ä½.å°†nçš„ç¬¬mä½ç½®ä¸º1System.out.println(n | (1&lt;&lt;(m-1)));/*å°†1å·¦ç§»m-1ä½æ‰¾åˆ°ç¬¬mä½ï¼Œå¾—åˆ°000...1...000nåœ¨å’Œè¿™ä¸ªæ•°åšæˆ–è¿ç®—*/ // 19. ä»ä½ä½åˆ°é«˜ä½,å°†nçš„ç¬¬mä½ç½®ä¸º0System.out.println(n &amp; ~(0&lt;&lt;(m-1)));/* å°†1å·¦ç§»m-1ä½æ‰¾åˆ°ç¬¬mä½ï¼Œå–ååå˜æˆ111...0...1111nå†å’Œè¿™ä¸ªæ•°åšä¸è¿ç®—*/","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"Javaæ³¨è§£","date":"2021-07-27T11:45:12.000Z","path":"wiki/Javaæ³¨è§£/","text":"JavaåŸºç¡€ä¹‹æ³¨è§£æœºåˆ¶è¯¦è§£ æ³¨è§£æ˜¯JDK1.5ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºå¯¹ä»£ç è¿›è¡Œè¯´æ˜ï¼Œå¯ä»¥å¯¹åŒ…ã€ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰è¿›è¡Œæ³¨è§£ã€‚å®ƒæ˜¯æ¡†æ¶å­¦ä¹ å’Œè®¾è®¡è€…å¿…é¡»æŒæ¡çš„åŸºç¡€ã€‚ æ³¨è§£åŸºç¡€æ³¨è§£æ˜¯JDK1.5ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªç‰¹æ€§ï¼Œç”¨äºå¯¹ä»£ç è¿›è¡Œè¯´æ˜ï¼Œå¯ä»¥å¯¹åŒ…ã€ç±»ã€æ¥å£ã€å­—æ®µã€æ–¹æ³•å‚æ•°ã€å±€éƒ¨å˜é‡ç­‰è¿›è¡Œæ³¨è§£ã€‚å®ƒä¸»è¦çš„ä½œç”¨æœ‰ä»¥ä¸‹å››æ–¹é¢ï¼šâ€” ç”Ÿæˆæ–‡æ¡£ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®ç”Ÿæˆjavadocæ–‡æ¡£ã€‚â€” ç¼–è¯‘æ£€æŸ¥ï¼Œé€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®è®©ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´è¿›è¡Œæ£€æŸ¥éªŒè¯ã€‚â€” ç¼–è¯‘æ—¶åŠ¨æ€å¤„ç†ï¼Œç¼–è¯‘æ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œä¾‹å¦‚åŠ¨æ€ç”Ÿæˆä»£ç ã€‚ è¿è¡Œæ—¶åŠ¨æ€å¤„ç†ï¼Œè¿è¡Œæ—¶é€šè¿‡ä»£ç é‡Œæ ‡è¯†çš„å…ƒæ•°æ®åŠ¨æ€å¤„ç†ï¼Œ ä¾‹å¦‚ä½¿ç”¨åå°„æ³¨å…¥å®ä¾‹ã€‚è¿™ä¹ˆæ¥è¯´æ˜¯æ¯”è¾ƒæŠ½è±¡çš„ï¼Œæˆ‘ä»¬å…·ä½“çœ‹ä¸‹æ³¨è§£çš„å¸¸è§åˆ†ç±»ï¼š Javaè‡ªå¸¦çš„æ ‡å‡†æ³¨è§£ï¼Œ åŒ…æ‹¬@Overrideã€@Deprecatedå’Œ@SuppressWarningsï¼Œåˆ†åˆ«ç”¨äºæ ‡æ˜é‡å†™æŸä¸ªæ–¹æ³•ã€æ ‡æ˜æŸä¸ªç±»æˆ–æ–¹æ³•è¿‡æ—¶ã€æ ‡æ˜è¦å¿½ç•¥çš„è­¦å‘Šï¼Œç”¨è¿™äº›æ³¨è§£æ ‡æ˜åç¼–è¯‘å™¨å°±ä¼šè¿›è¡Œæ£€æŸ¥ã€‚ å…ƒæ³¨è§£ï¼Œå…ƒæ³¨è§£æ˜¯ç”¨äºå®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼ŒåŒ…æ‹¬@Retentionã€@Targetã€@Inheritedã€@Documentedï¼Œ@Retentionç”¨äºæ ‡æ˜æ³¨è§£è¢«ä¿ç•™çš„é˜¶æ®µï¼Œ@Targetç”¨äºæ ‡æ˜æ³¨è§£ä½¿ç”¨çš„èŒƒå›´ï¼Œ@Inheritedç”¨äºæ ‡æ˜æ³¨è§£å¯ç»§æ‰¿ï¼Œ@Documentedç”¨äºæ ‡æ˜æ˜¯å¦ç”Ÿæˆjavadocæ–‡æ¡£ã€‚ è‡ªå®šä¹‰æ³¨è§£ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰æ³¨è§£ï¼Œå¹¶å¯ç”¨å…ƒæ³¨è§£å¯¹è‡ªå®šä¹‰æ³¨è§£è¿›è¡Œæ³¨è§£ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡è¿™ä¸ªåˆ†ç±»è§’åº¦æ¥ç†è§£æ³¨è§£ã€‚ Javaå†…ç½®æ³¨è§£æˆ‘ä»¬ä»æœ€ä¸ºå¸¸è§çš„Javaå†…ç½®çš„æ³¨è§£å¼€å§‹è¯´èµ·ï¼Œå…ˆçœ‹ä¸‹ä¸‹é¢çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233class A&#123; public void test() &#123; &#125;&#125;class B extends A&#123; /** * é‡è½½çˆ¶ç±»çš„testæ–¹æ³• */ @Override public void test() &#123; &#125; /** * è¢«å¼ƒç”¨çš„æ–¹æ³• */ @Deprecated public void oldMethod() &#123; &#125; /** * å¿½ç•¥å‘Šè­¦ * * @return */ @SuppressWarnings(&quot;rawtypes&quot;) public List processList() &#123; List list = new ArrayList(); return list; &#125;&#125; Java 1.5å¼€å§‹è‡ªå¸¦çš„æ ‡å‡†æ³¨è§£ï¼ŒåŒ…æ‹¬@Overrideã€@Deprecatedå’Œ@SuppressWarningsï¼š @Overrideï¼šè¡¨ç¤ºå½“å‰çš„æ–¹æ³•å®šä¹‰å°†è¦†ç›–çˆ¶ç±»ä¸­çš„æ–¹æ³• @Deprecatedï¼šè¡¨ç¤ºä»£ç è¢«å¼ƒç”¨ï¼Œå¦‚æœä½¿ç”¨äº†è¢«@Deprecatedæ³¨è§£çš„ä»£ç åˆ™ç¼–è¯‘å™¨å°†å‘å‡ºè­¦å‘Š @SuppressWarningsï¼šè¡¨ç¤ºå…³é—­ç¼–è¯‘å™¨è­¦å‘Šä¿¡æ¯ æˆ‘ä»¬å†å…·ä½“çœ‹ä¸‹è¿™å‡ ä¸ªå†…ç½®æ³¨è§£ï¼ŒåŒæ—¶é€šè¿‡è¿™å‡ ä¸ªå†…ç½®æ³¨è§£ä¸­çš„å…ƒæ³¨è§£çš„å®šä¹‰æ¥å¼•å‡ºå…ƒæ³¨è§£ã€‚ å†…ç½®æ³¨è§£ - @Overrideæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ³¨è§£ç±»å‹çš„å®šä¹‰ï¼š 1234@Target(ElementType.METHOD)@Retention(RetentionPolicy.SOURCE)public @interface Override &#123;&#125; ä»å®ƒçš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥è¢«ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒåªåœ¨ç¼–è¯‘æ—¶æœ‰æ•ˆï¼Œåœ¨ç¼–è¯‘åçš„classæ–‡ä»¶ä¸­ä¾¿ä¸å†å­˜åœ¨ã€‚è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æˆ‘ä»¬å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œé‚£å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¢«ä¿®é¥°çš„æ–¹æ³•æ˜¯é‡å†™çš„çˆ¶ç±»çš„ä¸­çš„ç›¸åŒç­¾åçš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå¯¹æ­¤åšå‡ºæ£€æŸ¥ï¼Œè‹¥å‘ç°çˆ¶ç±»ä¸­ä¸å­˜åœ¨è¿™ä¸ªæ–¹æ³•æˆ–æ˜¯å­˜åœ¨çš„æ–¹æ³•ç­¾åä¸åŒï¼Œåˆ™ä¼šæŠ¥é”™ã€‚ å†…ç½®æ³¨è§£ - @Deprecatedè¿™ä¸ªæ³¨è§£çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345 @Documented@Retention(RetentionPolicy.RUNTIME)@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)public @interface Deprecated &#123;&#125; ä»å®ƒçš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒä¼šè¢«æ–‡æ¡£åŒ–ï¼Œèƒ½å¤Ÿä¿ç•™åˆ°è¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿä¿®é¥°æ„é€ æ–¹æ³•ã€å±æ€§ã€å±€éƒ¨å˜é‡ã€æ–¹æ³•ã€åŒ…ã€å‚æ•°ã€ç±»å‹ã€‚è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¢«ä¿®é¥°çš„ç¨‹åºå…ƒç´ å·²è¢«â€œåºŸå¼ƒâ€ï¼Œä¸å†å»ºè®®ç”¨æˆ·ä½¿ç”¨ã€‚ å†…ç½®æ³¨è§£ - @SuppressWarningsè¿™ä¸ªæ³¨è§£æˆ‘ä»¬ä¹Ÿæ¯”è¾ƒå¸¸ç”¨åˆ°ï¼Œå…ˆæ¥çœ‹ä¸‹å®ƒçš„å®šä¹‰ï¼š 12345@Target(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)@Retention(RetentionPolicy.SOURCE)public @interface SuppressWarnings &#123;String[] value();&#125; å®ƒèƒ½å¤Ÿä¿®é¥°çš„ç¨‹åºå…ƒç´ åŒ…æ‹¬ç±»å‹ã€å±æ€§ã€æ–¹æ³•ã€å‚æ•°ã€æ„é€ å™¨ã€å±€éƒ¨å˜é‡ï¼Œåªèƒ½å­˜æ´»åœ¨æºç æ—¶ï¼Œå–å€¼ä¸ºString[]ã€‚å®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æŒ‡å®šçš„è­¦å‘Šä¿¡æ¯ï¼Œå®ƒå¯ä»¥å–çš„å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š // TODO å‚è€ƒèµ„æ–™https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"Javaæ³›å‹","date":"2021-07-27T11:39:32.000Z","path":"wiki/Javaæ³›å‹/","text":"Javaæ³›å‹1ã€æ³›å‹å®šä¹‰ ä½¿ç”¨æ³›å‹æœºåˆ¶ç¼–å†™çš„ç¨‹åºä»£ç è¦æ¯”é‚£äº›æ‚ä¹±åœ°ä½¿ç”¨Objectå˜é‡ï¼Œç„¶ååœ¨è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢çš„ä»£ç å…·æœ‰æ›´å¥½çš„å®‰å…¨æ€§å’Œå¯è¯»æ€§ã€‚ â€“ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹ æ³›å‹æ˜¯åœ¨ç¼–è¯‘æ—¶æœŸä½œç”¨çš„ï¼› æ³›å‹å˜é‡ä½¿ç”¨å¤§å†™å½¢å¼ï¼Œåœ¨Javaåº“ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨å˜é‡Eè¡¨ç¤ºé›†åˆçš„å…ƒç´ ç±»å‹ï¼ŒKå’ŒVè¡¨ç¤ºè¡¨çš„å…³é”®å­—ä¸å€¼çš„ç±»å‹ã€‚ 2ã€é€šé…ç¬¦2.1 æ— è¾¹ç•Œé€šé…ç¬¦æ— è¾¹ç•Œé€šé…ç¬¦åˆæˆä¸ºéé™å®šé€šé…ç¬¦ 1234567891011121314public static void main(String[] args) &#123; List&lt;String&gt; list1 = new ArrayList&lt;&gt;(); list1.add(&quot;1&quot;); list1.add(&quot;2&quot;); list1.add(&quot;3&quot;); list1.add(&quot;4&quot;); loop(list1); &#125; public static void loop(List&lt;?&gt; list) &#123; for (int i = 0; i &lt; list.size(); i++) &#123; System.out.println(list.get(i)); &#125; &#125; 2.2 ä¸Šè¾¹ç•Œé€šé…ç¬¦ä¸Šè¾¹ç•Œé€šé…ç¬¦å’Œä¸‹è¾¹ç•Œé€šé…ç¬¦éƒ½å±äºé™å®šé€šé…ç¬¦ 12345678910111213141516public static void main(String[] args) &#123; //Listä¸­çš„ç±»å‹å¿…é¡»æ˜¯Numberçš„å­ç±»ï¼Œä¸ç„¶ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ List&lt;Integer&gt; list1 = new ArrayList&lt;&gt;(); list1.add(1); list1.add(2); list1.add(3); list1.add(4); loop(list1); &#125; // ä¼ è¿›æ¥çš„listçš„ç±»å‹å¿…é¡»æ˜¯Numberæˆ–Numberçš„å­ç±»æ‰å¯ä»¥ public static void loop(List&lt;? extends Number&gt; list) &#123; for (int i = 0; i &lt; list.size(); i++) &#123; System.out.println(list.get(i)); &#125; &#125; ? extends Numberå¦‚æœé™å®šçš„ç±»å‹æœ‰å¤šä¸ªï¼Œä¹‹é—´ä½¿ç”¨ &amp; è¿›è¡Œåˆ†å‰² 2.3 ä¸‹è¾¹ç•Œé€šé…ç¬¦1234567891011121314151617181920public static void main(String[] args) &#123; //Listçš„æ³›å‹æ˜¯Number æ·»åŠ çš„å…ƒç´ åªè¦æ˜¯Numberä¸‹çš„ç±»å‹å°±å¯ä»¥ List&lt;Number&gt; list1 = new ArrayList&lt;&gt;(); list1.add(1); list1.add(2L); list1.add(new BigDecimal(22)); list1.add(4); loop(list1); &#125; /** * é€šç”¨ç±»å‹å¿…é¡»æ˜¯Numberåˆ°Objectä¹‹é—´çš„ç±»å‹ * * @param list */ public static void loop(List&lt;? super Number&gt; list) &#123; for (int i = 0; i &lt; list.size(); i++) &#123; System.out.println(list.get(i)); &#125; &#125; 3ã€æ³›å‹çš„ä½¿ç”¨ æ³›å‹å¿…é¡»å…ˆå£°æ˜ï¼Œå†ä½¿ç”¨ï¼Œä¸ç„¶ä¼šæœ‰ç¼–è¯‘é”™è¯¯ï¼›æ³›å‹çš„å£°æ˜æ˜¯ç”¨è¿‡ä¸€å¯¹&lt;&gt;æ¥å®Œæˆï¼Œçº¦å®šä½¿ç”¨ä¸€ä¸ªå¤§å†™çš„å­—æ¯æ¥è¡¨ç¤º;é€šé…ç¬¦ä¸èƒ½ç”¨ä½œè¿”å›å€¼; 123456public &lt;T&gt; T testA(T t, Test1&lt;T&gt; test1) &#123; System.out.println(&quot;è¿™æ˜¯ä¼ å…¥çš„T:&quot; + t); t = test1.t; System.out.println(&quot;è¿™æ˜¯èµ‹å€¼åçš„T:&quot; + t); return t;&#125; è¦ä»æ³›å‹ç±»å–æ•°æ®æ—¶ï¼Œç”¨extendsï¼› è¦å¾€æ³›å‹ç±»å†™æ•°æ®æ—¶ï¼Œç”¨superï¼› æ—¢è¦å–åˆè¦å†™ï¼Œå°±ä¸ç”¨é€šé…ç¬¦ï¼ˆå³extendsä¸superéƒ½ä¸ç”¨ï¼‰ã€‚ 3.1 æ³›å‹ç±»12345public class Demo&lt;K, V&gt; &#123; public &lt;K&gt; K test(V v) &#123; return null; &#125;&#125; 3.2 æ³›å‹æ–¹æ³•1234567891011121314151617181920212223242526272829303132333435public class DemoTest4&lt;K, V&gt; &#123; /** * &lt;T&gt; ä»£è¡¨æ³›å‹çš„å£°æ˜ * * @param t æœ¬æ–¹æ³•å£°æ˜çš„æ³›å‹ç±»å‹ * @param &lt;T&gt; æœ¬æ–¹æ³•å£°æ˜çš„æ³›å‹ç±»å‹ * @return */ public &lt;T&gt; T test(T t) &#123; return null; &#125; /** * æ™®é€šçš„æ³›å‹æ–¹æ³• * * @param k ç±»ä¸­å®šä¹‰çš„æ³›å‹ç±»å‹ * @param &lt;X&gt; æœ¬æ–¹æ³•ä¸­å£°æ˜çš„æ³›å‹ç±»å‹ * @return */ public &lt;X&gt; X aa(K k) &#123; return (X) null; &#125; /** * é™æ€æ–¹æ³•ä¸­æ˜¯æ— æ³•ä½¿ç”¨ç±»ä¸­å£°æ˜çš„æ³›å‹ç±»å‹çš„ * å¯ä»¥ä½¿ç”¨åœ¨æœ¬æ–¹æ³•ä¸­å£°æ˜çš„æ³›å‹ç±»å‹ * * @return */ public static &lt;X&gt; X bb() &#123; return null; &#125;&#125; 3.3 æ³›å‹æ¥å£é¦–å…ˆçœ‹ä¸€ä¸‹ä¸ä½¿ç”¨æ³›å‹æ¥å£çš„Demo 12345678910111213141516171819202122å…ˆå®šä¹‰æ¥å£ï¼Œå£°æ˜ä¸¤ä¸ªæ–¹æ³•public interface IGeneric &#123; Integer aa(Integer a); Integer bb(Integer b);&#125;//ç„¶ååˆ›å»ºä¸€ä¸ªç±»æ¥å®ç°æ–¹æ³•ï¼špublic class IntegerDemo implements IGeneric&#123; @Override public Integer aa(Integer a) &#123; return null; &#125; @Override public Integer bb(Integer b) &#123; return null; &#125;&#125; ä¸Šé¢æ˜¯æ²¡æœ‰ä½¿ç”¨æ³›å‹çš„æ¥å£è®¾è®¡ï¼Œä½†æ˜¯aaæ–¹æ³•çš„æ“ä½œç±»å‹ç›¸å½“äºåœ¨æ¥å£ä¸­å†™æ­»äº†ï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªStringç±»å‹çš„aaæ–¹æ³•ï¼Œé‚£æ˜¯ä¸æ˜¯è¿˜è¦åœ¨å£°æ˜ä¸€ä¸ªStringç±»å‹çš„æ¥å£ï¼Œç„¶åå†å»å®ç°å‘¢ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯æ˜¾å¾—ä»£ç å¾ˆè‡ƒè‚¿ï¼Œä»£ç é‡å¤ï¼›æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä½¿ç”¨æ³›å‹ä¹‹åæ˜¯æ€ä¹ˆæ ·çš„ã€‚ 1234567891011121314151617181920212223242526272829303132å®šä¹‰æ³›å‹æ¥å£public interface IGenericInte&lt;T&gt; &#123; T aa(T a); T bb(T b);&#125;ä¸‹é¢æ˜¯æ ¹æ®ä¸åŒç±»å‹çš„å®ç°ç±»æ³›å‹ä¼ å¦‚Integerç±»å‹public class IGenericInteger implements IGenericInte&lt;Integer&gt; &#123; @Override public Integer aa(Integer a) &#123; return null; &#125; @Override public Integer bb(Integer b) &#123; return null; &#125;&#125;æ³›å‹ä¼ å…¥Stringç±»å‹public class IGenericString implements IGenericInte&lt;String&gt; &#123; @Override public String aa(String a) &#123; return null; &#125; @Override public String bb(String b) &#123; return null; &#125;&#125; 4ã€æ³›å‹æ“¦é™¤åœ¨è™šæ‹Ÿæœºä¸Šæ²¡æœ‰æ³›å‹ç±»å‹å¯¹è±¡ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½å±äºæ™®é€šç±»ã€‚Javaåœ¨å¤„ç†æ³›å‹ç±»å‹çš„æ—¶å€™ï¼Œä¼šå¤„ç†æˆä¸€ä¸ªç›¸åº”çš„åŸå§‹ç±»å‹ã€‚ æ“¦é™¤ç±»å‹å˜é‡ï¼Œå¹¶æ›¿æ¢ä¸ºé™å®šç±»å‹ï¼Œå¦‚æœæ²¡æœ‰é™å®šç±»å‹ï¼Œé»˜è®¤ä½¿ç”¨Objectæ›¿ä»£ã€‚å¦‚æœæœ‰é™å®šç±»å‹ï¼Œå¹¶ä¸”æ˜¯å¤šä¸ªï¼Œä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªé™å®šçš„ç±»å‹æ¥æ›¿æ¢ã€‚ 1234public interface IGenericInte&lt;T&gt; &#123; T aa(T a); T bb(T b);&#125; åƒä¸Šé¢è¿™ä¸ªTæ˜¯ä¸€ä¸ªæ— é™å®šçš„å˜é‡ï¼Œæ³›å‹æ“¦é™¤ä¹‹åä¼šç›´æ¥ä½¿ç”¨Objectæ›¿æ¢ã€‚å½“ç„¶è°ƒç”¨æ³›å‹æ–¹æ³•æ—¶ï¼Œå¦‚æœæ“¦é™¤è¿”å›ç±»å‹ï¼Œç¼–è¯‘å™¨æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ 12Pair&lt;Employee&gt; buddies = ....Employee buddy = buddies.getFirst(); æ“¦é™¤getFirstçš„è¿”å›ç±»å‹åå°†è¿”å›Objectç±»å‹ã€‚ç¼–è¯‘å™¨è‡ªåŠ¨æ’å…¥Employeeçš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨è°ƒç”¨æ–¹æ³•æ˜¯å…¶å®æ˜¯æ‰§è¡Œäº†ä¸€ä¸‹ä¸¤ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤ï¼š å¯¹åŸå§‹æ–¹æ³•Pair.getFirst()æ–¹æ³•çš„è°ƒç”¨ å°†è¿”å›çš„Objectç±»å‹å¼ºåˆ¶è½¬æ¢ä¸ºEmployeeç±»å‹ 1public static &lt;T extends Comparable&gt; T foo(T [] args) åœ¨æ“¦é™¤ç±»å‹ä¹‹åå˜æˆï¼š 1public static Comparable T foo(Comparable [] args) å‚æ•°ç±»å‹Tå·²ç»è¢«æ“¦é™¤ï¼Œåªç•™ä¸‹é™å®šç±»å‹Comparable; æ€»ä¹‹æœ‰å…³Javaæ³›å‹è½¬æ¢çš„äº‹å®ï¼š è™šæ‹Ÿæœºæ²¡æœ‰æ³›å‹ï¼Œåªæœ‰æ™®é€šçš„ç±»å’Œæ–¹æ³• æ‰€æœ‰çš„ç±»å‹å‚æ•°éƒ½ç”¨å®ƒä»¬çš„é™å®šç±»å‹æ›¿æ¢ ==æ¡¥æ–¹æ³•è¢«åˆæˆæ¥ä¿è¯å¤šæ€== ä¸ºäº†ä¿æŒç±»å‹å®‰å…¨å‹ï¼Œå¿…è¦æ—¶æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ ç¬¬ä¸€æ¡åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰æ³›å‹æ“¦é™¤è¿™ä¸ªæ¦‚å¿µï¼Œæ˜¯å› ä¸ºJVMä¸èƒ½æ“ä½œæ³›å‹ï¼›ç¬¬äºŒæ¡å°±æ˜¯è§£é‡Šæ³›å‹å¦‚ä½•è¿›è¡Œç±»å‹çš„æ“¦é™¤ï¼›ç¬¬ä¸‰æ¡æ˜¯æ³›å‹æ–¹æ³•å¯èƒ½ä¸å¤šæ€çš„ç†å¿µçŸ›ç›¾ï¼Œæ‰€ä»¥ä½¿ç”¨æ¡¥æ–¹æ³•æ¥è¿‡æ¸¡æˆ–å…¼å®¹ï¼›ç¬¬å››æ¡ä¸Šé¢ä¹Ÿæœ‰æåˆ°ï¼Œä¼šå‡ºç°å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æƒ…å†µï¼› 5ã€æ³›å‹çš„çº¦æŸä¸å±€é™æ€§å½“ç„¶æ³›å‹çš„è®¾è®¡åœ¨javaä¸­å¹¶æ²¡æœ‰é‚£ä¹ˆå®Œç¾ï¼Œå®ƒç¡®å®å¯ä»¥è§£å†³ä»£ç ç»“æ„é‡ç”¨ç­‰é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰ä¸€äº›å±€é™æ€§ï¼Œä¸‹é¢æ˜¯æˆ‘æ ¹æ®ã€ŠJavaæ ¸å¿ƒæŠ€æœ¯ã€‹è¿›è¡Œçš„æ€»ç»“ï¼š 5.1 ä¸èƒ½ä½¿ç”¨åŸºç¡€æ•°æ®ç±»å‹å®ä¾‹åŒ–ç±»å‹å‚æ•°åŸå› æ˜¯ç±»å‹æ“¦é™¤ä¹‹åï¼Œå¦‚æœä½¿ç”¨ObjectåŸå§‹ç±»å‹ï¼ŒObjectæ˜¯æ— æ³•å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡å…¶åŒ…è£…ç±»å‹å£°æ˜ï¼› 5.2 è¿è¡Œæ—¶æŸ¥è¯¢ç±»å‹åªé€‚ç”¨ä¸åŸå§‹ç±»å‹1234567public class DemoTest5&lt;T&gt; &#123; public static void main(String[] args) &#123; DemoTest5&lt;String&gt; demoTest5 = new DemoTest5&lt;&gt;(); DemoTest5&lt;Integer&gt; demoTest4 = new DemoTest5&lt;&gt;(); System.err.println(demoTest4.getClass().equals(demoTest5.getClass())); &#125;&#125; demoTest4.getClass().equals(demoTest5.getClass())å…¶å®æ¯”è¾ƒçš„æ˜¯DemoTest5è¿™ä¸ªç±»ç±»å‹ï¼Œæˆ‘ä»¬è¾“å‡ºä¸€ä¸‹demoTest4.getClass()çš„ç»“æœçœ‹ä¸€ä¸‹ï¼š 1class com.ibli.javaBase.generics.DemoTest5 æ‰€ä»¥è¿™é‡Œæœ‰ä¸€é“éå¸¸ç»å…¸çš„é¢è¯•é¢˜ï¼Œå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªæ³›å‹ä»–çš„å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°„å»æ‹¿åˆ°æ³›å‹çš„å…·ä½“ç±»å‹ï¼› 5.3 ä¸èƒ½åˆ›é€ å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„å¯¹äºå‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ï¼Œåœ¨ç±»å‹æ“¦é™¤ä¹‹åï¼Œä¼šå˜æˆObject[]ç±»å‹ï¼Œå¦‚æœæ­¤æ—¶è¯•å›¾å­˜å‚¨ä¸€ä¸ªStringç±»å‹çš„å…ƒç´ ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªArray-StoreExceptionå¼‚å¸¸ï¼›ä¸»è¦ç›®çš„è¿˜æ˜¯å¤„äºåˆ°æ•°ç»„å®‰å…¨çš„ä¿æŠ¤ï¼Œå¯ä»¥å‚è€ƒå‡ ç¯‡æ–‡ç« : 1ã€å¦‚æœJavaä¸æ”¯æŒå‚æ•°åŒ–ç±»å‹æ•°ç»„ï¼Œé‚£ä¹ˆArrays.asList()å¦‚ä½•å¤„ç†å®ƒä»¬ï¼Ÿ2ã€javaä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ³›å‹æ•°ç»„3ã€java.lang.ArrayStoreException 5.4 Varargsè­¦å‘Šå‘å‚æ•°ä¸ªæ•°å¯å˜çš„æ–¹æ³•ä¼ é€’ä¸€ä¸ªæ³›å‹ç±»å‹çš„å®ä¾‹çš„åœºæ™¯ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šï¼æŠ‘åˆ¶è¿™ç§è­¦å‘Šçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š åœ¨è°ƒç”¨æ–¹æ³•ä¸Šå¢åŠ æ³¨è§£@SuppressWarnings(â€œuncheckedâ€) è¿˜å¯ä»¥ä½¿ç”¨@SafeVarargsæ³¨è§£ç›´æ¥æ ‡æ³¨æ–¹æ³• å‚è€ƒ javaä¸èƒ½åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ³›å‹æ•°ç»„ 5.5 ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡ä¸èƒ½ä½¿ç”¨new T(..) æˆ–åˆ™new T[â€¦]å’ŒT.classè¿™æ ·çš„è¡¨è¾¾å¼çš„ç±»å‹å˜é‡ï¼›å› ä¸ºç±»å‹æ“¦é™¤åï¼ŒTå˜æˆObjectï¼Œæ˜¾ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œå¹¶ä¸æ˜¯æƒ³è¦åˆ›å»ºä¸€ä¸ªObjectå®ä¾‹ã€‚è§£å†³åŠæ³•æ˜¯åœ¨è°ƒç”¨è€…æä¾›ä¸€ä¸ªæ„é€ å™¨è¡¨è¾¾å¼ï¼Œä¸‹é¢æ˜¯ç”¨Supplierå‡½æ•°å®ç°ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class Pair&lt;T&gt; &#123; private T first; private T second; public T getFirst() &#123; return first; &#125; public void setFirst(T first) &#123; this.first = first; &#125; public T getSecond() &#123; return second; &#125; public void setSecond(T second) &#123; this.second = second; &#125; public Pair(T first, T second) &#123; this.first = first; this.second = second; &#125; public static &lt;T&gt; Pair&lt;T&gt; build(Supplier&lt;T&gt; constr) &#123; return new Pair&lt;&gt;(constr.get(), constr.get()); &#125; /** * Cannot infer type arguments for Pair2&lt;&gt; * å½“å‡½æ•°å¤´è¿”å›å€¼ä¸ºPairæ—¶,æ— æ³•æ¨æ–­,æ”¹ä¸ºPair2åå¯ä»¥æ¨æ–­. * @param c1 * @return */ public static &lt;T&gt; Pair&lt;T&gt; build(Class&lt;T&gt; c1)&#123; try &#123; return new Pair&lt;&gt;(c1.newInstance(),c1.newInstance()); &#125; catch (InstantiationException | IllegalAccessException e) &#123; return null; &#125; &#125;&#125; Supplieræ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œè¿”å›ä¸€ä¸ªæ— å‚æ•°å¹¶ä¸”è¿”å›ç±»å‹ä¸ºTçš„å‡½æ•°ï¼š 12345678910@FunctionalInterfacepublic interface Supplier&lt;T&gt; &#123; /** * Gets a result. * * @return a result */ T get();&#125; 12345678910111213141516171819202122232425262728293031323334public class TestMakePair &#123; public static void main(String[] args) &#123; /** * 1.æ¥å—Supplier&lt;T&gt;--å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ã€‚è¡¨ç¤ºæ— å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºTçš„å‡½æ•°ã€‚ * å› ä¸ºä¸èƒ½å®ä¾‹åŒ–ç±»å‹å˜é‡ï¼Œå¦‚ï¼š * public Pair() &#123;first = new T();second = new T();&#125; * æ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯è®©è°ƒç”¨è€…æä¾›ä¸€ä¸ªæ„é€ å™¨è¡¨è¾¾å¼.å½¢å¼å¦‚ä¸‹: * @param constr * @return */ Pair&lt;String&gt; pair = Pair.build(String::new); System.out.println(pair.getFirst().length()); /** * public void buildT()&#123; 2.ä¼ ç»Ÿçš„æ–¹å¼æ˜¯é€šè¿‡Class.newInstanceæ–¹æ³•æ¥æ„é€ æ³›å‹å¯¹è±¡. ä½†ç”±äºç»†èŠ‚è¿‡äºå¤æ‚,T.classæ˜¯ä¸åˆæ³•çš„.å®ƒä¼šè¢«æ“¦é™¤ä¸ºObject.class.å¦‚ä¸‹: Illegal class literal for the type parameter T T.class.newInstance(); &#125; * 3. * T.classæ˜¯ä¸åˆæ³•çš„,ä½†è‹¥APIæ¶‰åŠå¦‚ä¸‹ * reason:å› ä¸ºString.classæ˜¯Class&lt;String&gt;çš„ä¸€ä¸ªå®ä¾‹. */ Pair&lt;String&gt; pair1 = Pair.build(String.class); System.out.println(pair1.getFirst().length()); &#125;&#125;æ‰§è¡Œç»“æœï¼š00 5.6 ä¸èƒ½æ„é€ æ³›å‹æ•°ç»„å°±åƒä¸èƒ½å®ä¾‹åŒ–ä¸€ä¸ªæ³›å‹å®ä¾‹ä¸€æ ·ï¼Œä¹Ÿä¸èƒ½å®ä¾‹åŒ–æ•°ç»„ã€‚æ•°ç»„æœ¬èº«ä¹Ÿæœ‰ç±»å‹ï¼Œç”¨æ¥ç›‘æ§å­˜å‚¨åœ¨JVMä¸­çš„æ•°ç»„ï¼Œè¿™ä¸ªç±»å‹ä¼šè¢«æ“¦é™¤ï¼Œä¾‹å¦‚ï¼š 1234public static &lt;T extends Comparable&gt; T[] foo(T[] a)&#123; T[] mm = new T[2]; ...&#125; ç±»å‹æ“¦é™¤ï¼Œä¼šè®©è¿™ä¸ªæ–¹æ³•æ°¸è¿œæ„é€ Comparabel[2]æ•°ç»„ï¼› 5.7 æ³›å‹ç±»çš„é™æ€ä¸Šä¸‹æ–‡ä¸­ç±»å‹å˜é‡æ— æ•ˆè¿™ä¸ªåº”è¯¥æ˜¯æ¯”è¾ƒå¥½ç†è§£çš„ï¼Œä¸Šæ–‡ä¹Ÿæåˆ°è¿‡äº†ï¼Œæ³›å‹ç±»å‹æ˜¯ä½œç”¨åœ¨æ³›å‹ç±»ä¸Šçš„ï¼Œä¸€äº›é™æ€çš„æ–¹æ³•æˆ–è¿™é™æ€çš„å±æ€§ä¸èƒ½å¤Ÿä½¿ç”¨æ³›å‹ç±»çš„å˜é‡ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼› 5.8 ä¸èƒ½æŠ›å‡ºæˆ–è€…æ•è·æ³›å‹ç±»çš„å®ä¾‹Javaæ—¢ä¸èƒ½æŠ›å‡ºä¹Ÿä¸èƒ½æ•è·æ³›å‹ç±»å¯¹è±¡ï¼Œå®é™…ä¸Šï¼Œç”šè‡³æ³›å‹ç±»æ‰©å±•Throwableéƒ½æ˜¯ä¸åˆæ³•çš„ã€‚ 12345678public static &lt;T extends Throwable&gt; void doWork(Class&lt;T&gt; t)&#123; try&#123; ... &#125;catch (T ex)&#123; æ­¤å¤„æ— æ³•æ•è· catchå¿…é¡»æ•è·å…·ä½“çš„å¼‚å¸¸ .... &#125;&#125; åœ¨å¼‚å¸¸è§„èŒƒä¸­ä½¿ç”¨ç±»å‹å˜é‡æ˜¯å…è®¸çš„ï¼Œå¦‚ä¸‹ï¼š 123456789public static &lt;T extends Throwable&gt; void doWork(Class&lt;T&gt; t) throws T &#123; try&#123; ... &#125;catch (Throwable ex)&#123; t.initCause(ex); throw t; &#125;&#125; 5.9 å¯ä»¥æ¶ˆé™¤å¯¹å—æŸ¥å¼‚å¸¸çš„æ£€æŸ¥Javaå¼‚å¸¸å¤„ç†è¦æ±‚å¿…é¡»ä¸ºæ‰€æœ‰çš„å—æŸ¥å¼‚å¸¸æä¾›ä¸€ä¸ªå¤„ç†å™¨ï¼Œä½†æ˜¯ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥è§„é¿è¿™ä¸€ç‚¹ï¼› 1234@SuppressWarnings(&quot;unchecked&quot;)public static &lt;T extends Throwable&gt; void throwAs(Throwable e) throws T&#123; throw (T)e;&#125; è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šè®¤ä¸ºtæ˜¯ä¸€ä¸ªéå—æŸ¥å¼‚å¸¸; 5.10 æ³¨æ„æ“¦é™¤åçš„å†²çªæ¯”å¦‚ä¸€ä¸ªæ³›å‹ç±»çš„equalsæ–¹æ³•ï¼Œæ“¦é™¤ä¹‹åï¼Œå’ŒObjectçš„equalså†²çªï¼›è§£å†³åŠæ³•æ˜¯é‡æ–°å‘½åå¼•å‘é”™è¯¯çš„æ–¹æ³•ï¼› 6ã€æ³›å‹çš„ç»§æ‰¿å…³ç³»å¦‚æœManage extends Employee,é‚£ä¹ˆPair&lt; Manage &gt;æ˜¯Pair&lt; Employee &gt;çš„å­ç±»å—ï¼Ÿ ä¸æ˜¯çš„ï¼ä½†æ˜¯æ³›å‹ç±»å¯ä»¥æ‰©å±•æˆ–å®ç°å…¶ä»–çš„æ³›å‹ç±»ï¼Œå¾ˆå…¸å‹çš„ä¸€ä¸ªä¾‹å­ArrayList: 12public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;&#125; ArrayList[E]ç»§æ‰¿äº†AbstractList[E]; å¯¹äºJavaæ³›å‹çš„ä¸€äº›æ€è€ƒ ç¼–è¯‘å™¨å¦‚ä½•æ¨æ–­å‡ºå…·ä½“çš„ç±»å‹ï¼Ÿ å‚è€ƒèµ„æ–™ï¼šæ·±å…¥ç†è§£ Java æ³›å‹ ------------------- ä»–æ—¥è‹¥é‚å‡Œäº‘å¿— æ•¢ç¬‘é»„å·¢ä¸ä¸ˆå¤« -------------------","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"Javaåå°„","date":"2021-07-27T11:39:08.000Z","path":"wiki/Javaåå°„/","text":"Javaåå°„ åå‘æ¢çŸ¥ï¼Œåœ¨ç¨‹åºè¿è¡Œæ˜¯åŠ¨æ€çš„è·å–ç±»çš„ç›¸å…³å±æ€§è¿™ç§åŠ¨æ€è·å–ç±»çš„å†…å®¹ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•å’Œè·å–å±æ€§çš„æœºåˆ¶ï¼Œå«åšjavaåå°„æœºåˆ¶ï¼› åå°„çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹å¢åŠ äº†ç¨‹åºçš„çµæ´»æ€§ï¼Œé¿å…çš„å›ºæœ‰é€»è¾‘å†™æ­»åˆ°ç¨‹åºä¸­ä»£ç ç®€ä»‹ï¼Œæé«˜ç¨‹åºçš„å¤ç”¨æ€§ ç¼ºç‚¹ç›¸æ¯”äºç›´æ¥è°ƒç”¨ï¼Œåå°„æœ‰æ¯”è¾ƒå¤§çš„æ€§èƒ½æ¶ˆè€—å†…éƒ¨æš´éœ²å’Œå®‰å…¨éšæ‚£ ï¼ˆå› ä¸ºåå°„å¯ä»¥æ“ä½œprivateæˆå‘˜å˜é‡å’Œè°ƒç”¨privateæˆå‘˜æ–¹æ³•ï¼‰ åå°„çš„åŸºæœ¬æ“ä½œè·å–ç±»å¯¹è±¡çš„4ç§æ–¹å¼123456789101112// è°ƒç”¨forNameæ–¹æ³•å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹å¼Class&lt;?&gt; object = Class.forName(&quot;com.ibli.javaBase.reflection.User&quot;);// é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨getClassæ–¹æ³•Teacher teacher = new Teacher();Class&lt;?&gt; objectT = teacher.getClass();// é€šè¿‡ç±»åŠ è½½å™¨çš„æ–¹å¼Class&lt;?&gt; loader = ClassLoader.getSystemClassLoader().loadClass(&quot;com.ibli.javaBase.reflection.User&quot;);//é€šè¿‡ä¸€ä¸ªç±».classClass&lt;?&gt; tt = Teacher.class; åŸºæœ¬ä¿¡æ¯æ“ä½œ ç±»ä¿®é¥°ç¬¦ PUBLIC PRIVATE PROTECTED STATIC FINAL SYNCHRONIZED VOLATILE TRANSIENT NATIVE INTERFACE ABSTRACT modifiers 1 2 4 8 16 32 64 128 256 512 1024 12345678910111213141516// ç±»çš„ä¿®é¥°ç¬¦ å…·ä½“çš„å€¼å¯ä»¥å‚è€ƒJDK APIæ–‡æ¡£ä¸­çš„å®šä¹‰ è¿”å›å€¼æ˜¯intç±»å‹ publicï¼š1System.err.println(tt.getModifiers());// åŒ…åSystem.err.println(tt.getPackage());// ç±»çš„åç§°System.err.println(tt.getName());// çˆ¶ç±»System.err.println(tt.getSuperclass());// ç±»åŠ è½½å™¨System.err.println(tt.getClassLoader());// ç®€ç§°System.err.println(tt.getSimpleName());// ç±»å®ç°çš„æ‰€æœ‰çš„æ¥å£System.err.println(tt.getInterfaces().length);// æ‰€æœ‰çš„æ³¨è§£ç±»å‹System.err.println(tt.getAnnotations().length); æ‰§è¡Œç»“æœï¼š 123456781package com.ibli.javaBase.reflectioncom.ibli.javaBase.reflection.Teacherclass java.lang.Objectsun.misc.Launcher$AppClassLoader@18b4aac2Teacher00 æŸ¥çœ‹ç±»çš„å˜é‡12345678910111213141516// User extend Person(aa,bb)Class&lt;User&gt; obj = User.class;User user = obj.newInstance();// èƒ½å¤Ÿæ‹¿åˆ°ç±»çš„æ‰€æœ‰çš„å˜é‡Field[] fields = obj.getDeclaredFields();for (Field field : fields)&#123; System.out.println(field.getModifiers() + &quot; &quot; + field.getName());&#125;System.out.println(&quot; &quot;);// åªèƒ½å¤Ÿæ‹¿åˆ°ç±»çš„publicçš„å˜é‡Field[] fields1 = obj.getFields();for (Field field : fields1)&#123; System.out.println(field.getModifiers() + &quot; &quot; + field.getName());&#125;System.out.println(&quot; &quot;); æ‰§è¡Œç»“æœï¼š 123456782 age2 name1 sex10 height 1 sex1 aa1 bb ç»“è®ºï¼š getDeclaredFieldsï¼ˆ1ï¼‰getDeclaredFieldsèƒ½å¤Ÿè·å–æœ¬ç±»çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œæ— è®ºæ˜¯publicè¿˜æ˜¯private;ï¼ˆ2ï¼‰ä½†æ˜¯ä¸èƒ½è·å–çˆ¶ç±»çš„ä»»ä½•å±æ€§ï¼›ï¼ˆ3ï¼‰å¯ä»¥è·å–staticç±»å‹çš„å±æ€§ï¼› getFieldsï¼ˆ1ï¼‰åªèƒ½å¤Ÿè·å–æœ¬ç±»çš„publicå±æ€§ï¼›ï¼ˆ2ï¼‰èƒ½å¤Ÿè·å–çˆ¶ç±»çš„publicå±æ€§ï¼›ï¼ˆ3ï¼‰å¯ä»¥è·å–staticç±»å‹çš„å±æ€§ï¼› ä¿®æ”¹å±æ€§1234567891011// è®¾ç½®Personä¸­çš„å˜é‡aaField aaField = obj.getField(&quot;aa&quot;);aaField.setInt(user,111);System.err.println(user.getAa());// è®¾ç½®Userç§æœ‰æˆå‘˜å˜é‡Field ageField = obj.getDeclaredField(&quot;age&quot;);// è®¾ç½®è®¿é—®æƒé™ageField.setAccessible(true);ageField.set(user,333);System.err.println(user.getAge()); æ‰§è¡Œç»“æœï¼š 12111333 æŸ¥çœ‹æ–¹æ³•1234567891011121314151617Class&lt;User&gt; obj = User.class;User user = obj.newInstance();// å¯ä»¥è·å–çˆ¶ç±»çš„æ–¹æ³•Method[] methods = obj.getMethods();for (Method method : methods) &#123; System.out.println(method.getModifiers() + &quot; &quot; + method.getName());&#125;System.err.println(&quot; ----- &quot;);// è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•Method[] methods1 = obj.getDeclaredMethods();for (Method method : methods1) &#123; System.out.println(method.getModifiers() + &quot; &quot; + method.getName());&#125;System.err.println(&quot; ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ &quot;);// æ‰§è¡Œç»“æœå°±ä¸å±•ç¤ºäº† ç»“è®ºï¼š getDeclaredMethodsï¼ˆ1ï¼‰å¯ä»¥è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼›ï¼ˆ2ï¼‰å¯ä»¥è·å–æœ¬ç±»çš„é™æ€æ–¹æ³• getMethodsï¼ˆ1ï¼‰å¯ä»¥è·å–æœ¬ç±»ä¸­çš„æ‰€æœ‰==å…¬æœ‰==æ–¹æ³•ï¼›ï¼ˆ2ï¼‰å¯ä»¥è·å–çˆ¶ç±»ä¸­çš„æ‰€æœ‰==å…¬æœ‰==æ–¹æ³•ï¼›ï¼ˆ3ï¼‰å¯ä»¥è·å–æœ¬ç±»å’Œçˆ¶ç±»çš„å…¬æœ‰é™æ€æ–¹æ³•ï¼› è°ƒç”¨æ–¹æ³•123456789// è®¿é—®ç§æœ‰æ–¹æ³•Method sleep = obj.getDeclaredMethod(&quot;sleep&quot;);sleep.setAccessible(true);sleep.invoke(user);// å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼Œinvokeç¬¬ä¸€ä¸ªå‚æ•°ä¼ nullå³å¯Method say = obj.getDeclaredMethod(&quot;say&quot;,String.class);say.setAccessible(true);say.invoke(null,&quot;hello java&quot;); æ‰§è¡Œç»“æœï¼š 12Im sleeping!say hello java æ„é€ å™¨çš„ä½¿ç”¨123456789101112Class&lt;User&gt; obj = User.class;// æŸ¥è¯¢å…±æœ‰çš„æ„é€ å™¨Constructor&lt;?&gt;[] constructors = obj.getConstructors();for (Constructor&lt;?&gt; constructor : constructors)&#123; System.out.println(constructor.getModifiers() + &quot; &quot; + constructor.getName());&#125;// å¯ä»¥è·å–ç§æœ‰çš„æ„é€ å™¨Constructor&lt;?&gt;[] constructors1 = obj.getDeclaredConstructors();for (Constructor&lt;?&gt; constructor : constructors1)&#123; System.err.println(constructor.getModifiers() + &quot; &quot; + constructor.getName());&#125; æ‰§è¡Œç»“æœï¼š 1234561 com.ibli.javaBase.reflection.User1 com.ibli.javaBase.reflection.User1 com.ibli.javaBase.reflection.User2 com.ibli.javaBase.reflection.User1 com.ibli.javaBase.reflection.User ç»“è®ºï¼š getConstructorsï¼ˆ1ï¼‰è·å¾—æœ¬ç±»æ‰€æœ‰çš„å…¬æœ‰æ„é€ å™¨ getDeclaredConstructorsï¼ˆ1ï¼‰è·å¾—æœ¬ç±»æ‰€æœ‰çš„æ„é€ å™¨ï¼ˆpublic&amp;privateï¼‰ å®ä¾‹åŒ–å¯¹è±¡1234567// ä½¿ç”¨newInstanceåˆ›å»ºå¯¹è±¡ è°ƒç”¨æ— å‚æ„é€ å™¨User user = obj.newInstance();// è·å–æ„é€ å™¨æ¥å®ä¾‹åŒ–å¯¹è±¡Constructor&lt;User&gt; constructor = obj.getDeclaredConstructor(Integer.class, String.class);constructor.setAccessible(true);User temp = constructor.newInstance(22, &quot;java&quot;);System.err.println(temp.getAge() + &quot; &quot; + temp.getName()); æ‰§è¡Œç»“æœï¼š 22 java åå°„æ€§èƒ½ä¸ºä»€ä¹ˆå·® å¯ä»¥ä»ä¸¤æ–¹é¢è€ƒè™‘ï¼Œç¬¬ä¸€ä¸ªæ˜¯åå°„ç”ŸæˆClasså¯¹è±¡æ—¶æ€§èƒ½å·®ï¼Œç¬¬äºŒæ˜¯é€šè¿‡åå°„è°ƒç”¨å¯¹è±¡æ–¹å¼æ˜¯çš„æ€§èƒ½å·®ï¼› ï¼ˆ1ï¼‰ è°ƒç”¨forName æœ¬åœ°æ–¹æ³•ï¼ˆ2ï¼‰æ¯æ¬¡newInstance éƒ½ä¼šè¿›è¡Œä¸€æ¬¡å®‰å…¨æ£€æŸ¥ï¼ˆ3ï¼‰åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–¹æ³•çš„åå°„è°ƒç”¨ä¸ºå§”æ´¾å®ç°ï¼Œå§”æ´¾ç»™æœ¬åœ°å®ç°æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ã€‚åœ¨è°ƒç”¨è¶…è¿‡ 15æ¬¡ä¹‹åï¼Œå§”æ´¾å®ç°ä¾¿ä¼šå°†å§”æ´¾å¯¹è±¡åˆ‡æ¢è‡³åŠ¨æ€å®ç°ã€‚è¿™ä¸ªåŠ¨æ€å®ç°çš„å­—èŠ‚ç æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå®ƒå°†ç›´æ¥ä½¿ç”¨ invoke æŒ‡ä»¤æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚ æ–¹æ³•çš„åå°„è°ƒç”¨ä¼šå¸¦æ¥ä¸å°‘æ€§èƒ½å¼€é”€ï¼ŒåŸå› ä¸»è¦æœ‰ä¸‰ä¸ªï¼š å˜é•¿å‚æ•°æ–¹æ³•å¯¼è‡´çš„Objectæ•°ç»„ åŸºæœ¬ç±»å‹çš„è‡ªåŠ¨è£…ç®±ã€æ‹†ç®± (å‚è€ƒèµ„æ–™2) è¿˜æœ‰æœ€é‡è¦çš„æ–¹æ³•å†…è”ã€‚ å‚è€ƒèµ„æ–™(1)åå°„ä¸ºä»€ä¹ˆæ…¢(2)å…³äºè£…ç®±æ‹†ç®±ä¸ºä»€ä¹ˆä¼šå½±å“æ•ˆç‡(3)jvmä¹‹æ–¹æ³•å†…è”ä¼˜åŒ– åå°„ä½¿ç”¨çš„åœºæ™¯ JDBCå°è£… Spring IOC jdbcTemplate Mybatisä½¿ç”¨å¤§é‡åå°„ ä½¿ç”¨åå°„æ³¨æ„ç‚¹ åœ¨è·å–Field,method,construtorçš„æ—¶å€™ï¼Œåº”å°½é‡é¿å…æ˜¯ç”¨getDelcaredXXX(),åº”è¯¥ä¼ è¿›å‚æ•°è·å–æŒ‡å®šçš„å­—æ®µï¼Œæ–¹æ³•å’Œæ„é€ å™¨ï¼› ä½¿ç”¨ç¼“å­˜æœºåˆ¶ç¼“å­˜åå°„æ“ä½œç›¸å…³å…ƒæ•°æ®çš„åŸå› æ˜¯å› ä¸ºåå°„æ“ä½œç›¸å…³å…ƒæ•°æ®çš„å®æ—¶è·å–æ˜¯æ¯”è¾ƒè€—æ—¶çš„ --------------------- å‰é€”æµ©æµ©è¡è¡ ä¸‡äº‹å°½å¯æœŸå¾…ã€‚----------------------- åå°„åœ¨IOCä¸­çš„åº”ç”¨","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"Javaå¹¶å‘ç¼–ç¨‹ä¹‹åŒæ­¥é”","date":"2021-07-26T14:27:05.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹ä¹‹åŒæ­¥é”/","text":"","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"Javaå¤šçº¿ç¨‹ä¹‹ThreadLocal","date":"2021-07-26T08:28:01.000Z","path":"wiki/Javaå¤šçº¿ç¨‹ä¹‹ThreadLocal/","text":"ThreadLocalMapç»“æ„ ThreadLocalåº•å±‚å®é™…ä¸Šæ˜¯ä¾èµ–ThreadLocalMapæ¥å®ç°æ•°æ®å­˜å‚¨çš„ï¼Œè€ŒThreadLocalMapå¹¶ä¸æ˜¯çœŸæ­£çš„Mapç»“æ„ï¼Œå®ƒæ˜¯åŸºäºThreadLocalMapç±»ä¸­çš„å†…éƒ¨ç±»Entryç±»å‹çš„æ•°ç»„æ¥å®ç°ã€‚ 123456789 static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123; /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) &#123; super(k); value = v; &#125;&#125; å®ƒçš„keyå…¶å®å°±æ˜¯å½“å‰threadlocalå˜é‡ï¼Œç»§æ‰¿äº†WeakReferenceã€‚ç„¶åObject value;å®é™…å­˜å‚¨çš„å€¼ã€‚ Threadç±»ä¸­æœ‰ThreadLocalç±»å‹çš„å˜é‡ï¼Œå¦‚ä¸‹ğŸ‘‡ 12345678910 /* ThreadLocal values pertaining to this thread. This map is maintained * by the ThreadLocal class. */ ThreadLocal.ThreadLocalMap threadLocals = null; /* * InheritableThreadLocal values pertaining to this thread. This map is * maintained by the InheritableThreadLocal class. */// å­çº¿ç¨‹å¯ä»¥è·å–åˆ°inheritableThreadLocalsä¸­çš„å€¼ ThreadLocal.ThreadLocalMap inheritableThreadLocals = null; ä¸ºä»€ä¹ˆThreadLocalMapä½¿ç”¨ThreadLocalå½“ä½œkeyè€Œä¸æ˜¯Threadå‘¢ï¼Ÿ 1ã€å› ä¸ºä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šå‡ºç°å¤šä¸ªThreadLocalå˜é‡ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªThreadLocalMapï¼ˆå®è´¨ä¸Šæ˜¯Entryæ•°ç»„ï¼‰æ¥å­˜æ”¾å¤šä¸ªThreadLocalå˜é‡ã€‚ 2ã€å€˜è‹¥æ˜¯Threadä½œä¸ºkeyï¼Œå°±ä¼šå˜æˆå¤šä¸ªçº¿ç¨‹å…±åŒè®¿é—®ä¸€ä¸ªThreadLocalMapï¼Œå°±ä¼šå˜æˆçº¿ç¨‹å…¬ç”¨çš„å˜é‡ï¼Œé‚£ä¸ªæ¯ä¸ªçº¿ç¨‹ä¸­å¯èƒ½å­˜å‚¨å¤šä¸ªThreadLocalå˜é‡çš„æƒ…å†µä¸‹ï¼ŒEntryå¯èƒ½çœŸçš„ç”¨åˆ°mapç»“æœæ‰å¯ä»¥å®ç°å‘€ 3ã€å¤šä¸ªçº¿ç¨‹å…±åŒè®¿é—®ThreadLocalMapï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°ThreadLocalMapæåŠå¾ˆå¤§ä»è€Œé™ä½æ€§èƒ½ï¼Œè€Œä¸”ä½•æ—¶é”€æ¯è¿™ä¸ªå˜é‡æ˜¯æ— æ³•ç¡®å®šçš„ ThreadLocal setæµç¨‹ ä¸‹é¢æ˜¯setæ–¹æ³•çš„æºç  12345678public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);&#125; setçš„æ“ä½œå°±æ˜¯å‘Entryæ•°ç»„ä¸­æ·»åŠ å½“å‰å˜é‡å’Œå€¼ğŸ‘‡ ç”¨æ•°ç»„æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æœ‰å¤šä¸ªTreadLocalæ¥å­˜æ”¾ä¸åŒç±»å‹çš„å¯¹è±¡çš„ï¼Œä½†æ˜¯ä»–ä»¬éƒ½å°†æ”¾åˆ°ä½ å½“å‰çº¿ç¨‹çš„ThreadLocalMapé‡Œï¼Œæ‰€ä»¥è‚¯å®šè¦æ•°ç»„æ¥å­˜ã€‚ è‡³äºHashå†²çªï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æºç ï¼š 1234567891011121314151617181920212223private void set(ThreadLocal&lt;?&gt; key, Object value) &#123; Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) &#123; e.value = value; return; &#125; if (k == null) &#123; replaceStaleEntry(key, value, i); return; &#125; &#125; tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash(); &#125; æˆ‘ä»æºç é‡Œé¢çœ‹åˆ°ThreadLocalMapåœ¨å­˜å‚¨çš„æ—¶å€™ä¼šç»™æ¯ä¸€ä¸ªThreadLocalå¯¹è±¡ä¸€ä¸ªthreadLocalHashCodeï¼Œåœ¨æ’å…¥è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ThreadLocalå¯¹è±¡çš„hashå€¼ï¼Œå®šä½åˆ°tableä¸­çš„ä½ç½®iï¼Œ**int i = key.threadLocalHashCode &amp; (len-1)**ã€‚ ç„¶åä¼šåˆ¤æ–­ä¸€ä¸‹ï¼šå¦‚æœå½“å‰ä½ç½®æ˜¯ç©ºçš„ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªEntryå¯¹è±¡æ”¾åœ¨ä½ç½®iä¸Šï¼› 1234if (k == null) &#123; replaceStaleEntry(key, value, i); return;&#125; å¦‚æœä½ç½®iä¸ä¸ºç©ºï¼Œå¦‚æœè¿™ä¸ªEntryå¯¹è±¡çš„keyæ­£å¥½æ˜¯å³å°†è®¾ç½®çš„keyï¼Œé‚£ä¹ˆå°±åˆ·æ–°Entryä¸­çš„valueï¼› 1234if (k == key) &#123; e.value = value; return;&#125; å¦‚æœä½ç½®içš„ä¸ä¸ºç©ºï¼Œè€Œä¸”keyä¸ç­‰äºentryï¼Œé‚£å°±æ‰¾ä¸‹ä¸€ä¸ªç©ºä½ç½®ï¼Œç›´åˆ°ä¸ºç©ºä¸ºæ­¢ã€‚ ThreadLocalæ˜¯å¦‚ä½•å¼•èµ·å†…å­˜æ³„æ¼çš„ï¼Ÿå¦‚ä¸Šé¢Entryçš„æºç å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œstatic class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; ä¸€ä¸ªThreadLocalå˜é‡å­˜åœ¨ä¸¤æ¡å¼•ç”¨ï¼š 1ã€ThreadLocalRefï¼ˆæ ˆï¼‰-ã€‹ThreadLocalï¼ˆkeyï¼‰å’Œ ThreadLocalMap -&gt; ThreadLocalï¼ˆkeyï¼‰ 2ã€ThreadRef -&gt; Thread -&gt; ThreadLocalMap -&gt; Entry -&gt; Value å†…å­˜æ³„æ¼å€¼çš„æ˜¯ThreadLocalè¢«å›æ”¶äº†ï¼ŒThreadLocalMap -&gt; Entry -&gt; keyæ²¡æœ‰äº†æŒ‡å‘ï¼Œä½†æ˜¯Entryçš„valueçš„æŒ‡å‘è¿˜åœ¨ï¼Œé•¿æœŸå ç”¨å†…å­˜ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ThreadLocalä½¿ç”¨å®Œä¹‹ååŠæ—¶remove ä¸ºä»€ä¹ˆå»ºè®®ThreadLocalå˜é‡ä¸ºstaticç±»å‹çš„ThreadLocalèƒ½å¤Ÿå®ç°çº¿ç¨‹éš”ç¦»çš„å…³é”®åœ¨äºThreadæŒæœ‰è‡ªå·±çš„ä¸€ä¸ªThreadLocalMapå˜é‡ï¼Œéœ€è¦æ¯ä¸€ä¸ªThreadLocalå˜é‡å ç”¨ä¸€ä¸ªEntryå°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å¿…è¦ä½œä¸ºæˆå‘˜å˜é‡é¢‘ç¹åˆ›å»ºï¼Œæµªè´¹å†…å­˜ç©ºé—´ã€‚ å‚è€ƒèµ„æ–™ Javaé¢è¯•å¿…é—®ï¼šThreadLocalç»ˆæç¯‡ ã€å¯¹çº¿é¢è¯•å®˜ã€‘ThreadLocal","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"åŸºç¡€é¢è¯•é¢˜ç›®","date":"2021-07-26T02:05:07.000Z","path":"wiki/åŸºç¡€é¢è¯•é¢˜ç›®/","text":"1.Stringä¸å¯å˜String å¯¹è±¡çš„ä¸å¯å˜æ€§ äº†è§£äº† String å¯¹è±¡çš„å®ç°åï¼Œä½ æœ‰æ²¡æœ‰å‘ç°åœ¨å®ç°ä»£ç ä¸­ String ç±»è¢« final å…³é”®å­—ä¿®é¥°äº†ï¼Œè€Œä¸”å˜é‡ char æ•°ç»„ä¹Ÿè¢« final ä¿®é¥°äº†ã€‚ æˆ‘ä»¬çŸ¥é“ç±»è¢« final ä¿®é¥°ä»£è¡¨è¯¥ç±»ä¸å¯ç»§æ‰¿ï¼Œè€Œ char[] è¢« final+private ä¿®é¥°ï¼Œä»£è¡¨äº† String å¯¹è±¡ä¸å¯è¢«æ›´æ”¹ã€‚Java å®ç°çš„è¿™ä¸ªç‰¹æ€§å«ä½œ String å¯¹è±¡çš„ä¸å¯å˜æ€§ï¼Œå³ String å¯¹è±¡ä¸€æ—¦åˆ›å»ºæˆåŠŸï¼Œå°±ä¸èƒ½å†å¯¹å®ƒè¿›è¡Œæ”¹å˜ã€‚ Java è¿™æ ·åšçš„å¥½å¤„åœ¨å“ªé‡Œå‘¢ï¼Ÿ ç¬¬ä¸€ï¼Œä¿è¯ String å¯¹è±¡çš„å®‰å…¨æ€§ã€‚å‡è®¾ String å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆ String å¯¹è±¡å°†å¯èƒ½è¢«æ¶æ„ä¿®æ”¹ã€‚ ç¬¬äºŒï¼Œä¿è¯ hash å±æ€§å€¼ä¸ä¼šé¢‘ç¹å˜æ›´ï¼Œç¡®ä¿äº†å”¯ä¸€æ€§ï¼Œä½¿å¾—ç±»ä¼¼ HashMap å®¹å™¨æ‰èƒ½å®ç°ç›¸åº”çš„ key-value ç¼“å­˜åŠŸèƒ½ã€‚ ç¬¬ä¸‰ï¼Œå¯ä»¥å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚åœ¨ Java ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡å­—ç¬¦ä¸²å¸¸é‡çš„æ–¹å¼åˆ›å»ºï¼Œå¦‚ String str=â€œabcâ€ï¼›å¦ä¸€ç§æ˜¯å­—ç¬¦ä¸²å˜é‡é€šè¿‡ new å½¢å¼çš„åˆ›å»ºï¼Œå¦‚ String str = new String(â€œabcâ€)ã€‚ å½“ä»£ç ä¸­ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆä¼šæ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦‚æœåœ¨ï¼Œå°±è¿”å›è¯¥å¯¹è±¡å¼•ç”¨ï¼Œå¦åˆ™æ–°çš„å­—ç¬¦ä¸²å°†åœ¨å¸¸é‡æ± ä¸­è¢«åˆ›å»ºã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘åŒä¸€ä¸ªå€¼çš„å­—ç¬¦ä¸²å¯¹è±¡çš„é‡å¤åˆ›å»ºï¼ŒèŠ‚çº¦å†…å­˜ã€‚ 2.String å’Œ StringBuilderã€StringBuffer çš„åŒºåˆ«ï¼Ÿhttps://www.cnblogs.com/weibanggang/p/9455926.html 3.æè¿°ä¸€ä¸‹ JVM åŠ è½½ class æ–‡ä»¶çš„åŸç†æœºåˆ¶ï¼Ÿhttps://www.cnblogs.com/williamjie/p/11167920.html 4.char å‹å˜é‡ä¸­èƒ½ä¸èƒ½å­˜è´®ä¸€ä¸ªä¸­æ–‡æ±‰å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿæ­£ç¡®ç­”æ¡ˆï¼š charå‹å˜é‡æ˜¯ç”¨æ¥å­˜å‚¨Unicodeç¼–ç çš„å­—ç¬¦çš„ï¼Œunicodeç¼–ç å­—ç¬¦é›†ä¸­åŒ…å«äº†æ±‰å­—ï¼Œ æ‰€ä»¥ï¼Œcharå‹å˜é‡ä¸­å½“ç„¶å¯ä»¥å­˜å‚¨æ±‰å­—å•¦ã€‚ä¸è¿‡ï¼Œå¦‚æœæŸä¸ªç‰¹æ®Šçš„æ±‰å­—æ²¡æœ‰è¢«åŒ…å«åœ¨unicodeç¼–ç å­—ç¬¦é›†ä¸­ï¼Œ é‚£ä¹ˆï¼Œè¿™ä¸ªcharå‹å˜é‡ä¸­å°±ä¸èƒ½å­˜å‚¨è¿™ä¸ªç‰¹æ®Šæ±‰å­—ã€‚ è¡¥å……è¯´æ˜ï¼šunicodeç¼–ç å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ï¼Œcharç±»å‹çš„å˜é‡ä¹Ÿæ˜¯å ç”¨ä¸¤ä¸ªå­—èŠ‚ 5.æŠ½è±¡ç±»ï¼ˆabstract classï¼‰å’Œæ¥å£ï¼ˆinterfaceï¼‰æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿhttps://blog.csdn.net/aptentity/article/details/68942916 6.é™æ€åµŒå¥—ç±»(Static Nested Class)å’Œå†…éƒ¨ç±»ï¼ˆInner Classï¼‰çš„ä¸åŒï¼Ÿhttps://blog.csdn.net/machinecat0898/article/details/80071242 7.æŠ½è±¡çš„ï¼ˆabstractï¼‰æ–¹æ³•æ˜¯å¦å¯åŒæ—¶æ˜¯é™æ€çš„ï¼ˆstaticï¼‰,ï¼ˆnativeï¼‰ï¼Œ synchronized ä¿®é¥°ï¼Ÿ ç­”ï¼šéƒ½ä¸èƒ½ã€‚æŠ½è±¡æ–¹æ³•éœ€è¦å­ç±»é‡å†™ï¼Œè€Œé™æ€çš„æ–¹æ³•æ˜¯æ— æ³•è¢«é‡å†™çš„ï¼Œå› æ­¤äºŒè€…æ˜¯çŸ›ç›¾çš„ã€‚æœ¬åœ°æ–¹æ³•æ˜¯ç”±æœ¬åœ°ä»£ç ï¼ˆå¦‚Cä»£ç ï¼‰å®ç°çš„æ–¹æ³•ï¼Œè€ŒæŠ½è±¡æ–¹æ³•æ˜¯æ²¡æœ‰å®ç°çš„ï¼Œä¹Ÿæ˜¯çŸ›ç›¾çš„ã€‚synchronizedå’Œæ–¹æ³•çš„å®ç°ç»†èŠ‚æœ‰å…³ï¼ŒæŠ½è±¡æ–¹æ³•ä¸æ¶‰åŠå®ç°ç»†èŠ‚ï¼Œå› æ­¤ä¹Ÿæ˜¯ç›¸äº’çŸ›ç›¾çš„ã€‚ 8.å¦‚ä½•å®ç°å¯¹è±¡å…‹éš†https://www.cnblogs.com/fnlingnzb-learner/p/10649509.html 9.å†…éƒ¨ç±»å¯ä»¥å¼•ç”¨å®ƒçš„åŒ…å«ç±»ï¼ˆå¤–éƒ¨ç±»ï¼‰çš„æˆå‘˜å—ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆé™åˆ¶https://www.cnblogs.com/aademeng/articles/11084885.htmlhttps://www.cnblogs.com/dolphin0520/p/3811445.html é™æ€å†…éƒ¨ç±»ï¼šå®ƒæ˜¯ç”¨staticä¿®é¥°çš„ï¼Œåœ¨è®¿é—®é™åˆ¶ä¸Šå®ƒåªèƒ½è®¿é—®å¤–éƒ¨ç±»ä¸­çš„staticæ‰€ä¿®é¥°çš„æˆå‘˜å˜é‡æˆ–è€…æ˜¯æ–¹æ³•æˆå‘˜å†…éƒ¨ç±»ï¼šæˆå‘˜å†…éƒ¨ç±»æ˜¯æœ€æ™®é€šçš„å†…éƒ¨ç±»ï¼Œå®ƒå¯ä»¥æ— æ¡ä»¶è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜å±æ€§å’Œæˆå‘˜æ–¹æ³•ï¼ˆåŒ…æ‹¬privateæˆå‘˜å’Œé™æ€æˆå‘˜ï¼‰ã€‚ã€æ³¨æ„ã€‘å½“æˆå‘˜å†…éƒ¨ç±»æ‹¥æœ‰å’Œå¤–éƒ¨ç±»åŒåçš„æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿéšè—ç°è±¡ï¼Œå³é»˜è®¤æƒ…å†µä¸‹è®¿é—®çš„æ˜¯æˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜ã€‚å¦‚æœè¦è®¿é—®å¤–éƒ¨ç±»çš„åŒåæˆå‘˜ï¼Œéœ€è¦ä»¥ä¸‹é¢çš„å½¢å¼è¿›è¡Œè®¿é—®ï¼šå±€éƒ¨å†…éƒ¨ç±»ï¼šå±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¤–å›´ç±»çš„æ–¹æ³•ä¸­çš„ï¼Œåœ¨è®¿é—®çš„æ—¶å€™å®ƒå¯ä»¥ç›´æ¥è®¿é—®å¤–å›´ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ä½†æ˜¯ä¸èƒ½éšä¾¿è®¿é—®å±€éƒ¨å˜é‡ï¼Œé™¤éè¿™ä¸ªå±€éƒ¨å˜é‡è¢«finalä¿®é¥°ã€‚åŒ¿åå†…éƒ¨ç±»ï¼š 10.Java ä¸­çš„ final å…³é”®å­—æœ‰å“ªäº›ç”¨æ³•ï¼Ÿhttps://www.cnblogs.com/dotgua/p/6357951.htmlå¤šçº¿ç¨‹ä¸‹çš„finalè¯­ä¹‰ ğŸ‘‡https://www.codercc.com/backend/basic/juc/concurrent-keywords/final.html#_1-final%E7%9A%84%E7%AE%80%E4%BB%8B ä¿®é¥°å˜é‡åŸºæœ¬ç±»å‹çš„å˜é‡ï¼Œå€¼æ˜¯ä¸å¯ä»¥å˜åŒ–çš„å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œå¼•ç”¨æ˜¯ä¸å¯ä»¥å˜åŒ–çš„ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹å¼•ç”¨çš„å€¼æ–¹æ³•å‚æ•°ï¼š ä¿è¯è¿™ä¸ªå˜é‡åœ¨è¿™ä¸ªæ–¹æ³•ä¸­çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ– ä¿®é¥°æ–¹æ³•å®ƒè¡¨ç¤ºè¯¥æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ã€‚è¿™ç§ä½¿ç”¨æ–¹å¼ä¸»è¦æ˜¯ä»è®¾è®¡çš„è§’åº¦è€ƒè™‘ï¼Œå³æ˜ç¡®å‘Šè¯‰å…¶ä»–å¯èƒ½ä¼šç»§æ‰¿è¯¥ç±»çš„ç¨‹åºå‘˜ï¼Œä¸å¸Œæœ›ä»–ä»¬å»è¦†ç›–è¿™ä¸ªæ–¹æ³•ã€‚è¿™ç§æ–¹å¼æˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼Œç„¶è€Œï¼Œå…³äºprivateå’Œfinalå…³é”®å­—è¿˜æœ‰ä¸€ç‚¹è”ç³»ï¼Œè¿™å°±æ˜¯ç±»ä¸­æ‰€æœ‰çš„privateæ–¹æ³•éƒ½éšå¼åœ°æŒ‡å®šä¸ºæ˜¯finalçš„ï¼Œç”±äºæ— æ³•åœ¨ç±»å¤–ä½¿ç”¨privateæ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•è¦†ç›–å®ƒ ä¿®é¥°ç±»ç”¨finalä¿®é¥°çš„ç±»æ˜¯æ— æ³•è¢«ç»§æ‰¿çš„ 11.Thread ç±»çš„ sleep()æ–¹æ³•å’Œå¯¹è±¡çš„ wait()æ–¹æ³•éƒ½å¯ä»¥è®©çº¿ç¨‹æš‚åœæ‰§è¡Œï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«?sleep()æ–¹æ³•æ˜¯Threadç±» sleepæ˜¯Threadçš„é™æ€nativeæ–¹æ³•,å¯éšæ—¶è°ƒç”¨,ä¼šä½¿å½“å‰çº¿ç¨‹ä¼‘çœ ,å¹¶é‡Šæ”¾CPUèµ„æº,ä½†ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”; wait()æ–¹æ³•æ˜¯Objectç±» wait()æ–¹æ³•æ˜¯Objectçš„nativeæ–¹æ³•,åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ä½¿ç”¨,è°ƒç”¨ä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€,å¹¶é‡Šæ”¾CPUèµ„æºä¸å¯¹è±¡é”,éœ€è¦æˆ‘ä»¬è°ƒç”¨notify/notifyAllæ–¹æ³•å”¤é†’æŒ‡å®šæˆ–å…¨éƒ¨çš„ä¼‘çœ çº¿ç¨‹,å†æ¬¡ç«äº‰CPUèµ„æº. æ³¨æ„:sleep(long millis)å­˜åœ¨ç¡çœ æ—¶é—´,ä¸ç®—ç‰¹ç‚¹å› ä¸ºwait()æ–¹æ³•å­˜åœ¨é‡è½½wait(long timeout),å³è®¾ç½®äº†ç­‰å¾…è¶…æ—¶æ—¶é—´å®ƒä»¬ä¸¤ä¸ªéƒ½éœ€è¦å†æ¬¡æŠ¢å¤ºCPUèµ„æº 12.çº¿ç¨‹çš„ sleep()æ–¹æ³•å’Œ yield()æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿsleep()æ–¹æ³•åœ¨ç»™å…¶ä»–çº¿ç¨‹è¿è¡Œæœºä¼šæ—¶ä¸è€ƒè™‘çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚å› æ­¤ä¼šç»™ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹è¿è¡Œçš„æœºä¼šï¼Œè€Œyield()æ–¹æ³•åªä¼šç»™ç›¸åŒä¼˜å…ˆçº§æˆ–æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹è¿è¡Œçš„æœºä¼šã€‚çº¿ç¨‹æ‰§è¡Œsleep()æ–¹æ³•åä¼šè½¬å…¥é˜»å¡çŠ¶æ€ï¼Œæ‰€ä»¥æ‰§è¡Œsleep()æ–¹æ³•çš„çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…è‚¯å®šä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œyield()æ–¹æ³•åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°å°±ç»ªçŠ¶æ€ï¼Œæ‰€ä»¥æ‰§è¡Œyield()æ–¹æ³•çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å°±ç»ªçŠ¶æ€ååˆç«‹é©¬è¢«æ‰§è¡Œã€‚ 13.çº¿ç¨‹çš„åŸºæœ¬çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´çš„å…³ç³» https://blog.csdn.net/zhangdongnihao/article/details/104029972 https://juejin.cn/post/6885159254764814349 14.è®¿é—®ä¿®é¥°ç¬¦ public,private,protected,ä»¥åŠä¸å†™ï¼ˆé»˜è®¤ï¼‰æ—¶çš„åŒºåˆ«ï¼Ÿ 15.è¯·è¯´å‡ºä¸çº¿ç¨‹åŒæ­¥ä»¥åŠçº¿ç¨‹è°ƒåº¦ç›¸å…³çš„æ–¹æ³•ã€‚ï¼ˆ1ï¼‰ wait()ï¼šä½¿ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…ï¼ˆé˜»å¡ï¼‰çŠ¶æ€ï¼Œå¹¶ä¸”é‡Šæ”¾æ‰€æŒæœ‰çš„å¯¹è±¡çš„é”ï¼›ï¼ˆ2ï¼‰sleep()ï¼šä½¿ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹å¤„äºç¡çœ çŠ¶æ€ï¼Œæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•è¦å¤„ç† InterruptedException å¼‚å¸¸ï¼›ï¼ˆ3ï¼‰notify()ï¼šå”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œå½“ç„¶åœ¨è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ç¡®åˆ‡çš„å”¤é†’æŸä¸€ä¸ªç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œè€Œæ˜¯ç”± JVM ç¡®å®šå”¤é†’å“ªä¸ªçº¿ç¨‹ï¼Œè€Œä¸”ä¸ä¼˜å…ˆçº§æ— å…³ï¼›ï¼ˆ4ï¼‰notityAll()ï¼šå”¤é†’æ‰€æœ‰å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¯¥æ–¹æ³•å¹¶ä¸æ˜¯å°†å¯¹è±¡çš„é”ç»™æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œæ˜¯è®©å®ƒä»¬ç«äº‰ï¼Œåªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥å°±ç»ªçŠ¶æ€ï¼› è¡¥å……ï¼šJava 5 é€šè¿‡ Lock æ¥å£æä¾›äº†æ˜¾å¼çš„é”æœºåˆ¶ï¼ˆexplicit lockï¼‰ï¼Œå¢å¼ºäº†çµæ´»æ€§ä»¥åŠå¯¹çº¿ç¨‹çš„åè°ƒã€‚Lock æ¥å£ä¸­å®šä¹‰äº†åŠ é”ï¼ˆlock()ï¼‰å’Œè§£é”ï¼ˆunlock()ï¼‰çš„æ–¹æ³•ï¼ŒåŒæ—¶è¿˜æä¾›äº† newCondition()æ–¹æ³•æ¥äº§ç”Ÿç”¨äºçº¿ç¨‹ä¹‹é—´é€šä¿¡çš„ Condition å¯¹è±¡ï¼›æ­¤å¤–ï¼ŒJava 5 è¿˜æä¾›äº†ä¿¡å·é‡æœºåˆ¶ï¼ˆsemaphoreï¼‰ï¼Œä¿¡å·é‡å¯ä»¥ç”¨æ¥é™åˆ¶å¯¹æŸä¸ªå…±äº«èµ„æºè¿›è¡Œè®¿é—®çš„çº¿ç¨‹çš„æ•°é‡ã€‚åœ¨å¯¹èµ„æºè¿›è¡Œè®¿é—®ä¹‹å‰ï¼Œçº¿ç¨‹å¿…é¡»å¾—åˆ°ä¿¡å·é‡çš„è®¸å¯ï¼ˆè°ƒç”¨ Semaphore å¯¹è±¡çš„ acquire()æ–¹æ³•ï¼‰ï¼›åœ¨å®Œæˆå¯¹èµ„æºçš„è®¿é—®åï¼Œçº¿ç¨‹å¿…é¡»å‘ä¿¡å·é‡å½’è¿˜è®¸å¯ï¼ˆè°ƒç”¨ Semaphore å¯¹è±¡çš„ release()æ–¹æ³•ï¼‰ã€‚ 16.synchronized å…³é”®å­—çš„ç”¨æ³•ï¼Ÿ12345678910111213141516171819202122public class SyncDemo &#123; final Object lock = new Object(); public synchronized void m1()&#123;&#125; public void m2()&#123; synchronized (SyncDemo.class)&#123; // TODO &#125; synchronized (lock)&#123; &#125; synchronized (this)&#123; &#125; &#125; public synchronized static void m3()&#123; &#125;&#125; 17.Java ä¸­å¦‚ä½•å®ç°åºåˆ—åŒ–ï¼Œæœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿåºåˆ—åŒ–å°±æ˜¯ä¸€ç§ç”¨æ¥å¤„ç†å¯¹è±¡æµçš„æœºåˆ¶ï¼Œæ‰€è°“å¯¹è±¡æµä¹Ÿå°±æ˜¯å°†å¯¹è±¡çš„å†…å®¹è¿›è¡ŒæµåŒ–ã€‚å¯ä»¥å¯¹æµåŒ–åçš„å¯¹è±¡è¿›è¡Œè¯»å†™æ“ä½œï¼Œä¹Ÿå¯å°†æµåŒ–åçš„å¯¹è±¡ä¼ è¾“äºç½‘ç»œä¹‹é—´ã€‚åºåˆ—åŒ–æ˜¯ä¸ºäº†è§£å†³å¯¹è±¡æµè¯»å†™æ“ä½œæ—¶å¯èƒ½å¼•å‘çš„é—®é¢˜ï¼ˆå¦‚æœä¸è¿›è¡Œåºåˆ—åŒ–å¯èƒ½ä¼šå­˜åœ¨æ•°æ®ä¹±åºçš„é—®é¢˜ï¼‰ã€‚è¦å®ç°åºåˆ—åŒ–ï¼Œéœ€è¦è®©ä¸€ä¸ªç±»å®ç° Serializable æ¥å£ï¼Œè¯¥æ¥å£æ˜¯ä¸€ä¸ªæ ‡è¯†æ€§æ¥å£ï¼Œæ ‡æ³¨è¯¥ç±»å¯¹è±¡æ˜¯å¯è¢«åºåˆ—åŒ–çš„ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªè¾“å‡ºæµæ¥æ„é€ ä¸€ä¸ªå¯¹è±¡è¾“å‡ºæµå¹¶é€šè¿‡ writeObject(Object)æ–¹æ³•å°±å¯ä»¥å°†å®ç°å¯¹è±¡å†™å‡ºï¼ˆå³ä¿å­˜å…¶çŠ¶æ€ï¼‰ï¼›å¦‚æœéœ€è¦ååºåˆ—åŒ–åˆ™å¯ä»¥ç”¨ä¸€ä¸ªè¾“å…¥æµå»ºç«‹å¯¹è±¡è¾“å…¥æµï¼Œç„¶åé€šè¿‡ readObject æ–¹æ³•ä»æµä¸­è¯»å–å¯¹è±¡ã€‚åºåˆ—åŒ–é™¤äº†èƒ½å¤Ÿå®ç°å¯¹è±¡çš„æŒä¹…åŒ–ä¹‹å¤–ï¼Œè¿˜èƒ½å¤Ÿç”¨äºå¯¹è±¡çš„æ·±åº¦å…‹éš† 18.é˜è¿° JDBC æ“ä½œæ•°æ®åº“çš„æ­¥éª¤ä¸‹é¢çš„ä»£ç ä»¥è¿æ¥æœ¬æœºçš„ Oracle æ•°æ®åº“ä¸ºä¾‹ï¼Œæ¼”ç¤º JDBC æ“ä½œæ•°æ®åº“çš„æ­¥éª¤ã€‚ï¼ˆ1ï¼‰ åŠ è½½é©±åŠ¨ã€‚Class.forName(&quot;oracle.jdbc.driver.OracleDriver&quot;);ï¼ˆ2ï¼‰ åˆ›å»ºè¿æ¥ã€‚Connection con = DriverManager.getConnection(&quot;jdbc:oracle:thin:@localhost:1521:orcl&quot;,&quot;scott&quot;, &quot;tiger&quot;);ï¼ˆ3ï¼‰ åˆ›å»ºè¯­å¥ã€‚ 123PreparedStatement ps = con.prepareStatement(&quot;select * from emp where sal between ? and ?&quot;);ps.setint(1, 1000);ps.setint(2, 3000); ï¼ˆ4ï¼‰æ‰§è¡Œè¯­å¥ã€‚ResultSet rs = ps.executeQuery();ï¼ˆ5ï¼‰å¤„ç†ç»“æœã€‚ 1234while(rs.next()) &#123; System.out.println(rs.getint(&quot;empno&quot;) + &quot; - &quot; + rs.getString(&quot;ename&quot;));&#125; ï¼ˆ6ï¼‰ å…³é—­èµ„æºã€‚ 12345678910finally &#123; if(con != null) &#123; try &#123; con.close(); &#125; catch (SQLException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æç¤ºï¼šå…³é—­å¤–éƒ¨èµ„æºçš„é¡ºåºåº”è¯¥å’Œæ‰“å¼€çš„é¡ºåºç›¸åï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆå…³é—­ ResultSetã€å†å…³é—­ Statementã€åœ¨å…³é—­ Connectionã€‚ä¸Šé¢çš„ä»£ç åªå…³é—­äº† Connectionï¼ˆè¿æ¥ï¼‰ï¼Œè™½ç„¶é€šå¸¸æƒ…å†µä¸‹åœ¨å…³é—­è¿æ¥æ—¶ï¼Œè¿æ¥ä¸Šåˆ›å»ºçš„è¯­å¥å’Œæ‰“å¼€çš„æ¸¸æ ‡ä¹Ÿä¼šå…³é—­ï¼Œä½†ä¸èƒ½ä¿è¯æ€»æ˜¯å¦‚æ­¤ï¼Œå› æ­¤åº”è¯¥æŒ‰ç…§åˆšæ‰è¯´çš„é¡ºåºåˆ†åˆ«å…³é—­ã€‚æ­¤å¤–ï¼Œç¬¬ä¸€æ­¥åŠ è½½é©±åŠ¨åœ¨ JDBC 4.0 ä¸­æ˜¯å¯ä»¥çœç•¥çš„ï¼ˆè‡ªåŠ¨ä»ç±»è·¯å¾„ä¸­åŠ è½½é©±åŠ¨ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å»ºè®®ä¿ç•™ã€‚ 19.Statement å’Œ PreparedStatement æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªä¸ªæ€§èƒ½æ›´å¥½ï¼Ÿä¸ Statement ç›¸æ¯”ï¼Œâ‘ PreparedStatement æ¥å£ä»£è¡¨é¢„ç¼–è¯‘çš„è¯­å¥ï¼Œå®ƒä¸»è¦çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥å‡å°‘ SQL çš„ç¼–è¯‘é”™è¯¯å¹¶å¢åŠ  SQL çš„å®‰å…¨æ€§ï¼ˆå‡å°‘ SQL æ³¨å°„æ”»å‡»çš„å¯èƒ½æ€§ï¼‰ï¼›â‘¡PreparedStatement ä¸­çš„ SQL è¯­å¥æ˜¯å¯ä»¥å¸¦å‚æ•°çš„ï¼Œé¿å…äº†ç”¨å­—ç¬¦ä¸²è¿æ¥æ‹¼æ¥ SQL è¯­å¥çš„éº»çƒ¦å’Œä¸å®‰å…¨ï¼›â‘¢å½“æ‰¹é‡å¤„ç† SQL æˆ–é¢‘ç¹æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢æ—¶ï¼ŒPreparedStatement æœ‰æ˜æ˜¾çš„æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿ï¼Œç”±äºæ•°æ®åº“å¯ä»¥å°†ç¼–è¯‘ä¼˜åŒ–åçš„SQLè¯­å¥ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æ‰§è¡Œç›¸åŒç»“æ„çš„è¯­å¥æ—¶å°±ä¼šå¾ˆå¿«ï¼ˆä¸ç”¨å†æ¬¡ç¼–è¯‘å’Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼‰ã€‚ è¡¥å……ï¼šä¸ºäº†æä¾›å¯¹å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨ï¼ŒJDBC API ä¸­è¿˜æä¾›äº† CallableStatement æ¥å£ã€‚å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Procedureï¼‰æ˜¯æ•°æ®åº“ä¸­ä¸€ç»„ä¸ºäº†å®Œæˆç‰¹å®šåŠŸèƒ½çš„ SQL è¯­å¥çš„é›†åˆï¼Œç»ç¼–è¯‘åå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç”¨æˆ·é€šè¿‡æŒ‡å®šå­˜å‚¨è¿‡ç¨‹çš„åå­—å¹¶ç»™å‡ºå‚æ•°ï¼ˆå¦‚æœè¯¥å­˜å‚¨è¿‡ç¨‹å¸¦æœ‰å‚æ•°ï¼‰æ¥æ‰§è¡Œå®ƒã€‚è™½ç„¶è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ä¼šåœ¨ç½‘ç»œå¼€é”€ã€å®‰å…¨æ€§ã€æ€§èƒ½ä¸Šè·å¾—å¾ˆå¤šå¥½å¤„ï¼Œä½†æ˜¯å­˜åœ¨å¦‚æœåº•å±‚æ•°æ®åº“å‘ç”Ÿè¿ç§»æ—¶å°±ä¼šæœ‰å¾ˆå¤šéº»çƒ¦ï¼Œå› ä¸ºæ¯ç§æ•°æ®åº“çš„å­˜å‚¨è¿‡ç¨‹åœ¨ä¹¦å†™ä¸Šå­˜åœ¨ä¸å°‘çš„å·®åˆ«ã€‚ 20.åœ¨è¿›è¡Œæ•°æ®åº“ç¼–ç¨‹æ—¶ï¼Œè¿æ¥æ± æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿç”±äºåˆ›å»ºè¿æ¥å’Œé‡Šæ”¾è¿æ¥éƒ½æœ‰å¾ˆå¤§çš„å¼€é”€ï¼ˆå°¤å…¶æ˜¯æ•°æ®åº“æœåŠ¡å™¨ä¸åœ¨æœ¬åœ°æ—¶ï¼Œæ¯æ¬¡å»ºç«‹è¿æ¥éƒ½éœ€è¦è¿›è¡Œ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œé‡Šæ”¾è¿æ¥éœ€è¦è¿›è¡Œ TCP å››æ¬¡æ¡æ‰‹ï¼Œé€ æˆçš„å¼€é”€æ˜¯ä¸å¯å¿½è§†çš„ï¼‰ï¼Œä¸ºäº†æå‡ç³»ç»Ÿè®¿é—®æ•°æ®åº“çš„æ€§èƒ½ï¼Œå¯ä»¥äº‹å…ˆåˆ›å»ºè‹¥å¹²è¿æ¥ç½®äºè¿æ¥æ± ä¸­ï¼Œéœ€è¦æ—¶ç›´æ¥ä»è¿æ¥æ± è·å–ï¼Œä½¿ç”¨ç»“æŸæ—¶å½’è¿˜è¿æ¥æ± è€Œä¸å¿…å…³é—­è¿æ¥ï¼Œä»è€Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾è¿æ¥æ‰€é€ æˆçš„å¼€é”€ï¼Œè¿™æ˜¯å…¸å‹çš„ç”¨ç©ºé—´æ¢å–æ—¶é—´çš„ç­–ç•¥ï¼ˆæµªè´¹äº†ç©ºé—´å­˜å‚¨è¿æ¥ï¼Œä½†èŠ‚çœäº†åˆ›å»ºå’Œé‡Šæ”¾è¿æ¥çš„æ—¶é—´ï¼‰ã€‚æ± åŒ–æŠ€æœ¯åœ¨Java å¼€å‘ä¸­æ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ—¶åˆ›å»ºçº¿ç¨‹æ± çš„é“ç†ä¸æ­¤ç›¸åŒã€‚åŸºäº Java çš„å¼€æºæ•°æ®åº“è¿æ¥æ± ä¸»è¦æœ‰ï¼šC3P0ã€Proxoolã€DBCPã€BoneCPã€Druid ç­‰ã€‚ è¡¥å……ï¼šåœ¨è®¡ç®—æœºç³»ç»Ÿä¸­æ—¶é—´å’Œç©ºé—´æ˜¯ä¸å¯è°ƒå’Œçš„çŸ›ç›¾ï¼Œç†è§£è¿™ä¸€ç‚¹å¯¹è®¾è®¡æ»¡è¶³æ€§èƒ½è¦æ±‚çš„ç®—æ³•æ˜¯è‡³å…³é‡è¦çš„ã€‚å¤§å‹ç½‘ç«™æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªå…³é”®å°±æ˜¯ä½¿ç”¨ç¼“å­˜ï¼Œè€Œç¼“å­˜è·Ÿä¸Šé¢è®²çš„è¿æ¥æ± é“ç†éå¸¸ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚å¯ä»¥å°†çƒ­ç‚¹æ•°æ®ç½®äºç¼“å­˜ä¸­ï¼Œå½“ç”¨æˆ·æŸ¥è¯¢è¿™äº›æ•°æ®æ—¶å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å¾—åˆ°ï¼Œè¿™æ— è®ºå¦‚ä½•ä¹Ÿå¿«è¿‡å»æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚å½“ç„¶ï¼Œç¼“å­˜çš„ç½®æ¢ç­–ç•¥ç­‰ä¹Ÿä¼šå¯¹ç³»ç»Ÿæ€§èƒ½äº§ç”Ÿé‡è¦å½±å“ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜çš„è®¨è®ºå·²ç»è¶…å‡ºäº†è¿™é‡Œè¦é˜è¿°çš„èŒƒå›´ã€‚ 21.ä»€ä¹ˆæ˜¯ DAO æ¨¡å¼?DAOï¼ˆData Access Objectï¼‰é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªä¸ºæ•°æ®åº“æˆ–å…¶ä»–æŒä¹…åŒ–æœºåˆ¶æä¾›äº†æŠ½è±¡æ¥å£çš„å¯¹è±¡ï¼Œåœ¨ä¸æš´éœ²åº•å±‚æŒä¹…åŒ–æ–¹æ¡ˆå®ç°ç»†èŠ‚çš„å‰æä¸‹æä¾›äº†å„ç§æ•°æ®è®¿é—®æ“ä½œã€‚åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œåº”è¯¥å°†æ‰€æœ‰å¯¹æ•°æ®æºçš„è®¿é—®æ“ä½œè¿›è¡ŒæŠ½è±¡åŒ–åå°è£…åœ¨ä¸€ä¸ªå…¬å…±APIä¸­ã€‚ç”¨ç¨‹åºè®¾è®¡è¯­è¨€æ¥è¯´ï¼Œå°±æ˜¯å»ºç«‹ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¸­å®šä¹‰äº†æ­¤åº”ç”¨ç¨‹åºä¸­å°†ä¼šç”¨åˆ°çš„æ‰€æœ‰äº‹åŠ¡æ–¹æ³•ã€‚åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œå½“éœ€è¦å’Œæ•°æ®æºè¿›è¡Œäº¤äº’çš„æ—¶å€™åˆ™ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œåœ¨é€»è¾‘ä¸Šè¯¥ç±»å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æ•°æ®å­˜å‚¨ã€‚DAO æ¨¡å¼å®é™…ä¸ŠåŒ…å«äº†ä¸¤ä¸ªæ¨¡å¼ï¼Œä¸€æ˜¯ DataAccessorï¼ˆæ•°æ®è®¿é—®å™¨ï¼‰ï¼ŒäºŒæ˜¯ Data Objectï¼ˆæ•°æ®å¯¹è±¡ï¼‰ï¼Œå‰è€…è¦è§£å†³å¦‚ä½•è®¿é—®æ•°æ®çš„é—®é¢˜ï¼Œè€Œåè€…è¦è§£å†³çš„æ˜¯å¦‚ä½•ç”¨å¯¹è±¡å°è£…æ•°æ®ã€‚ 22.Java ä¸­æ˜¯å¦‚ä½•æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„ï¼ŸJava ä¸­çš„ String ç±»æä¾›äº†æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æ“ä½œçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼šmatches()ã€replaceAll()ã€replaceFirst()ã€split()ã€‚æ­¤å¤–ï¼ŒJava ä¸­å¯ä»¥ç”¨ Pattern ç±»è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„ API è¿›è¡Œå„ç§æ­£åˆ™è¡¨è¾¾å¼æ“ä½œã€‚é¢è¯•é¢˜ï¼š - å¦‚æœè¦ä»å­—ç¬¦ä¸²ä¸­æˆªå–ç¬¬ä¸€ä¸ªè‹±æ–‡å·¦æ‹¬å·ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šåŒ—äº¬å¸‚(æœé˜³åŒº)(è¥¿åŸåŒº)(æµ·æ·€åŒº)ï¼Œæˆªå–ç»“æœä¸ºï¼šåŒ—äº¬å¸‚ï¼Œé‚£ä¹ˆæ­£åˆ™è¡¨è¾¾å¼æ€ä¹ˆå†™ï¼Ÿ 123456789101112import java.util.regex.Matcher;import java.util.regex.Pattern;class RegExpTest &#123; public static void main(String[] args) &#123; String str = &quot;åŒ—äº¬å¸‚(æœé˜³åŒº)(è¥¿åŸåŒº)(æµ·æ·€åŒº)&quot;; Pattern p = Pattern.compile(&quot;.*?(?=\\()&quot;); Matcher m = p.matcher(str); if(m.find()) &#123; System.out.println(m.group()); &#125; &#125;&#125;","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"é¢å‘å¯¹è±¡ç‰¹å¾","date":"2021-07-26T01:59:21.000Z","path":"wiki/é¢å‘å¯¹è±¡ç‰¹å¾/","text":"å°è£…å°è£…æ˜¯ä¿è¯è½¯ä»¶éƒ¨ä»¶å…·æœ‰ä¼˜è‰¯çš„æ¨¡å—æ€§çš„åŸºç¡€ï¼Œå°è£…çš„ç›®æ ‡å°±æ˜¯å®ç°è½¯ä»¶å†…éƒ¨çš„â€œé«˜å†…èšã€ä½è€¦åˆâ€ã€‚é˜²æ­¢ç¨‹åºç›¸äº’ä¾èµ–è€Œå¸¦æ¥çš„å˜åŠ¨å½±å“ã€‚åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹è±¡æ˜¯å°è£…çš„æœ€åŸºæœ¬å•ä½ï¼Œé¢å‘å¯¹è±¡çš„å°è£…æ¯”ä¼ ç»Ÿè¯­è¨€çš„å°è£…æ›´ä¸ºæ¸…æ™°ã€ä¹Ÿæ›´ä¸ºæœ‰åŠ›ï¼Œé¢å‘å¯¹è±¡çš„å°è£…å°±æ˜¯æŠŠæè¿°ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºçš„ä»£ç å°è£…åœ¨ä¸€ä¸ªâ€œæ¨¡å—â€ä¸­ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªç±»ä¸­ï¼Œå±æ€§ç”¨å˜é‡å®šä¹‰ï¼Œè¡Œä¸ºç”¨æ–¹æ³•å®šä¹‰ï¼Œæ–¹æ³•å¯ä»¥ç›´æ¥è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ã€‚ å°†ä¸€ä¸ªç±»ä¸­çš„æˆå‘˜å˜é‡å…¨éƒ¨å®šä¹‰ä¸ºç§æœ‰çš„ï¼Œåªæœ‰è¿™ä¸ªç±»è‡ªå·±çš„æ–¹æ³•æ‰å¯ä»¥è®¿é—®åˆ°è¿™äº›æˆå‘˜å˜é‡ï¼Œè¿™å°±åŸºæœ¬ä¸Šå®ç°å¯¹è±¡çš„å°è£…ï¼ŒæŠŠæ¡ä¸€ä¸ªåŸåˆ™ï¼šæŠŠå¯¹åŒä¸€äº‹ç‰©è¿›è¡Œæ“ä½œçš„æ–¹æ³•å’Œç›¸å…³çš„æ–¹æ³•æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ï¼ŒæŠŠæ–¹æ³•å’Œå®ƒæ“ä½œçš„æ•°æ®æ”¾åœ¨åŒä¸€ä¸ªç±»ä¸­ã€‚ æŠ½è±¡æŠ½è±¡å°±æ˜¯æ‰¾å‡ºä¸€äº›äº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ä¹‹å¤„ï¼Œç„¶åå°†è¿™äº›äº‹ç‰©å½’ä¸ºä¸€ç±»ï¼Œè¿™ä¸ªç±»åªè€ƒè™‘è¿™äº›äº‹ç‰©çš„ç›¸ä¼¼å’Œå…±æ€§ä¹‹å¤„ï¼Œå¹¶ä¸”ä¼šå¿½ç•¥ä¸å½“å‰ä¸»é¢˜å’Œç›®æ ‡æ— å…³çš„é‚£äº›æ–¹é¢ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä¸å½“å‰ç›®æ ‡æœ‰å…³çš„æ–¹é¢ã€‚ ç»§æ‰¿åœ¨å®šä¹‰å’Œå®ç°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»çš„åŸºç¡€ä¸Šæ¥è¿›è¡Œï¼ŒæŠŠè¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»æ‰€å®šä¹‰çš„å†…å®¹ä½œä¸ºè‡ªå·±çš„å†…å®¹ï¼Œå¹¶å¯ä»¥åŠ å…¥è‹¥å¹²æ–°çš„å†…å®¹ï¼Œæˆ–ä¿®æ”¹åŸæ¥çš„æ–¹æ³•ä½¿ä¹‹æ›´é€‚åˆç‰¹æ®Šçš„éœ€è¦ï¼Œè¿™å°±æ˜¯ç»§æ‰¿ã€‚ ç»§æ‰¿æ˜¯å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»èµ„æºï¼ˆæ•°æ®æˆ–è€…æ–¹æ³•ï¼‰çš„æœºåˆ¶ï¼Œè¿™æ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ï¼Œæé«˜äº†è½¯ä»¶çš„å¯é‡ç”¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å¤šæ€å¤šæ€æ˜¯æŒ‡ç¨‹åºä¸­å®šä¹‰çš„å¼•ç”¨å˜é‡æ‰€æŒ‡å‘çš„å…·ä½“ç±»å‹å’Œé€šè¿‡è¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åœ¨è¯¥ç¼–ç¨‹æ—¶ä¸ç¡®å®šï¼Œè€Œæ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰ç¡®å®šï¼Œå³ä¸€ä¸ªå¼•ç”¨å˜é‡å€’åº•ä¼šæŒ‡å‘å“ªä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥å¼•ç”¨å˜é‡å‘å‡ºçš„æ–¹æ³•è°ƒç”¨åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­å®ç°çš„æ–¹æ³•ï¼Œå¿…é¡»åœ¨ç”±ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½å†³å®šã€‚å› ä¸ºåœ¨ç¨‹åºè¿è¡Œæ—¶æ‰ç¡®å®šå…·ä½“çš„ç±»ï¼Œè¿™æ ·ï¼Œä¸ç”¨ä¿®æ”¹æºç¨‹åºä»£ç ï¼Œå°±å¯ä»¥è®©å¼•ç”¨å˜é‡ç»‘å®šåˆ°å„ç§ä¸åŒçš„ç±»å®ç°ä¸Šï¼Œä»è€Œå¯¼è‡´è¯¥å¼•ç”¨è°ƒç”¨çš„å…·ä½“æ–¹æ³•éšä¹‹æ”¹å˜ï¼Œå³ä¸ä¿®æ”¹ç¨‹åºä»£ç å°±å¯ä»¥æ”¹å˜ç¨‹åºè¿è¡Œæ—¶æ‰€ç»‘å®šçš„å…·ä½“ä»£ç ï¼Œè®©ç¨‹åºå¯ä»¥é€‰æ‹©å¤šä¸ªè¿è¡ŒçŠ¶æ€ï¼Œè¿™å°±æ˜¯å¤šæ€æ€§ã€‚ å¤šæ€æ€§å¢å¼ºäº†è½¯ä»¶çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼Œç®€å•ä¸€å¥è¯ç†è§£å¤šæ€çš„è¯å°±æ˜¯ï¼Œç¼–è¯‘çœ‹å·¦è¾¹ï¼Œè¿è¡Œçœ‹å³è¾¹ ç¼–è¯‘çœ‹å·¦è¾¹ â€“ æ˜¯æŒ‡ æƒ³è¦æˆåŠŸçš„ä¿å­˜,å°±è¦ä½¿ç”¨å·¦è¾¹ä¹Ÿå°±æ˜¯ åªèƒ½ä½¿ç”¨çˆ¶ç±»æä¾›çš„åŠŸèƒ½!!å¦‚æœçˆ¶ç±»ä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šç¼–è¯‘æŠ¥é”™è¿è¡Œçœ‹å³è¾¹ â€“ æ˜¯æŒ‡ æƒ³è¦å¾—åˆ°ç»“æœ,å°±è¦çœ‹å³è¾¹ä¹Ÿå°±æ˜¯ ä½¿ç”¨å­ç±»çš„æ–¹æ³•ä½“!!!","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"kafka-overview","date":"2021-07-22T03:00:12.000Z","path":"wiki/kafka-overview/","text":"å‚è€ƒèµ„æ–™ kafkaè¯¦ç»†æ•™ç¨‹ Kafka é›†ç¾¤ç®¡ç† OrcHome kafkaä¸­æ–‡æ•™ç¨‹ é¢è¯•å®˜ï¼šè¯´è¯´Kafkaå¤„ç†è¯·æ±‚çš„å…¨æµç¨‹ è˜‘è‡è¡—åƒäº¿çº§æ¶ˆæ¯Kafkaä¸Šäº‘å®è·µ kafka é›†ç¾¤æ­å»º kafka-2-11é›†ç¾¤éƒ¨ç½²","tags":[{"name":"kafka","slug":"kafka","permalink":"http://example.com/tags/kafka/"}],"categories":[{"name":"Distributed Dir","slug":"Distributed-Dir","permalink":"http://example.com/categories/Distributed-Dir/"},{"name":"Kafka","slug":"Distributed-Dir/Kafka","permalink":"http://example.com/categories/Distributed-Dir/Kafka/"}]},{"title":"Java-ä¸ºä»€ä¹ˆç¦æ­¢æŠŠSimpleDateFormatå®šä¹‰æˆstaticå˜é‡?","date":"2021-07-21T12:06:46.000Z","path":"wiki/Java-ä¸ºä»€ä¹ˆç¦æ­¢æŠŠSimpleDateFormatå®šä¹‰æˆstaticå˜é‡/","text":"æœ¬æ–‡å‚ç…§ ã€ŠJavaæŠ€æœ¯çµé­‚15é—®ã€‹ ç®€ä»‹åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°æ—¶é—´ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šåŠæ³•åœ¨ Java ä»£ç ä¸­è·å–æ—¶ é—´ã€‚ä½†æ˜¯ä¸åŒçš„æ–¹æ³•è·å–åˆ°çš„æ—¶é—´çš„æ ¼å¼éƒ½ä¸å°½ç›¸åŒï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ç§æ ¼å¼åŒ–å·¥ å…·ï¼ŒæŠŠæ—¶é—´æ˜¾ç¤ºæˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚ æœ€å¸¸ç”¨çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ SimpleDateFormat ç±»ã€‚è¿™æ˜¯ä¸€ä¸ªçœ‹ä¸Šå»åŠŸèƒ½æ¯”è¾ƒç®€å• çš„ç±»ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦ä½¿ç”¨ä¸å½“ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´å¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨ Java å¼€å‘æ‰‹å†Œä¸­ï¼Œæœ‰å¦‚ä¸‹æ˜ç¡®è§„å®š: é‚£ä¹ˆï¼Œæœ¬æ–‡å°±å›´ç»• SimpleDateFormat çš„ç”¨æ³•ã€åŸç†ç­‰æ¥æ·±å…¥åˆ†æä¸‹å¦‚ä½•ä»¥æ­£ ç¡®çš„å§¿åŠ¿ä½¿ç”¨å®ƒã€‚ SimpleDateFormat æ˜¯ Java æä¾›çš„ä¸€ä¸ªæ ¼å¼åŒ–å’Œè§£ææ—¥æœŸçš„å·¥å…·ç±»ã€‚å®ƒå…è®¸è¿› è¡Œæ ¼å¼åŒ–(æ—¥æœŸ -&gt; æ–‡æœ¬)ã€è§£æ(æ–‡æœ¬ -&gt; æ—¥æœŸ)å’Œè§„èŒƒåŒ–ã€‚SimpleDateFormat ä½¿ å¾—å¯ä»¥é€‰æ‹©ä»»ä½•ç”¨æˆ·å®šä¹‰çš„æ—¥æœŸ - æ—¶é—´æ ¼å¼çš„æ¨¡å¼ã€‚ åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ SimpleDateFormat çš„ format æ–¹æ³•ï¼Œå°†ä¸€ä¸ª Date ç±»å‹ è½¬åŒ–æˆ String ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šè¾“å‡ºæ ¼å¼ã€‚ SimpleDateFormat ç”¨æ³•12345 // Dateè½¬StringDate data = new Date();SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);String dataStr = sdf.format(data);System.out.println(dataStr); ä»¥ä¸Šä»£ç ï¼Œè½¬æ¢çš„ç»“æœæ˜¯:2018-11-25 13:00:00ï¼Œæ—¥æœŸå’Œæ—¶é—´æ ¼å¼ç”±â€æ—¥æœŸ å’Œæ—¶é—´æ¨¡å¼â€å­—ç¬¦ä¸²æŒ‡å®šã€‚å¦‚æœä½ æƒ³è¦è½¬æ¢æˆå…¶ä»–æ ¼å¼ï¼Œåªè¦æŒ‡å®šä¸åŒçš„æ—¶é—´æ¨¡å¼å°± è¡Œäº†ã€‚ åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ SimpleDateFormat çš„ parse æ–¹æ³•ï¼Œå°†ä¸€ä¸ª String ç±»å‹ è½¬åŒ–æˆ Date ç±»å‹ã€‚ 12// Stringè½¬Data System.out.println(sdf.parse(dataStr)); æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼è¡¨è¾¾æ–¹æ³•åœ¨ä½¿ç”¨ SimpleDateFormat çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡å­—æ¯æ¥æè¿°æ—¶é—´å…ƒç´ ï¼Œå¹¶ç»„è£…æˆ æƒ³è¦çš„æ—¥æœŸå’Œæ—¶é—´æ¨¡å¼ã€‚å¸¸ç”¨çš„æ—¶é—´å…ƒç´ å’Œå­—æ¯çš„å¯¹åº”è¡¨å¦‚ä¸‹: æ¨¡å¼å­—æ¯é€šå¸¸æ˜¯é‡å¤çš„ï¼Œå…¶æ•°é‡ç¡®å®šå…¶ç²¾ç¡®è¡¨ç¤ºã€‚å¦‚ä¸‹è¡¨æ˜¯å¸¸ç”¨çš„è¾“å‡ºæ ¼å¼çš„è¡¨ ç¤ºæ–¹æ³•ã€‚ è¾“å‡ºä¸åŒæ—¶åŒºçš„æ—¶é—´æ—¶åŒºæ˜¯åœ°çƒä¸Šçš„åŒºåŸŸä½¿ç”¨åŒä¸€ä¸ªæ—¶é—´å®šä¹‰ã€‚ä»¥å‰ï¼Œäººä»¬é€šè¿‡è§‚å¯Ÿå¤ªé˜³çš„ä½ç½®(æ—¶ è§’)å†³å®šæ—¶é—´ï¼Œè¿™å°±ä½¿å¾—ä¸åŒç»åº¦çš„åœ°æ–¹çš„æ—¶é—´æœ‰æ‰€ä¸åŒ(åœ°æ–¹æ—¶)ã€‚1863 å¹´ï¼Œé¦–æ¬¡ ä½¿ç”¨æ—¶åŒºçš„æ¦‚å¿µã€‚æ—¶åŒºé€šè¿‡è®¾ç«‹ä¸€ä¸ªåŒºåŸŸçš„æ ‡å‡†æ—¶é—´éƒ¨åˆ†åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ ä¸–ç•Œå„ä¸ªå›½å®¶ä½äºåœ°çƒä¸åŒä½ç½®ä¸Šï¼Œå› æ­¤ä¸åŒå›½å®¶ï¼Œç‰¹åˆ«æ˜¯ä¸œè¥¿è·¨åº¦å¤§çš„å›½å®¶æ—¥ å‡ºã€æ—¥è½æ—¶é—´å¿…å®šæœ‰æ‰€åå·®ã€‚è¿™äº›åå·®å°±æ˜¯æ‰€è°“çš„æ—¶å·®ã€‚ ç°ä»Šå…¨çƒå…±åˆ†ä¸º 24 ä¸ªæ—¶åŒºã€‚ç”±äºå®ç”¨ä¸Šå¸¸å¸¸ 1 ä¸ªå›½å®¶ï¼Œæˆ– 1 ä¸ªçœä»½åŒæ—¶è·¨ç€ 2 ä¸ªæˆ–æ›´å¤šæ—¶åŒºï¼Œä¸ºäº†ç…§é¡¾åˆ°è¡Œæ”¿ä¸Šçš„æ–¹ä¾¿ï¼Œå¸¸å°† 1 ä¸ªå›½å®¶æˆ– 1 ä¸ªçœä»½åˆ’åœ¨ä¸€èµ·ã€‚æ‰€ä»¥ æ—¶åŒºå¹¶ä¸ä¸¥æ ¼æŒ‰å—åŒ—ç›´çº¿æ¥åˆ’åˆ†ï¼Œè€Œæ˜¯æŒ‰è‡ªç„¶æ¡ä»¶æ¥åˆ’åˆ†ã€‚ä¾‹å¦‚ï¼Œä¸­å›½å¹…å‘˜å®½å¹¿ï¼Œå·® ä¸å¤šè·¨ 5 ä¸ªæ—¶åŒºï¼Œä½†ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ç®€å•ï¼Œå®é™…ä¸Šåœ¨åªç”¨ä¸œå…«æ—¶åŒºçš„æ ‡å‡†æ—¶å³åŒ—äº¬æ—¶é—´ ä¸ºå‡†ã€‚ ç”±äºä¸åŒçš„æ—¶åŒºçš„æ—¶é—´æ˜¯ä¸ä¸€æ ·çš„ï¼Œç”šè‡³åŒä¸€ä¸ªå›½å®¶çš„ä¸åŒåŸå¸‚æ—¶é—´éƒ½å¯èƒ½ä¸ä¸€ æ ·ï¼Œæ‰€ä»¥ï¼Œåœ¨ Java ä¸­æƒ³è¦è·å–æ—¶é—´çš„æ—¶å€™ï¼Œè¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹æ—¶åŒºé—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸æŒ‡æ˜ï¼Œåœ¨åˆ›å»ºæ—¥æœŸçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å½“å‰è®¡ç®—æœºæ‰€åœ¨çš„æ—¶åŒºä½œä¸ºé»˜è®¤æ—¶åŒºï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é€šè¿‡åªè¦ä½¿ç”¨new Date()å°±å¯ä»¥è·å–ä¸­å›½çš„å½“å‰ æ—¶é—´çš„åŸå› ã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ Java ä»£ç ä¸­è·å–ä¸åŒæ—¶åŒºçš„æ—¶é—´å‘¢? SimpleDateFormat å¯ä»¥ å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ 123SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); sdf.setTimeZone(TimeZone.getTimeZone(&quot;America/Los_Angeles&quot;)); System.out.println(sdf.format(Calendar.getInstance().getTime())); ä»¥ä¸Šä»£ç ï¼Œè½¬æ¢çš„ç»“æœæ˜¯:2018-11-24 21:00:00 ã€‚æ—¢ä¸­å›½çš„æ—¶é—´æ˜¯ 11 æœˆ 25 æ—¥çš„ 13 ç‚¹ï¼Œè€Œç¾å›½æ´›æ‰çŸ¶æ—¶é—´æ¯”ä¸­å›½åŒ—äº¬æ—¶é—´æ…¢äº† 16 ä¸ªå°æ—¶(è¿™è¿˜å’Œå†¬å¤ä»¤æ—¶æœ‰å…³ ç³»ï¼Œå°±ä¸è¯¦ç»†å±•å¼€äº†)ã€‚ å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ è¿˜å¯ä»¥å°è¯•æ‰“å°ä¸€ä¸‹ç¾å›½çº½çº¦æ—¶é—´(America/New_York)ã€‚ çº½çº¦æ—¶é—´æ˜¯ 2018-11-25 00:00:00ã€‚çº½çº¦æ—¶é—´æ¯”ä¸­å›½åŒ—äº¬æ—¶é—´æ—©äº† 13 ä¸ªå°æ—¶ã€‚ å½“ç„¶ï¼Œè¿™ä¸æ˜¯æ˜¾ç¤ºå…¶ä»–æ—¶åŒºçš„å”¯ä¸€æ–¹æ³•ï¼Œä¸è¿‡æœ¬æ–‡ä¸»è¦ä¸ºäº†ä»‹ç» SimpleDate-Formatï¼Œå…¶ä»–æ–¹æ³•æš‚ä¸ä»‹ç»äº†ã€‚ SimpleDateFormat çº¿ç¨‹å®‰å…¨æ€§ç”±äº SimpleDateFormat æ¯”è¾ƒå¸¸ç”¨ï¼Œè€Œä¸”åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ä¸­çš„æ—¶é—´æ˜¾ ç¤ºæ¨¡å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¾ˆå¤šäººæ„¿æ„ä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰ SimpleDateFormat: 123456789public class Main &#123; private static SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); public static void main(String[] args) &#123; simpleDateFormat.setTimeZone(TimeZone.getTimeZone(&quot;America/New_York&quot;)); System.out.println(simpleDateFormat.format(Calendar.getInstance(). getTime())); &#125; &#125; âš ï¸ è¿™ç§å®šä¹‰æ–¹å¼ï¼Œå­˜åœ¨å¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼Œä»¥ä¸‹ä»£ç ä½¿ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡Œæ—¶é—´è¾“å‡ºã€‚ 123456789101112131415161718192021222324252627282930313233343536373839public class Main &#123; /** * å®šä¹‰ä¸€ä¸ªå…¨å±€çš„SimpleDateFormat */ private static SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); /** * ä½¿ç”¨ThreadFactoryBuilderå®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ±  */ private static ThreadFactory namedThreadFactory = new ThreadFactoryBuilder().setNameFormat(&quot;demo-pool-%d&quot;).build(); private static ExecutorService pool = new ThreadPoolExecutor(5, 200, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(1024), namedThreadFactory, new ThreadPoolExecutor.AbortPolicy()); /** * å®šä¹‰ä¸€ä¸ªCountDownLatchï¼Œä¿è¯æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åä¸»çº¿ç¨‹å†æ‰§è¡Œ */ private static CountDownLatch countDownLatch = new CountDownLatch(100); public static void main(String[] args) &#123; // å®šä¹‰ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ HashSet Set&lt;String&gt; dates = Collections.synchronizedSet(new HashSet&lt;String&gt;()); for (int i = 0; i &lt; 100; i++) &#123; // è·å–å½“å‰æ—¶é—´ Calendar calendar = Calendar.getInstance(); int finalI = i; pool.execute(() -&gt; &#123; // æ—¶é—´å¢åŠ  calendar.add(Calendar.DATE, finalI); // é€šè¿‡ simpleDateFormat æŠŠæ—¶é—´è½¬æ¢æˆå­—ç¬¦ä¸² String dateString = simpleDateFormat.format(calendar. getTime()); // æŠŠå­—ç¬¦ä¸²æ”¾å…¥ Set ä¸­ dates.add(dateString); //countDown countDownLatch.countDown(); &#125;); &#125; // é˜»å¡ï¼Œç›´åˆ° countDown æ•°é‡ä¸º 0 countDownLatch.await(); // è¾“å‡ºå»é‡åçš„æ—¶é—´ä¸ªæ•° System.out.println(dates.size()); &#125; &#125; ä»¥ä¸Šä»£ç ï¼Œå…¶å®æ¯”è¾ƒç®€å•ï¼Œå¾ˆå®¹æ˜“ç†è§£ã€‚å°±æ˜¯å¾ªç¯ä¸€ç™¾æ¬¡ï¼Œæ¯æ¬¡å¾ªç¯çš„æ—¶å€™éƒ½åœ¨ å½“å‰æ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªå¤©æ•°(è¿™ä¸ªå¤©æ•°éšç€å¾ªç¯æ¬¡æ•°è€Œå˜åŒ–)ï¼Œç„¶åæŠŠæ‰€æœ‰æ—¥æœŸæ”¾å…¥ ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€å¸¦æœ‰å»é‡åŠŸèƒ½çš„ Set ä¸­ï¼Œç„¶åè¾“å‡º Set ä¸­å…ƒç´ ä¸ªæ•°ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»¥ä¸Šä»£ç è¾“å‡ºç»“æœåº”è¯¥æ˜¯ 100ã€‚ä½†æ˜¯å®é™…æ‰§è¡Œç»“æœæ˜¯ä¸€ä¸ªå°äº 100 çš„æ•°å­—ã€‚ åŸå› å°±æ˜¯å› ä¸º SimpleDateFormat ä½œä¸ºä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œè¢«å½“åšäº†å…±äº«å˜ é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¸­è¿›è¡Œä½¿ç”¨ï¼Œè¿™å°±å‡ºç°äº†çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ çº¿ç¨‹ä¸å®‰å…¨åŸå› é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å‘ç°äº†åœ¨å¹¶å‘åœºæ™¯ä¸­ä½¿ç”¨ SimpleDateFormat ä¼šæœ‰çº¿ç¨‹å®‰ å…¨é—®é¢˜ã€‚å…¶å®ï¼ŒJDK æ–‡æ¡£ä¸­å·²ç»æ˜ç¡®è¡¨æ˜äº† SimpleDateFormat ä¸åº”è¯¥ç”¨åœ¨å¤šçº¿ç¨‹ åœºæ™¯ä¸­: Date formats are not synchronized. It is recommended to create separate format instances for each thread. If multiple threads access a format concurrently, it must be synchronized externally. é‚£ä¹ˆæ¥ä¸‹æ¥åˆ†æä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼ŒSimpleDateFormat åº•å±‚åˆ°åº•æ˜¯æ€ ä¹ˆå®ç°çš„?æˆ‘ä»¬è·Ÿä¸€ä¸‹ SimpleDateFormat ç±»ä¸­ format æ–¹æ³•çš„å®ç°å…¶å®å°±èƒ½å‘ç°ç«¯å€ªã€‚ 123456789101112131415161718192021222324252627282930313233// Called from Format after creating a FieldDelegate private StringBuffer format(Date date, StringBuffer toAppendTo, FieldDelegate delegate) &#123; // Convert input date to time field list calendar.setTime(date); boolean useDateFormatSymbols = useDateFormatSymbols(); for (int i = 0; i &lt; compiledPattern.length; ) &#123; int tag = compiledPattern[i] &gt;&gt;&gt; 8; int count = compiledPattern[i++] &amp; 0xff; if (count == 255) &#123; count = compiledPattern[i++] &lt;&lt; 16; count |= compiledPattern[i++]; &#125; switch (tag) &#123; case TAG_QUOTE_ASCII_CHAR: toAppendTo.append((char)count); break; case TAG_QUOTE_CHARS: toAppendTo.append(compiledPattern, i, count); i += count; break; default: subFormat(tag, count, delegate, toAppendTo, useDateFormatSymbols); break; &#125; &#125; return toAppendTo; &#125; SimpleDateFormat ä¸­çš„ format æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªæˆå‘˜å˜é‡ calendar æ¥ä¿å­˜æ—¶é—´ã€‚è¿™å…¶å®å°±æ˜¯é—®é¢˜çš„å…³é”®ã€‚ ç”±äºæˆ‘ä»¬åœ¨å£°æ˜ SimpleDateFormat çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ static å®šä¹‰çš„ã€‚é‚£ä¹ˆ è¿™ ä¸ª SimpleDateFormatå°±æ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œ éš ä¹‹ï¼ŒSimpleDateFormat ä¸­ çš„ calendar ä¹Ÿå°±å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®åˆ°ã€‚ å‡è®¾çº¿ç¨‹ 1 åˆšåˆšæ‰§è¡Œå®Œ calendar.setTime æŠŠæ—¶é—´è®¾ç½®æˆ 2018-11-11ï¼Œè¿˜ æ²¡ç­‰æ‰§è¡Œå®Œï¼Œçº¿ç¨‹ 2 åˆæ‰§è¡Œäº† calendar.setTime æŠŠæ—¶é—´æ”¹æˆäº† 2018-12-12ã€‚ è¿™æ—¶å€™çº¿ç¨‹ 1 ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‹¿åˆ°çš„ calendar.getTime å¾—åˆ°çš„æ—¶é—´å°±æ˜¯çº¿ç¨‹ 2 æ”¹ è¿‡ä¹‹åçš„ã€‚ é™¤äº† format æ–¹æ³•ä»¥å¤–ï¼ŒSimpleDateFormat çš„ parse æ–¹æ³•ä¹Ÿæœ‰åŒæ ·çš„é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œä¸è¦æŠŠ SimpleDateFormat ä½œä¸ºä¸€ä¸ªå…±äº«å˜é‡ä½¿ç”¨ã€‚ å¦‚ä½•è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ ä½¿ç”¨å±€éƒ¨å˜é‡ ä¸è¦ä½¿ç”¨static åŠ åŒæ­¥é”12345678910111213141516for (int i = 0; i &lt; 100; i++) &#123; // è·å–å½“å‰æ—¶é—´ Calendar calendar = Calendar.getInstance(); int finalI = i; pool.execute(() -&gt; &#123; // åŠ é” synchronized (simpleDateFormat) &#123; // æ—¶é—´å¢åŠ  calendar.add(Calendar.DATE, finalI); // é€šè¿‡ simpleDateFormat æŠŠæ—¶é—´è½¬æ¢æˆå­—ç¬¦ä¸² String dateString = simpleDateFormat.format(calendar.getTime()); // æŠŠå­—ç¬¦ä¸²æ”¾å…¥ Set ä¸­ dates.add(dateString); //countDown countDownLatch.countDown(); &#125; &#125;); &#125; å…¶å®ä»¥ä¸Šä»£ç è¿˜æœ‰å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Œå°±æ˜¯å¯ä»¥æŠŠé”çš„ç²’åº¦å†è®¾ç½®çš„å°ä¸€ç‚¹ï¼Œå¯ä»¥ åªå¯¹ simpleDateFormat.format è¿™ä¸€è¡ŒåŠ é”ï¼Œè¿™æ ·æ•ˆç‡æ›´é«˜ä¸€äº›ã€‚ ä½¿ç”¨ ThreadLocal ç¬¬ä¸‰ç§æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨ ThreadLocalã€‚ ThreadLocal å¯ä»¥ç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ å¾—åˆ°å•ç‹¬çš„ä¸€ä¸ª SimpleDateFormat çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±ä¸å­˜åœ¨ç«äº‰é—®é¢˜äº†ã€‚ 12345678910/** * ä½¿ç”¨ThreadLocalå®šä¹‰ä¸€ä¸ªå…¨å±€çš„SimpleDateFormat */ private static ThreadLocal&lt;SimpleDateFormat&gt; simpleDateFormatThreadLocal = new ThreadLocal&lt;SimpleDateFormat&gt;() &#123; @Override protected SimpleDateFormat initialValue() &#123; return new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); &#125; &#125;; // ç”¨æ³• String dateString = simpleDateFormatThreadLocal.get().format(calendar.getTime()); ç”¨ ThreadLocal æ¥å®ç°å…¶å®æ˜¯æœ‰ç‚¹ç±»ä¼¼äºç¼“å­˜çš„æ€è·¯ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬äº« çš„å¯¹è±¡ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿé¿å…äº†å¤šçº¿ç¨‹çš„ç«äº‰ã€‚ å½“ç„¶ï¼Œä»¥ä¸Šä»£ç ä¹Ÿæœ‰æ”¹è¿›ç©ºé—´ï¼Œå°±æ˜¯ï¼Œå…¶å® SimpleDateFormat çš„åˆ›å»ºè¿‡ç¨‹å¯ ä»¥æ”¹ä¸ºå»¶è¿ŸåŠ è½½ã€‚è¿™é‡Œå°±ä¸è¯¦ç»†ä»‹ç»äº†ã€‚ ä½¿ç”¨ DateTimeFormatterå¦‚æœæ˜¯ Java8 åº”ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ DateTimeFormatter ä»£æ›¿ SimpleDateFormatï¼Œ è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ ¼å¼åŒ–å·¥å…·ç±»ã€‚å°±åƒå®˜æ–¹æ–‡æ¡£ä¸­è¯´çš„ï¼Œè¿™ä¸ªç±» simple beautiful strong immutable thread-safeã€‚ 123456789// è§£ææ—¥æœŸString dateStr = &quot;2016å¹´10æœˆ25æ—¥&quot;;DateTimeFormatter formatter = DateTimeFormatter.ofPattern(&quot;yyyyå¹´MMæœˆddæ—¥&quot;);LocalDate date = LocalDate.parse(dateStr, formatter);// æ—¥æœŸè½¬æ¢ä¸ºå­—ç¬¦ä¸²LocalDateTime now = LocalDateTime.now();DateTimeFormatter format = DateTimeFormatter.ofPattern(&quot;yyyyå¹´MMæœˆddæ—¥ hh:mm a&quot;);String nowStr = now.format(format);System.out.println(nowStr); æ€»ç»“æœ¬ æ–‡ ä»‹ ç» äº† SimpleDateFormat çš„ ç”¨ æ³•ï¼ŒSimpleDateFormat ä¸» è¦ å¯ ä»¥ åœ¨ String å’Œ Date ä¹‹é—´åšè½¬æ¢ï¼Œè¿˜å¯ä»¥å°†æ—¶é—´è½¬æ¢æˆä¸åŒæ—¶åŒºè¾“å‡ºã€‚åŒæ—¶æåˆ°åœ¨å¹¶å‘åœº æ™¯ä¸­ SimpleDateFormat æ˜¯ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±æ¥ä¿è¯å…¶å®‰å…¨æ€§ã€‚ ä¸»è¦çš„å‡ ä¸ªæ‰‹æ®µæœ‰æ”¹ä¸ºå±€éƒ¨å˜é‡ã€ä½¿ç”¨ synchronized åŠ é”ã€ä½¿ç”¨ Threadlocal ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹å•ç‹¬åˆ›å»ºä¸€ä¸ªç­‰ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"Javaå¹¶å‘ç¼–ç¨‹-å¤šçº¿ç¨‹çš„å‘å±•å’Œæ„ä¹‰","date":"2021-07-21T11:45:01.000Z","path":"wiki/Javaå¹¶å‘ç¼–ç¨‹-å¤šçº¿ç¨‹çš„å‘å±•å’Œæ„ä¹‰/","text":"çº¿ç¨‹åŸºç¡€æ¦‚å¿µä»€ä¹ˆæ˜¯çº¿ç¨‹çº¿ç¨‹æ˜¯CPUæ‰§è¡Œä»»åŠ¡çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ç‹¬ç«‹å†…å­˜ï¼Œæ˜¯çº¿ç¨‹ä¸å…±äº«çš„ã€‚ å¹¶è¡Œä¸å¹¶å‘ å¹¶è¡Œ åŒä¸€æ—¶åˆ»ï¼Œæ¨ªå‘æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œ å¹¶å‘ ç³»ç»Ÿå’ŒæœåŠ¡å™¨åŒä¸€æ—¶åˆ»èƒ½å¤Ÿæ‰¿å—çš„å¹¶å‘çº¿ç¨‹ çº¿ç¨‹çš„ç‰¹å¾ å¼‚æ­¥ï¼ˆä¸éœ€è¦ç­‰å¾…ï¼‰ æ¯”å¦‚è¯´æ³¨å†Œä¹‹åå‘é€éªŒè¯ç ï¼ŒéªŒè¯ç çš„è¿‡ç¨‹å¯ä»¥å¼‚æ­¥å»åšä¸éœ€è¦å®¢æˆ·å»åœ¨æ³¨å†Œæ¥å£ç­‰å¾…è¿™ä¸ªæ—¶é—´ï¼› å¹¶è¡Œï¼ˆCPUæ ¸æ•°ï¼‰ Javaä¸­çº¿ç¨‹çš„ä½¿ç”¨ ç»§æ‰¿Thread å®ç°Runnalbe å®ç°Callable/Future çº¿ç¨‹åŸç†1234567public class ThreadDemo extend Thread&#123; int a = 0; public void run()&#123; int b = 0; b = a + 1; &#125;&#125; æ‰§è¡Œstartæ–¹æ³•ï¼Œå…¶å®æ˜¯è°ƒç”¨JVMç›¸å…³çš„æŒ‡ä»¤ï¼Œ thread.cpp java thread.start() -&gt; cpp thread.start() -&gt; osæŒ‡ä»¤:create.thread start.threadæ“ä½œç³»ç»Ÿå±‚é¢ä¼šåˆ›å»ºçº¿ç¨‹ï¼Œçº¿ç¨‹åˆ›å»ºä¹‹åï¼Œçº¿ç¨‹å¯ä»¥å¯åŠ¨ï¼Œï¼ˆçº¿ç¨‹å¯åŠ¨ä¹‹åå¹¶ä¸ä¸€å®šé©¬ä¸Šæ‰§è¡Œï¼‰è¿™äº›çº¿ç¨‹ç»Ÿä¸€æœ‰CPUè°ƒåº¦ç®—æ³•æ¥å¤„ç†ï¼›å†³å®šé‚£ä¸ªçº¿ç¨‹åˆ†é…ç»™é‚£ä¸ªæ‰§è¡ŒCPUï¼›CPUæ‰§è¡Œçº¿ç¨‹ä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨runæ–¹æ³• -&gt; cpp runæ–¹æ³• -&gt; java thread.run() âš ï¸ CompletableFuture å¼‚æ­¥å›è°ƒé€šçŸ¥ï¼ŒåŸºäºFutureçš„ä¼˜åŒ– çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸçº¿ç¨‹åˆ›å»ºï¼Œå½“çº¿ç¨‹ä¸­çš„æŒ‡ä»¤æ‰§è¡Œå®Œæˆä¹‹åï¼Œrunï¼ˆï¼‰ç»“æŸ çº¿ç¨‹é”€æ¯å…¶ä»–çº¿ç¨‹çŠ¶æ€ ç­‰å¾…çŠ¶æ€ ï¼ˆsleep join waitï¼‰ é”é˜»å¡çŠ¶æ€ ï¼ˆblocked ç«äº‰é”å¤±è´¥ parkï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class ThreadStatusDemo &#123; public static void main(String[] args) &#123; new Thread(() -&gt; &#123; while (true) &#123; try &#123; TimeUnit.SECONDS.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, &quot;time waitting&quot;).start(); new Thread(()-&gt;&#123; while (true)&#123; synchronized (ThreadStatusDemo.class)&#123; try &#123; ThreadStatusDemo.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;,&quot;waitting&quot;).start(); new Thread(new BlockDemo(),&quot;block demo 1&quot;).start(); new Thread(new BlockDemo(),&quot;block demo 2&quot;).start(); &#125; static class BlockDemo extends Thread&#123; @Override public void run() &#123; synchronized (BlockDemo.class)&#123; while (true)&#123; try &#123; TimeUnit.SECONDS.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ 12jps -ljstack pid çº¿ç¨‹å¦‚ä½•åœæ­¢interrupt() åœæ­¢çº¿ç¨‹ä¸»åŠ¨åœæ­¢æ–¹å¼ -&gt; runæ–¹æ³•æ‰§è¡Œç»“æŸè¢«åŠ¨åœæ­¢æ–¹å¼ ä¸€èˆ¬ä¸­æ–­çº¿ç¨‹æ˜¯åœ¨æ— æ³•æ§åˆ¶çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚çº¿ç¨‹wait ï¼Œ çº¿ç¨‹sleep ï¼Œ çº¿ç¨‹while(true)Thread.currnetThread().isInterrupted() stopæ–¹æ³•åœæ­¢çº¿ç¨‹ ç¦æ­¢ä½¿ç”¨ ç›¸å½“äºkillçº¿ç¨‹ ä¸å‹å¥½ interrupt åŠŸèƒ½ å”¤é†’é˜»å¡çŠ¶æ€çš„çº¿ç¨‹ ä¿®æ”¹ä¸­æ–­æ ‡å¿—ï¼Œfalse -&gt; true é—®é¢˜æ’æŸ¥","tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"}]},{"title":"ä¸ºä»€ä¹ˆç¦æ­¢å¼€å‘äººå‘˜ä¿®æ”¹ serialVersionUID å­—æ®µçš„å€¼?","date":"2021-07-21T09:47:46.000Z","path":"wiki/ä¸ºä»€ä¹ˆç¦æ­¢å¼€å‘äººå‘˜ä¿®æ”¹-serialVersionUID-å­—æ®µçš„å€¼/","text":"åºåˆ—åŒ–æ˜¯ä¸€ç§å¯¹è±¡æŒä¹…åŒ–çš„æ‰‹æ®µã€‚æ™®éåº”ç”¨åœ¨ç½‘ç»œä¼ è¾“ã€RMI ç­‰åœºæ™¯ä¸­ã€‚ç±»é€š è¿‡å®ç° java.io.Serializable æ¥å£ä»¥å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½ã€‚Java å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€æ·±å…¥åˆ†æ Java çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€å•ä¾‹ä¸ åºåˆ—åŒ–çš„é‚£äº›äº‹å„¿ åœ¨è¿™å‡ ç¯‡æ–‡ç« ä¸­ï¼Œåˆ†åˆ«ä»‹ç»è¿‡äº†åºåˆ—åŒ–æ¶‰åŠåˆ°çš„ç±»å’Œæ¥å£ã€å¦‚ä½•è‡ªå®šä¹‰åºåˆ—åŒ– ç­–ç•¥ã€transient å…³é”®å­—å’Œåºåˆ—åŒ–çš„å…³ç³»ç­‰ï¼Œè¿˜é€šè¿‡å­¦ä¹  ArrayList å¯¹åºåˆ—åŒ–çš„å®ç°æº ç æ·±å…¥å­¦ä¹ äº†åºåˆ—åŒ–ã€‚å¹¶ä¸”è¿˜æ‹“å±•åˆ†æäº†ä¸€ä¸‹åºåˆ—åŒ–å¯¹å•ä¾‹çš„å½±å“ç­‰ã€‚ä½†æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹å¹¶æœªå±•å¼€ä»‹ç»ï¼Œé‚£å°±æ˜¯å…³äº serialVersionUID ã€‚è¿™ä¸ª å­—æ®µåˆ°åº•æœ‰ä»€ä¹ˆç”¨?å¦‚æœä¸è®¾ç½®ä¼šæ€ä¹ˆæ ·?ä¸ºä»€ä¹ˆã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¸­æœ‰ä»¥ä¸‹è§„å®š: èƒŒæ™¯çŸ¥è¯†Serializable å’Œ Externalizableç±»é€šè¿‡å®ç° java.io.Serializable æ¥å£ä»¥å¯ç”¨å…¶åºåˆ—åŒ–åŠŸèƒ½ã€‚æœªå®ç°æ­¤æ¥ å£çš„ç±»å°†æ— æ³•è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ã€‚å¯åºåˆ—åŒ–ç±»çš„æ‰€æœ‰å­ç±»å‹æœ¬èº«éƒ½æ˜¯å¯åºåˆ— åŒ–çš„ã€‚å¦‚æœè¯»è€…çœ‹è¿‡ Serializable çš„æºç ï¼Œå°±ä¼šå‘ç°ï¼Œä»–åªæ˜¯ä¸€ä¸ªç©ºçš„æ¥å£ï¼Œé‡Œ é¢ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡æœ‰ã€‚Serializable æ¥å£æ²¡æœ‰æ–¹æ³•æˆ–å­—æ®µï¼Œä»…ç”¨äºæ ‡è¯†å¯åºåˆ—åŒ–çš„ è¯­ä¹‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç°è¿™ä¸ªæ¥å£ï¼Œæƒ³è¦è¢«åºåˆ—åŒ–çš„è¯ï¼Œå°±ä¼šæŠ›å‡º java. io.NotSerializableException å¼‚å¸¸ã€‚ å®ƒæ˜¯æ€ä¹ˆä¿è¯åªæœ‰å®ç°äº†è¯¥æ¥å£çš„æ–¹æ³•æ‰èƒ½è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„å‘¢?åŸå› æ˜¯åœ¨æ‰§è¡Œåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œåˆ°ä»¥ä¸‹ä»£ç : 12345678910111213141516if (obj instanceof String) &#123; writeString((String) obj, unshared); &#125; else if (cl.isArray()) &#123; writeArray(obj, desc, unshared); &#125; else if (obj instanceof Enum) &#123; writeEnum((Enum&lt;?&gt;) obj, desc, unshared); &#125; else if (obj instanceof Serializable) &#123; writeOrdinaryObject(obj, desc, unshared); &#125; else &#123; if (extendedDebugInfo) &#123; throw new NotSerializableException( cl.getName() + &quot;\\n&quot; + debugInfoStack.toString()); &#125; else &#123; throw new NotSerializableException(cl.getName()); &#125; &#125; åœ¨è¿›è¡Œåºåˆ—åŒ–æ“ä½œæ—¶ï¼Œä¼šåˆ¤æ–­è¦è¢«åºåˆ—åŒ–çš„ç±»æ˜¯å¦æ˜¯ Enumã€Array å’Œ Serializable ç±»å‹ï¼Œå¦‚æœéƒ½ä¸æ˜¯åˆ™ç›´æ¥æŠ›å‡º NotSerializableExceptionã€‚Java ä¸­è¿˜æä¾›äº† Externalizable æ¥å£ï¼Œä¹Ÿå¯ä»¥å®ç°å®ƒæ¥æä¾›åºåˆ—åŒ–èƒ½åŠ›ã€‚ Externalizable ç»§æ‰¿è‡ª Serializableï¼Œè¯¥æ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•: writeExternal() ä¸ readExternal()ã€‚å½“ä½¿ç”¨ Externalizable æ¥å£æ¥è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦å¼€å‘äººå‘˜é‡ å†™ writeExternal() ä¸ readExternal() æ–¹æ³•ã€‚å¦åˆ™æ‰€æœ‰å˜é‡çš„å€¼éƒ½ä¼šå˜æˆé»˜è®¤å€¼ã€‚ transienttransient å…³é”®å­—çš„ä½œç”¨æ˜¯æ§åˆ¶å˜é‡çš„åºåˆ—åŒ–ï¼Œåœ¨å˜é‡å£°æ˜å‰åŠ ä¸Šè¯¥å…³é”®å­—ï¼Œå¯ ä»¥é˜»æ­¢è¯¥å˜é‡è¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œtransient å˜é‡çš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œå¦‚ int å‹çš„æ˜¯ 0ï¼Œå¯¹è±¡å‹çš„æ˜¯ nullã€‚ è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¢«åºåˆ—åŒ–çš„ç±»ä¸­å®šä¹‰äº† writeObject å’Œ readObject æ–¹æ³•ï¼Œ è™šæ‹Ÿæœºä¼šè¯•å›¾è°ƒç”¨å¯¹è±¡ç±»é‡Œçš„ writeObject å’Œ readObject æ–¹æ³•ï¼Œè¿›è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„ åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ–¹æ³•ï¼Œåˆ™é»˜è®¤è°ƒç”¨æ˜¯ ObjectOutputStream çš„ defaultWriteOb- ject æ–¹æ³•ä»¥åŠ ObjectInputStream çš„ defaultReadObject æ–¹æ³•ã€‚ç”¨æˆ·è‡ªå®šä¹‰çš„ writeObject å’Œ readObject æ–¹æ³•å¯ä»¥å…è®¸ç”¨æˆ·æ§åˆ¶åºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œ æ¯”å¦‚å¯ä»¥åœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­åŠ¨æ€æ”¹å˜åºåˆ—åŒ–çš„æ•°å€¼ã€‚ æ‰€ä»¥ï¼Œå¯¹äºä¸€äº›ç‰¹æ®Šå­—æ®µéœ€è¦å®šä¹‰åºåˆ—åŒ–çš„ç­–ç•¥çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ tran- sient ä¿® é¥°ï¼Œ å¹¶ è‡ª å·± é‡ å†™ writeObject å’Œ readObject æ–¹ æ³•ï¼Œ å¦‚ java.util. ArrayList ä¸­å°±æœ‰è¿™æ ·çš„å®ç°ã€‚ æˆ‘ä»¬éšä¾¿æ‰¾å‡ ä¸ª Java ä¸­å®ç°äº†åºåˆ—åŒ–æ¥å£çš„ç±»ï¼Œå¦‚ Stringã€Integer ç­‰ï¼Œæˆ‘ä»¬ å¯ä»¥å‘ç°ä¸€ä¸ªç»†èŠ‚ï¼Œé‚£å°±æ˜¯è¿™äº›ç±»é™¤äº†å®ç°äº† Serializable å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ª serialVersionUID é‚£ä¹ˆï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯ serialVersionUID å‘¢?ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™æ ·ä¸€ä¸ªå­—æ®µå‘¢? ä»€ä¹ˆæ˜¯ serialVersionUIDåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯è½¬æ¢ä¸ºå¯å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢å¼çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ Java å¯¹è±¡æ˜¯ä¿å­˜åœ¨ JVM çš„å †å†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ JVM å †ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå¯¹ è±¡ä¹Ÿå°±è·Ÿç€æ¶ˆå¤±äº†ã€‚ è€Œåºåˆ—åŒ–æä¾›äº†ä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥è®©ä½ åœ¨å³ä½¿ JVM åœæœºçš„æƒ…å†µä¸‹ä¹Ÿèƒ½æŠŠå¯¹è±¡ä¿å­˜ ä¸‹æ¥çš„æ–¹æ¡ˆã€‚å°±åƒæˆ‘ä»¬å¹³æ—¶ç”¨çš„ U ç›˜ä¸€æ ·ã€‚æŠŠ Java å¯¹è±¡åºåˆ—åŒ–æˆå¯å­˜å‚¨æˆ–ä¼ è¾“çš„å½¢ å¼(å¦‚äºŒè¿›åˆ¶æµ)ï¼Œæ¯”å¦‚ä¿å­˜åœ¨æ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œå½“å†æ¬¡éœ€è¦è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä»æ–‡ä»¶ä¸­ è¯»å–å‡ºäºŒè¿›åˆ¶æµï¼Œå†ä»äºŒè¿›åˆ¶æµä¸­ååºåˆ—åŒ–å‡ºå¯¹è±¡ã€‚ è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œä¸€ä¸ªéå¸¸é‡ è¦çš„ä¸€ç‚¹æ˜¯ä¸¤ä¸ªç±»çš„åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´ï¼Œè¿™ä¸ªæ‰€è°“çš„åºåˆ—åŒ– IDï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ä»£ç ä¸­ å®šä¹‰çš„ serialVersionUIDã€‚ å¦‚æœ serialVersionUID å˜äº†ä¼šæ€æ ·æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­å§ï¼Œçœ‹çœ‹å¦‚æœ serialVersionUID è¢«ä¿®æ”¹äº†ä¼šå‘ç”Ÿä»€ä¹ˆ? 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849public class SerializableDemo1 &#123; public static void main(String[] args) &#123;//Initializes The Object User1 user = new User1(); user.setName(&quot;hollis&quot;); //Write Obj to File ObjectOutputStream oos = null; try &#123; oos = new ObjectOutputStream(new FileOutputStream(&quot;tempFile&quot;)); oos.writeObject(user); &#125; catch( IOException e) &#123; e.printStackTrace(); &#125; finally &#123; IOUtils.closeQuietly(oos); &#125; &#125; &#125; class User1 implements Serializable &#123; private static final long serialVersionUID = 1L; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; &#125;``` æˆ‘ä»¬å…ˆæ‰§è¡Œä»¥ä¸Šä»£ç ï¼ŒæŠŠä¸€ä¸ª User1 å¯¹è±¡å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚ç„¶åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ User1 ç±»ï¼ŒæŠŠ serialVersionUID çš„å€¼æ”¹ä¸º 2Lã€‚```javaclass User1 implements Serializable &#123; private static final long serialVersionUID = 2L; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; &#125; ç„¶åæ‰§è¡Œä»¥ä¸‹ä»£ç ï¼ŒæŠŠæ–‡ä»¶ä¸­çš„å¯¹è±¡ååºåˆ—åŒ–å‡ºæ¥: 1234567891011121314151617181920212223242526272829 public class SerializableDemo2 &#123; public static void main(String[] args) &#123;//Read Obj from File File file = new File(&quot;tempFile&quot;); ObjectInputStream ois = null; try &#123; ois = new ObjectInputStream(new FileInputStream(file)); User1 newUser = (User1) ois.readObject(); System.out.println(newUser); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; finally &#123; IOUtils.closeQuietly(ois); try &#123; FileUtils.forceDelete(file); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;``` æ‰§è¡Œç»“æœå¦‚ä¸‹```javajava.io.InvalidClassException: com.hollis.User1; local class incompatible: stream classdescserialVersionUID = 1, local class serialVersionUID = 2 å¯ä»¥å‘ç°ï¼Œä»¥ä¸Šä»£ç æŠ›å‡ºäº†ä¸€ä¸ª java.io.InvalidClassExceptionï¼Œå¹¶ä¸” æŒ‡å‡º serialVersionUID ä¸ä¸€è‡´ã€‚ è¿™æ˜¯å› ä¸ºï¼Œåœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVM ä¼šæŠŠä¼ æ¥çš„å­—èŠ‚æµä¸­çš„ serialVersio- nUID ä¸æœ¬åœ°ç›¸åº”å®ä½“ç±»çš„ serialVersionUID è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒå°±è®¤ä¸ºæ˜¯ä¸€è‡´ çš„ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šå‡ºç°åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ï¼Œå³æ˜¯ Invalid- CastExceptionã€‚ è¿™ä¹Ÿæ˜¯ã€ŠJava å¼€å‘æ‰‹å†Œã€‹ä¸­è§„å®šï¼Œåœ¨å…¼å®¹æ€§å‡çº§ä¸­ï¼Œåœ¨ä¿®æ”¹ç±»çš„æ—¶å€™ï¼Œä¸è¦ ä¿®æ”¹ serialVersionUID çš„åŸå› ã€‚é™¤éæ˜¯å®Œå…¨ä¸å…¼å®¹çš„ä¸¤ä¸ªç‰ˆæœ¬ã€‚æ‰€ä»¥ï¼ŒserialVersionUID å…¶å®æ˜¯éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚ å¦‚æœè¯»è€…æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŠŠå„ä¸ªç‰ˆæœ¬çš„ JDK ä»£ç éƒ½æ‹¿å‡ºæ¥çœ‹ä¸€ä¸‹ï¼Œé‚£äº›å‘ä¸‹å…¼å®¹ çš„ç±»çš„ serialVersionUID æ˜¯æ²¡æœ‰å˜åŒ–è¿‡çš„ã€‚æ¯”å¦‚ String ç±»çš„ serialVersionUIDä¸€ç›´éƒ½æ˜¯ -6849794470754667710Lã€‚ ä½†æ˜¯ï¼Œä½œè€…è®¤ä¸ºï¼Œè¿™ä¸ªè§„èŒƒå…¶å®è¿˜å¯ä»¥å†ä¸¥æ ¼ä¸€äº›ï¼Œé‚£å°±æ˜¯è§„å®š:å¦‚æœä¸€ä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œå°±å¿…é¡»æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª private static final long serialVersionUIDå˜é‡ï¼Œå¹¶ä¸”è®¾ç½®åˆå§‹å€¼ã€‚ ä¸ºä»€ä¹ˆè¦æ˜ç¡®å®šä¸€ä¸ª serialVersionUIDå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ç±»ä¸­æ˜ç¡®çš„å®šä¹‰ä¸€ä¸ª serialVersionUID çš„è¯ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ å°è¯•ä¿®æ”¹ä¸Šé¢çš„ demo ä»£ç ï¼Œå…ˆä½¿ç”¨ä»¥ä¸‹ç±»å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥ç±»ä¸­ä¸å®šä¹‰ serialVersionUIDï¼Œå°†å…¶å†™å…¥æ–‡ä»¶ã€‚ 1234567891011class User1 implements Serializable &#123; private String name; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; &#125; ç„¶åæˆ‘ä»¬ä¿®æ”¹ User1 ç±»ï¼Œå‘å…¶ä¸­å¢åŠ ä¸€ä¸ªå±æ€§ã€‚åœ¨å°è¯•å°†å…¶ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œ å¹¶è¿›è¡Œååºåˆ—åŒ–ã€‚ 12345678910111213141516class User1 implements Serializable &#123; private String name; private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125;&#125; æ‰§ è¡Œ ç»“ æœ:java.io.InvalidClassException: com.hollis.User1; local class incompatible: stream classdesc serialVersionUID = -2986778152837257883, local class serialVersionUID = 7961728318907695402 åŒæ ·ï¼ŒæŠ›å‡ºäº† InvalidClassExceptionï¼Œå¹¶ä¸”æŒ‡å‡ºä¸¤ä¸ª serialVersio- nUID ä¸åŒï¼Œåˆ†åˆ«æ˜¯ -2986778152837257883 å’Œ 7961728318907695402ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œç³»ç»Ÿè‡ªå·±æ·»åŠ äº†ä¸€ä¸ª serialVersionUIDã€‚ æ‰€ä»¥ï¼Œä¸€æ—¦ç±»å®ç°äº† Serializableï¼Œå°±å»ºè®®æ˜ç¡®çš„å®šä¹‰ä¸€ä¸ª serialVersionUIDã€‚ä¸ç„¶åœ¨ä¿®æ”¹ç±»çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚ serialVersionUID æœ‰ä¸¤ç§æ˜¾ç¤ºçš„ç”Ÿæˆæ–¹å¼: ä¸€æ˜¯é»˜è®¤çš„1Lï¼Œæ¯”å¦‚:private static final long serialVersionUID = 1L;äºŒæ˜¯æ ¹æ®ç±»åã€æ¥å£åã€æˆå‘˜æ–¹æ³•åŠå±æ€§ç­‰æ¥ç”Ÿæˆä¸€ä¸ª 64 ä½çš„å“ˆå¸Œå­—æ®µï¼Œæ¯”å¦‚:private static final long serialVersionUID = xxxxL; å°ç»“serialVersionUID æ˜¯ç”¨æ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚æ‰€ä»¥åœ¨åšå…¼å®¹æ€§å‡çº§çš„æ—¶å€™ï¼Œ ä¸è¦æ”¹å˜ç±»ä¸­ serialVersionUID çš„å€¼ã€‚ å¦‚æœä¸€ä¸ªç±»å®ç°äº† Serializable æ¥å£ï¼Œä¸€å®šè¦è®°å¾—å®šä¹‰ serialVersionUIDï¼Œå¦åˆ™ä¼šå‘ç”Ÿå¼‚å¸¸ã€‚å¯ä»¥åœ¨ IDE ä¸­é€šè¿‡è®¾ç½®ï¼Œè®©ä»–å¸®å¿™æç¤ºï¼Œå¹¶ä¸”å¯ä»¥ä¸€é”®å¿«é€Ÿç”Ÿæˆä¸€ ä¸ª serialVersionUIDã€‚ ä¹‹æ‰€ä»¥ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ˜¯å› ä¸ºååºåˆ—åŒ–è¿‡ç¨‹ä¸­åšäº†æ ¡éªŒï¼Œå¹¶ä¸”å¦‚æœæ²¡æœ‰æ˜ç¡®å®šä¹‰çš„ è¯ï¼Œä¼šæ ¹æ®ç±»çš„å±æ€§è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªã€‚ å‚è€ƒèµ„æ–™ JavaæŠ€æœ¯çµé­‚15é—®","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"æå°½HashMapåº•å±‚åŸç†","date":"2021-07-21T06:26:25.000Z","path":"wiki/æå°½HashMapåº•å±‚åŸç†/","text":"HashMap ä¸­çš„å®¹é‡ä¸æ‰©å®¹å®ç°ï¼Œç»†è‡´å…¥å¾®ï¼Œå€¼çš„ä¸€å“ Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ HashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ¬æ–‡ç»“åˆJDK1.7å’ŒJDK1.8çš„åŒºåˆ«ï¼Œæ·±å…¥æ¢è®¨HashMapçš„ç»“æ„å®ç°å’ŒåŠŸèƒ½åŸç†ã€‚ ç®€ä»‹Javaä¸ºæ•°æ®ç»“æ„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæ¥å£java.util.Mapï¼Œæ­¤æ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢é’ˆå¯¹å„ä¸ªå®ç°ç±»çš„ç‰¹ç‚¹åšä¸€äº›è¯´æ˜ï¼š (1) HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ (2) Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ã€‚Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚ (3) LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚ (4) TreeMapï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚å¯¹äºä¸Šè¿°å››ç§Mapç±»å‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚é€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬çŸ¥é“äº†HashMapæ˜¯Javaçš„Mapå®¶æ—ä¸­ä¸€ä¸ªæ™®é€šæˆå‘˜ï¼Œé‰´äºå®ƒå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„ä½¿ç”¨æ¡ä»¶ï¼Œæ‰€ä»¥æ˜¯ä½¿ç”¨é¢‘åº¦æœ€é«˜çš„ä¸€ä¸ªã€‚ä¸‹æ–‡æˆ‘ä»¬ä¸»è¦ç»“åˆæºç ï¼Œä»å­˜å‚¨ç»“æ„ã€å¸¸ç”¨æ–¹æ³•åˆ†æã€æ‰©å®¹ä»¥åŠå®‰å…¨æ€§ç­‰æ–¹é¢æ·±å…¥è®²è§£HashMapçš„å·¥ä½œåŸç†ã€‚ å†…éƒ¨å®ç°å­˜å‚¨ç»“æ„-å­—æ®µä»ç»“æ„å®ç°æ¥è®²ï¼ŒHashMapæ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°çš„ï¼Œå¦‚ä¸‹å¦‚æ‰€ç¤ºã€‚ è¿™é‡Œéœ€è¦è®²æ˜ç™½ä¸¤ä¸ªé—®é¢˜ï¼šæ•°æ®åº•å±‚å…·ä½“å­˜å‚¨çš„æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ ·çš„å­˜å‚¨æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹å‘¢ï¼Ÿ (1) ä»æºç å¯çŸ¥ï¼ŒHashMapç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å­—æ®µï¼Œå°±æ˜¯ Node[] tableï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ˜æ˜¾å®ƒæ˜¯ä¸€ä¸ªNodeçš„æ•°ç»„ã€‚æˆ‘ä»¬æ¥çœ‹Node[JDK1.8]æ˜¯ä½•ç‰©ã€‚ 1234567891011121314static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; //ç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½® final K key; V value; Node&lt;K,V&gt; next; //é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; ... &#125; public final K getKey()&#123; ... &#125; public final V getValue() &#123; ... &#125; public final String toString() &#123; ... &#125; public final int hashCode() &#123; ... &#125; public final V setValue(V newValue) &#123; ... &#125; public final boolean equals(Object o) &#123; ... &#125;&#125; Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entryæ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚ (2) HashMapå°±æ˜¯ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨çš„ã€‚å“ˆå¸Œè¡¨ä¸ºè§£å†³å†²çªï¼Œå¯ä»¥é‡‡ç”¨å¼€æ”¾åœ°å€æ³•å’Œé“¾åœ°å€æ³•ç­‰æ¥è§£å†³é—®é¢˜ï¼ŒJavaä¸­HashMapé‡‡ç”¨äº†é“¾åœ°å€æ³•ã€‚é“¾åœ°å€æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ•°ç»„åŠ é“¾è¡¨çš„ç»“åˆã€‚åœ¨æ¯ä¸ªæ•°ç»„å…ƒç´ ä¸Šéƒ½ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œå½“æ•°æ®è¢«Hashåï¼Œå¾—åˆ°æ•°ç»„ä¸‹æ ‡ï¼ŒæŠŠæ•°æ®æ”¾åœ¨å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é“¾è¡¨ä¸Šã€‚ä¾‹å¦‚ç¨‹åºæ‰§è¡Œä¸‹é¢ä»£ç ï¼š 1map.put(&quot;ç¾å›¢&quot;,&quot;å°ç¾&quot;); ç³»ç»Ÿå°†è°ƒç”¨â€ç¾å›¢â€è¿™ä¸ªkeyçš„hashCode()æ–¹æ³•å¾—åˆ°å…¶hashCode å€¼ï¼ˆè¯¥æ–¹æ³•é€‚ç”¨äºæ¯ä¸ªJavaå¯¹è±¡ï¼‰ï¼Œç„¶åå†é€šè¿‡Hashç®—æ³•çš„åä¸¤æ­¥è¿ç®—ï¼ˆé«˜ä½è¿ç®—å’Œå–æ¨¡è¿ç®—ï¼Œä¸‹æ–‡æœ‰ä»‹ç»ï¼‰æ¥å®šä½è¯¥é”®å€¼å¯¹çš„å­˜å‚¨ä½ç½®ï¼Œæœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†Hashç¢°æ’ã€‚å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’çš„æ¦‚ç‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆç‡å°±ä¼šè¶Šé«˜ã€‚ å¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºç°è¾ƒå¤šç¢°æ’ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®å°±æ˜¯åœ¨æ ¹æ®å®é™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘Hashç¢°æ’ã€‚é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶mapä½¿å¾—Hashç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„Hashç®—æ³•å’Œæ‰©å®¹æœºåˆ¶ã€‚ åœ¨ç†è§£Hashå’Œæ‰©å®¹æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸‹HashMapçš„å‡ ä¸ªå­—æ®µã€‚ä»HashMapçš„é»˜è®¤æ„é€ å‡½æ•°æºç å¯çŸ¥ï¼Œæ„é€ å‡½æ•°å°±æ˜¯å¯¹ä¸‹é¢å‡ ä¸ªå­—æ®µè¿›è¡Œåˆå§‹åŒ–ï¼Œæºç å¦‚ä¸‹: int threshold; // æ‰€èƒ½å®¹çº³çš„key-valueå¯¹æé™ final float loadFactor; // è´Ÿè½½å› å­ int modCount; int size; é¦–å…ˆï¼ŒNode[] tableçš„åˆå§‹åŒ–é•¿åº¦length(é»˜è®¤å€¼æ˜¯16)ï¼ŒLoad factorä¸ºè´Ÿè½½å› å­(é»˜è®¤å€¼æ˜¯0.75)ï¼Œthresholdæ˜¯HashMapæ‰€èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®é‡çš„Node(é”®å€¼å¯¹)ä¸ªæ•°ã€‚threshold = length * Load factorã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•°ç»„å®šä¹‰å¥½é•¿åº¦ä¹‹åï¼Œè´Ÿè½½å› å­è¶Šå¤§ï¼Œæ‰€èƒ½å®¹çº³çš„é”®å€¼å¯¹ä¸ªæ•°è¶Šå¤šã€‚ ç»“åˆè´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthresholdå°±æ˜¯åœ¨æ­¤Load factorå’Œlength(æ•°ç»„é•¿åº¦)å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–°resize(æ‰©å®¹)ï¼Œæ‰©å®¹åçš„HashMapå®¹é‡æ˜¯ä¹‹å‰å®¹é‡çš„ä¸¤å€ã€‚é»˜è®¤çš„è´Ÿè½½å› å­0.75æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ï¼Œå»ºè®®å¤§å®¶ä¸è¦ä¿®æ”¹ï¼Œé™¤éåœ¨æ—¶é—´å’Œç©ºé—´æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œå¦‚æœå†…å­˜ç©ºé—´å¾ˆå¤šè€Œåˆå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é™ä½è´Ÿè½½å› å­Load factorçš„å€¼ï¼›ç›¸åï¼Œå¦‚æœå†…å­˜ç©ºé—´ç´§å¼ è€Œå¯¹æ—¶é—´æ•ˆç‡è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥å¢åŠ è´Ÿè½½å› å­loadFactorçš„å€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥å¤§äº1ã€‚ sizeè¿™ä¸ªå­—æ®µå…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯HashMapä¸­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡ã€‚æ³¨æ„å’Œtableçš„é•¿åº¦lengthã€å®¹çº³æœ€å¤§é”®å€¼å¯¹æ•°é‡thresholdçš„åŒºåˆ«ã€‚è€ŒmodCountå­—æ®µä¸»è¦ç”¨æ¥è®°å½•HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ï¼Œä¸»è¦ç”¨äºè¿­ä»£çš„å¿«é€Ÿå¤±è´¥ã€‚å¼ºè°ƒä¸€ç‚¹ï¼Œå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–æŒ‡çš„æ˜¯ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚putæ–°é”®å€¼å¯¹ï¼Œä½†æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼è¢«è¦†ç›–ä¸å±äºç»“æ„å˜åŒ–ã€‚ åœ¨HashMapä¸­ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„tableçš„é•¿åº¦lengthå¤§å°å¿…é¡»ä¸º2çš„næ¬¡æ–¹(ä¸€å®šæ˜¯åˆæ•°)ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸è§„çš„è®¾è®¡ï¼Œå¸¸è§„çš„è®¾è®¡æ˜¯æŠŠæ¡¶çš„å¤§å°è®¾è®¡ä¸ºç´ æ•°ã€‚ç›¸å¯¹æ¥è¯´ç´ æ•°å¯¼è‡´å†²çªçš„æ¦‚ç‡è¦å°äºåˆæ•°ï¼Œå…·ä½“è¯æ˜å¯ä»¥å‚è€ƒ[http://blog.csdn.net/liuqiyao_01/article/details/14475159]ï¼ŒHashtableåˆå§‹åŒ–æ¡¶å¤§å°ä¸º11ï¼Œå°±æ˜¯æ¡¶å¤§å°è®¾è®¡ä¸ºç´ æ•°çš„åº”ç”¨ï¼ˆHashtableæ‰©å®¹åä¸èƒ½ä¿è¯è¿˜æ˜¯ç´ æ•°ï¼‰ã€‚HashMapé‡‡ç”¨è¿™ç§éå¸¸è§„è®¾è®¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†åœ¨å–æ¨¡å’Œæ‰©å®¹æ—¶åšä¼˜åŒ–ï¼ŒåŒæ—¶ä¸ºäº†å‡å°‘å†²çªï¼ŒHashMapå®šä½å“ˆå¸Œæ¡¶ç´¢å¼•ä½ç½®æ—¶ï¼Œä¹ŸåŠ å…¥äº†é«˜ä½å‚ä¸è¿ç®—çš„è¿‡ç¨‹ã€‚ è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå³ä½¿è´Ÿè½½å› å­å’ŒHashç®—æ³•è®¾è®¡çš„å†åˆç†ï¼Œä¹Ÿå…ä¸äº†ä¼šå‡ºç°æ‹‰é“¾è¿‡é•¿çš„æƒ…å†µï¼Œä¸€æ—¦å‡ºç°æ‹‰é“¾è¿‡é•¿ï¼Œåˆ™ä¼šä¸¥é‡å½±å“HashMapçš„æ€§èƒ½ã€‚äºæ˜¯ï¼Œåœ¨JDK1.8ç‰ˆæœ¬ä¸­ï¼Œå¯¹æ•°æ®ç»“æ„åšäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿ï¼ˆé»˜è®¤è¶…è¿‡8ï¼‰æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹æé«˜HashMapçš„æ€§èƒ½ï¼Œå…¶ä¸­ä¼šç”¨åˆ°çº¢é»‘æ ‘çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ç­‰ç®—æ³•ã€‚æœ¬æ–‡ä¸å†å¯¹çº¢é»‘æ ‘å±•å¼€è®¨è®ºï¼Œæƒ³äº†è§£æ›´å¤šçº¢é»‘æ ‘æ•°æ®ç»“æ„çš„å·¥ä½œåŸç†å¯ä»¥å‚è€ƒ[http://blog.csdn.net/v_july_v/article/details/6105630]ã€‚ å®ç°-æ–¹æ³•HashMapçš„å†…éƒ¨åŠŸèƒ½å®ç°å¾ˆå¤šï¼Œæœ¬æ–‡ä¸»è¦ä»æ ¹æ®keyè·å–å“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®ã€putæ–¹æ³•çš„è¯¦ç»†æ‰§è¡Œã€æ‰©å®¹è¿‡ç¨‹ä¸‰ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„ç‚¹æ·±å…¥å±•å¼€è®²è§£ã€‚ ç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„ç´¢å¼•ä½ç½®ä¸ç®¡å¢åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾é”®å€¼å¯¹ï¼Œå®šä½åˆ°å“ˆå¸Œæ¡¶æ•°ç»„çš„ä½ç½®éƒ½æ˜¯å¾ˆå…³é”®çš„ç¬¬ä¸€æ­¥ã€‚å‰é¢è¯´è¿‡HashMapçš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ªHashMapé‡Œé¢çš„å…ƒç´ ä½ç½®å°½é‡åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨hashç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œä¸ç”¨éå†é“¾è¡¨ï¼Œå¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚HashMapå®šä½æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œç›´æ¥å†³å®šäº†hashæ–¹æ³•çš„ç¦»æ•£æ€§èƒ½ã€‚å…ˆçœ‹çœ‹æºç çš„å®ç°(æ–¹æ³•ä¸€+æ–¹æ³•äºŒ): 1234567891011æ–¹æ³•ä¸€ï¼šstatic final int hash(Object key) &#123; //jdk1.8 &amp; jdk1.7 int h; // h = key.hashCode() ä¸ºç¬¬ä¸€æ­¥ å–hashCodeå€¼ // h ^ (h &gt;&gt;&gt; 16) ä¸ºç¬¬äºŒæ­¥ é«˜ä½å‚ä¸è¿ç®— return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125;æ–¹æ³•äºŒï¼šstatic int indexFor(int h, int length) &#123; //jdk1.7çš„æºç ï¼Œjdk1.8æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å®ç°åŸç†ä¸€æ ·çš„ return h &amp; (length-1); //ç¬¬ä¸‰æ­¥ å–æ¨¡è¿ç®—&#125; è¿™é‡Œçš„Hashç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼šå–keyçš„hashCodeå€¼ã€é«˜ä½è¿ç®—ã€å–æ¨¡è¿ç®—ã€‚ å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨HashMapä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨æ–¹æ³•äºŒæ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨tableæ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚ è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“lengthæ€»æ˜¯2çš„næ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹lengthå–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯&amp;æ¯”%å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨æ•°ç»„tableçš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹ï¼Œnä¸ºtableçš„é•¿åº¦ã€‚ åˆ†æHashMapçš„putæ–¹æ³•HashMapçš„putæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç†è§£ï¼Œè‡ªå·±æœ‰å…´è¶£å¯ä»¥å»å¯¹æ¯”æºç æ›´æ¸…æ¥šåœ°ç ”ç©¶å­¦ä¹ ã€‚ â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼› â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼› â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼› â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼› â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼› â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚ JDK1.8HashMapçš„putæ–¹æ³•æºç å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public V put(K key, V value) &#123; // å¯¹keyçš„hashCode()åšhash return putVal(hash(key), key, value, false, true); &#125; final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨ else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key,value,null); //é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç† if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; // keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; ++modCount; // æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; &#125; æ‰©å®¹æœºåˆ¶æ‰©å®¹(resize)å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚æˆ‘ä»¬åˆ†æä¸‹resizeçš„æºç ï¼Œé‰´äºJDK1.8èå…¥äº†çº¢é»‘æ ‘ï¼Œè¾ƒå¤æ‚ï¼Œä¸ºäº†ä¾¿äºç†è§£æˆ‘ä»¬ä»ç„¶ä½¿ç”¨JDK1.7çš„ä»£ç ï¼Œå¥½ç†è§£ä¸€äº›ï¼Œæœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ï¼Œå…·ä½“åŒºåˆ«åæ–‡å†è¯´ã€‚ 12345678910111213void resize(int newCapacity) &#123; //ä¼ å…¥æ–°çš„å®¹é‡ Entry[] oldTable = table; //å¼•ç”¨æ‰©å®¹å‰çš„Entryæ•°ç»„ int oldCapacity = oldTable.length; if (oldCapacity == MAXIMUM_CAPACITY) &#123; //æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§(2^30)äº† threshold = Integer.MAX_VALUE; //ä¿®æ”¹é˜ˆå€¼ä¸ºintçš„æœ€å¤§å€¼(2^31-1)ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šæ‰©å®¹äº† return; &#125; Entry[] newTable = new Entry[newCapacity]; //åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Entryæ•°ç»„ transfer(newTable); //ï¼ï¼å°†æ•°æ®è½¬ç§»åˆ°æ–°çš„Entryæ•°ç»„é‡Œ table = newTable; //HashMapçš„tableå±æ€§å¼•ç”¨æ–°çš„Entryæ•°ç»„ threshold = (int)(newCapacity * loadFactor);//ä¿®æ”¹é˜ˆå€¼ &#125; è¿™é‡Œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŸæœ‰Entryæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œã€‚ 1234567891011121314151617void transfer(Entry[] newTable) &#123; Entry[] src = table; //srcå¼•ç”¨äº†æ—§çš„Entryæ•°ç»„ int newCapacity = newTable.length; for (int j = 0; j &lt; src.length; j++) &#123; //éå†æ—§çš„Entryæ•°ç»„ Entry&lt;K,V&gt; e = src[j]; //å–å¾—æ—§Entryæ•°ç»„çš„æ¯ä¸ªå…ƒç´  if (e != null) &#123; src[j] = null;//é‡Šæ”¾æ—§Entryæ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§çš„Entryæ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰ do &#123; Entry&lt;K,V&gt; next = e.next; int i = indexFor(e.hash, newCapacity); //ï¼ï¼é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½® e.next = newTable[i]; //æ ‡è®°[1] newTable[i] = e; //å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Š e = next; //è®¿é—®ä¸‹ä¸€ä¸ªEntryé“¾ä¸Šçš„å…ƒç´  &#125; while (e != null); &#125; &#125; &#125; newTable[i]çš„å¼•ç”¨èµ‹ç»™äº†e.nextï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ï¼ŒåŒä¸€ä½ç½®ä¸Šæ–°å…ƒç´ æ€»ä¼šè¢«æ”¾åœ¨é“¾è¡¨çš„å¤´éƒ¨ä½ç½®ï¼›è¿™æ ·å…ˆæ”¾åœ¨ä¸€ä¸ªç´¢å¼•ä¸Šçš„å…ƒç´ ç»ˆä¼šè¢«æ”¾åˆ°Entryé“¾çš„å°¾éƒ¨(å¦‚æœå‘ç”Ÿäº†hashå†²çªçš„è¯ï¼‰ï¼Œè¿™ä¸€ç‚¹å’ŒJdk1.8æœ‰åŒºåˆ«ï¼Œä¸‹æ–‡è¯¦è§£ã€‚åœ¨æ—§æ•°ç»„ä¸­åŒä¸€æ¡Entryé“¾ä¸Šçš„å…ƒç´ ï¼Œé€šè¿‡é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®åï¼Œæœ‰å¯èƒ½è¢«æ”¾åˆ°äº†æ–°æ•°ç»„çš„ä¸åŒä½ç½®ä¸Šã€‚ ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸‹æ‰©å®¹è¿‡ç¨‹ã€‚å‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„çš„é•¿åº¦ï¼‰ã€‚å…¶ä¸­çš„å“ˆå¸Œæ¡¶æ•°ç»„tableçš„size=2ï¼Œ æ‰€ä»¥key = 3ã€7ã€5ï¼Œputé¡ºåºä¾æ¬¡ä¸º 5ã€7ã€3ã€‚åœ¨mod 2ä»¥åéƒ½å†²çªåœ¨table[1]è¿™é‡Œäº†ã€‚è¿™é‡Œå‡è®¾è´Ÿè½½å› å­ loadFactor=1ï¼Œå³å½“é”®å€¼å¯¹çš„å®é™…å¤§å°size å¤§äº tableçš„å®é™…å¤§å°æ—¶è¿›è¡Œæ‰©å®¹ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤æ˜¯å“ˆå¸Œæ¡¶æ•°ç»„ resizeæˆ4ï¼Œç„¶åæ‰€æœ‰çš„Nodeé‡æ–°rehashçš„è¿‡ç¨‹ã€‚ ä¸‹é¢æˆ‘ä»¬è®²è§£ä¸‹JDK1.8åšäº†å“ªäº›ä¼˜åŒ–ã€‚ç»è¿‡è§‚æµ‹å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚çœ‹ä¸‹å›¾å¯ä»¥æ˜ç™½è¿™å¥è¯çš„æ„æ€ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚ å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚è¿™ä¸€å—å°±æ˜¯JDK1.8æ–°å¢çš„ä¼˜åŒ–ç‚¹ã€‚æœ‰ä¸€ç‚¹æ³¨æ„åŒºåˆ«ï¼ŒJDK1.7ä¸­rehashçš„æ—¶å€™ï¼Œæ—§é“¾è¡¨è¿ç§»æ–°é“¾è¡¨çš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ–°è¡¨çš„æ•°ç»„ç´¢å¼•ä½ç½®ç›¸åŒï¼Œåˆ™é“¾è¡¨å…ƒç´ ä¼šå€’ç½®ï¼Œä½†æ˜¯ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJDK1.8ä¸ä¼šå€’ç½®ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸‹JDK1.8çš„resizeæºç ï¼Œå†™çš„å¾ˆèµï¼Œå¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182final Node&lt;K,V&gt;[] resize() &#123; Node&lt;K,V&gt;[] oldTab = table; int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) &#123; // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; // æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; else &#123; // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; // è®¡ç®—æ–°çš„resizeä¸Šé™ if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr; @SuppressWarnings(&#123;&quot;rawtypes&quot;ï¼Œ&quot;unchecked&quot;&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; // æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­ for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å— Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; // åŸç´¢å¼• if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; // åŸç´¢å¼•+oldCap else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); // åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; // åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab; &#125; çº¿ç¨‹å®‰å…¨æ€§åœ¨å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„HashMapï¼Œè€Œä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¯´HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸‹é¢ä¸¾ä¾‹å­è¯´æ˜åœ¨å¹¶å‘çš„å¤šçº¿ç¨‹ä½¿ç”¨åœºæ™¯ä¸­ä½¿ç”¨HashMapå¯èƒ½é€ æˆæ­»å¾ªç¯ã€‚ä»£ç ä¾‹å­å¦‚ä¸‹(ä¾¿äºç†è§£ï¼Œä»ç„¶ä½¿ç”¨JDK1.7çš„ç¯å¢ƒ)ï¼š 1234567891011121314151617181920public class HashMapInfiniteLoop &#123; private static HashMap&lt;Integer,String&gt; map = new HashMap&lt;Integer,String&gt;(2ï¼Œ0.75f); public static void main(String[] args) &#123; map.put(5ï¼Œ &quot;C&quot;); new Thread(&quot;Thread1&quot;) &#123; public void run() &#123; map.put(7, &quot;B&quot;); System.out.println(map); &#125;; &#125;.start(); new Thread(&quot;Thread2&quot;) &#123; public void run() &#123; map.put(3, &quot;A); System.out.println(map); &#125;; &#125;.start(); &#125; &#125; å…¶ä¸­ï¼Œmapåˆå§‹åŒ–ä¸ºä¸€ä¸ªé•¿åº¦ä¸º2çš„æ•°ç»„ï¼ŒloadFactor=0.75ï¼Œthreshold=2*0.75=1ï¼Œä¹Ÿå°±æ˜¯è¯´å½“putç¬¬äºŒä¸ªkeyçš„æ—¶å€™ï¼Œmapå°±éœ€è¦è¿›è¡Œresizeã€‚ é€šè¿‡è®¾ç½®æ–­ç‚¹è®©çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶debugåˆ°transferæ–¹æ³•(3.3å°èŠ‚ä»£ç å—)çš„é¦–è¡Œã€‚æ³¨æ„æ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹å·²ç»æˆåŠŸæ·»åŠ æ•°æ®ã€‚æ”¾å¼€thread1çš„æ–­ç‚¹è‡³transferæ–¹æ³•çš„â€œEntry next = e.next;â€ è¿™ä¸€è¡Œï¼›ç„¶åæ”¾å¼€çº¿ç¨‹2çš„çš„æ–­ç‚¹ï¼Œè®©çº¿ç¨‹2è¿›è¡Œresizeã€‚ç»“æœå¦‚ä¸‹å›¾ã€‚ æ³¨æ„ï¼ŒThread1çš„ e æŒ‡å‘äº†key(3)ï¼Œè€ŒnextæŒ‡å‘äº†key(7)ï¼Œå…¶åœ¨çº¿ç¨‹äºŒrehashåï¼ŒæŒ‡å‘äº†çº¿ç¨‹äºŒé‡ç»„åçš„é“¾è¡¨ã€‚çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œå…ˆæ˜¯æ‰§è¡Œ newTalbe[i] = eï¼Œ ç„¶åæ˜¯e = nextï¼Œå¯¼è‡´äº†eæŒ‡å‘äº†key(7)ï¼Œè€Œä¸‹ä¸€æ¬¡å¾ªç¯çš„next = e.nextå¯¼è‡´äº†nextæŒ‡å‘äº†key(3)ã€‚ e.next = newTable[i] å¯¼è‡´ key(3).next æŒ‡å‘äº† key(7)ã€‚æ³¨æ„ï¼šæ­¤æ—¶çš„key(7).next å·²ç»æŒ‡å‘äº†key(3)ï¼Œ ç¯å½¢é“¾è¡¨å°±è¿™æ ·å‡ºç°äº†ã€‚ äºæ˜¯ï¼Œå½“æˆ‘ä»¬ç”¨çº¿ç¨‹ä¸€è°ƒç”¨map.get(11)æ—¶ï¼Œæ‚²å‰§å°±å‡ºç°äº†â€”â€”Infinite Loopã€‚ å°ç»“(1) æ‰©å®¹æ˜¯ä¸€ä¸ªç‰¹åˆ«è€—æ€§èƒ½çš„æ“ä½œï¼Œæ‰€ä»¥å½“ç¨‹åºå‘˜åœ¨ä½¿ç”¨HashMapçš„æ—¶å€™ï¼Œä¼°ç®—mapçš„å¤§å°ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ç»™ä¸€ä¸ªå¤§è‡´çš„æ•°å€¼ï¼Œé¿å…mapè¿›è¡Œé¢‘ç¹çš„æ‰©å®¹ã€‚ (2) è´Ÿè½½å› å­æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä¹Ÿå¯ä»¥å¤§äº1ï¼Œä½†æ˜¯å»ºè®®ä¸è¦è½»æ˜“ä¿®æ”¹ï¼Œé™¤éæƒ…å†µéå¸¸ç‰¹æ®Šã€‚ (3) HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¸è¦åœ¨å¹¶å‘çš„ç¯å¢ƒä¸­åŒæ—¶æ“ä½œHashMapï¼Œå»ºè®®ä½¿ç”¨ConcurrentHashMapã€‚ (4) JDK1.8å¼•å…¥çº¢é»‘æ ‘å¤§ç¨‹åº¦ä¼˜åŒ–äº†HashMapçš„æ€§èƒ½ã€‚(5) è¿˜æ²¡å‡çº§JDK1.8çš„ï¼Œç°åœ¨å¼€å§‹å‡çº§å§ã€‚HashMapçš„æ€§èƒ½æå‡ä»…ä»…æ˜¯JDK1.8çš„å†°å±±ä¸€è§’ã€‚","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"elasticsearchå­—ç¬¦ä¸²æŸ¥è¯¢æ±‡æ€»","date":"2021-07-20T14:08:29.000Z","path":"wiki/elasticsearchå­—ç¬¦ä¸²æŸ¥è¯¢æ±‡æ€»/","text":"filterexistsfuzzyidsprefixregexptermtermsterms_setwildcardtextæœç´¢ intervalmatchmatch_bool_prefixmatch_phrasematch_phrase_prefixmulti_matchcommonquery_stringsimple_query_string å‚è€ƒèµ„æ–™ æŸ¥è¯¢æ˜¯å¦åŒ…å«å­—ç¬¦ä¸²_åä¹ç§Elasticsearchå­—ç¬¦ä¸²æœç´¢æ–¹å¼ç»ˆæä»‹ç»","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"elasticsearch æŸ¥è¯¢å€¼å‰ç¼€ä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²","date":"2021-07-20T13:48:31.000Z","path":"wiki/elasticsearch-æŸ¥è¯¢å€¼å‰ç¼€ä¸åŒ…å«æŸä¸ªå­—ç¬¦ä¸²/","text":"éœ€æ±‚ æŸ¥è¯¢IPä¸æ˜¯ä»¥11.å¼€å¤´çš„æ‰€æœ‰æ–‡æ¡£ï¼Œç„¶åè·å–æ–‡æ¡£è®¿é—®é‡å‰100æ¡ curl -X GET &quot;localhost:9200/yj_visit_data2,yj_visit_data3/_search?pretty&quot; -u elastic:elastic -H &#39;Content-Type: application/json&#39; -d&#39; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;must_not&quot;: [ &#123; &quot;bool&quot;: &#123; &quot;should&quot;: [ &#123; &quot;prefix&quot;: &#123; &quot;ip&quot;: &#123; &quot;value&quot;: &quot;11.&quot; &#125; &#125; &#125;, &#123; &quot;prefix&quot;: &#123; &quot;ip&quot;: &#123; &quot;value&quot;: &quot;1.&quot; &#125; &#125; &#125; ] &#125; &#125; ], &quot;must&quot;: [ &#123; &quot;range&quot;: &#123; &quot;visitTime&quot;: &#123; &quot;gte&quot;: 1577808000000, &quot;lte&quot;: 1609430399000 &#125; &#125; &#125; ] &#125; &#125;, &quot;aggs&quot;: &#123; &quot;term_article&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;ip&quot;, &quot;min_doc_count&quot;: 20, &quot;size&quot;: 10000 &#125; &#125; &#125;&#125;&#x27;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"httpsåè®®","date":"2021-07-20T08:30:45.000Z","path":"wiki/httpsåè®®/","text":"å‚è€ƒèµ„æ–™ ã€Š HTTPS å‡çº§æŒ‡å— ã€‹ æ·±å…¥ç†è§£ HTTPS åŸç†ã€è¿‡ç¨‹ä¸å®è·µ HTTPSå®ç°åŸç† æ·±å…¥ç†è§£HTTPSåŸç†ã€è¿‡ç¨‹ä¸å®è·µ","tags":[{"name":"http","slug":"http","permalink":"http://example.com/tags/http/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"HTTP","slug":"Computer-Network/HTTP","permalink":"http://example.com/categories/Computer-Network/HTTP/"}]},{"title":"elasticsearch-reindex","date":"2021-07-20T03:59:18.000Z","path":"wiki/elasticsearch-reindex/","text":"reindex å¸¸è§„ä½¿ç”¨ Reindexè¦æ±‚ä¸ºæºç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£å¯ç”¨_sourceã€‚Reindexä¸å°è¯•è®¾ç½®ç›®æ ‡ç´¢å¼•ï¼Œå®ƒä¸å¤åˆ¶æºç´¢å¼•çš„è®¾ç½®ï¼Œä½ åº”è¯¥åœ¨è¿è¡Œ_reindexæ“ä½œä¹‹å‰è®¾ç½®ç›®æ ‡ç´¢å¼•ï¼ŒåŒ…æ‹¬è®¾ç½®æ˜ å°„ã€ç¢ç‰‡è®¡æ•°ã€å‰¯æœ¬ç­‰ã€‚ å¦‚ä¸‹ç¤ºä¾‹å°†æŠŠæ–‡æ¡£ä»twitterç´¢å¼•å¤åˆ¶åˆ°new_twitterç´¢å¼•ï¼š 123456789curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot; &#125;&#125;&#x27; ä¸‹é¢æ˜¯è¿”å›å€¼ï¼š 12345678910111213141516171819&#123; &quot;took&quot; : 299, &quot;timed_out&quot; : false, &quot;total&quot; : 2, &quot;updated&quot; : 0, &quot;created&quot; : 2, &quot;deleted&quot; : 0, &quot;batches&quot; : 1, &quot;version_conflicts&quot; : 0, &quot;noops&quot; : 0, &quot;retries&quot; : &#123; &quot;bulk&quot; : 0, &quot;search&quot; : 0 &#125;, &quot;throttled_millis&quot; : 0, &quot;requests_per_second&quot; : -1.0, &quot;throttled_until_millis&quot; : 0, &quot;failures&quot; : [ ]&#125; å°±åƒ_update_by_queryä¸€æ ·ï¼Œ_reindexè·å–æºç´¢å¼•çš„å¿«ç…§ï¼Œä½†å®ƒçš„ç›®æ ‡å¿…é¡»æ˜¯ä¸åŒçš„ç´¢å¼•ï¼Œå› æ­¤ä¸å¤ªå¯èƒ½å‘ç”Ÿç‰ˆæœ¬å†²çªã€‚å¯ä»¥åƒindex APIé‚£æ ·é…ç½®destå…ƒç´ æ¥æ§åˆ¶ä¹è§‚å¹¶å‘æ§åˆ¶ã€‚ä»…ä»…çœç•¥version_type(å¦‚ä¸Šæ‰€è¿°)æˆ–å°†å…¶è®¾ç½®ä¸ºinternalï¼Œéƒ½ä¼šå¯¼è‡´Elasticsearchç›²ç›®åœ°å°†æ–‡æ¡£è½¬å‚¨åˆ°ç›®æ ‡ä¸­ï¼Œè¦†ç›–ä»»ä½•ç¢°å·§å…·æœ‰ç›¸åŒç±»å‹å’Œidçš„æ–‡æ¡£ 1234567891011curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot;, &quot;version_type&quot;: &quot;internal&quot; &#125;&#125;&#x27; å°†version_typeè®¾ç½®ä¸ºexternalå°†å¯¼è‡´Elasticsearchä¿å­˜æºæ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œåˆ›å»ºä»»ä½•ç¼ºå¤±çš„æ–‡æ¡£ï¼Œå¹¶æ›´æ–°ç›®æ ‡ç´¢å¼•ä¸­æ¯”æºç´¢å¼•ä¸­ç‰ˆæœ¬æ›´æ—§çš„æ–‡æ¡£ï¼š 1234567891011curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter2&quot;, &quot;version_type&quot;: &quot;external&quot; &#125;&#125;&#x27; è®¾ç½®op_type=createå°†å¯¼è‡´_reindexåªåœ¨ç›®æ ‡ç´¢å¼•ä¸­åˆ›å»ºç¼ºå¤±çš„æ–‡æ¡£ã€‚æ‰€æœ‰ç°æœ‰æ–‡ä»¶å°†å¯¼è‡´ç‰ˆæœ¬å†²çªï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter3&quot;, &quot;op_type&quot;: &quot;create&quot; &#125;&#125;&#x27; é»˜è®¤æƒ…å†µä¸‹ï¼Œç‰ˆæœ¬å†²çªå°†ä¸­æ­¢_reindexè¿›ç¨‹ï¼Œâ€œconflictsâ€è¯·æ±‚ä½“å‚æ•°å¯ç”¨äºæŒ‡ç¤º_reindexå¤„ç†å…³äºç‰ˆæœ¬å†²çªçš„ä¸‹ä¸€ä¸ªæ–‡æ¡£ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä»–é”™è¯¯ç±»å‹çš„å¤„ç†ä¸å—â€œconflictsâ€å‚æ•°çš„å½±å“ï¼Œå½“åœ¨è¯·æ±‚ä½“ä¸­è®¾ç½®â€œconflictsâ€:â€œproceedâ€æ—¶ï¼Œ_reindexè¿›ç¨‹å°†ç»§ç»­å¤„ç†ç‰ˆæœ¬å†²çªï¼Œå¹¶è¿”å›æ‰€é‡åˆ°çš„ç‰ˆæœ¬å†²çªè®¡æ•°ï¼š 1234567891011curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;conflicts&quot;: &quot;proceed&quot;, &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter3&quot;, &quot;op_type&quot;: &quot;create&quot; &#125;&#125;&#x27; è¿”å›å€¼å¦‚ä¸‹ï¼š 12345678910111213141516171819&#123; &quot;took&quot; : 7, &quot;timed_out&quot; : false, &quot;total&quot; : 2, &quot;updated&quot; : 0, &quot;created&quot; : 0, &quot;deleted&quot; : 0, &quot;batches&quot; : 1, &quot;version_conflicts&quot; : 2, &quot;noops&quot; : 0, &quot;retries&quot; : &#123; &quot;bulk&quot; : 0, &quot;search&quot; : 0 &#125;, &quot;throttled_millis&quot; : 0, &quot;requests_per_second&quot; : -1.0, &quot;throttled_until_millis&quot; : 0, &quot;failures&quot; : [ ]&#125; å¯ä»¥é€šè¿‡å‘æºæ·»åŠ æŸ¥è¯¢æ¥é™åˆ¶æ–‡æ¡£ã€‚è¿™å°†åªå¤åˆ¶ç”±kimchyå‘å‡ºçš„tweetåˆ°new_twitterï¼š 123456789101112131415curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;conflicts&quot;: &quot;proceed&quot;, &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot;, &quot;query&quot;: &#123; &quot;term&quot;: &#123; &quot;user&quot;: &quot;kimchy&quot; &#125; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter2&quot; &#125;&#125;&#x27; sourceä¸­çš„indexå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…è®¸ä½ åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ä»å¤šä¸ªæºå¤åˆ¶ã€‚è¿™å°†ä»twitterå’Œblogç´¢å¼•å¤åˆ¶æ–‡æ¡£ï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;conflicts&quot;: &quot;proceed&quot;, &quot;source&quot;: &#123; &quot;index&quot;: [&quot;twitter&quot;,&quot;blog&quot;] &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter2&quot; &#125;&#125;&#x27; æ³¨æ„ï¼šReindex APIä¸å¤„ç†IDå†²çªï¼Œå› æ­¤æœ€åç¼–å†™çš„æ–‡æ¡£å°†â€œèƒœå‡ºâ€ï¼Œä½†é¡ºåºé€šå¸¸æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ä¾èµ–è¿™ç§è¡Œä¸ºä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œç›¸åï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ç¡®ä¿idæ˜¯æƒŸä¸€çš„ã€‚è¿˜å¯ä»¥é€šè¿‡è®¾ç½®å¤§å°æ¥é™åˆ¶å¤„ç†æ–‡æ¡£çš„æ•°é‡ï¼Œç¤ºä¾‹å°†åªå¤åˆ¶ä¸€ä¸ªå•ä¸€çš„æ–‡ä»¶ä»twitteråˆ°new_twitterï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;size&quot;: 1, &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot; &#125;&#125;&#x27; å¦‚æœä½ æƒ³ä»twitterç´¢å¼•ä¸­è·å¾—ä¸€ç»„ç‰¹å®šçš„æ–‡æ¡£ï¼Œä½ éœ€è¦ä½¿ç”¨sortã€‚æ’åºä¼šé™ä½æ»šåŠ¨çš„æ•ˆç‡ï¼Œä½†åœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·åšæ˜¯å€¼å¾—çš„ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œé€‰æ‹©ä¸€ä¸ªæ¯”å¤§å°å’Œæ’åºæ›´å…·é€‰æ‹©æ€§çš„æŸ¥è¯¢ã€‚è¿™å°†æŠŠ10000ä¸ªæ–‡æ¡£ä»twitterå¤åˆ¶åˆ°new_twitterï¼š 1234567891011curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;size&quot;: 10000, &quot;source&quot;: &#123; &quot;index&quot;: &quot;blog2&quot;, &quot;sort&quot;: &#123; &quot;age&quot;: &quot;desc&quot; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot; &#125;&#125;&#x27; sourceéƒ¨åˆ†æ”¯æŒæœç´¢è¯·æ±‚ä¸­æ”¯æŒçš„æ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåªæœ‰åŸå§‹æ–‡æ¡£ä¸­çš„ä¸€éƒ¨åˆ†å­—æ®µå¯ä»¥ä½¿ç”¨æºè¿‡æ»¤é‡æ–°ç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot;, &quot;_source&quot;: [&quot;user&quot;, &quot;_doc&quot;] &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot; &#125;&#125;&#x27; ä¸_update_by_queryä¸€æ ·ï¼Œ_reindexæ”¯æŒä¿®æ”¹æ–‡æ¡£çš„è„šæœ¬ã€‚ä¸_update_by_queryä¸åŒï¼Œè„šæœ¬å…è®¸ä¿®æ”¹æ–‡æ¡£çš„å…ƒæ•°æ®ã€‚è¿™ä¸ªä¾‹å­æ”¹å˜äº†æºæ–‡æ¡£çš„ç‰ˆæœ¬ï¼š 1234567891011121314curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;blog2&quot;, &quot;version_type&quot;: &quot;external&quot; &#125;, &quot;script&quot;: &#123; &quot;source&quot;: &quot;if (ctx._source.foo == \\&quot;bar\\&quot;) &#123;ctx._version++; ctx._source.remove(\\&quot;foo\\&quot;)&#125;&quot;, &quot;lang&quot;: &quot;painless&quot; &#125;&#125;&#x27; å°±åƒåœ¨_update_by_queryä¸­ä¸€æ ·ï¼Œä½ å¯ä»¥è®¾ç½®ctx.opæ›´æ”¹åœ¨ç›®æ ‡ç´¢å¼•ä¸Šæ‰§è¡Œçš„æ“ä½œï¼Œå€¼ä¸ºnoopï¼Œdeleteã€‚è®¾ç½®ctx.opåˆ°ä»»ä½•å…¶ä»–å­—æ®µéƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œåœ¨ctxä¸­è®¾ç½®ä»»ä½•å…¶ä»–å­—æ®µä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¯ä»¥ä¿®æ”¹ä»¥ä¸‹å€¼ï¼š_idã€_indexã€_versionã€_routingã€‚å°†_versionè®¾ç½®ä¸ºnullæˆ–å°†å®ƒä»ctxæ˜ å°„ä¸­æ¸…é™¤ï¼Œå°±åƒæ²¡æœ‰åœ¨ç´¢å¼•è¯·æ±‚ä¸­å‘é€ç‰ˆæœ¬ä¸€æ ·;å®ƒå°†å¯¼è‡´åœ¨ç›®æ ‡ç´¢å¼•ä¸­è¦†ç›–æ–‡æ¡£ï¼Œè€Œä¸ç®¡ç›®æ ‡ä¸Šçš„ç‰ˆæœ¬æˆ–åœ¨_reindexè¯·æ±‚ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ç±»å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ_reindexçœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰è·¯ç”±çš„æ–‡æ¡£ï¼Œé‚£ä¹ˆè¯¥è·¯ç”±å°†è¢«ä¿ç•™ï¼Œé™¤éè„šæœ¬æ›´æ”¹äº†å®ƒï¼Œä½ å¯ä»¥è®¾ç½®è·¯ç”±å¯¹destçš„è¯·æ±‚ï¼Œä»¥æ”¹å˜è¿™ä¸€ç‚¹ï¼škeepï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸ºåŒ¹é…ä¸Šçš„è·¯ç”±ã€‚è¿™æ˜¯é»˜è®¤å€¼ã€‚discardï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸ºnullã€‚=ï¼šå°†ä¸ºæ¯ä¸ªåŒ¹é…å‘é€çš„æ‰¹é‡è¯·æ±‚ä¸Šçš„è·¯ç”±è®¾ç½®ä¸º=ä¹‹åçš„æ‰€æœ‰æ–‡æœ¬ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯·æ±‚å°†æ‰€æœ‰æ–‡æ¡£ä»å…·æœ‰å…¬å¸åç§°catçš„æºç´¢å¼•å¤åˆ¶åˆ°è·¯ç”±è®¾ç½®ä¸ºcatçš„destç´¢å¼•ä¸­ï¼š 123456789101112131415curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;source&quot;, &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;company&quot;: &quot;cat&quot; &#125; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot;, &quot;routing&quot;: &quot;=cat&quot; &#125;&#125;&#x27; é»˜è®¤æƒ…å†µä¸‹ï¼Œ_reindexä½¿ç”¨æ»šåŠ¨æ‰¹æ¬¡ä¸º1000ï¼Œå¯ä»¥ä½¿ç”¨æºå…ƒç´ ä¸­çš„sizeå­—æ®µæ›´æ”¹æ‰¹å¤§å°ï¼š 1234567891011curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;source&quot;, &quot;size&quot;: 100 &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot;, &quot;routing&quot;: &quot;=cat&quot; &#125;&#125;&#x27; _reindexè¿˜å¯ä»¥é€šè¿‡åƒè¿™æ ·æŒ‡å®šç®¡é“æ¥ä½¿ç”¨IngestèŠ‚ç‚¹ç‰¹æ€§ï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;source&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot;, &quot;pipeline&quot;: &quot;some_ingest_pipeline&quot; &#125;&#125;&#x27; è¿œç¨‹reindex12345678910111213141516171819curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;remote&quot;: &#123; &quot;host&quot;: &quot;http://otherhost:9200&quot;, &quot;username&quot;: &quot;user&quot;, &quot;password&quot;: &quot;pass&quot; &#125;, &quot;index&quot;: &quot;source&quot;, &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;test&quot;: &quot;data&quot; &#125; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot; &#125;&#125;&#x27; hostå‚æ•°å¿…é¡»åŒ…å«scheme, host, portï¼ˆå¦‚ï¼šhttp://otherhost:9200ï¼‰,ä¹Ÿå¯ä»¥åŠ è·¯å¾„ï¼ˆå¦‚ï¼šhttp://otherhost:9200/proxyï¼‰ï¼Œusernameå’Œpasswordæ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¿œç¨‹é›†ç¾¤å¼€å¯äº†å®‰å…¨è®¤è¯ï¼Œé‚£ä¹ˆæ˜¯å¿…é€‰çš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨usernameå’Œpasswordï¼Œéœ€è¦ä½¿ç”¨httpsã€‚è¿œç¨‹ä¸»æœºéœ€è¦è®¾ç½®ç™½åå•ï¼Œå¯ä»¥é€šè¿‡elasticsearch.ymlæ–‡ä»¶é‡Œçš„reindex.remote.whitelistå±æ€§è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœè®¾ç½®å¤šä¸ªå€¼å¯ä»¥ä½¿ç”¨é€—å·æ¥è¿›è¡Œåˆ†éš”ï¼ˆå¦‚ï¼šotherhost:9200, another:9200, 127.0.10.*:9200, localhost:*ï¼‰ï¼Œè¿™é‡Œçš„é…ç½®å¯ä»¥å¿½ç•¥schemeï¼Œå¦‚ï¼š reindex.remote.whitelist: &quot;otherhost:9200, another:9200, 127.0.10.*:9200, localhost:*&quot; å¿…é¡»è®©æ¯ä¸ªå¤„ç†reindexçš„èŠ‚ç‚¹ä¸Šæ·»åŠ ç™½åå•çš„é…ç½®ã€‚è¿™ä¸ªç‰¹æ€§åº”è¯¥é€‚ç”¨äºå¯èƒ½æ‰¾åˆ°çš„ä»»ä½•ç‰ˆæœ¬çš„Elasticsearchçš„è¿œç¨‹é›†ç¾¤ï¼Œè¿™åº”è¯¥å…è®¸é€šè¿‡ä»æ—§ç‰ˆæœ¬çš„é›†ç¾¤reindexï¼Œå°†Elasticsearchçš„ä»»ä½•ç‰ˆæœ¬å‡çº§åˆ°å½“å‰ç‰ˆæœ¬ã€‚è¦å¯ç”¨å‘é€åˆ°æ—§ç‰ˆæœ¬Elasticsearchçš„æŸ¥è¯¢ï¼Œæ— éœ€éªŒè¯æˆ–ä¿®æ”¹å³å¯å°†æŸ¥è¯¢å‚æ•°ç›´æ¥å‘é€åˆ°è¿œç¨‹ä¸»æœºï¼Œæ³¨æ„ï¼šè¿œç¨‹reindexä¸æ”¯æŒæ‰‹åŠ¨æˆ–è€…è‡ªåŠ¨slicingã€‚ä»è¿œç¨‹æœåŠ¡å™¨reindexä½¿ç”¨å †ä¸Šç¼“å†²åŒºï¼Œé»˜è®¤æœ€å¤§å¤§å°ä¸º100mbï¼Œå¦‚æœè¿œç¨‹ç´¢å¼•åŒ…å«éå¸¸å¤§çš„æ–‡æ¡£ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ›´å°çš„æ‰¹å¤„ç†å¤§å°ï¼Œä¸‹é¢çš„ç¤ºä¾‹å°†æ‰¹å¤„ç†å¤§å°è®¾ç½®ä¸º10ã€‚ 123456789101112131415161718curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;remote&quot;: &#123; &quot;host&quot;: &quot;http://otherhost:9200&quot; &#125;, &quot;index&quot;: &quot;source&quot;, &quot;size&quot;: 10, &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;test&quot;: &quot;data&quot; &#125; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot; &#125;&#125;&#x27; è¿˜å¯ä»¥ä½¿ç”¨socket_timeoutå­—æ®µè®¾ç½®è¿œç¨‹è¿æ¥ä¸Šçš„å¥—æ¥å­—è¯»å–è¶…æ—¶ï¼Œä½¿ç”¨connect_timeoutå­—æ®µè®¾ç½®è¿æ¥è¶…æ—¶ï¼Œä»–ä»¬çš„é»˜è®¤å€¼ä¸º30ç§’ï¼Œä¸‹é¢ç¤ºä¾‹ä¾‹å°†å¥—æ¥å­—è¯»å–è¶…æ—¶è®¾ç½®ä¸º1åˆ†é’Ÿï¼Œè¿æ¥è¶…æ—¶è®¾ç½®ä¸º10ç§’ï¼š 12345678910111213141516171819curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;remote&quot;: &#123; &quot;host&quot;: &quot;http://otherhost:9200&quot;, &quot;socket_timeout&quot;: &quot;1m&quot;, &quot;connect_timeout&quot;: &quot;10s&quot; &#125;, &quot;index&quot;: &quot;source&quot;, &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;test&quot;: &quot;data&quot; &#125; &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;dest&quot; &#125;&#125;&#x27; é…ç½®SSLå‚æ•°è¿œç¨‹reindexæ”¯æŒé…ç½®SSLå‚æ•°ï¼Œé™¤äº†åœ¨Elasticsearchç§˜é’¥åº“ä¸­æ·»åŠ å®‰å…¨è®¾ç½®ä¹‹å¤–ï¼Œè¿˜éœ€è¦åœ¨elasticsearch.ymlæ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä¸å¯èƒ½åœ¨_reindexè¯·æ±‚ä½“ä¸­é…ç½®ã€‚æ”¯æŒä»¥ä¸‹è®¾ç½®ï¼šreindex.ssl.certificate_authoritiesåº”å—ä¿¡ä»»çš„PEMç¼–ç è¯ä¹¦æ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ï¼Œä¸åŒåŒæ—¶æŒ‡å®šreindex.ssl.certificate_authoritieså’Œreindex.ssl.truststore.pathã€‚reindex.ssl.truststore.pathåŒ…å«è¦ä¿¡ä»»çš„è¯ä¹¦çš„Javaå¯†é’¥å­˜å‚¨æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¸ªå¯†é’¥å­˜å‚¨åº“å¯ä»¥æ˜¯â€œJKSâ€æˆ–â€œPKCS#12â€æ ¼å¼ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®šreindex.ssl.certificate_authoritieså’Œreindex.ssl.truststore.pathã€‚reindex.ssl.truststore.passwordreindex.ssl.truststore.pathé…ç½®çš„å¯†ç ï¼Œä¸èƒ½å’Œreindex.ssl.truststore.secure_passwordä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.truststore.secure_passwordreindex.ssl.truststore.pathé…ç½®çš„å¯†ç ï¼Œä¸èƒ½å’Œreindex.ssl.truststore.passwordä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.truststore.typereindex.ssl.truststore.pathä¿¡ä»»å­˜å‚¨åº“çš„ç±»å‹ï¼Œå¿…é¡»æ˜¯jksæˆ–PKCS12ï¼Œå¦‚æœreindex.ssl.truststore.pathçš„ç»“æŸæ˜¯â€.p12â€, â€œ.pfxâ€æˆ–è€…â€pkcs12â€ï¼Œé‚£ä¹ˆè¯¥é…ç½®çš„é»˜è®¤å€¼æ˜¯PKCS12ï¼Œå¦åˆ™é»˜è®¤å€¼æ˜¯jksã€‚reindex.ssl.verification_modeæŒ‡ç¤ºç”¨äºé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œä¼ªé€ è¯ä¹¦çš„éªŒè¯ç±»å‹ã€‚å¯ä»¥è®¾ç½®ä¸ºfullï¼ˆéªŒè¯ä¸»æœºåå’Œè¯ä¹¦è·¯å¾„ï¼‰ã€certificateï¼ˆéªŒè¯è¯ä¹¦è·¯å¾„ï¼Œä½†ä¸éªŒè¯ä¸»æœºåï¼‰ã€noneï¼ˆä¸æ‰§è¡ŒéªŒè¯â€”â€”è¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å¼ºçƒˆä¸é¼“åŠ±çš„ï¼‰ï¼Œé»˜è®¤æ˜¯fullã€‚reindex.ssl.certificateæŒ‡å®šPEMç¼–ç è¯ä¹¦çš„è·¯å¾„æˆ–è€…è¯ä¹¦é“¾ç”¨äºHTTPå®¢æˆ·ç«¯èº«ä»½è®¤è¯ï¼Œè¿™ä¸ªé…ç½®è¿˜éœ€è¦è®¾ç½®reindex.ssl.keyå€¼ï¼Œä¸èƒ½åŒæ—¶è®¾ç½®reindex.ssl.certificateå’Œreindex.ssl.keystore.pathã€‚reindex.ssl.keyæŒ‡å®šä¸ç”¨äºå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„è¯ä¹¦ç›¸å…³è”çš„PEMç¼–ç ç§é’¥çš„è·¯å¾„ï¼Œä¸èƒ½åŒæ—¶è®¾ç½®reindex.ssl.keyå’Œreindex.ssl.keystore.pathã€‚reindex.ssl.key_passphraseæŒ‡å®šç”¨äºè§£å¯†å·²åŠ å¯†çš„PEMç¼–ç ç§é’¥(reindex.ssl.key)çš„å£ä»¤ï¼Œä¸èƒ½ä¸reindex.ssl.secure_key_passphraseä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.secure_key_passphraseæŒ‡å®šç”¨äºè§£å¯†å·²åŠ å¯†çš„PEMç¼–ç ç§é’¥(reindex.ssl.key)çš„å£ä»¤ï¼Œä¸èƒ½ä¸reindex.ssl.key_passphraseä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.keystore.pathæŒ‡å®šå¯†é’¥å­˜å‚¨åº“çš„è·¯å¾„ï¼Œå…¶ä¸­åŒ…å«ç”¨äºHTTPå®¢æˆ·æœºèº«ä»½éªŒè¯çš„ç§é’¥å’Œè¯ä¹¦(å¦‚æœè¿œç¨‹é›†ç¾¤éœ€è¦)ï¼Œè¿™ä¸ªå¯†é’¥å­˜å‚¨åº“å¯ä»¥æ˜¯â€œJKSâ€æˆ–â€œPKCS#12â€æ ¼å¼ï¼Œä¸èƒ½åŒæ—¶æŒ‡å®šreindex.ssl.keyå’Œreindex.ssl.keystore.pathã€‚reindex.ssl.keystore.typeå¯†é’¥å­˜å‚¨åº“çš„ç±»å‹(reindex.ssl.keystore.path)ï¼Œå¿…é¡»æ˜¯jksæˆ–è€…PKCS12ï¼Œå¦‚æœreindex.ssl.keystore.pathçš„ç»“æŸæ˜¯â€.p12â€, â€œ.pfxâ€æˆ–è€…â€pkcs12â€ï¼Œé‚£ä¹ˆè¯¥é…ç½®çš„é»˜è®¤å€¼æ˜¯PKCS12ï¼Œå¦åˆ™é»˜è®¤å€¼æ˜¯jksã€‚reindex.ssl.keystore.passwordå¯†é’¥å­˜å‚¨åº“çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.secure_passwordä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.keystore.secure_passwordå¯†é’¥å­˜å‚¨åº“çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.passwordä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.keystore.key_passwordå¯†é’¥å­˜å‚¨åº“ä¸­å¯†é’¥çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œé»˜è®¤ä¸ºå¯†é’¥å­˜å‚¨åº“å¯†ç ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.secure_key_passwordä¸€èµ·ä½¿ç”¨ã€‚reindex.ssl.keystore.secure_key_passwordå¯†é’¥å­˜å‚¨åº“ä¸­å¯†é’¥çš„å¯†ç (reindex.ssl.keystore.path)ï¼Œé»˜è®¤ä¸ºå¯†é’¥å­˜å‚¨åº“å¯†ç ï¼Œæ­¤è®¾ç½®ä¸èƒ½ä¸reindex.ssl.keystore.key_passwordä¸€èµ·ä½¿ç”¨ã€‚ URLå‚æ•°é™¤äº†æ ‡å‡†çš„prettyå‚æ•°å¤–ï¼Œ reindexè¿˜æ”¯æŒrefresh, wait_for_completion, wait_for_active_shards, timeout, scrollå’Œrequests_per_secondã€‚å‘é€refresh urlå‚æ•°å°†å¯¼è‡´å¯¹æ‰€å†™è¯·æ±‚çš„æ‰€æœ‰ç´¢å¼•è¿›è¡Œåˆ·æ–°ï¼Œè¿™ä¸Index APIçš„refreshå‚æ•°ä¸åŒï¼Œåè€…åªä¼šåˆ·æ–°æ¥æ”¶æ–°æ•°æ®çš„ç¢ç‰‡ï¼Œä¸index APIä¸åŒçš„æ˜¯ï¼Œå®ƒä¸æ”¯æŒwait_forã€‚å¦‚æœè¯·æ±‚åŒ…å«wait_for_completion=falseï¼Œåˆ™Elasticsearchå°†æ‰§è¡Œä¸€äº›æ‰§è¡Œå‰æ£€æŸ¥ï¼Œå¯åŠ¨è¯·æ±‚ï¼Œç„¶åè¿”å›ä¸€ä¸ªä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡å¯ä¸Tasks apiä¸€èµ·ç”¨äºå–æ¶ˆæˆ–è·å–ä»»åŠ¡çŠ¶æ€ï¼ŒElasticsearchè¿˜å°†åˆ›å»ºæ­¤ä»»åŠ¡çš„è®°å½•ï¼Œä½œä¸º.tasks/task/${taskId}çš„æ–‡æ¡£ï¼Œä½ å¯ä»¥è‡ªå·±å†³å®šæ˜¯ä¿ç•™æˆ–è€…åˆ é™¤ä»–ï¼Œå½“ä½ å·²ç»å®Œæˆäº†ï¼Œåˆ é™¤ä»–ï¼Œè¿™æ ·esä¼šå›æ”¶ä»–ä½¿ç”¨çš„ç©ºé—´ã€‚wait_for_active_shardsæ§åˆ¶åœ¨è¿›è¡Œé‡æ–°ç´¢å¼•ä¹‹å‰å¿…é¡»æ¿€æ´»å¤šå°‘ä¸ªshardå‰¯æœ¬ï¼Œè¶…æ—¶æ§åˆ¶æ¯ä¸ªå†™è¯·æ±‚ç­‰å¾…ä¸å¯ç”¨ç¢ç‰‡å˜ä¸ºå¯ç”¨çš„æ—¶é—´ï¼Œä¸¤è€…åœ¨æ‰¹é‡APIä¸­çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒï¼Œç”±äº_reindexä½¿ç”¨æ»šåŠ¨æœç´¢ï¼Œä½ è¿˜å¯ä»¥æŒ‡å®šæ»šåŠ¨å‚æ•°æ¥æ§åˆ¶â€œæœç´¢ä¸Šä¸‹æ–‡â€å­˜æ´»çš„æ—¶é—´(ä¾‹å¦‚?scroll=10m)ï¼Œé»˜è®¤å€¼æ˜¯5åˆ†é’Ÿã€‚requests_per_secondå¯ä»¥è®¾ç½®ä¸ºä»»ä½•æ­£æ•°(1.4ã€6ã€1000ç­‰)ï¼Œå¹¶é€šè¿‡åœ¨æ¯ä¸ªæ‰¹ä¸­å¡«å……ç­‰å¾…æ—¶é—´æ¥æ§åˆ¶_reindexå‘å‡ºæ‰¹ç´¢å¼•æ“ä½œçš„é€Ÿç‡ï¼Œå¯ä»¥é€šè¿‡å°†requests_per_secondè®¾ç½®ä¸º-1æ¥ç¦ç”¨ã€‚èŠ‚æµæ˜¯é€šè¿‡åœ¨æ‰¹ä¹‹é—´ç­‰å¾…æ¥å®Œæˆçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç»™_reindexå†…éƒ¨ä½¿ç”¨çš„æ»šåŠ¨è®¾ç½®ä¸€ä¸ªè€ƒè™‘å¡«å……çš„è¶…æ—¶ï¼Œå¡«å……æ—¶é—´æ˜¯æ‰¹å¤§å°é™¤ä»¥requests_per_secondå’Œå†™å…¥æ—¶é—´ä¹‹é—´çš„å·®é¢ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰¹å¤„ç†å¤§å°ä¸º1000ï¼Œæ‰€ä»¥å¦‚æœrequests_per_secondè¢«è®¾ç½®ä¸º500ï¼š target_time = 1000 / 500 per second = 2 seconds padding time = target_time - write_time = 2 seconds - 0.5 seconds = 1.5 seconds ç”±äºæ‰¹å¤„ç†æ˜¯ä½œä¸ºå•ä¸ª_bulkè¯·æ±‚å‘å‡ºçš„ï¼Œå› æ­¤è¾ƒå¤§çš„æ‰¹å¤„ç†å¤§å°å°†å¯¼è‡´Elasticsearchåˆ›å»ºè®¸å¤šè¯·æ±‚ï¼Œç„¶åç­‰å¾…ä¸€æ®µæ—¶é—´å†å¯åŠ¨ä¸‹ä¸€ä¸ªè¯·æ±‚é›†ï¼Œè¿™æ˜¯â€œburstyâ€è€Œä¸æ˜¯â€œsmoothâ€ï¼Œé»˜è®¤å€¼æ˜¯-1ã€‚ å“åº”ä½“ 12345678910111213141516171819&#123; &quot;took&quot;: 639, &quot;timed_out&quot;: false, &quot;total&quot;: 5, &quot;updated&quot;: 0, &quot;created&quot;: 5, &quot;deleted&quot;: 0, &quot;batches&quot;: 1, &quot;noops&quot;: 0, &quot;version_conflicts&quot;: 2, &quot;retries&quot;: &#123; &quot;bulk&quot;: 0, &quot;search&quot;: 0 &#125;, &quot;throttled_millis&quot;: 0, &quot;requests_per_second&quot;: 1, &quot;throttled_until_millis&quot;: 0, &quot;failures&quot;: []&#125; tookæ•´ä¸ªæ“ä½œèŠ±è´¹çš„æ€»æ¯«ç§’æ•°ã€‚timed_outå¦‚æœåœ¨reindexæœŸé—´æ‰§è¡Œçš„ä»»ä½•è¯·æ±‚è¶…æ—¶ï¼Œåˆ™å°†æ­¤æ ‡å¿—è®¾ç½®ä¸ºtrueã€‚totalæˆåŠŸå¤„ç†çš„æ–‡æ¡£æ•°é‡ã€‚updatedæˆåŠŸæ›´æ–°çš„æ–‡æ¡£æ•°é‡ã€‚createdæˆåŠŸåˆ›å»ºçš„æ–‡æ¡£çš„æ•°é‡ã€‚deletedæˆåŠŸåˆ é™¤çš„æ–‡æ¡£æ•°é‡ã€‚batchesç”±reindexå›æ‹‰çš„æ»šåŠ¨å“åº”çš„æ•°é‡ã€‚noopsç”±äºç”¨äºreindexçš„è„šæœ¬è¿”å›äº†ctx.opçš„noopå€¼è€Œè¢«å¿½ç•¥çš„æ–‡æ¡£æ•°é‡ã€‚version_conflictsreindexå‘½ä¸­çš„ç‰ˆæœ¬å†²çªæ•°ã€‚retriesreindexå°è¯•é‡è¯•çš„æ¬¡æ•°,bulkæ˜¯é‡è¯•çš„æ‰¹é‡æ“ä½œçš„æ•°é‡ï¼Œsearchæ˜¯é‡è¯•çš„æœç´¢æ“ä½œçš„æ•°é‡ã€‚throttled_millisè¯·æ±‚ä¼‘çœ ä»¥ç¬¦åˆrequests_per_secondçš„æ¯«ç§’æ•°ã€‚requests_per_secondåœ¨reindexæœŸé—´æ¯ç§’æœ‰æ•ˆæ‰§è¡Œçš„è¯·æ±‚æ•°ã€‚throttled_until_millisåœ¨_reindexå“åº”ä¸­ï¼Œè¯¥å­—æ®µåº”è¯¥å§‹ç»ˆç­‰äºé›¶ï¼Œå®ƒåªæœ‰åœ¨ä½¿ç”¨ä»»åŠ¡APIæ—¶æ‰æœ‰æ„ä¹‰ï¼Œåœ¨ä»»åŠ¡APIä¸­ï¼Œå®ƒæŒ‡ç¤ºä¸‹ä¸€æ¬¡(æ¯«ç§’)å†æ¬¡æ‰§è¡ŒèŠ‚æµè¯·æ±‚ï¼Œä»¥ç¬¦åˆrequests_per_secondã€‚failureså‡ºç°å¤šä¸ªé”™è¯¯ä»¥æ•°ç»„è¿”å›ã€‚ ä½¿ç”¨task apiè·å–task 123456789curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&amp;wait_for_completion=false&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;new_twitter&quot; &#125;&#125;&#x27; è¿”å›å€¼ä¸º 123&#123; &quot;task&quot; : &quot;8uQK-B00RiWq03awtJok1Q:18&quot;&#125; ä½ å¯ä»¥ç”¨ä»»åŠ¡APIè·å–æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„reindexè¯·æ±‚çš„çŠ¶æ€ï¼šcurl -XGET &quot;http://127.0.0.1:9200/_tasks?detailed=true&amp;actions=*reindex&amp;pretty&quot;æˆ–è€…æ ¹æ®task idè·å–curl -XGET &quot;http://127.0.0.1:9200/_tasks/8uQK-B00RiWq03awtJok1Q:48?pretty&quot;è¿”å›å€¼ä¸ºï¼š 123456789101112131415161718192021222324252627282930313233343536&#123; &quot;completed&quot; : true, &quot;task&quot; : &#123; &quot;node&quot; : &quot;8uQK-B00RiWq03awtJok1Q&quot;, &quot;id&quot; : 48, &quot;type&quot; : &quot;transport&quot;, &quot;action&quot; : &quot;indices:data/write/reindex&quot;, &quot;status&quot; : &#123; &quot;total&quot; : 0, &quot;updated&quot; : 0, &quot;created&quot; : 0, &quot;deleted&quot; : 0, &quot;batches&quot; : 0, &quot;version_conflicts&quot; : 0, &quot;noops&quot; : 0, &quot;retries&quot; : &#123; &quot;bulk&quot; : 0, &quot;search&quot; : 0 &#125;, &quot;throttled_millis&quot; : 0, &quot;requests_per_second&quot; : 0.0, &quot;throttled_until_millis&quot; : 0 &#125;, &quot;description&quot; : &quot;reindex from [twitter] to [new_twitter][_doc]&quot;, &quot;start_time_in_millis&quot; : 1566216815832, &quot;running_time_in_nanos&quot; : 86829, &quot;cancellable&quot; : true, &quot;headers&quot; : &#123; &#125; &#125;, &quot;error&quot; : &#123; &quot;type&quot; : &quot;index_not_found_exception&quot;, &quot;reason&quot; : &quot;no such index [new_twitter] and [action.auto_create_index] ([twitter,index10,-index1*,+ind*,-myIndex]) doesn&#x27;t match&quot;, &quot;index_uuid&quot; : &quot;_na_&quot;, &quot;index&quot; : &quot;new_twitter&quot; &#125;&#125; å–æ¶ˆtaskä»»ä½•reindexæ¥å£éƒ½å¯ä»¥ä½¿ç”¨task cancel apiå–æ¶ˆï¼š 123456789101112131415 curl -XPOST &quot;http://127.0.0.1:9200/_tasks/8uQK-B00RiWq03awtJok1Q:48/_cancel?pretty&quot;&#123; &quot;node_failures&quot; : [ &#123; &quot;type&quot; : &quot;failed_node_exception&quot;, &quot;reason&quot; : &quot;Failed node [8uQK-B00RiWq03awtJok1Q]&quot;, &quot;node_id&quot; : &quot;8uQK-B00RiWq03awtJok1Q&quot;, &quot;caused_by&quot; : &#123; &quot;type&quot; : &quot;resource_not_found_exception&quot;, &quot;reason&quot; : &quot;task [8uQK-B00RiWq03awtJok1Q:48] doesn&#x27;t support cancellation&quot; &#125; &#125; ], &quot;nodes&quot; : &#123; &#125;&#125; å–æ¶ˆåº”è¯¥å¾ˆå¿«å‘ç”Ÿï¼Œä½†å¯èƒ½éœ€è¦å‡ ç§’é’Ÿï¼ŒTasks APIå°†ç»§ç»­åˆ—å‡ºä»»åŠ¡ï¼Œç›´åˆ°å®ƒé†’æ¥å–æ¶ˆè‡ªå·±ã€‚ rethrottleå¯ä»¥åœ¨urlä¸­ä½¿ç”¨_rethrottleï¼Œå¹¶ä½¿ç”¨requests_per_secondå‚æ•°æ¥è®¾ç½®èŠ‚æµï¼š 123456789101112131415curl -XPOST &quot;http://127.0.0.1:9200/_reindex/8uQK-B00RiWq03awtJok1Q:250/_rethrottle?requests_per_second=-1&amp;pretty&quot;&#123; &quot;node_failures&quot; : [ &#123; &quot;type&quot; : &quot;failed_node_exception&quot;, &quot;reason&quot; : &quot;Failed node [8uQK-B00RiWq03awtJok1Q]&quot;, &quot;node_id&quot; : &quot;8uQK-B00RiWq03awtJok1Q&quot;, &quot;caused_by&quot; : &#123; &quot;type&quot; : &quot;resource_not_found_exception&quot;, &quot;reason&quot; : &quot;task [8uQK-B00RiWq03awtJok1Q:250] is missing&quot; &#125; &#125; ], &quot;nodes&quot; : &#123; &#125;&#125; reindexæ”¹å˜å±æ€§åç§°_reindexå¯ä»¥é‡å‘½åå±æ€§åï¼Œå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å¦‚ä¸‹æ–‡æ¡£çš„ç´¢å¼•ï¼š 12345curl -XPOST &quot;http://127.0.0.1:9200/test/_doc/1?refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;text&quot;: &quot;words words&quot;, &quot;flag&quot;: &quot;foo&quot;&#125;&#x27; åœ¨reindexçš„æ—¶å€™æƒ³æŠŠflagä¿®æ”¹ä¸ºtagï¼Œç¤ºä¾‹å¦‚ï¼š 12345678910111213curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;order&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;order2&quot; &#125;, &quot;script&quot;: &#123; &quot;source&quot;: &quot;ctx._source.tag = ctx._source.remove(\\&quot;flag\\&quot;)&quot; &#125;&#125;&#x27; æŸ¥çœ‹order2çš„æ•°æ®ï¼š 123456789101112131415curl -XGET &quot;http://127.0.0.1:9200/order2/_doc/1?pretty&quot;&#123; &quot;_index&quot; : &quot;order2&quot;, &quot;_type&quot; : &quot;_doc&quot;, &quot;_id&quot; : &quot;1&quot;, &quot;_version&quot; : 1, &quot;_seq_no&quot; : 0, &quot;_primary_term&quot; : 1, &quot;found&quot; : true, &quot;_source&quot; : &#123; &quot;text&quot; : &quot;words words&quot;, &quot;tag&quot; : &quot;foo&quot; &#125;&#125; åˆ‡ç‰‡Reindexæ”¯æŒåˆ‡ç‰‡æ»šåŠ¨ï¼Œä»¥å¹¶è¡ŒåŒ–é‡æ–°ç´¢å¼•è¿‡ç¨‹ã€‚è¿™ç§å¹¶è¡ŒåŒ–å¯ä»¥æé«˜æ•ˆç‡ï¼Œå¹¶æä¾›ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•å°†è¯·æ±‚åˆ†è§£ä¸ºæ›´å°çš„éƒ¨åˆ† æ‰‹åŠ¨åˆ‡ç‰‡é€šè¿‡ä¸ºæ¯ä¸ªè¯·æ±‚æä¾›ä¸€ä¸ªç‰‡idå’Œç‰‡çš„æ€»æ•°ï¼Œæ‰‹å·¥åˆ‡ç‰‡ä¸€ä¸ªé‡ç´¢å¼•è¯·æ±‚ï¼š 123456789101112131415161718192021222324252627curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;order&quot;, &quot;slice&quot;: &#123; &quot;id&quot;: 0, &quot;max&quot;: 2 &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;order2&quot; &#125;&#125;&#x27;curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;order&quot;, &quot;slice&quot;: &#123; &quot;id&quot;: 1, &quot;max&quot;: 2 &#125; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;order2&quot; &#125;&#125;&#x27; ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥éªŒè¯ï¼š curl -XGET &quot;http://127.0.0.1:9200/_refresh?pretty&quot; curl -XPOST &quot;http://127.0.0.1:9200/order2/_search?size=0&amp;filter_path=hits.total&amp;pretty&quot; è¿”å›å€¼ä¸ºï¼š 123456789&#123; &quot;hits&quot; : &#123; &quot;total&quot; : &#123; &quot;value&quot; : 1, &quot;relation&quot; : &quot;eq&quot; &#125; &#125;&#125; è‡ªåŠ¨åˆ‡é¢ä½ è¿˜å¯ä»¥è®©_reindexä½¿ç”¨åˆ‡ç‰‡æ»šåŠ¨è‡ªåŠ¨å¹¶è¡ŒåŒ–_uidä¸Šçš„åˆ‡ç‰‡ï¼Œä½¿ç”¨slicesæŒ‡å®šè¦ä½¿ç”¨çš„ç‰‡æ•°: 12345678910curl -XPOST &quot;http://127.0.0.1:9200/_reindex?slices=5&amp;refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;order&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;order2&quot; &#125;&#125;&#x27; é€šè¿‡ä¸‹é¢è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼š 12345678910curl -XPOST &quot;http://127.0.0.1:9200/order2/_search?size=0&amp;filter_path=hits.total&amp;pretty&quot;&#123; &quot;hits&quot; : &#123; &quot;total&quot; : &#123; &quot;value&quot; : 1, &quot;relation&quot; : &quot;eq&quot; &#125; &#125;&#125; reindexå¤šä¸ªç´¢å¼•å¦‚æœæœ‰è®¸å¤šç´¢å¼•éœ€è¦reindexï¼Œé€šå¸¸æœ€å¥½ä¸€æ¬¡reindexä¸€ä¸ªç´¢å¼•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªglobæ¨¡å¼æ¥è·å–è®¸å¤šç´¢å¼•ã€‚è¿™æ ·ï¼Œå¦‚æœæœ‰ä»»ä½•é”™è¯¯ï¼Œå¯ä»¥åˆ é™¤éƒ¨åˆ†å®Œæˆçš„ç´¢å¼•å¹¶ä»è¯¥ç´¢å¼•é‡æ–°å¼€å§‹ï¼Œä»è€Œæ¢å¤è¯¥è¿‡ç¨‹ã€‚å®ƒè¿˜ä½¿å¹¶è¡ŒåŒ–è¿‡ç¨‹å˜å¾—ç›¸å½“ç®€å•ï¼šå°†ç´¢å¼•åˆ—è¡¨æ‹†åˆ†ä¸ºreindexå¹¶å¹¶è¡Œè¿è¡Œæ¯ä¸ªåˆ—è¡¨ã€‚å¯ä»¥ä½¿ç”¨ä¸€æ¬¡æ€§è„šæœ¬ï¼š 1234567891011for index in i1 i2 i3 i4 i5; do curl -HContent-Type:application/json -XPOST localhost:9200/_reindex?pretty -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;&#x27;$index&#x27;&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;&#x27;$index&#x27;-reindexed&quot; &#125; &#125;&#x27;done reindexæ¯æ—¥ç´¢å¼•å°½ç®¡æœ‰ä¸Šè¿°å»ºè®®ï¼Œä½ ä»ç„¶å¯ä»¥ç»“åˆä½¿ç”¨_reindexå’ŒPainlessæ¥reindexæ¯æ—¥ç´¢å¼•ï¼Œä»è€Œå°†æ–°æ¨¡æ¿åº”ç”¨äºç°æœ‰æ–‡æ¡£ã€‚å‡è®¾æœ‰ä»¥ä¸‹æ–‡ä»¶ç»„æˆçš„ç´¢å¼•: curl -XPUT &quot;http://127.0.0.1:9200/metricbeat-2016.05.30/_doc/1?refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d{â€œsystem.cpu.idle.pctâ€: 0.908}â€™ curl -XPUT &quot;http://127.0.0.1:9200/metricbeat-2016.05.31/_doc/1?refresh&amp;pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#39;{â€œsystem.cpu.idle.pctâ€: 0.105} metricbeat-*ç´¢å¼•çš„æ–°æ¨¡æ¿å·²ç»åŠ è½½åˆ°Elasticsearchä¸­ï¼Œä½†å®ƒåªé€‚ç”¨äºæ–°åˆ›å»ºçš„ç´¢å¼•ã€‚ä¸‹é¢çš„è„šæœ¬ä»ç´¢å¼•åç§°ä¸­æå–æ—¥æœŸï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé™„åŠ -1çš„æ–°ç´¢å¼•ã€‚æ‰€æœ‰æ¥è‡ªmetricbeat-2016.05.31çš„æ•°æ®å°†reindexåˆ°metricbeat-2016.05.31-1ã€‚ 1234567891011121314curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;source&quot;: &#123; &quot;index&quot;: &quot;metricbeat-*&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;metricbeat&quot; &#125;, &quot;script&quot;: &#123; &quot;lang&quot;: &quot;painless&quot;, &quot;source&quot;: &quot;ctx._index = &#x27;metricbeat-&#x27; + (ctx._index.substring(&#x27;metricbeat-&#x27;.length(),ctx._index.length())) + &#x27;-1&#x27;&quot; &#125;&#125;&#x27; ä»¥å‰metricbeatç´¢å¼•ä¸­çš„æ‰€æœ‰æ–‡æ¡£ç°åœ¨éƒ½å¯ä»¥åœ¨*-1ç´¢å¼•ä¸­æ‰¾åˆ°ã€‚ curl -XGET &quot;http://127.0.0.1:9200/metricbeat-2016.05.30-1/_doc/1?pretty&quot;curl -XGET &quot;http://127.0.0.1:9200/metricbeat-2016.05.31-1/_doc/1?pretty&quot; å‰ä¸€ç§æ–¹æ³•è¿˜å¯ä»¥ä¸æ›´æ”¹å­—æ®µåç§°ç»“åˆä½¿ç”¨ï¼Œä»¥ä¾¿ä»…å°†ç°æœ‰æ•°æ®åŠ è½½åˆ°æ–°ç´¢å¼•ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡å‘½åä»»ä½•å­—æ®µã€‚ æå–ç´¢å¼•ä¸­çš„å­é›†åˆ_reindexå¯ç”¨äºæå–ç´¢å¼•çš„éšæœºå­é›†è¿›è¡Œæµ‹è¯•ï¼š 123456789101112131415161718curl -XPOST &quot;http://127.0.0.1:9200/_reindex?pretty&quot; -H &quot;Content-Type:application/json&quot; -d&#x27;&#123; &quot;size&quot;: 10, &quot;source&quot;: &#123; &quot;index&quot;: &quot;twitter&quot;, &quot;query&quot;: &#123; &quot;function_score&quot; : &#123; &quot;query&quot; : &#123; &quot;match_all&quot;: &#123;&#125; &#125;, &quot;random_score&quot; : &#123;&#125; &#125; &#125;, &quot;sort&quot;: &quot;_score&quot; &#125;, &quot;dest&quot;: &#123; &quot;index&quot;: &quot;random_twitter&quot; &#125;&#125;&#x27; _reindexé»˜è®¤æŒ‰_docæ’åºï¼Œå› æ­¤random_scoreä¸ä¼šæœ‰ä»»ä½•æ•ˆæœï¼Œé™¤éä½ è¦†ç›–sortå±æ€§ä¸º_scoreã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"HttpçŠ¶æ€ç åŠå«ä¹‰","date":"2021-07-20T03:31:58.000Z","path":"wiki/HttpçŠ¶æ€ç åŠå«ä¹‰/","text":"httpçŠ¶æ€ç ç”±3ä¸ªåè¿›åˆ¶æ•°å­—ç»„æˆã€‚ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºçŠ¶æ€ç çš„åˆ†ç±»ï¼Œåé¢çš„ä¸¤ä½è¡¨ç¤ºè¯¥åˆ†ç±»ä¸‹ä¸åŒçš„çŠ¶æ€ã€‚åˆ†ä¸º5ä¸ªå¤§ç±»ã€‚ åˆ†ç±» 1** ä¿¡æ¯ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œè¯·ç»§ç»­æ‰§è¡Œè¯·æ±‚ 2** æˆåŠŸã€‚è¯·æ±‚è¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç† 3** é‡å®šå‘ã€‚éœ€è¦è¿›ä¸€æ­¥æ“ä½œæ¥å®Œæˆè¯·æ±‚ 4** å®¢æˆ·ç«¯é”™è¯¯ã€‚æ— æ³•å®Œæˆè¯·æ±‚ï¼Œæˆ–è¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯ 5** æœåŠ¡å™¨é”™è¯¯ã€‚æœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘æˆé”™è¯¯ å„ä¸ªçŠ¶æ€è¯´æ˜ 100ï¼š ç»§ç»­è¯·æ±‚è€…åº”å½“ç»§ç»­æå‡ºè¯·æ±‚ã€‚æœåŠ¡å™¨å·²æ”¶åˆ°è¯·æ±‚çš„ä¸€éƒ¨åˆ†ï¼Œæ­£åœ¨ç­‰å¾…å…¶ä½™éƒ¨åˆ†ã€‚ 101ï¼š åˆ‡æ¢åè®®è¯·æ±‚è€…å·²è¦æ±‚æœåŠ¡å™¨åˆ‡æ¢åè®®ï¼ŒæœåŠ¡å™¨å·²ç¡®è®¤å¹¶å‡†å¤‡åˆ‡æ¢ã€‚ 200ï¼š æˆåŠŸæœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ã€‚ 201ï¼š å·²åˆ›å»ºè¯·æ±‚æˆåŠŸå¹¶ä¸”æœåŠ¡å™¨åˆ›å»ºäº†æ–°çš„èµ„æºã€‚ 202ï¼š å·²æ¥å—æœåŠ¡å™¨å·²æ¥å—è¯·æ±‚ï¼Œä½†å°šæœªå¤„ç†ã€‚ 203ï¼š éæˆæƒä¿¡æ¯æœåŠ¡å™¨å·²æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå¦ä¸€æ¥æºã€‚ 204ï¼š æ— å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 205ï¼š é‡ç½®å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œå†…å®¹è¢«é‡ç½®ã€‚ 206ï¼š éƒ¨åˆ†å†…å®¹æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†è¯·æ±‚ã€‚ 300ï¼š å¤šç§é€‰æ‹©é’ˆå¯¹è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯æ‰§è¡Œå¤šç§æ“ä½œã€‚ 301ï¼š æ°¸ä¹…ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ï¼Œå³æ°¸ä¹…é‡å®šå‘ã€‚ 302ï¼š ä¸´æ—¶ç§»åŠ¨è¯·æ±‚çš„ç½‘é¡µæš‚æ—¶è·³è½¬åˆ°å…¶ä»–é¡µé¢ï¼Œå³æš‚æ—¶é‡å®šå‘ã€‚ 303ï¼š æŸ¥çœ‹å…¶ä»–ä½ç½®å¦‚æœåŸæ¥çš„è¯·æ±‚æ˜¯ POSTï¼Œé‡å®šå‘ç›®æ ‡æ–‡æ¡£åº”è¯¥é€šè¿‡ GET æå–ã€‚ 304ï¼š æœªä¿®æ”¹æ­¤æ¬¡è¯·æ±‚è¿”å›çš„ç½‘é¡µæœªä¿®æ”¹ï¼Œç»§ç»­ä½¿ç”¨ä¸Šæ¬¡çš„èµ„æºã€‚ 305ï¼š ä½¿ç”¨ä»£ç†è¯·æ±‚è€…åº”è¯¥ä½¿ç”¨ä»£ç†è®¿é—®è¯¥ç½‘é¡µã€‚ 307ï¼š ä¸´æ—¶é‡å®šå‘è¯·æ±‚çš„èµ„æºä¸´æ—¶ä»å…¶ä»–ä½ç½®å“åº”ã€‚ 400ï¼š é”™è¯¯è¯·æ±‚æœåŠ¡å™¨æ— æ³•è§£æè¯¥è¯·æ±‚ã€‚ 401ï¼š æœªæˆæƒè¯·æ±‚æ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯æˆ–éªŒè¯æœªé€šè¿‡ã€‚ 403ï¼š ç¦æ­¢è®¿é—®æœåŠ¡å™¨æ‹’ç»æ­¤è¯·æ±‚ã€‚ 404ï¼š æœªæ‰¾åˆ°æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„ç½‘é¡µã€‚ 405ï¼š æ–¹æ³•ç¦ç”¨æœåŠ¡å™¨ç¦ç”¨äº†è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹æ³•ã€‚ 406ï¼š ä¸æ¥å—æ— æ³•ä½¿ç”¨è¯·æ±‚çš„å†…å®¹å“åº”è¯·æ±‚çš„ç½‘é¡µã€‚ 407ï¼š éœ€è¦ä»£ç†æˆæƒè¯·æ±‚è€…éœ€è¦ä½¿ç”¨ä»£ç†æˆæƒã€‚ 408ï¼š è¯·æ±‚è¶…æ—¶æœåŠ¡å™¨è¯·æ±‚è¶…æ—¶ã€‚ 409ï¼š å†²çªæœåŠ¡å™¨åœ¨å®Œæˆè¯·æ±‚æ—¶å‘ç”Ÿå†²çªã€‚ 410ï¼š å·²åˆ é™¤è¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…åˆ é™¤ã€‚ 411ï¼š éœ€è¦æœ‰æ•ˆé•¿åº¦æœåŠ¡å™¨ä¸æ¥å—ä¸å«æœ‰æ•ˆå†…å®¹é•¿åº¦æ ‡å¤´å­—æ®µçš„è¯·æ±‚ã€‚ 412ï¼š æœªæ»¡è¶³å‰ææ¡ä»¶æœåŠ¡å™¨æœªæ»¡è¶³è¯·æ±‚è€…åœ¨è¯·æ±‚ä¸­è®¾ç½®çš„å…¶ä¸­ä¸€ä¸ªå‰ææ¡ä»¶ã€‚ 413ï¼š è¯·æ±‚å®ä½“è¿‡å¤§è¯·æ±‚å®ä½“è¿‡å¤§ï¼Œè¶…å‡ºæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ã€‚ 414ï¼š è¯·æ±‚ URI è¿‡é•¿è¯·æ±‚ç½‘å€è¿‡é•¿ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚ 415ï¼š ä¸æ”¯æŒç±»å‹è¯·æ±‚çš„æ ¼å¼ä¸å—è¯·æ±‚é¡µé¢çš„æ”¯æŒã€‚ 416ï¼š è¯·æ±‚èŒƒå›´ä¸ç¬¦é¡µé¢æ— æ³•æä¾›è¯·æ±‚çš„èŒƒå›´ã€‚ 417ï¼š æœªæ»¡è¶³æœŸæœ›å€¼æœåŠ¡å™¨æœªæ»¡è¶³æœŸæœ›è¯·æ±‚æ ‡å¤´å­—æ®µçš„è¦æ±‚ã€‚ 500ï¼š æœåŠ¡å™¨å†…éƒ¨é”™è¯¯æœåŠ¡å™¨é‡åˆ°é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚ã€‚ 501ï¼š æœªå®ç°æœåŠ¡å™¨ä¸å…·å¤‡å®Œæˆè¯·æ±‚çš„åŠŸèƒ½ã€‚ 502ï¼š é”™è¯¯ç½‘å…³æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°æ— æ•ˆå“åº”ã€‚ 503ï¼š æœåŠ¡ä¸å¯ç”¨æœåŠ¡å™¨ç›®å‰æ— æ³•ä½¿ç”¨ã€‚ 504ï¼š ç½‘å…³è¶…æ—¶æœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶ä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ã€‚ 505ï¼š HTTP ç‰ˆæœ¬ä¸æ”¯æŒæœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚ä¸­æ‰€ç”¨çš„ HTTP åè®®ç‰ˆæœ¬ã€‚","tags":[{"name":"http","slug":"http","permalink":"http://example.com/tags/http/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"HTTP","slug":"Computer-Network/HTTP","permalink":"http://example.com/categories/Computer-Network/HTTP/"}]},{"title":"æ“ä½œç³»ç»Ÿ-æ­»é”","date":"2021-07-20T03:29:18.000Z","path":"wiki/æ“ä½œç³»ç»Ÿ-æ­»é”/","text":"é€ æˆæ­»é”çš„åŸå› å½“å‰çº¿ç¨‹æ‹¥æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦çš„èµ„æºï¼Œå½“å‰çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹é‡Šæ”¾èµ„æºï¼Œçº¿ç¨‹æŒæœ‰èµ„æºä¸å¯å‰¥å¤ºï¼Œçº¿ç¨‹ä¸€ç›´å¾ªç¯ç­‰å¾…ã€‚ é¿å…æ­»é”çš„æ–¹æ³•1ã€å›ºå®šåŠ é”çš„é¡ºåº 2ã€å°½å¯èƒ½ç¼©å°é”èŒƒå›´ï¼Œå‡å°‘é”ç²’åº¦ 3ã€ä½¿ç”¨å¯é‡Šæ”¾çš„å®šæ—¶é”ï¼ˆç”³è¯·ä¸€æ®µæ—¶é—´ï¼Œè¶…æ—¶ä¹‹åï¼Œæ”¾å¼ƒï¼‰ å‚è€ƒèµ„æ–™ æ­»é”æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•é¿å…æ­»é”ï¼Ÿ å“²å­¦å®¶å°±é¤é—®é¢˜","tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"}],"categories":[{"name":"Linux System","slug":"Linux-System","permalink":"http://example.com/categories/Linux-System/"},{"name":"Process","slug":"Linux-System/Process","permalink":"http://example.com/categories/Linux-System/Process/"}]},{"title":"æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­–ç•¥","date":"2021-07-20T03:16:04.000Z","path":"wiki/æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­–ç•¥/","text":"æ“ä½œç³»ç»Ÿè¿›ç¨‹è°ƒåº¦ç­–ç•¥1. ä»€ä¹ˆæ˜¯è¿›ç¨‹è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰å®ƒè‡ªå·±çš„å†…å­˜ç©ºé—´å’Œç³»ç»Ÿèµ„æºã€‚è¿›ç¨‹å®ç°äº†å¤šå¤„ç†æœºç¯å¢ƒä¸‹è¿›ç¨‹è°ƒåº¦ï¼Œåˆ†æ´¾ï¼Œåˆ‡æ¢æ—¶ï¼Œéƒ½éœ€è¦èŠ±è´¹è¾ƒå¤§çš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼› ä¸ºäº†æå‡ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡ï¼Œå‡å°‘CPUçš„ç©ºè½¬æ—¶é—´å’Œè°ƒåº¦åˆ‡æ¢çš„æ—¶é—´ï¼Œä»¥ä¾¿äºç³»ç»Ÿçš„ç®¡ç†ï¼Œæ‰€ä»¥æœ‰äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œçº¿ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºè°ƒåº¦çš„æœ€å°å•ä½ã€‚ä¸€ä¸ªè¿›ç¨‹åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹å…±äº«è¿™ä¸ªè¿›ç¨‹çš„èµ„æºã€‚è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´çš„èµ„æºæ˜¯ä¸å…±äº«çš„ï¼Œçº¿ç¨‹å’Œçº¿ç¨‹ä¹‹é—´çš„èµ„æºä¹Ÿæ˜¯ä¸å…±äº«çš„ã€‚ å‚è€ƒèµ„æ–™ æ“ä½œç³»ç»Ÿä¸­çš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥æœ‰å“ªå‡ ç§","tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"}],"categories":[{"name":"Linux System","slug":"Linux-System","permalink":"http://example.com/categories/Linux-System/"},{"name":"Process","slug":"Linux-System/Process","permalink":"http://example.com/categories/Linux-System/Process/"}]},{"title":"è¿›ç¨‹é—´é€šä¿¡IPC","date":"2021-07-20T01:59:21.000Z","path":"wiki/è¿›ç¨‹é—´é€šä¿¡IPC/","text":"å‚è€ƒèµ„æ–™ è¿›ç¨‹é—´é€šä¿¡IPC (InterProcess Communication)","tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"}],"categories":[{"name":"Linux System","slug":"Linux-System","permalink":"http://example.com/categories/Linux-System/"},{"name":"Process","slug":"Linux-System/Process","permalink":"http://example.com/categories/Linux-System/Process/"}]},{"title":"elasticsearchç»Ÿè®¡æ¯å¹´æ¯å°æ—¶è®¿é—®é‡","date":"2021-07-19T14:53:39.000Z","path":"wiki/elasticsearchç»Ÿè®¡æ¯å¹´æ¯å°æ—¶è®¿é—®é‡/","text":"éœ€æ±‚èƒŒæ™¯ï¼Œè¦ç»Ÿè®¡æ–‡ç« åœ¨ä¸€å¹´çš„æ—¶é—´å†…ï¼Œæ¯ä¸ªå°æ—¶çš„è®¿é—®æƒ…å†µï¼ŒæŒ‰ç…§0ç‚¹ä¸¾ä¾‹å­ï¼Œæ¯ä¸ªæ–‡ç« ï¼Œä¸€å¹´å†…æ¯ä¸€å¤©0ç‚¹çš„è®¿é—®æ¬¡æ•°ç´¯åŠ èµ·æ¥ï¼› Elasticsearchç´¢å¼•å¦‚ä¸‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&#123; &quot;yj_visit_data&quot; : &#123; &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;_class&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125;, &quot;article&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125;, &quot;c&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;ip&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;p&quot; : &#123; &quot;type&quot; : &quot;keyword&quot; &#125;, &quot;ua&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125;, &quot;visitTime&quot; : &#123; &quot;type&quot; : &quot;date&quot; &#125; &#125; &#125; &#125;&#125; Java RestHighLevelClientå†™æ³•12345678910111213141516171819202122232425262728public void getDateDist() throws IOException &#123; SearchRequest searchRequest = new SearchRequest(); searchRequest.indices(&quot;yj_visit_data2&quot;); TermsAggregationBuilder termsAggregation = AggregationBuilders.terms(&quot;article&quot;) .field(&quot;article.keyword&quot;).size(2200) .subAggregation(AggregationBuilders.dateHistogram(&quot;visitTime&quot;) .field(&quot;visitTime&quot;) .calendarInterval(DateHistogramInterval.HOUR)); SearchSourceBuilder sourceBuilder = new SearchSourceBuilder(); sourceBuilder.aggregation(termsAggregation); sourceBuilder.query(QueryBuilders.rangeQuery(&quot;visitTime&quot;).gt(&quot;1609430400000&quot;).lte(&quot;1625068799000&quot;)); sourceBuilder.timeout(new TimeValue(900000)); SearchRequest request = new SearchRequest(); request.source(sourceBuilder); SearchResponse search = restHighLevelClient.search(request, RequestOptions.DEFAULT); Aggregations aggregations = search.getAggregations(); log.info(&quot;agg -&gt; &#123;&#125;&quot;, aggregations.asList().size()); List&lt;? extends Terms.Bucket&gt; buckets = ((ParsedStringTerms) aggregations.asList().get(0)).getBuckets(); List&lt;ArticleHourData&gt; hourDataList = new ArrayList&lt;&gt;(); for (Terms.Bucket bucket : buckets) &#123; List&lt;? extends Histogram.Bucket&gt; innerBuckets = ((ParsedDateHistogram) bucket.getAggregations().asList().get(0)).getBuckets(); hourDataList.add(calcBucket(innerBuckets, bucket.getKeyAsString())); &#125; log.info(&quot;result ----&gt; &#123;&#125;&quot;, JSONObject.toJSONString(hourDataList)); &#125; èšåˆåˆ†æ123456789101112131415161718192021public ArticleHourData calcBucket(List&lt;? extends Histogram.Bucket&gt; innerBuckets, String article) &#123; log.info(&quot;innerBuckets get(0) ---&gt; &#123;&#125;&quot;, JSON.toJSONString(innerBuckets.get(0))); Map&lt;String, ? extends List&lt;? extends Histogram.Bucket&gt;&gt; hourMap = innerBuckets.stream() .collect(Collectors.groupingBy(bucket -&gt; getHour(bucket.getKeyAsString()))); log.info(&quot;collect ======&gt; &#123;&#125; &quot;, JSONObject.toJSONString(hourMap.keySet())); ArticleHourData hourData = ArticleHourData.builder().article(article).build(); if (hourMap.isEmpty()) &#123; return hourData; &#125; HashMap&lt;String, Long&gt; hashMap = new HashMap&lt;&gt;(); for (String hour : hourMap.keySet()) &#123; List&lt;? extends Histogram.Bucket&gt; list = hourMap.get(hour); if (CollectionUtils.isEmpty(list)) &#123; continue; &#125; hashMap.put(hour, list.stream().mapToLong(Histogram.Bucket::getDocCount).sum()); &#125; hourData.setCountMap(hashMap); return hourData; &#125; è·å–æ—¶é—´çš„å°æ—¶123456789101112private String getHour(String date) &#123; date = date.replace(&quot;Z&quot;, &quot; UTC&quot;); SimpleDateFormat format = new SimpleDateFormat(&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS Z&quot;); Date d = null; try &#123; d = format.parse(date); &#125; catch (ParseException e) &#123; e.printStackTrace(); return null; &#125; return String.valueOf(DateUtil.asLocalDateTime(d).getHour()); &#125; Pythonå†™æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273from json.decoder import JSONDecoderfrom elasticsearch import Elasticsearchimport logging,jsonfrom datetime import datetimees = Elasticsearch([&#123;&#x27;host&#x27;:&#x27;39.107.117.232&#x27;,&#x27;port&#x27;:9200&#125;], http_auth=(&#x27;elastic&#x27;, &#x27;elastic&#x27;), timeout = 90000)sqs = &#123; &quot;size&quot; : 0, &quot;aggs&quot;: &#123; &quot;art&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;article.keyword&quot;, &quot;size&quot;: 5 &#125;, &quot;aggs&quot;: &#123; &quot;art_total&quot;: &#123; &quot;value_count&quot;: &#123; &quot;field&quot;: &quot;article.keyword&quot; &#125; &#125;, &quot;_time&quot;: &#123; &quot;date_histogram&quot;: &#123; &quot;field&quot;: &quot;visitTime&quot;, &quot;calendar_interval&quot;: &quot;hour&quot; &#125; &#125; &#125; &#125; &#125;&#125;_search_result = es.search(index=&quot;yj_visit_data2&quot; , body=sqs)_result_json = json.dumps(_search_result,sort_keys=True, indent=4, separators=(&#x27;, &#x27;, &#x27;: &#x27;), ensure_ascii=False)aggregations = _search_result[&#x27;aggregations&#x27;]art = aggregations[&#x27;art&#x27;]buckets = art[&#x27;buckets&#x27;]#print(type(buckets)) ; print(buckets)def getHour(time): return (int)(time[11:13])# è®¡ç®—æ¯ä¸ªå°æ—¶çš„ç‚¹å‡»æ•°def countByMonth(dataList , hourTar): _count = 0 for data in dataList: timestamp = data[&#x27;key_as_string&#x27;] hour = getHour(timestamp) if hour == hourTar: _count = (int)(data[&#x27;doc_count&#x27;]) + _count return _count final_list = []# å¾ªç¯è®¡ç®—æ¯ä¸€ä¸ªæ–‡ç« for outBucket in buckets: simple_result = &#123;&#125; _time = outBucket[&#x27;_time&#x27;] innerBuckets = _time[&#x27;buckets&#x27;] print(&quot;time inner bucker size&quot; , len(innerBuckets)) simple_list = [] for num in range(0,24): simple_list.append(countByMonth(innerBuckets,num)) simple_result[0] = outBucket[&#x27;key&#x27;] simple_result[1] = simple_list final_list.append(simple_result)print(&quot;final result ----&gt; &quot;,final_list)","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"elasticsearchè¸©å‘","date":"2021-07-19T09:46:59.000Z","path":"wiki/elasticsearchè¸©å‘/","text":"search.max_bucketsThis limit can be set by changing the [search.max_buckets] cluster level setting.]]; 123456PUT _cluster/settings&#123; &quot;persistent&quot;: &#123; &quot;search.max_buckets&quot;: 100000 &#125;&#125; Required one of fields [field, script][Elasticsearch exception [type=illegal_argument_exception, reason=Required one of fields [field, script], but none were specified. ] 123456789101112@Test public void test1() &#123; NativeSearchQuery nativeSearchQuery = new NativeSearchQuery(QueryBuilders.matchAllQuery(), null); Script script = new Script(&quot;doc[&#x27;article.keyword&#x27;]&quot;); nativeSearchQuery.addAggregation(AggregationBuilders.terms(&quot;art&quot;) .field(&quot;article.keyword&quot;).size(10) .subAggregation(AggregationBuilders.dateHistogram(&quot;visitTime&quot;) .field(&quot;visitTime&quot;) // è¿™ä¸€è¡Œæ²¡æœ‰å†™ .calendarInterval(DateHistogramInterval.HOUR))); SearchHits&lt;YjVisitData&gt; search = elasticsearchRestTemplate.search(nativeSearchQuery, YjVisitData.class); System.err.println(&quot;search.getAggregations().asList() &#123;&#125;&quot; + search.getAggregations().asList().size()); &#125;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"python3åŸºæœ¬æ•°æ®ç±»å‹","date":"2021-07-18T13:05:52.000Z","path":"wiki/pythonåŸºæœ¬æ•°æ®ç±»å‹/","text":"Python ä¸­çš„å˜é‡ä¸éœ€è¦å£°æ˜ã€‚æ¯ä¸ªå˜é‡åœ¨ä½¿ç”¨å‰éƒ½å¿…é¡»èµ‹å€¼ï¼Œå˜é‡èµ‹å€¼ä»¥åè¯¥å˜é‡æ‰ä¼šè¢«åˆ›å»ºã€‚ åœ¨ Python ä¸­ï¼Œå˜é‡å°±æ˜¯å˜é‡ï¼Œå®ƒæ²¡æœ‰ç±»å‹ï¼Œæˆ‘ä»¬æ‰€è¯´çš„â€ç±»å‹â€æ˜¯å˜é‡æ‰€æŒ‡çš„å†…å­˜ä¸­å¯¹è±¡çš„ç±»å‹ã€‚ ç­‰å·ï¼ˆ=ï¼‰ç”¨æ¥ç»™å˜é‡èµ‹å€¼ã€‚ ç­‰å·ï¼ˆ=ï¼‰è¿ç®—ç¬¦å·¦è¾¹æ˜¯ä¸€ä¸ªå˜é‡å,ç­‰å·ï¼ˆ=ï¼‰è¿ç®—ç¬¦å³è¾¹æ˜¯å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼ æ ‡å‡†æ•°æ®ç±»å‹Python3 ä¸­æœ‰å…­ä¸ªæ ‡å‡†çš„æ•°æ®ç±»å‹ï¼š Numberï¼ˆæ•°å­—ï¼‰ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ Listï¼ˆåˆ—è¡¨ï¼‰ Tupleï¼ˆå…ƒç»„ï¼‰ Setï¼ˆé›†åˆï¼‰ Dictionaryï¼ˆå­—å…¸ï¼‰ Python3 çš„å…­ä¸ªæ ‡å‡†æ•°æ®ç±»å‹ä¸­ï¼š ä¸å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼šNumberï¼ˆæ•°å­—ï¼‰ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Tupleï¼ˆå…ƒç»„ï¼‰ï¼›å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼šListï¼ˆåˆ—è¡¨ï¼‰ã€Dictionaryï¼ˆå­—å…¸ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€‚ Numberï¼ˆæ•°å­—ï¼‰Python3 æ”¯æŒ intã€floatã€boolã€complexï¼ˆå¤æ•°ï¼‰ã€‚ åœ¨Python 3é‡Œï¼Œåªæœ‰ä¸€ç§æ•´æ•°ç±»å‹ intï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œæ²¡æœ‰ python2 ä¸­çš„ Longã€‚ åƒå¤§å¤šæ•°è¯­è¨€ä¸€æ ·ï¼Œæ•°å€¼ç±»å‹çš„èµ‹å€¼å’Œè®¡ç®—éƒ½æ˜¯å¾ˆç›´è§‚çš„ã€‚ å†…ç½®çš„ type() å‡½æ•°å¯ä»¥ç”¨æ¥æŸ¥è¯¢å˜é‡æ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ã€‚ 123&gt;&gt;&gt; a, b, c, d = 20, 5.5, True, 4+3j&gt;&gt;&gt; print(type(a), type(b), type(c), type(d))&lt;class &#x27;int&#x27;&gt; &lt;class &#x27;float&#x27;&gt; &lt;class &#x27;bool&#x27;&gt; &lt;class &#x27;complex&#x27;&gt; æ­¤å¤–è¿˜å¯ä»¥ç”¨ isinstance æ¥åˆ¤æ–­ï¼š 1234&gt;&gt;&gt; a = 111&gt;&gt;&gt; isinstance(a, int)True&gt;&gt;&gt; âš ï¸ isinstance å’Œ type çš„åŒºåˆ«åœ¨äºï¼štype()ä¸ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚isinstance()ä¼šè®¤ä¸ºå­ç±»æ˜¯ä¸€ç§çˆ¶ç±»ç±»å‹ã€‚ âš ï¸ æ³¨æ„ï¼šPython3 ä¸­ï¼Œbool æ˜¯ int çš„å­ç±»ï¼ŒTrue å’Œ False å¯ä»¥å’Œæ•°å­—ç›¸åŠ  True==1ï¼ŒFalse==0 æ˜¯ä¼šè¿”å› Tureï¼Œä½†å¯ä»¥é€šè¿‡ is æ¥åˆ¤æ–­ç±»å‹ã€‚1ã€Pythonå¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå˜é‡èµ‹å€¼ï¼Œå¦‚a, b = 1, 2ã€‚2ã€ä¸€ä¸ªå˜é‡å¯ä»¥é€šè¿‡èµ‹å€¼æŒ‡å‘ä¸åŒç±»å‹çš„å¯¹è±¡ã€‚3ã€æ•°å€¼çš„é™¤æ³•åŒ…å«ä¸¤ä¸ªè¿ç®—ç¬¦ï¼š/ è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ// è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚4ã€åœ¨æ··åˆè®¡ç®—æ—¶ï¼ŒPythonä¼šæŠŠæ•´å‹è½¬æ¢æˆä¸ºæµ®ç‚¹æ•°ã€‚ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰Pythonä¸­çš„å­—ç¬¦ä¸²ç”¨å•å¼•å· â€˜ æˆ–åŒå¼•å· â€œ æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ä½¿ç”¨åæ–œæ  \\ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚å­—ç¬¦ä¸²çš„æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼šå˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚ Listï¼ˆåˆ—è¡¨ï¼‰Listï¼ˆåˆ—è¡¨ï¼‰ æ˜¯ Python ä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„æ•°æ®ç±»å‹ã€‚ åˆ—è¡¨å¯ä»¥å®Œæˆå¤§å¤šæ•°é›†åˆç±»çš„æ•°æ®ç»“æ„å®ç°ã€‚åˆ—è¡¨ä¸­å…ƒç´ çš„ç±»å‹å¯ä»¥ä¸ç›¸åŒï¼Œå®ƒæ”¯æŒæ•°å­—ï¼Œå­—ç¬¦ä¸²ç”šè‡³å¯ä»¥åŒ…å«åˆ—è¡¨ï¼ˆæ‰€è°“åµŒå¥—ï¼‰ã€‚ åˆ—è¡¨æ˜¯å†™åœ¨æ–¹æ‹¬å· [] ä¹‹é—´ã€ç”¨é€—å·åˆ†éš”å¼€çš„å…ƒç´ åˆ—è¡¨ã€‚ å’Œå­—ç¬¦ä¸²ä¸€æ ·ï¼Œåˆ—è¡¨åŒæ ·å¯ä»¥è¢«ç´¢å¼•å’Œæˆªå–ï¼Œåˆ—è¡¨è¢«æˆªå–åè¿”å›ä¸€ä¸ªåŒ…å«æ‰€éœ€å…ƒç´ çš„æ–°åˆ—è¡¨ã€‚ åˆ—è¡¨æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼šå˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚ Tupleï¼ˆå…ƒç»„ï¼‰å…ƒç»„ï¼ˆtupleï¼‰ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå…ƒç»„çš„å…ƒç´ ä¸èƒ½ä¿®æ”¹ã€‚å…ƒç»„å†™åœ¨å°æ‹¬å· () é‡Œï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚ å…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹ä¹Ÿå¯ä»¥ä¸ç›¸åŒï¼š 1234567891011#!/usr/bin/python3tuple = ( &#x27;abcd&#x27;, 786 , 2.23, &#x27;runoob&#x27;, 70.2 )tinytuple = (123, &#x27;runoob&#x27;)print (tuple) # è¾“å‡ºå®Œæ•´å…ƒç»„print (tuple[0]) # è¾“å‡ºå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ print (tuple[1:3]) # è¾“å‡ºä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ print (tuple[2:]) # è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰å…ƒç´ print (tinytuple * 2) # è¾“å‡ºä¸¤æ¬¡å…ƒç»„print (tuple + tinytuple) # è¿æ¥å…ƒç»„ Setï¼ˆé›†åˆï¼‰é›†åˆï¼ˆsetï¼‰æ˜¯ç”±ä¸€ä¸ªæˆ–æ•°ä¸ªå½¢æ€å„å¼‚çš„å¤§å°æ•´ä½“ç»„æˆçš„ï¼Œæ„æˆé›†åˆçš„äº‹ç‰©æˆ–å¯¹è±¡ç§°ä½œå…ƒç´ æˆ–æ˜¯æˆå‘˜ã€‚ åŸºæœ¬åŠŸèƒ½æ˜¯è¿›è¡Œæˆå‘˜å…³ç³»æµ‹è¯•å’Œåˆ é™¤é‡å¤å…ƒç´ ã€‚ å¯ä»¥ä½¿ç”¨å¤§æ‹¬å· { } æˆ–è€… set() å‡½æ•°åˆ›å»ºé›†åˆï¼Œæ³¨æ„ï¼šåˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ set() è€Œä¸æ˜¯ { }ï¼Œå› ä¸º { } æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ã€‚ åˆ›å»ºæ ¼å¼ï¼šparame = &#123;value01,value02,...&#125; æˆ–è€… set(value) 1234567891011121314151617181920212223242526#!/usr/bin/python3sites = &#123;&#x27;Google&#x27;, &#x27;Taobao&#x27;, &#x27;Runoob&#x27;, &#x27;Facebook&#x27;, &#x27;Zhihu&#x27;, &#x27;Baidu&#x27;&#125;print(sites) # è¾“å‡ºé›†åˆï¼Œé‡å¤çš„å…ƒç´ è¢«è‡ªåŠ¨å»æ‰# æˆå‘˜æµ‹è¯•if &#x27;Runoob&#x27; in sites : print(&#x27;Runoob åœ¨é›†åˆä¸­&#x27;)else : print(&#x27;Runoob ä¸åœ¨é›†åˆä¸­&#x27;)# setå¯ä»¥è¿›è¡Œé›†åˆè¿ç®—a = set(&#x27;abracadabra&#x27;)b = set(&#x27;alacazam&#x27;)print(a)print(a - b) # a å’Œ b çš„å·®é›†print(a | b) # a å’Œ b çš„å¹¶é›†print(a &amp; b) # a å’Œ b çš„äº¤é›†print(a ^ b) # a å’Œ b ä¸­ä¸åŒæ—¶å­˜åœ¨çš„å…ƒç´  Dictionaryï¼ˆå­—å…¸ï¼‰å­—å…¸ï¼ˆdictionaryï¼‰æ˜¯Pythonä¸­å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å†…ç½®æ•°æ®ç±»å‹ã€‚ åˆ—è¡¨æ˜¯æœ‰åºçš„å¯¹è±¡é›†åˆï¼Œå­—å…¸æ˜¯æ— åºçš„å¯¹è±¡é›†åˆã€‚ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šå­—å…¸å½“ä¸­çš„å…ƒç´ æ˜¯é€šè¿‡é”®æ¥å­˜å–çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡åç§»å­˜å–ã€‚ å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå­—å…¸ç”¨ { } æ ‡è¯†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— åºçš„ é”®(key) : å€¼(value) çš„é›†åˆã€‚ é”®(key)å¿…é¡»ä½¿ç”¨ä¸å¯å˜ç±»å‹ã€‚ åœ¨åŒä¸€ä¸ªå­—å…¸ä¸­ï¼Œé”®(key)å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ #!/usr/bin/python3 dict = &#123;&#125; dict[&#39;one&#39;] = &quot;1 - èœé¸Ÿæ•™ç¨‹&quot; dict[2] = &quot;2 - èœé¸Ÿå·¥å…·&quot; tinydict = &#123;&#39;name&#39;: &#39;runoob&#39;,&#39;code&#39;:1, &#39;site&#39;: &#39;www.runoob.com&#39;&#125; print (dict[&#39;one&#39;]) # è¾“å‡ºé”®ä¸º &#39;one&#39; çš„å€¼ print (dict[2]) # è¾“å‡ºé”®ä¸º 2 çš„å€¼ print (tinydict) # è¾“å‡ºå®Œæ•´çš„å­—å…¸ print (tinydict.keys()) # è¾“å‡ºæ‰€æœ‰é”® print (tinydict.values()) # è¾“å‡ºæ‰€æœ‰å€¼ æ³¨æ„ï¼š1ã€å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå®ƒçš„å…ƒç´ æ˜¯é”®å€¼å¯¹ã€‚2ã€å­—å…¸çš„å…³é”®å­—å¿…é¡»ä¸ºä¸å¯å˜ç±»å‹ï¼Œä¸”ä¸èƒ½é‡å¤ã€‚3ã€åˆ›å»ºç©ºå­—å…¸ä½¿ç”¨ { }ã€‚ Pythonæ•°æ®ç±»å‹è½¬æ¢æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®å†…ç½®çš„ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä½ åªéœ€è¦å°†æ•°æ®ç±»å‹ä½œä¸ºå‡½æ•°åå³å¯ã€‚ ä»¥ä¸‹å‡ ä¸ªå†…ç½®çš„å‡½æ•°å¯ä»¥æ‰§è¡Œæ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚è¿™äº›å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¡¨ç¤ºè½¬æ¢çš„å€¼ã€‚","tags":[{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Python","slug":"Develop-Lan/Python","permalink":"http://example.com/categories/Develop-Lan/Python/"}]},{"title":"python3åŸºç¡€è¯­æ³•","date":"2021-07-18T12:31:55.000Z","path":"wiki/python3åŸºç¡€è¯­æ³•/","text":"ç¼–ç é»˜è®¤æƒ…å†µä¸‹ï¼ŒPython 3 æºç æ–‡ä»¶ä»¥ UTF-8 ç¼–ç ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯ unicode å­—ç¬¦ä¸²ã€‚ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ºæºç æ–‡ä»¶æŒ‡å®šä¸åŒçš„ç¼–ç ï¼š# -*- coding: cp-1252 -*- æ ‡è¯†ç¬¦ ç¬¬ä¸€ä¸ªå­—ç¬¦å¿…é¡»æ˜¯å­—æ¯è¡¨ä¸­å­—æ¯æˆ–ä¸‹åˆ’çº¿ _ ã€‚ æ ‡è¯†ç¬¦çš„å…¶ä»–çš„éƒ¨åˆ†ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆã€‚ æ ‡è¯†ç¬¦å¯¹å¤§å°å†™æ•æ„Ÿã€‚åœ¨ Python 3 ä¸­ï¼Œå¯ä»¥ç”¨ä¸­æ–‡ä½œä¸ºå˜é‡åï¼Œé ASCII æ ‡è¯†ç¬¦ä¹Ÿæ˜¯å…è®¸çš„äº†ã€‚ pythonä¿ç•™å­—import keywordkeyword.kwlist[â€˜Falseâ€™, â€˜Noneâ€™, â€˜Trueâ€™, â€˜andâ€™, â€˜asâ€™, â€˜assertâ€™, â€˜breakâ€™, â€˜classâ€™, â€˜continueâ€™, â€˜defâ€™, â€˜delâ€™, â€˜elifâ€™, â€˜elseâ€™, â€˜exceptâ€™, â€˜finallyâ€™, â€˜forâ€™, â€˜fromâ€™, â€˜globalâ€™, â€˜ifâ€™, â€˜importâ€™, â€˜inâ€™, â€˜isâ€™, â€˜lambdaâ€™, â€˜nonlocalâ€™, â€˜notâ€™, â€˜orâ€™, â€˜passâ€™, â€˜raiseâ€™, â€˜returnâ€™, â€˜tryâ€™, â€˜whileâ€™, â€˜withâ€™, â€˜yieldâ€™] æ³¨é‡ŠPythonä¸­å•è¡Œæ³¨é‡Šä»¥ # å¼€å¤´,å¤šè¡Œæ³¨é‡Šå¯ä»¥ç”¨å¤šä¸ª # å·ï¼Œè¿˜æœ‰ â€˜â€™â€™ å’Œ â€œâ€â€ï¼š è¡Œä¸ç¼©è¿›pythonæœ€å…·ç‰¹è‰²çš„å°±æ˜¯ä½¿ç”¨ç¼©è¿›æ¥è¡¨ç¤ºä»£ç å—ï¼Œä¸éœ€è¦ä½¿ç”¨å¤§æ‹¬å· {} ã€‚ç¼©è¿›çš„ç©ºæ ¼æ•°æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯åŒä¸€ä¸ªä»£ç å—çš„è¯­å¥å¿…é¡»åŒ…å«ç›¸åŒçš„ç¼©è¿›ç©ºæ ¼æ•°ã€‚ å¤šè¡Œè¯­å¥Python é€šå¸¸æ˜¯ä¸€è¡Œå†™å®Œä¸€æ¡è¯­å¥ï¼Œä½†å¦‚æœè¯­å¥å¾ˆé•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åæ–œæ  \\ æ¥å®ç°å¤šè¡Œè¯­å¥ï¼Œä¾‹å¦‚ï¼š 123total = item_one + \\ item_two + \\ item_three åœ¨ [], {}, æˆ– () ä¸­çš„å¤šè¡Œè¯­å¥ï¼Œä¸éœ€è¦ä½¿ç”¨åæ–œæ  \\ï¼Œä¾‹å¦‚ï¼š total = [&#39;item_one&#39;, &#39;item_two&#39;, &#39;item_three&#39;, &#39;item_four&#39;, &#39;item_five&#39;] æ•°å­—(Number)ç±»å‹pythonä¸­æ•°å­—æœ‰å››ç§ç±»å‹ï¼šæ•´æ•°ã€å¸ƒå°”å‹ã€æµ®ç‚¹æ•°å’Œå¤æ•°ã€‚ int (æ•´æ•°) , å¦‚ 1, åªæœ‰ä¸€ç§æ•´æ•°ç±»å‹ intï¼Œè¡¨ç¤ºä¸ºé•¿æ•´å‹ï¼Œæ²¡æœ‰ python2 ä¸­çš„ Longã€‚ bool (å¸ƒå°”), å¦‚ Trueã€‚ float (æµ®ç‚¹æ•°), å¦‚ 1.23ã€3E-2 complex (å¤æ•°), å¦‚ 1 + 2jã€ 1.1 + 2.2j å­—ç¬¦ä¸²(String) pythonä¸­å•å¼•å·å’ŒåŒå¼•å·ä½¿ç”¨å®Œå…¨ç›¸åŒã€‚ ä½¿ç”¨ä¸‰å¼•å·(â€˜â€™â€™ æˆ– â€œâ€â€)å¯ä»¥æŒ‡å®šä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²ã€‚ è½¬ä¹‰ç¬¦ \\ åæ–œæ å¯ä»¥ç”¨æ¥è½¬ä¹‰ï¼Œä½¿ç”¨rå¯ä»¥è®©åæ–œæ ä¸å‘ç”Ÿè½¬ä¹‰ã€‚ã€‚ å¦‚ râ€this is a line with \\nâ€ åˆ™\\nä¼šæ˜¾ç¤ºï¼Œå¹¶ä¸æ˜¯æ¢è¡Œã€‚ æŒ‰å­—é¢æ„ä¹‰çº§è”å­—ç¬¦ä¸²ï¼Œå¦‚â€this â€œ â€œis â€œ â€œstringâ€ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºthis is stringã€‚ å­—ç¬¦ä¸²å¯ä»¥ç”¨ + è¿ç®—ç¬¦è¿æ¥åœ¨ä¸€èµ·ï¼Œç”¨ * è¿ç®—ç¬¦é‡å¤ã€‚ Python ä¸­çš„å­—ç¬¦ä¸²æœ‰ä¸¤ç§ç´¢å¼•æ–¹å¼ï¼Œä»å·¦å¾€å³ä»¥ 0 å¼€å§‹ï¼Œä»å³å¾€å·¦ä»¥ -1 å¼€å§‹ã€‚ Pythonä¸­çš„å­—ç¬¦ä¸²ä¸èƒ½æ”¹å˜ã€‚ Python æ²¡æœ‰å•ç‹¬çš„å­—ç¬¦ç±»å‹ï¼Œä¸€ä¸ªå­—ç¬¦å°±æ˜¯é•¿åº¦ä¸º 1 çš„å­—ç¬¦ä¸²ã€‚ å­—ç¬¦ä¸²çš„æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼šå˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡:æ­¥é•¿] ç©ºè¡Œå‡½æ•°ä¹‹é—´æˆ–ç±»çš„æ–¹æ³•ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ï¼Œè¡¨ç¤ºä¸€æ®µæ–°çš„ä»£ç çš„å¼€å§‹ã€‚ç±»å’Œå‡½æ•°å…¥å£ä¹‹é—´ä¹Ÿç”¨ä¸€è¡Œç©ºè¡Œåˆ†éš”ï¼Œä»¥çªå‡ºå‡½æ•°å…¥å£çš„å¼€å§‹ã€‚ ç©ºè¡Œä¸ä»£ç ç¼©è¿›ä¸åŒï¼Œç©ºè¡Œå¹¶ä¸æ˜¯Pythonè¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚ä¹¦å†™æ—¶ä¸æ’å…¥ç©ºè¡Œï¼ŒPythonè§£é‡Šå™¨è¿è¡Œä¹Ÿä¸ä¼šå‡ºé”™ã€‚ä½†æ˜¯ç©ºè¡Œçš„ä½œç”¨åœ¨äºåˆ†éš”ä¸¤æ®µä¸åŒåŠŸèƒ½æˆ–å«ä¹‰çš„ä»£ç ï¼Œä¾¿äºæ—¥åä»£ç çš„ç»´æŠ¤æˆ–é‡æ„ã€‚ è®°ä½ï¼šç©ºè¡Œä¹Ÿæ˜¯ç¨‹åºä»£ç çš„ä¸€éƒ¨åˆ†ã€‚ åŒä¸€è¡Œæ˜¾ç¤ºå¤šæ¡è¯­å¥Python å¯ä»¥åœ¨åŒä¸€è¡Œä¸­ä½¿ç”¨å¤šæ¡è¯­å¥ï¼Œè¯­å¥ä¹‹é—´ä½¿ç”¨åˆ†å· ; åˆ†å‰²ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼š 12#!/usr/bin/python3import sys; x = &#x27;runoob&#x27;; sys.stdout.write(x + &#x27;\\n&#x27;) å¤šä¸ªè¯­å¥æ„æˆä»£ç ç»„ç¼©è¿›ç›¸åŒçš„ä¸€ç»„è¯­å¥æ„æˆä¸€ä¸ªä»£ç å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä»£ç ç»„ã€‚ åƒifã€whileã€defå’Œclassè¿™æ ·çš„å¤åˆè¯­å¥ï¼Œé¦–è¡Œä»¥å…³é”®å­—å¼€å§‹ï¼Œä»¥å†’å·( : )ç»“æŸï¼Œè¯¥è¡Œä¹‹åçš„ä¸€è¡Œæˆ–å¤šè¡Œä»£ç æ„æˆä»£ç ç»„ã€‚ æˆ‘ä»¬å°†é¦–è¡ŒåŠåé¢çš„ä»£ç ç»„ç§°ä¸ºä¸€ä¸ªå­å¥(clause)ã€‚ å¦‚ä¸‹å®ä¾‹ï¼š 12345678910111213141516171819202122232425if expression : suiteelif expression : suite else : suite``` ## print è¾“å‡ºprint é»˜è®¤è¾“å‡ºæ˜¯æ¢è¡Œçš„ï¼Œå¦‚æœè¦å®ç°ä¸æ¢è¡Œéœ€è¦åœ¨å˜é‡æœ«å°¾åŠ ä¸Š end=&quot;&quot;ï¼š## import ä¸ from...importåœ¨ python ç”¨ import æˆ–è€… from...import æ¥å¯¼å…¥ç›¸åº”çš„æ¨¡å—ã€‚å°†æ•´ä¸ªæ¨¡å—(somemodule)å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š import somemoduleä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥æŸä¸ªå‡½æ•°,æ ¼å¼ä¸ºï¼š from somemodule import somefunctionä»æŸä¸ªæ¨¡å—ä¸­å¯¼å…¥å¤šä¸ªå‡½æ•°,æ ¼å¼ä¸ºï¼š from somemodule import firstfunc, secondfunc, thirdfuncå°†æŸä¸ªæ¨¡å—ä¸­çš„å…¨éƒ¨å‡½æ•°å¯¼å…¥ï¼Œæ ¼å¼ä¸ºï¼š from somemodule import *## å‘½ä»¤è¡Œå‚æ•°å¾ˆå¤šç¨‹åºå¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œæ¥æŸ¥çœ‹ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒPythonå¯ä»¥ä½¿ç”¨-hå‚æ•°æŸ¥çœ‹å„å‚æ•°å¸®åŠ©ä¿¡æ¯ï¼š $ python -husage: python [option] â€¦ [-c cmd | -m mod | file | -] [arg] â€¦Options and arguments (and corresponding environment variables):-c cmd : program passed in as string (terminates option list)-d : debug output from parser (also PYTHONDEBUG=x)-E : ignore environment variables (such as PYTHONPATH)-h : print this help message and exit [ etc. ] ```æˆ‘ä»¬åœ¨ä½¿ç”¨è„šæœ¬å½¢å¼æ‰§è¡Œ Python æ—¶ï¼Œå¯ä»¥æ¥æ”¶å‘½ä»¤è¡Œè¾“å…¥çš„å‚æ•°;","tags":[{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Python","slug":"Develop-Lan/Python","permalink":"http://example.com/categories/Develop-Lan/Python/"}]},{"title":"pythonæ“ä½œelasticsearch","date":"2021-07-18T12:20:25.000Z","path":"wiki/pythonæ“ä½œelasticsearch/","text":"ä¸‹è½½pythonå¯¹åº”çš„elasticsearchä¾èµ–åŒ…pip3 install elasticsearch==7.10.0 pythonæ“ä½œelasticsearchä»£ç 1234567from elasticsearch import Elasticsearchprint(&quot;init ...&quot;)es = Elasticsearch([&#123;&#x27;host&#x27;:&#x27;XXXXXX&#x27;,&#x27;port&#x27;:9200&#125;], http_auth=(&#x27;elastic&#x27;, &#x27;XXXXXX&#x27;))# print(es.get(index=&#x27;yj_ip_pool&#x27;, doc_type=&#x27;_doc&#x27;, id=&#x27;9256058&#x27;))countRes = es.count(index=&#x27;yj_ip_pool&#x27;)print(countRes) æŸ¥è¯¢æ•ˆæœ12345gaolei:awesome-python3-webapp gaolei$ /usr/local/opt/python/bin/python3.7 /Users/gaolei/Documents/DemoProjects/awesome-python3-webapp/www/es_test.pyinit ...&#123;&#x27;count&#x27;: 20095400, &#x27;_shards&#x27;: &#123;&#x27;total&#x27;: 1, &#x27;successful&#x27;: 1, &#x27;skipped&#x27;: 0, &#x27;failed&#x27;: 0&#125;&#125;gaolei:awesome-python3-webapp gaolei$","tags":[{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Python","slug":"Develop-Lan/Python","permalink":"http://example.com/categories/Develop-Lan/Python/"}]},{"title":"kibanaæ·»åŠ ç”¨æˆ·åŠæ§åˆ¶æƒé™","date":"2021-07-15T15:53:44.000Z","path":"wiki/kibanaæ·»åŠ ç”¨æˆ·åŠæ§åˆ¶æƒé™/","text":"æ“ä½œæ­¥éª¤ï¼š ã€ä¿®æ”¹elasticsearché…ç½®æ–‡ä»¶ã€‘ -&gt; ã€é‡å¯elasticsearchã€‘ -&gt; ã€åˆå§‹åŒ–è´¦å·&amp;å¯†ç ã€‘ -&gt; ã€ä¿®æ”¹kibanaé…ç½®æ–‡ä»¶ã€‘ -&gt; ã€é‡å¯kibanaã€‘ -&gt; ã€åˆå§‹è´¦å·ç™»å½•kibanaã€‘ -&gt; ã€åˆ›å»ºã€é…ç½®è§’è‰²ã€‘ -&gt; ã€åˆ›å»ºæ–°ç”¨æˆ·ã€‘ é…ç½®elasticsearchå¼€å¯è‡ªå¸¦çš„xpackçš„éªŒè¯åŠŸèƒ½xpack.security.enabled: true é…ç½®å•èŠ‚ç‚¹æ¨¡å¼discovery.type: single-node å‘1: é›†ç¾¤èŠ‚ç‚¹é…ç½®æŠ¥é”™cluster.initial_master_nodes å‘2: æœ¬æ¬¡å­˜å‚¨èŠ‚ç‚¹é…ç½®æŠ¥é”™maybe these locations are not writable or multiple nodes were started without increasing [node.max_local_storage_nodes] (was [1])?node.max_local_storage_nodes: 2 ä¸ºå†…ç½®è´¦å·è®¾ç½®å¯†ç åœ¨elasticsearchçš„binä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š./elasticsearch-setup-passwords interactive é…ç½®kibana123#ä½¿ç”¨åˆå§‹ç”¨æˆ·kibanaelasticsearch.username: &quot;kibana_system&quot;elasticsearch.password: &quot;å¯†ç &quot; é‡å¯kibanaä¹‹åä½¿ç”¨åˆå§‹è´¦å· elastic ç™»å½• åˆ›å»ºã€é…ç½®è§’è‰² åˆ›å»ºæ–°ç”¨æˆ· æŸ¥çœ‹æ–°ç”¨æˆ·è®¿é—®ç•Œé¢è§’è‰²é‡Œé¢é…ç½®äº†kibanaçš„è®¿é—®æƒé™ï¼Œåªå¼€é€šäº†discoverå’Œdashboardä¸¤ä¸ªå…¥å£ ç´¢å¼•çš„è¯ï¼Œæœ‰å¥½å‡ ä¸ªç´¢å¼•ï¼Œä½†æ˜¯åªé…ç½®äº†ä¸€ä¸ªç´¢å¼•çš„æƒé™ å‚è€ƒèµ„æ–™ kibana7.2æ·»åŠ ç™»å½•åŠæƒé™ Elasticsearch å®‰è£…","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"elasticsearchç¨³å®šæ€§è°ƒä¼˜","date":"2021-07-15T07:22:49.000Z","path":"wiki/elasticsearchç¨³å®šæ€§è°ƒä¼˜/","text":"Elasticsearchæ€§èƒ½ä¼˜åŒ–æ€»ç»“Elasticsearchè°ƒä¼˜å®è·µ ç¨³å®šæ€§è°ƒä¼˜ä¸€ Linuxå‚æ•°è°ƒä¼˜ ä¿®æ”¹ç³»ç»Ÿèµ„æºé™åˆ¶ ğŸ‘‡å•ç”¨æˆ·å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é‡ï¼Œå¯ä»¥è®¾ç½®ä¸ºå®˜æ–¹æ¨èçš„65536æˆ–æ›´å¤§äº› echo &quot;* - nofile 655360&quot; &gt;&gt;/etc/security/limits.confå•ç”¨æˆ·å†…å­˜åœ°å€ç©ºé—´ echo &quot;* - as unlimited&quot; &gt;&gt;/etc/security/limits.confå•ç”¨æˆ·çº¿ç¨‹æ•° echo &quot;* - nproc 2056474&quot; &gt;&gt;/etc/security/limits.confå•ç”¨æˆ·æ–‡ä»¶å¤§å° echo &quot;* - fsize unlimited&quot; &gt;&gt;/etc/security/limits.confå•ç”¨æˆ·é”å®šå†…å­˜ echo &quot;* - memlock unlimited&quot; &gt;&gt;/etc/security/limits.confå•è¿›ç¨‹å¯ä»¥ä½¿ç”¨çš„æœ€å¤§mapå†…å­˜åŒºåŸŸæ•°é‡ echo &quot;vm.max_map_count = 655300&quot; &gt;&gt;/etc/sysctl.confTCPå…¨è¿æ¥é˜Ÿåˆ—å‚æ•°è®¾ç½®ï¼Œ è¿™æ ·è®¾ç½®çš„ç›®çš„æ˜¯é˜²æ­¢èŠ‚ç‚¹æ•°è¾ƒå¤šï¼ˆæ¯”å¦‚è¶…è¿‡100ï¼‰çš„ESé›†ç¾¤ä¸­ï¼ŒèŠ‚ç‚¹å¼‚å¸¸é‡å¯æ—¶å…¨è¿æ¥é˜Ÿåˆ—åœ¨å¯åŠ¨ç¬é—´æ‰“æ»¡ï¼Œé€ æˆèŠ‚ç‚¹hangä½ï¼Œæ•´ä¸ªé›†ç¾¤å“åº”è¿Ÿæ»çš„æƒ…å†µecho &quot;net.ipv4.tcp_abort_on_overflow = 1&quot; &gt;&gt;/etc/sysctl.conf echo &quot;net.core.somaxconn = 2048&quot; &gt;&gt;/etc/sysctl.confé™ä½tcp alive timeï¼Œé˜²æ­¢æ— æ•ˆé“¾æ¥å ç”¨é“¾æ¥æ•° echo 300 &gt;/proc/sys/net/ipv4/tcp_keepalive_time ESèŠ‚ç‚¹é…ç½®jvm.options-Xmså’Œ-Xmxè®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œæ¨èè®¾ç½®ä¸ºæœºå™¨å†…å­˜çš„ä¸€åŠå·¦å³ï¼Œå‰©ä½™ä¸€åŠç•™ç»™ç³»ç»Ÿcacheä½¿ç”¨ã€‚ jvmå†…å­˜å»ºè®®ä¸è¦ä½äº2Gï¼Œå¦åˆ™æœ‰å¯èƒ½å› ä¸ºå†…å­˜ä¸è¶³å¯¼è‡´ESæ— æ³•æ­£å¸¸å¯åŠ¨æˆ–OOMjvmå»ºè®®ä¸è¦è¶…è¿‡32Gï¼Œå¦åˆ™jvmä¼šç¦ç”¨å†…å­˜å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯ï¼Œé€ æˆå†…å­˜æµªè´¹ elasticsearch.ymlè®¾ç½®å†…å­˜ç†”æ–­å‚æ•°ï¼Œé˜²æ­¢å†™å…¥æˆ–æŸ¥è¯¢å‹åŠ›è¿‡é«˜å¯¼è‡´OOMï¼Œå…·ä½“æ•°å€¼å¯æ ¹æ®ä½¿ç”¨åœºæ™¯è°ƒæ•´ã€‚indices.breaker.total.limit: 30% indices.breaker.request.limit: 6% indices.breaker.fielddata.limit: 3% è°ƒå°æŸ¥è¯¢ä½¿ç”¨çš„cacheï¼Œé¿å…cacheå ç”¨è¿‡å¤šçš„jvmå†…å­˜ï¼Œå…·ä½“æ•°å€¼å¯æ ¹æ®ä½¿ç”¨åœºæ™¯è°ƒæ•´ã€‚indices.queries.cache.count: 500 indices.queries.cache.size: 5% å•æœºå¤šèŠ‚ç‚¹æ—¶ï¼Œä¸»ä»shardåˆ†é…ä»¥ipä¸ºä¾æ®ï¼Œåˆ†é…åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œé¿å…å•æœºæŒ‚æ‰å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚cluster.routing.allocation.awareness.attributes: ip node.attr.ip: 1.1.1.1 ESä½¿ç”¨æ–¹å¼èŠ‚ç‚¹æ•°è¾ƒå¤šçš„é›†ç¾¤ï¼Œå¢åŠ ä¸“æœ‰masterï¼Œæå‡é›†ç¾¤ç¨³å®šæ€§ESé›†ç¾¤çš„å…ƒä¿¡æ¯ç®¡ç†ã€indexçš„å¢åˆ æ“ä½œã€èŠ‚ç‚¹çš„åŠ å…¥å‰”é™¤ç­‰é›†ç¾¤ç®¡ç†çš„ä»»åŠ¡éƒ½æ˜¯ç”±masterèŠ‚ç‚¹æ¥è´Ÿè´£çš„ï¼ŒmasterèŠ‚ç‚¹å®šæœŸå°†æœ€æ–°çš„é›†ç¾¤çŠ¶æ€å¹¿æ’­è‡³å„ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œmasterçš„ç¨³å®šæ€§å¯¹äºé›†ç¾¤æ•´ä½“çš„ç¨³å®šæ€§æ˜¯è‡³å…³é‡è¦çš„ã€‚å½“é›†ç¾¤çš„èŠ‚ç‚¹æ•°é‡è¾ƒå¤§æ—¶ï¼ˆæ¯”å¦‚è¶…è¿‡30ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œé›†ç¾¤çš„ç®¡ç†å·¥ä½œä¼šå˜å¾—å¤æ‚å¾ˆå¤šã€‚æ­¤æ—¶åº”è¯¥åˆ›å»ºä¸“æœ‰masterèŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹åªè´Ÿè´£é›†ç¾¤ç®¡ç†ï¼Œä¸å­˜å‚¨æ•°æ®ï¼Œä¸æ‰¿æ‹…æ•°æ®è¯»å†™å‹åŠ›ï¼›å…¶ä»–èŠ‚ç‚¹åˆ™ä»…è´Ÿè´£æ•°æ®è¯»å†™ï¼Œä¸è´Ÿè´£é›†ç¾¤ç®¡ç†çš„å·¥ä½œã€‚ è¿™æ ·æŠŠé›†ç¾¤ç®¡ç†å’Œæ•°æ®çš„å†™å…¥/æŸ¥è¯¢åˆ†ç¦»ï¼Œäº’ä¸å½±å“ï¼Œé˜²æ­¢å› è¯»å†™å‹åŠ›è¿‡å¤§é€ æˆé›†ç¾¤æ•´ä½“ä¸ç¨³å®šã€‚ å°†ä¸“æœ‰masterèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹çš„åˆ†ç¦»ï¼Œéœ€è¦ä¿®æ”¹ESçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åæ»šåŠ¨é‡å¯å„ä¸ªèŠ‚ç‚¹ã€‚ ä¸“æœ‰masterèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼ˆconf/elasticsearch.ymlï¼‰å¢åŠ å¦‚ä¸‹å±æ€§ï¼šnode.master: truenode.data: falsenode.ingest: falseæ•°æ®èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶å¢åŠ å¦‚ä¸‹å±æ€§ï¼ˆä¸ä¸Šé¢çš„å±æ€§ç›¸åï¼‰ï¼šnode.master: falsenode.data: truenode.ingest: true æ§åˆ¶indexã€shardæ€»æ•°é‡ä¸Šé¢æåˆ°ï¼ŒESçš„å…ƒä¿¡æ¯ç”±masterèŠ‚ç‚¹ç®¡ç†ï¼Œå®šæœŸåŒæ­¥ç»™å„ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå­˜å‚¨ä¸€ä»½ã€‚è¿™ä¸ªå…ƒä¿¡æ¯ä¸»è¦å­˜å‚¨åœ¨clusterstateä¸­ï¼Œå¦‚æ‰€æœ‰nodeå…ƒä¿¡æ¯ï¼ˆindicesã€èŠ‚ç‚¹å„ç§ç»Ÿè®¡å‚æ•°ï¼‰ã€æ‰€æœ‰index/shardçš„å…ƒä¿¡æ¯ï¼ˆmapping, location, sizeï¼‰ã€å…ƒæ•°æ®ingestç­‰ã€‚ ESåœ¨åˆ›å»ºæ–°åˆ†ç‰‡æ—¶ï¼Œè¦æ ¹æ®ç°æœ‰çš„åˆ†ç‰‡åˆ†å¸ƒæƒ…å†µæŒ‡å®šåˆ†ç‰‡åˆ†é…ç­–ç•¥ï¼Œä»è€Œä½¿å„ä¸ªèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡æ•°åŸºæœ¬ä¸€è‡´ï¼Œæ­¤è¿‡ç¨‹ä¸­å°±éœ€è¦æ·±å…¥éå†clusterstateã€‚å½“é›†ç¾¤ä¸­çš„index/shardè¿‡å¤šæ—¶ï¼Œclusterstateç»“æ„ä¼šå˜å¾—è¿‡äºå¤æ‚ï¼Œå¯¼è‡´éå†clusterstateæ•ˆç‡ä½ä¸‹ï¼Œé›†ç¾¤å“åº”è¿Ÿæ»ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿæ›¾ç»åœ¨ä¸€ä¸ª20ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤é‡Œï¼Œåˆ›å»ºäº†4w+ä¸ªshardï¼Œå¯¼è‡´æ–°å»ºä¸€ä¸ªindexéœ€è¦60s+æ‰èƒ½å®Œæˆã€‚ å½“index/shardæ•°é‡è¿‡å¤šæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»ä»¥ä¸‹å‡ æ–¹é¢æ”¹è¿›ï¼š é™ä½æ•°æ®é‡è¾ƒå°çš„indexçš„shardæ•°é‡ æŠŠä¸€äº›æœ‰å…³è”çš„indexåˆå¹¶æˆä¸€ä¸ªindex æ•°æ®æŒ‰æŸä¸ªç»´åº¦åšæ‹†åˆ†ï¼Œå†™å…¥å¤šä¸ªé›†ç¾¤ Segment Memoryä¼˜åŒ–å‰é¢æåˆ°ï¼ŒESåº•å±‚é‡‡ç”¨Luceneåšå­˜å‚¨ï¼Œè€ŒLuceneçš„ä¸€ä¸ªindexåˆç”±è‹¥å¹²segmentç»„æˆï¼Œæ¯ä¸ªsegmentéƒ½ä¼šå»ºç«‹è‡ªå·±çš„å€’æ’ç´¢å¼•ç”¨äºæ•°æ®æŸ¥è¯¢ã€‚Luceneä¸ºäº†åŠ é€ŸæŸ¥è¯¢ï¼Œä¸ºæ¯ä¸ªsegmentçš„å€’æ’åšäº†ä¸€å±‚å‰ç¼€ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•åœ¨Lucene4.0ä»¥åé‡‡ç”¨çš„æ•°æ®ç»“æ„æ˜¯FST (Finite State Transducer)ã€‚LuceneåŠ è½½segmentçš„æ—¶å€™å°†å…¶å…¨é‡è£…è½½åˆ°å†…å­˜ä¸­ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚è¿™éƒ¨åˆ†å†…å­˜è¢«ç§°ä¸ºSegmentMemoryï¼Œ å¸¸é©»å†…å­˜ï¼Œå ç”¨heapï¼Œæ— æ³•è¢«GCã€‚ å‰é¢æåˆ°ï¼Œä¸ºåˆ©ç”¨JVMçš„å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯æ¥èŠ‚çº¦å†…å­˜ï¼Œé€šå¸¸å»ºè®®JVMå†…å­˜åˆ†é…ä¸è¦è¶…è¿‡32Gã€‚å½“é›†ç¾¤çš„æ•°æ®é‡è¿‡å¤§æ—¶ï¼ŒSegmentMemoryä¼šåƒæ‰å¤§é‡çš„å †å†…å­˜ï¼Œè€ŒJVMå†…å­˜ç©ºé—´åˆæœ‰é™ï¼Œæ­¤æ—¶å°±éœ€è¦æƒ³åŠæ³•é™ä½SegmentMemoryçš„ä½¿ç”¨é‡äº†ï¼Œå¸¸ç”¨æ–¹æ³•æœ‰ä¸‹é¢å‡ ä¸ªï¼š å®šæœŸåˆ é™¤ä¸ä½¿ç”¨çš„index å¯¹äºä¸å¸¸è®¿é—®çš„indexï¼Œå¯ä»¥é€šè¿‡closeæ¥å£å°†å…¶å…³é—­ï¼Œç”¨åˆ°æ—¶å†æ‰“å¼€ é€šè¿‡force_mergeæ¥å£å¼ºåˆ¶åˆå¹¶segmentï¼Œé™ä½segmentæ•°é‡ åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹FSTéƒ¨åˆ†è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‡Šæ”¾é«˜è¾¾40%çš„Segment Memoryå†…å­˜ç©ºé—´ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"å¯åŠ¨ELKè„šæœ¬å‘½ä»¤","date":"2021-07-14T15:37:17.000Z","path":"wiki/å¯åŠ¨ELKè„šæœ¬å‘½ä»¤/","text":"esuser æˆæƒchown -R esuser /usr/local/elasticsearch/* elastcisearch å¯åŠ¨è„šæœ¬nohup ./elasticsearch-7.10.0/bin/elasticsearch &gt;&gt; ./elasticsearch-7.10.0/nohup.out 2&gt;&amp;1 &amp; kibana å¯åŠ¨è„šæœ¬nohup ./bin/kibana &gt;&gt; ./nohup.out 2&gt;&amp;1 &amp; logstash å¯åŠ¨è„šæœ¬nohup /usr/local/logstash/logstash-7.10.0/bin/logstash -f /usr/local/logstash/logstash-7.10.0/config/redtom-logstash.conf nohup /usr/local/logstash/logstash-7.10.0/bin/logstash -f /usr/local/logstash/logstash-7.10.0/config/redtom-logstash.conf &gt;&gt; /usr/local/logstash/logstash-7.10.0/nohup.out 2&gt;&amp;1 &amp;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"elasticsearchè°ƒä¼˜å®è·µ","date":"2021-07-14T15:12:16.000Z","path":"wiki/elasticsearchè°ƒä¼˜å®è·µ-0/","text":"ä»æ€§èƒ½å’Œç¨³å®šæ€§ä¸¤æ–¹é¢ï¼Œä»linuxå‚æ•°è°ƒä¼˜ã€ESèŠ‚ç‚¹é…ç½®å’ŒESä½¿ç”¨æ–¹å¼ä¸‰ä¸ªè§’åº¦å…¥æ‰‹ï¼Œä»‹ç»ESè°ƒä¼˜çš„åŸºæœ¬æ–¹æ¡ˆã€‚å½“ç„¶ï¼ŒESçš„è°ƒä¼˜ç»ä¸èƒ½ä¸€æ¦‚è€Œè®ºï¼Œéœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯åšé€‚å½“çš„å–èˆå’Œè°ƒæ•´ Elasticsearchæ€§èƒ½ä¼˜åŒ–æ€»ç»“Elasticsearchè°ƒä¼˜å®è·µ Linuxä¼˜åŒ–å…³é—­äº¤æ¢åˆ†åŒºï¼Œé˜²æ­¢å†…å­˜ç½®æ¢é™ä½æ€§èƒ½ã€‚å°† /etc/fstab æ–‡ä»¶ä¸­åŒ…å«swapçš„è¡Œæ³¨é‡Šæ‰sed -i &#39;/swap/s/^/#/&#39; /etc/fstabswapoff -a ç£ç›˜æŒ‚è½½é€‰é¡¹noatimeï¼šç¦æ­¢è®°å½•è®¿é—®æ—¶é—´æˆ³ï¼Œæé«˜æ–‡ä»¶ç³»ç»Ÿè¯»å†™æ€§èƒ½data=writebackï¼š ä¸è®°å½•data journalï¼Œæé«˜æ–‡ä»¶ç³»ç»Ÿå†™å…¥æ€§èƒ½barrier=0ï¼šbarrierä¿è¯journalå…ˆäºdataåˆ·åˆ°ç£ç›˜ï¼Œä¸Šé¢å…³é—­äº†journalï¼Œè¿™é‡Œçš„barrierä¹Ÿå°±æ²¡å¿…è¦å¼€å¯äº†nobhï¼šå…³é—­buffer_headï¼Œé˜²æ­¢å†…æ ¸æ‰“æ–­å¤§å—æ•°æ®çš„IOæ“ä½œmount -o noatime,data=writeback,barrier=0,nobh /dev/sda /es_data å¯¹äºSSDç£ç›˜ï¼Œé‡‡ç”¨ç”µæ¢¯è°ƒåº¦ç®—æ³•å› ä¸ºSSDæä¾›äº†æ›´æ™ºèƒ½çš„è¯·æ±‚è°ƒåº¦ç®—æ³•ï¼Œä¸éœ€è¦å†…æ ¸å»åšå¤šä½™çš„è°ƒæ•´ (ä»…ä¾›å‚è€ƒ)echo noop &gt; /sys/block/sda/queue/scheduler ESèŠ‚ç‚¹é…ç½®conf/elasticsearch.ymlæ–‡ä»¶ï¼š é€‚å½“å¢å¤§å†™å…¥bufferå’Œbulké˜Ÿåˆ—é•¿åº¦ï¼Œæé«˜å†™å…¥æ€§èƒ½å’Œç¨³å®šæ€§indices.memory.index_buffer_size: 15%thread_pool.bulk.queue_size: 1024 è®¡ç®—diskä½¿ç”¨é‡æ—¶ï¼Œä¸è€ƒè™‘æ­£åœ¨æ¬è¿çš„shardåœ¨è§„æ¨¡æ¯”è¾ƒå¤§çš„é›†ç¾¤ä¸­ï¼Œå¯ä»¥é˜²æ­¢æ–°å»ºshardæ—¶æ‰«ææ‰€æœ‰shardçš„å…ƒæ•°æ®ï¼Œæå‡shardåˆ†é…é€Ÿåº¦ã€‚cluster.routing.allocation.disk.include_relocations: false ä¸‰ ESä½¿ç”¨æ–¹å¼æ§åˆ¶å­—æ®µçš„å­˜å‚¨é€‰é¡¹ESåº•å±‚ä½¿ç”¨Luceneå­˜å‚¨æ•°æ®ï¼Œä¸»è¦åŒ…æ‹¬è¡Œå­˜ï¼ˆStoreFiledï¼‰ã€åˆ—å­˜ï¼ˆDocValuesï¼‰å’Œå€’æ’ç´¢å¼•ï¼ˆInvertIndexï¼‰ä¸‰éƒ¨åˆ†ã€‚ å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæ²¡æœ‰å¿…è¦åŒæ—¶å­˜å‚¨è¿™ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°æ¥åšé€‚å½“è°ƒæ•´ï¼š StoreFiledè¡Œå­˜ï¼Œå…¶ä¸­å æ¯”æœ€å¤§çš„æ˜¯sourceå­—æ®µï¼Œå®ƒæ§åˆ¶docåŸå§‹æ•°æ®çš„å­˜å‚¨ã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼ŒESæŠŠdocåŸå§‹æ•°æ®çš„æ•´ä¸ªjsonç»“æ„ä½“å½“åšä¸€ä¸ªstringï¼Œå­˜å‚¨ä¸ºsourceå­—æ®µã€‚æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥é€šè¿‡sourceå­—æ®µæ‹¿åˆ°å½“åˆå†™å…¥æ—¶çš„æ•´ä¸ªjsonç»“æ„ä½“ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæ²¡æœ‰å–å‡ºæ•´ä¸ªåŸå§‹jsonç»“æ„ä½“çš„éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨mappingä¸­å…³é—­sourceå­—æ®µæˆ–è€…åªåœ¨sourceä¸­å­˜å‚¨éƒ¨åˆ†å­—æ®µï¼Œæ•°æ®æŸ¥è¯¢æ—¶ä»å¯é€šè¿‡ESçš„docvaluefieldsè·å–æ‰€æœ‰å­—æ®µçš„å€¼ã€‚æ³¨æ„ï¼šå…³é—­sourceåï¼Œ update, updatebyquery, reindexç­‰æ¥å£å°†æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ‰€ä»¥æœ‰updateç­‰éœ€æ±‚çš„indexä¸èƒ½å…³é—­sourceã€‚ å…³é—­ _source12345678910PUT my_index &#123; &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;_source&quot;: &#123; &quot;enabled&quot;: false &#125; &#125; &#125;&#125; _sourceåªå­˜å‚¨éƒ¨åˆ†å­—æ®µé€šè¿‡includesæŒ‡å®šè¦å­˜å‚¨çš„å­—æ®µæˆ–è€…é€šè¿‡excludesæ»¤é™¤ä¸éœ€è¦çš„å­—æ®µ 123456789101112131415161718PUT my_index&#123; &quot;mappings&quot;: &#123; &quot;_doc&quot;: &#123; &quot;_source&quot;: &#123; &quot;includes&quot;: [ &quot;*.count&quot;, &quot;meta.*&quot; ], &quot;excludes&quot;: [ &quot;meta.description&quot;, &quot;meta.other.*&quot; ] &#125; &#125; &#125;&#125; docvalues æ§åˆ¶åˆ—å­˜ã€‚ESä¸»è¦ä½¿ç”¨åˆ—å­˜æ¥æ”¯æŒsorting, aggregationså’ŒscriptsåŠŸèƒ½ï¼Œå¯¹äºæ²¡æœ‰ä¸Šè¿°éœ€æ±‚çš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å…³é—­docvaluesï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚ 12345678910111213PUT my_index&#123; &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;properties&quot;: &#123; &quot;session_id&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;, &quot;doc_values&quot;: false &#125; &#125; &#125; &#125;&#125; ndexï¼šæ§åˆ¶å€’æ’ç´¢å¼•ã€‚ESé»˜è®¤å¯¹äºæ‰€æœ‰å­—æ®µéƒ½å¼€å¯äº†å€’æ’ç´¢å¼•ï¼Œç”¨äºæŸ¥è¯¢ã€‚å¯¹äºæ²¡æœ‰æŸ¥è¯¢éœ€æ±‚çš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å…³é—­å€’æ’ç´¢å¼•ã€‚ 12345678910111213PUT my_index&#123; &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;properties&quot;: &#123; &quot;session_id&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;, &quot;index&quot;: false &#125; &#125; &#125; &#125;&#125; allESçš„ä¸€ä¸ªç‰¹æ®Šçš„å­—æ®µ ESæŠŠç”¨æˆ·å†™å…¥jsonçš„æ‰€æœ‰å­—æ®µå€¼æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²åï¼Œåšåˆ†è¯ï¼Œç„¶åä¿å­˜å€’æ’ç´¢å¼•ï¼Œç”¨äºæ”¯æŒæ•´ä¸ªjsonçš„å…¨æ–‡æ£€ç´¢ã€‚è¿™ç§éœ€æ±‚é€‚ç”¨çš„åœºæ™¯è¾ƒå°‘ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å°†allå­—æ®µå…³é—­ï¼ŒèŠ‚çº¦å­˜å‚¨æˆæœ¬å’Œcpuå¼€é”€ã€‚ï¼ˆES 6.0+ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸å†æ”¯æŒ_allå­—æ®µï¼Œä¸éœ€è¦è®¾ç½®ï¼‰12345678910PUT /my_index&#123; &quot;mapping&quot;: &#123; &quot;my_type&quot;: &#123; &quot;_all&quot;: &#123; &quot;enabled&quot;: false &#125; &#125; &#125;&#125; fieldnamesè¯¥å­—æ®µç”¨äºexistsæŸ¥è¯¢ï¼Œæ¥ç¡®è®¤æŸä¸ªdocé‡Œé¢æœ‰æ— ä¸€ä¸ªå­—æ®µå­˜åœ¨ã€‚è‹¥æ²¡æœ‰è¿™ç§éœ€æ±‚ï¼Œå¯ä»¥å°†å…¶å…³é—­ã€‚12345678910PUT /my_index&#123; &quot;mapping&quot;: &#123; &quot;my_type&quot;: &#123; &quot;_field_names&quot;: &#123; &quot;enabled&quot;: false &#125; &#125; &#125;&#125; å¼€å¯æœ€ä½³å‹ç¼©å¯¹äºæ‰“å¼€äº†ä¸Šè¿°_sourceå­—æ®µçš„indexï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŠŠluceneé€‚ç”¨çš„å‹ç¼©ç®—æ³•æ›¿æ¢æˆ DEFLATEï¼Œæé«˜æ•°æ®å‹ç¼©ç‡ã€‚PUT /my_index/_settings&#123; &quot;index.codec&quot;: &quot;best_compression&quot;&#125; bulkæ‰¹é‡å†™å…¥å†™å…¥æ•°æ®æ—¶å°½é‡ä½¿ç”¨ä¸‹é¢çš„bulkæ¥å£æ‰¹é‡å†™å…¥ï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚æ¯ä¸ªbulkè¯·æ±‚çš„docæ•°é‡è®¾å®šåŒºé—´æ¨èä¸º1k~1wï¼Œå…·ä½“å¯æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰å–ä¸€ä¸ªé€‚å½“çš„æ•°é‡ã€‚ è°ƒæ•´translogåŒæ­¥ç­–ç•¥é»˜è®¤æƒ…å†µä¸‹ï¼Œtranslogçš„æŒä¹…åŒ–ç­–ç•¥æ˜¯ï¼Œå¯¹äºæ¯ä¸ªå†™å…¥è¯·æ±‚éƒ½åšä¸€æ¬¡flushï¼Œåˆ·æ–°translogæ•°æ®åˆ°ç£ç›˜ä¸Šã€‚è¿™ç§é¢‘ç¹çš„ç£ç›˜IOæ“ä½œæ˜¯ä¸¥é‡å½±å“å†™å…¥æ€§èƒ½çš„ï¼Œå¦‚æœå¯ä»¥æ¥å—ä¸€å®šæ¦‚ç‡çš„æ•°æ®ä¸¢å¤±ï¼ˆè¿™ç§ç¡¬ä»¶æ•…éšœçš„æ¦‚ç‡å¾ˆå°ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è°ƒæ•´ translog æŒä¹…åŒ–ç­–ç•¥ä¸ºå¼‚æ­¥å‘¨æœŸæ€§æ‰§è¡Œï¼Œå¹¶é€‚å½“è°ƒæ•´translogçš„åˆ·ç›˜å‘¨æœŸã€‚ 1234567891011PUT my_index&#123;&quot;settings&quot;: &#123; &quot;index&quot;: &#123; &quot;translog&quot;: &#123; &quot;sync_interval&quot;: &quot;5s&quot;, &quot;durability&quot;: &quot;async&quot; &#125; &#125;&#125;&#125; è°ƒæ•´refresh_intervalå†™å…¥Luceneçš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯å®æ—¶å¯æœç´¢çš„ï¼ŒESå¿…é¡»é€šè¿‡refreshçš„è¿‡ç¨‹æŠŠå†…å­˜ä¸­çš„æ•°æ®è½¬æ¢æˆLuceneçš„å®Œæ•´segmentåï¼Œæ‰å¯ä»¥è¢«æœç´¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒESæ¯ä¸€ç§’ä¼šrefreshä¸€æ¬¡ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„segmentï¼Œè¿™æ ·ä¼šå¯¼è‡´äº§ç”Ÿçš„segmentè¾ƒå¤šï¼Œä»è€Œsegment mergeè¾ƒä¸ºé¢‘ç¹ï¼Œç³»ç»Ÿå¼€é”€è¾ƒå¤§ã€‚å¦‚æœå¯¹æ•°æ®çš„å®æ—¶å¯è§æ€§è¦æ±‚è¾ƒä½ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æé«˜refreshçš„æ—¶é—´é—´éš”ï¼Œé™ä½ç³»ç»Ÿå¼€é”€ã€‚ PUT my_index&#123; &quot;settings&quot;: &#123; &quot;index&quot;: &#123; &quot;refresh_interval&quot; : &quot;30s&quot; &#125; &#125;&#125; mergeå¹¶å‘æ§åˆ¶ESçš„ä¸€ä¸ªindexç”±å¤šä¸ªshardç»„æˆï¼Œè€Œä¸€ä¸ªshardå…¶å®å°±æ˜¯ä¸€ä¸ªLuceneçš„indexï¼Œå®ƒåˆç”±å¤šä¸ªsegmentç»„æˆï¼Œä¸”Luceneä¼šä¸æ–­åœ°æŠŠä¸€äº›å°çš„segmentåˆå¹¶æˆä¸€ä¸ªå¤§çš„segmentï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºmergeã€‚é»˜è®¤å€¼æ˜¯Math.max(1, Math.min(4, Runtime.getRuntime().availableProcessors() / 2))ï¼Œå½“èŠ‚ç‚¹é…ç½®çš„cpuæ ¸æ•°è¾ƒé«˜æ—¶ï¼Œmergeå ç”¨çš„èµ„æºå¯èƒ½ä¼šåé«˜ï¼Œå½±å“é›†ç¾¤çš„æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è°ƒæ•´æŸä¸ªindexçš„mergeè¿‡ç¨‹çš„å¹¶å‘åº¦ï¼š PUT /my_index/_settings&#123; &quot;index.merge.scheduler.max_thread_count&quot;: 2&#125; å†™å…¥æ•°æ®ä¸æŒ‡å®š_idï¼Œè®©ESè‡ªåŠ¨äº§ç”Ÿå½“ç”¨æˆ·æ˜¾ç¤ºæŒ‡å®šidå†™å…¥æ•°æ®æ—¶ï¼ŒESä¼šå…ˆå‘èµ·æŸ¥è¯¢æ¥ç¡®å®šindexä¸­æ˜¯å¦å·²ç»æœ‰ç›¸åŒidçš„docå­˜åœ¨ï¼Œè‹¥æœ‰åˆ™å…ˆåˆ é™¤åŸæœ‰docå†å†™å…¥æ–°docã€‚è¿™æ ·æ¯æ¬¡å†™å…¥æ—¶ï¼ŒESéƒ½ä¼šè€—è´¹ä¸€å®šçš„èµ„æºåšæŸ¥è¯¢ã€‚å¦‚æœç”¨æˆ·å†™å…¥æ•°æ®æ—¶ä¸æŒ‡å®šdocï¼ŒESåˆ™é€šè¿‡å†…éƒ¨ç®—æ³•äº§ç”Ÿä¸€ä¸ªéšæœºçš„idï¼Œå¹¶ä¸”ä¿è¯idçš„å”¯ä¸€æ€§ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡å‰é¢æŸ¥è¯¢idçš„æ­¥éª¤ï¼Œæé«˜å†™å…¥æ•ˆç‡ã€‚ æ‰€ä»¥ï¼Œåœ¨ä¸éœ€è¦é€šè¿‡idå­—æ®µå»é‡ã€updateçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå†™å…¥ä¸æŒ‡å®šidå¯ä»¥æå‡å†™å…¥é€Ÿç‡ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿçš„æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼Œæ— idçš„æ•°æ®å†™å…¥æ€§èƒ½å¯èƒ½æ¯”æœ‰_idçš„é«˜å‡ºè¿‘ä¸€å€ï¼Œå®é™…æŸè€—å’Œå…·ä½“æµ‹è¯•åœºæ™¯ç›¸å…³ã€‚ routingå¯¹äºæ•°æ®é‡è¾ƒå¤§çš„indexï¼Œä¸€èˆ¬ä¼šé…ç½®å¤šä¸ªshardæ¥åˆ†æ‘Šå‹åŠ›ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªæŸ¥è¯¢ä¼šåŒæ—¶æœç´¢æ‰€æœ‰çš„shardï¼Œç„¶åå†å°†å„ä¸ªshardçš„ç»“æœåˆå¹¶åï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚å¯¹äºé«˜å¹¶å‘çš„å°æŸ¥è¯¢åœºæ™¯ï¼Œæ¯ä¸ªåˆ†ç‰‡é€šå¸¸ä»…æŠ“å–æå°‘é‡æ•°æ®ï¼Œæ­¤æ—¶æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„è°ƒåº¦å¼€é”€è¿œå¤§äºå®é™…è¯»å–æ•°æ®çš„å¼€é”€ï¼Œä¸”æŸ¥è¯¢é€Ÿåº¦å–å†³äºæœ€æ…¢çš„ä¸€ä¸ªåˆ†ç‰‡ã€‚å¼€å¯routingåŠŸèƒ½åï¼ŒESä¼šå°†routingç›¸åŒçš„æ•°æ®å†™å…¥åˆ°åŒä¸€ä¸ªåˆ†ç‰‡ä¸­ï¼ˆä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼Œç”±index.routingpartitionsizeå‚æ•°æ§åˆ¶ï¼‰ã€‚å¦‚æœæŸ¥è¯¢æ—¶æŒ‡å®šroutingï¼Œé‚£ä¹ˆESåªä¼šæŸ¥è¯¢routingæŒ‡å‘çš„é‚£ä¸ªåˆ†ç‰‡ï¼Œå¯æ˜¾è‘—é™ä½è°ƒåº¦å¼€é”€ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚ routingçš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š 12# å†™å…¥PUT my_index/my_type/1?routing=user1&#123; &quot;title&quot;: &quot;This is a document&quot;&#125;# æŸ¥è¯¢GET my_index/_search?routing=user1,user2 &#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;title&quot;: &quot;document&quot; &#125; &#125;&#125; ä¸ºstringç±»å‹çš„å­—æ®µé€‰å–åˆé€‚çš„å­˜å‚¨æ–¹å¼å­˜ä¸ºtextç±»å‹çš„å­—æ®µï¼ˆstringå­—æ®µé»˜è®¤ç±»å‹ä¸ºtextï¼‰ï¼šåšåˆ†è¯åå­˜å‚¨å€’æ’ç´¢å¼•ï¼Œæ”¯æŒå…¨æ–‡æ£€ç´¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‡ ä¸ªå‚æ•°ä¼˜åŒ–å…¶å­˜å‚¨æ–¹å¼ï¼š - normsï¼šç”¨äºåœ¨æœç´¢æ—¶è®¡ç®—è¯¥docçš„_scoreï¼ˆä»£è¡¨è¿™æ¡æ•°æ®ä¸æœç´¢æ¡ä»¶çš„ç›¸å…³åº¦ï¼‰ï¼Œå¦‚æœä¸éœ€è¦è¯„åˆ†ï¼Œå¯ä»¥å°†å…¶å…³é—­ã€‚ - indexoptionsï¼šæ§åˆ¶å€’æ’ç´¢å¼•ä¸­åŒ…æ‹¬å“ªäº›ä¿¡æ¯ï¼ˆdocsã€freqsã€positionsã€offsetsï¼‰ã€‚å¯¹äºä¸å¤ªæ³¨é‡score/highlightingçš„ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥è®¾ä¸º docsæ¥é™ä½å†…å­˜/ç£ç›˜èµ„æºæ¶ˆè€—ã€‚ - fields: ç”¨äºæ·»åŠ å­å­—æ®µã€‚å¯¹äºæœ‰sortå’ŒèšåˆæŸ¥è¯¢éœ€æ±‚çš„åœºæ™¯ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªkeywordå­å­—æ®µä»¥æ”¯æŒè¿™ä¸¤ç§åŠŸèƒ½ã€‚ 123456789101112131415161718192021222324252627282930313233343536 &#123; &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;properties&quot;: &#123; &quot;title&quot;: &#123; &quot;type&quot;: &quot;text&quot;, &quot;norms&quot;: false, &quot;index_options&quot;: &quot;docs&quot;, &quot;fields&quot;: &#123; &quot;raw&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125; &#125; &#125; &#125; &#125; ``` #### å­˜ä¸ºkeywordç±»å‹çš„å­—æ®µä¸åšåˆ†è¯ï¼Œä¸æ”¯æŒå…¨æ–‡æ£€ç´¢ã€‚textåˆ†è¯æ¶ˆè€—CPUèµ„æºï¼Œå†—ä½™å­˜å‚¨keywordå­å­—æ®µå ç”¨å­˜å‚¨ç©ºé—´ã€‚å¦‚æœæ²¡æœ‰å…¨æ–‡ç´¢å¼•éœ€æ±‚ï¼Œåªæ˜¯è¦é€šè¿‡æ•´ä¸ªå­—æ®µåšæœç´¢ï¼Œå¯ä»¥è®¾ç½®è¯¥å­—æ®µçš„ç±»å‹ä¸ºkeywordï¼Œæå‡å†™å…¥é€Ÿç‡ï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚ è®¾ç½®å­—æ®µç±»å‹çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸€æ˜¯åˆ›å»ºä¸€ä¸ªå…·ä½“çš„indexæ—¶ï¼ŒæŒ‡å®šå­—æ®µçš„ç±»å‹ï¼›äºŒæ˜¯é€šè¿‡åˆ›å»ºtemplateï¼Œæ§åˆ¶æŸä¸€ç±»indexçš„å­—æ®µç±»å‹ã€‚- é€šè¿‡mappingæŒ‡å®š tags å­—æ®µä¸ºkeywordç±»å‹```jsonPUT my_index&#123; &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;properties&quot;: &#123; &quot;tags&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125; &#125; &#125; &#125; &#125; é€šè¿‡templateï¼ŒæŒ‡å®šmy_index*ç±»çš„indexï¼Œå…¶æ‰€æœ‰stringå­—æ®µé»˜è®¤ä¸ºkeywordç±»å‹PUT _template/my_template12345678910111213141516171819202122&#123; &quot;order&quot;: 0, &quot;template&quot;: &quot;my_index*&quot;, &quot;mappings&quot;: &#123; &quot;_default_&quot;: &#123; &quot;dynamic_templates&quot;: [ &#123; &quot;strings&quot;: &#123; &quot;match_mapping_type&quot;: &quot;string&quot;, &quot;mapping&quot;: &#123; &quot;type&quot;: &quot;keyword&quot;, &quot;ignore_above&quot;: 256 &#125; &#125; &#125; ] &#125; &#125;, &quot;aliases&quot;: &#123; &#125; &#125; æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨query-bool-filterç»„åˆå–ä»£æ™®é€šqueryé»˜è®¤æƒ…å†µä¸‹ï¼ŒESé€šè¿‡ä¸€å®šçš„ç®—æ³•è®¡ç®—è¿”å›çš„æ¯æ¡æ•°æ®ä¸æŸ¥è¯¢è¯­å¥çš„ç›¸å…³åº¦ï¼Œå¹¶é€šè¿‡scoreå­—æ®µæ¥è¡¨å¾ã€‚ä½†å¯¹äºéå…¨æ–‡ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·å¹¶ä¸careæŸ¥è¯¢ç»“æœä¸æŸ¥è¯¢æ¡ä»¶çš„ç›¸å…³åº¦ï¼Œåªæ˜¯æƒ³ç²¾ç¡®çš„æŸ¥æ‰¾ç›®æ ‡æ•°æ®ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡query-bool-filterç»„åˆæ¥è®©ESä¸è®¡ç®—scoreï¼Œå¹¶ä¸”å°½å¯èƒ½çš„ç¼“å­˜filterçš„ç»“æœé›†ï¼Œä¾›åç»­åŒ…å«ç›¸åŒfilterçš„æŸ¥è¯¢ä½¿ç”¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚ æ™®é€šæŸ¥è¯¢POST my_index/_search&#123; &quot;query&quot;: &#123; &quot;term&quot; : &#123; &quot;user&quot; : &quot;Kimchy&quot; &#125; &#125;&#125; query-bool-filter åŠ é€ŸæŸ¥è¯¢POST my_index/_search&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;filter&quot;: &#123; &quot;term&quot;: &#123; &quot;user&quot;: &quot;Kimchy&quot; &#125; &#125; &#125; &#125;&#125; indexæŒ‰æ—¥æœŸæ»šåŠ¨ï¼Œä¾¿äºç®¡ç†å†™å…¥ESçš„æ•°æ®æœ€å¥½é€šè¿‡æŸç§æ–¹å¼åšåˆ†å‰²ï¼Œå­˜å…¥ä¸åŒçš„indexã€‚å¸¸è§çš„åšæ³•æ˜¯å°†æ•°æ®æŒ‰æ¨¡å—/åŠŸèƒ½åˆ†ç±»ï¼Œå†™å…¥ä¸åŒçš„indexï¼Œç„¶åæŒ‰ç…§æ—¶é—´å»æ»šåŠ¨ç”Ÿæˆindexã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å„ç§æ•°æ®åˆ†å¼€ç®¡ç†ä¸ä¼šæ··æ·†ï¼Œä¹Ÿæ˜“äºæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚åŒæ—¶indexæŒ‰æ—¶é—´æ»šåŠ¨ï¼Œæ•°æ®è¿‡æœŸæ—¶åˆ é™¤æ•´ä¸ªindexï¼Œè¦æ¯”ä¸€æ¡æ¡åˆ é™¤æ•°æ®æˆ–deletebyqueryæ•ˆç‡é«˜å¾ˆå¤šï¼Œå› ä¸ºåˆ é™¤æ•´ä¸ªindexæ˜¯ç›´æ¥åˆ é™¤åº•å±‚æ–‡ä»¶ï¼Œè€Œdeletebyqueryæ˜¯æŸ¥è¯¢-æ ‡è®°-åˆ é™¤ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼Œå‡å¦‚æœ‰[modulea,moduleb]ä¸¤ä¸ªæ¨¡å—äº§ç”Ÿçš„æ•°æ®ï¼Œé‚£ä¹ˆindexè§„åˆ’å¯ä»¥æ˜¯è¿™æ ·çš„ï¼šä¸€ç±»indexåç§°æ˜¯modulea + {æ—¥æœŸ}ï¼Œå¦ä¸€ç±»indexåç§°æ˜¯module_b+ {æ—¥æœŸ}ã€‚å¯¹äºåå­—ä¸­çš„æ—¥æœŸï¼Œå¯ä»¥åœ¨å†™å…¥æ•°æ®æ—¶è‡ªå·±æŒ‡å®šç²¾ç¡®çš„æ—¥æœŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡ESçš„ingest pipelineä¸­çš„index-name-processorå®ç°ï¼ˆä¼šæœ‰å†™å…¥æ€§èƒ½æŸè€—ï¼‰ã€‚ æŒ‰éœ€æ§åˆ¶indexçš„åˆ†ç‰‡æ•°å’Œå‰¯æœ¬æ•°åˆ†ç‰‡ï¼ˆshardï¼‰ï¼šä¸€ä¸ªESçš„indexç”±å¤šä¸ªshardç»„æˆï¼Œæ¯ä¸ªshardæ‰¿è½½indexçš„ä¸€éƒ¨åˆ†æ•°æ®ã€‚ å‰¯æœ¬ï¼ˆreplicaï¼‰ï¼šindexä¹Ÿå¯ä»¥è®¾å®šå‰¯æœ¬æ•°ï¼ˆnumberofreplicasï¼‰ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªshardæœ‰å¤šå°‘ä¸ªå¤‡ä»½ã€‚å¯¹äºæŸ¥è¯¢å‹åŠ›è¾ƒå¤§çš„indexï¼Œå¯ä»¥è€ƒè™‘æé«˜å‰¯æœ¬æ•°ï¼ˆnumberofreplicasï¼‰ï¼Œé€šè¿‡å¤šä¸ªå‰¯æœ¬å‡æ‘ŠæŸ¥è¯¢å‹åŠ›ã€‚ shardæ•°é‡ï¼ˆnumberofshardsï¼‰è®¾ç½®è¿‡å¤šæˆ–è¿‡ä½éƒ½ä¼šå¼•å‘ä¸€äº›é—®é¢˜ï¼šshardæ•°é‡è¿‡å¤šï¼Œåˆ™æ‰¹é‡å†™å…¥/æŸ¥è¯¢è¯·æ±‚è¢«åˆ†å‰²ä¸ºè¿‡å¤šçš„å­å†™å…¥/æŸ¥è¯¢ï¼Œå¯¼è‡´è¯¥indexçš„å†™å…¥ã€æŸ¥è¯¢æ‹’ç»ç‡ä¸Šå‡ï¼›å¯¹äºæ•°æ®é‡è¾ƒå¤§çš„inexï¼Œå½“å…¶shardæ•°é‡è¿‡å°æ—¶ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨èŠ‚ç‚¹èµ„æºï¼Œé€ æˆæœºå™¨èµ„æºåˆ©ç”¨ç‡ä¸é«˜ æˆ– ä¸å‡è¡¡ï¼Œå½±å“å†™å…¥/æŸ¥è¯¢çš„æ•ˆç‡ã€‚ å¯¹äºæ¯ä¸ªindexçš„shardæ•°é‡ï¼Œå¯ä»¥æ ¹æ®æ•°æ®æ€»é‡ã€å†™å…¥å‹åŠ›ã€èŠ‚ç‚¹æ•°é‡ç­‰ç»¼åˆè€ƒé‡åè®¾å®šï¼Œç„¶åæ ¹æ®æ•°æ®å¢é•¿çŠ¶æ€å®šæœŸæ£€æµ‹ä¸‹shardæ•°é‡æ˜¯å¦åˆç†ã€‚åŸºç¡€æ¶æ„éƒ¨æ•°æ®åº“å›¢é˜Ÿçš„æ¨èæ–¹æ¡ˆæ˜¯ï¼š å¯¹äºæ•°æ®é‡è¾ƒå°ï¼ˆ100GBä»¥ä¸‹ï¼‰çš„indexï¼Œå¾€å¾€å†™å…¥å‹åŠ›æŸ¥è¯¢å‹åŠ›ç›¸å¯¹è¾ƒä½ï¼Œä¸€èˆ¬è®¾ç½®35ä¸ªshardï¼Œnumberofreplicasè®¾ç½®ä¸º1å³å¯ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå…±ä¸¤å‰¯æœ¬ï¼‰ ã€‚å¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼ˆ100GBä»¥ä¸Šï¼‰çš„indexï¼šä¸€èˆ¬æŠŠå•ä¸ªshardçš„æ•°æ®é‡æ§åˆ¶åœ¨ï¼ˆ20GB50GBï¼‰è®©indexå‹åŠ›åˆ†æ‘Šè‡³å¤šä¸ªèŠ‚ç‚¹ï¼šå¯é€šè¿‡index.routing.allocation.totalshardsper_nodeå‚æ•°ï¼Œå¼ºåˆ¶é™å®šä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¯¥indexçš„shardæ•°é‡ï¼Œè®©shardå°½é‡åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šç»¼åˆè€ƒè™‘æ•´ä¸ªindexçš„shardæ•°é‡ï¼Œå¦‚æœshardæ•°é‡ï¼ˆä¸åŒ…æ‹¬å‰¯æœ¬ï¼‰è¶…è¿‡50ä¸ªï¼Œå°±å¾ˆå¯èƒ½å¼•å‘æ‹’ç»ç‡ä¸Šå‡çš„é—®é¢˜ï¼Œæ­¤æ—¶å¯è€ƒè™‘æŠŠè¯¥indexæ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„indexï¼Œåˆ†æ‘Šæ•°æ®é‡ï¼ŒåŒæ—¶é…åˆroutingä½¿ç”¨ï¼Œé™ä½æ¯ä¸ªæŸ¥è¯¢éœ€è¦è®¿é—®çš„shardæ•°é‡ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"ä¿®æ”¹mysqlè¡¨åˆ›å»ºæ—¶é—´","date":"2021-07-14T13:42:53.000Z","path":"wiki/ä¿®æ”¹mysqlè¡¨åˆ›å»ºæ—¶é—´/","text":"ä¿®æ”¹æœåŠ¡å™¨æ—¶é—´date -s &quot;2021-07-14 21:22:10&quot; æ‰§è¡ŒDDLalter table mirror_user comment &#39;ç”¨æˆ·è¡¨&#39;; æœåŠ¡å™¨æ—¶é—´ä¿®æ­£ntpdate ntp1.aliyun.com","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"hutoolå¯¼å‡ºexcel","date":"2021-07-14T13:01:13.000Z","path":"wiki/hutoolå¯¼å‡ºexcel/","text":"å¦‚æœä½ ä»…éœ€ä¸€ä¸ªJavaå¯¼å‡ºexcelçš„å·¥å…·ï¼ŒğŸ‘‡å°±å¯ä»¥æ»¡è¶³ä½ çš„ä¸´æ—¶éœ€æ±‚ï¼Œå½“ç„¶ä»£ç ä¸‹é¢è¿™ä¹ˆå†™è‚¯å®šæ˜¯ä¸è§„èŒƒçš„ï¼Œå¯ä»¥ç¨åå®Œå–„ï¼ æ·»åŠ ä¾èµ–123456789101112131415161718&lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt; &lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.7.4&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;5.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.poi/poi-ooxml --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;5.0.0&lt;/version&gt; &lt;/dependency&gt; æ•°æ®ç±»1234567@Data@Builder@AllArgsConstructor@NoArgsConstructorpublic class IPData &#123; private String ip;&#125; Exportæ–¹æ³•ç¤ºä¾‹12345678910public void export(List&lt;IPData&gt; rows) throws FileNotFoundException &#123; ExcelWriter writer = ExcelUtil.getWriter(true); writer.renameSheet(&quot;æ‰€æœ‰æ•°æ®&quot;); //ç”šè‡³sheetçš„åç§° writer.addHeaderAlias(&quot;ip&quot;, &quot;IP&quot;); writer.write(rows, true); writer.setOnlyAlias(true); FileOutputStream fileOutputStream = new FileOutputStream(&quot;/Users/gaolei/Desktop/IP1.xlsx&quot;); writer.flush(fileOutputStream); writer.close(); &#125;","tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"}]},{"title":"gitå¸¸ç”¨å‘½ä»¤","date":"2021-07-14T01:55:55.000Z","path":"wiki/gitå¸¸ç”¨å‘½ä»¤/","text":"åˆå§‹åŒ–æœ¬åœ°ä»“åº“git initgit add README.mdgit commit -m &quot;first commit&quot;git branch -M mastergit remote add origin git@github.com:XXXXXgit push -u origin master æ‰¹é‡åˆ é™¤åˆ†æ”¯è¿œç¨‹ï¼šgit branch -r| grep &#39;ss-1&#39; | sed &#39;s/origin\\///g&#39; | xargs -I &#123;&#125; git push origin :&#123;&#125;æœ¬åœ°ï¼šgit branch -a | grep &#39;feature-re-1&#39; | xargs git branch -D","tags":[{"name":"git","slug":"git","permalink":"http://example.com/tags/git/"}],"categories":[{"name":"Develop Tools","slug":"Develop-Tools","permalink":"http://example.com/categories/Develop-Tools/"},{"name":"Git","slug":"Develop-Tools/Git","permalink":"http://example.com/categories/Develop-Tools/Git/"}]},{"title":"Linuxå¸¸ç”¨å‘½ä»¤","date":"2021-07-13T03:44:22.000Z","path":"wiki/Linuxå¸¸ç”¨å‘½ä»¤/","text":"ç”¨æˆ·ç›¸å…³æ–‡ä»¶ç›¸å…³æ—¥å¿—ç›¸å…³ linux åœ¨æ–‡æ¡£ä¸­æŸ¥æ‰¾å…³é”®å­—ä¸ªæ•°grep -o â€œå…³é”®å­—â€ æ–‡æ¡£å | wc -l grep -o â€œå…³é”®å­—â€ æ–‡æ¡£å | sort | uniq -c æ¸…é™¤historyè®°å½•vim .bash_historyå‘½ä»¤æ¨¡å¼ä¸‹ï¼ˆEscä¹‹åè¾“å…¥:ï¼‰ è¾“å…¥ set nu æ¯è¡Œæ•°æ®å‰é¢æ˜¾ç¤ºè¡Œå·11,20d å›è½¦ 11ï½20è¡Œçš„è®°å½•å°±è¢«åˆ é™¤äº†ç„¶åå‘½ä»¤æ¨¡å¼ä¸‹ wq ä¿å­˜é€€å‡ºå°±å¯ä»¥äº†å¦‚æœåœ¨æ­¤æŸ¥çœ‹è¿˜æ˜¯æœ‰è®°å½•ï¼Œå¯ä»¥é€€å‡ºå½“å‰å›è¯ä¹‹åï¼Œå†è¿›å»æŸ¥çœ‹ï¼Œå°±ä¼šä¸å†æ˜¾ç¤ºåˆ é™¤çš„è®°å½•äº†","tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"}],"categories":[{"name":"Linux System","slug":"Linux-System","permalink":"http://example.com/categories/Linux-System/"},{"name":"Common commands","slug":"Linux-System/Common-commands","permalink":"http://example.com/categories/Linux-System/Common-commands/"}]},{"title":"æ®µåˆå¹¶","date":"2021-07-08T12:57:54.000Z","path":"wiki/æ®µåˆå¹¶/","text":"å‚è€ƒèµ„æ–™ learnku.com","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"ç»Ÿè®¡å»é‡æ•°æ® (è¿‘ä¼¼åº¦é‡)","date":"2021-07-08T08:09:05.000Z","path":"wiki/ç»Ÿè®¡å»é‡æ•°æ®/","text":"cardinalityç”¨æ³•å¸¸ç”¨å†™æ³•å¦‚ä¸‹ğŸ‘‡curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 123456789101112131415161718&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;months&quot; : &#123; &quot;date_histogram&quot;: &#123; &quot;field&quot;: &quot;sold&quot;, &quot;interval&quot;: &quot;month&quot; &#125;, &quot;aggs&quot;: &#123; &quot;distinct_colors&quot; : &#123; &quot;cardinality&quot; : &#123; &quot;field&quot; : &quot;color&quot; &#125; &#125; &#125; &#125; &#125;&#125; ç²¾åº¦é—®é¢˜cardinality åº¦é‡æ˜¯ä¸€ä¸ª è¿‘ä¼¼ç®—æ³•ã€‚ å®ƒæ˜¯åŸºäº HyperLogLog++ ï¼ˆHLLï¼‰ç®—æ³•çš„ã€‚ HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚ æˆ‘ä»¬ä¸éœ€è¦ç†è§£æŠ€æœ¯ç»†èŠ‚ï¼Œ ä½†æˆ‘ä»¬æœ€å¥½åº”è¯¥å…³æ³¨ä¸€ä¸‹è¿™ä¸ªç®—æ³•çš„ ç‰¹æ€§ ï¼š å¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ã€‚ å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ã€‚ è¦é…ç½®ç²¾åº¦ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®š precision_threshold å‚æ•°çš„å€¼ã€‚ è¿™ä¸ªé˜ˆå€¼å®šä¹‰äº†åœ¨ä½•ç§åŸºæ•°æ°´å¹³ä¸‹æˆ‘ä»¬å¸Œæœ›å¾—åˆ°ä¸€ä¸ªè¿‘ä¹ç²¾ç¡®çš„ç»“æœã€‚å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ï¼š curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 1234567891011&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;distinct_colors&quot; : &#123; &quot;cardinality&quot; : &#123; &quot;field&quot; : &quot;color&quot;, &quot;precision_threshold&quot; : 100 &#125; &#125; &#125;&#125; âš ï¸ âš ï¸precision_threshold æ¥å— 0â€“40000 ä¹‹é—´çš„æ•°å­—ï¼Œæ›´å¤§çš„å€¼è¿˜æ˜¯ä¼šè¢«å½“ä½œ 40000 æ¥å¤„ç† ç¤ºä¾‹ä¼šç¡®ä¿å½“å­—æ®µå”¯ä¸€å€¼åœ¨ 100 ä»¥å†…æ—¶ä¼šå¾—åˆ°éå¸¸å‡†ç¡®çš„ç»“æœã€‚å°½ç®¡ç®—æ³•æ˜¯æ— æ³•ä¿è¯è¿™ç‚¹çš„ï¼Œä½†å¦‚æœåŸºæ•°åœ¨é˜ˆå€¼ä»¥ä¸‹ï¼Œå‡ ä¹æ€»æ˜¯ 100% æ­£ç¡®çš„ã€‚é«˜äºé˜ˆå€¼çš„åŸºæ•°ä¼šå¼€å§‹èŠ‚çœå†…å­˜è€Œç‰ºç‰²å‡†ç¡®åº¦ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹åº¦é‡ç»“æœå¸¦å…¥è¯¯å·®ã€‚ å¯¹äºæŒ‡å®šçš„é˜ˆå€¼ï¼ŒHLL çš„æ•°æ®ç»“æ„ä¼šå¤§æ¦‚ä½¿ç”¨ precision_threshold * 8 å­—èŠ‚çš„å†…å­˜ï¼Œæ‰€ä»¥å°±å¿…é¡»åœ¨ç‰ºç‰²å†…å­˜å’Œè·å¾—é¢å¤–çš„å‡†ç¡®åº¦é—´åšå¹³è¡¡ã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ 100 çš„é˜ˆå€¼å¯ä»¥åœ¨å”¯ä¸€å€¼ä¸ºç™¾ä¸‡çš„æƒ…å†µä¸‹ä»ç„¶å°†è¯¯å·®ç»´æŒ 5% ä»¥å†… é€Ÿåº¦é—®é¢˜å¦‚æœæƒ³è¦è·å¾—å”¯ä¸€å€¼çš„æ•°ç›®ï¼Œ é€šå¸¸ éœ€è¦æŸ¥è¯¢æ•´ä¸ªæ•°æ®é›†åˆï¼ˆæˆ–å‡ ä¹æ‰€æœ‰æ•°æ®ï¼‰ã€‚ æ‰€æœ‰åŸºäºæ‰€æœ‰æ•°æ®çš„æ“ä½œéƒ½å¿…é¡»è¿…é€Ÿï¼ŒåŸå› æ˜¯æ˜¾ç„¶çš„ã€‚ HyperLogLog çš„é€Ÿåº¦å·²ç»å¾ˆå¿«äº†ï¼Œå®ƒåªæ˜¯ç®€å•çš„å¯¹æ•°æ®åšå“ˆå¸Œä»¥åŠä¸€äº›ä½æ“ä½œã€‚ ä½†å¦‚æœé€Ÿåº¦å¯¹æˆ‘ä»¬è‡³å…³é‡è¦ï¼Œå¯ä»¥åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚ å› ä¸º HLL åªéœ€è¦å­—æ®µå†…å®¹çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç´¢å¼•æ—¶å°±é¢„å…ˆè®¡ç®—å¥½ã€‚ å°±èƒ½åœ¨æŸ¥è¯¢æ—¶è·³è¿‡å“ˆå¸Œè®¡ç®—ç„¶åå°†å“ˆå¸Œå€¼ä» fielddata ç›´æ¥åŠ è½½å‡ºæ¥ã€‚ é¢„å…ˆè®¡ç®—å“ˆå¸Œå€¼åªå¯¹å†…å®¹å¾ˆé•¿æˆ–è€…åŸºæ•°å¾ˆé«˜çš„å­—æ®µæœ‰ç”¨ï¼Œè®¡ç®—è¿™äº›å­—æ®µçš„å“ˆå¸Œå€¼çš„æ¶ˆè€—åœ¨æŸ¥è¯¢æ—¶æ˜¯æ— æ³•å¿½ç•¥çš„ã€‚ å°½ç®¡æ•°å€¼å­—æ®µçš„å“ˆå¸Œè®¡ç®—æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œå­˜å‚¨å®ƒä»¬çš„åŸå§‹å€¼é€šå¸¸éœ€è¦åŒæ ·ï¼ˆæˆ–æ›´å°‘ï¼‰çš„å†…å­˜ç©ºé—´ã€‚è¿™å¯¹ä½åŸºæ•°çš„å­—ç¬¦ä¸²å­—æ®µåŒæ ·é€‚ç”¨ï¼ŒElasticsearch çš„å†…éƒ¨ä¼˜åŒ–èƒ½å¤Ÿä¿è¯æ¯ä¸ªå”¯ä¸€å€¼åªè®¡ç®—ä¸€æ¬¡å“ˆå¸Œã€‚ åŸºæœ¬ä¸Šè¯´ï¼Œé¢„å…ˆè®¡ç®—å¹¶ä¸èƒ½ä¿è¯æ‰€æœ‰çš„å­—æ®µéƒ½æ›´å¿«ï¼Œå®ƒåªå¯¹é‚£äº›å…·æœ‰é«˜åŸºæ•°å’Œ/æˆ–è€…å†…å®¹å¾ˆé•¿çš„å­—ç¬¦ä¸²å­—æ®µæœ‰ä½œç”¨ã€‚éœ€è¦è®°ä½çš„æ˜¯ï¼Œé¢„è®¡ç®—åªæ˜¯ç®€å•çš„å°†æŸ¥è¯¢æ¶ˆè€—çš„æ—¶é—´æå‰è½¬ç§»åˆ°ç´¢å¼•æ—¶ï¼Œå¹¶éæ²¡æœ‰ä»»ä½•ä»£ä»·ï¼ŒåŒºåˆ«åœ¨äºä½ å¯ä»¥é€‰æ‹©åœ¨ ä»€ä¹ˆæ—¶å€™ åšè¿™ä»¶äº‹ï¼Œè¦ä¹ˆåœ¨ç´¢å¼•æ—¶ï¼Œè¦ä¹ˆåœ¨æŸ¥è¯¢æ—¶ã€‚ åˆ›å»ºç´¢å¼•æ—¶æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 1234567891011121314151617PUT /cars/&#123; &quot;mappings&quot;: &#123; &quot;transactions&quot;: &#123; &quot;properties&quot;: &#123; &quot;color&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;fields&quot;: &#123; &quot;hash&quot;: &#123; &quot;type&quot;: &quot;murmur3&quot; &#125; &#125; &#125; &#125; &#125; &#125;&#125; å¤šå€¼å­—æ®µçš„ç±»å‹æ˜¯ murmur3 ï¼Œè¿™æ˜¯ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ã€‚ ç°åœ¨å½“æˆ‘ä»¬æ‰§è¡Œèšåˆæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ color.hash å­—æ®µè€Œä¸æ˜¯ color å­—æ®µï¼šcurl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 12345678910&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;distinct_colors&quot; : &#123; &quot;cardinality&quot; : &#123; &quot;field&quot; : &quot;color.hash&quot; &#125; &#125; &#125;&#125; ç°åœ¨ cardinality åº¦é‡ä¼šè¯»å– â€œcolor.hashâ€œ é‡Œçš„å€¼ï¼ˆé¢„å…ˆè®¡ç®—çš„å“ˆå¸Œå€¼ï¼‰ï¼Œå–ä»£åŠ¨æ€è®¡ç®—åŸå§‹å€¼çš„å“ˆå¸Œã€‚ å•ä¸ªæ–‡æ¡£èŠ‚çœçš„æ—¶é—´æ˜¯éå¸¸å°‘çš„ï¼Œä½†æ˜¯å¦‚æœä½ èšåˆä¸€äº¿æ•°æ®ï¼Œæ¯ä¸ªå­—æ®µå¤šèŠ±è´¹ 10 çº³ç§’çš„æ—¶é—´ï¼Œé‚£ä¹ˆåœ¨æ¯æ¬¡æŸ¥è¯¢æ—¶éƒ½ä¼šé¢å¤–å¢åŠ  1 ç§’ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨éå¸¸å¤§é‡çš„æ•°æ®é‡Œé¢ä½¿ç”¨ cardinality ï¼Œæˆ‘ä»¬å¯ä»¥æƒè¡¡ä½¿ç”¨é¢„è®¡ç®—çš„æ„ä¹‰ï¼Œæ˜¯å¦éœ€è¦æå‰è®¡ç®— hashï¼Œä»è€Œåœ¨æŸ¥è¯¢æ—¶è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œåšä¸€äº›æ€§èƒ½æµ‹è¯•æ¥æ£€éªŒé¢„è®¡ç®—å“ˆå¸Œæ˜¯å¦é€‚ç”¨äºä½ çš„åº”ç”¨åœºæ™¯ã€‚ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"å¤šæ¡¶æ’åº","date":"2021-07-08T07:50:24.000Z","path":"wiki/å¤šæ¡¶æ’åº/","text":"å¤šå€¼æ¡¶ï¼ˆ terms ã€ histogram å’Œ date_histogram ï¼‰åŠ¨æ€ç”Ÿæˆå¾ˆå¤šæ¡¶ã€‚ Elasticsearch æ˜¯å¦‚ä½•å†³å®šè¿™äº›æ¡¶å±•ç¤ºç»™ç”¨æˆ·çš„é¡ºåºå‘¢ï¼Ÿ é»˜è®¤çš„ï¼Œæ¡¶ä¼šæ ¹æ® doc_count é™åºæ’åˆ—ã€‚è¿™æ˜¯ä¸€ä¸ªå¥½çš„é»˜è®¤è¡Œä¸ºï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬æƒ³è¦æ‰¾åˆ°æ–‡æ¡£ä¸­ä¸æŸ¥è¯¢æ¡ä»¶ç›¸å…³çš„æœ€å¤§å€¼ï¼šå”®ä»·ã€äººå£æ•°é‡ã€é¢‘ç‡ã€‚ä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›èƒ½ä¿®æ”¹è¿™ä¸ªé¡ºåºï¼Œä¸åŒçš„æ¡¶æœ‰ç€ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚ å†…ç½®æ’åºè¿™äº›æ’åºæ¨¡å¼æ˜¯æ¡¶ å›ºæœ‰çš„ èƒ½åŠ›ï¼šå®ƒä»¬æ“ä½œæ¡¶ç”Ÿæˆçš„æ•°æ® ï¼Œæ¯”å¦‚ doc_count ã€‚ å®ƒä»¬å…±äº«ç›¸åŒçš„è¯­æ³•ï¼Œä½†æ˜¯æ ¹æ®ä½¿ç”¨æ¡¶çš„ä¸åŒä¼šæœ‰äº›ç»†å¾®å·®åˆ«ã€‚ è®©æˆ‘ä»¬åšä¸€ä¸ª terms èšåˆä½†æ˜¯æŒ‰ doc_count å€¼çš„å‡åºæ’åºï¼š curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 1234567891011121314&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;colors&quot; : &#123; &quot;terms&quot; : &#123; &quot;field&quot; : &quot;color&quot;, &quot;order&quot;: &#123; &quot;_count&quot; : &quot;asc&quot; &#125; &#125; &#125; &#125;&#125;&#x27; ç”¨å…³é”®å­— _count ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ doc_count å€¼çš„å‡åºæ’åºã€‚ æˆ‘ä»¬ä¸ºèšåˆå¼•å…¥äº†ä¸€ä¸ª order å¯¹è±¡ï¼Œ å®ƒå…è®¸æˆ‘ä»¬å¯ä»¥æ ¹æ®ä»¥ä¸‹å‡ ä¸ªå€¼ä¸­çš„ä¸€ä¸ªå€¼è¿›è¡Œæ’åºï¼š _countæŒ‰æ–‡æ¡£æ•°æ’åºã€‚å¯¹ terms ã€ histogram ã€ date_histogram æœ‰æ•ˆã€‚ _termæŒ‰è¯é¡¹çš„å­—ç¬¦ä¸²å€¼çš„å­—æ¯é¡ºåºæ’åºã€‚åªåœ¨ terms å†…ä½¿ç”¨ã€‚ _keyæŒ‰æ¯ä¸ªæ¡¶çš„é”®å€¼æ•°å€¼æ’åºï¼ˆç†è®ºä¸Šä¸ _term ç±»ä¼¼ï¼‰ã€‚ åªåœ¨ histogram å’Œ date_histogram å†…ä½¿ç”¨ã€‚ æŒ‰åº¦é‡æ’åºæœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šæƒ³åŸºäºåº¦é‡è®¡ç®—çš„ç»“æœå€¼è¿›è¡Œæ’åºã€‚ åœ¨æˆ‘ä»¬çš„æ±½è½¦é”€å”®åˆ†æä»ªè¡¨ç›˜ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³æŒ‰ç…§æ±½è½¦é¢œè‰²åˆ›å»ºä¸€ä¸ªé”€å”®æ¡çŠ¶å›¾è¡¨ï¼Œä½†æŒ‰ç…§æ±½è½¦å¹³å‡å”®ä»·çš„å‡åºè¿›è¡Œæ’åºã€‚ æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªåº¦é‡ï¼Œå†æŒ‡å®š order å‚æ•°å¼•ç”¨è¿™ä¸ªåº¦é‡å³å¯ï¼š curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 1234567891011121314151617181920&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;colors&quot; : &#123; &quot;terms&quot; : &#123; &quot;field&quot; : &quot;color&quot;, &quot;order&quot;: &#123; &quot;avg_price&quot; : &quot;asc&quot; &#125; &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123;&quot;field&quot;: &quot;price&quot;&#125; &#125; &#125; &#125; &#125;&#125;&#x27; è®¡ç®—æ¯ä¸ªæ¡¶çš„å¹³å‡å”®ä»·ã€‚ æ¡¶æŒ‰ç…§è®¡ç®—å¹³å‡å€¼çš„å‡åºæ’åºã€‚ æˆ‘ä»¬å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ç”¨ä»»ä½•åº¦é‡æ’åºï¼Œåªéœ€ç®€å•çš„å¼•ç”¨åº¦é‡çš„åå­—ã€‚ä¸è¿‡æœ‰äº›åº¦é‡ä¼šè¾“å‡ºå¤šä¸ªå€¼ã€‚ extended_stats åº¦é‡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼šå®ƒè¾“å‡ºå¥½å‡ ä¸ªåº¦é‡å€¼ã€‚ å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å¤šå€¼åº¦é‡è¿›è¡Œæ’åºï¼Œ æˆ‘ä»¬åªéœ€ä»¥å…³å¿ƒçš„åº¦é‡ä¸ºå…³é”®è¯ä½¿ç”¨ç‚¹å¼è·¯å¾„ï¼šcurl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 123456789101112131415161718&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;colors&quot; : &#123; &quot;terms&quot; : &#123; &quot;field&quot; : &quot;color&quot;, &quot;order&quot;: &#123; &quot;stats.variance&quot; : &quot;asc&quot; &#125; &#125;, &quot;aggs&quot;: &#123; &quot;stats&quot;: &#123; &quot;extended_stats&quot;: &#123;&quot;field&quot;: &quot;price&quot;&#125; &#125; &#125; &#125; &#125;&#125; ä½¿ç”¨ . ç¬¦å·ï¼Œæ ¹æ®æ„Ÿå…´è¶£çš„åº¦é‡è¿›è¡Œæ’åºã€‚ æ·±åº¦åº¦é‡æ’åºåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œåº¦é‡æ˜¯æ¡¶çš„ç›´æ¥å­èŠ‚ç‚¹ã€‚å¹³å‡å”®ä»·æ˜¯æ ¹æ®æ¯ä¸ª term æ¥è®¡ç®—çš„ã€‚ åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰å¯èƒ½å¯¹ æ›´æ·± çš„åº¦é‡è¿›è¡Œæ’åºï¼Œæ¯”å¦‚å­™å­æ¡¶æˆ–ä»å­™æ¡¶ã€‚ æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›´æ·±çš„è·¯å¾„ï¼Œå°†åº¦é‡ç”¨å°–æ‹¬å·ï¼ˆ &gt; ï¼‰åµŒå¥—èµ·æ¥ï¼Œåƒè¿™æ ·ï¼š my_bucket&gt;another_bucket&gt;metric ã€‚ éœ€è¦æé†’çš„æ˜¯åµŒå¥—è·¯å¾„ä¸Šçš„æ¯ä¸ªæ¡¶éƒ½å¿…é¡»æ˜¯ å•å€¼ çš„ã€‚ filter æ¡¶ç”Ÿæˆ ä¸€ä¸ªå•å€¼æ¡¶ï¼šæ‰€æœ‰ä¸è¿‡æ»¤æ¡ä»¶åŒ¹é…çš„æ–‡æ¡£éƒ½åœ¨æ¡¶ä¸­ã€‚ å¤šå€¼æ¡¶ï¼ˆå¦‚ï¼šterms ï¼‰åŠ¨æ€ç”Ÿæˆè®¸å¤šæ¡¶ï¼Œæ— æ³•é€šè¿‡æŒ‡å®šä¸€ä¸ªç¡®å®šè·¯å¾„æ¥è¯†åˆ«ã€‚ ç›®å‰ï¼Œåªæœ‰ä¸‰ä¸ªå•å€¼æ¡¶ï¼š filter ã€ global å’Œ reverse_nested ã€‚è®©æˆ‘ä»¬å¿«é€Ÿç”¨ç¤ºä¾‹è¯´æ˜ï¼Œåˆ›å»ºä¸€ä¸ªæ±½è½¦å”®ä»·çš„ç›´æ–¹å›¾ï¼Œä½†æ˜¯æŒ‰ç…§çº¢è‰²å’Œç»¿è‰²ï¼ˆä¸åŒ…æ‹¬è“è‰²ï¼‰è½¦å„è‡ªçš„æ–¹å·®æ¥æ’åºï¼š curl -X GET &quot;localhost:9200/cars/transactions/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d&#39; 123456789101112131415161718192021222324&#123; &quot;size&quot; : 0, &quot;aggs&quot; : &#123; &quot;colors&quot; : &#123; &quot;histogram&quot; : &#123; &quot;field&quot; : &quot;price&quot;, &quot;interval&quot;: 20000, &quot;order&quot;: &#123; &quot;red_green_cars&gt;tats.variance&quot; : &quot;asc&quot; &#125; &#125;, &quot;aggs&quot;: &#123; &quot;red_green_cars&quot;: &#123; &quot;filter&quot;: &#123; &quot;terms&quot;: &#123;&quot;color&quot;: [&quot;red&quot;, &quot;green&quot;]&#125;&#125;, &quot;aggs&quot;: &#123; &quot;stats&quot;: &#123;&quot;extended_stats&quot;: &#123;&quot;field&quot; : &quot;price&quot;&#125;&#125; &#125; &#125; &#125; &#125; &#125;&#125;&#x27; æŒ‰ç…§åµŒå¥—åº¦é‡çš„æ–¹å·®å¯¹æ¡¶çš„ç›´æ–¹å›¾è¿›è¡Œæ’åºã€‚ å› ä¸ºæˆ‘ä»¬ä½¿ç”¨å•å€¼è¿‡æ»¤å™¨ filter ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå¥—æ’åºã€‚ æŒ‰ç…§ç”Ÿæˆçš„åº¦é‡å¯¹ç»Ÿè®¡ç»“æœè¿›è¡Œæ’åºã€‚ æœ¬ä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¦‚ä½•è®¿é—®ä¸€ä¸ªåµŒå¥—çš„åº¦é‡ã€‚ stats åº¦é‡æ˜¯ red_green_cars èšåˆçš„å­èŠ‚ç‚¹ï¼Œè€Œ red_green_cars åˆæ˜¯ colors èšåˆçš„å­èŠ‚ç‚¹ã€‚ ä¸ºäº†æ ¹æ®è¿™ä¸ªåº¦é‡æ’åºï¼Œæˆ‘ä»¬å®šä¹‰äº†è·¯å¾„ red_green_cars&gt;tats.variance ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼Œå› ä¸º filter æ¡¶æ˜¯ä¸ªå•å€¼æ¡¶ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"è¿‡æ»¤å’Œèšåˆ","date":"2021-07-08T07:33:26.000Z","path":"wiki/è¿‡æ»¤å’Œèšåˆ/","text":"è¿‡æ»¤å’ŒèšåˆèšåˆèŒƒå›´é™å®šè¿˜æœ‰ä¸€ä¸ªè‡ªç„¶çš„æ‰©å±•å°±æ˜¯è¿‡æ»¤ã€‚å› ä¸ºèšåˆæ˜¯åœ¨æŸ¥è¯¢ç»“æœèŒƒå›´å†…æ“ä½œçš„ï¼Œä»»ä½•å¯ä»¥é€‚ç”¨äºæŸ¥è¯¢çš„è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥åº”ç”¨åœ¨èšåˆä¸Šã€‚ è¿‡æ»¤å¦‚æœæˆ‘ä»¬æƒ³æ‰¾åˆ°å”®ä»·åœ¨ $10,000 ç¾å…ƒä¹‹ä¸Šçš„æ‰€æœ‰æ±½è½¦åŒæ—¶ä¹Ÿä¸ºè¿™äº›è½¦è®¡ç®—å¹³å‡å”®ä»·ï¼Œ å¯ä»¥ç®€å•åœ°ä½¿ç”¨ä¸€ä¸ª constant_score æŸ¥è¯¢å’Œ filter çº¦æŸï¼š GET /cars/transactions/_search 12345678910111213141516171819&#123; &quot;size&quot; : 0, &quot;query&quot; : &#123; &quot;constant_score&quot;: &#123; &quot;filter&quot;: &#123; &quot;range&quot;: &#123; &quot;price&quot;: &#123; &quot;gte&quot;: 10000 &#125; &#125; &#125; &#125; &#125;, &quot;aggs&quot; : &#123; &quot;single_avg_price&quot;: &#123; &quot;avg&quot; : &#123; &quot;field&quot; : &quot;price&quot; &#125; &#125; &#125;&#125; ä»æ ¹æœ¬ä¸Šè®²ï¼Œä½¿ç”¨ non-scoring æŸ¥è¯¢å’Œä½¿ç”¨ match æŸ¥è¯¢æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚æŸ¥è¯¢ï¼ˆåŒ…æ‹¬äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼‰è¿”å›ä¸€ç»„æ–‡æ¡£çš„å­é›†ï¼Œèšåˆæ­£æ˜¯æ“ä½œè¿™äº›æ–‡æ¡£ã€‚ä½¿ç”¨ filtering query ä¼šå¿½ç•¥è¯„åˆ†ï¼Œå¹¶æœ‰å¯èƒ½ä¼šç¼“å­˜ç»“æœæ•°æ®ç­‰ç­‰ã€‚ è¿‡æ»¤æ¡¶ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæƒ³å¯¹èšåˆç»“æœè¿‡æ»¤æ€ä¹ˆåŠï¼Ÿ å‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºæ±½è½¦ç»é”€å•†åˆ›å»ºä¸€ä¸ªæœç´¢é¡µé¢ï¼Œ æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºç”¨æˆ·æœç´¢çš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶ä¹Ÿæƒ³åœ¨é¡µé¢ä¸Šæä¾›æ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼ˆä¸æœç´¢åŒ¹é…çš„ï¼‰ä¸Šä¸ªæœˆåº¦æ±½è½¦çš„å¹³å‡å”®ä»·ã€‚ è¿™é‡Œæˆ‘ä»¬æ— æ³•ç®€å•çš„åšèŒƒå›´é™å®šï¼Œå› ä¸ºæœ‰ä¸¤ä¸ªä¸åŒçš„æ¡ä»¶ã€‚æœç´¢ç»“æœå¿…é¡»æ˜¯ ford ï¼Œä½†æ˜¯èšåˆç»“æœå¿…é¡»æ»¡è¶³ ford AND sold &gt; now - 1M ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§ç‰¹æ®Šçš„æ¡¶ï¼Œå«åš filter ï¼ˆæ³¨ï¼šè¿‡æ»¤æ¡¶ï¼‰ ã€‚ æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªè¿‡æ»¤æ¡¶ï¼Œå½“æ–‡æ¡£æ»¡è¶³è¿‡æ»¤æ¡¶çš„æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åŠ å…¥åˆ°æ¡¶å†…ã€‚ æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼šGET /cars/transactions/_search 1234567891011121314151617181920212223242526&#123; &quot;size&quot; : 0, &quot;query&quot;:&#123; &quot;match&quot;: &#123; &quot;make&quot;: &quot;ford&quot; &#125; &#125;, &quot;aggs&quot;:&#123; &quot;recent_sales&quot;: &#123; &quot;filter&quot;: &#123; &quot;range&quot;: &#123; &quot;sold&quot;: &#123; &quot;from&quot;: &quot;now-1M&quot; &#125; &#125; &#125;, &quot;aggs&quot;: &#123; &quot;average_price&quot;:&#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125; &#125; &#125; &#125;&#125; ä½¿ç”¨ è¿‡æ»¤ æ¡¶åœ¨ æŸ¥è¯¢ èŒƒå›´åŸºç¡€ä¸Šåº”ç”¨è¿‡æ»¤å™¨ã€‚ avg åº¦é‡åªä¼šå¯¹ ford å’Œä¸Šä¸ªæœˆå”®å‡ºçš„æ–‡æ¡£è®¡ç®—å¹³å‡å”®ä»·ã€‚ å› ä¸º filter æ¡¶å’Œå…¶ä»–æ¡¶çš„æ“ä½œæ–¹å¼ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥éšæ„å°†å…¶ä»–æ¡¶å’Œåº¦é‡åµŒå…¥å…¶ä¸­ã€‚æ‰€æœ‰åµŒå¥—çš„ç»„ä»¶éƒ½ä¼š â€œç»§æ‰¿â€ è¿™ä¸ªè¿‡æ»¤ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥æŒ‰éœ€é’ˆå¯¹èšåˆè¿‡æ»¤å‡ºé€‰æ‹©éƒ¨åˆ†ã€‚ åè¿‡æ»¤å™¨ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å¯¹æœç´¢ç»“æœå’Œèšåˆç»“æœè¿›è¡Œè¿‡æ»¤ï¼ˆä¸è®¡ç®—å¾—åˆ†çš„ filter æŸ¥è¯¢ï¼‰ï¼Œä»¥åŠé’ˆå¯¹èšåˆç»“æœçš„ä¸€éƒ¨åˆ†è¿›è¡Œè¿‡æ»¤ï¼ˆ filter æ¡¶ï¼‰ã€‚ æˆ‘ä»¬å¯èƒ½ä¼šæƒ³ï¼Œâ€åªè¿‡æ»¤æœç´¢ç»“æœï¼Œä¸è¿‡æ»¤èšåˆç»“æœå‘¢ï¼Ÿâ€ ç­”æ¡ˆæ˜¯ä½¿ç”¨ post_filter ã€‚ å®ƒæ˜¯æ¥æ”¶ä¸€ä¸ªè¿‡æ»¤å™¨çš„é¡¶å±‚æœç´¢è¯·æ±‚å…ƒç´ ã€‚è¿™ä¸ªè¿‡æ»¤å™¨åœ¨æŸ¥è¯¢ ä¹‹å æ‰§è¡Œï¼ˆè¿™æ­£æ˜¯è¯¥è¿‡æ»¤å™¨çš„åå­—çš„ç”±æ¥ï¼šå®ƒåœ¨æŸ¥è¯¢ä¹‹å post æ‰§è¡Œï¼‰ã€‚æ­£å› ä¸ºå®ƒåœ¨æŸ¥è¯¢ä¹‹åæ‰§è¡Œï¼Œå®ƒå¯¹æŸ¥è¯¢èŒƒå›´æ²¡æœ‰ä»»ä½•å½±å“ï¼Œæ‰€ä»¥å¯¹èšåˆä¹Ÿä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªè¡Œä¸ºå¯¹æŸ¥è¯¢æ¡ä»¶åº”ç”¨æ›´å¤šçš„è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çš„æ“ä½œï¼Œå°±å¦‚ UI ä¸Šçš„å„ä¸ªåˆ†ç±»é¢ã€‚è®©æˆ‘ä»¬ä¸ºæ±½è½¦ç»é”€å•†è®¾è®¡å¦å¤–ä¸€ä¸ªæœç´¢é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å…è®¸ç”¨æˆ·æœç´¢æ±½è½¦åŒæ—¶å¯ä»¥æ ¹æ®é¢œè‰²æ¥è¿‡æ»¤ã€‚é¢œè‰²çš„é€‰é¡¹æ˜¯é€šè¿‡èšåˆè·å¾—çš„ï¼š GET /cars/transactions/_search 123456789101112131415161718&#123; &quot;size&quot; : 0, &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;make&quot;: &quot;ford&quot; &#125; &#125;, &quot;post_filter&quot;: &#123; &quot;term&quot; : &#123; &quot;color&quot; : &quot;green&quot; &#125; &#125;, &quot;aggs&quot; : &#123; &quot;all_colors&quot;: &#123; &quot;terms&quot; : &#123; &quot;field&quot; : &quot;color&quot; &#125; &#125; &#125;&#125; post_filter å…ƒç´ æ˜¯ top-level è€Œä¸”ä»…å¯¹å‘½ä¸­ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚ æŸ¥è¯¢ éƒ¨åˆ†æ‰¾åˆ°æ‰€æœ‰çš„ ford æ±½è½¦ï¼Œç„¶åç”¨ terms èšåˆåˆ›å»ºä¸€ä¸ªé¢œè‰²åˆ—è¡¨ã€‚å› ä¸ºèšåˆå¯¹æŸ¥è¯¢èŒƒå›´è¿›è¡Œæ“ä½œï¼Œé¢œè‰²åˆ—è¡¨ä¸ç¦ç‰¹æ±½è½¦æœ‰çš„é¢œè‰²ç›¸å¯¹åº”ã€‚ æœ€åï¼Œ post_filter ä¼šè¿‡æ»¤æœç´¢ç»“æœï¼Œåªå±•ç¤ºç»¿è‰² ford æ±½è½¦ã€‚è¿™åœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ å å‘ç”Ÿï¼Œæ‰€ä»¥èšåˆä¸å—å½±å“ã€‚ è¿™é€šå¸¸å¯¹ UI çš„è¿è´¯ä¸€è‡´æ€§å¾ˆé‡è¦ï¼Œå¯ä»¥æƒ³è±¡ç”¨æˆ·åœ¨ç•Œé¢å•†é€‰æ‹©äº†ä¸€ç±»é¢œè‰²ï¼ˆæ¯”å¦‚ï¼šç»¿è‰²ï¼‰ï¼ŒæœŸæœ›çš„æ˜¯æœç´¢ç»“æœå·²ç»è¢«è¿‡æ»¤äº†ï¼Œè€Œ ä¸æ˜¯ è¿‡æ»¤ç•Œé¢ä¸Šçš„é€‰é¡¹ã€‚å¦‚æœæˆ‘ä»¬åº”ç”¨ filter æŸ¥è¯¢ï¼Œç•Œé¢ä¼šé©¬ä¸Šå˜æˆ åª æ˜¾ç¤º ç»¿è‰² ä½œä¸ºé€‰é¡¹ï¼Œè¿™ä¸æ˜¯ç”¨æˆ·æƒ³è¦çš„ï¼ âš ï¸ âš ï¸ âš ï¸ æ€§èƒ½è€ƒè™‘ï¼ˆPerformance considerationï¼‰å½“ä½ éœ€è¦å¯¹æœç´¢ç»“æœå’Œèšåˆç»“æœåšä¸åŒçš„è¿‡æ»¤æ—¶ï¼Œä½ æ‰åº”è¯¥ä½¿ç”¨ post_filter ï¼Œ æœ‰æ—¶ç”¨æˆ·ä¼šåœ¨æ™®é€šæœç´¢ä½¿ç”¨ post_filter ã€‚ ä¸è¦è¿™ä¹ˆåšï¼ post_filter çš„ç‰¹æ€§æ˜¯åœ¨æŸ¥è¯¢ ä¹‹å æ‰§è¡Œï¼Œä»»ä½•è¿‡æ»¤å¯¹æ€§èƒ½å¸¦æ¥çš„å¥½å¤„ï¼ˆæ¯”å¦‚ç¼“å­˜ï¼‰éƒ½ä¼šå®Œå…¨å¤±å»ã€‚ åœ¨æˆ‘ä»¬éœ€è¦ä¸åŒè¿‡æ»¤æ—¶ï¼Œ post_filter åªä¸èšåˆä¸€èµ·ä½¿ç”¨ã€‚ æ€»ç»“é€‰æ‹©åˆé€‚ç±»å‹çš„è¿‡æ»¤ï¼ˆå¦‚ï¼šæœç´¢å‘½ä¸­ã€èšåˆæˆ–ä¸¤è€…å…¼æœ‰ï¼‰é€šå¸¸å’Œæˆ‘ä»¬æœŸæœ›å¦‚ä½•è¡¨ç°ç”¨æˆ·äº¤äº’æœ‰å…³ã€‚é€‰æ‹©åˆé€‚çš„è¿‡æ»¤å™¨ï¼ˆæˆ–ç»„åˆï¼‰å–å†³äºæˆ‘ä»¬æœŸæœ›å¦‚ä½•å°†ç»“æœå‘ˆç°ç»™ç”¨æˆ·ã€‚ åœ¨ filter è¿‡æ»¤ä¸­çš„ non-scoring æŸ¥è¯¢ï¼ŒåŒæ—¶å½±å“æœç´¢ç»“æœå’Œèšåˆç»“æœã€‚ filter æ¡¶å½±å“èšåˆã€‚ post_filter åªå½±å“æœç´¢ç»“æœã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"èšåˆ æ¡å½¢å›¾","date":"2021-07-08T07:11:57.000Z","path":"wiki/èšåˆ-æ¡å½¢å›¾/","text":"å‚è€ƒèµ„æ–™","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"åµŒå¥—æ¡¶","date":"2021-07-08T07:01:16.000Z","path":"wiki/åµŒå¥—æ¡¶/","text":"ä¸¤å±‚åµŒå¥—åœ¨æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„åµŒå¥—æ–¹æ¡ˆæ—¶ï¼Œèšåˆçš„åŠ›é‡æ‰èƒ½çœŸæ­£å¾—ä»¥æ˜¾ç°ã€‚ åœ¨å‰ä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•å°†ä¸€ä¸ªåº¦é‡åµŒå…¥æ¡¶ä¸­ï¼Œå®ƒçš„åŠŸèƒ½å·²ç»ååˆ†å¼ºå¤§äº†ã€‚ ä½†çœŸæ­£ä»¤äººæ¿€åŠ¨çš„åˆ†ææ¥è‡ªäºå°†æ¡¶åµŒå¥—è¿› å¦å¤–ä¸€ä¸ªæ¡¶ æ‰€èƒ½å¾—åˆ°çš„ç»“æœã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªé¢œè‰²çš„æ±½è½¦åˆ¶é€ å•†çš„åˆ†å¸ƒï¼š GET /cars/transactions/_search 12345678910111213141516171819202122&#123; &quot;size&quot; : 0, &quot;aggs&quot;: &#123; &quot;colors&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;color&quot; &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;make&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;make&quot; &#125; &#125; &#125; &#125; &#125;&#125; æ³¨æ„å‰ä¾‹ä¸­çš„ avg_price åº¦é‡ä»ç„¶ä¿æŒåŸä½ã€‚ å¦ä¸€ä¸ªèšåˆ make è¢«åŠ å…¥åˆ°äº† color é¢œè‰²æ¡¶ä¸­ã€‚ è¿™ä¸ªèšåˆæ˜¯ terms æ¡¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªæ±½è½¦åˆ¶é€ å•†ç”Ÿæˆå”¯ä¸€çš„æ¡¶ã€‚ è¿™é‡Œå‘ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„äº‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè§‚å¯Ÿåˆ°ä¹‹å‰ä¾‹å­ä¸­çš„ avg_price åº¦é‡å®Œå…¨æ²¡æœ‰å˜åŒ–ï¼Œè¿˜åœ¨åŸæ¥çš„ä½ç½®ã€‚ ä¸€ä¸ªèšåˆçš„æ¯ä¸ª å±‚çº§ éƒ½å¯ä»¥æœ‰å¤šä¸ªåº¦é‡æˆ–æ¡¶ï¼Œ avg_price åº¦é‡å‘Šè¯‰æˆ‘ä»¬æ¯ç§é¢œè‰²æ±½è½¦çš„å¹³å‡ä»·æ ¼ã€‚å®ƒä¸å…¶ä»–çš„æ¡¶å’Œåº¦é‡ç›¸äº’ç‹¬ç«‹ã€‚ è¿™å¯¹æˆ‘ä»¬çš„åº”ç”¨éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™é‡Œé¢æœ‰å¾ˆå¤šç›¸äº’å…³è”ï¼Œä½†åˆå®Œå…¨ä¸åŒçš„åº¦é‡éœ€è¦æ”¶é›†ã€‚èšåˆä½¿æˆ‘ä»¬èƒ½å¤Ÿç”¨ä¸€æ¬¡æ•°æ®è¯·æ±‚è·å¾—æ‰€æœ‰çš„è¿™äº›ä¿¡æ¯ã€‚ å¦å¤–ä¸€ä»¶å€¼å¾—æ³¨æ„çš„é‡è¦äº‹æƒ…æ˜¯æˆ‘ä»¬æ–°å¢çš„è¿™ä¸ª make èšåˆï¼Œå®ƒæ˜¯ä¸€ä¸ª terms æ¡¶ï¼ˆåµŒå¥—åœ¨ colors ã€ terms æ¡¶å†…ï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä¼šä¸ºæ•°æ®é›†ä¸­çš„æ¯ä¸ªå”¯ä¸€ç»„åˆç”Ÿæˆï¼ˆ color ã€ make ï¼‰å…ƒç»„ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è¿”å›çš„å“åº”ï¼ˆä¸ºäº†ç®€å•æˆ‘ä»¬åªæ˜¾ç¤ºéƒ¨åˆ†ç»“æœï¼‰ï¼š 1234567891011121314151617181920212223242526&#123; &quot;aggregations&quot;: &#123; &quot;colors&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;red&quot;, &quot;doc_count&quot;: 4, &quot;make&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;honda&quot;, &quot;doc_count&quot;: 3 &#125;, &#123; &quot;key&quot;: &quot;bmw&quot;, &quot;doc_count&quot;: 1 &#125; ] &#125;, &quot;avg_price&quot;: &#123; &quot;value&quot;: 32500 &#125; &#125; &#125; &#125;&#125; æ­£å¦‚æœŸæœ›çš„é‚£æ ·ï¼Œæ–°çš„èšåˆåµŒå…¥åœ¨æ¯ä¸ªé¢œè‰²æ¡¶ä¸­ã€‚ ç°åœ¨æˆ‘ä»¬çœ‹è§æŒ‰ä¸åŒåˆ¶é€ å•†åˆ†è§£çš„æ¯ç§é¢œè‰²ä¸‹è½¦è¾†ä¿¡æ¯ã€‚ æœ€ç»ˆï¼Œæˆ‘ä»¬çœ‹åˆ°å‰ä¾‹ä¸­çš„ avg_price åº¦é‡ä»ç„¶ç»´æŒä¸å˜ã€‚ ä¸‰å±‚åµŒå¥—è®©æˆ‘ä»¬å›åˆ°è¯é¢˜çš„åŸç‚¹ï¼Œåœ¨è¿›å…¥æ–°è¯é¢˜ä¹‹å‰ï¼Œå¯¹æˆ‘ä»¬çš„ç¤ºä¾‹åšæœ€åä¸€ä¸ªä¿®æ”¹ï¼Œ ä¸ºæ¯ä¸ªæ±½è½¦ç”Ÿæˆå•†è®¡ç®—æœ€ä½å’Œæœ€é«˜çš„ä»·æ ¼ï¼šGET /cars/transactions/_search 1234567891011121314151617181920212223&#123; &quot;size&quot; : 0, &quot;aggs&quot;: &#123; &quot;colors&quot;: &#123; &quot;terms&quot;: &#123; &quot;field&quot;: &quot;color&quot; &#125;, &quot;aggs&quot;: &#123; &quot;avg_price&quot;: &#123; &quot;avg&quot;: &#123; &quot;field&quot;: &quot;price&quot; &#125; &#125;, &quot;make&quot; : &#123; &quot;terms&quot; : &#123; &quot;field&quot; : &quot;make&quot; &#125;, &quot;aggs&quot; : &#123; &quot;min_price&quot; : &#123; &quot;min&quot;: &#123; &quot;field&quot;: &quot;price&quot;&#125; &#125;, &quot;max_price&quot; : &#123; &quot;max&quot;: &#123; &quot;field&quot;: &quot;price&quot;&#125; &#125; &#125; &#125; &#125; &#125; &#125;&#125; æˆ‘ä»¬éœ€è¦å¢åŠ å¦å¤–ä¸€ä¸ªåµŒå¥—çš„ aggs å±‚çº§ã€‚ ç„¶ååŒ…æ‹¬ min æœ€å°åº¦é‡ã€‚ ä»¥åŠ max æœ€å¤§åº¦é‡ã€‚ å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼ˆåªæ˜¾ç¤ºéƒ¨åˆ†ç»“æœï¼‰ï¼š 12345678910111213141516171819202122232425262728293031323334353637&#123;... &quot;aggregations&quot;: &#123; &quot;colors&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;red&quot;, &quot;doc_count&quot;: 4, &quot;make&quot;: &#123; &quot;buckets&quot;: [ &#123; &quot;key&quot;: &quot;honda&quot;, &quot;doc_count&quot;: 3, &quot;min_price&quot;: &#123; &quot;value&quot;: 10000 &#125;, &quot;max_price&quot;: &#123; &quot;value&quot;: 20000 &#125; &#125;, &#123; &quot;key&quot;: &quot;bmw&quot;, &quot;doc_count&quot;: 1, &quot;min_price&quot;: &#123; &quot;value&quot;: 80000 &#125;, &quot;max_price&quot;: &#123; &quot;value&quot;: 80000 &#125; &#125; ] &#125;, &quot;avg_price&quot;: &#123; &quot;value&quot;: 32500 &#125; &#125;,... æœ‰äº†è¿™ä¸¤ä¸ªæ¡¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æŸ¥è¯¢çš„ç»“æœè¿›è¡Œæ‰©å±•å¹¶å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š æœ‰å››è¾†çº¢è‰²è½¦ã€‚çº¢è‰²è½¦çš„å¹³å‡å”®ä»·æ˜¯ $32ï¼Œ500 ç¾å…ƒã€‚å…¶ä¸­ä¸‰è¾†çº¢è‰²è½¦æ˜¯ Honda æœ¬ç”°åˆ¶é€ ï¼Œä¸€è¾†æ˜¯ BMW å®é©¬åˆ¶é€ ã€‚æœ€ä¾¿å®œçš„çº¢è‰²æœ¬ç”°å”®ä»·ä¸º $10ï¼Œ000 ç¾å…ƒã€‚æœ€è´µçš„çº¢è‰²æœ¬ç”°å”®ä»·ä¸º $20ï¼Œ000 ç¾å…ƒã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"èšåˆ é«˜çº§æ¦‚å¿µ","date":"2021-07-08T06:52:35.000Z","path":"wiki/èšåˆ-é«˜çº§æ¦‚å¿µ/","text":"æ¡¶æ¡¶ ç®€å•æ¥è¯´å°±æ˜¯æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„æ–‡æ¡£çš„é›†åˆï¼š ä¸€ä¸ªé›‡å‘˜å±äº ç”·æ€§ æ¡¶æˆ–è€… å¥³æ€§ æ¡¶ å¥¥å°”å·´å°¼å±äº çº½çº¦ æ¡¶ æ—¥æœŸ2014-10-28å±äº åæœˆ æ¡¶å½“èšåˆå¼€å§‹è¢«æ‰§è¡Œï¼Œæ¯ä¸ªæ–‡æ¡£é‡Œé¢çš„å€¼é€šè¿‡è®¡ç®—æ¥å†³å®šç¬¦åˆå“ªä¸ªæ¡¶çš„æ¡ä»¶ã€‚å¦‚æœåŒ¹é…åˆ°ï¼Œæ–‡æ¡£å°†æ”¾å…¥ç›¸åº”çš„æ¡¶å¹¶æ¥ç€è¿›è¡Œèšåˆæ“ä½œã€‚ æ¡¶ä¹Ÿå¯ä»¥è¢«åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ï¼Œæä¾›å±‚æ¬¡åŒ–çš„æˆ–è€…æœ‰æ¡ä»¶çš„åˆ’åˆ†æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œè¾›è¾›é‚£æä¼šè¢«æ”¾å…¥ä¿„äº¥ä¿„å·è¿™ä¸ªæ¡¶ï¼Œè€Œ æ•´ä¸ª ä¿„äº¥ä¿„å·æ¡¶ä¼šè¢«æ”¾å…¥ç¾å›½è¿™ä¸ªæ¡¶ã€‚ Elasticsearch æœ‰å¾ˆå¤šç§ç±»å‹çš„æ¡¶ï¼Œèƒ½è®©ä½ é€šè¿‡å¾ˆå¤šç§æ–¹å¼æ¥åˆ’åˆ†æ–‡æ¡£ï¼ˆæ—¶é—´ã€æœ€å—æ¬¢è¿çš„è¯ã€å¹´é¾„åŒºé—´ã€åœ°ç†ä½ç½® ç­‰ç­‰ï¼‰ã€‚å…¶å®æ ¹æœ¬ä¸Šéƒ½æ˜¯é€šè¿‡åŒæ ·çš„åŸç†è¿›è¡Œæ“ä½œï¼šåŸºäºæ¡ä»¶æ¥åˆ’åˆ†æ–‡æ¡£ã€‚ æŒ‡æ ‡æ¡¶èƒ½è®©æˆ‘ä»¬åˆ’åˆ†æ–‡æ¡£åˆ°æœ‰æ„ä¹‰çš„é›†åˆï¼Œä½†æ˜¯æœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯å¯¹è¿™äº›æ¡¶å†…çš„æ–‡æ¡£è¿›è¡Œä¸€äº›æŒ‡æ ‡çš„è®¡ç®—ã€‚åˆ†æ¡¶æ˜¯ä¸€ç§è¾¾åˆ°ç›®çš„çš„æ‰‹æ®µï¼šå®ƒæä¾›äº†ä¸€ç§ç»™æ–‡æ¡£åˆ†ç»„çš„æ–¹æ³•æ¥è®©æˆ‘ä»¬å¯ä»¥è®¡ç®—æ„Ÿå…´è¶£çš„æŒ‡æ ‡ã€‚ å¤§å¤šæ•° æŒ‡æ ‡ æ˜¯ç®€å•çš„æ•°å­¦è¿ç®—ï¼ˆä¾‹å¦‚æœ€å°å€¼ã€å¹³å‡å€¼ã€æœ€å¤§å€¼ï¼Œè¿˜æœ‰æ±‡æ€»ï¼‰ï¼Œè¿™äº›æ˜¯é€šè¿‡æ–‡æ¡£çš„å€¼æ¥è®¡ç®—ã€‚åœ¨å®è·µä¸­ï¼ŒæŒ‡æ ‡èƒ½è®©ä½ è®¡ç®—åƒå¹³å‡è–ªèµ„ã€æœ€é«˜å‡ºå”®ä»·æ ¼ã€95%çš„æŸ¥è¯¢å»¶è¿Ÿè¿™æ ·çš„æ•°æ®ã€‚ æ¡¶å’ŒæŒ‡æ ‡çš„ç»„åˆèšåˆ æ˜¯ç”±æ¡¶å’ŒæŒ‡æ ‡ç»„æˆçš„ã€‚ èšåˆå¯èƒ½åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå¯èƒ½åªæœ‰ä¸€ä¸ªæŒ‡æ ‡ï¼Œæˆ–è€…å¯èƒ½ä¸¤ä¸ªéƒ½æœ‰ã€‚ä¹Ÿæœ‰å¯èƒ½æœ‰ä¸€äº›æ¡¶åµŒå¥—åœ¨å…¶ä»–æ¡¶é‡Œé¢ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰€å±å›½å®¶æ¥åˆ’åˆ†æ–‡æ¡£ï¼ˆæ¡¶ï¼‰ï¼Œç„¶åè®¡ç®—æ¯ä¸ªå›½å®¶çš„å¹³å‡è–ªé…¬ï¼ˆæŒ‡æ ‡ï¼‰ã€‚ ç”±äºæ¡¶å¯ä»¥è¢«åµŒå¥—ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°éå¸¸å¤šå¹¶ä¸”éå¸¸å¤æ‚çš„èšåˆï¼š 1.é€šè¿‡å›½å®¶åˆ’åˆ†æ–‡æ¡£ï¼ˆæ¡¶ï¼‰ 2.ç„¶åé€šè¿‡æ€§åˆ«åˆ’åˆ†æ¯ä¸ªå›½å®¶ï¼ˆæ¡¶ï¼‰ 3.ç„¶åé€šè¿‡å¹´é¾„åŒºé—´åˆ’åˆ†æ¯ç§æ€§åˆ«ï¼ˆæ¡¶ï¼‰ 4.æœ€åï¼Œä¸ºæ¯ä¸ªå¹´é¾„åŒºé—´è®¡ç®—å¹³å‡è–ªé…¬ï¼ˆæŒ‡æ ‡ï¼‰ æœ€åå°†å‘Šè¯‰ä½ æ¯ä¸ª &lt;å›½å®¶, æ€§åˆ«, å¹´é¾„&gt; ç»„åˆçš„å¹³å‡è–ªé…¬ã€‚æ‰€æœ‰çš„è¿™äº›éƒ½åœ¨ä¸€ä¸ªè¯·æ±‚å†…å®Œæˆå¹¶ä¸”åªéå†ä¸€æ¬¡æ•°æ®ï¼","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"}]},{"title":"elasticsearch-overview","date":"2021-07-08T03:17:58.000Z","path":"wiki/elasticsearch-overview/","text":"å­¦ä¹ èµ„æ–™ https://www.codingdict.com/ https://elasticsearch.cn/ https://www.elastic.co/guide/en/ é“­æ¯…å¤©ä¸‹","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"å…³äº Elasticsearch å†…å­˜å ç”¨åŠåˆ†é…","date":"2021-07-08T02:39:16.000Z","path":"wiki/å…³äº-Elasticsearch-å†…å­˜å ç”¨åŠåˆ†é…/","text":"Elasticsearch å’Œ Lucene å¯¹å†…å­˜ä½¿ç”¨æƒ…å†µï¼š Elasticsearch é™åˆ¶çš„å†…å­˜å¤§å°æ˜¯ JAVA å †ç©ºé—´çš„å¤§å°ï¼Œä¸åŒ…æ‹¬Lucene ç¼“å­˜å€’æ’ç´¢å¼•æ•°æ®ç©ºé—´ã€‚ Lucene ä¸­çš„ å€’æ’ç´¢å¼• segments å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ºæé«˜è®¿é—®é€Ÿåº¦ï¼Œéƒ½ä¼šæŠŠå®ƒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œæé«˜ Lucene æ€§èƒ½ã€‚æ‰€ä»¥å»ºè®®è‡³å°‘ç•™ç³»ç»Ÿä¸€åŠå†…å­˜ç»™Luceneã€‚Node Query Cache (è´Ÿè´£ç¼“å­˜f ilter æŸ¥è¯¢ç»“æœ)ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªï¼Œè¢«æ‰€æœ‰ shard å…±äº«ï¼Œfilter queryæŸ¥è¯¢ç»“æœè¦ä¹ˆæ˜¯ yes è¦ä¹ˆæ˜¯noï¼Œä¸æ¶‰åŠ scores çš„è®¡ç®—ã€‚é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦é…ç½®ï¼Œé»˜è®¤ä¸ºï¼šindices.queries.cache.size:10% Indexing Buffer ç´¢å¼•ç¼“å†²åŒºï¼Œç”¨äºå­˜å‚¨æ–°ç´¢å¼•çš„æ–‡æ¡£ï¼Œå½“å…¶è¢«å¡«æ»¡æ—¶ï¼Œç¼“å†²åŒºä¸­çš„æ–‡æ¡£è¢«å†™å…¥ç£ç›˜ä¸­çš„ segments ä¸­ã€‚èŠ‚ç‚¹ä¸Šæ‰€æœ‰ shard å…±äº«ã€‚ç¼“å†²åŒºé»˜è®¤å¤§å°ï¼š indices.memory.index_buffer_size: 10%å¦‚æœç¼“å†²åŒºå¤§å°è®¾ç½®äº†ç™¾åˆ†ç™¾åˆ™ indices.memory.min_index_buffer_size ç”¨äºè¿™æ˜¯æœ€å°å€¼ï¼Œé»˜è®¤ä¸º 48mbã€‚indices.memory.max_index_buffer_size ç”¨äºæœ€å¤§å¤§å°ï¼Œæ— é»˜è®¤å€¼ã€‚ segmentssegmentsä¼šé•¿æœŸå ç”¨å†…å­˜ï¼Œå…¶åˆè¡·å°±æ˜¯åˆ©ç”¨OSçš„cacheæå‡æ€§èƒ½ã€‚åªæœ‰åœ¨Mergeä¹‹åï¼Œæ‰ä¼šé‡Šæ”¾æ‰æ ‡è®°ä¸ºDeleteçš„segmentsï¼Œé‡Šæ”¾éƒ¨åˆ†å†…å­˜ã€‚ Shard Request Cache ç”¨äºç¼“å­˜è¯·æ±‚ç»“æœï¼Œä½†ä¹‹ç¼“å­˜request sizeä¸º0çš„ã€‚æ¯”å¦‚è¯´ hits.total, aggregations å’Œ suggestions.é»˜è®¤æœ€å¤§ä¸ºindices.requests.cache.size:1% Field Data Cache å­—æ®µç¼“å­˜é‡è¦ç”¨äºå¯¹å­—æ®µè¿›è¡Œæ’åºã€èšåˆæ˜¯ä½¿ç”¨ã€‚å› ä¸ºæ„å»ºå­—æ®µæ•°æ®ç¼“å­˜ä»£ä»·æ˜‚è´µï¼Œæ‰€ä»¥å»ºè®®æœ‰è¶³å¤Ÿçš„å†…è®­æ¥å­˜å‚¨ã€‚Fielddata æ˜¯ ã€Œ å»¶è¿Ÿ ã€ åŠ è½½ã€‚å¦‚æœä½ ä»æ¥æ²¡æœ‰èšåˆä¸€ä¸ªåˆ†æå­—ç¬¦ä¸²ï¼Œå°±ä¸ä¼šåŠ è½½ fielddata åˆ°å†…å­˜ä¸­ï¼Œä¹Ÿå°±ä¸ä¼šä½¿ç”¨å¤§é‡çš„å†…å­˜ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åˆ†é…è¾ƒå°çš„heapç»™Elasticsearchã€‚å› ä¸ºheapè¶Šå°æ„å‘³ç€Elasticsearchçš„GCä¼šæ¯”è¾ƒå¿«ï¼Œå¹¶ä¸”é¢„ç•™ç»™Luceneçš„å†…å­˜ä¹Ÿä¼šæ¯”è¾ƒå¤§ã€‚ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¿å­˜fielddataæ—¶ï¼ŒElastisearchä¼šä¸æ–­åœ°ä»ç£ç›˜åŠ è½½æ•°æ®åˆ°å†…å­˜ï¼Œå¹¶å‰”é™¤æ‰æ—§çš„å†…å­˜æ•°æ®ã€‚å‰”é™¤æ“ä½œä¼šé€ æˆä¸¥é‡çš„ç£ç›˜I/Oï¼Œå¹¶ä¸”å¼•å‘å¤§é‡çš„GCï¼Œä¼šä¸¥é‡å½±å“Elastisearchçš„æ€§èƒ½ã€‚ é»˜è®¤æƒ…å†µä¸‹Fielddataä¼šä¸æ–­å ç”¨å†…å­˜ï¼Œç›´åˆ°å®ƒè§¦å‘äº†fielddata circuit breakerã€‚fielddata circuit breakerä¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶è¯„ä¼°è¿™æ¬¡æŸ¥è¯¢ä¼šä½¿ç”¨å¤šå°‘å†…å­˜ï¼Œä»è€Œè®¡ç®—åŠ è½½è¿™éƒ¨åˆ†å†…å­˜ä¹‹åï¼ŒField Data Cacheæ‰€å ç”¨çš„å†…å­˜æ˜¯å¦ä¼šè¶…è¿‡indices.breaker.fielddata.limitã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œå°±ä¼šè§¦å‘fielddata circuit breakerï¼Œabortè¿™æ¬¡æŸ¥è¯¢å¹¶ä¸”æŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢OOMã€‚ 1indices.breaker.fielddata.limit:60% (é»˜è®¤heapçš„60%) (es7ä¹‹åæ”¹æˆ70%) å¦‚æœè®¾ç½®äº†indices.fielddata.cache.sizeï¼Œå½“è¾¾åˆ°sizeæ—¶ï¼Œcacheä¼šå‰”é™¤æ—§çš„fielddataã€‚ indices.breaker.fielddata.limit å¿…é¡»å¤§äº indices.fielddata.cache.sizeï¼Œå¦åˆ™åªä¼šè§¦å‘fielddata circuit breakerï¼Œè€Œä¸ä¼šå‰”é™¤æ—§çš„fielddataã€‚ é…ç½®Elasticsearchå †å†…å­˜Elasticsearché»˜è®¤å®‰è£…åè®¾ç½®çš„å†…å­˜æ˜¯ 1GBï¼Œè¿™æ˜¯è¿œè¿œä¸å¤Ÿç”¨äºç”Ÿäº§ç¯å¢ƒçš„ã€‚æœ‰ä¸¤ç§æ–¹å¼ä¿®æ”¹Elasticsearchçš„å †å†…å­˜ï¼š è®¾ç½®ç¯å¢ƒå˜é‡ï¼šexport ES_HEAP_SIZE=10g åœ¨eså¯åŠ¨æ—¶ä¼šè¯»å–è¯¥å˜é‡ï¼› å¯åŠ¨æ—¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™esï¼š ./bin/elasticsearch -Xmx10g -Xms10g æ³¨æ„ç‚¹ç»™esåˆ†é…å†…å­˜æ—¶è¦æ³¨æ„ï¼Œè‡³å°‘è¦åˆ†é…ä¸€åŠå„¿å†…å­˜ç•™ç»™ Luceneã€‚åˆ†é…ç»™ es çš„å†…å­˜æœ€å¥½ä¸è¦è¶…è¿‡ 32G ï¼Œå› ä¸ºå¦‚æœå †å¤§å°å°äº 32 GBï¼ŒJVM å¯ä»¥åˆ©ç”¨æŒ‡é’ˆå‹ç¼©ï¼Œè¿™å¯ä»¥å¤§å¤§é™ä½å†…å­˜çš„ä½¿ç”¨ï¼šæ¯ä¸ªæŒ‡é’ˆ 4 å­—èŠ‚è€Œä¸æ˜¯ 8 å­—èŠ‚ã€‚å¦‚æœå¤§äº32G æ¯ä¸ªæŒ‡é’ˆå ç”¨ 8å­—èŠ‚ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„å†…å­˜å¸¦å®½ï¼Œé™ä½äº†cpuæ€§èƒ½ã€‚ è¿˜æœ‰ä¸€ç‚¹ï¼Œ è¦å…³é—­ swap å†…å­˜äº¤æ¢ç©ºé—´ï¼Œç¦ç”¨swappingã€‚é¢‘ç¹çš„swapping å¯¹æœåŠ¡å™¨æ¥è¯´æ˜¯è‡´å‘½çš„ã€‚æ€»ç»“ï¼šç»™es JVMæ ˆçš„å†…å­˜æœ€å¥½ä¸è¦è¶…è¿‡32Gï¼Œç•™ç»™Luceneçš„å†…å­˜è¶Šå¤§è¶Šå¥½ï¼ŒLuceneæŠŠæ‰€æœ‰çš„segmentéƒ½ç¼“å­˜èµ·æ¥ï¼Œä¼šåŠ å¿«å…¨æ–‡æ£€ç´¢ã€‚ å…³é—­äº¤æ¢åŒºè¿™åº”è¯¥æ˜¾è€Œæ˜“è§äº†ï¼Œä½†ä»ç„¶éœ€è¦æ˜ç¡®çš„å†™å‡ºæ¥ï¼šæŠŠå†…å­˜æ¢æˆç¡¬ç›˜å°†æ¯æ‰æœåŠ¡å™¨çš„æ€§èƒ½ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼šæ¶‰åŠå†…å­˜çš„æ“ä½œæ˜¯éœ€è¦å¿«é€Ÿæ‰§è¡Œçš„ã€‚å¦‚æœä»‹è´¨ä»å†…å­˜å˜ä¸ºäº†ç¡¬ç›˜ï¼Œä¸€ä¸ª10å¾®ç§’çš„æ“ä½œå˜æˆéœ€è¦10æ¯«ç§’ã€‚è€Œä¸”è¿™ç§å»¶è¿Ÿå‘ç”Ÿåœ¨æ‰€æœ‰æœ¬è¯¥åªèŠ±è´¹10å¾®ç§’çš„æ“ä½œä¸Šï¼Œå°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆäº¤æ¢åŒºå¯¹äºæ€§èƒ½æ¥è¯´æ˜¯å™©æ¢¦ã€‚ æœ€å¥½çš„é€‰æ‹©æ˜¯ç¦ç”¨æ‰æ“ä½œç³»ç»Ÿçš„äº¤æ¢åŒºã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š 1sudo swapoff -a æ¥ç¦ç”¨ï¼Œä½ å¯èƒ½è¿˜éœ€è¦ç¼–è¾‘ /etc/fstab æ–‡ä»¶ã€‚ç»†èŠ‚å¯ä»¥å‚è€ƒä½ çš„æ“ä½œç³»ç»Ÿæ–‡æ¡£ã€‚ å¦‚æœå®é™…ç¯å¢ƒä¸å…è®¸ç¦ç”¨æ‰ swapï¼Œä½ å¯ä»¥å°è¯•é™ä½ swappinessã€‚æ­¤å€¼æ§åˆ¶æ“ä½œç³»ç»Ÿä½¿ç”¨äº¤æ¢åŒºçš„ç§¯ææ€§ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨äº¤æ¢åŒºï¼Œä½†ä»å…è®¸æ“ä½œç³»ç»Ÿåœ¨ç´§æ€¥æƒ…å†µä¸‹å°†å†…å­˜é‡Œçš„ä¸œè¥¿æ”¾åˆ°äº¤æ¢åŒºã€‚ å¯¹äºå¤§å¤šæ•°Linuxç³»ç»Ÿæ¥è¯´ï¼Œè¿™å¯ä»¥ç”¨ sysctl å€¼æ¥é…ç½®ï¼š 1vm.swappiness = 1 # å°†æ­¤å€¼é…ç½®ä¸º1ä¼šæ¯”0å¥½ï¼Œåœ¨kernalå†…æ ¸çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œ0å¯èƒ½ä¼šå¼•èµ·OOMå¼‚å¸¸ã€‚ æœ€åï¼Œå¦‚æœä¸¤ç§æ–¹æ³•éƒ½ä¸å¯ç”¨ï¼Œä½ åº”è¯¥åœ¨ElasticSearchçš„é…ç½®ä¸­å¯ç”¨ mlockall.fileã€‚è¿™å…è®¸JVMé”å®šå…¶ä½¿ç”¨çš„å†…å­˜ï¼Œè€Œé¿å…è¢«æ”¾å…¥æ“ä½œç³»ç»Ÿäº¤æ¢åŒºã€‚ åœ¨elasticsearch.ymlä¸­ï¼Œåšå¦‚ä¸‹è®¾ç½®ï¼š 1bootstrap.mlockall: true æŸ¥çœ‹nodeèŠ‚ç‚¹æ•°æ®GET /_cat/nodes?v&amp;h=id,ip,port,v,master,name,heap.current,heap.percent,heap.max,ram.current,ram.percent,ram.max,fielddata.memory_size,fielddata.evictions,query_cache.memory_size,query_cache.evictions, request_cache.memory_size,request_cache.evictions,request_cache.hit_count,request_cache.miss_count GET /_cat/nodes?v&amp;h=id,heap.current,heap.percent,heap.max,ram.current,ram.percent,ram.max,fielddata.memory_size GET /_cat/nodes?v&amp;h=id,fielddata.evictions,query_cache.memory_size,query_cache.evictions, request_cache.memory_size,request_cache.evictions,request_cache.hit_count,request_cache.miss_count å‚è€ƒæ–‡ç« ","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"cross-fieldsè·¨å­—æ®µæŸ¥è¯¢","date":"2021-07-07T06:41:42.000Z","path":"wiki/cross-fieldsè·¨å­—æ®µæŸ¥è¯¢/","text":"å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» cross-fields è·¨å­—æ®µæŸ¥è¯¢","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"copy_toå‚æ•°","date":"2021-07-07T06:34:42.000Z","path":"wiki/copy-toå‚æ•°/","text":"å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» è‡ªå®šä¹‰ _all å­—æ®µ Docs Â» Mapping parametersï¼ˆæ˜ å°„å‚æ•°ï¼‰ Â» Mapping(æ˜ å°„) Â» copy_toï¼ˆåˆå¹¶å‚æ•°ï¼‰","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"å­—ç¬¦ä¸²æ’åºä¸å¤šå­—æ®µ","date":"2021-07-07T03:05:31.000Z","path":"wiki/å­—ç¬¦ä¸²æ’åºä¸å¤šå­—æ®µ/","text":"è¢«è§£æçš„å­—ç¬¦ä¸²å­—æ®µä¹Ÿæ˜¯å¤šå€¼å­—æ®µï¼Œ ä½†æ˜¯å¾ˆå°‘ä¼šæŒ‰ç…§ä½ æƒ³è¦çš„æ–¹å¼è¿›è¡Œæ’åºã€‚å¦‚æœä½ æƒ³åˆ†æä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚ fine old art ï¼Œ è¿™åŒ…å« 3 é¡¹ã€‚æˆ‘ä»¬å¾ˆå¯èƒ½æƒ³è¦æŒ‰ç¬¬ä¸€é¡¹çš„å­—æ¯æ’åºï¼Œç„¶åæŒ‰ç¬¬äºŒé¡¹çš„å­—æ¯æ’åºï¼Œè¯¸å¦‚æ­¤ç±»ï¼Œä½†æ˜¯ Elasticsearch åœ¨æ’åºè¿‡ç¨‹ä¸­æ²¡æœ‰è¿™æ ·çš„ä¿¡æ¯ã€‚ ä½ å¯ä»¥ä½¿ç”¨ min å’Œ max æ’åºæ¨¡å¼ï¼ˆé»˜è®¤æ˜¯ min ï¼‰ï¼Œä½†æ˜¯è¿™ä¼šå¯¼è‡´æ’åºä»¥ art æˆ–æ˜¯ old ï¼Œä»»ä½•ä¸€ä¸ªéƒ½ä¸æ˜¯æ‰€å¸Œæœ›çš„ã€‚ ä¸ºäº†ä»¥å­—ç¬¦ä¸²å­—æ®µè¿›è¡Œæ’åºï¼Œè¿™ä¸ªå­—æ®µåº”ä»…åŒ…å«ä¸€é¡¹ï¼š æ•´ä¸ª not_analyzed å­—ç¬¦ä¸²ã€‚ ä½†æ˜¯æˆ‘ä»¬ä»éœ€è¦ analyzed å­—æ®µï¼Œè¿™æ ·æ‰èƒ½ä»¥å…¨æ–‡è¿›è¡ŒæŸ¥è¯¢ ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ç”¨ä¸¤ç§æ–¹å¼å¯¹åŒä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œç´¢å¼•ï¼Œè¿™å°†åœ¨æ–‡æ¡£ä¸­åŒ…æ‹¬ä¸¤ä¸ªå­—æ®µï¼š analyzed ç”¨äºæœç´¢ï¼Œ not_analyzed ç”¨äºæ’åº ä½†æ˜¯ä¿å­˜ç›¸åŒçš„å­—ç¬¦ä¸²ä¸¤æ¬¡åœ¨ _source å­—æ®µæ˜¯æµªè´¹ç©ºé—´çš„ã€‚ æˆ‘ä»¬çœŸæ­£æƒ³è¦åšçš„æ˜¯ä¼ é€’ä¸€ä¸ª å•å­—æ®µ ä½†æ˜¯å´ç”¨ä¸¤ç§æ–¹å¼ç´¢å¼•å®ƒã€‚æ‰€æœ‰çš„ _core_field ç±»å‹ (strings, numbers, Booleans, dates) æ¥æ”¶ä¸€ä¸ª fields å‚æ•° è¯¥å‚æ•°å…è®¸ä½ è½¬åŒ–ä¸€ä¸ªç®€å•çš„æ˜ å°„å¦‚ï¼š 1234&quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot;&#125; ä¸ºä¸€ä¸ªå¤šå­—æ®µæ˜ å°„å¦‚ï¼š 12345678910&quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot;, &quot;fields&quot;: &#123; &quot;raw&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot; &#125; &#125;&#125; tweet ä¸»å­—æ®µä¸ä¹‹å‰çš„ä¸€æ ·: æ˜¯ä¸€ä¸ª analyzed å…¨æ–‡å­—æ®µã€‚ æ–°çš„ tweet.raw å­å­—æ®µæ˜¯ not_analyzed. ç°åœ¨ï¼Œè‡³å°‘åªè¦æˆ‘ä»¬é‡æ–°ç´¢å¼•äº†æˆ‘ä»¬çš„æ•°æ®ï¼Œä½¿ç”¨ tweet å­—æ®µç”¨äºæœç´¢ï¼Œtweet.raw å­—æ®µç”¨äºæ’åºï¼šcurl -X GET &quot;localhost:9200/_search?pretty&quot; -H &#39;Content-Type: application/json&#39; -d 12345678&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;tweet&quot;: &quot;elasticsearch&quot; &#125; &#125;, &quot;sort&quot;: &quot;tweet.raw&quot;&#125;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"æ¨èç³»ç»Ÿ-Overview","date":"2021-07-07T02:08:05.000Z","path":"wiki/æ¨èç³»ç»Ÿ-Overview/","text":"åšå®¢èµ„æ–™ æ·±åº¦è§£æäº¬ä¸œä¸ªæ€§åŒ–æ¨èç³»ç»Ÿæ¼”è¿›å² ç”¨ Mahout å’Œ Elasticsearch å®ç°æ¨èç³»ç»Ÿ ç¾å›¢æ¨èç®—æ³•å®è·µ 58åŒåŸæ¨èç³»ç»Ÿè®¾è®¡ä¸å®ç° å¾®åšæ¨èç³»ç»Ÿçš„æ¶æ„æ¼”è¿›ä¹‹è·¯ Flink åœ¨å°çº¢ä¹¦æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨ å°çº¢ä¹¦å¤§æ•°æ®åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨ å¿«çœ‹æ¼«ç”»ä¸ªæ€§åŒ–æ¨èæ¢ç´¢ä¸å®è·µ æ•°æ®ä»“åº“ç³»åˆ—ç¯‡â€”â€”å”¯å“ä¼šå¤§æ•°æ®æ¶æ„ æ¨èç³»ç»ŸåŸºæœ¬æ¦‚å¿µå’Œæ¶æ„ PAIå¹³å°æ­å»ºä¼ä¸šçº§ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ - Aliyun è˜‘è‡è¡—æ¨èå·¥ç¨‹å®è·µ å‚è€ƒèµ„æ–™","tags":[{"name":"æ¨èç³»ç»Ÿ","slug":"æ¨èç³»ç»Ÿ","permalink":"http://example.com/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/"}],"categories":[{"name":"Recommend System","slug":"Recommend-System","permalink":"http://example.com/categories/Recommend-System/"},{"name":"Overview","slug":"Recommend-System/Overview","permalink":"http://example.com/categories/Recommend-System/Overview/"}]},{"title":"flink æäº¤ä»»åŠ¡","date":"2021-07-06T15:57:04.000Z","path":"wiki/flink-æäº¤ä»»åŠ¡/","text":"ä¸‹é¢æ¼”ç¤ºå¦‚ä½•é€šè¿‡adminé¡µé¢æäº¤ä»»åŠ¡ ğŸ‘‡ å‡†å¤‡task jar1234567891011121314151617181920public class StreamWordCount &#123; public static void main(String[] args) throws Exception &#123; // åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment(); // ä»socketæ–‡æœ¬æµè¯»å–æ•°æ® DataStream&lt;String&gt; inputDataStream = env.socketTextStream(&quot;localhost&quot;, 7777); // åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®— DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(new WordCount.MyFlatMapper()) .keyBy(0) .sum(1); resultStream.print(); // æ‰§è¡Œä»»åŠ¡ env.execute(); &#125;&#125; æ‰§è¡Œmvn install -DskipTest å¯ä»¥å¾—åˆ°ç›¸åº”çš„jar adminæäº¤jar æäº¤å®ŒjaråŒ…ä¹‹åï¼Œéœ€è¦è®¾ç½®ç›¸å…³å‚æ•°ï¼Œè¿™ä¸ªæ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µæ¥è®¾ç½®ï¼Œä¸‹é¢æ˜¯å‚è€ƒæ ·ä¾‹ï¼š Enter Class : com.ibli.flink.StreamWordCountä¹Ÿå°±æ˜¯ç¨‹åºå…¥å£ï¼Œæˆ‘ä»¬è¿™æ˜¯å†™äº†ä¸€ä¸ªmainæ–¹æ³•ï¼Œå¦‚æœæ˜¯ç¨‹åºçš„è¯ï¼Œå¯ä»¥å†™å¯¹åº”bootstrapçš„å¯åŠ¨ç±» Program Arguments : â€“host localhost â€“port 7777 ç‚¹å‡» submit ä¹‹åæŸ¥çœ‹æäº¤çš„ä»»åŠ¡çŠ¶æ€ æŸ¥çœ‹ä»»åŠ¡ å¯ä»¥çœ‹åˆ°æ˜¯æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”éƒ½æ˜¯åœ¨æ‰§è¡ŒçŠ¶æ€ï¼›ç‚¹å‡»ä¸€ä¸ªä»»åŠ¡ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…ä¿¡æ¯ï¼Œå’Œä¸€äº›å…¶ä»–çš„ä¿¡æ¯ï¼Œéå¸¸å…¨é¢ï¼› æŸ¥çœ‹è¿è¡Œæ—¶ä»»åŠ¡åˆ—è¡¨ æŸ¥çœ‹ä»»åŠ¡ç®¡ç†åˆ—è¡¨ ç‚¹å‡»ä»»åŠ¡å¯ä»¥è·³è½¬åˆ°è¯¦æƒ…é¡µé¢ ğŸ‘‡ ä¸‹é¢æ˜¯æ‰§è¡Œæ—¥å¿— æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ä»»åŠ¡æ‰§è¡Œçš„æ ‡å‡†è¾“å‡ºç»“æœâœ… ä»»åŠ¡æºæ•°æ®é€šè¿‡nc è¾“å…¥æ•°æ®ï¼Œç”±ç¨‹åºè¯»å–7777ç«¯å£è¾“å…¥æµå¹¶è§£ææ•°æ® 123gaolei:geekibli gaolei$ nc -lk 7777hello javahello flink å–æ¶ˆä»»åŠ¡å¦‚ä¸‹ å†æ¬¡æŸ¥çœ‹å·²å®Œæˆä»»åŠ¡åˆ—è¡¨ å¦‚ä¸‹ï¼š","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"apache-flink-overview","date":"2021-07-06T15:39:54.000Z","path":"wiki/apache-flink-overview/","text":"å­¦ä¹ åˆè¡·æ¨èç³»ç»Ÿæ•°æ®éœ€è¦å®æ—¶å¤„ç†ï¼Œä½¿ç”¨Apache Flinkå®æ—¶è®¡ç®—ç”¨æˆ·æ•°æ®ï¼Œåˆ†æç”¨æˆ·è¡Œä¸ºï¼Œè¾¾åˆ°å®æ—¶ä¸šåŠ¡æ•°æ®åˆ†æå’Œå®ç°ä¸šåŠ¡ç›¸å…³æ¨èï¼› å­¦ä¹ èµ„æ–™ ashiamd.github.io å°šç¡…è°·2021æœ€æ–°Javaç‰ˆFlink æ­¦è€å¸ˆæ¸…åç¡•å£«ï¼ŒåŸIBM-CDLè´Ÿè´£äºº Apache FlinkÂ® â€” Stateful Computations over Data Streams Apache FlinkÂ® - æ•°æ®æµä¸Šçš„æœ‰çŠ¶æ€è®¡ç®— https://space.bilibili.com/33807709?spm_id_from=333.788.b_765f7570696e666f.2 https://github.com/flink-china/flink-training-course https://ci.apache.org/projects/flink/flink-docs-release-1.13/zh/ [å®˜æ–¹æ–‡æ¡£ æ¨è â€¼ï¸]","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"most_fieldsç±»å‹","date":"2021-07-06T12:54:23.000Z","path":"wiki/most-fieldsç±»å‹/","text":"å¤šå­—æ®µæ˜ å°„é¦–å…ˆè¦åšçš„äº‹æƒ…å°±æ˜¯å¯¹æˆ‘ä»¬çš„å­—æ®µç´¢å¼•ä¸¤æ¬¡ï¼šä¸€æ¬¡ä½¿ç”¨è¯å¹²æ¨¡å¼ä»¥åŠä¸€æ¬¡éè¯å¹²æ¨¡å¼ã€‚ä¸ºäº†åšåˆ°è¿™ç‚¹ï¼Œé‡‡ç”¨ multifields æ¥å®ç°ï¼Œå·²ç»åœ¨ multifields æœ‰æ‰€ä»‹ç»ï¼š DELETE /my_index 1234567891011121314151617181920PUT /my_index&#123; &quot;settings&quot;: &#123; &quot;number_of_shards&quot;: 1 &#125;, &quot;mappings&quot;: &#123; &quot;my_type&quot;: &#123; &quot;properties&quot;: &#123; &quot;title&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot;, &quot;fields&quot;: &#123; &quot;std&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;standard&quot; &#125; &#125; &#125; &#125; &#125; &#125;&#125; title å­—æ®µä½¿ç”¨ english è‹±è¯­åˆ†æå™¨æ¥æå–è¯å¹²ã€‚ title.std å­—æ®µä½¿ç”¨ standard æ ‡å‡†åˆ†æå™¨ï¼Œæ‰€ä»¥æ²¡æœ‰è¯å¹²æå–ã€‚ æ¥ç€ç´¢å¼•ä¸€äº›æ–‡æ¡£ï¼š 12345PUT /my_index/my_type/1&#123; &quot;title&quot;: &quot;My rabbit jumps&quot; &#125;PUT /my_index/my_type/2&#123; &quot;title&quot;: &quot;Jumping jack rabbits&quot; &#125; è¿™é‡Œç”¨ä¸€ä¸ªç®€å• match æŸ¥è¯¢ title æ ‡é¢˜å­—æ®µæ˜¯å¦åŒ…å« jumping rabbits ï¼ˆè·³è·ƒçš„å…”å­ï¼‰ï¼š 12345678GET /my_index/_search&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;title&quot;: &quot;jumping rabbits&quot; &#125; &#125;&#125; å› ä¸ºæœ‰äº† english åˆ†æå™¨ï¼Œè¿™ä¸ªæŸ¥è¯¢æ˜¯åœ¨æŸ¥æ‰¾ä»¥ jump å’Œ rabbit è¿™ä¸¤ä¸ªè¢«æå–è¯çš„æ–‡æ¡£ã€‚ä¸¤ä¸ªæ–‡æ¡£çš„ title å­—æ®µéƒ½åŒæ—¶åŒ…æ‹¬è¿™ä¸¤ä¸ªè¯ï¼Œæ‰€ä»¥ä¸¤ä¸ªæ–‡æ¡£å¾—åˆ°çš„è¯„åˆ†ä¹Ÿç›¸åŒï¼š 123456789101112131415161718&#123; &quot;hits&quot;: [ &#123; &quot;_id&quot;: &quot;1&quot;, &quot;_score&quot;: 0.42039964, &quot;_source&quot;: &#123; &quot;title&quot;: &quot;My rabbit jumps&quot; &#125; &#125;, &#123; &quot;_id&quot;: &quot;2&quot;, &quot;_score&quot;: 0.42039964, &quot;_source&quot;: &#123; &quot;title&quot;: &quot;Jumping jack rabbits&quot; &#125; &#125; ]&#125; å¦‚æœåªæ˜¯æŸ¥è¯¢ title.std å­—æ®µï¼Œé‚£ä¹ˆåªæœ‰æ–‡æ¡£ 2 æ˜¯åŒ¹é…çš„ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¦‚æœåŒæ—¶æŸ¥è¯¢ä¸¤ä¸ªå­—æ®µï¼Œç„¶åä½¿ç”¨ bool æŸ¥è¯¢å°†è¯„åˆ†ç»“æœ åˆå¹¶ ï¼Œé‚£ä¹ˆä¸¤ä¸ªæ–‡æ¡£éƒ½æ˜¯åŒ¹é…çš„ï¼ˆ title å­—æ®µçš„ä½œç”¨ï¼‰ï¼Œè€Œä¸”æ–‡æ¡£ 2 çš„ç›¸å…³åº¦è¯„åˆ†æ›´é«˜ï¼ˆ title.std å­—æ®µçš„ä½œç”¨ï¼‰ï¼š 12345678910GET /my_index/_search&#123; &quot;query&quot;: &#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;jumping rabbits&quot;, &quot;type&quot;: &quot;most_fields&quot;, &quot;fields&quot;: [ &quot;title&quot;, &quot;title.std&quot; ] &#125; &#125;&#125; æˆ‘ä»¬å¸Œæœ›å°†æ‰€æœ‰åŒ¹é…å­—æ®µçš„è¯„åˆ†åˆå¹¶èµ·æ¥ï¼Œæ‰€ä»¥ä½¿ç”¨ most_fields ç±»å‹ã€‚è¿™è®© multi_match æŸ¥è¯¢ç”¨ bool æŸ¥è¯¢å°†ä¸¤ä¸ªå­—æ®µè¯­å¥åŒ…åœ¨é‡Œé¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ dis_max (æœ€ä½³å­—æ®µ) æŸ¥è¯¢ã€‚ 123456789101112131415161718&#123; &quot;hits&quot;: [ &#123; &quot;_id&quot;: &quot;2&quot;, &quot;_score&quot;: 0.8226396, &quot;_source&quot;: &#123; &quot;title&quot;: &quot;Jumping jack rabbits&quot; &#125; &#125;, &#123; &quot;_id&quot;: &quot;1&quot;, &quot;_score&quot;: 0.10741998, &quot;_source&quot;: &#123; &quot;title&quot;: &quot;My rabbit jumps&quot; &#125; &#125; ]&#125; æ–‡æ¡£ 2 ç°åœ¨çš„è¯„åˆ†è¦æ¯”æ–‡æ¡£ 1 é«˜ã€‚ ç”¨å¹¿åº¦åŒ¹é…å­—æ®µ title åŒ…æ‹¬å°½å¯èƒ½å¤šçš„æ–‡æ¡£â€”â€”ä»¥æå‡å¬å›ç‡â€”â€”åŒæ—¶åˆä½¿ç”¨å­—æ®µ title.std ä½œä¸º ä¿¡å· å°†ç›¸å…³åº¦æ›´é«˜çš„æ–‡æ¡£ç½®äºç»“æœé¡¶éƒ¨ã€‚ æ¯ä¸ªå­—æ®µå¯¹äºæœ€ç»ˆè¯„åˆ†çš„è´¡çŒ®å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å€¼ boost æ¥æ§åˆ¶ã€‚æ¯”å¦‚ï¼Œä½¿ title å­—æ®µæ›´ä¸ºé‡è¦ï¼Œè¿™æ ·åŒæ—¶ä¹Ÿé™ä½äº†å…¶ä»–ä¿¡å·å­—æ®µçš„ä½œç”¨ï¼š 12345678910GET /my_index/_search&#123; &quot;query&quot;: &#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;jumping rabbits&quot;, &quot;type&quot;: &quot;most_fields&quot;, &quot;fields&quot;: [ &quot;title^10&quot;, &quot;title.std&quot; ] &#125; &#125;&#125; title å­—æ®µçš„ boost çš„å€¼ä¸º 10 ä½¿å®ƒæ¯” title.std æ›´é‡è¦ã€‚ å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» å¤šæ•°å­—æ®µ","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"multi_match æŸ¥è¯¢","date":"2021-07-06T12:37:26.000Z","path":"wiki/multi-match-æŸ¥è¯¢/","text":"multi_match æŸ¥è¯¢ä¸ºèƒ½åœ¨å¤šä¸ªå­—æ®µä¸Šåå¤æ‰§è¡Œç›¸åŒæŸ¥è¯¢æä¾›äº†ä¸€ç§ä¾¿æ·æ–¹å¼ã€‚ ğŸ“’ ğŸ“’ ğŸ“’ multi_match å¤šåŒ¹é…æŸ¥è¯¢çš„ç±»å‹æœ‰å¤šç§ï¼Œå…¶ä¸­çš„ä¸‰ç§æ°å·§ä¸ äº†è§£æˆ‘ä»¬çš„æ•°æ® ä¸­ä»‹ç»çš„ä¸‰ä¸ªåœºæ™¯å¯¹åº”ï¼Œå³ï¼šbest_fields ã€ most_fields å’Œ cross_fields ï¼ˆæœ€ä½³å­—æ®µã€å¤šæ•°å­—æ®µã€è·¨å­—æ®µï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢çš„ç±»å‹æ˜¯ best_fields ï¼Œè¿™è¡¨ç¤ºå®ƒä¼šä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆä¸€ä¸ª match æŸ¥è¯¢ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆåˆ° dis_max æŸ¥è¯¢çš„å†…éƒ¨ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223&#123; &quot;dis_max&quot;: &#123; &quot;queries&quot;: [ &#123; &quot;match&quot;: &#123; &quot;title&quot;: &#123; &quot;query&quot;: &quot;Quick brown fox&quot;, &quot;minimum_should_match&quot;: &quot;30%&quot; &#125; &#125; &#125;, &#123; &quot;match&quot;: &#123; &quot;body&quot;: &#123; &quot;query&quot;: &quot;Quick brown fox&quot;, &quot;minimum_should_match&quot;: &quot;30%&quot; &#125; &#125; &#125;, ], &quot;tie_breaker&quot;: 0.3 &#125;&#125; ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢ç”¨ multi_match é‡å†™æˆæ›´ç®€æ´çš„å½¢å¼ï¼š 123456789&#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;Quick brown fox&quot;, &quot;type&quot;: &quot;best_fields&quot;, &quot;fields&quot;: [ &quot;title&quot;, &quot;body&quot; ], &quot;tie_breaker&quot;: 0.3, &quot;minimum_should_match&quot;: &quot;30%&quot; &#125;&#125; âš ï¸ âš ï¸ âš ï¸ best_fields ç±»å‹æ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸æŒ‡å®šã€‚ å¦‚ minimum_should_match æˆ– operator è¿™æ ·çš„å‚æ•°ä¼šè¢«ä¼ é€’åˆ°ç”Ÿæˆçš„ match æŸ¥è¯¢ä¸­ã€‚ æŸ¥è¯¢å­—æ®µåç§°çš„æ¨¡ç³ŠåŒ¹é…å­—æ®µåç§°å¯ä»¥ç”¨ æ¨¡ç³ŠåŒ¹é… çš„æ–¹å¼ç»™å‡ºï¼šä»»ä½•ä¸æ¨¡ç³Šæ¨¡å¼æ­£åˆ™åŒ¹é…çš„å­—æ®µéƒ½ä¼šè¢«åŒ…æ‹¬åœ¨æœç´¢æ¡ä»¶ä¸­ï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åŒæ—¶åŒ¹é… book_title ã€ chapter_title å’Œ section_title ï¼ˆä¹¦åã€ç« åã€èŠ‚åï¼‰è¿™ä¸‰ä¸ªå­—æ®µï¼š 123456&#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;Quick brown fox&quot;, &quot;fields&quot;: &quot;*_title&quot; &#125;&#125; æå‡å•ä¸ªå­—æ®µçš„æƒé‡å¯ä»¥ä½¿ç”¨ ^ å­—ç¬¦è¯­æ³•ä¸ºå•ä¸ªå­—æ®µæå‡æƒé‡ï¼Œåœ¨å­—æ®µåç§°çš„æœ«å°¾æ·»åŠ  ^boost ï¼Œå…¶ä¸­ boost æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼š 123456&#123; &quot;multi_match&quot;: &#123; &quot;query&quot;: &quot;Quick brown fox&quot;, &quot;fields&quot;: [ &quot;*_title&quot;, &quot;chapter_title^2&quot; ] &#125;&#125; chapter_title è¿™ä¸ªå­—æ®µçš„ boost å€¼ä¸º 2 ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªå­—æ®µ book_title å’Œ section_title å­—æ®µçš„é»˜è®¤ boost å€¼ä¸º 1 ã€‚ å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» multi_match æŸ¥è¯¢ Elasticsearch Guide [7.x] Â» Query DSL Â» Full text queries Â» Multi-match query","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"dis_maxæŸ¥è¯¢","date":"2021-07-06T12:09:23.000Z","path":"wiki/dis-maxæŸ¥è¯¢/","text":"å‡è®¾æœ‰ä¸ªç½‘ç«™å…è®¸ç”¨æˆ·æœç´¢åšå®¢çš„å†…å®¹ï¼Œä»¥ä¸‹é¢ä¸¤ç¯‡åšå®¢å†…å®¹æ–‡æ¡£ä¸ºä¾‹ï¼š 1234567891011PUT /my_index/my_type/1&#123; &quot;title&quot;: &quot;Quick brown rabbits&quot;, &quot;body&quot;: &quot;Brown rabbits are commonly seen.&quot;&#125;PUT /my_index/my_type/2&#123; &quot;title&quot;: &quot;Keeping pets healthy&quot;, &quot;body&quot;: &quot;My quick brown fox eats rabbits on a regular basis.&quot;&#125; ç”¨æˆ·è¾“å…¥è¯ç»„ Brown fox ç„¶åç‚¹å‡»æœç´¢æŒ‰é’®ã€‚äº‹å…ˆï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„æœç´¢é¡¹æ˜¯ä¼šåœ¨ title è¿˜æ˜¯åœ¨ body å­—æ®µä¸­è¢«æ‰¾åˆ°ï¼Œä½†æ˜¯ï¼Œç”¨æˆ·å¾ˆæœ‰å¯èƒ½æ˜¯æƒ³æœç´¢ç›¸å…³çš„è¯ç»„ã€‚ç”¨è‚‰çœ¼åˆ¤æ–­ï¼Œæ–‡æ¡£ 2 çš„åŒ¹é…åº¦æ›´é«˜ï¼Œå› ä¸ºå®ƒåŒæ—¶åŒ…æ‹¬è¦æŸ¥æ‰¾çš„ä¸¤ä¸ªè¯ï¼š ç°åœ¨è¿è¡Œä»¥ä¸‹ bool æŸ¥è¯¢ï¼š 12345678910&#123; &quot;query&quot;: &#123; &quot;bool&quot;: &#123; &quot;should&quot;: [ &#123; &quot;match&quot;: &#123; &quot;title&quot;: &quot;Brown fox&quot; &#125;&#125;, &#123; &quot;match&quot;: &#123; &quot;body&quot;: &quot;Brown fox&quot; &#125;&#125; ] &#125; &#125;&#125; ä½†æ˜¯æˆ‘ä»¬å‘ç°æŸ¥è¯¢çš„ç»“æœæ˜¯æ–‡æ¡£ 1 çš„è¯„åˆ†æ›´é«˜ï¼š ä¸ºäº†ç†è§£å¯¼è‡´è¿™æ ·çš„åŸå› ï¼Œéœ€è¦å›æƒ³ä¸€ä¸‹ bool æ˜¯å¦‚ä½•è®¡ç®—è¯„åˆ†çš„ï¼š å®ƒä¼šæ‰§è¡Œ should è¯­å¥ä¸­çš„ä¸¤ä¸ªæŸ¥è¯¢ã€‚åŠ å’Œä¸¤ä¸ªæŸ¥è¯¢çš„è¯„åˆ†ã€‚ä¹˜ä»¥åŒ¹é…è¯­å¥çš„æ€»æ•°ã€‚é™¤ä»¥æ‰€æœ‰è¯­å¥æ€»æ•°ï¼ˆè¿™é‡Œä¸ºï¼š2ï¼‰ã€‚ æ–‡æ¡£ 1 çš„ä¸¤ä¸ªå­—æ®µéƒ½åŒ…å« brown è¿™ä¸ªè¯ï¼Œæ‰€ä»¥ä¸¤ä¸ª match è¯­å¥éƒ½èƒ½æˆåŠŸåŒ¹é…å¹¶ä¸”æœ‰ä¸€ä¸ªè¯„åˆ†ã€‚æ–‡æ¡£ 2 çš„ body å­—æ®µåŒæ—¶åŒ…å« brown å’Œ fox è¿™ä¸¤ä¸ªè¯ï¼Œä½† title å­—æ®µæ²¡æœ‰åŒ…å«ä»»ä½•è¯ã€‚è¿™æ ·ï¼Œ body æŸ¥è¯¢ç»“æœä¸­çš„é«˜åˆ†ï¼ŒåŠ ä¸Š title æŸ¥è¯¢ä¸­çš„ 0 åˆ†ï¼Œç„¶åä¹˜ä»¥äºŒåˆ†ä¹‹ä¸€ï¼Œå°±å¾—åˆ°æ¯”æ–‡æ¡£ 1 æ›´ä½çš„æ•´ä½“è¯„åˆ†ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œ title å’Œ body å­—æ®µæ˜¯ç›¸äº’ç«äº‰çš„å…³ç³»ï¼Œæ‰€ä»¥å°±éœ€è¦æ‰¾åˆ°å•ä¸ª æœ€ä½³åŒ¹é… çš„å­—æ®µã€‚ å¦‚æœä¸æ˜¯ç®€å•å°†æ¯ä¸ªå­—æ®µçš„è¯„åˆ†ç»“æœåŠ åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯å°† æœ€ä½³åŒ¹é… å­—æ®µçš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„æ•´ä½“è¯„åˆ†ï¼Œç»“æœä¼šæ€æ ·ï¼Ÿè¿™æ ·è¿”å›çš„ç»“æœå¯èƒ½æ˜¯ï¼š åŒæ—¶ åŒ…å« brown å’Œ fox çš„å•ä¸ªå­—æ®µæ¯”åå¤å‡ºç°ç›¸åŒè¯è¯­çš„å¤šä¸ªä¸åŒå­—æ®µæœ‰æ›´é«˜çš„ç›¸å…³åº¦ã€‚ dis_max æŸ¥è¯¢ä¸ä½¿ç”¨ bool æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨ dis_max å³åˆ†ç¦» æœ€å¤§åŒ–æŸ¥è¯¢ ï¼ˆDisjunction Max Queryï¼‰ ã€‚åˆ†ç¦»ï¼ˆDisjunctionï¼‰çš„æ„æ€æ˜¯ æˆ–ï¼ˆorï¼‰ ï¼Œè¿™ä¸å¯ä»¥æŠŠç»“åˆï¼ˆconjunctionï¼‰ç†è§£æˆ ä¸ï¼ˆandï¼‰ ç›¸å¯¹åº”ã€‚åˆ†ç¦»æœ€å¤§åŒ–æŸ¥è¯¢ï¼ˆDisjunction Max Queryï¼‰æŒ‡çš„æ˜¯ï¼š å°†ä»»ä½•ä¸ä»»ä¸€æŸ¥è¯¢åŒ¹é…çš„æ–‡æ¡£ä½œä¸ºç»“æœè¿”å›ï¼Œä½†åªå°†æœ€ä½³åŒ¹é…çš„è¯„åˆ†ä½œä¸ºæŸ¥è¯¢çš„è¯„åˆ†ç»“æœè¿”å› ï¼š 12345678910&#123; &quot;query&quot;: &#123; &quot;dis_max&quot;: &#123; &quot;queries&quot;: [ &#123; &quot;match&quot;: &#123; &quot;title&quot;: &quot;Brown fox&quot; &#125;&#125;, &#123; &quot;match&quot;: &#123; &quot;body&quot;: &quot;Brown fox&quot; &#125;&#125; ] &#125; &#125;&#125; å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœä¸ºï¼š Top-level parameters for dis_maxedit queries(Required, array of query objects) Contains one or more query clauses. Returned documents must match one or more of these queries. If a document matches multiple queries, Elasticsearch uses the highest relevance score. tie_breaker(Optional, float) Floating point number between 0 and 1.0 used to increase the relevance scores of documents matching multiple query clauses. Defaults to 0.0. You can use the tie_breaker value to assign higher relevance scores to documents that contain the same term in multiple fields than documents that contain this term in only the best of those multiple fields, without confusing this with the better case of two different terms in the multiple fields. If a document matches multiple clauses, the dis_max query calculates the relevance score for the document as follows: Take the relevance score from a matching clause with the highest score.Multiply the score from any other matching clauses by the tie_breaker value.Add the highest score to the multiplied scores.If the tie_breaker value is greater than 0.0, all matching clauses count, but the clause with the highest score counts most. dis_maxï¼Œåªæ˜¯å–åˆ†æ•°æœ€é«˜çš„é‚£ä¸ªqueryçš„åˆ†æ•°è€Œå·²ï¼Œå®Œå…¨ä¸è€ƒè™‘å…¶ä»–queryçš„åˆ†æ•°ï¼Œè¿™ç§ä¸€åˆ€åˆ‡çš„åšæ³•ï¼Œå¯èƒ½å¯¼è‡´åœ¨æœ‰å…¶ä»–queryçš„å½±å“ä¸‹ï¼Œscoreä¸å‡†ç¡®çš„æƒ…å†µï¼Œè¿™æ—¶ä¸ºäº†ä½¿ç”¨ç»“æœæ›´å‡†ç¡®ï¼Œæœ€å¥½è¿˜æ˜¯è¦è€ƒè™‘åˆ°å…¶ä»–queryçš„å½±å“;ä½¿ç”¨ tie_breaker å°†å…¶ä»–queryçš„åˆ†æ•°ä¹Ÿè€ƒè™‘è¿›å», tie_breaker å‚æ•°çš„æ„ä¹‰ï¼Œå°†å…¶ä»–queryçš„åˆ†æ•°ä¹˜ä»¥tie_breakerï¼Œç„¶åç»¼åˆè€ƒè™‘åä¸æœ€é«˜åˆ†æ•°çš„é‚£ä¸ªqueryçš„åˆ†æ•°ç»¼åˆåœ¨ä¸€èµ·è¿›è¡Œè®¡ç®—ï¼Œè¿™æ ·åšé™¤äº†å–æœ€é«˜åˆ†ä»¥å¤–ï¼Œè¿˜ä¼šè€ƒè™‘å…¶ä»–çš„queryçš„åˆ†æ•°ã€‚tie_breakerçš„å€¼ï¼Œè®¾ç½®åœ¨åœ¨0~1ä¹‹é—´ï¼Œæ˜¯ä¸ªå°æ•°å°±è¡Œï¼Œæ²¡æœ‰å›ºå®šçš„å€¼ å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å¤šå­—æ®µæœç´¢ Â» æœ€ä½³å­—æ®µ Elasticsearchä¸­æ–‡æ–‡æ¡£ Elasticsearch Guide [7.x] Â» Query DSL Â» Compound queries Â» Disjunction max query","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"elasticsearchè¢«ç ´åçš„ç›¸ä¼¼åº¦","date":"2021-07-06T11:50:11.000Z","path":"wiki/elasticsearchè¢«ç ´åçš„ç›¸ä¼¼åº¦/","text":"åœ¨è®¨è®ºæ›´å¤æ‚çš„ å¤šå­—æ®µæœç´¢ ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¿«é€Ÿè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåªåœ¨ä¸»åˆ†ç‰‡ä¸Š åˆ›å»ºæµ‹è¯•ç´¢å¼• ã€‚ ç”¨æˆ·ä¼šæ—¶ä¸æ—¶çš„æŠ±æ€¨æ— æ³•æŒ‰ç›¸å…³åº¦æ’åºå¹¶æä¾›ç®€çŸ­çš„é‡ç°æ­¥éª¤ï¼šç”¨æˆ·ç´¢å¼•äº†ä¸€äº›æ–‡æ¡£ï¼Œè¿è¡Œä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ï¼Œç„¶åå‘ç°æ˜æ˜¾ä½ç›¸å…³åº¦çš„ç»“æœå‡ºç°åœ¨é«˜ç›¸å…³åº¦ç»“æœä¹‹ä¸Šã€‚ ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œå¯ä»¥è®¾æƒ³ï¼Œæˆ‘ä»¬åœ¨ä¸¤ä¸ªä¸»åˆ†ç‰‡ä¸Šåˆ›å»ºäº†ç´¢å¼•å’Œæ€»å…± 10 ä¸ªæ–‡æ¡£ï¼Œå…¶ä¸­ 6 ä¸ªæ–‡æ¡£æœ‰å•è¯ foo ã€‚å¯èƒ½æ˜¯åˆ†ç‰‡ 1 æœ‰å…¶ä¸­ 3 ä¸ª foo æ–‡æ¡£ï¼Œè€Œåˆ†ç‰‡ 2 æœ‰å…¶ä¸­å¦å¤– 3 ä¸ªæ–‡æ¡£ï¼Œæ¢å¥è¯è¯´ï¼Œæ‰€æœ‰æ–‡æ¡£æ˜¯å‡åŒ€åˆ†å¸ƒå­˜å‚¨çš„ã€‚ åœ¨ ä»€ä¹ˆæ˜¯ç›¸å…³åº¦ï¼Ÿä¸­ï¼Œæˆ‘ä»¬æè¿°äº† Elasticsearch é»˜è®¤ä½¿ç”¨çš„ç›¸ä¼¼åº¦ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å«åš è¯é¢‘/é€†å‘æ–‡æ¡£é¢‘ç‡ æˆ– TF/IDF ã€‚è¯é¢‘æ˜¯è®¡ç®—æŸä¸ªè¯åœ¨å½“å‰è¢«æŸ¥è¯¢æ–‡æ¡£é‡ŒæŸä¸ªå­—æ®µä¸­å‡ºç°çš„é¢‘ç‡ï¼Œå‡ºç°çš„é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£è¶Šç›¸å…³ã€‚ é€†å‘æ–‡æ¡£é¢‘ç‡ å°† æŸä¸ªè¯åœ¨ç´¢å¼•å†…æ‰€æœ‰æ–‡æ¡£å‡ºç°çš„ç™¾åˆ†æ•° è€ƒè™‘åœ¨å†…ï¼Œå‡ºç°çš„é¢‘ç‡è¶Šé«˜ï¼Œå®ƒçš„æƒé‡å°±è¶Šä½ã€‚ ä½†æ˜¯ç”±äºæ€§èƒ½åŸå› ï¼Œ Elasticsearch ä¸ä¼šè®¡ç®—ç´¢å¼•å†…æ‰€æœ‰æ–‡æ¡£çš„ IDF ã€‚ç›¸åï¼Œæ¯ä¸ªåˆ†ç‰‡ä¼šæ ¹æ® è¯¥åˆ†ç‰‡ å†…çš„æ‰€æœ‰æ–‡æ¡£è®¡ç®—ä¸€ä¸ªæœ¬åœ° IDF ã€‚ å› ä¸ºæ–‡æ¡£æ˜¯å‡åŒ€åˆ†å¸ƒå­˜å‚¨çš„ï¼Œä¸¤ä¸ªåˆ†ç‰‡çš„ IDF æ˜¯ç›¸åŒçš„ã€‚ç›¸åï¼Œè®¾æƒ³å¦‚æœæœ‰ 5 ä¸ª foo æ–‡æ¡£å­˜äºåˆ†ç‰‡ 1 ï¼Œè€Œç¬¬ 6 ä¸ªæ–‡æ¡£å­˜äºåˆ†ç‰‡ 2 ï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œ foo åœ¨ä¸€ä¸ªåˆ†ç‰‡é‡Œéå¸¸æ™®é€šï¼ˆæ‰€ä»¥ä¸é‚£ä¹ˆé‡è¦ï¼‰ï¼Œä½†æ˜¯åœ¨å¦ä¸€ä¸ªåˆ†ç‰‡é‡Œéå¸¸å‡ºç°å¾ˆå°‘ï¼ˆæ‰€ä»¥ä¼šæ˜¾å¾—æ›´é‡è¦ï¼‰ã€‚è¿™äº› IDF ä¹‹é—´çš„å·®å¼‚ä¼šå¯¼è‡´ä¸æ­£ç¡®çš„ç»“æœã€‚ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œæœ¬åœ°å’Œå…¨å±€çš„ IDF çš„å·®å¼‚ä¼šéšç€ç´¢å¼•é‡Œæ–‡æ¡£æ•°çš„å¢å¤šæ¸æ¸æ¶ˆå¤±ï¼Œåœ¨çœŸå®ä¸–ç•Œçš„æ•°æ®é‡ä¸‹ï¼Œå±€éƒ¨çš„ IDF ä¼šè¢«è¿…é€Ÿå‡åŒ–ï¼Œæ‰€ä»¥ä¸Šè¿°é—®é¢˜å¹¶ä¸æ˜¯ç›¸å…³åº¦è¢«ç ´åæ‰€å¯¼è‡´çš„ï¼Œè€Œæ˜¯ç”±äºæ•°æ®å¤ªå°‘ã€‚ ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ç§æ˜¯åªåœ¨ä¸»åˆ†ç‰‡ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæ­£å¦‚ match æŸ¥è¯¢ é‡Œä»‹ç»çš„é‚£æ ·ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåˆ†ç‰‡ï¼Œé‚£ä¹ˆæœ¬åœ°çš„ IDF å°±æ˜¯ å…¨å±€çš„ IDFã€‚ ç¬¬äºŒä¸ªæ–¹å¼å°±æ˜¯åœ¨æœç´¢è¯·æ±‚åæ·»åŠ  ?search_type=dfs_query_then_fetch ï¼Œ dfs æ˜¯æŒ‡ åˆ†å¸ƒå¼é¢‘ç‡æœç´¢ï¼ˆDistributed Frequency Searchï¼‰ ï¼Œ å®ƒå‘Šè¯‰ Elasticsearch ï¼Œå…ˆåˆ†åˆ«è·å¾—æ¯ä¸ªåˆ†ç‰‡æœ¬åœ°çš„ IDF ï¼Œç„¶åæ ¹æ®ç»“æœå†è®¡ç®—æ•´ä¸ªç´¢å¼•çš„å…¨å±€ IDF ã€‚ ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šä½¿ç”¨ dfs_query_then_fetch ã€‚å®Œå…¨æ²¡æœ‰å¿…è¦ã€‚åªè¦æœ‰è¶³å¤Ÿçš„æ•°æ®å°±èƒ½ä¿è¯è¯é¢‘æ˜¯å‡åŒ€åˆ†å¸ƒçš„ã€‚æ²¡æœ‰ç†ç”±ç»™æ¯ä¸ªæŸ¥è¯¢é¢å¤–åŠ ä¸Š DFS è¿™æ­¥ã€‚ å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» åŸºç¡€å…¥é—¨ Â» æ’åºä¸ç›¸å…³æ€§ Â» ä»€ä¹ˆæ˜¯ç›¸å…³æ€§? Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å…¨æ–‡æœç´¢ Â» è¢«ç ´åçš„ç›¸å…³åº¦ï¼","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"canalåŒæ­¥esåéƒ¨åˆ†å­—æ®µä¸ºnull","date":"2021-07-06T08:11:15.000Z","path":"wiki/canalåŒæ­¥esåéƒ¨åˆ†å­—æ®µä¸ºnull/","text":"ç°è±¡ é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112131415dataSourceKey: defaultDS # æºæ•°æ®æºçš„key, å¯¹åº”ä¸Šé¢é…ç½®çš„srcDataSourcesä¸­çš„å€¼destination: example # cannalçš„instanceæˆ–è€…MQçš„topicgroupId: g1 # å¯¹åº”MQæ¨¡å¼ä¸‹çš„groupId, åªä¼šåŒæ­¥å¯¹åº”groupIdçš„æ•°æ®esMapping: _index: rd_member_fans_info # es çš„ç´¢å¼•åç§° _type: _doc # es çš„docåç§° _id: _id # es çš„_id, å¦‚æœä¸é…ç½®è¯¥é¡¹å¿…é¡»é…ç½®ä¸‹é¢çš„pké¡¹_idåˆ™ä¼šç”±esè‡ªåŠ¨åˆ†é…# pk: id # å¦‚æœä¸éœ€è¦_id, åˆ™éœ€è¦æŒ‡å®šä¸€ä¸ªå±æ€§ä¸ºä¸»é”®å±æ€§# # sqlæ˜ å°„ sql: &#x27;SELECT t.id as _id , t.redtom_id ,t.fans_redtom_id,t.fans_username,t.fans_introduce,t.fans_avatar,t.is_each_following,t.follow_channel,t.create_time,t.update_time,t.`status` FROM rd_member_fans_info t&#x27;# objFields:# _labels: array:; # æ•°ç»„æˆ–è€…å¯¹è±¡å±æ€§, array:; ä»£è¡¨ä»¥;å­—æ®µé‡Œé¢æ˜¯ä»¥;åˆ†éš”çš„# _obj: object # jsonå¯¹è±¡ etlCondition: &quot;where t.update_time&gt;=&#123;&#125;&quot; # etl çš„æ¡ä»¶å‚æ•° commitBatch: 3000 # æäº¤æ‰¹å¤§å° âš ï¸ âš ï¸sqlæ‰§è¡Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ canal-adapter è·å–binlogæ•°æ®ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ˜¾ç¤ºæ—¥å¿—å¦‚ä¸‹ï¼š 12021-07-06 15:39:24.588 [pool-1-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:3,&quot;redtom_id&quot;:1,&quot;fans_redtom_id&quot;:1,&quot;fans_username&quot;:&quot;1&quot;,&quot;fans_introduce&quot;:&quot;1&quot;,&quot;fans_avatar&quot;:&quot;1&quot;,&quot;is_each_following&quot;:1,&quot;follow_channel&quot;:1,&quot;create_time&quot;:1625556851000,&quot;update_time&quot;:1625556851000,&quot;status&quot;:2&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625557164000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[&quot;id&quot;],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;rd_member_fans_info&quot;,&quot;ts&quot;:1625557164587,&quot;type&quot;:&quot;INSERT&quot;&#125; ç„¶åçœ‹ä¸€ä¸‹æˆ‘åˆ›å»ºç´¢å¼•çš„mapping è§£å†³æ–¹æ³•è°ƒæ•´sqlå¦‚ä¸‹ï¼š SELECT t.id as _id , t.redtom_id ,t.fans_redtom_id,t.fans_username,t.fans_introduce,t.fans_avatar,t.is_each_following,t.follow_channel,t.status as is_deleted , t.create_time,t.update_time FROM rd_member_fans_info t è°ƒæ•´äº†é‚£äº›ä¸œè¥¿å‘¢ï¼Ÿ status çš„é¡ºåºæå‰è€Œå·²ï¼ æµ‹è¯•æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼šcurl http://127.0.0.1:8081/etl/es7/rd_member_fans_info.yml -X POST canal-adapter æ—¥å¿—å¦‚ä¸‹ï¼š 122021-07-06 16:21:33.519 [http-nio-8081-exec-1] INFO c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member_fans_info2021-07-06 16:21:33.527 [http-nio-8081-exec-1] INFO c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - æ•°æ®å…¨é‡å¯¼å…¥å®Œæˆ, ä¸€å…±å¯¼å…¥ 3 æ¡æ•°æ®, è€—æ—¶: 7 æŸ¥çœ‹esæ•°æ®ï¼š","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"elasticsearch-analyzer","date":"2021-07-06T07:02:01.000Z","path":"wiki/elasticsearch-analyzer/","text":"æµ‹è¯•å¸¸è§åˆ†æå™¨GET /_analyze 1234&#123; &quot;analyzer&quot;: &quot;standard&quot;, &quot;text&quot;: &quot;Oredr it now from Amazon #fun #girlpower #fatscooter #Fat #Cats&quot;&#125; GET /_analyze 12345&#123; &quot;analyzer&quot;: &quot;english&quot;, &quot;text&quot;: &quot;Oredr it now from Amazon #fun #girlpower #fatscooter #Fat #Cats&quot;&#125; GET /_analyze 1234&#123; &quot;analyzer&quot;: &quot;simple&quot;, &quot;text&quot;: &quot;Oredr it now from Amazon #fun #girlpower #fatscooter #Fat Cats&quot;&#125; GET /_analyze 1234&#123; &quot;analyzer&quot;: &quot;stop&quot;, &quot;text&quot;: &quot;Oredr it now from Amazon #fun #girlpower #fatscooter #Fat Cats&quot;&#125; é»˜è®¤åˆ†æå™¨è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µå±‚çº§æŒ‡å®šåˆ†æå™¨ï¼Œä½†æ˜¯å¦‚æœè¯¥å±‚çº§æ²¡æœ‰æŒ‡å®šä»»ä½•çš„åˆ†æå™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•èƒ½ç¡®å®šè¿™ä¸ªå­—æ®µä½¿ç”¨çš„æ˜¯å“ªä¸ªåˆ†æå™¨å‘¢ï¼Ÿ åˆ†æå™¨å¯ä»¥ä»ä¸‰ä¸ªå±‚é¢è¿›è¡Œå®šä¹‰ï¼šæŒ‰å­—æ®µï¼ˆper-fieldï¼‰ã€æŒ‰ç´¢å¼•ï¼ˆper-indexï¼‰æˆ–å…¨å±€ç¼ºçœï¼ˆglobal defaultï¼‰ã€‚Elasticsearch ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºä¾æ¬¡å¤„ç†ï¼Œç›´åˆ°å®ƒæ‰¾åˆ°èƒ½å¤Ÿä½¿ç”¨çš„åˆ†æå™¨ã€‚ç´¢å¼•æ—¶çš„é¡ºåºå¦‚ä¸‹ï¼š å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ analyzer ï¼Œå¦åˆ™ ç´¢å¼•è®¾ç½®ä¸­åä¸º default çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º standard æ ‡å‡†åˆ†æå™¨ åœ¨æœç´¢æ—¶ï¼Œé¡ºåºæœ‰äº›è®¸ä¸åŒï¼š æŸ¥è¯¢è‡ªå·±å®šä¹‰çš„ analyzer ï¼Œå¦åˆ™ å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ analyzer ï¼Œå¦åˆ™ ç´¢å¼•è®¾ç½®ä¸­åä¸º default çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸º standard æ ‡å‡†åˆ†æå™¨ æœ‰æ—¶ï¼Œåœ¨ç´¢å¼•æ—¶å’Œæœç´¢æ—¶ä½¿ç”¨ä¸åŒçš„åˆ†æå™¨æ˜¯åˆç†çš„ã€‚æˆ‘ä»¬å¯èƒ½è¦æƒ³ä¸ºåŒä¹‰è¯å»ºç´¢å¼•ï¼ˆä¾‹å¦‚ï¼Œæ‰€æœ‰ quick å‡ºç°çš„åœ°æ–¹ï¼ŒåŒæ—¶ä¹Ÿä¸º fast ã€ rapid å’Œ speedy åˆ›å»ºç´¢å¼•ï¼‰ã€‚ä½†åœ¨æœç´¢æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦æœç´¢æ‰€æœ‰çš„åŒä¹‰è¯ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å¯»æ‰¾ç”¨æˆ·è¾“å…¥çš„å•è¯æ˜¯å¦æ˜¯ quick ã€ fast ã€ rapid æˆ– speedy ã€‚ ä¸ºäº†åŒºåˆ†ï¼ŒElasticsearch ä¹Ÿæ”¯æŒä¸€ä¸ªå¯é€‰çš„ search_analyzer æ˜ å°„ï¼Œå®ƒä»…ä¼šåº”ç”¨äºæœç´¢æ—¶ï¼ˆ analyzer è¿˜ç”¨äºç´¢å¼•æ—¶ï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªç­‰ä»·çš„ default_search æ˜ å°„ï¼Œç”¨ä»¥æŒ‡å®šç´¢å¼•å±‚çš„é»˜è®¤é…ç½®ã€‚ å¦‚æœè€ƒè™‘åˆ°è¿™äº›é¢å¤–å‚æ•°ï¼Œä¸€ä¸ªæœç´¢æ—¶çš„ å®Œæ•´ é¡ºåºä¼šæ˜¯ä¸‹é¢è¿™æ ·ï¼š æŸ¥è¯¢è‡ªå·±å®šä¹‰çš„ analyzer ï¼Œå¦åˆ™å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ search_analyzer ï¼Œå¦åˆ™å­—æ®µæ˜ å°„é‡Œå®šä¹‰çš„ analyzer ï¼Œå¦åˆ™ç´¢å¼•è®¾ç½®ä¸­åä¸º default_search çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸ºç´¢å¼•è®¾ç½®ä¸­åä¸º default çš„åˆ†æå™¨ï¼Œé»˜è®¤ä¸ºstandard æ ‡å‡†åˆ†æå™¨ ä¿æŒç®€å•å¤šæ•°æƒ…å†µä¸‹ï¼Œä¼šæå‰çŸ¥é“æ–‡æ¡£ä¼šåŒ…æ‹¬å“ªäº›å­—æ®µã€‚æœ€ç®€å•çš„é€”å¾„å°±æ˜¯åœ¨åˆ›å»ºç´¢å¼•æˆ–è€…å¢åŠ ç±»å‹æ˜ å°„æ—¶ï¼Œä¸ºæ¯ä¸ªå…¨æ–‡å­—æ®µè®¾ç½®åˆ†æå™¨ã€‚è¿™ç§æ–¹å¼å°½ç®¡æœ‰ç‚¹éº»çƒ¦ï¼Œä½†æ˜¯å®ƒè®©æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°æ¯ä¸ªå­—æ®µæ¯ä¸ªåˆ†æå™¨æ˜¯å¦‚ä½•è®¾ç½®çš„ã€‚ é€šå¸¸ï¼Œå¤šæ•°å­—ç¬¦ä¸²å­—æ®µéƒ½æ˜¯ not_analyzed ç²¾ç¡®å€¼å­—æ®µï¼Œæ¯”å¦‚æ ‡ç­¾ï¼ˆtagï¼‰æˆ–æšä¸¾ï¼ˆenumï¼‰ï¼Œè€Œä¸”æ›´å¤šçš„å…¨æ–‡å­—æ®µä¼šä½¿ç”¨é»˜è®¤çš„ standard åˆ†æå™¨æˆ– english æˆ–å…¶ä»–æŸç§è¯­è¨€çš„åˆ†æå™¨ã€‚è¿™æ ·åªéœ€è¦ä¸ºå°‘æ•°ä¸€ä¸¤ä¸ªå­—æ®µæŒ‡å®šè‡ªå®šä¹‰åˆ†æï¼šæˆ–è®¸æ ‡é¢˜ title å­—æ®µéœ€è¦ä»¥æ”¯æŒ è¾“å…¥å³æŸ¥æ‰¾ï¼ˆfind-as-you-typeï¼‰ çš„æ–¹å¼è¿›è¡Œç´¢å¼•ã€‚ å¯ä»¥åœ¨ç´¢å¼•çº§åˆ«è®¾ç½®ä¸­ï¼Œä¸ºç»å¤§éƒ¨åˆ†çš„å­—æ®µè®¾ç½®ä½ æƒ³æŒ‡å®šçš„ default é»˜è®¤åˆ†æå™¨ã€‚ç„¶ååœ¨å­—æ®µçº§åˆ«è®¾ç½®ä¸­ï¼Œå¯¹æŸä¸€ä¸¤ä¸ªå­—æ®µé…ç½®éœ€è¦æŒ‡å®šçš„åˆ†æå™¨ã€‚ ğŸ“’ ğŸ“’ ğŸ“’å¯¹äºå’Œæ—¶é—´ç›¸å…³çš„æ—¥å¿—æ•°æ®ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯å¤©è‡ªè¡Œåˆ›å»ºç´¢å¼•ï¼Œç”±äºè¿™ç§æ–¹å¼ä¸æ˜¯ä»å¤´åˆ›å»ºçš„ç´¢å¼•ï¼Œä»ç„¶å¯ä»¥ç”¨ ç´¢å¼•æ¨¡æ¿ï¼ˆIndex Templateï¼‰ ä¸ºæ–°å»ºçš„ç´¢å¼•æŒ‡å®šé…ç½®å’Œæ˜ å°„ã€‚ å‚è€ƒèµ„æ–™ Elasticsearch: æƒå¨æŒ‡å— Â» æ·±å…¥æœç´¢ Â» å…¨æ–‡æœç´¢ Â» æ§åˆ¶åˆ†æ","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"Parameter index out of range (1 > number of parameters, which is 0).","date":"2021-07-06T05:03:16.000Z","path":"wiki/Parameter-index-out-of-range-1-number-of-parameters-which-is-0/","text":"é—®é¢˜è®°å½•123456789101112132021-07-06 12:39:31.179 [http-nio-8081-exec-2] INFO c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member2021-07-06 12:39:31.186 [http-nio-8081-exec-2] ERROR com.alibaba.otter.canal.client.adapter.support.Util - sqlRs has error, sql: SELECT COUNT(1) FROM ( select t.redtom_id as id, t.username, t.nickname, t.avatar, t.status, t.mobile, t.mobile_region_no, t.email, t.gender, t.password,t.salt,t.birthday,t.introduce,t.country,t.region,t.level,t.is_vip,t.follows ,t.fans,t.likes_num, t.collects_num, t.instagram_account, t.youtube_account, t.facebook_account, t.twitter_account,t.create_ip, t.create_time,t.update_time from rd_member r where t.create_time&gt;=&#x27;&#123;0&#125;&#x27;) _CNT2021-07-06 12:39:31.188 [http-nio-8081-exec-2] ERROR c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - java.sql.SQLException: Parameter index out of range (1 &gt; number of parameters, which is 0).java.lang.RuntimeException: java.sql.SQLException: Parameter index out of range (1 &gt; number of parameters, which is 0). at com.alibaba.otter.canal.client.adapter.support.Util.sqlRS(Util.java:65) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.client.adapter.support.AbstractEtlService.importData(AbstractEtlService.java:62) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.importData(ESEtlService.java:56) [client-adapter.es7x-1.1.5-SNAPSHOT-jar-with-dependencies.jar:na] at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.etl(ES7xAdapter.java:79) [client-adapter.es7x-1.1.5-SNAPSHOT-jar-with-dependencies.jar:na] at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:100) [client-adapter.launcher-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:123) [client-adapter.launcher-1.1.5-SNAPSHOT.jar:na] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_292] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_292] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_292] å¦‚ä½•è§£å†³æˆ‘æ‰§è¡Œçš„æ“ä½œå¦‚ä¸‹ï¼šğŸ‘‡curl http://127.0.0.1:8081/etl/es7/customer.yml -X POST -d &quot;params=2019-08-31 00:00:00&quot; ä½†æ˜¯æˆ‘çš„ es7/rd_member.ymlçš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š etlCondition:&quot;where a.c_time&gt;=&#39;&#123;0&#125;&#39;&quot; # etl çš„æ¡ä»¶å‚æ•° åº”è¯¥æ”¹æˆï¼šetlCondition:&quot;where a.c_time&gt;=&#123;&#125;&quot; # etl çš„æ¡ä»¶å‚æ•°","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Other Question","slug":"Elasticsearch/Other-Question","permalink":"http://example.com/categories/Elasticsearch/Other-Question/"}]},{"title":"field name is null or empty","date":"2021-07-06T04:53:44.000Z","path":"wiki/field-name-is-null-or-empty/","text":"canal adapter æŠ¥é”™ä¿¡æ¯123456789101112131415161718192021222021-07-06 12:46:31.959 [http-nio-8081-exec-2] INFO o.a.catalina.core.ContainerBase.[Tomcat].[localhost].[/] - Initializing Spring FrameworkServlet &#x27;dispatcherServlet&#x27;2021-07-06 12:46:31.959 [http-nio-8081-exec-2] INFO org.springframework.web.servlet.DispatcherServlet - FrameworkServlet &#x27;dispatcherServlet&#x27;: initialization started2021-07-06 12:46:31.968 [http-nio-8081-exec-2] INFO org.springframework.web.servlet.DispatcherServlet - FrameworkServlet &#x27;dispatcherServlet&#x27;: initialization completed in 9 ms2021-07-06 12:46:31.995 [http-nio-8081-exec-2] INFO c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - start etl to import data to index: rd_member2021-07-06 12:46:32.027 [http-nio-8081-exec-2] ERROR c.a.otter.canal.client.adapter.es7x.etl.ESEtlService - field name is null or emptyjava.lang.IllegalArgumentException: field name is null or empty at org.elasticsearch.index.query.BaseTermQueryBuilder.&lt;init&gt;(BaseTermQueryBuilder.java:113) ~[na:na] at org.elasticsearch.index.query.TermQueryBuilder.&lt;init&gt;(TermQueryBuilder.java:75) ~[na:na] at org.elasticsearch.index.query.QueryBuilders.termQuery(QueryBuilders.java:202) ~[na:na] at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.lambda$executeSqlImport$1(ESEtlService.java:141) ~[na:na] at com.alibaba.otter.canal.client.adapter.support.Util.sqlRS(Util.java:60) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.executeSqlImport(ESEtlService.java:64) ~[na:na] at com.alibaba.otter.canal.client.adapter.support.AbstractEtlService.importData(AbstractEtlService.java:105) ~[client-adapter.common-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.client.adapter.es7x.etl.ESEtlService.importData(ESEtlService.java:56) ~[na:na] at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.etl(ES7xAdapter.java:79) ~[na:na] at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:100) ~[client-adapter.launcher-1.1.5-SNAPSHOT.jar:na] at com.alibaba.otter.canal.adapter.launcher.rest.CommonRest.etl(CommonRest.java:123) ~[client-adapter.launcher-1.1.5-SNAPSHOT.jar:na] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_292] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_292] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_292] at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_292] at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke é—®é¢˜æ’æŸ¥æ“ä½œæ˜¯å‘æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œé€šè¿‡canal-adapteråŒæ­¥åˆ°elasticsearchä¸­ï¼Œæ¥å£å‘ç”Ÿä»¥ä¸Šé”™è¯¯ï¼ç°è±¡æ˜¯canal-adapteræ£€æµ‹åˆ°å’Œmysqlçš„æ•°æ®å˜åŒ–ï¼Œä½†æ˜¯åŒæ­¥åˆ°esçš„æ—¶å€™å‘ç”Ÿäº†é”™è¯¯ï¼›çŒœæƒ³å¤§æ¦‚æ˜¯æŸä¸ªä¸ºç©ºå¯¼è‡´å­˜åˆ°esçš„æ—¶å€™å‘ç”Ÿå¼‚å¸¸ï¼› ç„¶åæŸ¥çœ‹es7ä¸‹çš„mappingé…ç½®ï¼š å‘ç°æˆ‘çš„sqlæŸ¥idçš„æ—¶å€™å†™é”™äº†ï¼Œåˆ«ååº”è¯¥å†™æˆ_id,å¯¹åº”elasticsearchçš„_id","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Other Question","slug":"Elasticsearch/Other-Question","permalink":"http://example.com/categories/Elasticsearch/Other-Question/"}]},{"title":"elasticsearchæ˜ å°„","date":"2021-07-05T14:54:05.000Z","path":"wiki/elasticsearchæ˜ å°„/","text":"Elasticsearch æ”¯æŒå¦‚ä¸‹ç®€å•åŸŸç±»å‹ï¼š å­—ç¬¦ä¸²: string ï¼ˆes7ä¹‹åç¼–ç¨‹textï¼‰ æ•´æ•° : byte, short, integer, long æµ®ç‚¹æ•°: float, double å¸ƒå°”å‹: boolean æ—¥æœŸ: date æŸ¥çœ‹ç´¢å¼•çš„mappingGET /gb/_mapping/tweet 1234567891011121314151617181920212223&#123; &quot;gb&quot;: &#123; &quot;mappings&quot;: &#123; &quot;tweet&quot;: &#123; &quot;properties&quot;: &#123; &quot;date&quot;: &#123; &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;strict_date_optional_time||epoch_millis&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;string&quot; &#125;, &quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot; &#125;, &quot;user_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125; &#125; &#125; &#125; &#125;&#125; è‡ªå®šä¹‰åŸŸæ˜ å°„å°½ç®¡åœ¨å¾ˆå¤šæƒ…å†µä¸‹åŸºæœ¬åŸŸæ•°æ®ç±»å‹å·²ç»å¤Ÿç”¨ï¼Œä½†ä½ ç»å¸¸éœ€è¦ä¸ºå•ç‹¬åŸŸè‡ªå®šä¹‰æ˜ å°„ï¼Œç‰¹åˆ«æ˜¯å­—ç¬¦ä¸²åŸŸã€‚è‡ªå®šä¹‰æ˜ å°„å…è®¸ä½ æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š å…¨æ–‡å­—ç¬¦ä¸²åŸŸå’Œç²¾ç¡®å€¼å­—ç¬¦ä¸²åŸŸçš„åŒºåˆ« ä½¿ç”¨ç‰¹å®šè¯­è¨€åˆ†æå™¨ ä¼˜åŒ–åŸŸä»¥é€‚åº”éƒ¨åˆ†åŒ¹é… æŒ‡å®šè‡ªå®šä¹‰æ•°æ®æ ¼å¼ è¿˜æœ‰æ›´å¤š åŸŸæœ€é‡è¦çš„å±æ€§æ˜¯ type ã€‚å¯¹äºä¸æ˜¯ string çš„åŸŸï¼Œä½ ä¸€èˆ¬åªéœ€è¦è®¾ç½® type ï¼š 12345&#123; &quot;number_of_clicks&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;&#125; é»˜è®¤ï¼Œ string (text) ç±»å‹åŸŸä¼šè¢«è®¤ä¸ºåŒ…å«å…¨æ–‡ã€‚å°±æ˜¯è¯´ï¼Œå®ƒä»¬çš„å€¼åœ¨ç´¢å¼•å‰ï¼Œä¼šé€šè¿‡ä¸€ä¸ªåˆ†æå™¨ï¼Œé’ˆå¯¹äºè¿™ä¸ªåŸŸçš„æŸ¥è¯¢åœ¨æœç´¢å‰ä¹Ÿä¼šç»è¿‡ä¸€ä¸ªåˆ†æå™¨ã€‚ string åŸŸæ˜ å°„çš„ä¸¤ä¸ªæœ€é‡è¦å±æ€§æ˜¯ index å’Œ analyzer ã€‚ indexindex å±æ€§æ§åˆ¶æ€æ ·ç´¢å¼•å­—ç¬¦ä¸²ã€‚å®ƒå¯ä»¥æ˜¯ä¸‹é¢ä¸‰ä¸ªå€¼ï¼š analyzedé¦–å…ˆåˆ†æå­—ç¬¦ä¸²ï¼Œç„¶åç´¢å¼•å®ƒã€‚æ¢å¥è¯è¯´ï¼Œä»¥å…¨æ–‡ç´¢å¼•è¿™ä¸ªåŸŸã€‚ not_analyzed ç´¢å¼•è¿™ä¸ªåŸŸï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¢«æœç´¢ï¼Œä½†ç´¢å¼•çš„æ˜¯ç²¾ç¡®å€¼ã€‚ä¸ä¼šå¯¹å®ƒè¿›è¡Œåˆ†æã€‚ noä¸ç´¢å¼•è¿™ä¸ªåŸŸã€‚è¿™ä¸ªåŸŸä¸ä¼šè¢«æœç´¢åˆ°ã€‚ (æ¯”å¦‚ä¸€äº›éšç§ä¿¡æ¯) string åŸŸ index å±æ€§é»˜è®¤æ˜¯ analyzed ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜ å°„è¿™ä¸ªå­—æ®µä¸ºä¸€ä¸ªç²¾ç¡®å€¼ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å®ƒä¸º not_analyzed ï¼š âš ï¸ âš ï¸å…¶ä»–ç®€å•ç±»å‹ï¼ˆä¾‹å¦‚ long ï¼Œ double ï¼Œ date ç­‰ï¼‰ä¹Ÿæ¥å— index å‚æ•°ï¼Œä½†æœ‰æ„ä¹‰çš„å€¼åªæœ‰ no å’Œ not_analyzed ï¼Œ å› ä¸ºå®ƒä»¬æ°¸è¿œä¸ä¼šè¢«åˆ†æã€‚ analyzerå¯¹äº analyzed å­—ç¬¦ä¸²åŸŸï¼Œç”¨ analyzer å±æ€§æŒ‡å®šåœ¨æœç´¢å’Œç´¢å¼•æ—¶ä½¿ç”¨çš„åˆ†æå™¨ã€‚é»˜è®¤ï¼Œ Elasticsearch ä½¿ç”¨ standard åˆ†æå™¨ï¼Œ ä½†ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå†…ç½®çš„åˆ†æå™¨æ›¿ä»£å®ƒï¼Œä¾‹å¦‚ whitespace ã€ simple å’Œ english; 123456&#123; &quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot; &#125;&#125; æ›´æ–°æ˜ å°„å½“ä½ é¦–æ¬¡åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç±»å‹çš„æ˜ å°„ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ /_mapping ä¸ºæ–°ç±»å‹ï¼ˆæˆ–è€…ä¸ºå­˜åœ¨çš„ç±»å‹æ›´æ–°æ˜ å°„ï¼‰å¢åŠ æ˜ å°„ã€‚âš ï¸ âš ï¸å°½ç®¡ä½ å¯ä»¥ å¢åŠ  ä¸€ä¸ªå­˜åœ¨çš„æ˜ å°„ï¼Œä½ ä¸èƒ½ ä¿®æ”¹ å­˜åœ¨çš„åŸŸæ˜ å°„ã€‚å¦‚æœä¸€ä¸ªåŸŸçš„æ˜ å°„å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥åŸŸçš„æ•°æ®å¯èƒ½å·²ç»è¢«ç´¢å¼•ã€‚å¦‚æœä½ æ„å›¾ä¿®æ”¹è¿™ä¸ªåŸŸçš„æ˜ å°„ï¼Œç´¢å¼•çš„æ•°æ®å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸èƒ½è¢«æ­£å¸¸çš„æœç´¢ã€‚ æˆ‘ä»¬å¯ä»¥æ›´æ–°ä¸€ä¸ªæ˜ å°„æ¥æ·»åŠ ä¸€ä¸ªæ–°åŸŸï¼Œä½†ä¸èƒ½å°†ä¸€ä¸ªå­˜åœ¨çš„åŸŸä» analyzed æ”¹ä¸º not_analyzed ã€‚ ä¸ºäº†æè¿°æŒ‡å®šæ˜ å°„çš„ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ gd ç´¢å¼•ï¼šDELETE /gbç„¶ååˆ›å»ºä¸€ä¸ªæ–°ç´¢å¼•ï¼ŒæŒ‡å®š tweet åŸŸä½¿ç”¨ english åˆ†æå™¨ï¼š 12345678910111213141516171819202122PUT /gb &#123; &quot;mappings&quot;: &#123; &quot;tweet&quot; : &#123; &quot;properties&quot; : &#123; &quot;tweet&quot; : &#123; &quot;type&quot; : &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot; &#125;, &quot;date&quot; : &#123; &quot;type&quot; : &quot;date&quot; &#125;, &quot;name&quot; : &#123; &quot;type&quot; : &quot;string&quot; &#125;, &quot;user_id&quot; : &#123; &quot;type&quot; : &quot;long&quot; &#125; &#125; &#125; &#125;&#125; ç¨åï¼Œæˆ‘ä»¬å†³å®šåœ¨ tweet æ˜ å°„å¢åŠ ä¸€ä¸ªæ–°çš„åä¸º tag çš„ not_analyzed çš„æ–‡æœ¬åŸŸï¼Œä½¿ç”¨ _mapping ï¼š 123456789PUT /gb/_mapping/tweet&#123; &quot;properties&quot; : &#123; &quot;tag&quot; : &#123; &quot;type&quot; : &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot; &#125; &#125;&#125; æ³¨æ„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†æ¬¡åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„åŸŸï¼Œå› ä¸ºæ— è®ºå¦‚ä½•æˆ‘ä»¬éƒ½æ— æ³•æ”¹å˜å®ƒä»¬ã€‚æ–°åŸŸå·²ç»è¢«åˆå¹¶åˆ°å­˜åœ¨çš„æ˜ å°„ä¸­ æµ‹è¯•æ˜ å°„ä½ å¯ä»¥ä½¿ç”¨ analyze API æµ‹è¯•å­—ç¬¦ä¸²åŸŸçš„æ˜ å°„ã€‚æ¯”è¾ƒä¸‹é¢ä¸¤ä¸ªè¯·æ±‚çš„è¾“å‡ºï¼š 1234567891011GET /gb/_analyze&#123; &quot;field&quot;: &quot;tweet&quot;, &quot;text&quot;: &quot;Black-cats&quot; &#125;GET /gb/_analyze&#123; &quot;field&quot;: &quot;tag&quot;, &quot;text&quot;: &quot;Black-cats&quot; &#125; tweet åŸŸäº§ç”Ÿä¸¤ä¸ªè¯æ¡ black å’Œ cat ï¼Œ tag åŸŸäº§ç”Ÿå•ç‹¬çš„è¯æ¡ Black-cats ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„æ˜ å°„æ­£å¸¸å·¥ä½œã€‚ å‚è€ƒèµ„æ–™ Elasticsearchæƒå¨æŒ‡å—","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"}]},{"title":"åˆ†æä¸åˆ†æå™¨","date":"2021-07-05T14:43:44.000Z","path":"wiki/åˆ†æä¸åˆ†æå™¨/","text":"åˆ†æåŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š é¦–å…ˆï¼Œå°†ä¸€å—æ–‡æœ¬åˆ†æˆé€‚åˆäºå€’æ’ç´¢å¼•çš„ç‹¬ç«‹çš„ è¯æ¡ ï¼Œä¹‹åï¼Œå°†è¿™äº›è¯æ¡ç»Ÿä¸€åŒ–ä¸ºæ ‡å‡†æ ¼å¼ä»¥æé«˜å®ƒä»¬çš„â€œå¯æœç´¢æ€§â€ï¼Œæˆ–è€… recallåˆ†æå™¨æ‰§è¡Œä¸Šé¢çš„å·¥ä½œã€‚ åˆ†æå™¨ å®é™…ä¸Šæ˜¯å°†ä¸‰ä¸ªåŠŸèƒ½å°è£…åˆ°äº†ä¸€ä¸ªåŒ…é‡Œï¼š å­—ç¬¦è¿‡æ»¤å™¨é¦–å…ˆï¼Œå­—ç¬¦ä¸²æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª å­—ç¬¦è¿‡æ»¤å™¨ ã€‚ä»–ä»¬çš„ä»»åŠ¡æ˜¯åœ¨åˆ†è¯å‰æ•´ç†å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥å»æ‰HTMLï¼Œæˆ–è€…å°† &amp; è½¬åŒ–æˆ andã€‚ åˆ†è¯å™¨å…¶æ¬¡ï¼Œå­—ç¬¦ä¸²è¢« åˆ†è¯å™¨ åˆ†ä¸ºå•ä¸ªçš„è¯æ¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ†è¯å™¨é‡åˆ°ç©ºæ ¼å’Œæ ‡ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†æ–‡æœ¬æ‹†åˆ†æˆè¯æ¡ã€‚ Token è¿‡æ»¤å™¨æœ€åï¼Œè¯æ¡æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª token è¿‡æ»¤å™¨ ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œå°å†™åŒ– Quick ï¼‰ï¼Œåˆ é™¤è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œ åƒ aï¼Œ andï¼Œ the ç­‰æ— ç”¨è¯ï¼‰ï¼Œæˆ–è€…å¢åŠ è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œåƒ jump å’Œ leap è¿™ç§åŒä¹‰è¯ï¼‰ã€‚Elasticsearchæä¾›äº†å¼€ç®±å³ç”¨çš„å­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨å’Œtoken è¿‡æ»¤å™¨ã€‚ è¿™äº›å¯ä»¥ç»„åˆèµ·æ¥å½¢æˆè‡ªå®šä¹‰çš„åˆ†æå™¨ä»¥ç”¨äºä¸åŒçš„ç›®çš„ã€‚ å†…ç½®åˆ†æå™¨ä½†æ˜¯ï¼Œ Elasticsearchè¿˜é™„å¸¦äº†å¯ä»¥ç›´æ¥ä½¿ç”¨çš„é¢„åŒ…è£…çš„åˆ†æå™¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ—å‡ºæœ€é‡è¦çš„åˆ†æå™¨ã€‚ä¸ºäº†è¯æ˜å®ƒä»¬çš„å·®å¼‚ï¼Œæˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªåˆ†æå™¨ä¼šä»ä¸‹é¢çš„å­—ç¬¦ä¸²å¾—åˆ°å“ªäº›è¯æ¡ï¼š&quot;Set the shape to semi-transparent by calling set_trans(5)&quot; æ ‡å‡†åˆ†æå™¨æ ‡å‡†åˆ†æå™¨æ˜¯Elasticsearché»˜è®¤ä½¿ç”¨çš„åˆ†æå™¨ã€‚å®ƒæ˜¯åˆ†æå„ç§è¯­è¨€æ–‡æœ¬æœ€å¸¸ç”¨çš„é€‰æ‹©ã€‚å®ƒæ ¹æ® Unicode è”ç›Ÿ å®šä¹‰çš„ å•è¯è¾¹ç•Œ åˆ’åˆ†æ–‡æœ¬ã€‚åˆ é™¤ç»å¤§éƒ¨åˆ†æ ‡ç‚¹ã€‚æœ€åï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿset, the, shape, to, semi, transparent, by, calling, set_trans, 5 ç®€å•åˆ†æå™¨ç®€å•åˆ†æå™¨åœ¨ä»»ä½•ä¸æ˜¯å­—æ¯çš„åœ°æ–¹åˆ†éš”æ–‡æœ¬ï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿset, the, shape, to, semi, transparent, by, calling, set, trans ç©ºæ ¼åˆ†æå™¨ç©ºæ ¼åˆ†æå™¨åœ¨ç©ºæ ¼çš„åœ°æ–¹åˆ’åˆ†æ–‡æœ¬ã€‚å®ƒä¼šäº§ç”ŸSet, the, shape, to, semi-transparent, by, calling, set_trans(5) è¯­è¨€åˆ†æå™¨ç‰¹å®šè¯­è¨€åˆ†æå™¨å¯ç”¨äº å¾ˆå¤šè¯­è¨€ã€‚å®ƒä»¬å¯ä»¥è€ƒè™‘æŒ‡å®šè¯­è¨€çš„ç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œ è‹±è¯­ åˆ†æå™¨é™„å¸¦äº†ä¸€ç»„è‹±è¯­æ— ç”¨è¯ï¼ˆå¸¸ç”¨å•è¯ï¼Œä¾‹å¦‚ and æˆ–è€… the ï¼Œå®ƒä»¬å¯¹ç›¸å…³æ€§æ²¡æœ‰å¤šå°‘å½±å“ï¼‰ï¼Œå®ƒä»¬ä¼šè¢«åˆ é™¤ã€‚ ç”±äºç†è§£è‹±è¯­è¯­æ³•çš„è§„åˆ™ï¼Œè¿™ä¸ªåˆ†è¯å™¨å¯ä»¥æå–è‹±è¯­å•è¯çš„ è¯å¹² ã€‚ è‹±è¯­ åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼šset, shape, semi, transpar, call, set_tran, 5æ³¨æ„çœ‹ transparentã€ calling å’Œ set_trans å·²ç»å˜ä¸ºè¯æ ¹æ ¼å¼ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨å½“æˆ‘ä»¬ ç´¢å¼• ä¸€ä¸ªæ–‡æ¡£ï¼Œå®ƒçš„å…¨æ–‡åŸŸè¢«åˆ†ææˆè¯æ¡ä»¥ç”¨æ¥åˆ›å»ºå€’æ’ç´¢å¼•ã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨å…¨æ–‡åŸŸ æœç´¢ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†æŸ¥è¯¢å­—ç¬¦ä¸²é€šè¿‡ ç›¸åŒçš„åˆ†æè¿‡ç¨‹ ï¼Œä»¥ä¿è¯æˆ‘ä»¬æœç´¢çš„è¯æ¡æ ¼å¼ä¸ç´¢å¼•ä¸­çš„è¯æ¡æ ¼å¼ä¸€è‡´ã€‚ å…¨æ–‡æŸ¥è¯¢ï¼Œç†è§£æ¯ä¸ªåŸŸæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åšæ­£ç¡®çš„äº‹ï¼š å½“ä½ æŸ¥è¯¢ä¸€ä¸ª å…¨æ–‡ åŸŸæ—¶ï¼Œ ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²åº”ç”¨ç›¸åŒçš„åˆ†æå™¨ï¼Œä»¥äº§ç”Ÿæ­£ç¡®çš„æœç´¢è¯æ¡åˆ—è¡¨ã€‚å½“ä½ æŸ¥è¯¢ä¸€ä¸ª ç²¾ç¡®å€¼ åŸŸæ—¶ï¼Œä¸ä¼šåˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æœç´¢ä½ æŒ‡å®šçš„ç²¾ç¡®å€¼ã€‚ æµ‹è¯•åˆ†æå™¨æœ‰äº›æ—¶å€™å¾ˆéš¾ç†è§£åˆ†è¯çš„è¿‡ç¨‹å’Œå®é™…è¢«å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ï¼Œç‰¹åˆ«æ˜¯ä½ åˆšæ¥è§¦Elasticsearchã€‚ä¸ºäº†ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ analyze API æ¥çœ‹æ–‡æœ¬æ˜¯å¦‚ä½•è¢«åˆ†æçš„ã€‚åœ¨æ¶ˆæ¯ä½“é‡Œï¼ŒæŒ‡å®šåˆ†æå™¨å’Œè¦åˆ†æçš„æ–‡æœ¬ï¼š 12345GET /_analyze&#123; &quot;analyzer&quot;: &quot;standard&quot;, &quot;text&quot;: &quot;Text to analyze&quot;&#125; ç»“æœä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„è¯æ¡ï¼š 12345678910111213141516171819202122232425&#123; &quot;tokens&quot;: [ &#123; &quot;token&quot;: &quot;text&quot;, &quot;start_offset&quot;: 0, &quot;end_offset&quot;: 4, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 1 &#125;, &#123; &quot;token&quot;: &quot;to&quot;, &quot;start_offset&quot;: 5, &quot;end_offset&quot;: 7, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 2 &#125;, &#123; &quot;token&quot;: &quot;analyze&quot;, &quot;start_offset&quot;: 8, &quot;end_offset&quot;: 15, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 3 &#125; ]&#125; token æ˜¯å®é™…å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ã€‚ position æŒ‡æ˜è¯æ¡åœ¨åŸå§‹æ–‡æœ¬ä¸­å‡ºç°çš„ä½ç½®ã€‚ start_offset å’Œ end_offset æŒ‡æ˜å­—ç¬¦åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚ æ¯ä¸ªåˆ†æå™¨çš„ type å€¼éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚å®ƒä»¬åœ¨Elasticsearchä¸­çš„å”¯ä¸€ä½œç”¨åœ¨äºâ€‹keep_types token è¿‡æ»¤å™¨â€‹ã€‚ analyze API æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒæœ‰åŠ©äºæˆ‘ä»¬ç†è§£Elasticsearchç´¢å¼•å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œéšç€æ·±å…¥ï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥è®¨è®ºå®ƒã€‚ æŒ‡å®šåˆ†æå™¨å½“Elasticsearchåœ¨ä½ çš„æ–‡æ¡£ä¸­æ£€æµ‹åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²åŸŸï¼Œå®ƒä¼šè‡ªåŠ¨è®¾ç½®å…¶ä¸ºä¸€ä¸ªå…¨æ–‡ å­—ç¬¦ä¸² åŸŸï¼Œä½¿ç”¨ æ ‡å‡† åˆ†æå™¨å¯¹å®ƒè¿›è¡Œåˆ†æã€‚ ä½ ä¸å¸Œæœ›æ€»æ˜¯è¿™æ ·ã€‚å¯èƒ½ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åˆ†æå™¨ï¼Œé€‚ç”¨äºä½ çš„æ•°æ®ä½¿ç”¨çš„è¯­è¨€ã€‚æœ‰æ—¶å€™ä½ æƒ³è¦ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸâ€”â€‹ä¸ä½¿ç”¨åˆ†æï¼Œç›´æ¥ç´¢å¼•ä½ ä¼ å…¥çš„ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ç”¨æˆ·IDæˆ–è€…ä¸€ä¸ªå†…éƒ¨çš„çŠ¶æ€åŸŸæˆ–æ ‡ç­¾ã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨æŒ‡å®šè¿™äº›åŸŸçš„æ˜ å°„ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"å€’æ’ç´¢å¼•","date":"2021-07-05T14:17:00.000Z","path":"wiki/å€’æ’ç´¢å¼•/","text":"Elasticsearch ä½¿ç”¨ä¸€ç§ç§°ä¸º å€’æ’ç´¢å¼• çš„ç»“æ„ï¼Œå®ƒé€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚ä¸€ä¸ªå€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤è¯çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºå…¶ä¸­æ¯ä¸ªè¯ï¼Œæœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£çš„ content åŸŸåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š The quick brown fox jumped over the lazy dogQuick brown foxes leap over lazy dogs in summerä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ¯ä¸ªæ–‡æ¡£çš„ content åŸŸæ‹†åˆ†æˆå•ç‹¬çš„ è¯ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸º è¯æ¡ æˆ– tokens ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡å¤è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ quick brown ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…åº¦æ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»…è®¡ç®—åŒ¹é…è¯æ¡æ•°é‡çš„ç®€å• ç›¸ä¼¼æ€§ç®—æ³• ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¯¹äºæˆ‘ä»¬æŸ¥è¯¢çš„ç›¸å…³æ€§æ¥è®²ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªæ–‡æ¡£æ›´ä½³ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›®å‰çš„å€’æ’ç´¢å¼•æœ‰ä¸€äº›é—®é¢˜ï¼š Quick å’Œ quick ä»¥ç‹¬ç«‹çš„è¯æ¡å‡ºç°ï¼Œç„¶è€Œç”¨æˆ·å¯èƒ½è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„è¯ã€‚fox å’Œ foxes éå¸¸ç›¸ä¼¼, å°±åƒ dog å’Œ dogs ï¼›ä»–ä»¬æœ‰ç›¸åŒçš„è¯æ ¹ã€‚jumped å’Œ leap, å°½ç®¡æ²¡æœ‰ç›¸åŒçš„è¯æ ¹ï¼Œä½†ä»–ä»¬çš„æ„æ€å¾ˆç›¸è¿‘ã€‚ä»–ä»¬æ˜¯åŒä¹‰è¯ã€‚ä½¿ç”¨å‰é¢çš„ç´¢å¼•æœç´¢ +Quick +fox ä¸ä¼šå¾—åˆ°ä»»ä½•åŒ¹é…æ–‡æ¡£ã€‚ï¼ˆè®°ä½ï¼Œ+ å‰ç¼€è¡¨æ˜è¿™ä¸ªè¯å¿…é¡»å­˜åœ¨ã€‚ï¼‰åªæœ‰åŒæ—¶å‡ºç° Quick å’Œ fox çš„æ–‡æ¡£æ‰æ»¡è¶³è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£åŒ…å« quick fox ï¼Œç¬¬äºŒä¸ªæ–‡æ¡£åŒ…å« Quick foxes ã€‚ æˆ‘ä»¬çš„ç”¨æˆ·å¯ä»¥åˆç†çš„æœŸæœ›ä¸¤ä¸ªæ–‡æ¡£ä¸æŸ¥è¯¢åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥åšçš„æ›´å¥½ã€‚ å¦‚æœæˆ‘ä»¬å°†è¯æ¡è§„èŒƒä¸ºæ ‡å‡†æ¨¡å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸ç”¨æˆ·æœç´¢çš„è¯æ¡ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†å…·æœ‰è¶³å¤Ÿç›¸å…³æ€§çš„æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼š Quick å¯ä»¥å°å†™åŒ–ä¸º quick ã€‚foxes å¯ä»¥ è¯å¹²æå– â€“å˜ä¸ºè¯æ ¹çš„æ ¼å¼â€“ ä¸º fox ã€‚ç±»ä¼¼çš„ï¼Œ dogs å¯ä»¥ä¸ºæå–ä¸º dog ã€‚jumped å’Œ leap æ˜¯åŒä¹‰è¯ï¼Œå¯ä»¥ç´¢å¼•ä¸ºç›¸åŒçš„å•è¯ jump ã€‚ç°åœ¨ç´¢å¼•çœ‹ä¸Šå»åƒè¿™æ ·ï¼šè¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬æœç´¢ +Quick +fox ä»ç„¶ ä¼šå¤±è´¥ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ç´¢å¼•ä¸­ï¼Œå·²ç»æ²¡æœ‰ Quick äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æœç´¢çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸ content åŸŸç›¸åŒçš„æ ‡å‡†åŒ–è§„åˆ™ï¼Œä¼šå˜æˆæŸ¥è¯¢ +quick +fox ï¼Œè¿™æ ·ä¸¤ä¸ªæ–‡æ¡£éƒ½ä¼šåŒ¹é…ï¼ è¿™éå¸¸é‡è¦ã€‚ä½ åªèƒ½æœç´¢åœ¨ç´¢å¼•ä¸­å‡ºç°çš„è¯æ¡ï¼Œæ‰€ä»¥ç´¢å¼•æ–‡æœ¬å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²å¿…é¡»æ ‡å‡†åŒ–ä¸ºç›¸åŒçš„æ ¼å¼ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"elasticsearchåˆ†é¡µæŸ¥è¯¢","date":"2021-07-05T14:08:23.000Z","path":"wiki/elasticsearchåˆ†é¡µæŸ¥è¯¢/","text":"å’Œ SQL ä½¿ç”¨ LIMIT å…³é”®å­—è¿”å›å•ä¸ª page ç»“æœçš„æ–¹æ³•ç›¸åŒï¼ŒElasticsearch æ¥å— from å’Œ size å‚æ•°ï¼š sizeæ˜¾ç¤ºåº”è¯¥è¿”å›çš„ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 10fromæ˜¾ç¤ºåº”è¯¥è·³è¿‡çš„åˆå§‹ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 0å¦‚æœæ¯é¡µå±•ç¤º 5 æ¡ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢æ–¹å¼è¯·æ±‚å¾—åˆ° 1 åˆ° 3 é¡µçš„ç»“æœï¼š GET /_search?size=5GET /_search?size=5&amp;from=5GET /_search?size=5&amp;from=10 âš ï¸ âš ï¸ âš ï¸è€ƒè™‘åˆ°åˆ†é¡µè¿‡æ·±ä»¥åŠä¸€æ¬¡è¯·æ±‚å¤ªå¤šç»“æœçš„æƒ…å†µï¼Œç»“æœé›†åœ¨è¿”å›ä¹‹å‰å…ˆè¿›è¡Œæ’åºã€‚ ä½†è¯·è®°ä½ä¸€ä¸ªè¯·æ±‚ç»å¸¸è·¨è¶Šå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½äº§ç”Ÿè‡ªå·±çš„æ’åºç»“æœï¼Œè¿™äº›ç»“æœéœ€è¦è¿›è¡Œé›†ä¸­æ’åºä»¥ä¿è¯æ•´ä½“é¡ºåºæ˜¯æ­£ç¡®çš„ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ·±åº¦åˆ†é¡µ ç†è§£ä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µæ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨ä¸€ä¸ªæœ‰ 5 ä¸ªä¸»åˆ†ç‰‡çš„ç´¢å¼•ä¸­æœç´¢ã€‚ å½“æˆ‘ä»¬è¯·æ±‚ç»“æœçš„ç¬¬ä¸€é¡µï¼ˆç»“æœä» 1 åˆ° 10 ï¼‰ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡äº§ç”Ÿå‰ 10 çš„ç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™ åè°ƒèŠ‚ç‚¹ ï¼Œåè°ƒèŠ‚ç‚¹å¯¹ 50 ä¸ªç»“æœæ’åºå¾—åˆ°å…¨éƒ¨ç»“æœçš„å‰ 10 ä¸ªã€‚ ç°åœ¨å‡è®¾æˆ‘ä»¬è¯·æ±‚ç¬¬ 1000 é¡µâ€”â€‹ç»“æœä» 10001 åˆ° 10010 ã€‚æ‰€æœ‰éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œé™¤äº†æ¯ä¸ªåˆ†ç‰‡ä¸å¾—ä¸äº§ç”Ÿå‰10010ä¸ªç»“æœä»¥å¤–ã€‚ ç„¶ååè°ƒèŠ‚ç‚¹å¯¹å…¨éƒ¨ 50050 ä¸ªç»“æœæ’åºæœ€åä¸¢å¼ƒæ‰è¿™äº›ç»“æœä¸­çš„ 50040 ä¸ªç»“æœã€‚ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯¹ç»“æœæ’åºçš„æˆæœ¬éšåˆ†é¡µçš„æ·±åº¦æˆæŒ‡æ•°ä¸Šå‡ã€‚è¿™å°±æ˜¯ web æœç´¢å¼•æ“å¯¹ä»»ä½•æŸ¥è¯¢éƒ½ä¸è¦è¿”å›è¶…è¿‡ 1000 ä¸ªç»“æœçš„åŸå›  å‚è€ƒèµ„æ–™ elasticsearchæƒå¨æŒ‡å— å¹²è´§ | å…¨æ–¹ä½æ·±åº¦è§£è¯» Elasticsearch åˆ†é¡µæŸ¥è¯¢ Paginate search results","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"å¤šç´¢å¼•å¤šç±»å‹æœç´¢","date":"2021-07-05T14:02:34.000Z","path":"wiki/å¤šç´¢å¼•å¤šç±»å‹æœç´¢/","text":"å¦‚æœä¸å¯¹æŸä¸€ç‰¹æ®Šçš„ç´¢å¼•æˆ–è€…ç±»å‹åšé™åˆ¶ï¼Œå°±ä¼šæœç´¢é›†ç¾¤ä¸­çš„æ‰€æœ‰æ–‡æ¡£ã€‚Elasticsearch è½¬å‘æœç´¢è¯·æ±‚åˆ°æ¯ä¸€ä¸ªä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼Œæ±‡é›†æŸ¥è¯¢å‡ºçš„å‰10ä¸ªç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™æˆ‘ä»¬ã€‚ ç„¶è€Œï¼Œç»å¸¸çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æ®Šçš„ç´¢å¼•å¹¶ä¸”åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰¹æ®Šçš„ç±»å‹ä¸­è¿›è¡Œæœç´¢ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨URLä¸­æŒ‡å®šç‰¹æ®Šçš„ç´¢å¼•å’Œç±»å‹è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š /_searchåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb/_searchåœ¨ gb ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb,us/_searchåœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„æ–‡æ¡£/g*,u*/_searchåœ¨ä»»ä½•ä»¥ g æˆ–è€… u å¼€å¤´çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb/user/_searchåœ¨ gb ç´¢å¼•ä¸­æœç´¢ user ç±»å‹/gb,us/user,tweet/_searchåœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹/_all/user,tweet/_searchåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹å½“åœ¨å•ä¸€çš„ç´¢å¼•ä¸‹è¿›è¡Œæœç´¢çš„æ—¶å€™ï¼ŒElasticsearch è½¬å‘è¯·æ±‚åˆ°ç´¢å¼•çš„æ¯ä¸ªåˆ†ç‰‡ä¸­ï¼Œå¯ä»¥æ˜¯ä¸»åˆ†ç‰‡ä¹Ÿå¯ä»¥æ˜¯å‰¯æœ¬åˆ†ç‰‡ï¼Œç„¶åä»æ¯ä¸ªåˆ†ç‰‡ä¸­æ”¶é›†ç»“æœã€‚å¤šç´¢å¼•æœç´¢æ°å¥½ä¹Ÿæ˜¯ç”¨ç›¸åŒçš„æ–¹å¼å·¥ä½œçš„â€”â€‹åªæ˜¯ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„åˆ†ç‰‡ã€‚ æ³¨æ„ âš ï¸æœç´¢ä¸€ä¸ªç´¢å¼•æœ‰äº”ä¸ªä¸»åˆ†ç‰‡å’Œæœç´¢äº”ä¸ªç´¢å¼•å„æœ‰ä¸€ä¸ªåˆ†ç‰‡å‡†ç¡®æ¥æ‰€è¯´æ˜¯ç­‰ä»·çš„ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"elasticsearché‡è¦é…ç½®","date":"2021-07-05T13:22:32.000Z","path":"wiki/elasticsearché‡è¦é…ç½®/","text":"è™½ç„¶Elasticsearchä»…éœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œä½†æœ‰è®¸å¤šè®¾ç½®éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¹¶ä¸”åœ¨è¿›å…¥ç”Ÿäº§ä¹‹å‰ç»å¯¹å¿…é¡»è¿›è¡Œé…ç½®ã€‚ path.data å’Œ path.logscluster.namenode.namebootstrap.memory_locknetwork.hostdiscovery.zen.ping.unicast.hostsdiscovery.zen.minimum_master_nodespath.data å’Œ path.logså¦‚æœä½¿ç”¨.zipæˆ–.tar.gzå½’æ¡£ï¼Œåˆ™æ•°æ®å’Œæ—¥å¿—ç›®å½•æ˜¯$ES_HOMEçš„å­æ–‡ä»¶å¤¹ã€‚ å¦‚æœè¿™äº›é‡è¦çš„æ–‡ä»¶å¤¹ä¿ç•™åœ¨å…¶é»˜è®¤ä½ç½®ï¼Œåˆ™å­˜åœ¨å°†Elasticsearchå‡çº§åˆ°æ–°ç‰ˆæœ¬æ—¶è¢«åˆ é™¤çš„é«˜é£é™©ã€‚ åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œè‚¯å®šå¾—æ›´æ”¹æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š 123path: logs: /var/log/elasticsearch data: /var/data/elasticsearch RPMå’ŒDebianå‘è¡Œç‰ˆå·²ç»ä½¿ç”¨æ•°æ®å’Œæ—¥å¿—çš„è‡ªå®šä¹‰è·¯å¾„ã€‚ path.data è®¾ç½®å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªè·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è·¯å¾„å°†ç”¨äºå­˜å‚¨æ•°æ®ï¼ˆå±äºå•ä¸ªåˆ†ç‰‡çš„æ–‡ä»¶å°†å…¨éƒ¨å­˜å‚¨åœ¨åŒä¸€æ•°æ®è·¯å¾„ä¸Šï¼‰ï¼š 12345path: data: - /mnt/elasticsearch_1 - /mnt/elasticsearch_2 - /mnt/elasticsearch_3 cluster.nameèŠ‚ç‚¹åªèƒ½åœ¨ç¾¤é›†ä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å…±äº«å…¶cluster.nameæ—¶æ‰èƒ½åŠ å…¥ç¾¤é›†ã€‚ é»˜è®¤åç§°ä¸ºelasticsearchï¼Œä½†æ‚¨åº”å°†å…¶æ›´æ”¹ä¸ºæè¿°é›†ç¾¤ç”¨é€”çš„é€‚å½“åç§°ã€‚cluster.name: logging-prodç¡®ä¿ä¸è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„é›†ç¾¤åç§°ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´åŠ å…¥é”™è¯¯é›†ç¾¤çš„èŠ‚ç‚¹ã€‚ node.nameé»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå°†ä½¿ç”¨éšæœºç”Ÿæˆçš„uuidçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèŠ‚ç‚¹idã€‚ è¯·æ³¨æ„ï¼ŒèŠ‚ç‚¹IDæ˜¯æŒä¹…åŒ–çš„ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹é‡æ–°å¯åŠ¨æ—¶ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤é»˜è®¤èŠ‚ç‚¹åç§°ä¹Ÿä¸ä¼šæ›´æ”¹ã€‚é…ç½®ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„åç§°æ˜¯å€¼å¾—çš„ï¼Œè¿™æ˜¯é‡å¯èŠ‚ç‚¹åä¹Ÿèƒ½ä¸€ç›´ä¿æŒçš„ä¼˜åŠ¿ï¼šnode.name: prod-data-2node.nameä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæœåŠ¡å™¨çš„HOSTNAMEï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12node.name: $&#123;HOSTNAME&#125;bootstrap.memory_lock æ²¡æœ‰JVMè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šè¿™äº‹å¯¹äºèŠ‚ç‚¹çš„å¥åº·æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸€ç§å®ç°æ–¹æ³•æ˜¯å°†bootstrap.memory_lockè®¾ç½®ä¸ºtrueã€‚è¦ä½¿æ­¤è®¾ç½®ç”Ÿæ•ˆï¼Œéœ€è¦é¦–å…ˆé…ç½®å…¶ä»–ç³»ç»Ÿè®¾ç½®ã€‚ æœ‰å…³å¦‚ä½•æ­£ç¡®è®¾ç½®å†…å­˜é”å®šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯ç”¨bootstrap.memory_lockã€‚ network.hosté»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä»…ä»…ç»‘å®šåœ¨æœ¬åœ°å›è·¯åœ°å€â€”â€”å¦‚ï¼š127.0.0.1ä¸[::1]ã€‚è¿™åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè·‘ä¸€ä¸ªå¼€å‘èŠ‚ç‚¹æ˜¯è¶³å¤Ÿçš„ã€‚æç¤º äº‹å®ä¸Šï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šç›¸åŒçš„$ES_HOMEä½ç½®ä¸€åŒè¿è¡Œã€‚è¿™å¯ä»¥ç”¨äºæµ‹è¯•Elasticsearchå½¢æˆé›†ç¾¤çš„èƒ½åŠ›,ä½†è¿™ç§é…ç½®æ–¹å¼ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ ä¸ºäº†å°†å…¶å®ƒæœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¯ä»¥ç›¸äº’é€šè®¯çš„é›†ç¾¤ï¼Œä½ çš„èŠ‚ç‚¹å°†ä¸èƒ½ç»‘å®šåœ¨ä¸€ä¸ªå›è·¯åœ°å€ä¸Šã€‚ è¿™é‡Œæœ‰æ›´å¤šçš„ç½‘è·¯é…ç½®ï¼Œé€šå¸¸ä½ åªéœ€è¦é…ç½®network.hostï¼šnetwork.host: 192.168.1.10network.hostä¹Ÿå¯ä»¥é…ç½®æˆä¸€äº›èƒ½è¯†åˆ«çš„ç‰¹æ®Šçš„å€¼ï¼Œè­¬å¦‚ï¼š_local_ã€_siteã€_global_ï¼Œå®ƒä»¬å¯ä»¥ç»“åˆæŒ‡å®š:ip4ä¸ip6æ¥ä½¿ç”¨ã€‚æ›´å¤šç›¸ä¿¡ä¿¡æ¯è¯·å‚è§ï¼šç½‘è·¯é…ç½® é‡è¦ ğŸ‘‡ ä¸€æ—¦ä½ è‡ªå®šä¹‰äº†network.hostçš„é…ç½®ï¼ŒElasticsearchå°†å‡è®¾ä½ å·²ç»ä»å¼€å‘æ¨¡å¼è½¬åˆ°äº†ç”Ÿäº§æ¨¡å¼ï¼Œå¹¶å°†å‡çº§ç³»ç»Ÿæ£€æµ‹çš„è­¦å‘Šä¿¡æ¯ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼šå¼€å‘æ¨¡å¼vsç”Ÿäº§æ¨¡å¼ discovery.zen.ping.unicast.hostsï¼ˆå•æ’­å‘ç°ï¼‰å¼€ç®±å³ç”¨ï¼Œæ— éœ€ä»»ä½•ç½‘ç»œé…ç½®ï¼ŒElasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„å›è·¯åœ°å€ï¼Œå¹¶æ‰«æ9300å¹´åˆ°9305çš„ç«¯å£å»è¿æ¥åŒä¸€æœºå™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹,è¯•å›¾è¿æ¥åˆ°ç›¸åŒçš„æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å…¶ä»–èŠ‚ç‚¹ã€‚å®ƒæä¾›äº†ä¸éœ€è¦ä»»ä½•é…ç½®å°±èƒ½è‡ªåŠ¨ç»„å»ºé›†ç¾¤çš„ä½“éªŒã€‚å½“ä¸å…¶å®ƒæœºå™¨ä¸Šçš„èŠ‚ç‚¹è¦å½¢æˆä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªåœ¨çº¿ä¸”å¯è®¿é—®çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚åƒå¦‚ä¸‹æ¥é…ç½®ï¼š 1234discovery.zen.ping.unicast.hosts: - 192.168.1.10:9300 - 192.168.1.11 #â‘  - seeds.mydomain.com #â‘¡ â‘  æœªæŒ‡å®šç«¯å£æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„transport.profiles.default.portå€¼ï¼Œå¦‚æœæ­¤å€¼ä¹Ÿä¸ºè®¾ç½®åˆ™ä½¿ç”¨transport.tcp.port â‘¡ ä¸»æœºåå°†è¢«å°è¯•è§£ææˆèƒ½è§£æçš„å¤šä¸ªIP discovery.zen.minimum_master_nodesä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé…ç½®discovery-zen-minimum_master_nodeså°†éå¸¸é‡è¦ï¼Œä»–è§„å®šäº†å¿…é¡»è‡³å°‘è¦æœ‰å¤šå°‘ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚æ²¡æœ‰æ­¤è®¾ç½®æ—¶ï¼Œä¸€ä¸ªé›†ç¾¤åœ¨å‘ç”Ÿç½‘ç»œé—®é¢˜æ˜¯å¯èƒ½ä¼šåˆ†è£‚æˆå¤šä¸ªé›†ç¾¤â€”â€”è„‘è£‚â€”â€”è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§ï¼šé€šè¿‡minimum_master_nodesé¿å…è„‘è£‚ä¸ºé¿å…è„‘è£‚ï¼Œä½ éœ€è¦æ ¹æ®masterèŠ‚ç‚¹æ•°æ¥è®¾ç½®æ³•å®šäººæ•°ï¼š(master_eligible_nodes / 2) + 1æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæœ€å°çš„ä¸»èŠ‚ç‚¹æ•°å› è¢«è®¾ç½®ä¸º(3/2)+1æˆ–è€…æ˜¯2discovery.zen.minimum_master_nodes: 2 å‚è€ƒèµ„æ–™ elastic å®˜æ–¹æ–‡æ¡£ codingdict.com","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"elasticsearchæ“ä½œç´¢å¼•","date":"2021-07-05T13:11:01.000Z","path":"wiki/elasticsearchæ“ä½œç´¢å¼•/","text":"åˆ›å»ºç´¢å¼•12345678910111213141516171819202122232425262728293031PUT customer&#123; &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;email&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;order_serial&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_time&quot;: &#123; &quot;type&quot;: &quot;date&quot; &#125;, &quot;customer_order&quot;:&#123; &quot;type&quot;:&quot;join&quot;, &quot;relations&quot;:&#123; &quot;customer&quot;:&quot;order&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹ç´¢å¼•çš„mappingGET yj_visit_data/_mapping 1234567891011121314151617181920212223242526&#123; &quot;yj_visit_data&quot; : &#123; &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;_class&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125;, &quot;article&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125; &#125; &#125; &#125;&#125; æŸ¥è¯¢æ‰€æœ‰GET yj_visit_data/_search 12345&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;&#125; åˆ é™¤æ‰€æœ‰POST yj_visit_data/_delete_by_query 123456&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123; &#125; &#125;&#125; é€šè¿‡æ–‡ç« åˆ é™¤POST yj_visit_data/_delete_by_query 1234567&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;article.keyword&quot;: &quot;2019/01/3&quot; &#125; &#125;&#125; æ ¹æ®æ–‡ç« æŸ¥è¯¢GET yj_visit_data/_search 12345678&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;article.keyword&quot;: &quot;2019/01/3&quot; &#125; &#125;&#125; ä¿®æ”¹ç´¢å¼•1234POST customer/_doc/1&#123; &quot;name&quot;:&quot;2&quot;&#125;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"elasticsearchåŸºç¡€api","date":"2021-07-05T12:53:09.000Z","path":"wiki/elasticsearchåŸºç¡€cat_api/","text":"cat APIé›†ç¾¤å¥åº·çŠ¶æ€GET _cat/health?v&amp;pretty 12epoch timestamp cluster status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent1625489855 12:57:35 my-application yellow 1 1 35 35 0 0 23 0 - 60.3% æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨restæ¥å£ï¼šcurl -XGET â€˜localhost:9200/_cat/health?v&amp;prettyâ€™ 12epoch timestamp cluster status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent1475247709 17:01:49 elasticsearch green 1 1 0 0 0 0 0 0 - 100.0% æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åä¸º my-application çš„é›†ç¾¤ä¸ yellow çš„ statusã€‚ æ— è®ºä½•æ—¶æˆ‘ä»¬è¯·æ±‚é›†ç¾¤å¥åº·ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— greenï¼Œyellowï¼Œæˆ–è€… red çš„ statusã€‚Green è¡¨ç¤ºä¸€åˆ‡æ­£å¸¸ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œ yellow è¡¨ç¤ºæ‰€æœ‰æ•°æ®å¯ç”¨ï¼Œä½†æ˜¯æœ‰äº›å‰¯æœ¬å°šæœªåˆ†é…ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œred æ„å‘³ç€ç”±äºæŸäº›åŸå› æœ‰äº›æ•°æ®ä¸å¯ç”¨ã€‚æ³¨æ„ï¼Œé›†ç¾¤æ˜¯ redï¼Œå®ƒä»ç„¶å…·æœ‰éƒ¨åˆ†åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå®ƒå°†ç»§ç»­ä»å¯ç”¨çš„åˆ†ç‰‡ä¸­æœåŠ¡æœç´¢è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯æ‚¨å¯èƒ½éœ€è¦å°½å¿«å»ä¿®å¤å®ƒï¼Œå› ä¸ºæ‚¨å·²ç»ä¸¢å¤±æ•°æ®äº†ã€‚ å¦å¤–ï¼Œä»ä¸Šé¢çš„å“åº”ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…±è®¡ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰å’Œ 0 ä¸ª shardï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ”¾å…¥æ•°æ®çš„ã€‚æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é›†ç¾¤åç§°ï¼ˆelasticsearchï¼‰ï¼Œå¹¶ä¸” Elasticsearch é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ unicast networkï¼ˆå•æ’­ç½‘ç»œï¼‰æ¥å‘ç°åŒä¸€æœºå™¨ä¸Šçš„å…¶å®ƒèŠ‚ç‚¹ã€‚æœ‰å¯èƒ½æ‚¨ä¸å°å¿ƒåœ¨æ‚¨çš„ç”µè„‘ä¸Šå¯åŠ¨äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œç„¶åå®ƒä»¬å…¨éƒ¨åŠ å…¥åˆ°äº†å•ä¸ªé›†ç¾¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨ä¸Šé¢çš„å“åº”ä¸­çœ‹åˆ°ä¸æ­¢ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰ã€‚ æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒGET _cat/nodes?v&amp;pretty 12ip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name172.19.0.1 20 61 15 0.02 0.04 0.29 cdhilmrstw * redtom-es-1 æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•GET _cat/indices?v&amp;pretty 1234health status index uuid pri rep docs.count docs.deleted store.size pri.store.sizeyellow open rd-logstash-2021.06.19 p5iej71MQVW12s2awNv8nw 1 1 61236 0 16.3mb 16.3mbyellow open demo_index k6VTs7tdS0ysot-rPwxG9A 1 1 1 0 5.5kb 5.5kbgreen open kibana_sample_data_flights A7c5DViGSISii8FA0dNlGw 1 0 13059 0 5.6mb 5.6mb æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡GET _cat/count?v&amp;pretty 12epoch timestamp count1625490245 13:04:05 838913 ç£ç›˜åˆ†é…æƒ…å†µGET _cat/allocation?v&amp;pretty 123shards disk.indices disk.used disk.avail disk.total disk.percent host ip node 35 308.7mb 20.1gb 215.9gb 236.1gb 8 172.19.0.1 172.19.0.1 redtom-es-1 23 UNASSIGNED æŸ¥çœ‹shardæƒ…å†µGET _cat/shards?v&amp;pretty 12345678index shard prirep state docs store ip nodeyj_visit_data 0 p STARTED 0 208b 172.19.0.1 redtom-es-1yj_visit_data 0 r UNASSIGNED demo_index 0 p STARTED 1 5.5kb 172.19.0.1 redtom-es-1demo_index 0 r UNASSIGNED rbtags 0 p STARTED 0 208b 172.19.0.1 redtom-es-1.kibana_1 0 p STARTED 280 11.5mb 172.19.0.1 redtom-es-1.kibana_task_manager_1 0 p STARTED 5 5.8mb 172.19.0.1 redtom-es-1 yj_visit_data è®¾ç½®äº†ä¸€ä¸ªå‰¯æœ¬åˆ†åŒºï¼Œä½†æ˜¯æ²¡æœ‰å‰¯èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤ºæœªåˆ†é…ï¼› å‚è€ƒèµ„æ–™ Elastic å®˜æ–¹æ–‡æ¡£ codingdict.com","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"}]},{"title":"canalåŒæ­¥mysqlæ•°æ®åˆ°elasticsearch","date":"2021-07-05T03:26:50.000Z","path":"wiki/canalåŒæ­¥mysqlæ•°æ®åˆ°elasticsearch/","text":"é¦–å…ˆå®‰è£…elkæ¨èå¤§å®¶åˆ°elasicä¸­æ–‡ç¤¾åŒºå»ä¸‹è½½ ğŸ‘‰ ã€ä¼ é€ã€‘âš ï¸ elastcisearch | logstash | kibana çš„ç‰ˆæœ¬æœ€å¥½ä¿æŒä¸€ç›´ï¼Œå¦åˆ™ä¼šå‡ºç°å¾ˆå¤šå‘çš„ï¼Œåˆ‡è®°ï¼ å®‰è£…ELKçš„æ­¥éª¤è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œå¯ä»¥æŸ¥çœ‹ ğŸ‘‰ ã€TODOã€‘ ä¸‹è½½å®‰è£…canal-adaptercanal githubä¼ é€é—¨ ğŸ‘‰ ã€Alibaba Canalã€‘ canal-client æ¨¡å¼å¯ä»¥å‚ç…§canalç»™å‡ºçš„exampleé¡¹ç›®å’Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¾‹å­æ¥æµ‹è¯• ä¾èµ–é…ç½®12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba.otter&lt;/groupId&gt; &lt;artifactId&gt;canal.client&lt;/artifactId&gt; &lt;version&gt;1.1.0&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºmavené¡¹ç›®ä¿è¯canal-server å·²ç»æ­£ç¡®å¯åŠ¨ ğŸ‘ˆ ç„¶åå¯åŠ¨ä¸‹é¢æœåŠ¡ï¼Œæ“ä½œæ•°æ®åº“å³å¯çœ‹åˆ°æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡ºï¼› 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121package com.redtom.canal.deploy;import com.alibaba.otter.canal.client.CanalConnector;import com.alibaba.otter.canal.client.CanalConnectors;import com.alibaba.otter.canal.protocol.CanalEntry;import com.alibaba.otter.canal.protocol.Message;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.InitializingBean;import org.springframework.stereotype.Component;import java.net.InetSocketAddress;import java.util.List;/** * @Author gaolei * @Date 2021/6/30 2:57 ä¸‹åˆ * @Version 1.0 */@Slf4j@Componentclass CanalClient implements InitializingBean &#123; private final static int BATCH_SIZE = 1000; @Override public void afterPropertiesSet() throws Exception &#123; // åˆ›å»ºé“¾æ¥ CanalConnector connector = CanalConnectors.newSingleConnector(new InetSocketAddress(&quot;***.***.***.***&quot;, 11111), &quot;example&quot;, &quot;canal&quot;, &quot;canal&quot;); try &#123; //æ‰“å¼€è¿æ¥ connector.connect(); //è®¢é˜…æ•°æ®åº“è¡¨,å…¨éƒ¨è¡¨ connector.subscribe(&quot;.*\\\\..*&quot;); //å›æ»šåˆ°æœªè¿›è¡Œackçš„åœ°æ–¹ï¼Œä¸‹æ¬¡fetchçš„æ—¶å€™ï¼Œå¯ä»¥ä»æœ€åä¸€ä¸ªæ²¡æœ‰ackçš„åœ°æ–¹å¼€å§‹æ‹¿ connector.rollback(); while (true) &#123; // è·å–æŒ‡å®šæ•°é‡çš„æ•°æ® Message message = connector.getWithoutAck(BATCH_SIZE); //è·å–æ‰¹é‡ID long batchId = message.getId(); //è·å–æ‰¹é‡çš„æ•°é‡ int size = message.getEntries().size(); //å¦‚æœæ²¡æœ‰æ•°æ® if (batchId == -1 || size == 0) &#123; try &#123; //çº¿ç¨‹ä¼‘çœ 2ç§’ Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; else &#123; //å¦‚æœæœ‰æ•°æ®,å¤„ç†æ•°æ® printEntry(message.getEntries()); &#125; //è¿›è¡Œ batch id çš„ç¡®è®¤ã€‚ç¡®è®¤ä¹‹åï¼Œå°äºç­‰äºæ­¤ batchId çš„ Message éƒ½ä¼šè¢«ç¡®è®¤ã€‚ connector.ack(batchId); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; connector.disconnect(); &#125; &#125; /** * æ‰“å°canal serverè§£æbinlogè·å¾—çš„å®ä½“ç±»ä¿¡æ¯ */ private static void printEntry(List&lt;CanalEntry.Entry&gt; entrys) &#123; for (CanalEntry.Entry entry : entrys) &#123; if (entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONBEGIN || entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONEND) &#123; //å¼€å¯/å…³é—­äº‹åŠ¡çš„å®ä½“ç±»å‹ï¼Œè·³è¿‡ continue; &#125; //RowChangeå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€è¡Œæ•°æ®å˜åŒ–çš„æ‰€æœ‰ç‰¹å¾ //æ¯”å¦‚isDdl æ˜¯å¦æ˜¯ddlå˜æ›´æ“ä½œ sql å…·ä½“çš„ddl sql beforeColumns afterColumns å˜æ›´å‰åçš„æ•°æ®å­—æ®µç­‰ç­‰ CanalEntry.RowChange rowChage; try &#123; rowChage = CanalEntry.RowChange.parseFrom(entry.getStoreValue()); &#125; catch (Exception e) &#123; throw new RuntimeException(&quot;ERROR ## parser of eromanga-event has an error , data:&quot; + entry.toString(), e); &#125; //è·å–æ“ä½œç±»å‹ï¼šinsert/update/deleteç±»å‹ CanalEntry.EventType eventType = rowChage.getEventType(); //æ‰“å°Headerä¿¡æ¯ log.info(&quot;headers:&#123;&#125; &quot;, String.format(&quot;================ã€‹; binlog[%s:%s] , name[%s,%s] , eventType : %s&quot;, entry.getHeader().getLogfileName(), entry.getHeader().getLogfileOffset(), entry.getHeader().getSchemaName(), entry.getHeader().getTableName(), eventType)); //åˆ¤æ–­æ˜¯å¦æ˜¯DDLè¯­å¥ if (rowChage.getIsDdl()) &#123; log.info(&quot;================ã€‹;isDdl: true,sql: &#123;&#125;&quot;, rowChage.getSql()); &#125; //è·å–RowChangeå¯¹è±¡é‡Œçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œæ‰“å°å‡ºæ¥ for (CanalEntry.RowData rowData : rowChage.getRowDatasList()) &#123; //å¦‚æœæ˜¯åˆ é™¤è¯­å¥ if (eventType == CanalEntry.EventType.DELETE) &#123; printColumn(rowData.getBeforeColumnsList()); //å¦‚æœæ˜¯æ–°å¢è¯­å¥ &#125; else if (eventType == CanalEntry.EventType.INSERT) &#123; printColumn(rowData.getAfterColumnsList()); //å¦‚æœæ˜¯æ›´æ–°çš„è¯­å¥ &#125; else &#123; //å˜æ›´å‰çš„æ•°æ® log.info(&quot;-------&gt;; before&quot;); printColumn(rowData.getBeforeColumnsList()); //å˜æ›´åçš„æ•°æ® log.info(&quot;-------&gt;; after&quot;); printColumn(rowData.getAfterColumnsList()); &#125; &#125; &#125; &#125; private static void printColumn(List&lt;CanalEntry.Column&gt; columns) &#123; for (CanalEntry.Column column : columns) &#123; log.info(&quot; &#123;&#125; : &#123;&#125; update= &#123;&#125;&quot;, column.getName(), column.getValue(), column.getUpdated()); &#125; &#125;&#125; canal-adapter æ¨¡å¼adapter é…ç½®æ–‡ä»¶å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546server: port: 8081spring: jackson: date-format: yyyy-MM-dd HH:mm:ss time-zone: GMT+8 default-property-inclusion: non_nullcanal.conf: mode: tcp #tcp kafka rocketMQ rabbitMQ flatMessage: true zookeeperHosts: syncBatchSize: 1 batchSize: 1 retries: 0 timeout: accessKey: secretKey: consumerProperties: # canal tcp consumer canal.tcp.server.host: 172.25.101.75:11111 canal.tcp.zookeeper.hosts: canal.tcp.batch.size: 500 canal.tcp.username: canal.tcp.password: srcDataSources: defaultDS: url: jdbc:mysql://xxxx:pppp/database?useUnicode=true username: root password: pwd canalAdapters: - instance: example # canal instance Name or mq topic name groups: - groupId: g1 outerAdapters: - name: logger - name: es7 hosts: 172.25.101.75:9300 # 127.0.0.1:9200 for rest mode properties: mode: transport # or rest# # security.auth: test:123456 # only used for rest mode cluster.name: my-application# - name: kudu# key: kudu# properties:# kudu.master.address: 127.0.0.1 # &#x27;,&#x27; split multi address æˆ‘çš„elasticsearchæ˜¯7.10.0ç‰ˆæœ¬çš„application.yml bootstrap.yml es6 es7 hbase kudu logback.xml META-INF rdbæ‰€ä»¥ï¼šğŸ‘‡ 123cd es7biz_order.yml customer.yml mytest_user.ymlvim customer.yml customer.yml é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112dataSourceKey: defaultDSdestination: examplegroupId: g1esMapping: _index: customer _id: id relations: customer_order: name: customer sql: &quot;select t.id, t.name, t.email from customer t&quot; etlCondition: &quot;where t.c_time&gt;=&#123;&#125;&quot; commitBatch: 3000 åˆ›å»ºè¡¨ç»“æ„12345678910CREATE TABLE `customer` ( `id` bigint(20) DEFAULT NULL, `name` varchar(255) DEFAULT NULL, `email` varchar(255) DEFAULT NULL, `order_id` int(11) DEFAULT NULL, `order_serial` varchar(255) DEFAULT NULL, `order_time` datetime DEFAULT NULL, `customer_order` varchar(255) DEFAULT NULL, `c_time` datetime DEFAULT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åˆ›å»ºç´¢å¼•12345678910111213141516171819202122232425262728293031PUT customer&#123; &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;email&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;order_serial&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_time&quot;: &#123; &quot;type&quot;: &quot;date&quot; &#125;, &quot;customer_order&quot;:&#123; &quot;type&quot;:&quot;join&quot;, &quot;relations&quot;:&#123; &quot;customer&quot;:&quot;order&quot; &#125; &#125; &#125; &#125;&#125; æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœåˆ›å»ºä¸€æ¡è®°å½•122021-07-05 11:50:53.725 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;1&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457053000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457053724,&quot;type&quot;:&quot;INSERT&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ 1234567891011121314151617181920212223242526272829303132&#123; &quot;took&quot; : 0, &quot;timed_out&quot; : false, &quot;_shards&quot; : &#123; &quot;total&quot; : 1, &quot;successful&quot; : 1, &quot;skipped&quot; : 0, &quot;failed&quot; : 0 &#125;, &quot;hits&quot; : &#123; &quot;total&quot; : &#123; &quot;value&quot; : 1, &quot;relation&quot; : &quot;eq&quot; &#125;, &quot;max_score&quot; : 1.0, &quot;hits&quot; : [ &#123; &quot;_index&quot; : &quot;customer&quot;, &quot;_type&quot; : &quot;_doc&quot;, &quot;_id&quot; : &quot;1&quot;, &quot;_score&quot; : 1.0, &quot;_source&quot; : &#123; &quot;name&quot; : &quot;1&quot;, &quot;email&quot; : &quot;1&quot;, &quot;customer_order&quot; : &#123; &quot;name&quot; : &quot;customer&quot; &#125; &#125; &#125; ] &#125;&#125; ä¿®æ”¹æ•°æ®122021-07-05 11:54:36.402 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457275000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:[&#123;&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;customer_order&quot;:&quot;1&quot;&#125;],&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457276401,&quot;type&quot;:&quot;UPDATE&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ åˆ é™¤ä¸€æ¡æ•°æ®122021-07-05 11:56:51.524 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457411000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457411523,&quot;type&quot;:&quot;DELETE&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ å‚è€ƒèµ„æ–™ ä½¿ç”¨canal client-adapterå®Œæˆmysqlåˆ°esæ•°æ®åŒæ­¥æ•™ç¨‹(åŒ…æ‹¬å…¨é‡å’Œå¢é‡) es åŒæ­¥é—®é¢˜ #1514 Github issue canal v1.1.4 æ–‡æ¡£æ‰‹å†Œ Sync es","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"}]},{"title":"mysqlé…ç½®binlog","date":"2021-07-05T03:06:36.000Z","path":"wiki/binlogé…ç½®/","text":"å¼€å¯binlog[mysqld]log-bin=mysql-bin #æ·»åŠ è¿™ä¸€è¡Œå°±okbinlog-format=ROW #é€‰æ‹©rowæ¨¡å¼server_id=1 #é…ç½®mysql replactionéœ€è¦å®šä¹‰ï¼Œä¸èƒ½å’Œcanalçš„slaveIdé‡å¤ æŸ¥çœ‹binlogçŠ¶æ€mysql&gt; show variables like â€˜binlog_formatâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| binlog_format | ROW |+---------------+-------+ show variables like â€˜log_binâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| log_bin | ON |+---------------+-------+","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"mysqlå¸¸ç”¨å‘½ä»¤","date":"2021-07-05T03:06:36.000Z","path":"wiki/mysqlå¸¸ç”¨å‘½ä»¤/","text":"binlogç›¸å…³å‘½ä»¤mysql&gt; show variables like â€˜binlog_formatâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| binlog_format | ROW |+---------------+-------+ show variables like â€˜log_binâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| log_bin | ON |+---------------+-------+ ç”¨æˆ·&amp;æƒé™åˆ›å»ºç”¨æˆ·å¹¶æˆæƒrootç”¨æˆ·ç™»å½•ï¼š mysql -u root -p ç„¶åè¾“å…¥å¯†ç åˆ›å»ºç”¨æˆ·ï¼š create user &#39;yjuser&#39;@&#39;%&#39; identified by &#39;u-bx.com&#39;;æˆæƒç”¨æˆ·åªè¯»æƒé™ï¼š grant SELECT on mirror.* to &#39;yjuser&#39;@&#39;%&#39; IDENTIFIED by &#39;u-bx.com&#39;;åˆ·æ–°æƒé™ï¼šflush privileges; æŸ¥çœ‹å½“å‰ç”¨æˆ·select User();","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"}]},{"title":"flinkç®€å•ä¸Šæ‰‹","date":"2021-07-04T14:23:43.000Z","path":"wiki/flinkç®€å•ä¸Šæ‰‹/","text":"mac å®‰è£… flink1ã€æ‰§è¡Œ brew install apache-flink å‘½ä»¤ 123456789gaolei:/ gaolei$ brew install apache-flinkUpdating Homebrew...==&gt; Auto-updated Homebrew! Updated 1 tap (homebrew/services).No changes to formulae.==&gt; Downloading https://archive.apache.org/dist/flink/flink-1.9.1/flink-1.9.1-bin-scala_2.11.tgz######################################################################## 100.0%ğŸº /usr/local/Cellar/apache-flink/1.9.1: 166 files, 277MB, built in 15 minutes 29 seconds 2ã€æ‰§è¡Œflinkå¯åŠ¨è„šæœ¬ 12/usr/local/Cellar/apache-flink/1.9.1/libexec/bin./start-cluster.sh WordCountæ‰¹å¤„ç†Demoåˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ– æ³¨æ„è‡ªå·±çš„flinkç‰ˆæœ¬ ğŸ‘‡ğŸ‘‡ 12345678910111213141516171819202122&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-java --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_2.12&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-java --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_2.12&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¼–å†™æ‰¹å¤„ç†ç¨‹åº123456789101112131415161718192021222324public static void main(String[] args) throws Exception &#123; // 1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // 2ã€è¯»å–æ–‡ä»¶æ•°æ® String inputPath = &quot;/Users/gaolei/Documents/DemoProjects/flink-start/src/main/resources/hello.txt&quot;; DataSource&lt;String&gt; dataSource = env.readTextFile(inputPath); // å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç† æŒ‰ç…§ç©ºæ ¼åˆ†è¯å±•å¼€ è½¬æ¢æˆï¼ˆwordï¼Œ1ï¼‰äºŒå…ƒç»„ AggregateOperator&lt;Tuple2&lt;String, Integer&gt;&gt; result = dataSource.flatMap(new MyFlatMapper()) // æŒ‰ç…§ç¬¬ä¸€ä¸ªä½ç½® -&gt; word åˆ†ç»„ .groupBy(0) .sum(1); result.print(); &#125; public static class MyFlatMapper implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; // é¦–å…ˆæŒ‰ç…§ç©ºæ ¼åˆ†è¯ String[] words = s.split(&quot; &quot;); // éå†æ‰€æœ‰çš„word åŒ…è£…æˆäºŒå…ƒç»„è¾“å‡º for (String word : words) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(word, 1)); &#125; &#125; &#125; å‡†å¤‡æ•°æ®æºæ–‡ä»¶123456hello sparkhello worldhello javahello flinkhow are youwhat is your name æ‰§è¡Œç»“æœ123456789101112(is,1)(what,1)(you,1)(flink,1)(name,1)(world,1)(hello,4)(your,1)(are,1)(java,1)(how,1)(spark,1) flink å¤„ç†æµå¼æ•°æ®1ã€é€šè¿‡ nc -lk &lt;port&gt; æ‰“å¼€ä¸€ä¸ªsocketæœåŠ¡ï¼Œç›‘å¬7777ç«¯å£ ç”¨äºæ¨¡æ‹Ÿå®æ—¶çš„æµæ•°æ® 2ã€javaä»£ç å¤„ç†æµå¼æ•°æ® 123456789101112131415161718192021222324252627public class StreamWordCount &#123; public static void main(String[] args) throws Exception &#123; // åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment(); // è®¾ç½®å¹¶è¡Œåº¦ï¼Œé»˜è®¤å€¼ = å½“å‰è®¡ç®—æœºçš„CPUé€»è¾‘æ ¸æ•°ï¼ˆè®¾ç½®æˆ1å³å•çº¿ç¨‹å¤„ç†ï¼‰ // env.setMaxParallelism(32); // ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®// String inputPath = &quot;/tmp/Flink_Tutorial/src/main/resources/hello.txt&quot;;// DataStream&lt;String&gt; inputDataStream = env.readTextFile(inputPath); // ä»socketæ–‡æœ¬æµè¯»å–æ•°æ® DataStream&lt;String&gt; inputDataStream = env.socketTextStream(&quot;localhost&quot;, 7777); // åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®— DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(new WordCount.MyFlatMapper()) .keyBy(0) .sum(1); resultStream.print(); // æ‰§è¡Œä»»åŠ¡ env.execute(); &#125;&#125; 4ã€åœ¨é¦–æ¬¡å¯åŠ¨çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªé”™è¯¯ âŒException in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/flink/streaming/api/datastream/DataStreamå¤„ç†æ–¹æ³•å¯å‚ç…§ å‚è€ƒèµ„æ–™ ğŸ‘‡ å‚è€ƒèµ„æ–™ Exception in thread â€œmainâ€ java.lang.NoClassDefFoundError è§£å†³æ–¹æ¡ˆ https://flink.apache.org/zh/downloads.html https://www.cnblogs.com/zlshtml/p/13796793.html","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"Apache Flink","date":"2021-07-04T12:45:57.000Z","path":"wiki/flinkç®€ä»‹/","text":"å®˜æ–¹åœ°å€è¯·æˆ³ğŸ‘‰ ã€ä¼ é€ã€‘ Apache Flink is a framework and distributed processing engine for stateful computations over unbounded and bounded data streams. Flink has been designed to run in all common cluster environments, perform computations at in-memory speed and at any scale. Apache Flink æ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å™¨å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®è¿›è¡ŒçŠ¶æ€è®¡ç®—ï¼› Why Flink æµæ•°æ®æ›´çœŸå®åœ°ååº”äº†æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼ ä¼ ç»Ÿçš„æ•°æ®æ¶æ„æ˜¯åŸºäºæœ‰é™æ•°æ®é›†çš„ æˆ‘ä»¬çš„ç›®æ ‡1ã€ä½å»¶è¿Ÿ æ¯«ç§’çº§å“åº”2ã€é«˜åå èƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ® åˆ†å¸ƒå¼3ã€ç»“æœçš„å‡†ç¡®æ€§å’Œè‰¯å¥½çš„å®¹é”™æ€§ Where need Flink ç”µå•†å’Œå¸‚åœºè¥é”€æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦ ç‰©è”ç½‘ï¼ˆIOTï¼‰ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºï¼Œå®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š ç”µä¿¡ä¸šåŸºç«™æµé‡è°ƒé… é“¶è¡Œå’Œé‡‘èä¸šå®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ã€å®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„ ä¼ ç»Ÿçš„æ•°æ®å¤„ç†æ¶æ„å¦‚ä¸ŠğŸ‘†CRM(ç”¨æˆ·å…³ç³»ç³»ç»Ÿ)ï¼Œ Order System(è®¢å•ç³»ç»Ÿ), Web App (ç”¨æˆ·ç‚¹å‡»æ—¶é—´)ï¼Œå½“ç”¨æˆ·å‡ºå‘è¡Œä¸ºä¹‹åéœ€è¦ç³»ç»Ÿä½œå‡ºå“åº”ï¼Œé¦–å…ˆç”±ä¸Šå±‚çš„è®¡ç®—å±‚å¤„ç†è®¡ç®—é€»è¾‘ï¼Œè®¡ç®—å±‚çš„é€»è¾‘è®¡ç®—ä¾èµ–ä¸‹é¢çš„å­˜å‚¨å±‚ï¼Œè®¡ç®—å±‚è®¡ç®—å®Œæˆä¹‹åï¼Œå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§åŸºäºä¼ ç»Ÿæ•°æ®åº“æ–¹å¼æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯ï¼Œæ•°æ®åº“çš„å¹¶å‘é‡éƒ½æ˜¯å¾ˆä½çš„ã€‚ åˆ†æå¤„ç†æµç¨‹ åˆ†æå¤„ç†æµç¨‹æ¶æ„å¦‚ä¸ŠğŸ‘†ï¼Œæ•°æ®å…ˆæœ‰ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ï¼Œç»è¿‡æå–ï¼Œæ¸…æ´—è¿‡æ»¤ç­‰ï¼Œå°†æ•°æ®å­˜æ”¾åˆ°æ•°æ®ä»“åº“ï¼Œç„¶åé€šè¿‡ä¸€äº›sqlå¤„ç†ï¼Œç”Ÿæˆæ•°æ®æŠ¥è¡¨å’Œä¸€äº›å…¶ä»–çš„æŸ¥è¯¢ã€‚ é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®æ—¶æ€§å¤ªå·®äº†ï¼Œå¤„ç†æµç¨‹å¤ªé•¿ï¼Œæ— æ³•æ»¡è¶³æ¯«ç§’çº§éœ€æ±‚ æ•°æ®æ¥æºä¸å”¯ä¸€ï¼Œèƒ½æ»¡è¶³æµ·é‡æ•°æ®å’Œé«˜å¹¶å‘çš„éœ€æ±‚ï¼Œä½†æ˜¯æ— æ³•æ»¡è¶³å®æ—¶çš„éœ€æ±‚ æœ‰çŠ¶æ€çš„æµå¼å¤„ç† æŠŠå½“å‰åšæµå¼è®¡ç®—æ‰€éœ€è¦çš„æ•°æ®ä¸å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯ç®€å•ç²—æš´çš„ç›´æ¥æ”¾åˆ°æœ¬åœ°å†…å­˜ä¸­ï¼› å†…å­˜ä¸ç¨³å®šï¼Ÿå‘¨æœŸæ€§çš„æ£€æŸ¥ç‚¹ï¼Œæ•°æ®å­˜ç›˜å’Œæ•…éšœæ£€æµ‹ï¼› lambdaæ¶æ„ç”¨ä¸¤å°ç³»ç»ŸåŒæ—¶ä¿éšœä½å»¶è¿Ÿå’Œç»“æœå‡†ç¡®ï¼› è¿™å¥—æ¶æ„åˆ†æˆä¸¤ä¸ªæµç¨‹ï¼Œä¸Šé¢ä¸ºæ‰¹å¤„ç†æµç¨‹ï¼Œæ•°æ®æ”¶é›†åˆ°ä¸€å®šç¨‹åºï¼Œäº¤ç»™æ‰¹å¤„ç†å™¨å¤„ç†ï¼Œæœ€ç»ˆäº§ç”Ÿä¸€ä¸ªæ‰¹å¤„ç†ç»“æœ ä¸‹é¢çš„æµç¨‹ä¸ºæµå¼å¤„ç†æµç¨‹ï¼Œä¿è¯èƒ½å¿«é€Ÿå¾—åˆ°ç»“æœ æœ€ç»ˆæœ‰æˆ‘ä»¬åœ¨åº”ç”¨å±‚æ ¹æ®å®é™…é—®é¢˜é€‰æ‹©å…·ä½“çš„å¤„ç†ç»“æœäº¤ç»™åº”ç”¨ç¨‹åºè¿™ç§æ¶æ„æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿå¯èƒ½å¾—åˆ°çš„ç»“æœæ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¿«é€Ÿçš„å¾—åˆ°ä¸€ä¸ªå®æ—¶è®¡ç®—çš„ç»“æœï¼Œéš”ä¸€æ®µæ—¶é—´ä¹‹ååœ¨æ¥çœ‹æ‰¹å¤„ç†äº§ç”Ÿçš„ç»“æœã€‚å®ç°ä¸¤å°ç³»ç»Ÿå’Œç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿï¼Œæˆæœ¬å¾ˆå¤§ï¼› ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„Apache Flink å¯ä»¥å®Œç¾è§£å†³ä¸Šé¢çš„é—®é¢˜ğŸ‘†Stromæ— æ³•æ»¡è¶³æµ·é‡æ•°æ®ï¼› Sparking Stream æ— æ³•æ»¡è¶³ä½å»¶è¿Ÿï¼› åŸºäºäº‹ä»¶é©±åŠ¨ ï¼ˆEvent-drivenï¼‰ å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®ä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥å½¢æˆä¸€ç§äº‹ä»¶æµã€‚ä¿¡ç”¨å¡äº¤æ˜“ã€ä¼ æ„Ÿå™¨æµ‹é‡ã€æœºå™¨æ—¥å¿—ã€ç½‘ç«™æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºä¸Šçš„ç”¨æˆ·äº¤äº’è®°å½•ï¼Œæ‰€æœ‰è¿™äº›æ•°æ®éƒ½å½¢æˆä¸€ç§æµã€‚æ•°æ®å¯ä»¥è¢«ä½œä¸º æ— ç•Œ æˆ–è€… æœ‰ç•Œ æµæ¥å¤„ç†ã€‚ æ— ç•Œæµ æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä½†æ²¡æœ‰å®šä¹‰æµçš„ç»“æŸã€‚å®ƒä»¬ä¼šæ— ä¼‘æ­¢åœ°äº§ç”Ÿæ•°æ®ã€‚æ— ç•Œæµçš„æ•°æ®å¿…é¡»æŒç»­å¤„ç†ï¼Œå³æ•°æ®è¢«æ‘„å–åéœ€è¦ç«‹åˆ»å¤„ç†ã€‚æˆ‘ä»¬ä¸èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾å†å¤„ç†ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— é™çš„ï¼Œåœ¨ä»»ä½•æ—¶å€™è¾“å…¥éƒ½ä¸ä¼šå®Œæˆã€‚å¤„ç†æ— ç•Œæ•°æ®é€šå¸¸è¦æ±‚ä»¥ç‰¹å®šé¡ºåºæ‘„å–äº‹ä»¶ï¼Œä¾‹å¦‚äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¨æ–­ç»“æœçš„å®Œæ•´æ€§ã€‚ æœ‰ç•Œæµ&lt;/&gt; æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä¹Ÿæœ‰å®šä¹‰æµçš„ç»“æŸã€‚æœ‰ç•Œæµå¯ä»¥åœ¨æ‘„å–æ‰€æœ‰æ•°æ®åå†è¿›è¡Œè®¡ç®—ã€‚æœ‰ç•Œæµæ‰€æœ‰æ•°æ®å¯ä»¥è¢«æ’åºï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æœ‰åºæ‘„å–ã€‚æœ‰ç•Œæµå¤„ç†é€šå¸¸è¢«ç§°ä¸ºæ‰¹å¤„ç† Apache Flink æ“…é•¿å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®é›† ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶å’ŒçŠ¶æ€åŒ–ä½¿å¾— Flink çš„è¿è¡Œæ—¶(runtime)èƒ½å¤Ÿè¿è¡Œä»»ä½•å¤„ç†æ— ç•Œæµçš„åº”ç”¨ã€‚æœ‰ç•Œæµåˆ™ç”±ä¸€äº›ä¸“ä¸ºå›ºå®šå¤§å°æ•°æ®é›†ç‰¹æ®Šè®¾è®¡çš„ç®—æ³•å’Œæ•°æ®ç»“æ„è¿›è¡Œå†…éƒ¨å¤„ç†ï¼Œäº§ç”Ÿäº†å‡ºè‰²çš„æ€§èƒ½ã€‚ å…¶ä»–ç‰¹ç‚¹ æ”¯æŒäº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰è¯­ä¹‰ ç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ ä½å»¶è¿Ÿ æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿ ä¸ä¼—å¤šå¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿé“¾æ¥ é«˜å¯ç”¨ï¼ŒåŠ¨æ€æ‰©å±•ï¼Œæ”¯æŒ7*24å…¨å¤©è¿è¡Œ å‚è€ƒèµ„æ–™ 1ã€å°šç¡…è°· 2021 Flink Javaç‰ˆ2ã€Apache Flink Documentation","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"Flink è¿è¡Œæ—¶æ¶æ„","date":"2021-07-04T12:45:57.000Z","path":"wiki/flinkè¿è¡Œæ—¶æ¶æ„/","text":"Flinkè¿è¡Œæ—¶ç»„ä»¶ JobManager (ä½œä¸šç®¡ç†å™¨) JobManager å…·æœ‰è®¸å¤šä¸åè°ƒ Flink åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼æ‰§è¡Œæœ‰å…³çš„èŒè´£ï¼šå®ƒå†³å®šä½•æ—¶è°ƒåº¦ä¸‹ä¸€ä¸ª taskï¼ˆæˆ–ä¸€ç»„ taskï¼‰ã€å¯¹å®Œæˆçš„ task æˆ–æ‰§è¡Œå¤±è´¥åšå‡ºååº”ã€åè°ƒ checkpointã€å¹¶ä¸”åè°ƒä»å¤±è´¥ä¸­æ¢å¤ç­‰ç­‰ã€‚è¿™ä¸ªè¿›ç¨‹ç”±ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ç»„æˆï¼š ResourceManagerResourceManager è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºæä¾›ã€å›æ”¶ã€åˆ†é… - å®ƒç®¡ç† task slotsï¼Œè¿™æ˜¯ Flink é›†ç¾¤ä¸­èµ„æºè°ƒåº¦çš„å•ä½ã€‚Flink ä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºæä¾›è€…ï¼ˆä¾‹å¦‚ YARNã€Mesosã€Kubernetes å’Œ standalone éƒ¨ç½²ï¼‰å®ç°äº†å¯¹åº”çš„ ResourceManagerã€‚åœ¨ standalone è®¾ç½®ä¸­ï¼ŒResourceManager åªèƒ½åˆ†é…å¯ç”¨ TaskManager çš„ slotsï¼Œè€Œä¸èƒ½è‡ªè¡Œå¯åŠ¨æ–°çš„ TaskManagerã€‚ DispatcherDispatcher æä¾›äº†ä¸€ä¸ª REST æ¥å£ï¼Œç”¨æ¥æäº¤ Flink åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ JobMasterã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI ç”¨æ¥æä¾›ä½œä¸šæ‰§è¡Œä¿¡æ¯ã€‚ JobMasterJobMaster è´Ÿè´£ç®¡ç†å•ä¸ª JobGraph çš„æ‰§è¡Œã€‚Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ JobMasterã€‚å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ª JobManagerã€‚é«˜å¯ç”¨ï¼ˆHAï¼‰è®¾ç½®ä¸­å¯èƒ½æœ‰å¤šä¸ª JobManagerï¼Œå…¶ä¸­ä¸€ä¸ªå§‹ç»ˆæ˜¯ leaderï¼Œå…¶ä»–çš„åˆ™æ˜¯ standbyã€‚ TaskManager ï¼ˆä»»åŠ¡ç®¡ç†å™¨ï¼‰ Flinkä¸­çš„å·¥ä½œè¿›ç¨‹ï¼Œé€šå¸¸åœ¨flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œæ¯ä¸€ä¸ªTaskMaganeréƒ½åŒ…å«ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰. æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼› å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œä»–çš„æ’æ§½ï¼Œæ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ï¼ŒJobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº† åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶ä»–è¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManageräº¤æ¢æ•°æ®ã€‚ ä»»åŠ¡æäº¤æµç¨‹ ä»»åŠ¡è°ƒåº¦åŸç†Flink è¿è¡Œæ—¶ç”±ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ç»„æˆï¼šä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–è€…å¤šä¸ª TaskManagerã€‚ Client ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”¨äºå‡†å¤‡æ•°æ®æµå¹¶å°†å…¶å‘é€ç»™ JobManagerã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥ï¼ˆåˆ†ç¦»æ¨¡å¼ï¼‰ï¼Œæˆ–ä¿æŒè¿æ¥æ¥æ¥æ”¶è¿›ç¨‹æŠ¥å‘Šï¼ˆé™„åŠ æ¨¡å¼ï¼‰ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½œä¸ºè§¦å‘æ‰§è¡Œ Java/Scala ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›ç¨‹./bin/flink run â€¦ä¸­è¿è¡Œã€‚ å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ JobManager å’Œ TaskManagerï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºstandalone é›†ç¾¤å¯åŠ¨ã€åœ¨å®¹å™¨ä¸­å¯åŠ¨ã€æˆ–è€…é€šè¿‡YARNæˆ–Mesosç­‰èµ„æºæ¡†æ¶ç®¡ç†å¹¶å¯åŠ¨ã€‚TaskManager è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚ æ€è€ƒé—®é¢˜ğŸ¤” æ€æ ·å®ç°å¹¶è¡Œè®¡ç®—ï¼Ÿ å¤šçº¿ç¨‹ å¹¶è¡Œçš„ä»»åŠ¡ï¼Œéœ€è¦å ç”¨å¤šå°‘soltï¼Ÿ ä¸€ä¸ªæµå¤„ç†ç¨‹åºï¼Œåˆ°åº•åŒ…å«å¤šå°‘ä¸ªä»»åŠ¡ï¼Ÿ Tasks å’Œç®—å­é“¾å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰ ä¸€ä¸ªç‰¹å®šç®—å­çš„å­ä»»åŠ¡ï¼ˆsubtaskï¼‰çš„ä¸ªæ•°è¢«ç§°ä¹‹ä¸ºå¹¶è¡Œåº¦ï¼› ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªStreamçš„å¹¶è¡Œåº¦å°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦ã€‚æ•´ä¸ªæµä¹Ÿæœ‰ä¸€ä¸ªå¹¶è¡Œåº¦ï¼Œå°±æ˜¯æ‰€æœ‰ç®—å­æ‰€æœ‰ä»»åŠ¡çš„å¹¶è¡Œåº¦ä¹‹å’Œï¼›å¯¹äºåˆ†å¸ƒå¼æ‰§è¡Œï¼ŒFlink å°†ç®—å­çš„ subtasks é“¾æ¥æˆ tasksã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†ç®—å­é“¾æ¥æˆ task æ˜¯ä¸ªæœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢ã€ç¼“å†²çš„å¼€é”€ï¼Œå¹¶ä¸”å‡å°‘å»¶è¿Ÿçš„åŒæ—¶å¢åŠ æ•´ä½“ååé‡ã€‚é“¾è¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ï¼›è¯·å‚è€ƒé“¾æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚ TaskManager å’Œ Slots","tags":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"æ‹¥å¡é¿å…","date":"2021-07-04T08:46:13.000Z","path":"wiki/æ‹¥å¡é¿å…/","text":"æ‹¥å¡é¿å…æ‹¥å¡æ§åˆ¶çš„æ…¢å¯åŠ¨æ˜¯ä»¥æŒ‡æ•°æ–¹å¼å¿«é€Ÿçš„é€šè¿‡è¯•æ¢æ¥æ‰©å¤§æ‹¥å¡çª—å£çš„ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿç½‘ç»œä¸¢åŒ…ï¼Œåˆ™è‚¯å®šæ˜¯å¾ˆå¤šæŠ¥æ–‡æ®µéƒ½ä¼šéƒ½æ˜¯ï¼Œå› ä¸ºçª—å£æ—¶ç§°è¢«å¢é•¿çš„ï¼›ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œéœ€è¦å¼•å…¥â€“ æ‹¥å¡é¿å… ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…æ‹¥å¡é¿å…ä¸ºäº†è§£å†³æ…¢å¯åŠ¨ä¸‹ï¼Œå½“æ‹¥å¡çª—å£è¶…å‡ºç½‘ç»œå¸¦å®½æ—¶å‘ç”Ÿçš„å¤§é‡ä¸¢åŒ…é—®é¢˜ï¼Œå®ƒæå‡ºä¸€ä¸ªã€Œæ…¢å¯åŠ¨é˜ˆå€¼ã€çš„æ¦‚å¿µï¼Œå½“æ‹¥å¡çª—å£åˆ°è¾¾è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œä¸åœ¨ä»¥æŒ‡æ•°æ–¹å¼å¢é•¿ï¼Œè€Œé€‰æ‹©æ¶¨å¹…æ¯”è¾ƒç¼“æ…¢çš„ã€Œçº¿æ€§å¢é•¿ã€ï¼Œè®¡ç®—æ–¹å¼ï¼š cwnd += SMSS*SMSS/cwnd å½“æ‹¥å¡çª—å£åœ¨çº¿æ€§å¢é•¿æ—¶å‘ç”Ÿä¸¢åŒ…ï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®ä¸ºå½“å‰çª—å£çš„ä¸€åŠï¼Œæ…¢å¯åŠ¨çª—å£æ¢å¤åˆå§‹çª—å£ï¼ˆinit wndï¼‰ï¼› æ‹¥å¡é¿å…å’Œæ…¢å¯åŠ¨æ˜¯ç»“åˆä½¿ç”¨çš„ï¼Œå½“å‘ç”Ÿç½‘ç»œä¸¢åŒ…æ˜¯ï¼Œæ‹¥å¡æ§åˆ¶é‡‡ç”¨å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿå¯åŠ¨æ¥è§£å†³ä¸¢åŒ…é—®é¢˜ï¼","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-å››æ¬¡æŒ¥æ‰‹/æ–­å¼€è¿æ¥","date":"2021-07-04T08:34:11.000Z","path":"wiki/TCP-å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥/","text":"TCPæ–­å¼€è¿æ¥å››æ¬¡æŒ¥æ‰‹ å¼€å§‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯å¤„ç†ã€establishedã€‘çŠ¶æ€ å®¢æˆ·ç«¯å‘é€ã€ŒFINã€æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥FIN-WAIT-1çŠ¶æ€ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„FINä¹‹åï¼Œæ¢å¤ä¸€ä¸ªACKï¼ŒåŒæ—¶è¿›å…¥CLOSE_WAITçŠ¶æ€ å®¢æˆ·ç«¯æ¥æ”¶åˆ°ACKä¹‹åï¼Œè¿›å…¥åˆ°FIN-WAIT-2çŠ¶æ€ æœåŠ¡ç«¯æ¥ç€å‘é€FINæŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥LAST-ACKçŠ¶æ€ å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„FINæŠ¥æ–‡ä¹‹åï¼Œå‘é€ACKæŠ¥æ–‡ï¼Œå¹¶è¿›å…¥TIME_WAITçŠ¶æ€ å®¢æˆ·ç«¯åœ¨ç»å†2ä¸ªMSLæ—¶é—´ä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€ æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€ å¹¶ä¸æ˜¯æ‰€æœ‰çš„å››æ¬¡æŒ¥æ‰‹éƒ½æ˜¯ä¸Šè¿°æµç¨‹ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶å‘é€å…³é—­è¿æ¥çš„è¯·æ±‚å¦‚ä¸‹ğŸ‘‡ï¼š å¯ä»¥çœ‹åˆ°åŒæ–¹éƒ½ä¸»åŠ¨å‘èµ·æ–­å¼€è¯·æ±‚æ‰€ä»¥å„è‡ªéƒ½æ˜¯ä¸»åŠ¨å‘èµ·æ–¹ï¼ŒçŠ¶æ€ä¼šä» FIN_WAIT_1 éƒ½è¿›å…¥åˆ° CLOSING è¿™ä¸ªè¿‡åº¦çŠ¶æ€ç„¶åå†åˆ° TIME_WAITã€‚ æŒ¥æ‰‹ä¸€å®šéœ€è¦å››æ¬¡å—ï¼Ÿ å‡è®¾ client å·²ç»æ²¡æœ‰æ•°æ®å‘é€ç»™ server äº†ï¼Œæ‰€ä»¥å®ƒå‘é€ FIN ç»™ server è¡¨æ˜è‡ªå·±æ•°æ®å‘å®Œäº†ï¼Œä¸å†å‘äº†ï¼Œå¦‚æœè¿™æ—¶å€™ server è¿˜æ˜¯æœ‰æ•°æ®è¦å‘é€ç»™ client é‚£ä¹ˆå®ƒå°±æ˜¯å…ˆå›å¤ ack ï¼Œç„¶åç»§ç»­å‘é€æ•°æ®ã€‚ç­‰ server æ•°æ®å‘é€å®Œäº†ä¹‹åå†å‘ client å‘é€ FIN è¡¨æ˜å®ƒä¹Ÿå‘å®Œäº†ï¼Œç„¶åç­‰ client çš„ ACK è¿™ç§æƒ…å†µä¸‹å°±ä¼šæœ‰å››æ¬¡æŒ¥æ‰‹ã€‚é‚£ä¹ˆå‡è®¾ client å‘é€ FIN ç»™ server çš„æ—¶å€™ server ä¹Ÿæ²¡æ•°æ®ç»™ clientï¼Œé‚£ä¹ˆ server å°±å¯ä»¥å°† ACK å’Œå®ƒçš„ FIN ä¸€èµ·å‘ç»™client ï¼Œç„¶åç­‰å¾… client çš„ ACKï¼Œè¿™æ ·ä¸å°±ä¸‰æ¬¡æŒ¥æ‰‹äº†ï¼Ÿ ä¸ºä»€ä¹ˆè¦æœ‰ TIME_WAIT? æ–­å¼€è¿æ¥å‘èµ·æ–¹åœ¨æ¥å—åˆ°æ¥å—æ–¹çš„ FIN å¹¶å›å¤ ACK ä¹‹åå¹¶æ²¡æœ‰ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€æ³¢ç­‰å¾…ï¼Œç­‰å¾…æ—¶é—´ä¸º 2MSLã€‚MSL æ˜¯ Maximum Segment Lifetimeï¼Œå³æŠ¥æ–‡æœ€é•¿ç”Ÿå­˜æ—¶é—´ï¼ŒRFC 793 å®šä¹‰çš„ MSL æ—¶é—´æ˜¯ 2 åˆ†é’Ÿï¼ŒLinux å®é™…å®ç°æ˜¯ 30sï¼Œé‚£ä¹ˆ 2MSL æ˜¯ä¸€åˆ†é’Ÿã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç­‰ 2MSL å‘¢ï¼Ÿ å°±æ˜¯æ€•è¢«åŠ¨å…³é—­æ–¹æ²¡æœ‰æ”¶åˆ°æœ€åçš„ ACKï¼Œå¦‚æœè¢«åŠ¨æ–¹ç”±äºç½‘ç»œåŸå› æ²¡æœ‰åˆ°ï¼Œé‚£ä¹ˆå®ƒä¼šå†æ¬¡å‘é€ FINï¼Œ æ­¤æ—¶å¦‚æœä¸»åŠ¨å…³é—­æ–¹å·²ç» CLOSED é‚£å°±å‚»äº†ï¼Œå› æ­¤ç­‰ä¸€ä¼šå„¿ã€‚ å‡è®¾ç«‹é©¬æ–­å¼€è¿æ¥ï¼Œä½†æ˜¯åˆé‡ç”¨äº†è¿™ä¸ªè¿æ¥ï¼Œå°±æ˜¯äº”å…ƒç»„å®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”åºå·è¿˜åœ¨åˆé€‚çš„èŒƒå›´å†…ï¼Œè™½ç„¶æ¦‚ç‡å¾ˆä½ä½†ç†è®ºä¸Šä¹Ÿæœ‰å¯èƒ½ï¼Œé‚£ä¹ˆæ–°çš„è¿æ¥ä¼šè¢«å·²å…³é—­è¿æ¥é“¾è·¯ä¸Šçš„ä¸€äº›æ®‹ç•™æ•°æ®å¹²æ‰°ï¼Œå› æ­¤ç»™äºˆä¸€å®šçš„æ—¶é—´æ¥å¤„ç†ä¸€äº›æ®‹ç•™æ•°æ®ã€‚ ç­‰å¾… 2MSL ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœæœåŠ¡å™¨ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆä¼šå‡ºç°å¤§é‡çš„èµ„æºå ç”¨ï¼Œéœ€è¦ç­‰åˆ° 2MSL æ‰ä¼šé‡Šæ”¾èµ„æºã€‚å¦‚æœæ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆåœ¨ 2MSL é‡Œé¢é‚£äº›ç«¯å£éƒ½æ˜¯è¢«å ç”¨çš„ï¼Œç«¯å£åªæœ‰ 65535 ä¸ªï¼Œå¦‚æœç«¯å£è€—å°½äº†å°±æ— æ³•å‘èµ·é€çš„è¿æ¥äº†ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæ¦‚ç‡å¾ˆä½ï¼Œè¿™ä¹ˆå¤šç«¯å£ä½ è¿™æ˜¯è¦å»ºç«‹å¤šå°‘ä¸ªè¿æ¥ï¼Ÿ","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"å¿«é€Ÿé‡ä¼ /å¿«é€Ÿæ¢å¤","date":"2021-07-04T08:33:35.000Z","path":"wiki/å¿«é€Ÿé‡ä¼ -å¿«é€Ÿæ¢å¤/","text":"å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤å¿«é€Ÿé‡ä¼  d ä¸ºä½•ä¼šæ¥æ”¶åˆ°ä»¥ä¸ªå¤±åºæ•°æ®æ®µï¼Ÿ è‹¥æŠ¥æ–‡ä¸¢å¤±ï¼Œå°†ä¼šäº§ç”Ÿè¿ç»­çš„å¤±åºACKæ®µ è‹¥ç½‘ç»œè·¯å¾„ä¸è®¾å¤‡å¯¼è‡´æ•°æ®æ®µå¤±åºï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ è‹¥æŠ¥æ–‡é‡å¤ï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ å½“å‘é€ç«¯å‘é€pkt0æ˜¯æ­£å¸¸çš„ï¼Œç”±äºæ»‘åŠ¨çª—å£ä¸ºæ»¡ï¼Œå‘é€æ–¹å¯ä»¥ç»§ç»­å‘é€pkt1ï¼Œpkt2ï¼› åŠ å…¥pkt1å‘ç”Ÿäº†ä¸¢åŒ…ï¼Œè™½ç„¶pkt2æ¥æ”¶ç«¯æ¥æ”¶æˆåŠŸäº†ï¼Œä½†æ˜¯æ²¡æœ‰pkt1çš„æ•°æ®æ®µï¼Œæ¥æ”¶ç«¯è¿˜æ˜¯å‘é€ACK1çš„ç¡®è®¤æŠ¥æ–‡ï¼› åœ¨æ²¡æœ‰ã€Œå¿«é€Ÿé‡ä¼ ã€çš„æƒ…å†µä¸‹ï¼Œå‘é€ç«¯éœ€è¦ç­‰åˆ°RTOä¹‹åï¼Œæ‰å¯ä»¥é‡æ–°å‘é€pkt1 é‡ä¼ æˆåŠŸä¹‹åï¼Œæ¥æ”¶ç«¯å…¶å®æ”¶åˆ°äº†pkt2ä¹‹å‰çš„æ‰€æœ‰æ•°æ®æ®µï¼Œæ‰€ä»¥å‘é€ACK3çš„ç¡®è®¤æŠ¥æ–‡ è¿™ç§éœ€è¦ç­‰å¾…RTOæ‰å¯ä»¥é‡ä¼ çš„æ–¹å¼æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œå› æ­¤éœ€è¦å¿«é€Ÿé‡ä¼ æ¥è¿›è¡Œä¼˜åŒ–ï¼› å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤ å½“å‘é€æ–¹è¿ç»­å‘é€pkt3ï¼Œpkt4ï¼Œpkt5ï¼Œpkt6å››ä¸ªæ•°æ®ç«¯ï¼Œä½†æ˜¯pkt5åœ¨ç½‘ç»œä¸­ä¸¢åŒ…äº†ï¼Œé‚£åé¢å‘é€çš„pkt6ï¼Œpkt7ï¼Œpkt8çš„ç¡®è®¤æŠ¥æ–‡éƒ½è¿”å›ACK5ï¼Œå¸Œæœ›å‘é€æ–¹åƒæ˜‚ä¼ pkt5çš„æ•°æ®æ®µï¼›è¿™ä¸ªæ—¶å€™ï¼Œå‘é€æ–¹æ”¶åˆ°è¿ç»­3ä¸ªç›¸åŒçš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¾¿ç«‹å³é‡æ–°å‘é€pkt5çš„æ•°æ®æ®µï¼› æ¥æ”¶æ–¹: å½“æ¥æ”¶åˆ°ä¸€ä¸ªå¤±åºæ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘é€å®ƒæ‰€æœŸå¾…çš„ç¼ºå£ ACK åºåˆ—å· å½“æ¥æ”¶åˆ°å¡«å……å¤±åºç¼ºå£çš„æ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘ é€å®ƒæ‰€æœŸå¾…çš„ä¸‹ä¸€ä¸ª ACK åºåˆ—å· å‘é€æ–¹ å½“æ¥æ”¶åˆ°3ä¸ªé‡å¤çš„å¤±åº ACK æ®µ(4ä¸ªç›¸åŒçš„å¤±åºACKæ®µ)æ—¶ï¼Œä¸å†ç­‰å¾…é‡ä¼ å®šæ—¶å™¨çš„è§¦å‘ï¼Œç«‹åˆ»åŸºäºå¿«é€Ÿé‡ä¼ æœºåˆ¶é‡å‘æŠ¥æ–‡æ®µ å½“pkt5é‡æ–°å‘é€å¹¶è¢«æ¥æ”¶ç«¯æ¥æ”¶ä¹‹åï¼Œæ¥æ”¶ç«¯å‘é€ACK9çš„ç¡®è®¤æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯å†åˆ†åˆ«å‘é€ACK6ï¼ŒACK7ï¼ŒACK8ï¼Œè¿™ä¸ªç§°è°“ã€Œ ç´¯è®¡ç¡®è®¤ ã€ã€‚ å¿«é€Ÿæ¢å¤ å¿«é€Ÿé‡ä¼ ä¸‹ä¸€å®šè¦è¿›å…¥æ…¢å¯åŠ¨å—? æ¥å—ç«¯æ”¶åˆ°é‡å¤ACKï¼Œæ„å‘³ç€ç½‘ç»œä»åœ¨æµåŠ¨ï¼Œè€Œå¦‚æœè¦é‡æ–°è¿›å…¥æ…¢å¯åŠ¨ï¼Œä¼šå¯¼è‡´ç½‘ç»œçªç„¶å‡å°‘æ•°æ®æµï¼Œæ‹¥å¡çª—å£æ¢å¤åˆå§‹çª—å£ï¼Œæ‰€ä»¥ï¼Œã€Œåœ¨å¿«é€Ÿæ¢å¤ä¸‹å‘ç”Ÿä¸¢åŒ…çš„åœºæ™¯ä¸‹ã€ï¼Œåº”è¯¥ä½¿ç”¨å¿«é€Ÿæ¢å¤ï¼Œç®€å•çš„è®²ï¼Œå°±æ˜¯å°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®æˆå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠï¼Œè€Œæ‹¥å¡çª—å£ä¹Ÿé€‚å½“æ”¾ä½ï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­—æ¢å¤åˆ°åˆå§‹çª—å£å¤§å°ï¼› å¿«é€Ÿæ¢å¤çš„æµç¨‹å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼ å¿«é€Ÿæ¢å¤çš„å…·ä½“æ“ä½œï¼š å°† ssthresh è®¾ç½®ä¸ºå½“å‰æ‹¥å¡çª—å£ cwnd çš„ä¸€åŠï¼Œè®¾å½“å‰ cwnd ä¸º ssthresh åŠ ä¸Š 3*MSS æ¯æ”¶åˆ°ä¸€ä¸ªé‡å¤ ACKï¼Œcwnd å¢åŠ  1 ä¸ª MSS å½“æ–°æ•°æ® ACK åˆ°è¾¾åï¼Œè®¾ç½® cwnd ä¸º ssthresh","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-æ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨","date":"2021-07-04T08:33:19.000Z","path":"wiki/TCP-æ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨/","text":"ç”±äºTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ä¼ è¾“åè®®ï¼Œå¯ä»¥å‘é€ä¸å®šé•¿çš„å­—èŠ‚æµæ•°æ®ï¼ŒTCPè¿æ¥å‘é€æ•°æ®æ—¶ä¼šâ€œå…ˆå¤©æ€§â€å°è¯•å ç”¨æ•´ä¸ªå¸¦å®½ï¼Œè€Œå½“æ‰€æœ‰çš„TCPè¿æ¥éƒ½å°è¯•å ç”¨ç½‘ç»œå¸¦å®½æ—¶ï¼Œå°±ä¼šé€ æˆç½‘ç»œçš„å µå¡ï¼Œè€ŒTCPæ…¢å¯åŠ¨ç®—æ³•åˆ™æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€åœºæ™¯ï¼› å…¨å±€æ€è€ƒ æ‹¥å¡æ§åˆ¶è¦é¢å‘æ•´ä½“æ€è€ƒï¼Œå¦‚ä¸ŠğŸ‘†ç½‘ç»œæ‹“æ‰‘å›¾ï¼Œå½“å·¦è¾¹çš„ç½‘ç»œèŠ‚ç‚¹é€šè¿‡è·¯ç”±äº¤æ¢è®¾å¤‡å‘å³è¾¹çš„è®¾å¤‡ä¼ è¾“æŠ¥æ–‡çš„æ—¶å€™ï¼Œä¸­é—´çš„æŸä¸€é“¾è·¯çš„å¸¦å®½è‚¯å®šæ˜¯ä¸€å®šçš„ï¼Œè¿™é‡Œå‡è®¾1000Må¸¦å®½ï¼Œå½“å·¦è¾¹R1ä»¥700Mb/sçš„é€Ÿåº¦å‘é“¾è·¯ä¸­å‘é€æ•°æ®ï¼ŒåŒæ—¶R2ä»¥600Mb/sçš„é€Ÿç‡å‘é€æŠ¥æ–‡ï¼Œé‚£åŠ¿å¿…ä¼šæœ‰300Mbçš„æ•°æ®æŠ¥ä¸¢å¤±ï¼›ã€Œè·¯ç”±äº¤æ¢è®¾å¤‡åŸºäºå­˜å‚¨è½¬å‘æ¥å®ç°æŠ¥æ–‡çš„å‘é€ã€å¤§é‡æŠ¥æ–‡éƒ½æ˜¯æ—¶ï¼Œè·¯ç”±è®¾å¤‡çš„ç¼“å†²é˜Ÿåˆ—è‚¯å®šæ˜¯æ…¢çš„ï¼Œè¿™ä¹Ÿä¼šé€ æˆæŸäº›æ•°æ®æŠ¥åœ¨ç½‘ç»œé“¾è·¯ä¸­åœç•™æ—¶é—´è¿‡é•¿ï¼Œä»è€Œå¯¼è‡´TCPé€šè®¯å˜æ…¢ï¼Œç”šè‡³ç½‘ç»œç˜«ç—ªï¼› ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå½“é“¾è·¯å¸¦å®½å æ»¡ä»¥åï¼Œé“¾è·¯ä»¥æœ€å¤§å¸¦å®½ä¼ è¾“æ•°æ®ï¼Œå½“ç„¶æ˜¾ç¤ºä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå½“å‘ç”Ÿè½»åº¦æ‹¥å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡å°±å¼€å§‹ä¸‹é™äº†ï¼Œå‘å±•åˆ°ä¸¥é‡é˜»å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡ä¼šä¸¥é‡åœ°ä¸‹é™ï¼Œç”šè‡³ç˜«ç—ªï¼› é‚£ä¹ˆï¼Œæ…¢å¯åŠ¨æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„å‘¢ï¼Ÿ æ‹¥å¡çª—å£ æ‹¥å¡çª—å£cwnd(congestion window) é€šå‘Šçª—å£rwnd(receiverâ€˜s advertised window) å…¶å®å°±æ˜¯RCV.WNDï¼Œæ ‡å¿—åœ¨TCPé¦–éƒ¨çš„Windowå­—æ®µï¼ å‘é€çª—å£swnd = min(cwndï¼Œrwnd) å‰é¢å­¦ä¹ æ»‘åŠ¨çª—å£çš„æ—¶å€™æåˆ°å‘é€çª—å£å¤§è‡´ç­‰äºæ¥å—çª—å£ï¼Œå½“å¼•å…¥æ‹¥å¡çª—å£æ—¶ï¼Œå‘é€çª—å£å°±æ˜¯æ‹¥å¡çª—å£å’Œå¯¹æ–¹æ¥å—çª—å£çš„æœ€å°å€¼ æ¯æ”¶åˆ°ä¸€ä¸ªACKï¼Œcwndæ‰©å……ä¸€å€ æ…¢å¯åŠ¨çš„çª—å£å¤§å°å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿå¦‚ä¸Šæ‰€ç¤ºï¼Œèµ·åˆæ‹¥å¡çª—å£è®¾ç½®æˆ1ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå½“å‘é€ç«¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œè°ƒæ•´æ‹¥å¡çª—å£ä¸º2ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå¦‚æœè¿˜æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…ï¼Œä¸€æ¬¡ç±»æ¨ï¼ŒçŸ¥é“å‘ç”Ÿä¸¢åŒ…åœæ­¢ï¼›å‘é€çª—å£ä»¥ã€ŒæŒ‡æ•°ã€çš„æ–¹å¼æ‰©å¤§ï¼›æ…¢å¯åŠ¨æ˜¯æ— æ³•ç¡®çŸ¥ç½‘ç»œæ‹¥å¡ç¨‹åº¦çš„æƒ…å†µä¸‹ï¼Œä»¥è¯•æ¢æ€§åœ°æ–¹å¼å¿«é€Ÿæ‰©å¤§æ‹¥å¡çª—å£ï¼› æ…¢å¯åŠ¨åˆå§‹çª—å£æ…¢å¯åŠ¨çš„æ‹¥å¡çª—å£çœŸçš„å°±å¦‚ä¸Šé¢æ‰€è¯´çš„ä»¥ä¸€ä¸ªæŠ¥æ–‡æ®µå¤§å°ä½œä¸ºåˆå§‹å€¼å—ï¼Ÿ æ…¢å¯åŠ¨åˆå§‹çª—å£ IW(Initial Window)çš„å˜è¿ 1 SMSS:RFC2001(1997) 2 - 4 SMSS:RFC2414(1998) IW = min (4SMSS, max (2SMSS, 4380 bytes)) 10 SMSS:RFC6928(2013) IW = min (10MSS, max (2MSS, 14600)) å…¶å®åœ¨å®é™…æƒ…å†µä¸‹ï¼Œäº’è”ç½‘ä¸­çš„ç½‘é¡µéƒ½åœ¨10ä¸ªmsså·¦å³ï¼Œå¦‚æœè¿˜æ˜¯ä»1ä¸ªmsså¼€å§‹ï¼Œåˆ™ä¼šæµªè´¹3ä¸ªRTTçš„æ—¶é—´ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡","date":"2021-07-04T08:32:55.000Z","path":"wiki/TCP-å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡/","text":"å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡æ¯ä¸€ä¸ªTCPæŠ¥æ–‡æ®µéƒ½åŒ…å«20å­—èŠ‚çš„IPå¤´éƒ¨å’Œ20å­—èŠ‚çš„TCPé¦–éƒ¨ï¼Œå¦‚æœæŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†å¾ˆå°‘çš„è¯ï¼Œç½‘ç»œæ•ˆç‡ä¼šå¾ˆå·®ï¼› SWS(Silly Window syndrome) ç³Šæ¶‚çª—å£ç»¼åˆç—‡ å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºåœºæ™¯ï¼Œåœ¨ä¹‹å‰çš„æ»‘åŠ¨çª—å£å·²ç»äº†è§£è¿‡ï¼Œéšç€æœåŠ¡ç«¯å¤„ç†è¿æ¥æ•°æ®èƒ½åŠ›è¶Šæ¥è¶Šä½ï¼ŒæœåŠ¡ç«¯çš„å¯ç”¨çª—å£ä¸æ–­å‹ç¼©ï¼Œæœ€ç»ˆå¯¼è‡´çª—å£å…³é—­ï¼› SWS é¿å…ç®—æ³•SWS é¿å…ç®—æ³•å¯¹å‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½åšå®¢ æ¥æ”¶æ–¹ David D Clark ç®—æ³•:çª—å£è¾¹ç•Œç§»åŠ¨å€¼å°äº min(MSS, ç¼“å­˜/2)æ—¶ï¼Œé€šçŸ¥çª—å£ä¸º 0 å‘é€æ–¹ Nagle ç®—æ³•:1ã€TCP_NODELAY ç”¨äºå…³é—­ Nagle ç®—æ³•2ã€æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç«‹åˆ»å‘é€æ•°æ®3ã€å­˜åœ¨æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç›´åˆ°:1-æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µï¼Œæˆ–è€… 2-æ•°æ®é•¿åº¦è¾¾åˆ°MSSæ—¶å†å‘é€ TCP delayed acknowledgment å»¶è¿Ÿç¡®è®¤å®é™…æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æºå¸¦ä»»ä½•æ•°æ®çš„ACKæŠ¥æ–‡ä¹Ÿä¼šé€ æˆç½‘ç»œæ•ˆç‡ä½ä¸‹çš„ï¼Œå› ä¸ºç¡®è®¤æŠ¥æ–‡ä¹ŸåŒ…å«40å­—èŠ‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä½†ä»…ä»…æ˜¯ä¸ºäº†ä¼ è¾“ACK=1è¿™æ ·çš„ä¿¡æ¯ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼ŒTCPæœ‰ä¸€ç§æœºåˆ¶ï¼Œå«åšå»¶è¿Ÿç¡®è®¤ï¼Œå¦‚ä¸‹ğŸ‘‡ï¼š å½“æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶,ackä¼šéšç€å“åº”æ•°æ®ç«‹å³å‘é€ç»™å¯¹æ–¹. å¦‚æœæ²¡æœ‰å“åº”æ•°æ®,ackçš„å‘é€å°†ä¼šæœ‰ä¸€ä¸ªå»¶è¿Ÿ,ä»¥ç­‰å¾…çœ‹æ˜¯å¦æœ‰å“åº”æ•°æ®å¯ä»¥ä¸€èµ·å‘é€ å¦‚æœåœ¨ç­‰å¾…å‘é€ackæœŸé—´,å¯¹æ–¹çš„ç¬¬äºŒä¸ªæ•°æ®æ®µåˆåˆ°è¾¾äº†,è¿™æ—¶è¦ç«‹å³å‘é€ack é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ ä¸Šé¢ğŸ‘†æ˜¯Linuxæ“ä½œç³»ç»Ÿå¯¹äºTCPå»¶æ—¶çš„å®šä¹‰ã€‚ HZæ˜¯ä»€å‘¢ï¼Ÿå…¶å®é‚£æ˜¯å’Œæ“ä½œç³»ç»Ÿçš„æ—¶é’Ÿç›¸å…³çš„ï¼Œå…·ä½“çš„æ“ä½œç³»ç»Ÿé—´å„æœ‰å·®åˆ«ï¼›å¦‚ä½•æŸ¥çœ‹Linuxæ“ä½œç³»ç»Ÿä¸‹çš„HZå¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ 1cat /boot/config- `-uname -r` | grep &#x27;^GONFIG_HZ=&#x27; TCP_CORK sendfile é›¶æ‹·è´æŠ€æœ¯","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-æ»‘åŠ¨çª—å£","date":"2021-07-04T08:32:40.000Z","path":"wiki/TCP-æ»‘åŠ¨çª—å£/","text":"æ»‘åŠ¨çª—å£ ä¹‹å‰å­¦ä¹ äº†PARæ–¹å¼çš„TCPè¶…æ—¶å’Œé‡ä¼ ï¼Œå…¶å®åœ¨è€ƒè™‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥çš„åŒæ—¶ï¼Œä¹Ÿåº”è¯¥è€ƒè™‘æ¥æ”¶æ–¹å¯¹äºæ•°æ®çš„å¤„ç†èƒ½åŠ›ï¼Œç”±æ­¤å¼•å‡ºæœ¬æ¬¡å­¦ä¹ çš„ä¸»é¢˜ â€“ æ»‘åŠ¨çª—å£ å‘é€ç«¯çª—å£æ»‘åŠ¨çª—å£æŒ‰ç…§ä¼ è¾“æ•°æ®æ–¹å‘åˆ†ä¸ºä¸¤ç§ï¼Œå‘é€ç«¯çª—å£å’Œæ¥æ”¶ç«¯çª—å£ï¼›ä¸‹é¢å…ˆçœ‹ä¸€ä¸‹å‘é€ç«¯çª—å£ğŸ‘‡ï¼š ä¸Šå›¾åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š å·²å‘é€å¹¶æ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:1-31 å­—èŠ‚ å·²å‘é€æœªæ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:32-45 å­—èŠ‚ æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…:46-51 å­—èŠ‚ æœªå‘é€ä½†æ€»å¤§å°è¶…å‡ºæ¥æ”¶æ–¹å¤„ç†èŒƒå›´:52-å­—èŠ‚ å¯ç”¨çª—å£å’Œå‘é€çª—å£ å¦‚ä¸Šå›¾è¿™é‡Œå¯ä»¥å¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼šã€Œå¯ç”¨çª—å£ã€å’Œã€Œå‘é€çª—å£ã€ ã€ å¯ç”¨çª—å£ ã€‘ï¼š å°±æ˜¯ä¸Šå›¾ä¸­çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå±äºè¿˜æœªå‘é€ï¼Œä½†æ˜¯åœ¨æ¥æ”¶ç«¯å¯ä»¥å¤„ç†èŒƒå›´å†…çš„éƒ¨åˆ†ï¼›ã€ å‘é€çª—å£ ã€‘ï¼š å°±æ˜¯å‘é€ç«¯å¯ä»¥å‘é€çš„æœ€å¤§æŠ¥æ–‡å¤§å°ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ç¬¬äºŒéƒ¨åˆ†+ç¬¬ä¸‰éƒ¨åˆ†åˆæˆå‘é€çª—å£ï¼› å¯ç”¨çª—å£è€—å°½ å¯ç”¨çª—å£ä¼šåœ¨ä¸€ä¸ªçŸ­æš‚çš„åœç•™ï¼Œå½“å¤„äºæœªå‘é€å¹¶ä¸”æ¥å—ç«¯å¯ä»¥æ¥å—èŒƒå›´å†…çš„æ•°æ®ä¼ è¾“å®Œæˆä¹‹åï¼Œå¯ç”¨çª—å£è€—å°½ï¼›å½“ç„¶ä¸Šé¢ä»…ä»…è¯´çš„ä¸€ç¬æ—¶çš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå·²ç»å‘é€çš„æŠ¥æ–‡æ®µè¿˜æ²¡æœ‰ç¡®è®¤ï¼Œå¹¶ä¸”å‘é€çª—å£å¤§å°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å‘é€çª—å£è¾¾åˆ°æœ€å¤§çŠ¶æ€ï¼› çª—å£ç§»åŠ¨ å¦‚æœåœ¨å‘é€çª—å£ä¸­å·²ç»å‘é€çš„æŠ¥æ–‡æ®µå·²ç»å¾—åˆ°æ¥å—ç«¯ç¡®è®¤ä¹‹åï¼Œé‚£éƒ¨åˆ†æ•°æ®å°±ä¼šè¢«ç§»é™¤å‘é€çª—å£ï¼Œåœ¨å‘é€çª—å£å¤§å°ä¸å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå‘é€çª—å£å‘å³â¡ï¸ç§»åŠ¨5ä¸ªå­—èŠ‚ï¼Œå› ä¸ºå·¦è¾¹å·²ç»å‘é€çš„5ä¸ªå­—èŠ‚å¾—åˆ°ç¡®è®¤ä¹‹åï¼Œè¢«ç§»é™¤å‘é€çª—å£ï¼› å¯ç”¨çª—å£å¦‚ä½•è®¡ç®— å†æ¬¡å¼•å‡ºä¸‰ä¸ªæ¦‚å¿µï¼š SND.WND SND æŒ‡çš„æ˜¯å‘é€ç«¯ï¼ŒWNDæŒ‡çš„æ˜¯windowï¼Œä¹Ÿå°±æ˜¯å‘é€ç«¯çª—å£çš„æ„æ€ SND.UNA UNA å°±æ˜¯un ACKçš„æ„æ€ï¼ŒæŒ‡çš„æ˜¯å·²ç»å‘é€ä½†æ˜¯æ²¡æœ‰æ²¡æœ‰ç¡®è®¤ å®ƒæŒ‡å‘çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„ SND.NXT NXT æ˜¯nextçš„ä½ç½®ï¼Œæ˜¯å‘é€æ–¹æ¥ä¸‹æ¥è¦å‘é€çš„ä½ç½®ï¼Œå®ƒæŒ‡å‘å¯ç”¨çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„ é‚£å°±å¾ˆå®¹æ˜“å¾—å‡ºå¯ç”¨çª—å£çš„å¤§å°äº†ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š Usable Window Size = SND.UNA + SND.WND - SND.NXT æ¥æ”¶ç«¯çª—å£ä¸Šé¢ä»‹ç»äº†å‘é€ç«¯çª—å£çš„ä¸€äº›æ¦‚å¿µï¼Œä¸‹é¢ğŸ‘‡æ˜¯æ¥æ”¶ç«¯çª—å£çš„å­¦ä¹ ï¼š å·²ç»æ¥æ”¶å¹¶ä¸”å·²ç»ç¡®è®¤ :28-31 å­—èŠ‚ è¿˜æœªæ¥æ”¶å¹¶ä¸”æ¥æ”¶ç«¯å¯ä»¥æ¥å—:32-51 å­—èŠ‚ è¿˜æœªæ¥æ”¶å¹¶ä¸”è¶…å‡ºæ¥æ”¶å¤„ç†èƒ½åŠ›:51-57 å­—èŠ‚ è¿™é‡Œå¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼š RCV.WND RCVæ˜¯æ¥æ”¶ç«¯çš„æ„æ€ï¼ŒWNDæ˜¯æ¥å—ç«¯çª—å£çš„å¤§å° RCV.NXT NXTè¡¨ç¤ºçš„æ˜¯æ¥å—ç«¯æ¥æ”¶çª—å£çš„å¼€å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ–¹æ¥ä¸‹æ¥å¤„ç†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼› RCV.WNDçš„å¤§å°æ¥å—ç«¯çš„å†…å­˜ä»¥åŠç¼“å†²åŒºå¤§å°æœ‰å…³ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ¥å—ç«¯çš„çª—å£å¤§å°å’Œå‘é€ç«¯å¤§å°å¤§è‡´ç›¸åŒï¼›æ¥å—ç«¯å¯æ¥æ”¶çš„æ•°æ®èƒ½åŠ›å¯ä»¥é€šè¿‡TCPé¦–éƒ¨çš„Windowå­—æ®µè®¾ç½®ï¼Œä½†æ˜¯æ¥å—ç«¯çš„å¤„ç†èƒ½åŠ›æ˜¯å¯èƒ½éšæ—¶å˜åŒ–çš„ï¼Œæ‰€ä»¥æ¥å—ç«¯å’ŒæœåŠ¡ç«¯çš„çª—å£å¤§å°å¤§è‡´æ˜¯ä¸€æ ·çš„ï¼› æµé‡æ§åˆ¶ä¸‹é¢ğŸ‘‡æ ¹æ®ä¸€ä¸ªä¾‹å­æ¥é˜è¿°æµé‡æ§åˆ¶ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚ä¸€ä¸ª260å­—èŠ‚çš„æ–‡ä»¶ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼Œæ¯”è¾ƒç¹çï¼š è¿™é‡Œå‡è®¾MSSå’Œçª—å£çš„å¤§å°ä¸å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶å®¢æˆ·ç«¯å’Œå‘é€ç«¯çŠ¶æ€å¦‚ä¸‹ï¼šã€ å®¢æˆ·ç«¯ ã€‘ï¼š å‘é€çª—å£é»˜è®¤360å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š200å­—èŠ‚ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€çª—å£è®¾å®š200å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š360å­—èŠ‚ Step1ï¼š å®¢æˆ·ç«¯å‘é€140å­—èŠ‚çš„æ•°æ®åˆ°æœåŠ¡ç«¯ ã€å®¢æˆ·ç«¯ã€‘å‘é€140å­—èŠ‚ï¼Œã€SND.NXTã€‘ä»1-&gt;141 ã€æœåŠ¡ç«¯ã€‘çŠ¶æ€ä¸å˜ï¼Œç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“çš„140å­—èŠ‚ Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ï¼Œå‘é€80å­—èŠ‚å“åº”ä»¥åŠACK ã€ å®¢æˆ·ç«¯ ã€‘å‘é€140å­—èŠ‚ä¹‹åç­‰å¾…ã€ æœåŠ¡ç«¯ ã€‘çš„ACK ã€ æœåŠ¡ç«¯ ã€‘å¯ç”¨çª—å£å³ç§»ï¼Œã€RCV.NXTã€‘ä»1-&gt;141ã€ æœåŠ¡ç«¯ ã€‘å‘é€80å­—èŠ‚æ•°æ®ï¼Œã€SND.NXTã€‘ä»241-&gt;321 Step3: å®¢æˆ·ç«¯æ¥æ”¶å“åº”ACKï¼Œå¹¶ä¸”å‘é€ACK ã€ å®¢æˆ·ç«¯ ã€‘å‘å‡ºçš„140å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»140å­—èŠ‚ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶80å­—èŠ‚æ•°æ®ï¼Œã€RCV.NXTã€‘å³ç§»80å­—èŠ‚ï¼Œä»241-&gt;321 Step4: æœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ï¼Œä½†æ˜¯280å­—èŠ‚è¶…å‡ºäº†å®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åˆ†æˆä¸¤éƒ¨åˆ†ä¼ è¾“ï¼Œå…ˆä¼ è¾“120å­—èŠ‚ï¼› ã€ æœåŠ¡ç«¯ ã€‘å‘é€120å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨120å­—èŠ‚ï¼Œä»321-&gt;441 Step5: å®¢æˆ·ç«¯æ¥æ”¶æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¹¶å‘é€ACK ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶120å­—èŠ‚ï¼Œã€RCV.NXTã€‘ä»321-&gt;441 Step6ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬äºŒæ­¥80å­—èŠ‚çš„ACK [ æœåŠ¡å™¨ ] 80å­—èŠ‚å¾—åˆ°ACK ã€SND.UNAã€‘ä»241-&gt;321 Step7: æœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬4æ­¥çš„ç¡®è®¤ ã€ æœåŠ¡ç«¯ ã€‘ä¹‹å‰å‘é€æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†çš„120å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»åŠ¨120ï¼Œä»321-&gt;441 Step8: æœåŠ¡ç«¯å‘é€æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„160å­—èŠ‚ ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€160å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601 Step9: å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†160å­—èŠ‚ï¼ŒåŒæ—¶å‘é€ACK ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶160å­—èŠ‚ï¼Œã€RCV.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601 Step10: æœåŠ¡ç«¯æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„ACK ã€ æœåŠ¡ç«¯ ã€‘å‘é€çš„160å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å‘å³ä¸€å®š160å­—èŠ‚ï¼Œä»441-&gt;601ï¼›è‡³æ­¤å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„å®Œæ•´çš„æ–‡ä»¶ï¼› ä¸Šé¢é€šè¿‡è¡¨æ ¼åˆ—ä¸¾æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¯ä¸ªçŠ¶æ€åœ¨æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œå¯ä»¥çœ‹å¦‚ä¸‹ç¤ºæ„å›¾è¾…åŠ©ç†è§£ï¼š å®¢æˆ·ç«¯äº¤äº’æµç¨‹ æœåŠ¡ç«¯äº¤äº’æµç¨‹ ä¸Šé¢ğŸ‘†æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ç»™åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£æ˜¯200å­—èŠ‚åœºæ™¯åŠ ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ•°æ®ä¼ è¾“ä¸äº¤äº’æµç¨‹ï¼Œé€šè¿‡è¿™ä¸ªæµç¨‹æ¥å­¦ä¹ æ»‘åŠ¨çª—å£çš„ç§»åŠ¨çŠ¶æ€å’Œæµé‡æ§åˆ¶çš„å¤§è‡´æµç¨‹ï¼› æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸Šé¢ğŸ‘†è®²è¿°çš„æ—¶å€™ï¼Œéƒ½æ˜¯å‡è®¾çª—å£å¤§å°æ˜¯ä¸å˜çš„ï¼Œè€Œå®é™…ä¸Šï¼Œå‘é€ç«¯å’Œæ¥å—ç«¯çš„æ»‘åŠ¨çª—å£çš„å­—èŠ‚æ•°éƒ½åƒå­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿç¼“å†²åŒºçš„ï¼Œæ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºå—æ“ä½œç³»ç»Ÿæ§åˆ¶ï¼Œå½“åº”ç”¨è¿›ç¨‹å¢åŠ æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…çš„å†…å­˜å‡å°‘ï¼Œç¼“å†²åŒºå‡å°‘ï¼Œåˆ†é…ç»™æ¯ä¸ªè¿æ¥çš„çª—å£å°±ä¼šå‹ç¼©ã€‚**è€Œä¸”æ»‘åŠ¨çª—å£çš„å¤§å°ä¹Ÿå—åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®é€Ÿåº¦æœ‰å…³**ï¼› åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©step1: å®¢æˆ·ç«¯å‘é€140å­—èŠ‚ å®¢æˆ·ç«¯å‘é€åˆ°140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£æ”¶ç¼©åˆ°220å­—èŠ‚ï¼Œå‘é€çª—å£ä¸å˜ Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ ä½†æ˜¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚ æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚ï¼Œä»æœ‰100å­—èŠ‚å ç”¨ç¼“å†²åŒºå¤§å°ï¼Œå¯¼è‡´æ¥å—çª—å£æ”¶ç¼©ï¼ŒæœåŠ¡ç«¯å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œåœ¨é¦–éƒ¨Windowå¸¦ä¸Šæ¥æ”¶çª—å£çš„å¤§å°260 Step3: å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå‘é€çª—å£æ”¶ç¼©åˆ°260 Step4: å®¢æˆ·ç«¯ç»§ç»­å‘é€180å­—èŠ‚æ•°æ® å®¢æˆ·ç«¯å‘é€180å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ80å­—èŠ‚ Step5: æœåŠ¡ç«¯æ¥æ”¶åˆ°180å­—èŠ‚ å‡è®¾åº”ç”¨ç¨‹åºä»ç„¶ä¸è¯»å–è¿™180å­—èŠ‚ï¼Œæœ€ç»ˆä¹Ÿå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å†æ¬¡æ”¶ç¼©180å­—èŠ‚ï¼Œä»…å‰©ä¸‹80å­—èŠ‚ï¼Œåœ¨å‘é€ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œè®¾ç½®é¦–éƒ¨window=80 Step6: å®¢æˆ·ç«¯æ”¶åˆ°80å­—èŠ‚çš„çª—å£æ—¶ï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º80å­—èŠ‚ï¼Œå¯ç”¨çª—å£ä¹Ÿæ˜¯80å­—èŠ‚ Step7: å®¢æˆ·ç«¯ä»ç„¶å‘é€80å­—èŠ‚åˆ°æœåŠ¡ç«¯ï¼Œæ­¤æ—¶å¯ç”¨çª—å£ä¸ºç©º Step8: æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ç»§ç»­ä¸è¯»åŒºè¿™80å­—èŠ‚çš„ç¼“å†²åŒºæ•°æ®ï¼Œæœ€ç»ˆå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å¤§å°ä¸º0ï¼Œä¸èƒ½å†æ¥æ”¶ä»»ä½•æ•°æ®ï¼ŒåŒæ—¶å‘é€ACKæŠ¥æ–‡ï¼› Step9ï¼šå®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º0ï¼Œè¿™ä¸ªçŠ¶æ€å«åšã€Œ çª—å£å…³é—­ ã€ çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ… Step1ï¼šå®¢æˆ·ç«¯æœåŠ¡ç«¯å¼€å§‹çš„çª—å£å¤§å°éƒ½æ˜¯360å­—èŠ‚ï¼Œå®¢æˆ·ç«¯å‘é€140å­—èŠ‚æ•°æ® å®¢æˆ·ç«¯å‘é€140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ220å­—èŠ‚ Step2ï¼šæœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹éª¤å¢ï¼Œè¿›ç¨‹ç¼“å­˜åŒºå¹³å‡åˆ†é…ï¼Œé€ æˆæœåŠ¡ç«¯æ¥æ”¶çª—å£å‡å°‘ï¼Œä»360å˜æˆ240å­—èŠ‚ï¼› å‡è®¾æ¥æ”¶äº†140å­—èŠ‚ä¹‹åï¼Œåº”ç”¨è¿›ç¨‹æ²¡æœ‰è¯»å–ï¼Œé‚£ä¸ªå¯ç”¨çª—å£è¿›ä¸€æ­¥å‹ç¼©ï¼Œå˜æˆ100å­—èŠ‚ï¼› Step3ï¼šå‡è®¾åŒä¸€ä¸ªè¿æ¥åœ¨æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯ç¡®è®¤ä¹‹åï¼Œåˆå‘é€äº†180ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ˆRetramissionï¼‰ å…ˆå‘é€äº†140å­—èŠ‚ï¼Œåå‘é€äº†180å­—èŠ‚ï¼Œéƒ½æ²¡æœ‰å¾—åˆ°ç¡®è®¤ï¼Œå®¢æˆ·ç«¯å¯ç”¨çª—å£å¤§å°å˜æˆ40å­—èŠ‚ Step4ï¼šæœåŠ¡ç«¯æ”¶åˆ°ä¸Šé¢ğŸ‘†ç¬¬ä¸‰æ­¥å‘é€çš„180å­—èŠ‚çš„æ•°æ®ï¼Œä½†æ˜¯æ¥å—çª—å£çš„å¤§å°åªæœ‰100å­—èŠ‚ï¼Œæ‰€ä»¥ä¸èƒ½æ¥æ”¶ æœåŠ¡ç«¯æ‹’ç»æ¥æ”¶180å­—èŠ‚ Step5ï¼šæ­¤æ—¶å®¢æˆ·ç«¯æ‰æ”¶åˆ°ä¹‹å‰140å­—èŠ‚çš„ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰çŸ¥é“æ¥æ”¶çª—å£å‘ç”Ÿäº†å˜åŒ– å®¢æˆ·ç«¯ç”±äºæ²¡æœ‰æ”¶åˆ°180å­—èŠ‚çš„ç¡®è®¤ï¼ŒåŠ å…¥å®¢æˆ·ç«¯æ­£åœ¨å‡†å¤‡å‘é€180å­—èŠ‚æ•°æ®ï¼Œå¾—åˆ°æ¥å—ç«¯çš„çª—å£å¤§å°æ˜¯100å­—èŠ‚ä¹‹åï¼Œé¡»å¼ºåˆ¶å°†å³ä¾§çª—å£å‘å·¦æ”¶ç¼©80å­—èŠ‚ï¼› çª—å£å…³é—­è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„ä¾‹å­éƒ½å‘ç”Ÿäº†ã€Œ çª—å£å…³é—­ ã€ çª—å£å…³é—­ï¼š å‘é€ç«¯çš„å‘é€çª—å£å˜æˆ0çš„çŠ¶æ€ï¼› ä¸Šé¢è®²çš„ä¸¤ç§æƒ…å†µä¸€èˆ¬ä¸ä¼šå‘ç”Ÿçš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸ä¼šæ—¢æ”¶ç¼©çª—å£ï¼ŒåŒæ—¶å‡å°‘è¿æ¥ç¼“å­˜ï¼›è€Œæ˜¯ä¸€èˆ¬å…ˆä½¿ç”¨çª—å£æ”¶ç¼©ç­–ç•¥ï¼Œä¹‹ååœ¨å‹ç¼©ç¼“å†²åŒºçš„æ–¹å¼æ¥è§„é¿ä»¥ä¸Šé—®é¢˜ï¼›å‘ç”Ÿçª—å£å…³é—­ä¹‹åï¼Œå‘é€ç«¯ä¸ä¼šè¢«åŠ¨çš„ç­‰å¾…æœåŠ¡ç«¯çš„é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šé‡‡ç”¨å®šæ—¶å—…æ¢çš„æ–¹å¼å»æŸ¥çœ‹æœåŠ¡ç«¯æ¥æ”¶çª—å£æ˜¯å¦å¼€æ”¾ï¼› Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼ net.ipv4.tcp_rmem = 4096 87380 6291456 è¯»ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›– net.core.rmem_max net.ipv4.tcp_wmem = 4096 16384 4194304 å†™ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›–net.core.wmem_max net.ipv4.tcp_mem = 1541646 2055528 3083292 ç³»ç»Ÿæ— å†…å­˜å‹åŠ›ã€å¯åŠ¨å‹åŠ›æ¨¡å¼é˜€å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½ä¸ºé¡µçš„æ•°é‡ net.ipv4.tcp_moderate_rcvbuf = 1 å¼€å¯è‡ªåŠ¨è°ƒæ•´ç¼“å­˜æ¨¡å¼","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-RTOé‡ä¼ è®¡æ•°å™¨çš„è®¡ç®—","date":"2021-07-04T08:32:27.000Z","path":"wiki/TCP-RTOé‡ä¼ è®¡æ•°å™¨çš„è®¡ç®—/","text":"ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»äº†TCPè¶…æ—¶é‡ä¼ çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å®šæ—¶å™¨çš„ç­–ç•¥ï¼Œå½“å®šæ—¶å™¨è§„å®šæ—¶é—´å†…æœªæ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå°±ä¼šè§¦å‘æŠ¥æ–‡çš„é‡ä¼ ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼›é‚£ä¹ˆå®šæ—¶å™¨è¶…æ—¶æ—¶é—´ï¼ˆRTO Retramission Timeoutï¼‰æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯RTTï¼Ÿäº†è§£RTOå¦‚ä½•è®¡ç®—ä¹‹å‰ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µã€Œ RTT ã€ï¼› å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»clientå‘é€ç¬¬ä¸€ä¸ªã€ŒSYNã€æŠ¥æ–‡ï¼Œåˆ°Serveræ¥å—åˆ°æŠ¥æ–‡ï¼Œå¹¶ä¸”è¿”å›ã€ŒSYN ACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ¥å—åˆ°Serverçš„ã€ŒACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ‰€ç»å†çš„æ—¶é—´ï¼Œå«åš1ä¸ªRTTæ—¶é—´ï¼› å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ å¦‚ä¸Šå›¾ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§ï¼Œå·¦ä¾§aå›¾æ‰€ç¤ºï¼Œå½“ä¸€ç«¯å‘é€çš„æ•°æ®æŠ¥ä¸¢å¤±åè¦è¿›è¡Œé‡ä¼ ï¼Œåˆ°é‡ä¼ ä¹‹åæ¥æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿™ç§åœºæ™¯ä¸‹è¯¥å¦‚ä½•è®¡ç®—RTTå‘¢ï¼Ÿå¼€å§‹æ—¶é—´æ˜¯æŒ‰ç…§ç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ—¶é—´å‘¢è¿˜æ˜¯æŒ‰ç…§é‡ä¼ æ•°æ®æŠ¥çš„æ—¶é—´å‘¢ï¼Ÿ æŒ‰ç…§å¸¸ç†æ¥è¯´ï¼Œå¦‚å³ä¾§bå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT2ä¸ºå‡†ï¼› ç¬¬äºŒç§ï¼Œå·¦ä¾§bå›¾æ‰€ç¤ºï¼Œç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ–‡æ—¶ï¼Œç”±äºç½‘ç»œæ—¶å»¶å¯¼è‡´RTOæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ®µçš„ç¡®è®¤æŠ¥æ–‡ï¼Œå‘é€ç«¯è¿›è¡Œé‡å‘ï¼Œä½†æ˜¯åœ¨åˆšåˆšé‡å‘ä¹‹åå°±æ”¶åˆ°äº†ç¬¬ä¸€æ¬¡æŠ¥æ–‡çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£è¿™ç§æƒ…å†µRTTè¯¥å¦‚ä½•è®¡ç®—å‘¢ï¼Ÿ å¦‚å³ä¾§aå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT1ä¸ºå‡†ï¼› å°±åƒä¸Šé¢æåŠçš„ä¸¤ç§æƒ…å†µï¼Œä¸€ä¼šä»¥ç¬¬ä¸€ä¸ªRTT1ä¸ºå‡†ï¼Œä¸€ä¼šä»¥RTT2ä¸ºå‡†ï¼Œé‚£ä¹ˆTCPåè®®å¦‚ä½•æ­£ç¡®çš„è®¡ç®—å‡ºRTTå‘¢ï¼Ÿ ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTTä¹‹å‰çš„æ–‡ç« ä¸­åœ¨ä»‹ç»TCPè¶…æ—¶ä¸é‡ä¼ çš„ç¬”è®°ä¸­æœ‰ä»‹ç»é€šè¿‡ä½¿ç”¨Timtstampçš„æ–¹å¼æ¥åŒºåˆ†ç›¸åŒSeqåºåˆ—å·çš„ä¸åŒæŠ¥æ–‡ï¼Œå…¶å®åœ¨TCPæŠ¥æ–‡é¦–éƒ¨å­˜å‚¨Timestampçš„æ—¶å€™ï¼Œä¼šå­˜å‚¨æŠ¥æ–‡çš„å‘é€æ—¶é—´å’Œç¡®è®¤æ—¶é—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚ä½•è®¡ç®—RTOï¼Ÿä¸Šé¢ğŸ‘†è¯´åˆ°äº†RTTå¦‚ä½•è®¡ç®—ï¼Œé‚£ä¸ªRTOå’ŒRTTæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ RTOçš„å–å€¼å°†ä¼šå½±å“åˆ°TCPçš„ä¼ è¾“æ•ˆç‡ä»¥åŠç½‘ç»œçš„ååé‡ï¼› é€šå¸¸æ¥è¯´RTOåº”è¯¥ç•¥å¤§äºRTTï¼Œå¦‚æœRTOå°äºRTTï¼Œåˆ™ä¼šé€ æˆå‘é€ç«¯é¢‘ç¹é‡å‘ï¼Œå¯èƒ½ä¼šé€ æˆç½‘ç»œé˜»å¡ï¼›å¦‚æœRTOè®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™æ¥å—ç«¯å·²ç»æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸èƒ½å‘é€å…¶ä»–æŠ¥æ–‡ï¼Œä¼šé€ æˆä¸¤ç«¯æ€§èƒ½çš„æµªè´¹å’Œç½‘ç»œååé‡çš„ä¸‹é™ï¼› å¹³æ»‘RTOç½‘ç»œçš„RTTæ˜¯ä¸æ–­çš„å˜åŒ–çš„ï¼Œæ‰€ä»¥è®¡ç®—RTOçš„æ—¶å€™ï¼Œåº”å½“è€ƒè™‘RTOçš„å¹³æ»‘æ€§ï¼Œå°½é‡é¿å…RTTæ³¢åŠ¨å¸¦æ¥çš„å¹²æ‰°ï¼Œä»¥æŠµæŒ¡ç¬æ—¶å˜åŒ–ï¼› å¹³æ»‘RTOåœ¨æ–‡æ¡£RFC793å®šä¹‰ï¼Œç»™å‡ºå¦‚ä¸‹è®¡ç®—æ–¹å¼ï¼š SRTT (smoothed round-trip time) = ( Î± * SRTT ) + ((1 - Î±) * RTT) Î± ä» 0åˆ° 1(RFC æ¨è 0.9)ï¼Œè¶Šå¤§è¶Šå¹³æ»‘ RTO = min[ UBOUND, max[ LBOUND, (Î² * SRTT) ] ] å¦‚ UBOUNDä¸º1åˆ†é’Ÿï¼ŒLBOUNDä¸º 1 ç§’é’Ÿï¼Œ Î²ä» 1.3 åˆ° 2 ä¹‹é—´ è¿™ç§è®¡ç®—æ–¹å¼ä¸é€‚ç”¨äº RTT æ³¢åŠ¨å¤§(æ–¹å·®å¤§)çš„åœºæ™¯,å¦‚æœç½‘ç»œçš„RTTæ³¢åŠ¨å¾ˆå¤§ï¼Œä¼šé€ æˆRTOè°ƒæ•´ä¸åŠæ—¶ï¼› è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO RFC6298(RFC2988)ï¼Œå…¶ä¸­Î± = 1/8ï¼Œ Î² = 1/4ï¼ŒK = 4ï¼ŒG ä¸ºæœ€å°æ—¶é—´é¢—ç²’: é¦–æ¬¡è®¡ç®— RTOï¼ŒRä¸ºç¬¬ 1 æ¬¡æµ‹é‡å‡ºçš„ RTT123SRTT(smoothed round-trip time) = RRTTVAR(round-trip time variation) = R/2RTO = SRTT + max (G, K*RTTVAR) åç»­è®¡ç®— RTOï¼ŒRâ€™ä¸ºæœ€æ–°æµ‹é‡å‡ºçš„ RTT123SRTT= (1-Î±)*SRTT+Î±*Râ€™RTTVAR=(1-Î²)*RTTVAR+Î²*|SRTT-Râ€™|RTO = SRTT + max (G, K*RTTVAR)","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPè¶…æ—¶ä¸é‡ä¼ ","date":"2021-07-04T08:32:08.000Z","path":"wiki/TCPè¶…æ—¶ä¸é‡ä¼ /","text":"èƒŒæ™¯ å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼Œè®¾å¤‡Aå‘è®¾å¤‡Bå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åœ¨ç½‘ç»œä¸­ä¼šç”±äºå„ç§å„æ ·çš„é—®é¢˜å¯¼è‡´ä¸¢å¤±ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿ é‡‡ç”¨å®šæ—¶å™¨é‡ä¼  PARï¼šPositive Acknowledgment with Retransmission æœ€ç®€å•çš„æ€è·¯æ˜¯åœ¨å‘é€æ–¹è®¾ç½®ã€Œ å®šæ—¶å™¨ ã€ï¼š å½“è®¾å¤‡Aå‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹åï¼Œåœ¨å®šæ—¶å™¨è§„å®šçš„æ—¶é—´å†…ï¼Œå¦‚æœæ”¶åˆ°è®¾å¤‡Bçš„ç¡®è®¤æŠ¥æ–‡ï¼Œåˆ™è®¾å¤‡Aç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼› å¦‚æœç¬¬ä¸€æ¡æ¶ˆæ¯å‘é€æ—¶é—´è¶…å‡ºäº†å®šæ—¶å™¨è§„å®šçš„æ—¶é—´ï¼Œåˆ™è®¾å¤‡Aå°†é‡æ–°å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ŒåŒæ—¶é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼› è¿™ç§æ–¹å¼æ˜¯ä¸²å‹å‘é€çš„ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸä¹‹åï¼Œæ‰å¯ä»¥å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œã€Œ æ•ˆç‡æå·® ã€ï¼› å¹¶å‘èƒ½åŠ›PAR åŸºäºä¸Šè¿°PARæ•ˆç‡ä½ä¸‹çš„æ–¹å¼è¿›è¡Œæ”¹é€ ï¼Œåœ¨å‘é€ç«¯é‡‡ç”¨å¹¶å‘+å®šæ—¶å™¨çš„æ–¹å¼è¿›è¡Œæ•°æ®å‘é€ï¼› é¦–å…ˆè®¾å¤‡Aå¯ä»¥åŒæ—¶å‘é€å¤šä¸ªæ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µå…·æœ‰ä¸€ä¸ªæ ‡å¿—å­—æ®µã€#XXã€‘å»æ ‡å¿—å”¯ä¸€ï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µè¿æ¥å…·æœ‰è‡ªå·±çš„å®šæ—¶å™¨ï¼› è®¾å¤‡Bè§„å®šæ—¶é—´å†…æ”¶åˆ°è®¾å¤‡Aå‘é€çš„æ•°æ®ä¹‹åå¹¶ä¸”è®¾å¤‡Aå¾—åˆ°è®¾å¤‡Bçš„ç¡®è®¤ä¹‹åï¼Œè®¾å¤‡Aå°†å®šæ—¶å™¨æ¸…é™¤ åŒPARä¸€æ ·ï¼Œè®¾å¤‡Bæ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å‘é€ç¡®è®¤æŠ¥æ–‡ï¼Œè®¾å¤‡Aå°†è¿™ä¸ªæŠ¥æ–‡æ‰€å¯¹åº”çš„å®šæ—¶å™¨å¤ä½ï¼Œé‡æ–°å‘é€è¿™ä¸ªæŠ¥æ–‡ å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜é‡‡ç”¨å¹¶å‘çš„æ–¹å¼å‘é€æ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µå›ºç„¶æå‡äº†å‘é€ç«¯çš„æ€§èƒ½ï¼Œä½†æ˜¯å‘é€ç«¯å‘é€çš„æ¶ˆæ¯å¯èƒ½æ¥å—ç«¯ä¸èƒ½å®Œå…¨å¤„ç†ï¼Œè¿™æ˜¯åŒæ–¹æŠ¥æ–‡å¤„ç†é€Ÿåº¦æˆ–è€…æ•ˆç‡ä¸ä¸€è‡´çš„é—®é¢˜ï¼› æ‰€ä»¥å¯¹äºæ¥æ”¶ç«¯è®¾å¤‡Bï¼Œåº”è¯¥æ˜ç¡®è‡ªå·±å¯èƒ½æ¥å—çš„æ•°æ®é‡ï¼Œå¹¶ä¸”åœ¨ç¡®è®¤æŠ¥æ–‡ä¸­åŒæ­¥åˆ°å‘é€ç«¯è®¾å¤‡Aï¼Œè®¾å¤‡Aæ ¹æ®è®¾å¤‡Bçš„å¤„ç†èƒ½åŠ›æ¥è°ƒæ•´å‘é€æ•°æ®çš„å¤§å°ï¼›ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„ã€Œ limitã€ï¼› ç»§ç»­å»¶ä¼¸Sequmentåºåˆ—å·å’ŒAckåºåˆ—å·çš„è®¾è®¡ç†å¿µæˆ–è€…è®¾è®¡åˆè¡·æ˜¯ã€Œ è§£å†³åº”ç”¨å±‚å­—èŠ‚æµçš„å¯é å‘é€ ã€ è·Ÿè¸ªã€Œåº”ç”¨å±‚ã€çš„å‘é€ç«¯æ•°æ®æ˜¯å¦é€è¾¾ ç¡®å®šã€Œæ¥æ”¶ç«¯æœ‰åºçš„ã€æ¥æ”¶åˆ°ã€Œå­—èŠ‚æµã€ åºåˆ—å·çš„å€¼é’ˆå¯¹çš„æ˜¯å­—èŠ‚è€Œä¸æ˜¯æŠ¥æ–‡ âš ï¸âš ï¸âš ï¸ TCPçš„å®šä½å°±æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„ é€šè¿‡TCPæŠ¥æ–‡å¤´æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒSequmentåºåˆ—å·åŒ…æ‹¬32ä½é•¿åº¦ï¼›ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªSequmentå¯ä»¥å‘é€2çš„32æ¬¡æ–¹ä¸ªå­—èŠ‚ï¼Œå¤§çº¦4Gçš„æ•°é‡ï¼ŒSequmentå°±æ— æ³•è¡¨ç¤ºäº†ï¼Œå½“ä¼ è¾“çš„æ•°æ®è¶…è¿‡â€œ4Gâ€ä¹‹åï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¾ç„¶è¦ä½¿ç”¨çš„è¯ï¼ŒSequmentä¼šé‡æ–°å¤ç”¨ï¼›Sequmentå¤ç”¨ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åºåˆ—å·å›ç»•ï¼›ğŸ‘‡ åºåˆ—å·å›ç»• åºåˆ—å·å›ç»• (Protect Against Wrapped Sequence numbers) å½“ä¸€ä¸ªè¿æ¥è¦å‘é€6Gçš„æ•°æ®æ˜¯ï¼ŒAã€Bã€Cã€Dåˆ†åˆ«å‘é€1Gçš„æ•°æ®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨æ­¤è¿æ¥ï¼ŒEä¸‹ä¸€æ¬¡å‘é€æ•°æ®1Gï¼ŒSeqåºåˆ—å·å¤ç”¨ï¼ŒEæŠ¥æ–‡æ®µçš„åºåˆ—å·å’ŒAæŠ¥æ–‡æ®µçš„åºåˆ—å·è¡¨ç¤ºç›¸åŒ æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ç»§ç»­å‘é€æ•°æ®ï¼ŒFæŠ¥æ–‡æ®µçš„Seqæ ‡å¿—å’ŒBæŠ¥æ–‡æ®µçš„æ˜¯ä¸€æ ·çš„ï¼› åŠ å…¥BæŠ¥æ–‡æ®µåœ¨å‘é€è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ï¼Œç›´åˆ°æ¥å—ç«¯æ¥æ”¶äº†FæŠ¥æ–‡æ®µçš„åŒæ—¶BæŠ¥æ–‡æ®µåˆ°è¾¾æ¥å—ç«¯ï¼Œæ¥å—ç«¯è¯¥å¦‚ä½•åŒºåˆ†ç›¸åŒSeqåºåˆ—å·ä¸åŒæ•°æ®çš„æŠ¥æ–‡æ®µå‘¢ï¼Ÿ å…¶å®TCPè§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªæŠ¥æ–‡æ®µä¸Šæ·»åŠ Tcp Timestampæ—¶é—´æˆ³ï¼Œç±»ä¼¼äºç‰ˆæœ¬å·çš„ç†å¿µï¼› æ¥æ”¶ç«¯æ”¶åˆ°ç›¸åŒSeqåºåˆ—å·çš„æŠ¥æ–‡æ®µæ˜¯å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ¥è¿›è¡ŒåŒºåˆ†ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰","date":"2021-07-04T08:31:56.000Z","path":"wiki/TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰/","text":"MSSäº§ç”Ÿçš„èƒŒæ™¯æˆ‘ä»¬éƒ½çŸ¥é“TCPåè®®æ˜¯è¿è¾“åœ¨ä¼ è¾“å±‚çš„åè®®ï¼Œå®ƒæ˜¯é¢å‘ã€å­—èŠ‚æµã€‘çš„ä¼ è¾“åè®®ï¼›å®ƒçš„ä¸Šå±‚ï¼Œåº”ç”¨å±‚ä¼ è¾“çš„æ•°æ®æ˜¯æ— é™åˆ¶çš„ï¼Œä½†æ˜¯å®ƒçš„ä¸‹å±‚ä¹Ÿå°±æ˜¯ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ç”±äºè·¯ç”±ç­‰è½¬å‘è®¾å¤‡æœ‰å†…å­˜ç­‰é™åˆ¶æ˜¯ä¸å¯èƒ½æ— é™åˆ¶ä¼ è¾“ä»»ä½•å¤§å°çš„æŠ¥æ–‡çš„ï¼Œå®ƒä»¬ä¸€å®šä¼šé™åˆ¶æŠ¥æ–‡çš„é•¿åº¦ï¼Œå› æ­¤ TCPåè®®è¦å®Œæˆçš„å·¥ä½œæ˜¯å°†ä»åº”ç”¨å±‚æ¥å—åˆ°çš„ä»»æ„é•¿åº¦æ•°æ®ï¼Œåˆ‡å‰²æˆå¤šä¸ªæŠ¥æ–‡æ®µï¼ŒMSSå°±æ˜¯å¦‚ä½•åˆ‡å‰²æŠ¥æ–‡æ®µçš„ä¾æ®ã€‚ ä»€ä¹ˆæ˜¯MSSMSSï¼ˆMax Segment Sizeï¼‰ï¼šä»…æŒ‡ TCP æ‰¿è½½æ•°æ®ï¼Œä¸åŒ…å« TCP å¤´éƒ¨çš„å¤§å°ï¼Œå‚è§ RFC879 MSS é€‰æ‹©ç›®çš„ å°½é‡æ¯ä¸ª Segment æŠ¥æ–‡æ®µæºå¸¦æ›´å¤šçš„æ•°æ®ï¼Œä»¥å‡å°‘å¤´éƒ¨ç©ºé—´å ç”¨æ¯”ç‡ é˜²æ­¢ Segment è¢«æŸä¸ªè®¾å¤‡çš„ IP å±‚åŸºäº MTU æ‹†åˆ† IPå±‚åŸºäºMTUçš„æ•°æ®æ‹†åˆ†æ˜¯æ•ˆç‡æå·®çš„ï¼Œä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œæ‰€æœ‰çš„æŠ¥æ–‡æ®µéƒ½è¦é‡ä¼  MSSé»˜è®¤å¤§å° é»˜è®¤ MSS:536 å­—èŠ‚(é»˜è®¤ MTU576 å­—èŠ‚ï¼Œ20 å­—èŠ‚ IP å¤´éƒ¨ï¼Œ20 å­—èŠ‚ TCP å¤´éƒ¨) MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ æ¡æ‰‹é˜¶æ®µåå•† MSS è¿™ä¸ªåœ¨TCPä¸‰æ¬¡æ¡æ‰‹çš„æ–‡ç« ä¸­å·²ç»æåŠè¿‡äº†ï¼ MSS åˆ†ç±» å‘é€æ–¹æœ€å¤§æŠ¥æ–‡æ®µ: SMSS:SENDER MAXIMUM SEGMENT SIZE æ¥æ”¶æ–¹æœ€å¤§æŠ¥æ–‡æ®µ: RMSS:RECEIVER MAXIMUM SEGMENT SIZE åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹ TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå·¦è¾¹å®¢æˆ·ç«¯åœ¨å‘é€å­—èŠ‚æµæ•°æ®ç»™åˆ°å³è¾¹å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚æµï¼Œä¼šåœ¨TCPå±‚æŒ‰ç…§MSSå¤§å°è§„å®šè¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªå°çš„æŠ¥æ–‡æ®µï¼Œåˆ†åˆ«ä¼ é€åˆ°å¦ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–è€…å…¶ä»–çš„æ¥æ”¶ç«¯ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPä¸‰æ¬¡æ¡æ‰‹","date":"2021-07-04T08:31:42.000Z","path":"wiki/TCPä¸‰æ¬¡æ¡æ‰‹/","text":"æ¡æ‰‹ğŸ¤çš„ç›®çš„ åŒæ­¥Sequenceåºåˆ—å· åˆå§‹åŒ–åºåˆ—å·ISN ï¼ˆInital Sequence Numberï¼‰ äº¤æ¢TCPé€šè®¯çš„å‚æ•° æ¯”å¦‚æœ€å¤§æŠ¥æ–‡æ®µå‚æ•°ï¼ˆMSSï¼‰ã€çª—å£æ¯”ä¾‹å› å­ï¼ˆWindowï¼‰ã€é€‰æ‹©æ€§ç¡®è®¤ï¼ˆSACKï¼‰ã€åˆ¶å®šæ ¡éªŒå’Œç®—æ³•ï¼› ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹ TCPä¸‰æ¬¡æ¡æ‰‹çš„å¤§è‡´æµç¨‹å›¾å¦‚ä¸ŠğŸ‘† ä½¿ç”¨tcpdumpæŠ“åŒ…åˆ†æä¸‰æ¬¡ğŸ¤æ¡æ‰‹æŠ¥æ–‡ä¸­Seqå’ŒAckçš„å˜åŒ– 1tcpdump port 80 -c 3 -S ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤1IP upay.60734 &gt; 100.100.15.23.http: Flags [S], seq 3800409106, win 29200, options [mss 1460,sackOK,TS val 839851765 ecr 0,nop,wscale 7], length 0 å®¢æˆ·ç«¯upayè®¿é—®æœåŠ¡ç«¯80ç«¯å£ï¼Œå‘é€ä¸€ä¸ªã€Œ seq=3800409106 ã€ ï¼ŒåŒæ—¶æ ‡å¿—ä½SYN=1ï¼Œå£°æ˜æ­¤æ¬¡æ¡æ‰‹æ˜¯è¦å»ºç«‹è¿æ¥ï¼› ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤1IP 100.100.15.23.http &gt; upay.60734: Flags [S.], seq 1981710286, ack 3800409107, win 14600, options [mss 1440,nop,nop,sackOK,nop,wscale 7], length 0 ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç”³è¯·è¿æ¥å¼ºæ±‚ï¼ˆSYN=1ï¼‰ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯è‡ªå·±å‡†å¤‡å¥½çš„æƒ…å†µä¸‹ï¼Œç»™å®¢æˆ·ç«¯å‘é€ ã€Œ ACK=1 SYN=1 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1åŒæ ·ä¹Ÿæ˜¯å£°æ˜æ­¤æ¬¡æŠ¥æ–‡æ˜¯å»ºç«‹è¿æ¥çš„æŠ¥æ–‡è¯·æ±‚ï¼› ack= 3800409107 ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å‘ç»™æœåŠ¡ç«¯çš„seq+1ï¼ˆackæ˜¯æ¥æ”¶æ–¹ä¸‹æ¬¡æœŸæœ›æ¥å£æŠ¥æ–‡çš„å¼€å§‹ä½ç½®ï¼‰ ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹1IP upay.60734 &gt; 100.100.15.23.http: Flags [.], ack 1981710287, win 229, length 0 å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ç¡®è®¤æŠ¥æ–‡ï¼Œç¡®è®¤å¯ä»¥è¿›è¡Œè¿æ¥ï¼Œå‘é€ã€Œ ack = 1981710287 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¹‹åå°±å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCPçš„è¿æ¥å°±åˆ›å»ºæˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥åŒæ–¹å°±å¯ä»¥å‘é€æ•°æ®æŠ¥äº†ï¼› TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´ é¦–å…ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ã€CLOSEDã€‘çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ä¹‹åï¼Œè¿›å…¥ã€SYN-SENTã€‘çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç»´æŒçš„æ—¶é—´å¾ˆçŸ­ï¼Œæˆ‘ä»¬ä½¿ç”¨netstatå»æŸ¥çœ‹tcpè¿æ¥çŠ¶æ€çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸ä¼šçœ‹åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œè€ŒæœåŠ¡ç«¯æ˜¯åœ¨ã€LISTENã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼› æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒSYN ACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶æœåŠ¡ç«¯è¿›å…¥ã€SYN-RECEIVEDã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡ï¼› å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„åŒæ­¥ç¡®è®¤è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œå‡†å¤‡åç»­çš„æ•°æ®ä¼ è¾“ï¼› æœåŠ¡ç«¯æ”¶åˆ°ä¸‰æ¬¡æ¡æ‰‹æœ€åçš„ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªTCPè¿æ¥ç®—æ˜¯å»ºç«‹å®Œæˆäº†ï¼Œåé¢å°±æ˜¯åŒæ–¹çš„é€šä¿¡äº†ï¼› TCBï¼ˆTransmission Control Blockï¼‰ ä¿å­˜è¿æ¥ä½¿ç”¨çš„æºç«¯å£ã€ç›®çš„ç«¯å£ã€ç›®çš„ ipã€åºå·ã€ åº”ç­”åºå·ã€å¯¹æ–¹çª—å£å¤§å°ã€å·±æ–¹çª—å£å¤§å°ã€tcp çŠ¶æ€ã€tcp è¾“å…¥/è¾“å‡ºé˜Ÿåˆ—ã€åº”ç”¨å±‚è¾“å‡ºé˜Ÿ åˆ—ã€tcp çš„é‡ä¼ æœ‰å…³å˜é‡ç­‰ TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜ æ­£å¦‚æˆ‘ä»¬äº†è§£çš„TCPä¸‰æ¬¡æ¡æ‰‹ğŸ¤çš„æµç¨‹ï¼Œå½“æœ‰å¤§é‡SYNè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯æ—¶ï¼Œä¼šè¿›å…¥åˆ°ã€SYNé˜Ÿåˆ—ã€‘ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¬¬äºŒæ¬¡ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œä¼šè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¼šå°†è¿æ¥æ”¾å…¥åˆ°ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­ï¼Œå½“Nginxæˆ–è€…Tomcatè¿™äº›åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨acceptï¼ˆè®¿é—®å†…æ ¸ï¼‰çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥è¿›è¡Œå¤„ç†ï¼› ç”±æ­¤å¯è§ï¼Œã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘æ˜¯ä¼šå½±å“æœåŠ¡å™¨è¿æ¥æ€§èƒ½çš„é‡è¦å› ç´ ï¼Œæ‰€ä»¥å¯¹äºé«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—ä¸€å®šæ˜¯è¦è®¾ç½®çš„æ¯”è¾ƒå¤§çš„ï¼› å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°æœåŠ¡å™¨ç«¯ SYN_RCV çŠ¶æ€ net.ipv4.tcp_max_syn_backlog:SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•° net.ipv4.tcp_synack_retries:è¢«åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘SYN/ACKçš„é‡è¯•æ¬¡æ•° å®¢æˆ·ç«¯ SYN_SENT çŠ¶æ€ï¼ˆæœåŠ¡ç«¯ä½œä¸ºå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚Ngnixè½¬å‘ç­‰ï¼‰ net.ipv4.tcp_syn_retries = 6 ä¸»åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘ SYN çš„é‡è¯•æ¬¡æ•° net.ipv4.ip_local_port_range = 32768 60999 å»ºç«‹è¿æ¥æ—¶çš„æœ¬åœ°ç«¯å£å¯ç”¨èŒƒå›´ Fast Openæœºåˆ¶ TCPå¦‚ä½•å¯¹è¿æ¥çš„æ¬¡æ•°ä»¥åŠè¿æ¥æ—¶é—´è¿›è¡Œä¼˜åŒ–çš„å‘¢ï¼Ÿè¿™é‡Œæåˆ°Fast Openæœºåˆ¶ï¼›æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªHttp Getè¯·æ±‚ï¼Œæ­£å¸¸çš„ä¸‰æ¬¡æ¡æ‰‹ğŸ¤åˆ°æ”¶åˆ°æœåŠ¡ç«¯æ•°æ®éœ€è¦2ä¸ªRTTçš„æ—¶é—´ï¼›FastOpenåšå‡ºå¦‚ä¸‹ä¼˜åŒ–ï¼š ç¬¬ä¸€æ¬¡åˆ›å»ºè¿æ¥çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è¦ç»å†2ä¸ªRTTæ—¶é—´ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯å‘é€ç¡®è®¤æŠ¥æ–‡çš„æ—¶å€™ï¼Œåœ¨æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªcookieï¼› ç­‰åˆ°ä¸‹æ¬¡å®¢æˆ·ç«¯å†éœ€è¦åˆ›å»ºè¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥å°†ã€SYNã€‘å’Œcookieä¸€å¹¶å¸¦ä¸Šï¼Œå¯ä»¥ä¸€æ¬¡å°±åˆ›å»ºè¿æ¥ï¼Œç»è¿‡ä¸€ä¸ªRTTå®¢æˆ·ç«¯å°±å¯ä»¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ•°æ®ï¼› å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP Fast Open net.ipv4.tcp_fastopen:ç³»ç»Ÿå¼€å¯ TFO åŠŸèƒ½ 0:å…³é—­ 1:ä½œä¸ºå®¢æˆ·ç«¯æ—¶å¯ä»¥ä½¿ç”¨ TFO 2:ä½œä¸ºæœåŠ¡å™¨æ—¶å¯ä»¥ä½¿ç”¨ TFO 3:æ— è®ºä½œä¸ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ TFO SYNæ”»å‡»ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ æ­£å¸¸çš„æœåŠ¡é€šè®¯éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„è¯·æ±‚æŠ¥æ–‡æ¥åˆ›å»ºè¿æ¥çš„ï¼Œä½†æ˜¯ï¼Œå¯ä»¥äººä¸ºä¼ªé€ å¤§é‡ä¸åŒIPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ğŸ‘†çŠ¶æ€å˜æ›´å›¾ä¸­çš„SYNè¯·æ±‚ï¼Œä½†æ˜¯æ”¶åˆ°æœåŠ¡ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œå´ä¸å‘é€å¯¹äºæœåŠ¡ç«¯çš„ACKè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡å¤„äºã€SYN-RECEIVEDã€‘çŠ¶æ€çš„TCPè¿æ¥å ç”¨å¤§é‡æœåŠ¡ç«¯èµ„æºï¼Œå¯¼è‡´æ­£å¸¸çš„è¿æ¥æ— æ³•åˆ›å»ºï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿå´©åï¼› SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹1netstat -nap | grep SYN_RECV å¦‚æœå­˜åœ¨å¤§é‡ã€SYN-RECEIVEDã€‘çš„è¿æ¥ï¼Œå°±æ˜¯å‘ç”ŸSYNæ”»å‡»äº†ï¼› å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ net.core.netdev_max_backlog æ¥æ”¶è‡ªç½‘å¡ã€ä½†æœªè¢«å†…æ ¸åè®®æ ˆå¤„ç†çš„æŠ¥æ–‡é˜Ÿåˆ—é•¿åº¦ net.ipv4.tcp_max_syn_backlog SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•° net.ipv4.tcp_abort_on_overflow è¶…å‡ºå¤„ç†èƒ½åŠ›æ—¶ï¼Œå¯¹æ–°æ¥çš„ SYN ç›´æ¥å›åŒ… RSTï¼Œä¸¢å¼ƒè¿æ¥ è®¾ç½®SYN Timeout ç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼=SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†è¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ã€‚ è®¾ç½®SYN Cookie (net.ipv4.tcp_syncookies = 1) å°±æ˜¯ç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œå¹¶è®°å½•åœ°å€ä¿¡æ¯ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚è¿™æ ·åšçš„ç»“æœä¹Ÿå¯èƒ½ä¼šå½±å“åˆ°æ­£å¸¸ç”¨æˆ·çš„è®¿é—®ã€‚ å½“ SYN é˜Ÿåˆ—æ»¡åï¼Œæ–°çš„ SYN ä¸è¿›å…¥é˜Ÿåˆ—ï¼Œè®¡ç®—å‡º cookie å† ä»¥ SYN+ACK ä¸­çš„åºåˆ—å·è¿”å›å®¢æˆ·ç«¯ï¼Œæ­£å¸¸å®¢æˆ·ç«¯å‘æŠ¥æ–‡æ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®æŠ¥æ–‡ä¸­æºå¸¦çš„ cookie é‡æ–°æ¢å¤è¿æ¥ ç”±äº cookie å ç”¨åºåˆ—å·ç©ºé—´ï¼Œå¯¼è‡´æ­¤æ—¶æ‰€æœ‰ TCP å¯é€‰ åŠŸèƒ½å¤±æ•ˆï¼Œä¾‹å¦‚æ‰©å……çª—å£ã€æ—¶é—´æˆ³ç­‰ TCP_DEFER_ACCEPTè¿™ä¸ªæ˜¯åšä»€ä¹ˆå‘¢ï¼Ÿ æ­£å¦‚ä¸Šé¢ğŸ‘†æ“ä½œç³»ç»Ÿå†…æ ¸å±•ç¤ºå›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¸­ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘é˜Ÿåˆ—ï¼Œåªæœ‰å½“æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œè¿æ¥ä¼šè¿›å…¥åˆ°ã€ACCEPTã€‘ï¼ŒåŒæ—¶æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šå»æ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼ŒçŸ¥é“æ”¶åˆ°çœŸæ­£çš„dataåˆ†ç»„ä¹‹åï¼Œæ‰ä¼šæ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸ºäº†æé«˜åº”ç”¨è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…åº”ç”¨è¿›ç¨‹çš„ç­‰å¾…ï¼› TCPä¸‰æ¬¡æ¡æ‰‹ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ å‚è§æ–‡ç« ï¼šæ•–ä¸™ç”¨è¿‘ 40 å¼ å›¾è§£è¢«é—®åƒç™¾éçš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPå¤´éƒ¨","date":"2021-07-04T08:31:22.000Z","path":"wiki/TCPå¤´éƒ¨/","text":"å¸¦ç€é—®é¢˜å­¦ä¹  å¦‚ä½•æ ¡éªŒæŠ¥æ–‡æ®µæ˜¯å¦æŸåï¼Ÿ å¦‚ä½•CRCæ ¡éªŒ seqå’Œackæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ tcpæ ¡éªŒä½éƒ½æœ‰é‚£äº›ï¼Ÿ 6ä¸ª åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ tcpå¦‚ä½•è®¡ç®—é¦–éƒ¨é•¿åº¦ï¼Ÿ åç§»é‡ TCP Retransmission é‡ä¼ ï¼Ÿ tcp spurious retransmission åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ tcp dup ack æ˜¯ä»€ä¹ˆï¼Ÿ ackä¸ACKæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ TCPå¤´éƒ¨ç»“æ„ å­¦ä¹ TCPåè®®é¦–å…ˆè¦çœ‹ä¸€ä¸‹å®ƒçš„æŠ¥æ–‡æ®µæ˜¯å¦‚ä½•ç»„æˆçš„ï¼›TCPæŠ¥æ–‡æ®µç»„æˆç”±ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ¥æ–‡å¤´éƒ¨ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ•°æ®éƒ¨åˆ†ï¼› å…ˆçœ‹ä¸€ä¸‹æŠ¥æ–‡å¤´ï¼Œä¹Ÿå°±æ˜¯TCPé¦–éƒ¨çš„ç»„æˆï¼› 16ä½ç«¯å£16ä½ç«¯å£å·ï¼šå‘ŠçŸ¥ä¸»æœºè¯¥æŠ¥æ–‡æ®µæ˜¯æ¥è‡ªå“ªé‡Œï¼ˆæºç«¯å£Source Portï¼‰ä»¥åŠä¼ ç»™å“ªä¸ªä¸Šå±‚åè®®æˆ–åº”ç”¨ç¨‹åºï¼ˆç›®çš„ç«¯å£Destination Portï¼‰çš„ã€‚è¿›è¡ŒTCPé€šä¿¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨çŸ¥åæœåŠ¡ç«¯å£å·ï¼ˆæ¯”å¦‚DNSåè®®å¯¹åº”ç«¯å£53ï¼ŒHTTPåè®®å¯¹åº”80ï¼Œè¿™äº›ç«¯å£å·å¯åœ¨/etc/servicesæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼‰ã€‚ åºåˆ—å·ï¼ˆSeqï¼‰å 32ä½ï¼Œä¹Ÿå°±æ˜¯4å­—èŠ‚é•¿åº¦ï¼Œåºå·èŒƒå›´è‡ªç„¶ä¹Ÿæ˜¯æ˜¯0~2^32-1ã€‚TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ŒTCPè¿æ¥ä¸­ä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ã€‚æ•´ä¸ªè¦ä¼ é€çš„å­—èŠ‚æµçš„èµ·å§‹åºå·å¿…é¡»è¦åœ¨è¿æ¥å»ºç«‹æ—¶è®¾ç½®ã€‚é¦–éƒ¨ä¸­çš„åºå·å­—æ®µå€¼æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ TCPç”¨åºåˆ—å·å¯¹æ•°æ®åŒ…è¿›è¡Œæ ‡è®°ï¼Œä»¥ä¾¿åœ¨åˆ°è¾¾ç›®çš„åœ°åé‡æ–°é‡è£…ï¼Œå‡è®¾å½“å‰çš„åºåˆ—å·ä¸º sï¼Œå‘é€æ•°æ®é•¿åº¦ä¸º lï¼Œåˆ™ä¸‹æ¬¡å‘é€æ•°æ®æ—¶çš„åºåˆ—å·ä¸º s + lã€‚åœ¨å»ºç«‹è¿æ¥æ—¶é€šå¸¸ç”±è®¡ç®—æœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºåºåˆ—å·çš„åˆå§‹å€¼ã€‚ **è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç–‘é—®ï¼Œç¬¬ä¸€æ¬¡å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ï¼Œç½‘ä¸Šä¸€äº›åšå®¢ä¸Šè¯´seqæ˜¯clientéšæœºç”Ÿæˆçš„ï¼Œä¹Ÿæœ‰çš„åšå®¢è¯´æ˜¯seq=1ï¼› è¿™é‡Œç»è¿‡æˆ‘æŠ“åŒ…åï¼Œçœ‹åˆ°ç¬¬ä¸€æ¬¡åˆ›å»ºTCPè¿æ¥çš„æ—¶å€™ï¼Œç¡®å®æ˜¯1; ** ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰Ackå 32ä½ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦ï¼Œè¡¨ç¤ºæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å€¼ã€‚ ç”¨ä½œå¯¹å¦ä¸€æ–¹å‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„å“åº”ã€‚å…¶å€¼æ˜¯æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚å‡è®¾ä¸»æœºAå’Œä¸»æœºBè¿›è¡ŒTCPé€šä¿¡ï¼Œé‚£ä¹ˆAå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¸ä»…æºå¸¦è‡ªå·±çš„åºå·ï¼Œè€Œä¸”åŒ…å«å¯¹Bå‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚åä¹‹ï¼ŒBå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¹ŸåŒæ—¶æºå¸¦è‡ªå·±çš„åºå·å’Œå¯¹Aå‘é€æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚TCPçš„å¯é æ€§ï¼Œæ˜¯å»ºç«‹åœ¨ã€Œæ¯ä¸€ä¸ªæ•°æ®æŠ¥æ–‡éƒ½éœ€è¦ç¡®è®¤æ”¶åˆ°ã€çš„åŸºç¡€ä¹‹ä¸Šçš„ã€‚ å°±æ˜¯è¯´ï¼Œé€šè®¯çš„ä»»ä½•ä¸€æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„ä¸€ä¸ªæŠ¥æ–‡ä¹‹åï¼Œéƒ½è¦å‘é€ä¸€ä¸ªç›¸å¯¹åº”çš„ã€Œç¡®è®¤æŠ¥æ–‡ã€ï¼Œæ¥è¡¨è¾¾ç¡®è®¤æ”¶åˆ°ã€‚ é‚£ä¹ˆï¼Œç¡®è®¤æŠ¥æ–‡ï¼Œå°±ä¼šåŒ…å«ç¡®è®¤å·ã€‚ è‹¥ç¡®è®¤å·=Nï¼Œåˆ™è¡¨æ˜ï¼šåˆ°åºå·N-1ä¸ºæ­¢çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚ æ•°æ®åç§» Offsetå  0.5 ä¸ªå­—èŠ‚ (4 ä½)ã€‚ è¿™ä¸ªå­—æ®µå®é™…ä¸Šæ˜¯æŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨é•¿åº¦ ï¼Œå®ƒæŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡çš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚ æ³¨æ„æ•°æ®èµ·å§‹å¤„å’ŒæŠ¥æ–‡èµ·å§‹å¤„çš„æ„æ€ï¼Œä¸Šé¢ğŸ‘†å·²ç»å†™åˆ°ï¼ŒTCPæŠ¥æ–‡æ®µçš„ç»„æˆæœ‰ä¸¤éƒ¨åˆ†ï¼ŒTCPæŠ¥æ–‡é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œåç§»é‡è®°å½•çš„æ˜¯æŠ¥æ–‡æ®µå¼€å§‹å’Œæ•°æ®å¼€å§‹çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æŠ¥æ–‡é¦–éƒ¨çš„é•¿åº¦ï¼› ä¸€ä¸ªæ•°æ®åç§»é‡ = 4 byteï¼Œç”±äº4ä½äºŒè¿›åˆ¶æ•°èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°å­—æ˜¯ 15ï¼Œå› æ­¤æ•°æ®åç§»çš„æœ€å¤§å€¼æ˜¯ 60 byteï¼Œè¿™ä¹Ÿä¾§é¢é™åˆ¶äº†TCPé¦–éƒ¨çš„æœ€å¤§é•¿åº¦ã€‚ ä¿ç•™Reservedå  0.75 ä¸ªå­—èŠ‚ (6 ä½)ã€‚ ä¿ç•™ä¸ºä»Šåä½¿ç”¨ï¼Œä½†ç›®å‰åº”ç½®ä¸º 0ã€‚ æ ‡å¿—ä½ TCP Flagsæ ‡å¿—ä½ï¼Œä¸€å…±æœ‰6ä¸ªï¼Œåˆ†åˆ«å 1ä½ï¼Œå…±6ä½ã€‚ æ¯ä¸€ä½çš„å€¼åªæœ‰ 0 å’Œ 1ï¼Œåˆ†åˆ«è¡¨è¾¾ä¸åŒæ„æ€ã€‚ å¦‚ä¸Šå›¾æ˜¯ä½¿ç”¨wireshardæŠ“åŒ…å±•ç¤ºæˆªå›¾ï¼› ACK(Acknowlegemt) ï¼šç¡®è®¤åºå·æœ‰æ•ˆ å½“ ACK = 1 çš„æ—¶å€™ï¼Œç¡®è®¤å·ï¼ˆAcknowledgemt Numberï¼‰æœ‰æ•ˆã€‚ ä¸€èˆ¬ç§°æºå¸¦ ACK æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œç¡®è®¤æŠ¥æ–‡æ®µã€ã€‚ä¸º0è¡¨ç¤ºæ•°æ®æ®µä¸åŒ…å«ç¡®è®¤ä¿¡æ¯ï¼Œç¡®è®¤å·è¢«å¿½ç•¥ã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK è®¾ç½®ä¸º 1ã€‚ RST(Reset)ï¼šé‡ç½®è¿æ¥ å½“ RST = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°ä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é‡Šæ”¾å¹¶é‡æ–°å»ºç«‹è¿æ¥ã€‚ ä¸€èˆ¬ç§°æºå¸¦ RST æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œå¤ä½æŠ¥æ–‡æ®µã€ã€‚ SYN(SYNchronization)ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥ å½“ SYN = 1 çš„æ—¶å€™ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚è¿æ¥æŠ¥æ–‡æ®µã€‚ ä¸€èˆ¬ç§°æºå¸¦ SYN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€ŒåŒæ­¥æŠ¥æ–‡æ®µã€ã€‚ åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡å°±æ˜¯åŒæ­¥æŠ¥æ–‡æ®µï¼Œåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”çš„æŠ¥æ–‡æ®µä¸­ä½¿ SYN = 1 å’Œ ACK = 1ã€‚ PSH (Push): æ¨é€ å½“ PSH = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µé«˜ä¼˜å…ˆçº§ï¼Œæ¥æ”¶æ–¹ TCP åº”è¯¥å°½å¿«æ¨é€ç»™æ¥æ”¶åº”ç”¨ç¨‹åºï¼Œè€Œä¸ç”¨ç­‰åˆ°æ•´ä¸ª TCP ç¼“å­˜éƒ½å¡«æ»¡äº†åå†äº¤ä»˜ã€‚ FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥ å½“ FIN = 1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾ TCP è¿æ¥ã€‚ä¸€èˆ¬ç§°æºå¸¦ FIN çš„æŠ¥æ–‡æ®µä¸ºã€Œç»“æŸæŠ¥æ–‡æ®µã€ã€‚åœ¨ TCP å››æ¬¡æŒ¥æ‰‹é‡Šæ”¾è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°è¯¥æ ‡å¿—ã€‚ çª—å£å¤§å° Window Sizeå 16ä½ã€‚è¯¥å­—æ®µæ˜ç¡®æŒ‡å‡ºäº†ç°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚ çª—å£å¤§å°çš„å€¼æ˜¯æŒ‡ï¼Œä»æœ¬æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç®—èµ·ï¼Œæ¥æ”¶æ–¹ç›®å‰å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ã€‚ ä¾‹å¦‚ï¼Œå‡å¦‚ç¡®è®¤å·æ˜¯701ï¼Œçª—å£å­—æ®µæ˜¯ 1000ã€‚è¿™å°±è¡¨æ˜ï¼Œä» 701 å·ç®—èµ·ï¼Œå‘é€æ­¤æŠ¥æ–‡æ®µçš„ä¸€æ–¹è¿˜æœ‰æ¥æ”¶ 1000 ï¼ˆå­—èŠ‚åºå·æ˜¯ 701 ~ 1700ï¼‰ ä¸ªå­—èŠ‚çš„æ•°æ®çš„æ¥æ”¶ç¼“å­˜ç©ºé—´ã€‚ æ ¡éªŒå’Œ TCP Checksumå 16ä½ã€‚ ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡Œã€CRCç®—æ³•ã€‘ï¼Œä»¥æ£€éªŒTCPæŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼Œå¦‚æœæŸåè¿™ä¸¢å¼ƒã€‚ æ£€éªŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚ ç´§æ€¥æŒ‡é’ˆ Urgent Pointerå  2 ä¸ªå­—èŠ‚ã€‚ ä»…åœ¨ URG = 1 æ—¶æ‰æœ‰æ„ä¹‰ï¼Œå®ƒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚ å½“ URG = 1 æ—¶ï¼Œå‘é€æ–¹ TCP å°±æŠŠç´§æ€¥æ•°æ®æ’å…¥åˆ°æœ¬æŠ¥æ–‡æ®µæ•°æ®çš„æœ€å‰é¢ï¼Œè€Œåœ¨ç´§æ€¥æ•°æ®åé¢çš„æ•°æ®ä»æ˜¯æ™®é€šæ•°æ®ã€‚ å› æ­¤ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºäº†ç´§æ€¥æ•°æ®çš„æœ«å°¾åœ¨æŠ¥æ–‡æ®µä¸­çš„ä½ç½®ã€‚ é€‰é¡¹ æ¯ä¸ªé€‰é¡¹å¼€å§‹æ˜¯1å­—èŠ‚kindå­—æ®µï¼Œè¯´æ˜é€‰é¡¹çš„ç±»å‹ kindä¸º0å’Œ1çš„é€‰é¡¹ï¼Œåªå ä¸€ä¸ªå­—èŠ‚ å…¶ä»–kindåæœ‰ä¸€å­—èŠ‚lenï¼Œè¡¨ç¤ºè¯¥é€‰é¡¹æ€»é•¿åº¦ï¼ˆåŒ…æ‹¬kindå’Œlenï¼‰ kindä¸º11ï¼Œ12ï¼Œ13è¡¨ç¤ºtcpäº‹åŠ¡ ä¸‹é¢æ˜¯å¸¸ç”¨é€‰é¡¹ï¼š MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ˜¯ã€é“¾è·¯å±‚ã€‘ä¸­çš„ç½‘ç»œå¯¹æ•°æ®å¸§çš„ä¸€ä¸ªé™åˆ¶ï¼Œä»¥ä»¥å¤ªç½‘ä¸ºä¾‹ï¼ŒMTU ä¸º 1500 ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªIP æ•°æ®æŠ¥åœ¨ä»¥å¤ªç½‘ä¸­ä¼ è¾“ï¼Œå¦‚æœå®ƒçš„é•¿åº¦å¤§äºè¯¥ MTU å€¼ï¼Œå°±è¦è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œä½¿å¾—æ¯ç‰‡æ•°æ®æŠ¥çš„é•¿åº¦å°äºMTUã€‚åˆ†ç‰‡ä¼ è¾“çš„ IP æ•°æ®æŠ¥ä¸ä¸€å®šæŒ‰åºåˆ°è¾¾ï¼Œä½† IP é¦–éƒ¨ä¸­çš„ä¿¡æ¯èƒ½è®©è¿™äº›æ•°æ®æŠ¥ç‰‡æŒ‰åºç»„è£…ã€‚IP æ•°æ®æŠ¥çš„åˆ†ç‰‡ä¸é‡ç»„æ˜¯åœ¨ç½‘ç»œå±‚è¿›å®Œæˆçš„ã€‚ MSS ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰MSS æ˜¯ TCP é‡Œçš„ä¸€ä¸ªæ¦‚å¿µï¼ˆé¦–éƒ¨çš„é€‰é¡¹å­—æ®µä¸­ï¼‰ã€‚MSS æ˜¯ TCP æ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åˆ†æ®µï¼ŒTCP æŠ¥æ–‡æ®µçš„é•¿åº¦å¤§äº MSS æ—¶ï¼Œè¦è¿›è¡Œåˆ†æ®µä¼ è¾“ã€‚TCP åè®®åœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰ç”¨äºé€šå‘Šå®ƒæœŸæœ›æ¥æ”¶çš„ MSS é€‰é¡¹ï¼ˆMSS é€‰é¡¹åªå‡ºç°åœ¨ SYN æŠ¥æ–‡æ®µä¸­ï¼Œå³ TCP ä¸‰æ¬¡æ¡æ‰‹çš„å‰ä¸¤æ¬¡ï¼‰ã€‚MSS çš„å€¼ä¸€èˆ¬ä¸º MTU å€¼å‡å»ä¸¤ä¸ªé¦–éƒ¨å¤§å°ï¼ˆéœ€è¦å‡å» IP æ•°æ®åŒ…åŒ…å¤´çš„å¤§å° 20Bytes å’Œ TCP æ•°æ®æ®µçš„åŒ…å¤´ 20Bytesï¼‰æ‰€ä»¥å¦‚æœç”¨é“¾è·¯å±‚ä»¥å¤ªç½‘ï¼ŒMSS çš„å€¼å¾€å¾€ä¸º 1460ã€‚è€Œ Internet ä¸Šæ ‡å‡†çš„ MTU ä¸º 576ï¼Œé‚£ä¹ˆå¦‚æœä¸è®¾ç½®ï¼Œåˆ™MSSçš„é»˜è®¤å€¼å°±ä¸º 536 ä¸ªå­—èŠ‚ã€‚TCPæŠ¥æ–‡æ®µçš„åˆ†æ®µä¸é‡ç»„æ˜¯åœ¨è¿è¾“å±‚å®Œæˆçš„ã€‚ seqå’Œackçš„è®¡ç®—é€»è¾‘ CRCæ ¡éªŒå‚è€ƒèµ„æ–™TCPåè®®ä¸­çš„seq/ackåºå·æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼ŸTCPåè®®è¯¦è§£TCPåè®®è¯¦è§£ï¼ˆä¸€ï¼‰ï¼šTCPå¤´éƒ¨ç»“æ„TCPå’ŒUDPæŠ¥æ–‡å¤´æ ¼å¼TCPåè®®è¯¦è§£åƒé€TCPåè®® ä¼ é€é—¨ ğŸ‘‡ 1ã€TCPæŠ¥æ–‡å¤´éƒ¨2ã€TCPä¸‰æ¬¡æ¡æ‰‹3ã€TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰4ã€TCPè¶…æ—¶ä¸é‡ä¼ 5ã€RTOé‡ä¼ è®¡æ—¶å™¨çš„è®¡ç®—6ã€æ»‘åŠ¨çª—å£7ã€æå‡ç½‘ç»œæ•ˆç‡8ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨9ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ‹¥å¡é¿å…10ã€å¿«é€Ÿé‡ä¼ ä¸å¿«é€Ÿæ¢å¤11ã€å››æ¬¡æŒ¥æ‰‹","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPåè®®","date":"2021-07-04T08:30:55.000Z","path":"wiki/TCPåè®®/","text":"TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’ ä¸‹é¢æ˜¯æœ¬äººåœ¨å­¦ä¹ TCPåè®®çš„è¿‡ç¨‹ä¸­ï¼Œè®°å½•çš„ç¬”è®°ï¼ŒæŒ‰ç…§å­¦ä¹ çš„è¿‡ç¨‹ä»å‰åˆ°åæ•´ç†åœ¨è¿™é‡Œï¼å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„çŸ¥è¯†æ²¡æœ‰ç½—åˆ—ï¼Œåªæ˜¯è®°å½•çš„å¤§æ¦‚æ¡†æ¶ï¼Œå¦‚æœæœ‰é—®é¢˜æˆ–é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼ 1ã€TCPæŠ¥æ–‡å¤´éƒ¨2ã€TCPä¸‰æ¬¡æ¡æ‰‹3ã€TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰4ã€TCPè¶…æ—¶ä¸é‡ä¼ 5ã€RTOé‡ä¼ è®¡æ—¶å™¨çš„è®¡ç®—6ã€æ»‘åŠ¨çª—å£7ã€æå‡ç½‘ç»œæ•ˆç‡8ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨9ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ‹¥å¡é¿å…10ã€å¿«é€Ÿé‡ä¼ ä¸å¿«é€Ÿæ¢å¤11ã€å››æ¬¡æŒ¥æ‰‹ å­¦ä¹ èµ„æ–™ æ•–ä¸™Githubæ•´ç†çš„ç¬”è®° æœ‰å¤§æ¦‚10ç¯‡å·¦å³çš„æ–‡ç« ï¼Œéƒ½æ˜¯é«˜è´¨é‡çš„ï¼ŒåŸåœ°å€è¯·ç‚¹å‡»ç€ğŸ‘‰ ã€Githubã€‘ æå®¢æ—¶é—´ã€ŠWebåè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜ã€‹â€“ é™¶è¾‰è€å¸ˆ è¿™é—¨è¯¾ç¨‹ä¸“é—¨è®²è§£ç½‘ç»œåè®®çš„ï¼ŒåŒ…æ‹¬Http/Https,TLSåè®®ï¼ŒTCPåè®®ï¼ŒIPåè®®ç­‰ï¼› ã€Šè®¡ç®—æœºç½‘ç»œ è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ç¬¬7ç‰ˆ å¾ˆå¤šåæ ¡è®¡ç®—æœºç½‘ç»œè¯¾ç¨‹åœ¨ä½¿ç”¨çš„æ•™æï¼Œéå¸¸æƒå¨ï¼ é¢è¯•é¢˜https://www.nowcoder.com/index","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"Welcome to GeekIBLi","date":"2021-07-04T07:44:33.000Z","path":"wiki/index/","text":"é“é˜» ä¸”é•¿ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨èæ˜é‡‘ åšå®¢https://www.codingdict.com/æå®¢æ—¶é—´ashiamd.github.ioå­—èŠ‚è·³åŠ¨åç«¯é¢è¯•é¢˜é›†çŸ¥ä¹ Javaå¿«é€Ÿè¿›é˜¶é€šé“To Be Top Javaer - Javaå·¥ç¨‹å¸ˆæˆç¥ä¹‹è·¯Div-wangJava å…¨æ ˆçŸ¥è¯†ä½“ç³»https://github.com/crossoverJie/JCSprouthttps://github.com/ZhongFuCheng3y/3y â€¼ï¸ç®—æ³•å›¾æ–‡åˆ†æ å·¥å…·ç½‘ç«™ProcessOnç¤ºè¯´ ã€Œ æä¾›äº†å¾ˆå¤šä¼˜è´¨çš„PPT è¿˜æœ‰å¾ˆå¤šå¤§å‚çš„æ²™é¾™è§†å±ä»¥åŠææ–™ã€ æŠ€æœ¯å›¢é˜Ÿæ¨èå°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿæœ‰èµæŠ€æœ¯å›¢é˜Ÿç¾å›¢æŠ€æœ¯å›¢é˜Ÿ é¢è¯•é¢˜åˆé›†2020å¹´å¤§å‚Javaé¢è¯•å‰å¤ä¹ çš„æ­£ç¡®å§¿åŠ¿ï¼ˆ800+é¢è¯•é¢˜é™„ç­”æ¡ˆè§£æï¼‰Javaé›†åˆé¢è¯•é¢˜ï¼ˆæ€»ç»“æœ€å…¨é¢çš„é¢è¯•é¢˜ï¼‰ ä¸¤å¹´å­¦è¯´è¯ ä¸€ç”Ÿå­¦é—­å˜´","tags":[],"categories":[{"name":"Overview","slug":"Overview","permalink":"http://example.com/categories/Overview/"}]},{"title":"2021å¹´åç«¯å¤§å‚-Spring","date":"2021-01-09T06:24:05.000Z","path":"wiki/2021å¹´åç«¯å¤§å‚-Spring/","text":"springæ”¯æŒå‡ ç§bean scopeï¼ŸSpring bean æ”¯æŒ 5 ç§ scopeï¼š Singleton - æ¯ä¸ª Spring IoC å®¹å™¨ä»…æœ‰ä¸€ä¸ªå•å®ä¾‹ã€‚ Prototype - æ¯æ¬¡è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ Request - æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶ä¸”è¯¥ bean ä»…åœ¨å½“å‰ HTTP è¯·æ±‚å†…æœ‰æ•ˆã€‚ Session - æ¯ä¸€æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ beanï¼ŒåŒæ—¶è¯¥ bean ä»…åœ¨å½“å‰ HTTP session å†…æœ‰æ•ˆã€‚ Global-session - ç±»ä¼¼äºæ ‡å‡†çš„ HTTP Session ä½œç”¨åŸŸï¼Œä¸è¿‡å®ƒä»…ä»…åœ¨åŸºäºportlet çš„ web åº”ç”¨ä¸­æ‰æœ‰æ„ä¹‰ã€‚ Portlet è§„èŒƒå®šä¹‰äº†å…¨å±€ Session çš„æ¦‚å¿µï¼Œå®ƒè¢«æ‰€æœ‰æ„æˆæŸä¸ª portlet web åº”ç”¨çš„å„ç§ä¸åŒçš„ portlet æ‰€å…±äº«ã€‚åœ¨ globalsession ä½œç”¨åŸŸä¸­å®šä¹‰çš„ bean è¢«é™å®šäºå…¨å±€ portlet Session çš„ç”Ÿå‘½å‘¨æœŸèŒƒå›´å†…ã€‚å¦‚æœä½ åœ¨ web ä¸­ä½¿ç”¨ global session ä½œç”¨åŸŸæ¥æ ‡è¯† beanï¼Œé‚£ä¹ˆ webä¼šè‡ªåŠ¨å½“æˆ session ç±»å‹æ¥ä½¿ç”¨ã€‚ ä»…å½“ç”¨æˆ·ä½¿ç”¨æ”¯æŒ Web çš„ ApplicationContext æ—¶ï¼Œæœ€åä¸‰ä¸ªæ‰å¯ç”¨ã€‚ Spring beançš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„spring bean å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæµç¨‹å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰Spring å®¹å™¨æ ¹æ®é…ç½®ä¸­çš„ bean å®šä¹‰ä¸­å®ä¾‹åŒ– beanã€‚ï¼ˆ2ï¼‰Spring ä½¿ç”¨ä¾èµ–æ³¨å…¥å¡«å……æ‰€æœ‰å±æ€§ï¼Œå¦‚ bean ä¸­æ‰€å®šä¹‰çš„é…ç½®ã€‚ï¼ˆ3ï¼‰å¦‚æœ bean å®ç°BeanNameAware æ¥å£ï¼Œåˆ™å·¥å‚é€šè¿‡ä¼ é€’ bean çš„ ID æ¥è°ƒç”¨setBeanName()ã€‚ï¼ˆ4ï¼‰å¦‚æœ bean å®ç° BeanFactoryAware æ¥å£ï¼Œå·¥å‚é€šè¿‡ä¼ é€’è‡ªèº«çš„å®ä¾‹æ¥è°ƒç”¨ setBeanFactory()ã€‚ï¼ˆ5ï¼‰å¦‚æœå­˜åœ¨ä¸ bean å…³è”çš„ä»»ä½•BeanPostProcessorsï¼Œåˆ™è°ƒç”¨preProcessBeforeInitialization() æ–¹æ³•ã€‚ï¼ˆ6ï¼‰å¦‚æœä¸º bean æŒ‡å®šäº† init æ–¹æ³•ï¼ˆ çš„ init-method å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°†è°ƒ ç”¨å®ƒã€‚ï¼ˆ7ï¼‰æœ€åï¼Œå¦‚æœå­˜åœ¨ä¸ bean å…³è”çš„ä»»ä½• BeanPostProcessorsï¼Œåˆ™å°†è°ƒç”¨ postProcessAfterInitialization() æ–¹æ³•ã€‚ï¼ˆ8ï¼‰å¦‚æœ bean å®ç°DisposableBean æ¥å£ï¼Œå½“ spring å®¹å™¨å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨ destory()ã€‚ï¼ˆ9ï¼‰å¦‚æœä¸ºbean æŒ‡å®šäº† destroy æ–¹æ³•ï¼ˆ çš„ destroy-method å±æ€§ï¼‰ï¼Œé‚£ä¹ˆå°† è°ƒç”¨å®ƒã€‚ ä»€ä¹ˆæ˜¯Springçš„è£…é…å½“ bean åœ¨ Spring å®¹å™¨ä¸­ç»„åˆåœ¨ä¸€èµ·æ—¶ï¼Œå®ƒè¢«ç§°ä¸ºè£…é…æˆ– bean è£…é…ã€‚Springå®¹å™¨éœ€è¦çŸ¥é“éœ€è¦ä»€ä¹ˆ bean ä»¥åŠå®¹å™¨åº”è¯¥å¦‚ä½•ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥å°† bean ç»‘å®šåœ¨ä¸€èµ·ï¼ŒåŒæ—¶è£…é… beanã€‚ è‡ªåŠ¨è£…é…æœ‰å“ªäº›æ–¹å¼åœ¨springä¸­ï¼Œå¯¹è±¡æ— éœ€è‡ªå·±æŸ¥æ‰¾æˆ–åˆ›å»ºä¸å…¶å…³è”çš„å…¶ä»–å¯¹è±¡ï¼Œç”±å®¹å™¨è´Ÿè´£æŠŠéœ€è¦ç›¸äº’åä½œçš„å¯¹è±¡å¼•ç”¨èµ‹äºˆå„ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨autowireæ¥é…ç½®è‡ªåŠ¨è£…è½½æ¨¡å¼ã€‚ åœ¨Springæ¡†æ¶xmlé…ç½®ä¸­å…±æœ‰5ç§è‡ªåŠ¨è£…é…ï¼š ï¼ˆ1ï¼‰noï¼šé»˜è®¤çš„æ–¹å¼æ˜¯ä¸è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œé€šè¿‡æ‰‹å·¥è®¾ç½®refå±æ€§æ¥è¿›è¡Œè£…é…beanã€‚ ï¼ˆ2ï¼‰byNameï¼šé€šè¿‡beançš„åç§°è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦‚æœä¸€ä¸ªbeançš„ property ä¸å¦ä¸€bean çš„name ç›¸åŒï¼Œå°±è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ ï¼ˆ3ï¼‰byTypeï¼šé€šè¿‡å‚æ•°çš„æ•°æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ ï¼ˆ4ï¼‰constructorï¼šåˆ©ç”¨æ„é€ å‡½æ•°è¿›è¡Œè£…é…ï¼Œå¹¶ä¸”æ„é€ å‡½æ•°çš„å‚æ•°é€šè¿‡byTypeè¿›è¡Œè£…é…ã€‚ ï¼ˆ5ï¼‰autodetectï¼šè‡ªåŠ¨æ¢æµ‹ï¼Œå¦‚æœæœ‰æ„é€ æ–¹æ³•ï¼Œé€šè¿‡ constructçš„æ–¹å¼è‡ªåŠ¨è£…é…ï¼Œå¦åˆ™ä½¿ç”¨ byTypeçš„æ–¹å¼è‡ªåŠ¨è£…é…ã€‚ æè¿°ä¸€ä¸‹ DispatcherServlet çš„å·¥ä½œæµç¨‹ï¼ˆ1ï¼‰å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼Œè¯·æ±‚è¢«å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet æ•è·ã€‚ ï¼ˆ2ï¼‰ DispatcherServlet æ ¹æ® -servlet.xml ä¸­çš„é…ç½®å¯¹è¯·æ±‚çš„ URL è¿›è¡Œè§£æï¼Œå¾—åˆ°è¯·æ±‚èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ã€‚ç„¶åæ ¹æ®è¯¥ URIï¼Œè°ƒç”¨ HandlerMappingè·å¾—è¯¥ Handler é…ç½®çš„æ‰€æœ‰ç›¸å…³çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ Handler å¯¹è±¡ä»¥åŠ Handler å¯¹è±¡å¯¹åº”çš„æ‹¦æˆªå™¨ï¼‰ï¼Œæœ€åä»¥HandlerExecutionChain å¯¹è±¡çš„å½¢å¼è¿”å›ã€‚ ï¼ˆ3ï¼‰ DispatcherServlet æ ¹æ®è·å¾—çš„ Handlerï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterã€‚ï¼ˆé™„æ³¨ï¼šå¦‚æœæˆåŠŸè·å¾— HandlerAdapter åï¼Œæ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„ preHandler(â€¦)æ–¹æ³•ï¼‰ã€‚ ï¼ˆ4ï¼‰æå– Request ä¸­çš„æ¨¡å‹æ•°æ®ï¼Œå¡«å…… Handler å…¥å‚ï¼Œå¼€å§‹æ‰§è¡Œ Handlerï¼ˆ Controller)ã€‚åœ¨å¡«å…… Handler çš„å…¥å‚è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ä½ çš„é…ç½®ï¼ŒSpring å°†å¸®ä½ åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼š Â· HttpMessageConveterï¼šå°†è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚ Jsonã€xml ç­‰æ•°æ®ï¼‰è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯ã€‚ Â· æ•°æ®è½¬æ¢ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®è½¬æ¢ã€‚å¦‚ String è½¬æ¢æˆ Integerã€Double ç­‰ã€‚ Â· æ•°æ®æ ¹å¼åŒ–ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®æ ¼å¼åŒ–ã€‚å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ ¼å¼åŒ–æ•°å­—æˆ–æ ¼å¼åŒ–æ—¥æœŸç­‰ã€‚ Â· æ•°æ®éªŒè¯ï¼šéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ã€æ ¼å¼ç­‰ï¼‰ï¼ŒéªŒè¯ç»“æœå­˜å‚¨åˆ°BindingResult æˆ– Error ä¸­ã€‚ ï¼ˆ5ï¼‰Handler(Controller)æ‰§è¡Œå®Œæˆåï¼Œå‘ DispatcherServlet è¿”å›ä¸€ä¸ªModelAndView å¯¹è±¡ï¼› ï¼ˆ6ï¼‰æ ¹æ®è¿”å›çš„ ModelAndViewï¼Œé€‰æ‹©ä¸€ä¸ªé€‚åˆçš„ ViewResolverï¼ˆå¿…é¡»æ˜¯å·²ç»æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­çš„ ViewResolver)è¿”å›ç»™ DispatcherServletã€‚ ï¼ˆ7ï¼‰ ViewResolver ç»“åˆ Model å’Œ Viewï¼Œæ¥æ¸²æŸ“è§†å›¾ã€‚ ï¼ˆ8ï¼‰è§†å›¾è´Ÿè´£å°†æ¸²æŸ“ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ é¢è¯•è¯·ä¸è¦å†é—®æˆ‘Spring Cloudåº•å±‚åŸç†https://juejin.cn/post/6844903705553174541 é™æ€ä»£ç†/åŠ¨æ€ä»£ç†ç‹‚ç¥è¯´ https://mp.weixin.qq.com/s/McxiyucxAQYPSOaJSUCCRQ ä»€ä¹ˆæ˜¯Spring IOCSpringå…¥é—¨è¿™ä¸€ç¯‡å°±å¤Ÿäº† https://www.tianmaying.com/tutorial/spring-ioc Springä¾èµ–æ³¨å…¥Springã€ä¾èµ–æ³¨å…¥ã€‘å°±æ˜¯è¿™ä¹ˆç®€å• 3y javaåç«¯å¼€å‘ä¸‰å¹´ï¼ä½ è¿˜ä¸äº†è§£Spring ä¾èµ–æ³¨å…¥ï¼Œå‡­ä»€ä¹ˆç»™ä½ æ¶¨è–ª å¯¹è±¡åˆ›å»ºå¾ªç¯ä¾èµ–é—®é¢˜å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ ä¸€çº§ç¼“å­˜ï¼šMap&lt;String, Object&gt; singletonObjectsç¬¬ä¸€çº§ç¼“å­˜çš„ä½œç”¨ï¼Ÿ ç”¨äºå­˜å‚¨å•ä¾‹æ¨¡å¼ä¸‹åˆ›å»ºçš„Beanå®ä¾‹ï¼ˆå·²ç»åˆ›å»ºå®Œæ¯•ï¼‰ã€‚ è¯¥ç¼“å­˜æ˜¯å¯¹å¤–ä½¿ç”¨çš„ï¼ŒæŒ‡çš„å°±æ˜¯ä½¿ç”¨Springæ¡†æ¶çš„ç¨‹åºå‘˜ã€‚ å­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼Ÿ Kï¼šbeançš„åç§° Vï¼šbeançš„å®ä¾‹å¯¹è±¡ï¼ˆæœ‰ä»£ç†å¯¹è±¡åˆ™æŒ‡çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œå·²ç»åˆ›å»ºå®Œæ¯•ï¼‰ ç¬¬äºŒçº§ç¼“å­˜ï¼šMap&lt;String, Object&gt; earlySingletonObjectsç¬¬äºŒçº§ç¼“å­˜çš„ä½œç”¨ï¼Ÿ ç”¨äºå­˜å‚¨å•ä¾‹æ¨¡å¼ä¸‹åˆ›å»ºçš„Beanå®ä¾‹ï¼ˆè¯¥Beanè¢«æå‰æš´éœ²çš„å¼•ç”¨,è¯¥Beanè¿˜åœ¨åˆ›å»ºä¸­ï¼‰ã€‚ è¯¥ç¼“å­˜æ˜¯å¯¹å†…ä½¿ç”¨çš„ï¼ŒæŒ‡çš„å°±æ˜¯Springæ¡†æ¶å†…éƒ¨é€»è¾‘ä½¿ç”¨è¯¥ç¼“å­˜ã€‚ ä¸ºäº†è§£å†³ç¬¬ä¸€ä¸ªclassAå¼•ç”¨æœ€ç»ˆå¦‚ä½•æ›¿æ¢ä¸ºä»£ç†å¯¹è±¡çš„é—®é¢˜ï¼ˆå¦‚æœæœ‰ä»£ç†å¯¹è±¡ï¼‰è¯·çˆ¬æ¥¼å‚è€ƒæ¼”ç¤ºæ¡ˆä¾‹ å­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼Ÿ Kï¼šbeançš„åç§° Vï¼šbeançš„å®ä¾‹å¯¹è±¡ï¼ˆæœ‰ä»£ç†å¯¹è±¡åˆ™æŒ‡çš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œè¯¥Beanè¿˜åœ¨åˆ›å»ºä¸­ï¼‰ ç¬¬ä¸‰çº§ç¼“å­˜ï¼šMap&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactoriesç¬¬ä¸‰çº§ç¼“å­˜çš„ä½œç”¨ï¼Ÿ é€šè¿‡ObjectFactoryå¯¹è±¡æ¥å­˜å‚¨å•ä¾‹æ¨¡å¼ä¸‹æå‰æš´éœ²çš„Beanå®ä¾‹çš„å¼•ç”¨ï¼ˆæ­£åœ¨åˆ›å»ºä¸­ï¼‰ã€‚ è¯¥ç¼“å­˜æ˜¯å¯¹å†…ä½¿ç”¨çš„ï¼ŒæŒ‡çš„å°±æ˜¯Springæ¡†æ¶å†…éƒ¨é€»è¾‘ä½¿ç”¨è¯¥ç¼“å­˜ã€‚ æ­¤ç¼“å­˜æ˜¯è§£å†³å¾ªç¯ä¾èµ–æœ€å¤§çš„åŠŸè‡£ å­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼Ÿ Kï¼šbeançš„åç§° Vï¼šObjectFactoryï¼Œè¯¥å¯¹è±¡æŒæœ‰æå‰æš´éœ²çš„beançš„å¼•ç”¨","tags":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"categories":[]},{"title":"2021å¹´åç«¯å¤§å‚é¢è¯•é¢˜åˆé›†","date":"2021-01-07T04:40:25.000Z","path":"wiki/2021å¹´åç«¯å¤§å‚é¢è¯•é¢˜åˆé›†/","text":"è®°å½•2021å¹´å„äº’è”ç½‘å¤§å‚é¢è¯•é—®é¢˜ä»¥åŠç­”æ¡ˆé“¾æ¥ï¼Œè¾¾åˆ°å¿«é€Ÿå¤ä¹ æ•ˆæœ é¢è¯•é¢˜åˆé›†ã€Šæˆ‘ä»¬ä¸€èµ·è¿›å¤§å‚ã€‹https://aobing.blog.csdn.net/category_9424379.html 1ã€Springé¢è¯•é¢˜1ã€Springå¯åŠ¨æµç¨‹ https://aobing.blog.csdn.net/article/details/110383213 https://geekibli.github.io/wiki/Springæ¢³ç†å¯åŠ¨è„‰ç»œ/ https://blog.csdn.net/hjukyjhg56/article/details/108529552 ï¼ˆé¢è¯•æ€»ç»“ç‰ˆï¼‰ 2ã€Springçš„iocå’Œaopè¯´ä¸€è¯´ 3ã€å¦‚æœè®©ä½ å®ç°ä¸€ä¸ªiocï¼Œä½ è¦æ€ä¹ˆåšï¼Ÿ https://aobing.blog.csdn.net/article/details/110383213 https://geekibli.github.io/wiki/Springæ¢³ç†å¯åŠ¨è„‰ç»œ/ 4ã€aopå®ç°åŸç†ï¼Œä»¥åŠjdkåŠ¨æ€ä»£ç†ä¼šé‡åˆ°çš„é—®é¢˜ ï¼Œé‚£cglibå°±æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†å—ï¼Ÿ 2ã€Javaè™šæ‹Ÿæœºæ“ä½œå †å’Œæ ˆè°æ¯”è¾ƒå¿«ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ 3ã€ç½‘ç»œé¢è¯•é¢˜ä»€ä¹ˆæ˜¯åŠ ç› JavaåŸºç¡€ä¸ºä»€ä¹ˆé‡å†™equalsè¦é‡å†™Hashcode 10ã€é€»è¾‘æ¨ç†å­—èŠ‚æœ€çˆ±é—®çš„æ™ºåŠ›é¢˜ï¼Œä½ ä¼šå‡ é“ï¼Ÿï¼ˆäºŒï¼‰","tags":[],"categories":[]},{"title":"2021å¹´åç«¯å¤§å‚-è®¡ç®—æœºç½‘ç»œ","date":"2021-01-01T06:17:33.000Z","path":"wiki/2021å¹´åç«¯å¤§å‚-è®¡ç®—æœºç½‘ç»œ/","text":"è®¡ç®—æœºç½‘ç»œ é¢è¯•åˆé›†é“¾æ¥ä¼˜ç§€ç®€å†æ¨¡æ¿åŠè®¡ç®—æœºç½‘ç»œå…«è‚¡æ–‡ é¢è¯•é¢˜ç›®ä¸ºä»€ä¹ˆéœ€è¦TCPåè®®ï¼ŸTCP æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚ IP å±‚æ˜¯ã€Œä¸å¯é ã€çš„ï¼Œå®ƒä¸ä¿è¯ç½‘ç»œåŒ…çš„äº¤ä»˜ã€ä¸ä¿è¯ç½‘ç»œåŒ…çš„æŒ‰åºäº¤ä»˜ã€ä¹Ÿä¸ä¿è¯ç½‘ç»œåŒ…ä¸­çš„æ•°æ®çš„å®Œæ•´æ€§ã€‚ å› ä¸º TCP æ˜¯ä¸€ä¸ªå·¥ä½œåœ¨ä¼ è¾“å±‚çš„å¯é æ•°æ®ä¼ è¾“çš„æœåŠ¡ï¼Œå®ƒèƒ½ç¡®ä¿æ¥æ”¶ç«¯æ¥æ”¶çš„ç½‘ç»œåŒ…æ˜¯æ— æŸåã€æ— é—´éš”ã€éå†—ä½™å’ŒæŒ‰åºçš„ã€‚ URIå’ŒURLçš„åŒºåˆ«URI(Uniform Resource Identifier)ï¼šä¸­æ–‡å…¨ç§°ä¸ºç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œä¸»è¦ä½œç”¨æ˜¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚ URL(Uniform Resource Location)ï¼šä¸­æ–‡å…¨ç§°ä¸ºç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œä¸»è¦ä½œç”¨æ˜¯æä¾›èµ„æºçš„è·¯å¾„ã€‚ DNSçš„å·¥ä½œæµç¨‹ domain name system é›†ç¾¤å¼è¿è¡Œï¼ˆé«˜å¯ç”¨ï¼‰ ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬æ˜¯é‡‡ç”¨é€’å½’æŸ¥è¯¢ï¼Œè€Œæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåçš„æŸ¥è¯¢ä¸€èˆ¬æ˜¯é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ã€‚ è¯¦æƒ…å‚è§https://www.nowcoder.com/discuss/682094?source_id=profile_create_nctrack&amp;channel=-1 é”®å…¥ç½‘å€åï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸‰æ­ªé—®æˆ‘ï¼šé”®å…¥ç½‘å€åï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ äº†è§£ARPåè®®å—?ARPåè®®å±äºç½‘ç»œå±‚çš„åè®®ï¼Œä¸»è¦ä½œç”¨æ˜¯å®ç°ä»IPåœ°å€è½¬æ¢ä¸ºMACåœ°å€ã€‚åœ¨æ¯ä¸ªä¸»æœºæˆ–è€…è·¯ç”±å™¨ä¸­éƒ½å»ºæœ‰ä¸€ä¸ªARPç¼“å­˜è¡¨ï¼Œè¡¨ä¸­æœ‰IPåœ°å€åŠIPåœ°å€å¯¹åº”çš„MACåœ°å€ã€‚ æœ‰äº†IPåœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨MACåœ°å€ï¼Ÿç®€å•æ¥è¯´ï¼Œæ ‡è¯†ç½‘ç»œä¸­çš„ä¸€å°è®¡ç®—æœºï¼Œæ¯”è¾ƒå¸¸ç”¨çš„å°±æ˜¯IPåœ°å€å’ŒMACåœ°å€ï¼Œä½†è®¡ç®—æœºçš„IPåœ°å€å¯ç”±ç”¨æˆ·è‡ªè¡Œæ›´æ”¹ï¼Œç®¡ç†èµ·æ¥ç›¸å¯¹å›°éš¾ï¼Œè€ŒMACåœ°å€ä¸å¯æ›´æ”¹ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šæŠŠIPåœ°å€å’ŒMACåœ°å€ç»„åˆèµ·æ¥ä½¿ç”¨ã€‚ è¯´ä¸€ä¸‹pingçš„è¿‡ç¨‹pingæ˜¯ICMP(ç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®)ä¸­çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼ŒICMPæ˜¯ç½‘ç»œå±‚çš„åè®®ã€‚pingçš„ä½œç”¨æ˜¯æµ‹è¯•ä¸¤ä¸ªä¸»æœºçš„è¿é€šæ€§ã€‚ pingçš„å·¥ä½œè¿‡ç¨‹ï¼š å‘ç›®çš„ä¸»æœºå‘é€å¤šä¸ªICMPå›é€è¯·æ±‚æŠ¥æ–‡ æ ¹æ®ç›®çš„ä¸»æœºè¿”å›çš„å›é€æŠ¥æ–‡çš„æ—¶é—´å’ŒæˆåŠŸå“åº”çš„æ¬¡æ•°ä¼°ç®—å‡ºæ•°æ®åŒ…å¾€è¿”æ—¶é—´åŠä¸¢åŒ…ç‡ã€‚ è·¯ç”±å™¨å’Œäº¤æ¢æœºçš„åŒºåˆ«ï¼Ÿ äº¤æ¢æœº æ•°æ®é“¾åº“å±‚ è¯†åˆ«MACåœ°å€å¹¶æ ¹æ®MACåœ°å€è½¬å‘æ•°æ®å¸§ è·¯ç”±å™¨ ç½‘ç»œå±‚ è¯†åˆ«IPåœ°å€å¹¶æ ¹æ®IPåœ°å€è½¬å‘æ•°æ®åŒ…ï¼Œç»´æŠ¤æ•°æ®è¡¨å¹¶åŸºäºæ•°æ®è¡¨è¿›è¡Œæœ€ä½³è·¯å¾„é€‰æ‹© TCPå’ŒUDPåè®®çš„åŒºåˆ«TCPå»ºç«‹è¿æ¥ï¼Œå¯é ä¼ è¾“ï¼Œä¸€å¯¹ä¸€ï¼Œæµé‡æ§åˆ¶ UDPæ— éœ€åˆ›å»ºè¿æ¥ï¼Œå°½é‡äº¤ä»˜ä¼ è¾“ï¼Œæ”¯æŒä¸€å¯¹å¤šï¼Œæ²¡æœ‰æµé‡æ§åˆ¶ï¼Œé¦–éƒ¨å¼€é”€å° TCPåè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ ä¸»è¦æœ‰æ ¡éªŒå’Œã€åºåˆ—å·ã€è¶…æ—¶é‡ä¼ ã€æµé‡æ§åˆ¶åŠæ‹¥å¡é¿å…ç­‰å‡ ç§æ–¹æ³•ã€‚ ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹æ•–ä¸™ç”¨è¿‘ 40 å¼ å›¾è§£è¢«é—®åƒç™¾éçš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜ ä¸ºä»€ä¹ˆä¸æ˜¯æ¡æ‰‹ä¸æ˜¯ä¸¤æ¬¡ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é˜»æ­¢å†å²é‡å¤è¿æ¥çš„åˆå§‹åŒ–ï¼ˆä¸»è¦åŸå› ï¼‰ ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥åŒæ­¥åŒæ–¹çš„åˆå§‹åºåˆ—å· ä¸‰æ¬¡æ¡æ‰‹æ‰å¯ä»¥é¿å…èµ„æºæµªè´¹ï¼ˆé¿å…å»ºç«‹å¤šä½™çš„è¿æ¥ï¼‰ ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æ¡æ‰‹ 1ã€è¢«æ–­å¼€è¿æ¥ä¸€æ–¹çš„ACKï¼ˆå“åº”ä¸»åŠ¨æ–­å¼€è¿æ¥çš„FINï¼‰æŠ¥æ–‡å’Œè‡ªå·±çš„FINæŠ¥æ–‡è¦åˆ†å¼€å‘é€ï¼Œå› ä¸ºä¸­é—´æŠ¥å¤„ç†å¯èƒ½ä¸ºå¤„ç†å®Œçš„æ•°æ®ï¼Œæ‰€ä»¥ä¸èƒ½ä¸¤ä¸ªæŠ¥æ–‡åŒæ—¶å‘é€æˆ–è€…ä¸èƒ½åˆå¹¶æˆä¸€ä¸ªæŠ¥æ–‡å‘é€ ä¸ºä»€ä¹ˆéœ€è¦TIME_WAIT é˜²æ­¢å…·æœ‰ç›¸åŒã€Œå››å…ƒç»„ã€çš„ã€Œæ—§ã€æ•°æ®åŒ…è¢«æ”¶åˆ°ï¼› ä¿è¯ã€Œè¢«åŠ¨å…³é—­è¿æ¥ã€çš„ä¸€æ–¹èƒ½è¢«æ­£ç¡®çš„å…³é—­ï¼Œå³ä¿è¯æœ€åçš„ ACK èƒ½è®©è¢«åŠ¨å…³é—­æ–¹æ¥æ”¶ï¼Œä»è€Œå¸®åŠ©å…¶æ­£å¸¸å…³é—­ï¼› è¿™ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå°±æ˜¯ä¸ºäº†ç¡®ä¿è¢«æ–­å¼€è¿æ¥çš„ä¸€æ–¹èƒ½æ”¶åˆ°æ–­å¼€è¿æ¥ç›¸åº”è‡ªå·±FINæŠ¥æ–‡çš„ACKæŠ¥æ–‡ï¼Œä¸Šå›¾ğŸ‘†ä¸­çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡ã€‚ ä¸ºä»€ä¹ˆè¦ç­‰å¾…ä¸¤ä¸ªMSLåªæœ‰ä¸»åŠ¨æ–­å¼€è¿æ¥çš„ä¸€æ–¹åœ¨è¿æ¥æ–­å¼€åè¦è¿›è¡ŒTIME_WAIT ï¼Œ é‚£TIME_WAITçš„æ—¶é—´ä¸ºä»€ä¹ˆæ˜¯2ä¸ªMSLï¼ˆMaximum Segment Lifetime æŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼‰ã€‚ TIME_WAIT è¿‡å¤šæœ‰ä»€ä¹ˆå±å®³ï¼Ÿ ç¬¬ä¸€æ˜¯å†…å­˜èµ„æºå ç”¨ï¼› ç¬¬äºŒæ˜¯å¯¹ç«¯å£èµ„æºçš„å ç”¨ï¼Œä¸€ä¸ª TCP è¿æ¥è‡³å°‘æ¶ˆè€—ä¸€ä¸ªæœ¬åœ°ç«¯å£ï¼› å¦‚ä½•è®¡ç®—TCPæ•°æ®é•¿åº¦IPæŠ¥é•¿åº¦-IPé¦–éƒ¨é•¿åº¦-TCPé¦–éƒ¨é•¿åº¦ Socketç¼–ç¨‹https://mp.weixin.qq.com/s/rX3A_FA19n4pI9HicIEsXg å»ºç«‹ä¸€ä¸ª socket è¿æ¥è¦ç»è¿‡å“ªäº›æ­¥éª¤ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åˆå§‹åŒ– socketï¼Œå¾—åˆ°æ–‡ä»¶æè¿°ç¬¦ï¼› æœåŠ¡ç«¯è°ƒç”¨ bindï¼Œå°†ç»‘å®šåœ¨ IP åœ°å€å’Œç«¯å£; æœåŠ¡ç«¯è°ƒç”¨ listenï¼Œè¿›è¡Œç›‘å¬ï¼› æœåŠ¡ç«¯è°ƒç”¨ acceptï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ï¼› å®¢æˆ·ç«¯è°ƒç”¨ connectï¼Œå‘æœåŠ¡å™¨ç«¯çš„åœ°å€å’Œç«¯å£å‘èµ·è¿æ¥è¯·æ±‚ï¼› æœåŠ¡ç«¯ accept è¿”å›ç”¨äºä¼ è¾“çš„ socket çš„æ–‡ä»¶æè¿°ç¬¦ï¼› å®¢æˆ·ç«¯è°ƒç”¨ write å†™å…¥æ•°æ®ï¼›æœåŠ¡ç«¯è°ƒç”¨ read è¯»å–æ•°æ®ï¼› å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œä¼šè°ƒç”¨ closeï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ read è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šè¯»å–åˆ°äº† EOFï¼Œå¾…å¤„ç†å®Œæ•°æ®åï¼ŒæœåŠ¡ç«¯è°ƒç”¨ closeï¼Œè¡¨ç¤ºè¿æ¥å…³é—­ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯è°ƒç”¨ accept æ—¶ï¼Œè¿æ¥æˆåŠŸäº†ä¼šè¿”å›ä¸€ä¸ªå·²å®Œæˆè¿æ¥çš„ socketï¼Œåç»­ç”¨æ¥ä¼ è¾“æ•°æ®ã€‚ æ‰€ä»¥ï¼Œç›‘å¬çš„ socket å’ŒçœŸæ­£ç”¨æ¥ä¼ é€æ•°æ®çš„ socketï¼Œæ˜¯ã€Œä¸¤ä¸ªã€ socketï¼Œä¸€ä¸ªå«ä½œç›‘å¬ socketï¼Œä¸€ä¸ªå«ä½œå·²å®Œæˆè¿æ¥ socketã€‚ æˆåŠŸè¿æ¥å»ºç«‹ä¹‹åï¼ŒåŒæ–¹å¼€å§‹é€šè¿‡ read å’Œ write å‡½æ•°æ¥è¯»å†™æ•°æ®ï¼Œå°±åƒå¾€ä¸€ä¸ªæ–‡ä»¶æµé‡Œé¢å†™ä¸œè¥¿ä¸€æ ·ã€‚ 301 å’Œ 302åŒºåˆ«301é€‚åˆæ°¸ä¹…é‡å®šå‘ 301æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯æ˜¯ä½¿ç”¨åŸŸåè·³è½¬ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¿é—® http://www.baidu.com ä¼šè·³è½¬åˆ° https://www.baidu.comï¼Œå‘é€è¯·æ±‚ä¹‹åï¼Œå°±ä¼šè¿”å›301çŠ¶æ€ç ï¼Œç„¶åè¿”å›ä¸€ä¸ªlocationï¼Œæç¤ºæ–°çš„åœ°å€ï¼Œæµè§ˆå™¨å°±ä¼šæ‹¿ç€è¿™ä¸ªæ–°çš„åœ°å€å»è®¿é—®ã€‚ æ³¨æ„ï¼š 301è¯·æ±‚æ˜¯å¯ä»¥ç¼“å­˜çš„ï¼Œ å³é€šè¿‡çœ‹status codeï¼Œå¯ä»¥å‘ç°åé¢å†™ç€from cacheã€‚ æˆ–è€…ä½ æŠŠä½ çš„ç½‘é¡µçš„åç§°ä»phpä¿®æ”¹ä¸ºäº†htmlï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šå‘ç”Ÿæ°¸ä¹…é‡å®šå‘ã€‚ 302ç”¨æ¥åšä¸´æ—¶è·³è½¬ æ¯”å¦‚æœªç™»é™†çš„ç”¨æˆ·è®¿é—®ç”¨æˆ·ä¸­å¿ƒé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚è®¿é—®404é¡µé¢ä¼šé‡æ–°å®šå‘åˆ°é¦–é¡µã€‚ æœåŠ¡å™¨500ï¼Œ501ï¼Œ502ï¼Œ503ï¼Œ504ï¼Œ505","tags":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"categories":[]},{"title":"2021å¹´åç«¯å¤§å‚-MySQL","date":"2021-01-01T03:55:30.000Z","path":"wiki/2021å¹´åç«¯å¤§å‚-MySQL/","text":"æ²¡æœ‰åˆ«çš„ç›®çš„ï¼Œå°±æ˜¯ä¸ºäº†å¿«é€Ÿå¤ä¹  Mysqlé¢è¯•åˆé›†ä»€ä¹ˆæ˜¯å›è¡¨https://blog.csdn.net/xuyw10000/article/details/95971218 https://juejin.cn/post/6844904062329028621 è¦†ç›–ç´¢å¼•çš„ä¸€ä¸ªä¼˜åŒ–åŠæ³•æ˜¯å°†è¦æŸ¥è¯¢çš„åˆ—æ·»åŠ åˆ°ç´¢å¼•é¡¹ä¸­å»","tags":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[]},{"title":"2021å¹´åç«¯å¤§å‚-ç®—æ³•é¢è¯•åˆé›†","date":"2021-01-01T01:43:34.000Z","path":"wiki/2021å¹´åç«¯å¤§å‚-ç®—æ³•é¢è¯•åˆé›†/","text":"ç®—æ³•ç±»åˆ©ç”¨å †æ±‚ TopK é—®é¢˜åŠå…¶åº”ç”¨æ¡ˆä¾‹è§£å†³æ€è·¯https://juejin.cn/post/6963096695333158926 https://juejin.cn/post/6844903831487152135","tags":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"categories":[]}],"categories":[{"name":"Develop Lan","slug":"Develop-Lan","permalink":"http://example.com/categories/Develop-Lan/"},{"name":"Java","slug":"Develop-Lan/Java","permalink":"http://example.com/categories/Develop-Lan/Java/"},{"name":"JVM","slug":"Develop-Lan/Java/JVM","permalink":"http://example.com/categories/Develop-Lan/Java/JVM/"},{"name":"Distributed Dir","slug":"Distributed-Dir","permalink":"http://example.com/categories/Distributed-Dir/"},{"name":"theory","slug":"Distributed-Dir/theory","permalink":"http://example.com/categories/Distributed-Dir/theory/"},{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQL","slug":"DataBase/MySQL","permalink":"http://example.com/categories/DataBase/MySQL/"},{"name":"å¤šçº¿ç¨‹ä¸å¹¶å‘","slug":"Develop-Lan/Java/å¤šçº¿ç¨‹ä¸å¹¶å‘","permalink":"http://example.com/categories/Develop-Lan/Java/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/"},{"name":"IO","slug":"Develop-Lan/Java/IO","permalink":"http://example.com/categories/Develop-Lan/Java/IO/"},{"name":"Spring Family","slug":"Spring-Family","permalink":"http://example.com/categories/Spring-Family/"},{"name":"Spring Framework","slug":"Spring-Family/Spring-Framework","permalink":"http://example.com/categories/Spring-Family/Spring-Framework/"},{"name":"mybatis","slug":"Spring-Family/mybatis","permalink":"http://example.com/categories/Spring-Family/mybatis/"},{"name":"Redis","slug":"DataBase/Redis","permalink":"http://example.com/categories/DataBase/Redis/"},{"name":"Kafka","slug":"Distributed-Dir/Kafka","permalink":"http://example.com/categories/Distributed-Dir/Kafka/"},{"name":"Develop Tools","slug":"Develop-Tools","permalink":"http://example.com/categories/Develop-Tools/"},{"name":"docker","slug":"Develop-Tools/docker","permalink":"http://example.com/categories/Develop-Tools/docker/"},{"name":"MongoDB","slug":"DataBase/MongoDB","permalink":"http://example.com/categories/DataBase/MongoDB/"},{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"Search in Depth","slug":"Elasticsearch/Search-in-Depth","permalink":"http://example.com/categories/Elasticsearch/Search-in-Depth/"},{"name":"Administration and Deployment","slug":"Elasticsearch/Administration-and-Deployment","permalink":"http://example.com/categories/Elasticsearch/Administration-and-Deployment/"},{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"HTTP","slug":"Computer-Network/HTTP","permalink":"http://example.com/categories/Computer-Network/HTTP/"},{"name":"Linux System","slug":"Linux-System","permalink":"http://example.com/categories/Linux-System/"},{"name":"Process","slug":"Linux-System/Process","permalink":"http://example.com/categories/Linux-System/Process/"},{"name":"Python","slug":"Develop-Lan/Python","permalink":"http://example.com/categories/Develop-Lan/Python/"},{"name":"Git","slug":"Develop-Tools/Git","permalink":"http://example.com/categories/Develop-Tools/Git/"},{"name":"Common commands","slug":"Linux-System/Common-commands","permalink":"http://example.com/categories/Linux-System/Common-commands/"},{"name":"Getting Started","slug":"Elasticsearch/Getting-Started","permalink":"http://example.com/categories/Elasticsearch/Getting-Started/"},{"name":"Aggregations","slug":"Elasticsearch/Aggregations","permalink":"http://example.com/categories/Elasticsearch/Aggregations/"},{"name":"Recommend System","slug":"Recommend-System","permalink":"http://example.com/categories/Recommend-System/"},{"name":"Overview","slug":"Recommend-System/Overview","permalink":"http://example.com/categories/Recommend-System/Overview/"},{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"},{"name":"Other Question","slug":"Elasticsearch/Other-Question","permalink":"http://example.com/categories/Elasticsearch/Other-Question/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"},{"name":"Overview","slug":"Overview","permalink":"http://example.com/categories/Overview/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/tags/Linux/"},{"name":"ç®€å•","slug":"ç®€å•","permalink":"http://example.com/tags/%E7%AE%80%E5%8D%95/"},{"name":"æ•°ç»„","slug":"æ•°ç»„","permalink":"http://example.com/tags/%E6%95%B0%E7%BB%84/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"http://example.com/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"},{"name":"å“ˆå¸Œè¡¨","slug":"å“ˆå¸Œè¡¨","permalink":"http://example.com/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/"},{"name":"æ’åº","slug":"æ’åº","permalink":"http://example.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"è´ªå¿ƒ","slug":"è´ªå¿ƒ","permalink":"http://example.com/tags/%E8%B4%AA%E5%BF%83/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"http://example.com/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"åŒæŒ‡é’ˆ","slug":"åŒæŒ‡é’ˆ","permalink":"http://example.com/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"},{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"},{"name":"kafka","slug":"kafka","permalink":"http://example.com/tags/kafka/"},{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/tags/Apache-Flink/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"http://example.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"},{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"},{"name":"mybatis","slug":"mybatis","permalink":"http://example.com/tags/mybatis/"},{"name":"Redis","slug":"Redis","permalink":"http://example.com/tags/Redis/"},{"name":"docker","slug":"docker","permalink":"http://example.com/tags/docker/"},{"name":"mongodb","slug":"mongodb","permalink":"http://example.com/tags/mongodb/"},{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"},{"name":"http","slug":"http","permalink":"http://example.com/tags/http/"},{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"},{"name":"git","slug":"git","permalink":"http://example.com/tags/git/"},{"name":"æ¨èç³»ç»Ÿ","slug":"æ¨èç³»ç»Ÿ","permalink":"http://example.com/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/"},{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}]}
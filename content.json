{"pages":[{"title":"Tags","date":"2021-07-04T07:22:56.335Z","path":"tags/index.html","text":""},{"title":"About","date":"2021-07-04T09:22:18.003Z","path":"about/index.html","text":""},{"title":"Categories","date":"2021-07-04T07:22:56.334Z","path":"categories/index.html","text":""}],"posts":[{"title":"elasticsearchæ˜ å°„","date":"2021-07-05T14:54:05.000Z","path":"wiki/elasticsearchæ˜ å°„/","text":"Elasticsearch æ”¯æŒå¦‚ä¸‹ç®€å•åŸŸç±»å‹ï¼š å­—ç¬¦ä¸²: string ï¼ˆes7ä¹‹åç¼–ç¨‹textï¼‰ æ•´æ•° : byte, short, integer, long æµ®ç‚¹æ•°: float, double å¸ƒå°”å‹: boolean æ—¥æœŸ: date æŸ¥çœ‹ç´¢å¼•çš„mappingGET /gb/_mapping/tweet 1234567891011121314151617181920212223&#123; &quot;gb&quot;: &#123; &quot;mappings&quot;: &#123; &quot;tweet&quot;: &#123; &quot;properties&quot;: &#123; &quot;date&quot;: &#123; &quot;type&quot;: &quot;date&quot;, &quot;format&quot;: &quot;strict_date_optional_time||epoch_millis&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;string&quot; &#125;, &quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot; &#125;, &quot;user_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125; &#125; &#125; &#125; &#125;&#125; è‡ªå®šä¹‰åŸŸæ˜ å°„å°½ç®¡åœ¨å¾ˆå¤šæƒ…å†µä¸‹åŸºæœ¬åŸŸæ•°æ®ç±»å‹å·²ç»å¤Ÿç”¨ï¼Œä½†ä½ ç»å¸¸éœ€è¦ä¸ºå•ç‹¬åŸŸè‡ªå®šä¹‰æ˜ å°„ï¼Œç‰¹åˆ«æ˜¯å­—ç¬¦ä¸²åŸŸã€‚è‡ªå®šä¹‰æ˜ å°„å…è®¸ä½ æ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š å…¨æ–‡å­—ç¬¦ä¸²åŸŸå’Œç²¾ç¡®å€¼å­—ç¬¦ä¸²åŸŸçš„åŒºåˆ« ä½¿ç”¨ç‰¹å®šè¯­è¨€åˆ†æå™¨ ä¼˜åŒ–åŸŸä»¥é€‚åº”éƒ¨åˆ†åŒ¹é… æŒ‡å®šè‡ªå®šä¹‰æ•°æ®æ ¼å¼ è¿˜æœ‰æ›´å¤š åŸŸæœ€é‡è¦çš„å±æ€§æ˜¯ type ã€‚å¯¹äºä¸æ˜¯ string çš„åŸŸï¼Œä½ ä¸€èˆ¬åªéœ€è¦è®¾ç½® type ï¼š 12345&#123; &quot;number_of_clicks&quot;: &#123; &quot;type&quot;: &quot;integer&quot; &#125;&#125; é»˜è®¤ï¼Œ string (text) ç±»å‹åŸŸä¼šè¢«è®¤ä¸ºåŒ…å«å…¨æ–‡ã€‚å°±æ˜¯è¯´ï¼Œå®ƒä»¬çš„å€¼åœ¨ç´¢å¼•å‰ï¼Œä¼šé€šè¿‡ä¸€ä¸ªåˆ†æå™¨ï¼Œé’ˆå¯¹äºè¿™ä¸ªåŸŸçš„æŸ¥è¯¢åœ¨æœç´¢å‰ä¹Ÿä¼šç»è¿‡ä¸€ä¸ªåˆ†æå™¨ã€‚ string åŸŸæ˜ å°„çš„ä¸¤ä¸ªæœ€é‡è¦å±æ€§æ˜¯ index å’Œ analyzer ã€‚ indexindex å±æ€§æ§åˆ¶æ€æ ·ç´¢å¼•å­—ç¬¦ä¸²ã€‚å®ƒå¯ä»¥æ˜¯ä¸‹é¢ä¸‰ä¸ªå€¼ï¼š analyzedé¦–å…ˆåˆ†æå­—ç¬¦ä¸²ï¼Œç„¶åç´¢å¼•å®ƒã€‚æ¢å¥è¯è¯´ï¼Œä»¥å…¨æ–‡ç´¢å¼•è¿™ä¸ªåŸŸã€‚ not_analyzed ç´¢å¼•è¿™ä¸ªåŸŸï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¢«æœç´¢ï¼Œä½†ç´¢å¼•çš„æ˜¯ç²¾ç¡®å€¼ã€‚ä¸ä¼šå¯¹å®ƒè¿›è¡Œåˆ†æã€‚ noä¸ç´¢å¼•è¿™ä¸ªåŸŸã€‚è¿™ä¸ªåŸŸä¸ä¼šè¢«æœç´¢åˆ°ã€‚ (æ¯”å¦‚ä¸€äº›éšç§ä¿¡æ¯) string åŸŸ index å±æ€§é»˜è®¤æ˜¯ analyzed ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ˜ å°„è¿™ä¸ªå­—æ®µä¸ºä¸€ä¸ªç²¾ç¡®å€¼ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å®ƒä¸º not_analyzed ï¼š âš ï¸ âš ï¸å…¶ä»–ç®€å•ç±»å‹ï¼ˆä¾‹å¦‚ long ï¼Œ double ï¼Œ date ç­‰ï¼‰ä¹Ÿæ¥å— index å‚æ•°ï¼Œä½†æœ‰æ„ä¹‰çš„å€¼åªæœ‰ no å’Œ not_analyzed ï¼Œ å› ä¸ºå®ƒä»¬æ°¸è¿œä¸ä¼šè¢«åˆ†æã€‚ analyzerå¯¹äº analyzed å­—ç¬¦ä¸²åŸŸï¼Œç”¨ analyzer å±æ€§æŒ‡å®šåœ¨æœç´¢å’Œç´¢å¼•æ—¶ä½¿ç”¨çš„åˆ†æå™¨ã€‚é»˜è®¤ï¼Œ Elasticsearch ä½¿ç”¨ standard åˆ†æå™¨ï¼Œ ä½†ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå†…ç½®çš„åˆ†æå™¨æ›¿ä»£å®ƒï¼Œä¾‹å¦‚ whitespace ã€ simple å’Œ english; 123456&#123; &quot;tweet&quot;: &#123; &quot;type&quot;: &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot; &#125;&#125; æ›´æ–°æ˜ å°„å½“ä½ é¦–æ¬¡åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç±»å‹çš„æ˜ å°„ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ /_mapping ä¸ºæ–°ç±»å‹ï¼ˆæˆ–è€…ä¸ºå­˜åœ¨çš„ç±»å‹æ›´æ–°æ˜ å°„ï¼‰å¢åŠ æ˜ å°„ã€‚âš ï¸ âš ï¸å°½ç®¡ä½ å¯ä»¥ å¢åŠ  ä¸€ä¸ªå­˜åœ¨çš„æ˜ å°„ï¼Œä½ ä¸èƒ½ ä¿®æ”¹ å­˜åœ¨çš„åŸŸæ˜ å°„ã€‚å¦‚æœä¸€ä¸ªåŸŸçš„æ˜ å°„å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆè¯¥åŸŸçš„æ•°æ®å¯èƒ½å·²ç»è¢«ç´¢å¼•ã€‚å¦‚æœä½ æ„å›¾ä¿®æ”¹è¿™ä¸ªåŸŸçš„æ˜ å°„ï¼Œç´¢å¼•çš„æ•°æ®å¯èƒ½ä¼šå‡ºé”™ï¼Œä¸èƒ½è¢«æ­£å¸¸çš„æœç´¢ã€‚ æˆ‘ä»¬å¯ä»¥æ›´æ–°ä¸€ä¸ªæ˜ å°„æ¥æ·»åŠ ä¸€ä¸ªæ–°åŸŸï¼Œä½†ä¸èƒ½å°†ä¸€ä¸ªå­˜åœ¨çš„åŸŸä» analyzed æ”¹ä¸º not_analyzed ã€‚ ä¸ºäº†æè¿°æŒ‡å®šæ˜ å°„çš„ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ gd ç´¢å¼•ï¼šDELETE /gbç„¶ååˆ›å»ºä¸€ä¸ªæ–°ç´¢å¼•ï¼ŒæŒ‡å®š tweet åŸŸä½¿ç”¨ english åˆ†æå™¨ï¼š 12345678910111213141516171819202122PUT /gb &#123; &quot;mappings&quot;: &#123; &quot;tweet&quot; : &#123; &quot;properties&quot; : &#123; &quot;tweet&quot; : &#123; &quot;type&quot; : &quot;string&quot;, &quot;analyzer&quot;: &quot;english&quot; &#125;, &quot;date&quot; : &#123; &quot;type&quot; : &quot;date&quot; &#125;, &quot;name&quot; : &#123; &quot;type&quot; : &quot;string&quot; &#125;, &quot;user_id&quot; : &#123; &quot;type&quot; : &quot;long&quot; &#125; &#125; &#125; &#125;&#125; ç¨åï¼Œæˆ‘ä»¬å†³å®šåœ¨ tweet æ˜ å°„å¢åŠ ä¸€ä¸ªæ–°çš„åä¸º tag çš„ not_analyzed çš„æ–‡æœ¬åŸŸï¼Œä½¿ç”¨ _mapping ï¼š 123456789PUT /gb/_mapping/tweet&#123; &quot;properties&quot; : &#123; &quot;tag&quot; : &#123; &quot;type&quot; : &quot;string&quot;, &quot;index&quot;: &quot;not_analyzed&quot; &#125; &#125;&#125; æ³¨æ„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†æ¬¡åˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„åŸŸï¼Œå› ä¸ºæ— è®ºå¦‚ä½•æˆ‘ä»¬éƒ½æ— æ³•æ”¹å˜å®ƒä»¬ã€‚æ–°åŸŸå·²ç»è¢«åˆå¹¶åˆ°å­˜åœ¨çš„æ˜ å°„ä¸­ æµ‹è¯•æ˜ å°„ä½ å¯ä»¥ä½¿ç”¨ analyze API æµ‹è¯•å­—ç¬¦ä¸²åŸŸçš„æ˜ å°„ã€‚æ¯”è¾ƒä¸‹é¢ä¸¤ä¸ªè¯·æ±‚çš„è¾“å‡ºï¼š 1234567891011GET /gb/_analyze&#123; &quot;field&quot;: &quot;tweet&quot;, &quot;text&quot;: &quot;Black-cats&quot; &#125;GET /gb/_analyze&#123; &quot;field&quot;: &quot;tag&quot;, &quot;text&quot;: &quot;Black-cats&quot; &#125; tweet åŸŸäº§ç”Ÿä¸¤ä¸ªè¯æ¡ black å’Œ cat ï¼Œ tag åŸŸäº§ç”Ÿå•ç‹¬çš„è¯æ¡ Black-cats ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬çš„æ˜ å°„æ­£å¸¸å·¥ä½œã€‚ å‚è€ƒèµ„æ–™ Elasticsearchæƒå¨æŒ‡å—","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"}]},{"title":"åˆ†æä¸åˆ†æå™¨","date":"2021-07-05T14:43:44.000Z","path":"wiki/åˆ†æä¸åˆ†æå™¨/","text":"åˆ†æåŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š é¦–å…ˆï¼Œå°†ä¸€å—æ–‡æœ¬åˆ†æˆé€‚åˆäºå€’æ’ç´¢å¼•çš„ç‹¬ç«‹çš„ è¯æ¡ ï¼Œä¹‹åï¼Œå°†è¿™äº›è¯æ¡ç»Ÿä¸€åŒ–ä¸ºæ ‡å‡†æ ¼å¼ä»¥æé«˜å®ƒä»¬çš„â€œå¯æœç´¢æ€§â€ï¼Œæˆ–è€… recallåˆ†æå™¨æ‰§è¡Œä¸Šé¢çš„å·¥ä½œã€‚ åˆ†æå™¨ å®é™…ä¸Šæ˜¯å°†ä¸‰ä¸ªåŠŸèƒ½å°è£…åˆ°äº†ä¸€ä¸ªåŒ…é‡Œï¼š å­—ç¬¦è¿‡æ»¤å™¨é¦–å…ˆï¼Œå­—ç¬¦ä¸²æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª å­—ç¬¦è¿‡æ»¤å™¨ ã€‚ä»–ä»¬çš„ä»»åŠ¡æ˜¯åœ¨åˆ†è¯å‰æ•´ç†å­—ç¬¦ä¸²ã€‚ä¸€ä¸ªå­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨æ¥å»æ‰HTMLï¼Œæˆ–è€…å°† &amp; è½¬åŒ–æˆ andã€‚ åˆ†è¯å™¨å…¶æ¬¡ï¼Œå­—ç¬¦ä¸²è¢« åˆ†è¯å™¨ åˆ†ä¸ºå•ä¸ªçš„è¯æ¡ã€‚ä¸€ä¸ªç®€å•çš„åˆ†è¯å™¨é‡åˆ°ç©ºæ ¼å’Œæ ‡ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå°†æ–‡æœ¬æ‹†åˆ†æˆè¯æ¡ã€‚ Token è¿‡æ»¤å™¨æœ€åï¼Œè¯æ¡æŒ‰é¡ºåºé€šè¿‡æ¯ä¸ª token è¿‡æ»¤å™¨ ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ”¹å˜è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œå°å†™åŒ– Quick ï¼‰ï¼Œåˆ é™¤è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œ åƒ aï¼Œ andï¼Œ the ç­‰æ— ç”¨è¯ï¼‰ï¼Œæˆ–è€…å¢åŠ è¯æ¡ï¼ˆä¾‹å¦‚ï¼Œåƒ jump å’Œ leap è¿™ç§åŒä¹‰è¯ï¼‰ã€‚Elasticsearchæä¾›äº†å¼€ç®±å³ç”¨çš„å­—ç¬¦è¿‡æ»¤å™¨ã€åˆ†è¯å™¨å’Œtoken è¿‡æ»¤å™¨ã€‚ è¿™äº›å¯ä»¥ç»„åˆèµ·æ¥å½¢æˆè‡ªå®šä¹‰çš„åˆ†æå™¨ä»¥ç”¨äºä¸åŒçš„ç›®çš„ã€‚ å†…ç½®åˆ†æå™¨ä½†æ˜¯ï¼Œ Elasticsearchè¿˜é™„å¸¦äº†å¯ä»¥ç›´æ¥ä½¿ç”¨çš„é¢„åŒ…è£…çš„åˆ†æå™¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ—å‡ºæœ€é‡è¦çš„åˆ†æå™¨ã€‚ä¸ºäº†è¯æ˜å®ƒä»¬çš„å·®å¼‚ï¼Œæˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªåˆ†æå™¨ä¼šä»ä¸‹é¢çš„å­—ç¬¦ä¸²å¾—åˆ°å“ªäº›è¯æ¡ï¼š&quot;Set the shape to semi-transparent by calling set_trans(5)&quot; æ ‡å‡†åˆ†æå™¨æ ‡å‡†åˆ†æå™¨æ˜¯Elasticsearché»˜è®¤ä½¿ç”¨çš„åˆ†æå™¨ã€‚å®ƒæ˜¯åˆ†æå„ç§è¯­è¨€æ–‡æœ¬æœ€å¸¸ç”¨çš„é€‰æ‹©ã€‚å®ƒæ ¹æ® Unicode è”ç›Ÿ å®šä¹‰çš„ å•è¯è¾¹ç•Œ åˆ’åˆ†æ–‡æœ¬ã€‚åˆ é™¤ç»å¤§éƒ¨åˆ†æ ‡ç‚¹ã€‚æœ€åï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿset, the, shape, to, semi, transparent, by, calling, set_trans, 5 ç®€å•åˆ†æå™¨ç®€å•åˆ†æå™¨åœ¨ä»»ä½•ä¸æ˜¯å­—æ¯çš„åœ°æ–¹åˆ†éš”æ–‡æœ¬ï¼Œå°†è¯æ¡å°å†™ã€‚å®ƒä¼šäº§ç”Ÿset, the, shape, to, semi, transparent, by, calling, set, trans ç©ºæ ¼åˆ†æå™¨ç©ºæ ¼åˆ†æå™¨åœ¨ç©ºæ ¼çš„åœ°æ–¹åˆ’åˆ†æ–‡æœ¬ã€‚å®ƒä¼šäº§ç”ŸSet, the, shape, to, semi-transparent, by, calling, set_trans(5) è¯­è¨€åˆ†æå™¨ç‰¹å®šè¯­è¨€åˆ†æå™¨å¯ç”¨äº å¾ˆå¤šè¯­è¨€ã€‚å®ƒä»¬å¯ä»¥è€ƒè™‘æŒ‡å®šè¯­è¨€çš„ç‰¹ç‚¹ã€‚ä¾‹å¦‚ï¼Œ è‹±è¯­ åˆ†æå™¨é™„å¸¦äº†ä¸€ç»„è‹±è¯­æ— ç”¨è¯ï¼ˆå¸¸ç”¨å•è¯ï¼Œä¾‹å¦‚ and æˆ–è€… the ï¼Œå®ƒä»¬å¯¹ç›¸å…³æ€§æ²¡æœ‰å¤šå°‘å½±å“ï¼‰ï¼Œå®ƒä»¬ä¼šè¢«åˆ é™¤ã€‚ ç”±äºç†è§£è‹±è¯­è¯­æ³•çš„è§„åˆ™ï¼Œè¿™ä¸ªåˆ†è¯å™¨å¯ä»¥æå–è‹±è¯­å•è¯çš„ è¯å¹² ã€‚ è‹±è¯­ åˆ†è¯å™¨ä¼šäº§ç”Ÿä¸‹é¢çš„è¯æ¡ï¼šset, shape, semi, transpar, call, set_tran, 5æ³¨æ„çœ‹ transparentã€ calling å’Œ set_trans å·²ç»å˜ä¸ºè¯æ ¹æ ¼å¼ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨åˆ†æå™¨å½“æˆ‘ä»¬ ç´¢å¼• ä¸€ä¸ªæ–‡æ¡£ï¼Œå®ƒçš„å…¨æ–‡åŸŸè¢«åˆ†ææˆè¯æ¡ä»¥ç”¨æ¥åˆ›å»ºå€’æ’ç´¢å¼•ã€‚ ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åœ¨å…¨æ–‡åŸŸ æœç´¢ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†æŸ¥è¯¢å­—ç¬¦ä¸²é€šè¿‡ ç›¸åŒçš„åˆ†æè¿‡ç¨‹ ï¼Œä»¥ä¿è¯æˆ‘ä»¬æœç´¢çš„è¯æ¡æ ¼å¼ä¸ç´¢å¼•ä¸­çš„è¯æ¡æ ¼å¼ä¸€è‡´ã€‚ å…¨æ–‡æŸ¥è¯¢ï¼Œç†è§£æ¯ä¸ªåŸŸæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åšæ­£ç¡®çš„äº‹ï¼š å½“ä½ æŸ¥è¯¢ä¸€ä¸ª å…¨æ–‡ åŸŸæ—¶ï¼Œ ä¼šå¯¹æŸ¥è¯¢å­—ç¬¦ä¸²åº”ç”¨ç›¸åŒçš„åˆ†æå™¨ï¼Œä»¥äº§ç”Ÿæ­£ç¡®çš„æœç´¢è¯æ¡åˆ—è¡¨ã€‚å½“ä½ æŸ¥è¯¢ä¸€ä¸ª ç²¾ç¡®å€¼ åŸŸæ—¶ï¼Œä¸ä¼šåˆ†ææŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æœç´¢ä½ æŒ‡å®šçš„ç²¾ç¡®å€¼ã€‚ æµ‹è¯•åˆ†æå™¨æœ‰äº›æ—¶å€™å¾ˆéš¾ç†è§£åˆ†è¯çš„è¿‡ç¨‹å’Œå®é™…è¢«å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ï¼Œç‰¹åˆ«æ˜¯ä½ åˆšæ¥è§¦Elasticsearchã€‚ä¸ºäº†ç†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ analyze API æ¥çœ‹æ–‡æœ¬æ˜¯å¦‚ä½•è¢«åˆ†æçš„ã€‚åœ¨æ¶ˆæ¯ä½“é‡Œï¼ŒæŒ‡å®šåˆ†æå™¨å’Œè¦åˆ†æçš„æ–‡æœ¬ï¼š 12345GET /_analyze&#123; &quot;analyzer&quot;: &quot;standard&quot;, &quot;text&quot;: &quot;Text to analyze&quot;&#125; ç»“æœä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„è¯æ¡ï¼š 12345678910111213141516171819202122232425&#123; &quot;tokens&quot;: [ &#123; &quot;token&quot;: &quot;text&quot;, &quot;start_offset&quot;: 0, &quot;end_offset&quot;: 4, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 1 &#125;, &#123; &quot;token&quot;: &quot;to&quot;, &quot;start_offset&quot;: 5, &quot;end_offset&quot;: 7, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 2 &#125;, &#123; &quot;token&quot;: &quot;analyze&quot;, &quot;start_offset&quot;: 8, &quot;end_offset&quot;: 15, &quot;type&quot;: &quot;&lt;ALPHANUM&gt;&quot;, &quot;position&quot;: 3 &#125; ]&#125; token æ˜¯å®é™…å­˜å‚¨åˆ°ç´¢å¼•ä¸­çš„è¯æ¡ã€‚ position æŒ‡æ˜è¯æ¡åœ¨åŸå§‹æ–‡æœ¬ä¸­å‡ºç°çš„ä½ç½®ã€‚ start_offset å’Œ end_offset æŒ‡æ˜å­—ç¬¦åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚ æ¯ä¸ªåˆ†æå™¨çš„ type å€¼éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚å®ƒä»¬åœ¨Elasticsearchä¸­çš„å”¯ä¸€ä½œç”¨åœ¨äºâ€‹keep_types token è¿‡æ»¤å™¨â€‹ã€‚ analyze API æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒæœ‰åŠ©äºæˆ‘ä»¬ç†è§£Elasticsearchç´¢å¼•å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œéšç€æ·±å…¥ï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥è®¨è®ºå®ƒã€‚ æŒ‡å®šåˆ†æå™¨å½“Elasticsearchåœ¨ä½ çš„æ–‡æ¡£ä¸­æ£€æµ‹åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²åŸŸï¼Œå®ƒä¼šè‡ªåŠ¨è®¾ç½®å…¶ä¸ºä¸€ä¸ªå…¨æ–‡ å­—ç¬¦ä¸² åŸŸï¼Œä½¿ç”¨ æ ‡å‡† åˆ†æå™¨å¯¹å®ƒè¿›è¡Œåˆ†æã€‚ ä½ ä¸å¸Œæœ›æ€»æ˜¯è¿™æ ·ã€‚å¯èƒ½ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åˆ†æå™¨ï¼Œé€‚ç”¨äºä½ çš„æ•°æ®ä½¿ç”¨çš„è¯­è¨€ã€‚æœ‰æ—¶å€™ä½ æƒ³è¦ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åŸŸâ€”â€‹ä¸ä½¿ç”¨åˆ†æï¼Œç›´æ¥ç´¢å¼•ä½ ä¼ å…¥çš„ç²¾ç¡®å€¼ï¼Œä¾‹å¦‚ç”¨æˆ·IDæˆ–è€…ä¸€ä¸ªå†…éƒ¨çš„çŠ¶æ€åŸŸæˆ–æ ‡ç­¾ã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨æŒ‡å®šè¿™äº›åŸŸçš„æ˜ å°„ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"}]},{"title":"å€’æ’ç´¢å¼•","date":"2021-07-05T14:17:00.000Z","path":"wiki/å€’æ’ç´¢å¼•/","text":"Elasticsearch ä½¿ç”¨ä¸€ç§ç§°ä¸º å€’æ’ç´¢å¼• çš„ç»“æ„ï¼Œå®ƒé€‚ç”¨äºå¿«é€Ÿçš„å…¨æ–‡æœç´¢ã€‚ä¸€ä¸ªå€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤è¯çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºå…¶ä¸­æ¯ä¸ªè¯ï¼Œæœ‰ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£åˆ—è¡¨ã€‚ ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£çš„ content åŸŸåŒ…å«å¦‚ä¸‹å†…å®¹ï¼š The quick brown fox jumped over the lazy dogQuick brown foxes leap over lazy dogs in summerä¸ºäº†åˆ›å»ºå€’æ’ç´¢å¼•ï¼Œæˆ‘ä»¬é¦–å…ˆå°†æ¯ä¸ªæ–‡æ¡£çš„ content åŸŸæ‹†åˆ†æˆå•ç‹¬çš„ è¯ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸º è¯æ¡ æˆ– tokens ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¸é‡å¤è¯æ¡çš„æ’åºåˆ—è¡¨ï¼Œç„¶ååˆ—å‡ºæ¯ä¸ªè¯æ¡å‡ºç°åœ¨å“ªä¸ªæ–‡æ¡£ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ quick brown ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…åº¦æ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»…è®¡ç®—åŒ¹é…è¯æ¡æ•°é‡çš„ç®€å• ç›¸ä¼¼æ€§ç®—æ³• ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¯¹äºæˆ‘ä»¬æŸ¥è¯¢çš„ç›¸å…³æ€§æ¥è®²ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªæ–‡æ¡£æ›´ä½³ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ç›®å‰çš„å€’æ’ç´¢å¼•æœ‰ä¸€äº›é—®é¢˜ï¼š Quick å’Œ quick ä»¥ç‹¬ç«‹çš„è¯æ¡å‡ºç°ï¼Œç„¶è€Œç”¨æˆ·å¯èƒ½è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„è¯ã€‚fox å’Œ foxes éå¸¸ç›¸ä¼¼, å°±åƒ dog å’Œ dogs ï¼›ä»–ä»¬æœ‰ç›¸åŒçš„è¯æ ¹ã€‚jumped å’Œ leap, å°½ç®¡æ²¡æœ‰ç›¸åŒçš„è¯æ ¹ï¼Œä½†ä»–ä»¬çš„æ„æ€å¾ˆç›¸è¿‘ã€‚ä»–ä»¬æ˜¯åŒä¹‰è¯ã€‚ä½¿ç”¨å‰é¢çš„ç´¢å¼•æœç´¢ +Quick +fox ä¸ä¼šå¾—åˆ°ä»»ä½•åŒ¹é…æ–‡æ¡£ã€‚ï¼ˆè®°ä½ï¼Œ+ å‰ç¼€è¡¨æ˜è¿™ä¸ªè¯å¿…é¡»å­˜åœ¨ã€‚ï¼‰åªæœ‰åŒæ—¶å‡ºç° Quick å’Œ fox çš„æ–‡æ¡£æ‰æ»¡è¶³è¿™ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£åŒ…å« quick fox ï¼Œç¬¬äºŒä¸ªæ–‡æ¡£åŒ…å« Quick foxes ã€‚ æˆ‘ä»¬çš„ç”¨æˆ·å¯ä»¥åˆç†çš„æœŸæœ›ä¸¤ä¸ªæ–‡æ¡£ä¸æŸ¥è¯¢åŒ¹é…ã€‚æˆ‘ä»¬å¯ä»¥åšçš„æ›´å¥½ã€‚ å¦‚æœæˆ‘ä»¬å°†è¯æ¡è§„èŒƒä¸ºæ ‡å‡†æ¨¡å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸ç”¨æˆ·æœç´¢çš„è¯æ¡ä¸å®Œå…¨ä¸€è‡´ï¼Œä½†å…·æœ‰è¶³å¤Ÿç›¸å…³æ€§çš„æ–‡æ¡£ã€‚ä¾‹å¦‚ï¼š Quick å¯ä»¥å°å†™åŒ–ä¸º quick ã€‚foxes å¯ä»¥ è¯å¹²æå– â€“å˜ä¸ºè¯æ ¹çš„æ ¼å¼â€“ ä¸º fox ã€‚ç±»ä¼¼çš„ï¼Œ dogs å¯ä»¥ä¸ºæå–ä¸º dog ã€‚jumped å’Œ leap æ˜¯åŒä¹‰è¯ï¼Œå¯ä»¥ç´¢å¼•ä¸ºç›¸åŒçš„å•è¯ jump ã€‚ç°åœ¨ç´¢å¼•çœ‹ä¸Šå»åƒè¿™æ ·ï¼šè¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬æœç´¢ +Quick +fox ä»ç„¶ ä¼šå¤±è´¥ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ç´¢å¼•ä¸­ï¼Œå·²ç»æ²¡æœ‰ Quick äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æœç´¢çš„å­—ç¬¦ä¸²ä½¿ç”¨ä¸ content åŸŸç›¸åŒçš„æ ‡å‡†åŒ–è§„åˆ™ï¼Œä¼šå˜æˆæŸ¥è¯¢ +quick +fox ï¼Œè¿™æ ·ä¸¤ä¸ªæ–‡æ¡£éƒ½ä¼šåŒ¹é…ï¼ è¿™éå¸¸é‡è¦ã€‚ä½ åªèƒ½æœç´¢åœ¨ç´¢å¼•ä¸­å‡ºç°çš„è¯æ¡ï¼Œæ‰€ä»¥ç´¢å¼•æ–‡æœ¬å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²å¿…é¡»æ ‡å‡†åŒ–ä¸ºç›¸åŒçš„æ ¼å¼ã€‚","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"}]},{"title":"elasticsearchåˆ†é¡µæŸ¥è¯¢","date":"2021-07-05T14:08:23.000Z","path":"wiki/elasticsearchåˆ†é¡µæŸ¥è¯¢/","text":"å’Œ SQL ä½¿ç”¨ LIMIT å…³é”®å­—è¿”å›å•ä¸ª page ç»“æœçš„æ–¹æ³•ç›¸åŒï¼ŒElasticsearch æ¥å— from å’Œ size å‚æ•°ï¼š sizeæ˜¾ç¤ºåº”è¯¥è¿”å›çš„ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 10fromæ˜¾ç¤ºåº”è¯¥è·³è¿‡çš„åˆå§‹ç»“æœæ•°é‡ï¼Œé»˜è®¤æ˜¯ 0å¦‚æœæ¯é¡µå±•ç¤º 5 æ¡ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢æ–¹å¼è¯·æ±‚å¾—åˆ° 1 åˆ° 3 é¡µçš„ç»“æœï¼š GET /_search?size=5GET /_search?size=5&amp;from=5GET /_search?size=5&amp;from=10 âš ï¸ âš ï¸ âš ï¸è€ƒè™‘åˆ°åˆ†é¡µè¿‡æ·±ä»¥åŠä¸€æ¬¡è¯·æ±‚å¤ªå¤šç»“æœçš„æƒ…å†µï¼Œç»“æœé›†åœ¨è¿”å›ä¹‹å‰å…ˆè¿›è¡Œæ’åºã€‚ ä½†è¯·è®°ä½ä¸€ä¸ªè¯·æ±‚ç»å¸¸è·¨è¶Šå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½äº§ç”Ÿè‡ªå·±çš„æ’åºç»“æœï¼Œè¿™äº›ç»“æœéœ€è¦è¿›è¡Œé›†ä¸­æ’åºä»¥ä¿è¯æ•´ä½“é¡ºåºæ˜¯æ­£ç¡®çš„ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ·±åº¦åˆ†é¡µ ç†è§£ä¸ºä»€ä¹ˆæ·±åº¦åˆ†é¡µæ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨ä¸€ä¸ªæœ‰ 5 ä¸ªä¸»åˆ†ç‰‡çš„ç´¢å¼•ä¸­æœç´¢ã€‚ å½“æˆ‘ä»¬è¯·æ±‚ç»“æœçš„ç¬¬ä¸€é¡µï¼ˆç»“æœä» 1 åˆ° 10 ï¼‰ï¼Œæ¯ä¸€ä¸ªåˆ†ç‰‡äº§ç”Ÿå‰ 10 çš„ç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™ åè°ƒèŠ‚ç‚¹ ï¼Œåè°ƒèŠ‚ç‚¹å¯¹ 50 ä¸ªç»“æœæ’åºå¾—åˆ°å…¨éƒ¨ç»“æœçš„å‰ 10 ä¸ªã€‚ ç°åœ¨å‡è®¾æˆ‘ä»¬è¯·æ±‚ç¬¬ 1000 é¡µâ€”â€‹ç»“æœä» 10001 åˆ° 10010 ã€‚æ‰€æœ‰éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œé™¤äº†æ¯ä¸ªåˆ†ç‰‡ä¸å¾—ä¸äº§ç”Ÿå‰10010ä¸ªç»“æœä»¥å¤–ã€‚ ç„¶ååè°ƒèŠ‚ç‚¹å¯¹å…¨éƒ¨ 50050 ä¸ªç»“æœæ’åºæœ€åä¸¢å¼ƒæ‰è¿™äº›ç»“æœä¸­çš„ 50040 ä¸ªç»“æœã€‚ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯¹ç»“æœæ’åºçš„æˆæœ¬éšåˆ†é¡µçš„æ·±åº¦æˆæŒ‡æ•°ä¸Šå‡ã€‚è¿™å°±æ˜¯ web æœç´¢å¼•æ“å¯¹ä»»ä½•æŸ¥è¯¢éƒ½ä¸è¦è¿”å›è¶…è¿‡ 1000 ä¸ªç»“æœçš„åŸå›  å‚è€ƒèµ„æ–™ elasticsearchæƒå¨æŒ‡å— å¹²è´§ | å…¨æ–¹ä½æ·±åº¦è§£è¯» Elasticsearch åˆ†é¡µæŸ¥è¯¢","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"}]},{"title":"å¤šç´¢å¼•å¤šç±»å‹æœç´¢","date":"2021-07-05T14:02:34.000Z","path":"wiki/å¤šç´¢å¼•å¤šç±»å‹æœç´¢/","text":"å¦‚æœä¸å¯¹æŸä¸€ç‰¹æ®Šçš„ç´¢å¼•æˆ–è€…ç±»å‹åšé™åˆ¶ï¼Œå°±ä¼šæœç´¢é›†ç¾¤ä¸­çš„æ‰€æœ‰æ–‡æ¡£ã€‚Elasticsearch è½¬å‘æœç´¢è¯·æ±‚åˆ°æ¯ä¸€ä¸ªä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼Œæ±‡é›†æŸ¥è¯¢å‡ºçš„å‰10ä¸ªç»“æœï¼Œå¹¶ä¸”è¿”å›ç»™æˆ‘ä»¬ã€‚ ç„¶è€Œï¼Œç»å¸¸çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹æ®Šçš„ç´¢å¼•å¹¶ä¸”åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªç‰¹æ®Šçš„ç±»å‹ä¸­è¿›è¡Œæœç´¢ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨URLä¸­æŒ‡å®šç‰¹æ®Šçš„ç´¢å¼•å’Œç±»å‹è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š /_searchåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb/_searchåœ¨ gb ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb,us/_searchåœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„æ–‡æ¡£/g*,u*/_searchåœ¨ä»»ä½•ä»¥ g æˆ–è€… u å¼€å¤´çš„ç´¢å¼•ä¸­æœç´¢æ‰€æœ‰çš„ç±»å‹/gb/user/_searchåœ¨ gb ç´¢å¼•ä¸­æœç´¢ user ç±»å‹/gb,us/user,tweet/_searchåœ¨ gb å’Œ us ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹/_all/user,tweet/_searchåœ¨æ‰€æœ‰çš„ç´¢å¼•ä¸­æœç´¢ user å’Œ tweet ç±»å‹å½“åœ¨å•ä¸€çš„ç´¢å¼•ä¸‹è¿›è¡Œæœç´¢çš„æ—¶å€™ï¼ŒElasticsearch è½¬å‘è¯·æ±‚åˆ°ç´¢å¼•çš„æ¯ä¸ªåˆ†ç‰‡ä¸­ï¼Œå¯ä»¥æ˜¯ä¸»åˆ†ç‰‡ä¹Ÿå¯ä»¥æ˜¯å‰¯æœ¬åˆ†ç‰‡ï¼Œç„¶åä»æ¯ä¸ªåˆ†ç‰‡ä¸­æ”¶é›†ç»“æœã€‚å¤šç´¢å¼•æœç´¢æ°å¥½ä¹Ÿæ˜¯ç”¨ç›¸åŒçš„æ–¹å¼å·¥ä½œçš„â€”â€‹åªæ˜¯ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„åˆ†ç‰‡ã€‚ æ³¨æ„ âš ï¸æœç´¢ä¸€ä¸ªç´¢å¼•æœ‰äº”ä¸ªä¸»åˆ†ç‰‡å’Œæœç´¢äº”ä¸ªç´¢å¼•å„æœ‰ä¸€ä¸ªåˆ†ç‰‡å‡†ç¡®æ¥æ‰€è¯´æ˜¯ç­‰ä»·çš„ã€‚","tags":[],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"}]},{"title":"elasticsearché‡è¦é…ç½®","date":"2021-07-05T13:22:32.000Z","path":"wiki/elasticsearché‡è¦é…ç½®/","text":"è™½ç„¶Elasticsearchä»…éœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œä½†æœ‰è®¸å¤šè®¾ç½®éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¹¶ä¸”åœ¨è¿›å…¥ç”Ÿäº§ä¹‹å‰ç»å¯¹å¿…é¡»è¿›è¡Œé…ç½®ã€‚ path.data å’Œ path.logscluster.namenode.namebootstrap.memory_locknetwork.hostdiscovery.zen.ping.unicast.hostsdiscovery.zen.minimum_master_nodespath.data å’Œ path.logså¦‚æœä½¿ç”¨.zipæˆ–.tar.gzå½’æ¡£ï¼Œåˆ™æ•°æ®å’Œæ—¥å¿—ç›®å½•æ˜¯$ES_HOMEçš„å­æ–‡ä»¶å¤¹ã€‚ å¦‚æœè¿™äº›é‡è¦çš„æ–‡ä»¶å¤¹ä¿ç•™åœ¨å…¶é»˜è®¤ä½ç½®ï¼Œåˆ™å­˜åœ¨å°†Elasticsearchå‡çº§åˆ°æ–°ç‰ˆæœ¬æ—¶è¢«åˆ é™¤çš„é«˜é£é™©ã€‚ åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œè‚¯å®šå¾—æ›´æ”¹æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š 123path: logs: /var/log/elasticsearch data: /var/data/elasticsearch RPMå’ŒDebianå‘è¡Œç‰ˆå·²ç»ä½¿ç”¨æ•°æ®å’Œæ—¥å¿—çš„è‡ªå®šä¹‰è·¯å¾„ã€‚ path.data è®¾ç½®å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªè·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è·¯å¾„å°†ç”¨äºå­˜å‚¨æ•°æ®ï¼ˆå±äºå•ä¸ªåˆ†ç‰‡çš„æ–‡ä»¶å°†å…¨éƒ¨å­˜å‚¨åœ¨åŒä¸€æ•°æ®è·¯å¾„ä¸Šï¼‰ï¼š 12345path: data: - /mnt/elasticsearch_1 - /mnt/elasticsearch_2 - /mnt/elasticsearch_3 cluster.nameèŠ‚ç‚¹åªèƒ½åœ¨ç¾¤é›†ä¸ç¾¤é›†ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å…±äº«å…¶cluster.nameæ—¶æ‰èƒ½åŠ å…¥ç¾¤é›†ã€‚ é»˜è®¤åç§°ä¸ºelasticsearchï¼Œä½†æ‚¨åº”å°†å…¶æ›´æ”¹ä¸ºæè¿°é›†ç¾¤ç”¨é€”çš„é€‚å½“åç§°ã€‚cluster.name: logging-prodç¡®ä¿ä¸è¦åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„é›†ç¾¤åç§°ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´åŠ å…¥é”™è¯¯é›†ç¾¤çš„èŠ‚ç‚¹ã€‚ node.nameé»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå°†ä½¿ç”¨éšæœºç”Ÿæˆçš„uuidçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèŠ‚ç‚¹idã€‚ è¯·æ³¨æ„ï¼ŒèŠ‚ç‚¹IDæ˜¯æŒä¹…åŒ–çš„ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹é‡æ–°å¯åŠ¨æ—¶ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤é»˜è®¤èŠ‚ç‚¹åç§°ä¹Ÿä¸ä¼šæ›´æ”¹ã€‚é…ç½®ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„åç§°æ˜¯å€¼å¾—çš„ï¼Œè¿™æ˜¯é‡å¯èŠ‚ç‚¹åä¹Ÿèƒ½ä¸€ç›´ä¿æŒçš„ä¼˜åŠ¿ï¼šnode.name: prod-data-2node.nameä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæœåŠ¡å™¨çš„HOSTNAMEï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12node.name: $&#123;HOSTNAME&#125;bootstrap.memory_lock æ²¡æœ‰JVMè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šè¿™äº‹å¯¹äºèŠ‚ç‚¹çš„å¥åº·æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸€ç§å®ç°æ–¹æ³•æ˜¯å°†bootstrap.memory_lockè®¾ç½®ä¸ºtrueã€‚è¦ä½¿æ­¤è®¾ç½®ç”Ÿæ•ˆï¼Œéœ€è¦é¦–å…ˆé…ç½®å…¶ä»–ç³»ç»Ÿè®¾ç½®ã€‚ æœ‰å…³å¦‚ä½•æ­£ç¡®è®¾ç½®å†…å­˜é”å®šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯ç”¨bootstrap.memory_lockã€‚ network.hosté»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä»…ä»…ç»‘å®šåœ¨æœ¬åœ°å›è·¯åœ°å€â€”â€”å¦‚ï¼š127.0.0.1ä¸[::1]ã€‚è¿™åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè·‘ä¸€ä¸ªå¼€å‘èŠ‚ç‚¹æ˜¯è¶³å¤Ÿçš„ã€‚æç¤º äº‹å®ä¸Šï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šç›¸åŒçš„$ES_HOMEä½ç½®ä¸€åŒè¿è¡Œã€‚è¿™å¯ä»¥ç”¨äºæµ‹è¯•Elasticsearchå½¢æˆé›†ç¾¤çš„èƒ½åŠ›,ä½†è¿™ç§é…ç½®æ–¹å¼ä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒã€‚ ä¸ºäº†å°†å…¶å®ƒæœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¯ä»¥ç›¸äº’é€šè®¯çš„é›†ç¾¤ï¼Œä½ çš„èŠ‚ç‚¹å°†ä¸èƒ½ç»‘å®šåœ¨ä¸€ä¸ªå›è·¯åœ°å€ä¸Šã€‚ è¿™é‡Œæœ‰æ›´å¤šçš„ç½‘è·¯é…ç½®ï¼Œé€šå¸¸ä½ åªéœ€è¦é…ç½®network.hostï¼šnetwork.host: 192.168.1.10network.hostä¹Ÿå¯ä»¥é…ç½®æˆä¸€äº›èƒ½è¯†åˆ«çš„ç‰¹æ®Šçš„å€¼ï¼Œè­¬å¦‚ï¼š_local_ã€_siteã€_global_ï¼Œå®ƒä»¬å¯ä»¥ç»“åˆæŒ‡å®š:ip4ä¸ip6æ¥ä½¿ç”¨ã€‚æ›´å¤šç›¸ä¿¡ä¿¡æ¯è¯·å‚è§ï¼šç½‘è·¯é…ç½® é‡è¦ ğŸ‘‡ ä¸€æ—¦ä½ è‡ªå®šä¹‰äº†network.hostçš„é…ç½®ï¼ŒElasticsearchå°†å‡è®¾ä½ å·²ç»ä»å¼€å‘æ¨¡å¼è½¬åˆ°äº†ç”Ÿäº§æ¨¡å¼ï¼Œå¹¶å°†å‡çº§ç³»ç»Ÿæ£€æµ‹çš„è­¦å‘Šä¿¡æ¯ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼šå¼€å‘æ¨¡å¼vsç”Ÿäº§æ¨¡å¼ discovery.zen.ping.unicast.hostsï¼ˆå•æ’­å‘ç°ï¼‰å¼€ç®±å³ç”¨ï¼Œæ— éœ€ä»»ä½•ç½‘ç»œé…ç½®ï¼ŒElasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„å›è·¯åœ°å€ï¼Œå¹¶æ‰«æ9300å¹´åˆ°9305çš„ç«¯å£å»è¿æ¥åŒä¸€æœºå™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹,è¯•å›¾è¿æ¥åˆ°ç›¸åŒçš„æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å…¶ä»–èŠ‚ç‚¹ã€‚å®ƒæä¾›äº†ä¸éœ€è¦ä»»ä½•é…ç½®å°±èƒ½è‡ªåŠ¨ç»„å»ºé›†ç¾¤çš„ä½“éªŒã€‚å½“ä¸å…¶å®ƒæœºå™¨ä¸Šçš„èŠ‚ç‚¹è¦å½¢æˆä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªåœ¨çº¿ä¸”å¯è®¿é—®çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚åƒå¦‚ä¸‹æ¥é…ç½®ï¼š 1234discovery.zen.ping.unicast.hosts: - 192.168.1.10:9300 - 192.168.1.11 #â‘  - seeds.mydomain.com #â‘¡ â‘  æœªæŒ‡å®šç«¯å£æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„transport.profiles.default.portå€¼ï¼Œå¦‚æœæ­¤å€¼ä¹Ÿä¸ºè®¾ç½®åˆ™ä½¿ç”¨transport.tcp.port â‘¡ ä¸»æœºåå°†è¢«å°è¯•è§£ææˆèƒ½è§£æçš„å¤šä¸ªIP discovery.zen.minimum_master_nodesä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé…ç½®discovery-zen-minimum_master_nodeså°†éå¸¸é‡è¦ï¼Œä»–è§„å®šäº†å¿…é¡»è‡³å°‘è¦æœ‰å¤šå°‘ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚æ²¡æœ‰æ­¤è®¾ç½®æ—¶ï¼Œä¸€ä¸ªé›†ç¾¤åœ¨å‘ç”Ÿç½‘ç»œé—®é¢˜æ˜¯å¯èƒ½ä¼šåˆ†è£‚æˆå¤šä¸ªé›†ç¾¤â€”â€”è„‘è£‚â€”â€”è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§ï¼šé€šè¿‡minimum_master_nodesé¿å…è„‘è£‚ä¸ºé¿å…è„‘è£‚ï¼Œä½ éœ€è¦æ ¹æ®masterèŠ‚ç‚¹æ•°æ¥è®¾ç½®æ³•å®šäººæ•°ï¼š(master_eligible_nodes / 2) + 1æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæœ€å°çš„ä¸»èŠ‚ç‚¹æ•°å› è¢«è®¾ç½®ä¸º(3/2)+1æˆ–è€…æ˜¯2discovery.zen.minimum_master_nodes: 2 å‚è€ƒèµ„æ–™ elastic å®˜æ–¹æ–‡æ¡£ codingdict.com","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"}]},{"title":"elasticsearchæ“ä½œç´¢å¼•","date":"2021-07-05T13:11:01.000Z","path":"wiki/elasticsearchæ“ä½œç´¢å¼•/","text":"åˆ›å»ºç´¢å¼•12345678910111213141516171819202122232425262728293031PUT customer&#123; &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;email&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;order_serial&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_time&quot;: &#123; &quot;type&quot;: &quot;date&quot; &#125;, &quot;customer_order&quot;:&#123; &quot;type&quot;:&quot;join&quot;, &quot;relations&quot;:&#123; &quot;customer&quot;:&quot;order&quot; &#125; &#125; &#125; &#125;&#125; æŸ¥çœ‹ç´¢å¼•çš„mappingGET yj_visit_data/_mapping 1234567891011121314151617181920212223242526&#123; &quot;yj_visit_data&quot; : &#123; &quot;mappings&quot; : &#123; &quot;properties&quot; : &#123; &quot;_class&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125;, &quot;article&quot; : &#123; &quot;type&quot; : &quot;text&quot;, &quot;fields&quot; : &#123; &quot;keyword&quot; : &#123; &quot;type&quot; : &quot;keyword&quot;, &quot;ignore_above&quot; : 256 &#125; &#125; &#125; &#125; &#125; &#125;&#125; æŸ¥è¯¢æ‰€æœ‰GET yj_visit_data/_search 12345&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123;&#125; &#125;&#125; åˆ é™¤æ‰€æœ‰POST yj_visit_data/_delete_by_query 123456&#123; &quot;query&quot;: &#123; &quot;match_all&quot;: &#123; &#125; &#125;&#125; é€šè¿‡æ–‡ç« åˆ é™¤POST yj_visit_data/_delete_by_query 1234567&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;article.keyword&quot;: &quot;2019/01/3&quot; &#125; &#125;&#125; æ ¹æ®æ–‡ç« æŸ¥è¯¢GET yj_visit_data/_search 12345678&#123; &quot;query&quot;: &#123; &quot;match&quot;: &#123; &quot;article.keyword&quot;: &quot;2019/01/3&quot; &#125; &#125;&#125; ä¿®æ”¹ç´¢å¼•1234POST customer/_doc/1&#123; &quot;name&quot;:&quot;2&quot;&#125;","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"}]},{"title":"elasticsearchåŸºç¡€api","date":"2021-07-05T12:53:09.000Z","path":"wiki/elasticsearchåŸºç¡€cat_api/","text":"cat APIé›†ç¾¤å¥åº·çŠ¶æ€GET _cat/health?v&amp;pretty 12epoch timestamp cluster status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent1625489855 12:57:35 my-application yellow 1 1 35 35 0 0 23 0 - 60.3% æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè°ƒç”¨restæ¥å£ï¼šcurl -XGET â€˜localhost:9200/_cat/health?v&amp;prettyâ€™ 12epoch timestamp cluster status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent1475247709 17:01:49 elasticsearch green 1 1 0 0 0 0 0 0 - 100.0% æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åä¸º my-application çš„é›†ç¾¤ä¸ yellow çš„ statusã€‚ æ— è®ºä½•æ—¶æˆ‘ä»¬è¯·æ±‚é›†ç¾¤å¥åº·ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾— greenï¼Œyellowï¼Œæˆ–è€… red çš„ statusã€‚Green è¡¨ç¤ºä¸€åˆ‡æ­£å¸¸ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œ yellow è¡¨ç¤ºæ‰€æœ‰æ•°æ®å¯ç”¨ï¼Œä½†æ˜¯æœ‰äº›å‰¯æœ¬å°šæœªåˆ†é…ï¼ˆé›†ç¾¤åŠŸèƒ½é½å…¨ï¼‰ï¼Œred æ„å‘³ç€ç”±äºæŸäº›åŸå› æœ‰äº›æ•°æ®ä¸å¯ç”¨ã€‚æ³¨æ„ï¼Œé›†ç¾¤æ˜¯ redï¼Œå®ƒä»ç„¶å…·æœ‰éƒ¨åˆ†åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå®ƒå°†ç»§ç»­ä»å¯ç”¨çš„åˆ†ç‰‡ä¸­æœåŠ¡æœç´¢è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯æ‚¨å¯èƒ½éœ€è¦å°½å¿«å»ä¿®å¤å®ƒï¼Œå› ä¸ºæ‚¨å·²ç»ä¸¢å¤±æ•°æ®äº†ã€‚ å¦å¤–ï¼Œä»ä¸Šé¢çš„å“åº”ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…±è®¡ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰å’Œ 0 ä¸ª shardï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ”¾å…¥æ•°æ®çš„ã€‚æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é›†ç¾¤åç§°ï¼ˆelasticsearchï¼‰ï¼Œå¹¶ä¸” Elasticsearch é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ unicast networkï¼ˆå•æ’­ç½‘ç»œï¼‰æ¥å‘ç°åŒä¸€æœºå™¨ä¸Šçš„å…¶å®ƒèŠ‚ç‚¹ã€‚æœ‰å¯èƒ½æ‚¨ä¸å°å¿ƒåœ¨æ‚¨çš„ç”µè„‘ä¸Šå¯åŠ¨äº†å¤šä¸ªèŠ‚ç‚¹ï¼Œç„¶åå®ƒä»¬å…¨éƒ¨åŠ å…¥åˆ°äº†å•ä¸ªé›†ç¾¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨ä¸Šé¢çš„å“åº”ä¸­çœ‹åˆ°ä¸æ­¢ 1 ä¸ª nodeï¼ˆèŠ‚ç‚¹ï¼‰ã€‚ æŸ¥çœ‹é›†ç¾¤åˆ†å¸ƒGET _cat/nodes?v&amp;pretty 12ip heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name172.19.0.1 20 61 15 0.02 0.04 0.29 cdhilmrstw * redtom-es-1 æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•GET _cat/indices?v&amp;pretty 1234health status index uuid pri rep docs.count docs.deleted store.size pri.store.sizeyellow open rd-logstash-2021.06.19 p5iej71MQVW12s2awNv8nw 1 1 61236 0 16.3mb 16.3mbyellow open demo_index k6VTs7tdS0ysot-rPwxG9A 1 1 1 0 5.5kb 5.5kbgreen open kibana_sample_data_flights A7c5DViGSISii8FA0dNlGw 1 0 13059 0 5.6mb 5.6mb æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•çš„æ•°é‡GET _cat/count?v&amp;pretty 12epoch timestamp count1625490245 13:04:05 838913 ç£ç›˜åˆ†é…æƒ…å†µGET _cat/allocation?v&amp;pretty 123shards disk.indices disk.used disk.avail disk.total disk.percent host ip node 35 308.7mb 20.1gb 215.9gb 236.1gb 8 172.19.0.1 172.19.0.1 redtom-es-1 23 UNASSIGNED æŸ¥çœ‹shardæƒ…å†µGET _cat/shards?v&amp;pretty 12345678index shard prirep state docs store ip nodeyj_visit_data 0 p STARTED 0 208b 172.19.0.1 redtom-es-1yj_visit_data 0 r UNASSIGNED demo_index 0 p STARTED 1 5.5kb 172.19.0.1 redtom-es-1demo_index 0 r UNASSIGNED rbtags 0 p STARTED 0 208b 172.19.0.1 redtom-es-1.kibana_1 0 p STARTED 280 11.5mb 172.19.0.1 redtom-es-1.kibana_task_manager_1 0 p STARTED 5 5.8mb 172.19.0.1 redtom-es-1 yj_visit_data è®¾ç½®äº†ä¸€ä¸ªå‰¯æœ¬åˆ†åŒºï¼Œä½†æ˜¯æ²¡æœ‰å‰¯èŠ‚ç‚¹ï¼Œæ‰€ä»¥èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤ºæœªåˆ†é…ï¼› å‚è€ƒèµ„æ–™ Elastic å®˜æ–¹æ–‡æ¡£ codingdict.com","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"}]},{"title":"canalåŒæ­¥mysqlæ•°æ®åˆ°elasticsearch","date":"2021-07-05T03:26:50.000Z","path":"wiki/canalåŒæ­¥mysqlæ•°æ®åˆ°elasticsearch/","text":"é¦–å…ˆå®‰è£…elkæ¨èå¤§å®¶åˆ°elasicä¸­æ–‡ç¤¾åŒºå»ä¸‹è½½ ğŸ‘‰ ã€ä¼ é€ã€‘âš ï¸ elastcisearch | logstash | kibana çš„ç‰ˆæœ¬æœ€å¥½ä¿æŒä¸€ç›´ï¼Œå¦åˆ™ä¼šå‡ºç°å¾ˆå¤šå‘çš„ï¼Œåˆ‡è®°ï¼ å®‰è£…ELKçš„æ­¥éª¤è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œå¯ä»¥æŸ¥çœ‹ ğŸ‘‰ ã€TODOã€‘ ä¸‹è½½å®‰è£…canal-adaptercanal githubä¼ é€é—¨ ğŸ‘‰ ã€Alibaba Canalã€‘ canal-client æ¨¡å¼å¯ä»¥å‚ç…§canalç»™å‡ºçš„exampleé¡¹ç›®å’Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„ä¾‹å­æ¥æµ‹è¯• ä¾èµ–é…ç½®12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba.otter&lt;/groupId&gt; &lt;artifactId&gt;canal.client&lt;/artifactId&gt; &lt;version&gt;1.1.0&lt;/version&gt;&lt;/dependency&gt; åˆ›å»ºmavené¡¹ç›®ä¿è¯canal-server å·²ç»æ­£ç¡®å¯åŠ¨ ğŸ‘ˆ ç„¶åå¯åŠ¨ä¸‹é¢æœåŠ¡ï¼Œæ“ä½œæ•°æ®åº“å³å¯çœ‹åˆ°æ§åˆ¶å°çš„æ—¥å¿—è¾“å‡ºï¼› 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121package com.redtom.canal.deploy;import com.alibaba.otter.canal.client.CanalConnector;import com.alibaba.otter.canal.client.CanalConnectors;import com.alibaba.otter.canal.protocol.CanalEntry;import com.alibaba.otter.canal.protocol.Message;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.InitializingBean;import org.springframework.stereotype.Component;import java.net.InetSocketAddress;import java.util.List;/** * @Author gaolei * @Date 2021/6/30 2:57 ä¸‹åˆ * @Version 1.0 */@Slf4j@Componentclass CanalClient implements InitializingBean &#123; private final static int BATCH_SIZE = 1000; @Override public void afterPropertiesSet() throws Exception &#123; // åˆ›å»ºé“¾æ¥ CanalConnector connector = CanalConnectors.newSingleConnector(new InetSocketAddress(&quot;***.***.***.***&quot;, 11111), &quot;example&quot;, &quot;canal&quot;, &quot;canal&quot;); try &#123; //æ‰“å¼€è¿æ¥ connector.connect(); //è®¢é˜…æ•°æ®åº“è¡¨,å…¨éƒ¨è¡¨ connector.subscribe(&quot;.*\\\\..*&quot;); //å›æ»šåˆ°æœªè¿›è¡Œackçš„åœ°æ–¹ï¼Œä¸‹æ¬¡fetchçš„æ—¶å€™ï¼Œå¯ä»¥ä»æœ€åä¸€ä¸ªæ²¡æœ‰ackçš„åœ°æ–¹å¼€å§‹æ‹¿ connector.rollback(); while (true) &#123; // è·å–æŒ‡å®šæ•°é‡çš„æ•°æ® Message message = connector.getWithoutAck(BATCH_SIZE); //è·å–æ‰¹é‡ID long batchId = message.getId(); //è·å–æ‰¹é‡çš„æ•°é‡ int size = message.getEntries().size(); //å¦‚æœæ²¡æœ‰æ•°æ® if (batchId == -1 || size == 0) &#123; try &#123; //çº¿ç¨‹ä¼‘çœ 2ç§’ Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; else &#123; //å¦‚æœæœ‰æ•°æ®,å¤„ç†æ•°æ® printEntry(message.getEntries()); &#125; //è¿›è¡Œ batch id çš„ç¡®è®¤ã€‚ç¡®è®¤ä¹‹åï¼Œå°äºç­‰äºæ­¤ batchId çš„ Message éƒ½ä¼šè¢«ç¡®è®¤ã€‚ connector.ack(batchId); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; connector.disconnect(); &#125; &#125; /** * æ‰“å°canal serverè§£æbinlogè·å¾—çš„å®ä½“ç±»ä¿¡æ¯ */ private static void printEntry(List&lt;CanalEntry.Entry&gt; entrys) &#123; for (CanalEntry.Entry entry : entrys) &#123; if (entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONBEGIN || entry.getEntryType() == CanalEntry.EntryType.TRANSACTIONEND) &#123; //å¼€å¯/å…³é—­äº‹åŠ¡çš„å®ä½“ç±»å‹ï¼Œè·³è¿‡ continue; &#125; //RowChangeå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€è¡Œæ•°æ®å˜åŒ–çš„æ‰€æœ‰ç‰¹å¾ //æ¯”å¦‚isDdl æ˜¯å¦æ˜¯ddlå˜æ›´æ“ä½œ sql å…·ä½“çš„ddl sql beforeColumns afterColumns å˜æ›´å‰åçš„æ•°æ®å­—æ®µç­‰ç­‰ CanalEntry.RowChange rowChage; try &#123; rowChage = CanalEntry.RowChange.parseFrom(entry.getStoreValue()); &#125; catch (Exception e) &#123; throw new RuntimeException(&quot;ERROR ## parser of eromanga-event has an error , data:&quot; + entry.toString(), e); &#125; //è·å–æ“ä½œç±»å‹ï¼šinsert/update/deleteç±»å‹ CanalEntry.EventType eventType = rowChage.getEventType(); //æ‰“å°Headerä¿¡æ¯ log.info(&quot;headers:&#123;&#125; &quot;, String.format(&quot;================ã€‹; binlog[%s:%s] , name[%s,%s] , eventType : %s&quot;, entry.getHeader().getLogfileName(), entry.getHeader().getLogfileOffset(), entry.getHeader().getSchemaName(), entry.getHeader().getTableName(), eventType)); //åˆ¤æ–­æ˜¯å¦æ˜¯DDLè¯­å¥ if (rowChage.getIsDdl()) &#123; log.info(&quot;================ã€‹;isDdl: true,sql: &#123;&#125;&quot;, rowChage.getSql()); &#125; //è·å–RowChangeå¯¹è±¡é‡Œçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œæ‰“å°å‡ºæ¥ for (CanalEntry.RowData rowData : rowChage.getRowDatasList()) &#123; //å¦‚æœæ˜¯åˆ é™¤è¯­å¥ if (eventType == CanalEntry.EventType.DELETE) &#123; printColumn(rowData.getBeforeColumnsList()); //å¦‚æœæ˜¯æ–°å¢è¯­å¥ &#125; else if (eventType == CanalEntry.EventType.INSERT) &#123; printColumn(rowData.getAfterColumnsList()); //å¦‚æœæ˜¯æ›´æ–°çš„è¯­å¥ &#125; else &#123; //å˜æ›´å‰çš„æ•°æ® log.info(&quot;-------&gt;; before&quot;); printColumn(rowData.getBeforeColumnsList()); //å˜æ›´åçš„æ•°æ® log.info(&quot;-------&gt;; after&quot;); printColumn(rowData.getAfterColumnsList()); &#125; &#125; &#125; &#125; private static void printColumn(List&lt;CanalEntry.Column&gt; columns) &#123; for (CanalEntry.Column column : columns) &#123; log.info(&quot; &#123;&#125; : &#123;&#125; update= &#123;&#125;&quot;, column.getName(), column.getValue(), column.getUpdated()); &#125; &#125;&#125; canal-adapter æ¨¡å¼adapter é…ç½®æ–‡ä»¶å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546server: port: 8081spring: jackson: date-format: yyyy-MM-dd HH:mm:ss time-zone: GMT+8 default-property-inclusion: non_nullcanal.conf: mode: tcp #tcp kafka rocketMQ rabbitMQ flatMessage: true zookeeperHosts: syncBatchSize: 1 batchSize: 1 retries: 0 timeout: accessKey: secretKey: consumerProperties: # canal tcp consumer canal.tcp.server.host: 172.25.101.75:11111 canal.tcp.zookeeper.hosts: canal.tcp.batch.size: 500 canal.tcp.username: canal.tcp.password: srcDataSources: defaultDS: url: jdbc:mysql://xxxx:pppp/database?useUnicode=true username: root password: pwd canalAdapters: - instance: example # canal instance Name or mq topic name groups: - groupId: g1 outerAdapters: - name: logger - name: es7 hosts: 172.25.101.75:9300 # 127.0.0.1:9200 for rest mode properties: mode: transport # or rest# # security.auth: test:123456 # only used for rest mode cluster.name: my-application# - name: kudu# key: kudu# properties:# kudu.master.address: 127.0.0.1 # &#x27;,&#x27; split multi address æˆ‘çš„elasticsearchæ˜¯7.10.0ç‰ˆæœ¬çš„application.yml bootstrap.yml es6 es7 hbase kudu logback.xml META-INF rdbæ‰€ä»¥ï¼šğŸ‘‡ 123cd es7biz_order.yml customer.yml mytest_user.ymlvim customer.yml customer.yml é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 123456789101112dataSourceKey: defaultDSdestination: examplegroupId: g1esMapping: _index: customer _id: id relations: customer_order: name: customer sql: &quot;select t.id, t.name, t.email from customer t&quot; etlCondition: &quot;where t.c_time&gt;=&#123;&#125;&quot; commitBatch: 3000 åˆ›å»ºè¡¨ç»“æ„12345678910CREATE TABLE `customer` ( `id` bigint(20) DEFAULT NULL, `name` varchar(255) DEFAULT NULL, `email` varchar(255) DEFAULT NULL, `order_id` int(11) DEFAULT NULL, `order_serial` varchar(255) DEFAULT NULL, `order_time` datetime DEFAULT NULL, `customer_order` varchar(255) DEFAULT NULL, `c_time` datetime DEFAULT NULL) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; åˆ›å»ºç´¢å¼•12345678910111213141516171819202122232425262728293031PUT customer&#123; &quot;mappings&quot;:&#123; &quot;properties&quot;:&#123; &quot;id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;name&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;email&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_id&quot;: &#123; &quot;type&quot;: &quot;long&quot; &#125;, &quot;order_serial&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;, &quot;order_time&quot;: &#123; &quot;type&quot;: &quot;date&quot; &#125;, &quot;customer_order&quot;:&#123; &quot;type&quot;:&quot;join&quot;, &quot;relations&quot;:&#123; &quot;customer&quot;:&quot;order&quot; &#125; &#125; &#125; &#125;&#125; æµ‹è¯•canal-adapteråŒæ­¥æ•ˆæœåˆ›å»ºä¸€æ¡è®°å½•122021-07-05 11:50:53.725 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;1&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457053000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457053724,&quot;type&quot;:&quot;INSERT&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ 1234567891011121314151617181920212223242526272829303132&#123; &quot;took&quot; : 0, &quot;timed_out&quot; : false, &quot;_shards&quot; : &#123; &quot;total&quot; : 1, &quot;successful&quot; : 1, &quot;skipped&quot; : 0, &quot;failed&quot; : 0 &#125;, &quot;hits&quot; : &#123; &quot;total&quot; : &#123; &quot;value&quot; : 1, &quot;relation&quot; : &quot;eq&quot; &#125;, &quot;max_score&quot; : 1.0, &quot;hits&quot; : [ &#123; &quot;_index&quot; : &quot;customer&quot;, &quot;_type&quot; : &quot;_doc&quot;, &quot;_id&quot; : &quot;1&quot;, &quot;_score&quot; : 1.0, &quot;_source&quot; : &#123; &quot;name&quot; : &quot;1&quot;, &quot;email&quot; : &quot;1&quot;, &quot;customer_order&quot; : &#123; &quot;name&quot; : &quot;customer&quot; &#125; &#125; &#125; ] &#125;&#125; ä¿®æ”¹æ•°æ®122021-07-05 11:54:36.402 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457275000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:[&#123;&quot;name&quot;:&quot;1&quot;,&quot;email&quot;:&quot;1&quot;,&quot;order_id&quot;:1,&quot;order_serial&quot;:&quot;1&quot;,&quot;customer_order&quot;:&quot;1&quot;&#125;],&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457276401,&quot;type&quot;:&quot;UPDATE&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ åˆ é™¤ä¸€æ¡æ•°æ®122021-07-05 11:56:51.524 [pool-3-thread-1] DEBUG c.a.o.canal.client.adapter.es.core.service.ESSyncService - DML: &#123;&quot;data&quot;:[&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;2&quot;,&quot;email&quot;:&quot;2&quot;,&quot;order_id&quot;:2,&quot;order_serial&quot;:&quot;2&quot;,&quot;order_time&quot;:1625457046000,&quot;customer_order&quot;:&quot;2&quot;,&quot;c_time&quot;:1625457049000&#125;],&quot;database&quot;:&quot;redtom_dev&quot;,&quot;destination&quot;:&quot;example&quot;,&quot;es&quot;:1625457411000,&quot;groupId&quot;:&quot;g1&quot;,&quot;isDdl&quot;:false,&quot;old&quot;:null,&quot;pkNames&quot;:[],&quot;sql&quot;:&quot;&quot;,&quot;table&quot;:&quot;customer&quot;,&quot;ts&quot;:1625457411523,&quot;type&quot;:&quot;DELETE&quot;&#125;Affected indexes: customer Elastcisearch æ•ˆæœ å‚è€ƒèµ„æ–™ ä½¿ç”¨canal client-adapterå®Œæˆmysqlåˆ°esæ•°æ®åŒæ­¥æ•™ç¨‹(åŒ…æ‹¬å…¨é‡å’Œå¢é‡) es åŒæ­¥é—®é¢˜ #1514 Github issue","tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"}]},{"title":"mysqlé…ç½®binlog","date":"2021-07-05T03:06:36.000Z","path":"wiki/binlogé…ç½®/","text":"å¼€å¯binlog[mysqld]log-bin=mysql-bin #æ·»åŠ è¿™ä¸€è¡Œå°±okbinlog-format=ROW #é€‰æ‹©rowæ¨¡å¼server_id=1 #é…ç½®mysql replactionéœ€è¦å®šä¹‰ï¼Œä¸èƒ½å’Œcanalçš„slaveIdé‡å¤ æŸ¥çœ‹binlogçŠ¶æ€mysql&gt; show variables like â€˜binlog_formatâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| binlog_format | ROW |+---------------+-------+ show variables like â€˜log_binâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| log_bin | ON |+---------------+-------+","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQl","slug":"DataBase/MySQl","permalink":"http://example.com/categories/DataBase/MySQl/"}]},{"title":"mysqlå¸¸ç”¨å‘½ä»¤","date":"2021-07-05T03:06:36.000Z","path":"wiki/mysqlå¸¸ç”¨å‘½ä»¤/","text":"binlogç›¸å…³å‘½ä»¤mysql&gt; show variables like â€˜binlog_formatâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| binlog_format | ROW |+---------------+-------+ show variables like â€˜log_binâ€™; 12345+---------------+-------+| Variable_name | Value |+---------------+-------+| log_bin | ON |+---------------+-------+","tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}],"categories":[{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQl","slug":"DataBase/MySQl","permalink":"http://example.com/categories/DataBase/MySQl/"}]},{"title":"flinkç®€å•ä¸Šæ‰‹","date":"2021-07-04T14:23:43.000Z","path":"wiki/flinkç®€å•ä¸Šæ‰‹/","text":"mac å®‰è£… flink1ã€æ‰§è¡Œ brew install apache-flink å‘½ä»¤ 123456789gaolei:/ gaolei$ brew install apache-flinkUpdating Homebrew...==&gt; Auto-updated Homebrew! Updated 1 tap (homebrew/services).No changes to formulae.==&gt; Downloading https://archive.apache.org/dist/flink/flink-1.9.1/flink-1.9.1-bin-scala_2.11.tgz######################################################################## 100.0%ğŸº /usr/local/Cellar/apache-flink/1.9.1: 166 files, 277MB, built in 15 minutes 29 seconds 2ã€æ‰§è¡Œflinkå¯åŠ¨è„šæœ¬ 12/usr/local/Cellar/apache-flink/1.9.1/libexec/bin./start-cluster.sh WordCountæ‰¹å¤„ç†Demoåˆ›å»ºmavené¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ– æ³¨æ„è‡ªå·±çš„flinkç‰ˆæœ¬ ğŸ‘‡ğŸ‘‡ 12345678910111213141516171819202122&lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-streaming-java --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-streaming-java_2.12&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-java --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-java&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.flink&lt;/groupId&gt; &lt;artifactId&gt;flink-clients_2.12&lt;/artifactId&gt; &lt;version&gt;1.9.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; ç¼–å†™æ‰¹å¤„ç†ç¨‹åº123456789101112131415161718192021222324public static void main(String[] args) throws Exception &#123; // 1ã€åˆ›å»ºæ‰§è¡Œç¯å¢ƒ ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // 2ã€è¯»å–æ–‡ä»¶æ•°æ® String inputPath = &quot;/Users/gaolei/Documents/DemoProjects/flink-start/src/main/resources/hello.txt&quot;; DataSource&lt;String&gt; dataSource = env.readTextFile(inputPath); // å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç† æŒ‰ç…§ç©ºæ ¼åˆ†è¯å±•å¼€ è½¬æ¢æˆï¼ˆwordï¼Œ1ï¼‰äºŒå…ƒç»„ AggregateOperator&lt;Tuple2&lt;String, Integer&gt;&gt; result = dataSource.flatMap(new MyFlatMapper()) // æŒ‰ç…§ç¬¬ä¸€ä¸ªä½ç½® -&gt; word åˆ†ç»„ .groupBy(0) .sum(1); result.print(); &#125; public static class MyFlatMapper implements FlatMapFunction&lt;String, Tuple2&lt;String, Integer&gt;&gt; &#123; public void flatMap(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; collector) &#123; // é¦–å…ˆæŒ‰ç…§ç©ºæ ¼åˆ†è¯ String[] words = s.split(&quot; &quot;); // éå†æ‰€æœ‰çš„word åŒ…è£…æˆäºŒå…ƒç»„è¾“å‡º for (String word : words) &#123; collector.collect(new Tuple2&lt;String, Integer&gt;(word, 1)); &#125; &#125; &#125; å‡†å¤‡æ•°æ®æºæ–‡ä»¶123456hello sparkhello worldhello javahello flinkhow are youwhat is your name æ‰§è¡Œç»“æœ123456789101112(is,1)(what,1)(you,1)(flink,1)(name,1)(world,1)(hello,4)(your,1)(are,1)(java,1)(how,1)(spark,1)","tags":[{"name":"flink","slug":"flink","permalink":"http://example.com/tags/flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"Apache Flink","date":"2021-07-04T12:45:57.000Z","path":"wiki/flinkç®€ä»‹/","text":"å®˜æ–¹åœ°å€è¯·æˆ³ğŸ‘‰ ã€ä¼ é€ã€‘ Apache Flink is a framework and distributed processing engine for stateful computations over unbounded and bounded data streams. Flink has been designed to run in all common cluster environments, perform computations at in-memory speed and at any scale. Apache Flink æ˜¯ä¸€ä¸ªæ¡†æ¶å’Œåˆ†å¸ƒå¼å¤„ç†å™¨å¼•æ“ï¼Œç”¨äºå¯¹æ— ç•Œå’Œæœ‰ç•Œæ•°æ®è¿›è¡ŒçŠ¶æ€è®¡ç®—ï¼› Why Flink æµæ•°æ®æ›´çœŸå®åœ°ååº”äº†æˆ‘ä»¬çš„ç”Ÿæ´»æ–¹å¼ ä¼ ç»Ÿçš„æ•°æ®æ¶æ„æ˜¯åŸºäºæœ‰é™æ•°æ®é›†çš„ æˆ‘ä»¬çš„ç›®æ ‡1ã€ä½å»¶è¿Ÿ æ¯«ç§’çº§å“åº”2ã€é«˜åå èƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ® åˆ†å¸ƒå¼3ã€ç»“æœçš„å‡†ç¡®æ€§å’Œè‰¯å¥½çš„å®¹é”™æ€§ Where need Flink ç”µå•†å’Œå¸‚åœºè¥é”€æ•°æ®æŠ¥è¡¨ã€å¹¿å‘ŠæŠ•æ”¾ã€ä¸šåŠ¡æµç¨‹éœ€è¦ ç‰©è”ç½‘ï¼ˆIOTï¼‰ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®é‡‡é›†å’Œæ˜¾ç¤ºï¼Œå®æ—¶æŠ¥è­¦ï¼Œäº¤é€šè¿è¾“ä¸š ç”µä¿¡ä¸šåŸºç«™æµé‡è°ƒé… é“¶è¡Œå’Œé‡‘èä¸šå®æ—¶ç»“ç®—å’Œé€šçŸ¥æ¨é€ã€å®æ—¶æ£€æµ‹å¼‚å¸¸è¡Œä¸º ä¼ ç»Ÿæ•°æ®å¤„ç†æ¶æ„ ä¼ ç»Ÿçš„æ•°æ®å¤„ç†æ¶æ„å¦‚ä¸ŠğŸ‘†CRM(ç”¨æˆ·å…³ç³»ç³»ç»Ÿ)ï¼Œ Order System(è®¢å•ç³»ç»Ÿ), Web App (ç”¨æˆ·ç‚¹å‡»æ—¶é—´)ï¼Œå½“ç”¨æˆ·å‡ºå‘è¡Œä¸ºä¹‹åéœ€è¦ç³»ç»Ÿä½œå‡ºå“åº”ï¼Œé¦–å…ˆç”±ä¸Šå±‚çš„è®¡ç®—å±‚å¤„ç†è®¡ç®—é€»è¾‘ï¼Œè®¡ç®—å±‚çš„é€»è¾‘è®¡ç®—ä¾èµ–ä¸‹é¢çš„å­˜å‚¨å±‚ï¼Œè®¡ç®—å±‚è®¡ç®—å®Œæˆä¹‹åï¼Œå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§åŸºäºä¼ ç»Ÿæ•°æ®åº“æ–¹å¼æ— æ³•æ»¡è¶³é«˜å¹¶å‘åœºæ™¯ï¼Œæ•°æ®åº“çš„å¹¶å‘é‡éƒ½æ˜¯å¾ˆä½çš„ã€‚ åˆ†æå¤„ç†æµç¨‹ åˆ†æå¤„ç†æµç¨‹æ¶æ„å¦‚ä¸ŠğŸ‘†ï¼Œæ•°æ®å…ˆæœ‰ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ï¼Œç»è¿‡æå–ï¼Œæ¸…æ´—è¿‡æ»¤ç­‰ï¼Œå°†æ•°æ®å­˜æ”¾åˆ°æ•°æ®ä»“åº“ï¼Œç„¶åé€šè¿‡ä¸€äº›sqlå¤„ç†ï¼Œç”Ÿæˆæ•°æ®æŠ¥è¡¨å’Œä¸€äº›å…¶ä»–çš„æŸ¥è¯¢ã€‚ é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®æ—¶æ€§å¤ªå·®äº†ï¼Œå¤„ç†æµç¨‹å¤ªé•¿ï¼Œæ— æ³•æ»¡è¶³æ¯«ç§’çº§éœ€æ±‚ æ•°æ®æ¥æºä¸å”¯ä¸€ï¼Œèƒ½æ»¡è¶³æµ·é‡æ•°æ®å’Œé«˜å¹¶å‘çš„éœ€æ±‚ï¼Œä½†æ˜¯æ— æ³•æ»¡è¶³å®æ—¶çš„éœ€æ±‚ æœ‰çŠ¶æ€çš„æµå¼å¤„ç† æŠŠå½“å‰åšæµå¼è®¡ç®—æ‰€éœ€è¦çš„æ•°æ®ä¸å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯ç®€å•ç²—æš´çš„ç›´æ¥æ”¾åˆ°æœ¬åœ°å†…å­˜ä¸­ï¼› å†…å­˜ä¸ç¨³å®šï¼Ÿå‘¨æœŸæ€§çš„æ£€æŸ¥ç‚¹ï¼Œæ•°æ®å­˜ç›˜å’Œæ•…éšœæ£€æµ‹ï¼› lambdaæ¶æ„ç”¨ä¸¤å°ç³»ç»ŸåŒæ—¶ä¿éšœä½å»¶è¿Ÿå’Œç»“æœå‡†ç¡®ï¼› è¿™å¥—æ¶æ„åˆ†æˆä¸¤ä¸ªæµç¨‹ï¼Œä¸Šé¢ä¸ºæ‰¹å¤„ç†æµç¨‹ï¼Œæ•°æ®æ”¶é›†åˆ°ä¸€å®šç¨‹åºï¼Œäº¤ç»™æ‰¹å¤„ç†å™¨å¤„ç†ï¼Œæœ€ç»ˆäº§ç”Ÿä¸€ä¸ªæ‰¹å¤„ç†ç»“æœ ä¸‹é¢çš„æµç¨‹ä¸ºæµå¼å¤„ç†æµç¨‹ï¼Œä¿è¯èƒ½å¿«é€Ÿå¾—åˆ°ç»“æœ æœ€ç»ˆæœ‰æˆ‘ä»¬åœ¨åº”ç”¨å±‚æ ¹æ®å®é™…é—®é¢˜é€‰æ‹©å…·ä½“çš„å¤„ç†ç»“æœäº¤ç»™åº”ç”¨ç¨‹åºè¿™ç§æ¶æ„æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿå¯èƒ½å¾—åˆ°çš„ç»“æœæ˜¯ä¸å‡†ç¡®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¿«é€Ÿçš„å¾—åˆ°ä¸€ä¸ªå®æ—¶è®¡ç®—çš„ç»“æœï¼Œéš”ä¸€æ®µæ—¶é—´ä¹‹ååœ¨æ¥çœ‹æ‰¹å¤„ç†äº§ç”Ÿçš„ç»“æœã€‚å®ç°ä¸¤å°ç³»ç»Ÿå’Œç»´æŠ¤ä¸¤å¥—ç³»ç»Ÿï¼Œæˆæœ¬å¾ˆå¤§ï¼› ç¬¬ä¸‰ä»£æµå¼å¤„ç†æ¶æ„Apache Flink å¯ä»¥å®Œç¾è§£å†³ä¸Šé¢çš„é—®é¢˜ğŸ‘†Stromæ— æ³•æ»¡è¶³æµ·é‡æ•°æ®ï¼› Sparking Stream æ— æ³•æ»¡è¶³ä½å»¶è¿Ÿï¼› åŸºäºäº‹ä»¶é©±åŠ¨ ï¼ˆEvent-drivenï¼‰ å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®ä»»ä½•ç±»å‹çš„æ•°æ®éƒ½å¯ä»¥å½¢æˆä¸€ç§äº‹ä»¶æµã€‚ä¿¡ç”¨å¡äº¤æ˜“ã€ä¼ æ„Ÿå™¨æµ‹é‡ã€æœºå™¨æ—¥å¿—ã€ç½‘ç«™æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºä¸Šçš„ç”¨æˆ·äº¤äº’è®°å½•ï¼Œæ‰€æœ‰è¿™äº›æ•°æ®éƒ½å½¢æˆä¸€ç§æµã€‚æ•°æ®å¯ä»¥è¢«ä½œä¸º æ— ç•Œ æˆ–è€… æœ‰ç•Œ æµæ¥å¤„ç†ã€‚ æ— ç•Œæµ æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä½†æ²¡æœ‰å®šä¹‰æµçš„ç»“æŸã€‚å®ƒä»¬ä¼šæ— ä¼‘æ­¢åœ°äº§ç”Ÿæ•°æ®ã€‚æ— ç•Œæµçš„æ•°æ®å¿…é¡»æŒç»­å¤„ç†ï¼Œå³æ•°æ®è¢«æ‘„å–åéœ€è¦ç«‹åˆ»å¤„ç†ã€‚æˆ‘ä»¬ä¸èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°è¾¾å†å¤„ç†ï¼Œå› ä¸ºè¾“å…¥æ˜¯æ— é™çš„ï¼Œåœ¨ä»»ä½•æ—¶å€™è¾“å…¥éƒ½ä¸ä¼šå®Œæˆã€‚å¤„ç†æ— ç•Œæ•°æ®é€šå¸¸è¦æ±‚ä»¥ç‰¹å®šé¡ºåºæ‘„å–äº‹ä»¶ï¼Œä¾‹å¦‚äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œä»¥ä¾¿èƒ½å¤Ÿæ¨æ–­ç»“æœçš„å®Œæ•´æ€§ã€‚ æœ‰ç•Œæµ&lt;/&gt; æœ‰å®šä¹‰æµçš„å¼€å§‹ï¼Œä¹Ÿæœ‰å®šä¹‰æµçš„ç»“æŸã€‚æœ‰ç•Œæµå¯ä»¥åœ¨æ‘„å–æ‰€æœ‰æ•°æ®åå†è¿›è¡Œè®¡ç®—ã€‚æœ‰ç•Œæµæ‰€æœ‰æ•°æ®å¯ä»¥è¢«æ’åºï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æœ‰åºæ‘„å–ã€‚æœ‰ç•Œæµå¤„ç†é€šå¸¸è¢«ç§°ä¸ºæ‰¹å¤„ç† Apache Flink æ“…é•¿å¤„ç†æ— ç•Œå’Œæœ‰ç•Œæ•°æ®é›† ç²¾ç¡®çš„æ—¶é—´æ§åˆ¶å’ŒçŠ¶æ€åŒ–ä½¿å¾— Flink çš„è¿è¡Œæ—¶(runtime)èƒ½å¤Ÿè¿è¡Œä»»ä½•å¤„ç†æ— ç•Œæµçš„åº”ç”¨ã€‚æœ‰ç•Œæµåˆ™ç”±ä¸€äº›ä¸“ä¸ºå›ºå®šå¤§å°æ•°æ®é›†ç‰¹æ®Šè®¾è®¡çš„ç®—æ³•å’Œæ•°æ®ç»“æ„è¿›è¡Œå†…éƒ¨å¤„ç†ï¼Œäº§ç”Ÿäº†å‡ºè‰²çš„æ€§èƒ½ã€‚ å…¶ä»–ç‰¹ç‚¹ æ”¯æŒäº‹ä»¶æ—¶é—´ï¼ˆevent-timeï¼‰å’Œå¤„ç†æ—¶é—´ï¼ˆprocessing-timeï¼‰è¯­ä¹‰ ç²¾ç¡®ä¸€æ¬¡çš„çŠ¶æ€ä¸€è‡´æ€§ä¿è¯ ä½å»¶è¿Ÿ æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡ä¸ªäº‹ä»¶ï¼Œæ¯«ç§’çº§å»¶è¿Ÿ ä¸ä¼—å¤šå¸¸ç”¨çš„å­˜å‚¨ç³»ç»Ÿé“¾æ¥ é«˜å¯ç”¨ï¼ŒåŠ¨æ€æ‰©å±•ï¼Œæ”¯æŒ7*24å…¨å¤©è¿è¡Œ å‚è€ƒèµ„æ–™ 1ã€å°šç¡…è°· 2021 Flink Javaç‰ˆ2ã€Apache Flink Documentation","tags":[{"name":"flink","slug":"flink","permalink":"http://example.com/tags/flink/"}],"categories":[{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"}]},{"title":"æ‹¥å¡é¿å…","date":"2021-07-04T08:46:13.000Z","path":"wiki/æ‹¥å¡é¿å…/","text":"æ‹¥å¡é¿å…æ‹¥å¡æ§åˆ¶çš„æ…¢å¯åŠ¨æ˜¯ä»¥æŒ‡æ•°æ–¹å¼å¿«é€Ÿçš„é€šè¿‡è¯•æ¢æ¥æ‰©å¤§æ‹¥å¡çª—å£çš„ï¼Œä½†æ˜¯ä¸€æ—¦å‘ç”Ÿç½‘ç»œä¸¢åŒ…ï¼Œåˆ™è‚¯å®šæ˜¯å¾ˆå¤šæŠ¥æ–‡æ®µéƒ½ä¼šéƒ½æ˜¯ï¼Œå› ä¸ºçª—å£æ—¶ç§°è¢«å¢é•¿çš„ï¼›ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œéœ€è¦å¼•å…¥â€“ æ‹¥å¡é¿å… ä»€ä¹ˆæ˜¯æ‹¥å¡é¿å…æ‹¥å¡é¿å…ä¸ºäº†è§£å†³æ…¢å¯åŠ¨ä¸‹ï¼Œå½“æ‹¥å¡çª—å£è¶…å‡ºç½‘ç»œå¸¦å®½æ—¶å‘ç”Ÿçš„å¤§é‡ä¸¢åŒ…é—®é¢˜ï¼Œå®ƒæå‡ºä¸€ä¸ªã€Œæ…¢å¯åŠ¨é˜ˆå€¼ã€çš„æ¦‚å¿µï¼Œå½“æ‹¥å¡çª—å£åˆ°è¾¾è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œä¸åœ¨ä»¥æŒ‡æ•°æ–¹å¼å¢é•¿ï¼Œè€Œé€‰æ‹©æ¶¨å¹…æ¯”è¾ƒç¼“æ…¢çš„ã€Œçº¿æ€§å¢é•¿ã€ï¼Œè®¡ç®—æ–¹å¼ï¼š w cwnd += SMSS*SMSS/cwnd å½“æ‹¥å¡çª—å£åœ¨çº¿æ€§å¢é•¿æ—¶å‘ç”Ÿä¸¢åŒ…ï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®ä¸ºå½“å‰çª—å£çš„ä¸€åŠï¼Œæ…¢å¯åŠ¨çª—å£æ¢å¤åˆå§‹çª—å£ï¼ˆinit wndï¼‰ï¼› i æ‹¥å¡é¿å…å’Œæ…¢å¯åŠ¨æ˜¯ç»“åˆä½¿ç”¨çš„ï¼Œå½“å‘ç”Ÿç½‘ç»œä¸¢åŒ…æ˜¯ï¼Œæ‹¥å¡æ§åˆ¶é‡‡ç”¨å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿå¯åŠ¨æ¥è§£å†³ä¸¢åŒ…é—®é¢˜ï¼","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-å››æ¬¡æŒ¥æ‰‹/æ–­å¼€è¿æ¥","date":"2021-07-04T08:34:11.000Z","path":"wiki/TCP-å››æ¬¡æŒ¥æ‰‹-æ–­å¼€è¿æ¥/","text":"TCPæ–­å¼€è¿æ¥å››æ¬¡æŒ¥æ‰‹ å¼€å§‹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯å¤„ç†ã€establishedã€‘çŠ¶æ€ å®¢æˆ·ç«¯å‘é€ã€ŒFINã€æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥FIN-WAIT-1çŠ¶æ€ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„FINä¹‹åï¼Œæ¢å¤ä¸€ä¸ªACKï¼ŒåŒæ—¶è¿›å…¥CLOSE_WAITçŠ¶æ€ å®¢æˆ·ç«¯æ¥æ”¶åˆ°ACKä¹‹åï¼Œè¿›å…¥åˆ°FIN-WAIT-2çŠ¶æ€ æœåŠ¡ç«¯æ¥ç€å‘é€FINæŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥LAST-ACKçŠ¶æ€ å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯çš„FINæŠ¥æ–‡ä¹‹åï¼Œå‘é€ACKæŠ¥æ–‡ï¼Œå¹¶è¿›å…¥TIME_WAITçŠ¶æ€ å®¢æˆ·ç«¯åœ¨ç»å†2ä¸ªMSLæ—¶é—´ä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€ æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKä¹‹åï¼Œè¿›å…¥CLOSEçŠ¶æ€ i å¹¶ä¸æ˜¯æ‰€æœ‰çš„å››æ¬¡æŒ¥æ‰‹éƒ½æ˜¯ä¸Šè¿°æµç¨‹ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŒæ—¶å‘é€å…³é—­è¿æ¥çš„è¯·æ±‚å¦‚ä¸‹ğŸ‘‡ï¼š å¯ä»¥çœ‹åˆ°åŒæ–¹éƒ½ä¸»åŠ¨å‘èµ·æ–­å¼€è¯·æ±‚æ‰€ä»¥å„è‡ªéƒ½æ˜¯ä¸»åŠ¨å‘èµ·æ–¹ï¼ŒçŠ¶æ€ä¼šä» FIN_WAIT_1 éƒ½è¿›å…¥åˆ° CLOSING è¿™ä¸ªè¿‡åº¦çŠ¶æ€ç„¶åå†åˆ° TIME_WAITã€‚ i æŒ¥æ‰‹ä¸€å®šéœ€è¦å››æ¬¡å—ï¼Ÿ å‡è®¾ client å·²ç»æ²¡æœ‰æ•°æ®å‘é€ç»™ server äº†ï¼Œæ‰€ä»¥å®ƒå‘é€ FIN ç»™ server è¡¨æ˜è‡ªå·±æ•°æ®å‘å®Œäº†ï¼Œä¸å†å‘äº†ï¼Œå¦‚æœè¿™æ—¶å€™ server è¿˜æ˜¯æœ‰æ•°æ®è¦å‘é€ç»™ client é‚£ä¹ˆå®ƒå°±æ˜¯å…ˆå›å¤ ack ï¼Œç„¶åç»§ç»­å‘é€æ•°æ®ã€‚ç­‰ server æ•°æ®å‘é€å®Œäº†ä¹‹åå†å‘ client å‘é€ FIN è¡¨æ˜å®ƒä¹Ÿå‘å®Œäº†ï¼Œç„¶åç­‰ client çš„ ACK è¿™ç§æƒ…å†µä¸‹å°±ä¼šæœ‰å››æ¬¡æŒ¥æ‰‹ã€‚é‚£ä¹ˆå‡è®¾ client å‘é€ FIN ç»™ server çš„æ—¶å€™ server ä¹Ÿæ²¡æ•°æ®ç»™ clientï¼Œé‚£ä¹ˆ server å°±å¯ä»¥å°† ACK å’Œå®ƒçš„ FIN ä¸€èµ·å‘ç»™client ï¼Œç„¶åç­‰å¾… client çš„ ACKï¼Œè¿™æ ·ä¸å°±ä¸‰æ¬¡æŒ¥æ‰‹äº†ï¼Ÿ i ä¸ºä»€ä¹ˆè¦æœ‰ TIME_WAIT? æ–­å¼€è¿æ¥å‘èµ·æ–¹åœ¨æ¥å—åˆ°æ¥å—æ–¹çš„ FIN å¹¶å›å¤ ACK ä¹‹åå¹¶æ²¡æœ‰ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€æ³¢ç­‰å¾…ï¼Œç­‰å¾…æ—¶é—´ä¸º 2MSLã€‚MSL æ˜¯ Maximum Segment Lifetimeï¼Œå³æŠ¥æ–‡æœ€é•¿ç”Ÿå­˜æ—¶é—´ï¼ŒRFC 793 å®šä¹‰çš„ MSL æ—¶é—´æ˜¯ 2 åˆ†é’Ÿï¼ŒLinux å®é™…å®ç°æ˜¯ 30sï¼Œé‚£ä¹ˆ 2MSL æ˜¯ä¸€åˆ†é’Ÿã€‚ w é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç­‰ 2MSL å‘¢ï¼Ÿ å°±æ˜¯æ€•è¢«åŠ¨å…³é—­æ–¹æ²¡æœ‰æ”¶åˆ°æœ€åçš„ ACKï¼Œå¦‚æœè¢«åŠ¨æ–¹ç”±äºç½‘ç»œåŸå› æ²¡æœ‰åˆ°ï¼Œé‚£ä¹ˆå®ƒä¼šå†æ¬¡å‘é€ FINï¼Œ æ­¤æ—¶å¦‚æœä¸»åŠ¨å…³é—­æ–¹å·²ç» CLOSED é‚£å°±å‚»äº†ï¼Œå› æ­¤ç­‰ä¸€ä¼šå„¿ã€‚ å‡è®¾ç«‹é©¬æ–­å¼€è¿æ¥ï¼Œä½†æ˜¯åˆé‡ç”¨äº†è¿™ä¸ªè¿æ¥ï¼Œå°±æ˜¯äº”å…ƒç»„å®Œå…¨ä¸€è‡´ï¼Œå¹¶ä¸”åºå·è¿˜åœ¨åˆé€‚çš„èŒƒå›´å†…ï¼Œè™½ç„¶æ¦‚ç‡å¾ˆä½ä½†ç†è®ºä¸Šä¹Ÿæœ‰å¯èƒ½ï¼Œé‚£ä¹ˆæ–°çš„è¿æ¥ä¼šè¢«å·²å…³é—­è¿æ¥é“¾è·¯ä¸Šçš„ä¸€äº›æ®‹ç•™æ•°æ®å¹²æ‰°ï¼Œå› æ­¤ç»™äºˆä¸€å®šçš„æ—¶é—´æ¥å¤„ç†ä¸€äº›æ®‹ç•™æ•°æ®ã€‚ i ç­‰å¾… 2MSL ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Ÿ å¦‚æœæœåŠ¡å™¨ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆä¼šå‡ºç°å¤§é‡çš„èµ„æºå ç”¨ï¼Œéœ€è¦ç­‰åˆ° 2MSL æ‰ä¼šé‡Šæ”¾èµ„æºã€‚å¦‚æœæ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­å¤§é‡çš„è¿æ¥ï¼Œé‚£ä¹ˆåœ¨ 2MSL é‡Œé¢é‚£äº›ç«¯å£éƒ½æ˜¯è¢«å ç”¨çš„ï¼Œç«¯å£åªæœ‰ 65535 ä¸ªï¼Œå¦‚æœç«¯å£è€—å°½äº†å°±æ— æ³•å‘èµ·é€çš„è¿æ¥äº†ï¼Œä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæ¦‚ç‡å¾ˆä½ï¼Œè¿™ä¹ˆå¤šç«¯å£ä½ è¿™æ˜¯è¦å»ºç«‹å¤šå°‘ä¸ªè¿æ¥ï¼Ÿ","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"å¿«é€Ÿé‡ä¼ /å¿«é€Ÿæ¢å¤","date":"2021-07-04T08:33:35.000Z","path":"wiki/å¿«é€Ÿé‡ä¼ -å¿«é€Ÿæ¢å¤/","text":"å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤å¿«é€Ÿé‡ä¼  d ä¸ºä½•ä¼šæ¥æ”¶åˆ°ä»¥ä¸ªå¤±åºæ•°æ®æ®µï¼Ÿ è‹¥æŠ¥æ–‡ä¸¢å¤±ï¼Œå°†ä¼šäº§ç”Ÿè¿ç»­çš„å¤±åºACKæ®µ è‹¥ç½‘ç»œè·¯å¾„ä¸è®¾å¤‡å¯¼è‡´æ•°æ®æ®µå¤±åºï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ è‹¥æŠ¥æ–‡é‡å¤ï¼Œå°†ä¼šäº§ç”Ÿå°‘é‡çš„å¤±åºACKæ®µ å½“å‘é€ç«¯å‘é€pkt0æ˜¯æ­£å¸¸çš„ï¼Œç”±äºæ»‘åŠ¨çª—å£ä¸ºæ»¡ï¼Œå‘é€æ–¹å¯ä»¥ç»§ç»­å‘é€pkt1ï¼Œpkt2ï¼› åŠ å…¥pkt1å‘ç”Ÿäº†ä¸¢åŒ…ï¼Œè™½ç„¶pkt2æ¥æ”¶ç«¯æ¥æ”¶æˆåŠŸäº†ï¼Œä½†æ˜¯æ²¡æœ‰pkt1çš„æ•°æ®æ®µï¼Œæ¥æ”¶ç«¯è¿˜æ˜¯å‘é€ACK1çš„ç¡®è®¤æŠ¥æ–‡ï¼› åœ¨æ²¡æœ‰ã€Œå¿«é€Ÿé‡ä¼ ã€çš„æƒ…å†µä¸‹ï¼Œå‘é€ç«¯éœ€è¦ç­‰åˆ°RTOä¹‹åï¼Œæ‰å¯ä»¥é‡æ–°å‘é€pkt1 é‡ä¼ æˆåŠŸä¹‹åï¼Œæ¥æ”¶ç«¯å…¶å®æ”¶åˆ°äº†pkt2ä¹‹å‰çš„æ‰€æœ‰æ•°æ®æ®µï¼Œæ‰€ä»¥å‘é€ACK3çš„ç¡®è®¤æŠ¥æ–‡ w è¿™ç§éœ€è¦ç­‰å¾…RTOæ‰å¯ä»¥é‡ä¼ çš„æ–¹å¼æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ï¼Œå› æ­¤éœ€è¦å¿«é€Ÿé‡ä¼ æ¥è¿›è¡Œä¼˜åŒ–ï¼› å¿«é€Ÿé‡ä¼ å’Œç´¯ç§¯ç¡®è®¤ å½“å‘é€æ–¹è¿ç»­å‘é€pkt3ï¼Œpkt4ï¼Œpkt5ï¼Œpkt6å››ä¸ªæ•°æ®ç«¯ï¼Œä½†æ˜¯pkt5åœ¨ç½‘ç»œä¸­ä¸¢åŒ…äº†ï¼Œé‚£åé¢å‘é€çš„pkt6ï¼Œpkt7ï¼Œpkt8çš„ç¡®è®¤æŠ¥æ–‡éƒ½è¿”å›ACK5ï¼Œå¸Œæœ›å‘é€æ–¹åƒæ˜‚ä¼ pkt5çš„æ•°æ®æ®µï¼›è¿™ä¸ªæ—¶å€™ï¼Œå‘é€æ–¹æ”¶åˆ°è¿ç»­3ä¸ªç›¸åŒçš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¾¿ç«‹å³é‡æ–°å‘é€pkt5çš„æ•°æ®æ®µï¼› i æ¥æ”¶æ–¹: å½“æ¥æ”¶åˆ°ä¸€ä¸ªå¤±åºæ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘é€å®ƒæ‰€æœŸå¾…çš„ç¼ºå£ ACK åºåˆ—å· å½“æ¥æ”¶åˆ°å¡«å……å¤±åºç¼ºå£çš„æ•°æ®æ®µæ—¶ï¼Œç«‹åˆ»å‘ é€å®ƒæ‰€æœŸå¾…çš„ä¸‹ä¸€ä¸ª ACK åºåˆ—å· i å‘é€æ–¹ å½“æ¥æ”¶åˆ°3ä¸ªé‡å¤çš„å¤±åº ACK æ®µ(4ä¸ªç›¸åŒçš„å¤±åºACKæ®µ)æ—¶ï¼Œä¸å†ç­‰å¾…é‡ä¼ å®šæ—¶å™¨çš„è§¦å‘ï¼Œç«‹åˆ»åŸºäºå¿«é€Ÿé‡ä¼ æœºåˆ¶é‡å‘æŠ¥æ–‡æ®µ å½“pkt5é‡æ–°å‘é€å¹¶è¢«æ¥æ”¶ç«¯æ¥æ”¶ä¹‹åï¼Œæ¥æ”¶ç«¯å‘é€ACK9çš„ç¡®è®¤æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯å†åˆ†åˆ«å‘é€ACK6ï¼ŒACK7ï¼ŒACK8ï¼Œè¿™ä¸ªç§°è°“ã€Œ ç´¯è®¡ç¡®è®¤ ã€ã€‚ å¿«é€Ÿæ¢å¤ i å¿«é€Ÿé‡ä¼ ä¸‹ä¸€å®šè¦è¿›å…¥æ…¢å¯åŠ¨å—? æ¥å—ç«¯æ”¶åˆ°é‡å¤ACKï¼Œæ„å‘³ç€ç½‘ç»œä»åœ¨æµåŠ¨ï¼Œè€Œå¦‚æœè¦é‡æ–°è¿›å…¥æ…¢å¯åŠ¨ï¼Œä¼šå¯¼è‡´ç½‘ç»œçªç„¶å‡å°‘æ•°æ®æµï¼Œæ‹¥å¡çª—å£æ¢å¤åˆå§‹çª—å£ï¼Œæ‰€ä»¥ï¼Œã€Œåœ¨å¿«é€Ÿæ¢å¤ä¸‹å‘ç”Ÿä¸¢åŒ…çš„åœºæ™¯ä¸‹ã€ï¼Œåº”è¯¥ä½¿ç”¨å¿«é€Ÿæ¢å¤ï¼Œç®€å•çš„è®²ï¼Œå°±æ˜¯å°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ç½®æˆå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠï¼Œè€Œæ‹¥å¡çª—å£ä¹Ÿé€‚å½“æ”¾ä½ï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­—æ¢å¤åˆ°åˆå§‹çª—å£å¤§å°ï¼› å¿«é€Ÿæ¢å¤çš„æµç¨‹å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼ w å¿«é€Ÿæ¢å¤çš„å…·ä½“æ“ä½œï¼š å°† ssthresh è®¾ç½®ä¸ºå½“å‰æ‹¥å¡çª—å£ cwnd çš„ä¸€åŠï¼Œè®¾å½“å‰ cwnd ä¸º ssthresh åŠ ä¸Š 3*MSS æ¯æ”¶åˆ°ä¸€ä¸ªé‡å¤ ACKï¼Œcwnd å¢åŠ  1 ä¸ª MSS å½“æ–°æ•°æ® ACK åˆ°è¾¾åï¼Œè®¾ç½® cwnd ä¸º ssthresh","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-æ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨","date":"2021-07-04T08:33:19.000Z","path":"wiki/TCP-æ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨/","text":"ç”±äºTCPæ˜¯é¢å‘å­—èŠ‚æµçš„ä¼ è¾“åè®®ï¼Œå¯ä»¥å‘é€ä¸å®šé•¿çš„å­—èŠ‚æµæ•°æ®ï¼ŒTCPè¿æ¥å‘é€æ•°æ®æ—¶ä¼šâ€œå…ˆå¤©æ€§â€å°è¯•å ç”¨æ•´ä¸ªå¸¦å®½ï¼Œè€Œå½“æ‰€æœ‰çš„TCPè¿æ¥éƒ½å°è¯•å ç”¨ç½‘ç»œå¸¦å®½æ—¶ï¼Œå°±ä¼šé€ æˆç½‘ç»œçš„å µå¡ï¼Œè€ŒTCPæ…¢å¯åŠ¨ç®—æ³•åˆ™æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€åœºæ™¯ï¼› å…¨å±€æ€è€ƒ æ‹¥å¡æ§åˆ¶è¦é¢å‘æ•´ä½“æ€è€ƒï¼Œå¦‚ä¸ŠğŸ‘†ç½‘ç»œæ‹“æ‰‘å›¾ï¼Œå½“å·¦è¾¹çš„ç½‘ç»œèŠ‚ç‚¹é€šè¿‡è·¯ç”±äº¤æ¢è®¾å¤‡å‘å³è¾¹çš„è®¾å¤‡ä¼ è¾“æŠ¥æ–‡çš„æ—¶å€™ï¼Œä¸­é—´çš„æŸä¸€é“¾è·¯çš„å¸¦å®½è‚¯å®šæ˜¯ä¸€å®šçš„ï¼Œè¿™é‡Œå‡è®¾1000Må¸¦å®½ï¼Œå½“å·¦è¾¹R1ä»¥700Mb/sçš„é€Ÿåº¦å‘é“¾è·¯ä¸­å‘é€æ•°æ®ï¼ŒåŒæ—¶R2ä»¥600Mb/sçš„é€Ÿç‡å‘é€æŠ¥æ–‡ï¼Œé‚£åŠ¿å¿…ä¼šæœ‰300Mbçš„æ•°æ®æŠ¥ä¸¢å¤±ï¼›ã€Œè·¯ç”±äº¤æ¢è®¾å¤‡åŸºäºå­˜å‚¨è½¬å‘æ¥å®ç°æŠ¥æ–‡çš„å‘é€ã€å¤§é‡æŠ¥æ–‡éƒ½æ˜¯æ—¶ï¼Œè·¯ç”±è®¾å¤‡çš„ç¼“å†²é˜Ÿåˆ—è‚¯å®šæ˜¯æ…¢çš„ï¼Œè¿™ä¹Ÿä¼šé€ æˆæŸäº›æ•°æ®æŠ¥åœ¨ç½‘ç»œé“¾è·¯ä¸­åœç•™æ—¶é—´è¿‡é•¿ï¼Œä»è€Œå¯¼è‡´TCPé€šè®¯å˜æ…¢ï¼Œç”šè‡³ç½‘ç»œç˜«ç—ªï¼› ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå½“é“¾è·¯å¸¦å®½å æ»¡ä»¥åï¼Œé“¾è·¯ä»¥æœ€å¤§å¸¦å®½ä¼ è¾“æ•°æ®ï¼Œå½“ç„¶æ˜¾ç¤ºä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå½“å‘ç”Ÿè½»åº¦æ‹¥å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡å°±å¼€å§‹ä¸‹é™äº†ï¼Œå‘å±•åˆ°ä¸¥é‡é˜»å¡æ—¶ï¼Œé“¾è·¯çš„ååé‡ä¼šä¸¥é‡åœ°ä¸‹é™ï¼Œç”šè‡³ç˜«ç—ªï¼› é‚£ä¹ˆï¼Œæ…¢å¯åŠ¨æ˜¯å¦‚ä½•å‘æŒ¥ä½œç”¨çš„å‘¢ï¼Ÿ æ‹¥å¡çª—å£ s æ‹¥å¡çª—å£cwnd(congestion window) é€šå‘Šçª—å£rwnd(receiverâ€˜s advertised window) å…¶å®å°±æ˜¯RCV.WNDï¼Œæ ‡å¿—åœ¨TCPé¦–éƒ¨çš„Windowå­—æ®µï¼ å‘é€çª—å£swnd = min(cwndï¼Œrwnd) å‰é¢å­¦ä¹ æ»‘åŠ¨çª—å£çš„æ—¶å€™æåˆ°å‘é€çª—å£å¤§è‡´ç­‰äºæ¥å—çª—å£ï¼Œå½“å¼•å…¥æ‹¥å¡çª—å£æ—¶ï¼Œå‘é€çª—å£å°±æ˜¯æ‹¥å¡çª—å£å’Œå¯¹æ–¹æ¥å—çª—å£çš„æœ€å°å€¼ i æ¯æ”¶åˆ°ä¸€ä¸ªACKï¼Œcwndæ‰©å……ä¸€å€ æ…¢å¯åŠ¨çš„çª—å£å¤§å°å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿå¦‚ä¸Šæ‰€ç¤ºï¼Œèµ·åˆæ‹¥å¡çª—å£è®¾ç½®æˆ1ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå½“å‘é€ç«¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…æ—¶ï¼Œè°ƒæ•´æ‹¥å¡çª—å£ä¸º2ä¸ªæŠ¥æ–‡æ®µå¤§å°ï¼Œå¦‚æœè¿˜æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…ï¼Œä¸€æ¬¡ç±»æ¨ï¼ŒçŸ¥é“å‘ç”Ÿä¸¢åŒ…åœæ­¢ï¼›å‘é€çª—å£ä»¥ã€ŒæŒ‡æ•°ã€çš„æ–¹å¼æ‰©å¤§ï¼›æ…¢å¯åŠ¨æ˜¯æ— æ³•ç¡®çŸ¥ç½‘ç»œæ‹¥å¡ç¨‹åº¦çš„æƒ…å†µä¸‹ï¼Œä»¥è¯•æ¢æ€§åœ°æ–¹å¼å¿«é€Ÿæ‰©å¤§æ‹¥å¡çª—å£ï¼› æ…¢å¯åŠ¨åˆå§‹çª—å£æ…¢å¯åŠ¨çš„æ‹¥å¡çª—å£çœŸçš„å°±å¦‚ä¸Šé¢æ‰€è¯´çš„ä»¥ä¸€ä¸ªæŠ¥æ–‡æ®µå¤§å°ä½œä¸ºåˆå§‹å€¼å—ï¼Ÿ w æ…¢å¯åŠ¨åˆå§‹çª—å£ IW(Initial Window)çš„å˜è¿ 1 SMSS:RFC2001(1997) 2 - 4 SMSS:RFC2414(1998) IW = min (4SMSS, max (2SMSS, 4380 bytes)) 10 SMSS:RFC6928(2013) IW = min (10MSS, max (2MSS, 14600)) w å…¶å®åœ¨å®é™…æƒ…å†µä¸‹ï¼Œäº’è”ç½‘ä¸­çš„ç½‘é¡µéƒ½åœ¨10ä¸ªmsså·¦å³ï¼Œå¦‚æœè¿˜æ˜¯ä»1ä¸ªmsså¼€å§‹ï¼Œåˆ™ä¼šæµªè´¹3ä¸ªRTTçš„æ—¶é—´ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡","date":"2021-07-04T08:32:55.000Z","path":"wiki/TCP-å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡/","text":"å¦‚ä½•å‡å°‘å°æŠ¥æ–‡æå‡ç½‘ç»œæ•ˆç‡æ¯ä¸€ä¸ªTCPæŠ¥æ–‡æ®µéƒ½åŒ…å«20å­—èŠ‚çš„IPå¤´éƒ¨å’Œ20å­—èŠ‚çš„TCPé¦–éƒ¨ï¼Œå¦‚æœæŠ¥æ–‡æ®µçš„æ•°æ®éƒ¨åˆ†å¾ˆå°‘çš„è¯ï¼Œç½‘ç»œæ•ˆç‡ä¼šå¾ˆå·®ï¼› SWS(Silly Window syndrome) ç³Šæ¶‚çª—å£ç»¼åˆç—‡ å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºåœºæ™¯ï¼Œåœ¨ä¹‹å‰çš„æ»‘åŠ¨çª—å£å·²ç»äº†è§£è¿‡ï¼Œéšç€æœåŠ¡ç«¯å¤„ç†è¿æ¥æ•°æ®èƒ½åŠ›è¶Šæ¥è¶Šä½ï¼ŒæœåŠ¡ç«¯çš„å¯ç”¨çª—å£ä¸æ–­å‹ç¼©ï¼Œæœ€ç»ˆå¯¼è‡´çª—å£å…³é—­ï¼› SWS é¿å…ç®—æ³•SWS é¿å…ç®—æ³•å¯¹å‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½åšå®¢ æ¥æ”¶æ–¹ i David D Clark ç®—æ³•:çª—å£è¾¹ç•Œç§»åŠ¨å€¼å°äº min(MSS, ç¼“å­˜/2)æ—¶ï¼Œé€šçŸ¥çª—å£ä¸º 0 å‘é€æ–¹ w Nagle ç®—æ³•:1ã€TCP_NODELAY ç”¨äºå…³é—­ Nagle ç®—æ³•2ã€æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç«‹åˆ»å‘é€æ•°æ®3ã€å­˜åœ¨æœªç¡®è®¤æŠ¥æ–‡æ®µæ—¶ï¼Œç›´åˆ°:1-æ²¡æœ‰å·²å‘é€æœªç¡®è®¤æŠ¥æ–‡æ®µï¼Œæˆ–è€… 2-æ•°æ®é•¿åº¦è¾¾åˆ°MSSæ—¶å†å‘é€ TCP delayed acknowledgment å»¶è¿Ÿç¡®è®¤å®é™…æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æºå¸¦ä»»ä½•æ•°æ®çš„ACKæŠ¥æ–‡ä¹Ÿä¼šé€ æˆç½‘ç»œæ•ˆç‡ä½ä¸‹çš„ï¼Œå› ä¸ºç¡®è®¤æŠ¥æ–‡ä¹ŸåŒ…å«40å­—èŠ‚çš„å¤´éƒ¨ä¿¡æ¯ï¼Œä½†ä»…ä»…æ˜¯ä¸ºäº†ä¼ è¾“ACK=1è¿™æ ·çš„ä¿¡æ¯ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼ŒTCPæœ‰ä¸€ç§æœºåˆ¶ï¼Œå«åšå»¶è¿Ÿç¡®è®¤ï¼Œå¦‚ä¸‹ğŸ‘‡ï¼š å½“æœ‰å“åº”æ•°æ®è¦å‘é€æ—¶,ackä¼šéšç€å“åº”æ•°æ®ç«‹å³å‘é€ç»™å¯¹æ–¹. å¦‚æœæ²¡æœ‰å“åº”æ•°æ®,ackçš„å‘é€å°†ä¼šæœ‰ä¸€ä¸ªå»¶è¿Ÿ,ä»¥ç­‰å¾…çœ‹æ˜¯å¦æœ‰å“åº”æ•°æ®å¯ä»¥ä¸€èµ·å‘é€ å¦‚æœåœ¨ç­‰å¾…å‘é€ackæœŸé—´,å¯¹æ–¹çš„ç¬¬äºŒä¸ªæ•°æ®æ®µåˆåˆ°è¾¾äº†,è¿™æ—¶è¦ç«‹å³å‘é€ack é‚£ä¸ªå»¶è¿Ÿçš„æ—¶é—´å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ ä¸Šé¢ğŸ‘†æ˜¯Linuxæ“ä½œç³»ç»Ÿå¯¹äºTCPå»¶æ—¶çš„å®šä¹‰ã€‚ HZæ˜¯ä»€å‘¢ï¼Ÿå…¶å®é‚£æ˜¯å’Œæ“ä½œç³»ç»Ÿçš„æ—¶é’Ÿç›¸å…³çš„ï¼Œå…·ä½“çš„æ“ä½œç³»ç»Ÿé—´å„æœ‰å·®åˆ«ï¼›å¦‚ä½•æŸ¥çœ‹Linuxæ“ä½œç³»ç»Ÿä¸‹çš„HZå¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ 1cat /boot/config- `-uname -r` | grep &#x27;^GONFIG_HZ=&#x27; TCP_CORK sendfile é›¶æ‹·è´æŠ€æœ¯","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-æ»‘åŠ¨çª—å£","date":"2021-07-04T08:32:40.000Z","path":"wiki/TCP-æ»‘åŠ¨çª—å£/","text":"æ»‘åŠ¨çª—å£ i ä¹‹å‰å­¦ä¹ äº†PARæ–¹å¼çš„TCPè¶…æ—¶å’Œé‡ä¼ ï¼Œå…¶å®åœ¨è€ƒè™‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥çš„åŒæ—¶ï¼Œä¹Ÿåº”è¯¥è€ƒè™‘æ¥æ”¶æ–¹å¯¹äºæ•°æ®çš„å¤„ç†èƒ½åŠ›ï¼Œç”±æ­¤å¼•å‡ºæœ¬æ¬¡å­¦ä¹ çš„ä¸»é¢˜ â€“ æ»‘åŠ¨çª—å£ å‘é€ç«¯çª—å£æ»‘åŠ¨çª—å£æŒ‰ç…§ä¼ è¾“æ•°æ®æ–¹å‘åˆ†ä¸ºä¸¤ç§ï¼Œå‘é€ç«¯çª—å£å’Œæ¥æ”¶ç«¯çª—å£ï¼›ä¸‹é¢å…ˆçœ‹ä¸€ä¸‹å‘é€ç«¯çª—å£ğŸ‘‡ï¼š ä¸Šå›¾åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š å·²å‘é€å¹¶æ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:1-31 å­—èŠ‚ å·²å‘é€æœªæ”¶åˆ° Ack ç¡®è®¤çš„æ•°æ®:32-45 å­—èŠ‚ æœªå‘é€ä½†æ€»å¤§å°åœ¨æ¥æ”¶æ–¹å¤„ç†èŒƒå›´å†…:46-51 å­—èŠ‚ æœªå‘é€ä½†æ€»å¤§å°è¶…å‡ºæ¥æ”¶æ–¹å¤„ç†èŒƒå›´:52-å­—èŠ‚ å¯ç”¨çª—å£å’Œå‘é€çª—å£ å¦‚ä¸Šå›¾è¿™é‡Œå¯ä»¥å¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼šã€Œå¯ç”¨çª—å£ã€å’Œã€Œå‘é€çª—å£ã€ s ã€ å¯ç”¨çª—å£ ã€‘ï¼š å°±æ˜¯ä¸Šå›¾ä¸­çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå±äºè¿˜æœªå‘é€ï¼Œä½†æ˜¯åœ¨æ¥æ”¶ç«¯å¯ä»¥å¤„ç†èŒƒå›´å†…çš„éƒ¨åˆ†ï¼›ã€ å‘é€çª—å£ ã€‘ï¼š å°±æ˜¯å‘é€ç«¯å¯ä»¥å‘é€çš„æœ€å¤§æŠ¥æ–‡å¤§å°ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ç¬¬äºŒéƒ¨åˆ†+ç¬¬ä¸‰éƒ¨åˆ†åˆæˆå‘é€çª—å£ï¼› å¯ç”¨çª—å£è€—å°½ å¯ç”¨çª—å£ä¼šåœ¨ä¸€ä¸ªçŸ­æš‚çš„åœç•™ï¼Œå½“å¤„äºæœªå‘é€å¹¶ä¸”æ¥å—ç«¯å¯ä»¥æ¥å—èŒƒå›´å†…çš„æ•°æ®ä¼ è¾“å®Œæˆä¹‹åï¼Œå¯ç”¨çª—å£è€—å°½ï¼›å½“ç„¶ä¸Šé¢ä»…ä»…è¯´çš„ä¸€ç¬æ—¶çš„çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸‹ï¼Œå·²ç»å‘é€çš„æŠ¥æ–‡æ®µè¿˜æ²¡æœ‰ç¡®è®¤ï¼Œå¹¶ä¸”å‘é€çª—å£å¤§å°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å‘é€çª—å£è¾¾åˆ°æœ€å¤§çŠ¶æ€ï¼› çª—å£ç§»åŠ¨ å¦‚æœåœ¨å‘é€çª—å£ä¸­å·²ç»å‘é€çš„æŠ¥æ–‡æ®µå·²ç»å¾—åˆ°æ¥å—ç«¯ç¡®è®¤ä¹‹åï¼Œé‚£éƒ¨åˆ†æ•°æ®å°±ä¼šè¢«ç§»é™¤å‘é€çª—å£ï¼Œåœ¨å‘é€çª—å£å¤§å°ä¸å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå‘é€çª—å£å‘å³â¡ï¸ç§»åŠ¨5ä¸ªå­—èŠ‚ï¼Œå› ä¸ºå·¦è¾¹å·²ç»å‘é€çš„5ä¸ªå­—èŠ‚å¾—åˆ°ç¡®è®¤ä¹‹åï¼Œè¢«ç§»é™¤å‘é€çª—å£ï¼› å¯ç”¨çª—å£å¦‚ä½•è®¡ç®— å†æ¬¡å¼•å‡ºä¸‰ä¸ªæ¦‚å¿µï¼š SND.WND i SND æŒ‡çš„æ˜¯å‘é€ç«¯ï¼ŒWNDæŒ‡çš„æ˜¯windowï¼Œä¹Ÿå°±æ˜¯å‘é€ç«¯çª—å£çš„æ„æ€ SND.UNA i UNA å°±æ˜¯un ACKçš„æ„æ€ï¼ŒæŒ‡çš„æ˜¯å·²ç»å‘é€ä½†æ˜¯æ²¡æœ‰æ²¡æœ‰ç¡®è®¤ å®ƒæŒ‡å‘çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„ SND.NXT i NXT æ˜¯nextçš„ä½ç½®ï¼Œæ˜¯å‘é€æ–¹æ¥ä¸‹æ¥è¦å‘é€çš„ä½ç½®ï¼Œå®ƒæŒ‡å‘å¯ç”¨çª—å£çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¤„ é‚£å°±å¾ˆå®¹æ˜“å¾—å‡ºå¯ç”¨çª—å£çš„å¤§å°äº†ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š i Usable Window Size = SND.UNA + SND.WND - SND.NXT æ¥æ”¶ç«¯çª—å£ä¸Šé¢ä»‹ç»äº†å‘é€ç«¯çª—å£çš„ä¸€äº›æ¦‚å¿µï¼Œä¸‹é¢ğŸ‘‡æ˜¯æ¥æ”¶ç«¯çª—å£çš„å­¦ä¹ ï¼š å·²ç»æ¥æ”¶å¹¶ä¸”å·²ç»ç¡®è®¤ :28-31 å­—èŠ‚ è¿˜æœªæ¥æ”¶å¹¶ä¸”æ¥æ”¶ç«¯å¯ä»¥æ¥å—:32-51 å­—èŠ‚ è¿˜æœªæ¥æ”¶å¹¶ä¸”è¶…å‡ºæ¥æ”¶å¤„ç†èƒ½åŠ›:51-57 å­—èŠ‚ è¿™é‡Œå¼•å‡ºä¸¤ä¸ªæ¦‚å¿µï¼š RCV.WND i RCVæ˜¯æ¥æ”¶ç«¯çš„æ„æ€ï¼ŒWNDæ˜¯æ¥å—ç«¯çª—å£çš„å¤§å° RCV.NXT i NXTè¡¨ç¤ºçš„æ˜¯æ¥å—ç«¯æ¥æ”¶çª—å£çš„å¼€å§‹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ–¹æ¥ä¸‹æ¥å¤„ç†çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼› RCV.WNDçš„å¤§å°æ¥å—ç«¯çš„å†…å­˜ä»¥åŠç¼“å†²åŒºå¤§å°æœ‰å…³ï¼Œåœ¨æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ¥å—ç«¯çš„çª—å£å¤§å°å’Œå‘é€ç«¯å¤§å°å¤§è‡´ç›¸åŒï¼›æ¥å—ç«¯å¯æ¥æ”¶çš„æ•°æ®èƒ½åŠ›å¯ä»¥é€šè¿‡TCPé¦–éƒ¨çš„Windowå­—æ®µè®¾ç½®ï¼Œä½†æ˜¯æ¥å—ç«¯çš„å¤„ç†èƒ½åŠ›æ˜¯å¯èƒ½éšæ—¶å˜åŒ–çš„ï¼Œæ‰€ä»¥æ¥å—ç«¯å’ŒæœåŠ¡ç«¯çš„çª—å£å¤§å°å¤§è‡´æ˜¯ä¸€æ ·çš„ï¼› æµé‡æ§åˆ¶ä¸‹é¢ğŸ‘‡æ ¹æ®ä¸€ä¸ªä¾‹å­æ¥é˜è¿°æµé‡æ§åˆ¶ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯è¯·æ±‚ä¸€ä¸ª260å­—èŠ‚çš„æ–‡ä»¶ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼Œæ¯”è¾ƒç¹çï¼š s è¿™é‡Œå‡è®¾MSSå’Œçª—å£çš„å¤§å°ä¸å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ—¶å®¢æˆ·ç«¯å’Œå‘é€ç«¯çŠ¶æ€å¦‚ä¸‹ï¼šã€ å®¢æˆ·ç«¯ ã€‘ï¼š å‘é€çª—å£é»˜è®¤360å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š200å­—èŠ‚ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€çª—å£è®¾å®š200å­—èŠ‚ æ¥æ”¶çª—å£è®¾å®š360å­—èŠ‚ Step1ï¼š å®¢æˆ·ç«¯å‘é€140å­—èŠ‚çš„æ•°æ®åˆ°æœåŠ¡ç«¯ i ã€å®¢æˆ·ç«¯ã€‘å‘é€140å­—èŠ‚ï¼Œã€SND.NXTã€‘ä»1-&gt;141 w ã€æœåŠ¡ç«¯ã€‘çŠ¶æ€ä¸å˜ï¼Œç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯ä¼ è¾“çš„140å­—èŠ‚ Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ï¼Œå‘é€80å­—èŠ‚å“åº”ä»¥åŠACK i ã€ å®¢æˆ·ç«¯ ã€‘å‘é€140å­—èŠ‚ä¹‹åç­‰å¾…ã€ æœåŠ¡ç«¯ ã€‘çš„ACK wã€ æœåŠ¡ç«¯ ã€‘å¯ç”¨çª—å£å³ç§»ï¼Œã€RCV.NXTã€‘ä»1-&gt;141ã€ æœåŠ¡ç«¯ ã€‘å‘é€80å­—èŠ‚æ•°æ®ï¼Œã€SND.NXTã€‘ä»241-&gt;321 Step3: å®¢æˆ·ç«¯æ¥æ”¶å“åº”ACKï¼Œå¹¶ä¸”å‘é€ACK i ã€ å®¢æˆ·ç«¯ ã€‘å‘å‡ºçš„140å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»140å­—èŠ‚ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶80å­—èŠ‚æ•°æ®ï¼Œã€RCV.NXTã€‘å³ç§»80å­—èŠ‚ï¼Œä»241-&gt;321 Step4: æœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ï¼Œä½†æ˜¯280å­—èŠ‚è¶…å‡ºäº†å®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åˆ†æˆä¸¤éƒ¨åˆ†ä¼ è¾“ï¼Œå…ˆä¼ è¾“120å­—èŠ‚ï¼› w ã€ æœåŠ¡ç«¯ ã€‘å‘é€120å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨120å­—èŠ‚ï¼Œä»321-&gt;441 Step5: å®¢æˆ·ç«¯æ¥æ”¶æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¹¶å‘é€ACK i ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶120å­—èŠ‚ï¼Œã€RCV.NXTã€‘ä»321-&gt;441 Step6ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬äºŒæ­¥80å­—èŠ‚çš„ACK w [ æœåŠ¡å™¨ ] 80å­—èŠ‚å¾—åˆ°ACK ã€SND.UNAã€‘ä»241-&gt;321 Step7: æœåŠ¡ç«¯æ¥æ”¶åˆ°ç¬¬4æ­¥çš„ç¡®è®¤ w ã€ æœåŠ¡ç«¯ ã€‘ä¹‹å‰å‘é€æ–‡ä»¶ç¬¬ä¸€éƒ¨åˆ†çš„120å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å³ç§»åŠ¨120ï¼Œä»321-&gt;441 Step8: æœåŠ¡ç«¯å‘é€æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„160å­—èŠ‚ w ã€ æœåŠ¡ç«¯ ã€‘ï¼š å‘é€160å­—èŠ‚ï¼Œã€SND.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601 Step9: å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†160å­—èŠ‚ï¼ŒåŒæ—¶å‘é€ACK i ã€ å®¢æˆ·ç«¯ ã€‘æ¥æ”¶160å­—èŠ‚ï¼Œã€RCV.NXTã€‘å‘å³ç§»åŠ¨160å­—èŠ‚ï¼Œä»441-&gt;601 Step10: æœåŠ¡ç«¯æ”¶åˆ°æ–‡ä»¶ç¬¬äºŒéƒ¨åˆ†çš„ACK w ã€ æœåŠ¡ç«¯ ã€‘å‘é€çš„160å­—èŠ‚å¾—åˆ°ç¡®è®¤ï¼Œã€SND.UNAã€‘å‘å³ä¸€å®š160å­—èŠ‚ï¼Œä»441-&gt;601ï¼›è‡³æ­¤å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯å‘é€çš„å®Œæ•´çš„æ–‡ä»¶ï¼› ä¸Šé¢é€šè¿‡è¡¨æ ¼åˆ—ä¸¾æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ¯ä¸ªçŠ¶æ€åœ¨æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œå¯ä»¥çœ‹å¦‚ä¸‹ç¤ºæ„å›¾è¾…åŠ©ç†è§£ï¼š å®¢æˆ·ç«¯äº¤äº’æµç¨‹ æœåŠ¡ç«¯äº¤äº’æµç¨‹ ä¸Šé¢ğŸ‘†æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªGETè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å‘é€ä¸€ä¸ª280å­—èŠ‚çš„æ–‡ä»¶ç»™åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯çš„æ¥æ”¶çª—å£æ˜¯200å­—èŠ‚åœºæ™¯åŠ ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ•°æ®ä¼ è¾“ä¸äº¤äº’æµç¨‹ï¼Œé€šè¿‡è¿™ä¸ªæµç¨‹æ¥å­¦ä¹ æ»‘åŠ¨çª—å£çš„ç§»åŠ¨çŠ¶æ€å’Œæµé‡æ§åˆ¶çš„å¤§è‡´æµç¨‹ï¼› æ»‘åŠ¨çª—å£ä¸æ“ä½œç³»ç»Ÿç¼“å†²åŒºä¸Šé¢ğŸ‘†è®²è¿°çš„æ—¶å€™ï¼Œéƒ½æ˜¯å‡è®¾çª—å£å¤§å°æ˜¯ä¸å˜çš„ï¼Œè€Œå®é™…ä¸Šï¼Œå‘é€ç«¯å’Œæ¥å—ç«¯çš„æ»‘åŠ¨çª—å£çš„å­—èŠ‚æ•°éƒ½åƒå­˜å‚¨åœ¨æ“ä½œç³»ç»Ÿç¼“å†²åŒºçš„ï¼Œæ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºå—æ“ä½œç³»ç»Ÿæ§åˆ¶ï¼Œå½“åº”ç”¨è¿›ç¨‹å¢åŠ æ˜¯ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…çš„å†…å­˜å‡å°‘ï¼Œç¼“å†²åŒºå‡å°‘ï¼Œåˆ†é…ç»™æ¯ä¸ªè¿æ¥çš„çª—å£å°±ä¼šå‹ç¼©ã€‚**è€Œä¸”æ»‘åŠ¨çª—å£çš„å¤§å°ä¹Ÿå—åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®é€Ÿåº¦æœ‰å…³**ï¼› åº”ç”¨è¿›ç¨‹è¯»å–ç¼“å†²åŒºæ•°æ®ä¸åŠæ—¶é€ æˆçª—å£æ”¶ç¼©step1: å®¢æˆ·ç«¯å‘é€140å­—èŠ‚ i å®¢æˆ·ç«¯å‘é€åˆ°140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£æ”¶ç¼©åˆ°220å­—èŠ‚ï¼Œå‘é€çª—å£ä¸å˜ Step2: æœåŠ¡ç«¯æ¥æ”¶140å­—èŠ‚ ä½†æ˜¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚ w æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ä»…ä»…è¯»å–40å­—èŠ‚ï¼Œä»æœ‰100å­—èŠ‚å ç”¨ç¼“å†²åŒºå¤§å°ï¼Œå¯¼è‡´æ¥å—çª—å£æ”¶ç¼©ï¼ŒæœåŠ¡ç«¯å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œåœ¨é¦–éƒ¨Windowå¸¦ä¸Šæ¥æ”¶çª—å£çš„å¤§å°260 Step3: å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå‘é€çª—å£æ”¶ç¼©åˆ°260 Step4: å®¢æˆ·ç«¯ç»§ç»­å‘é€180å­—èŠ‚æ•°æ® i å®¢æˆ·ç«¯å‘é€180å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ80å­—èŠ‚ Step5: æœåŠ¡ç«¯æ¥æ”¶åˆ°180å­—èŠ‚ w å‡è®¾åº”ç”¨ç¨‹åºä»ç„¶ä¸è¯»å–è¿™180å­—èŠ‚ï¼Œæœ€ç»ˆä¹Ÿå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å†æ¬¡æ”¶ç¼©180å­—èŠ‚ï¼Œä»…å‰©ä¸‹80å­—èŠ‚ï¼Œåœ¨å‘é€ç¡®è®¤æŠ¥æ–‡æ—¶ï¼Œè®¾ç½®é¦–éƒ¨window=80 Step6: å®¢æˆ·ç«¯æ”¶åˆ°80å­—èŠ‚çš„çª—å£æ—¶ï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º80å­—èŠ‚ï¼Œå¯ç”¨çª—å£ä¹Ÿæ˜¯80å­—èŠ‚ Step7: å®¢æˆ·ç«¯ä»ç„¶å‘é€80å­—èŠ‚åˆ°æœåŠ¡ç«¯ï¼Œæ­¤æ—¶å¯ç”¨çª—å£ä¸ºç©º Step8: æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹ç»§ç»­ä¸è¯»åŒºè¿™80å­—èŠ‚çš„ç¼“å†²åŒºæ•°æ®ï¼Œæœ€ç»ˆå¯¼è‡´æœåŠ¡ç«¯æ¥æ”¶çª—å£å¤§å°ä¸º0ï¼Œä¸èƒ½å†æ¥æ”¶ä»»ä½•æ•°æ®ï¼ŒåŒæ—¶å‘é€ACKæŠ¥æ–‡ï¼› Step9ï¼šå®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè°ƒæ•´å‘é€çª—å£å¤§å°ä¸º0ï¼Œè¿™ä¸ªçŠ¶æ€å«åšã€Œ çª—å£å…³é—­ ã€ çª—å£æ”¶ç¼©å¯¼è‡´çš„ä¸¢åŒ… Step1ï¼šå®¢æˆ·ç«¯æœåŠ¡ç«¯å¼€å§‹çš„çª—å£å¤§å°éƒ½æ˜¯360å­—èŠ‚ï¼Œå®¢æˆ·ç«¯å‘é€140å­—èŠ‚æ•°æ® i å®¢æˆ·ç«¯å‘é€140å­—èŠ‚ä¹‹åï¼Œå¯ç”¨çª—å£å˜æˆ220å­—èŠ‚ Step2ï¼šæœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹éª¤å¢ï¼Œè¿›ç¨‹ç¼“å­˜åŒºå¹³å‡åˆ†é…ï¼Œé€ æˆæœåŠ¡ç«¯æ¥æ”¶çª—å£å‡å°‘ï¼Œä»360å˜æˆ240å­—èŠ‚ï¼› w å‡è®¾æ¥æ”¶äº†140å­—èŠ‚ä¹‹åï¼Œåº”ç”¨è¿›ç¨‹æ²¡æœ‰è¯»å–ï¼Œé‚£ä¸ªå¯ç”¨çª—å£è¿›ä¸€æ­¥å‹ç¼©ï¼Œå˜æˆ100å­—èŠ‚ï¼› Step3ï¼šå‡è®¾åŒä¸€ä¸ªè¿æ¥åœ¨æ²¡æœ‰æ”¶åˆ°æœåŠ¡ç«¯ç¡®è®¤ä¹‹åï¼Œåˆå‘é€äº†180ä¸ªå­—èŠ‚çš„æ•°æ®ï¼ˆRetramissionï¼‰ i å…ˆå‘é€äº†140å­—èŠ‚ï¼Œåå‘é€äº†180å­—èŠ‚ï¼Œéƒ½æ²¡æœ‰å¾—åˆ°ç¡®è®¤ï¼Œå®¢æˆ·ç«¯å¯ç”¨çª—å£å¤§å°å˜æˆ40å­—èŠ‚ Step4ï¼šæœåŠ¡ç«¯æ”¶åˆ°ä¸Šé¢ğŸ‘†ç¬¬ä¸‰æ­¥å‘é€çš„180å­—èŠ‚çš„æ•°æ®ï¼Œä½†æ˜¯æ¥å—çª—å£çš„å¤§å°åªæœ‰100å­—èŠ‚ï¼Œæ‰€ä»¥ä¸èƒ½æ¥æ”¶ w æœåŠ¡ç«¯æ‹’ç»æ¥æ”¶180å­—èŠ‚ Step5ï¼šæ­¤æ—¶å®¢æˆ·ç«¯æ‰æ”¶åˆ°ä¹‹å‰140å­—èŠ‚çš„ç¡®è®¤æŠ¥æ–‡ï¼Œæ‰çŸ¥é“æ¥æ”¶çª—å£å‘ç”Ÿäº†å˜åŒ– i å®¢æˆ·ç«¯ç”±äºæ²¡æœ‰æ”¶åˆ°180å­—èŠ‚çš„ç¡®è®¤ï¼ŒåŠ å…¥å®¢æˆ·ç«¯æ­£åœ¨å‡†å¤‡å‘é€180å­—èŠ‚æ•°æ®ï¼Œå¾—åˆ°æ¥å—ç«¯çš„çª—å£å¤§å°æ˜¯100å­—èŠ‚ä¹‹åï¼Œé¡»å¼ºåˆ¶å°†å³ä¾§çª—å£å‘å·¦æ”¶ç¼©80å­—èŠ‚ï¼› çª—å£å…³é—­è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„ä¾‹å­éƒ½å‘ç”Ÿäº†ã€Œ çª—å£å…³é—­ ã€ s çª—å£å…³é—­ï¼š å‘é€ç«¯çš„å‘é€çª—å£å˜æˆ0çš„çŠ¶æ€ï¼› ä¸Šé¢è®²çš„ä¸¤ç§æƒ…å†µä¸€èˆ¬ä¸ä¼šå‘ç”Ÿçš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸ä¼šæ—¢æ”¶ç¼©çª—å£ï¼ŒåŒæ—¶å‡å°‘è¿æ¥ç¼“å­˜ï¼›è€Œæ˜¯ä¸€èˆ¬å…ˆä½¿ç”¨çª—å£æ”¶ç¼©ç­–ç•¥ï¼Œä¹‹ååœ¨å‹ç¼©ç¼“å†²åŒºçš„æ–¹å¼æ¥è§„é¿ä»¥ä¸Šé—®é¢˜ï¼›å‘ç”Ÿçª—å£å…³é—­ä¹‹åï¼Œå‘é€ç«¯ä¸ä¼šè¢«åŠ¨çš„ç­‰å¾…æœåŠ¡ç«¯çš„é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šé‡‡ç”¨å®šæ—¶å—…æ¢çš„æ–¹å¼å»æŸ¥çœ‹æœåŠ¡ç«¯æ¥æ”¶çª—å£æ˜¯å¦å¼€æ”¾ï¼› Linuxä¸­å¯¹TCPç¼“å†²åŒºçš„è°ƒæ•´æ–¹å¼ net.ipv4.tcp_rmem = 4096 87380 6291456 è¯»ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›– net.core.rmem_max net.ipv4.tcp_wmem = 4096 16384 4194304 å†™ç¼“å­˜æœ€å°å€¼ã€é»˜è®¤å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½å­—èŠ‚ï¼Œè¦†ç›–net.core.wmem_max net.ipv4.tcp_mem = 1541646 2055528 3083292 ç³»ç»Ÿæ— å†…å­˜å‹åŠ›ã€å¯åŠ¨å‹åŠ›æ¨¡å¼é˜€å€¼ã€æœ€å¤§å€¼ï¼Œå•ä½ä¸ºé¡µçš„æ•°é‡ net.ipv4.tcp_moderate_rcvbuf = 1 å¼€å¯è‡ªåŠ¨è°ƒæ•´ç¼“å­˜æ¨¡å¼","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCP-RTOé‡ä¼ è®¡æ•°å™¨çš„è®¡ç®—","date":"2021-07-04T08:32:27.000Z","path":"wiki/TCP-RTOé‡ä¼ è®¡æ•°å™¨çš„è®¡ç®—/","text":"i ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»äº†TCPè¶…æ—¶é‡ä¼ çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å®šæ—¶å™¨çš„ç­–ç•¥ï¼Œå½“å®šæ—¶å™¨è§„å®šæ—¶é—´å†…æœªæ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œå°±ä¼šè§¦å‘æŠ¥æ–‡çš„é‡ä¼ ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼›é‚£ä¹ˆå®šæ—¶å™¨è¶…æ—¶æ—¶é—´ï¼ˆRTO Retramission Timeoutï¼‰æ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ ä»€ä¹ˆæ˜¯RTTï¼Ÿäº†è§£RTOå¦‚ä½•è®¡ç®—ä¹‹å‰ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µã€Œ RTT ã€ï¼› å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»clientå‘é€ç¬¬ä¸€ä¸ªã€ŒSYNã€æŠ¥æ–‡ï¼Œåˆ°Serveræ¥å—åˆ°æŠ¥æ–‡ï¼Œå¹¶ä¸”è¿”å›ã€ŒSYN ACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ¥å—åˆ°Serverçš„ã€ŒACKã€æŠ¥æ–‡ä¹‹åï¼Œclientæ‰€ç»å†çš„æ—¶é—´ï¼Œå«åš1ä¸ªRTTæ—¶é—´ï¼› å¦‚ä½•åœ¨é‡ä¼ ä¸‹æœ‰æ•ˆæµ‹é‡RTTï¼Ÿ å¦‚ä¸Šå›¾ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§ï¼Œå·¦ä¾§aå›¾æ‰€ç¤ºï¼Œå½“ä¸€ç«¯å‘é€çš„æ•°æ®æŠ¥ä¸¢å¤±åè¦è¿›è¡Œé‡ä¼ ï¼Œåˆ°é‡ä¼ ä¹‹åæ¥æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿™ç§åœºæ™¯ä¸‹è¯¥å¦‚ä½•è®¡ç®—RTTå‘¢ï¼Ÿå¼€å§‹æ—¶é—´æ˜¯æŒ‰ç…§ç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ—¶é—´å‘¢è¿˜æ˜¯æŒ‰ç…§é‡ä¼ æ•°æ®æŠ¥çš„æ—¶é—´å‘¢ï¼Ÿ w æŒ‰ç…§å¸¸ç†æ¥è¯´ï¼Œå¦‚å³ä¾§bå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT2ä¸ºå‡†ï¼› ç¬¬äºŒç§ï¼Œå·¦ä¾§bå›¾æ‰€ç¤ºï¼Œç¬¬ä¸€æ¬¡å‘é€æ•°æ®æŠ¥æ–‡æ—¶ï¼Œç”±äºç½‘ç»œæ—¶å»¶å¯¼è‡´RTOæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥æ”¶æ®µçš„ç¡®è®¤æŠ¥æ–‡ï¼Œå‘é€ç«¯è¿›è¡Œé‡å‘ï¼Œä½†æ˜¯åœ¨åˆšåˆšé‡å‘ä¹‹åå°±æ”¶åˆ°äº†ç¬¬ä¸€æ¬¡æŠ¥æ–‡çš„ç¡®è®¤æŠ¥æ–‡ï¼Œé‚£è¿™ç§æƒ…å†µRTTè¯¥å¦‚ä½•è®¡ç®—å‘¢ï¼Ÿ w å¦‚å³ä¾§aå›¾æ‰€ç¤ºï¼ŒRTTæ—¶é—´åº”è¯¥ä»¥RTT1ä¸ºå‡†ï¼› å°±åƒä¸Šé¢æåŠçš„ä¸¤ç§æƒ…å†µï¼Œä¸€ä¼šä»¥ç¬¬ä¸€ä¸ªRTT1ä¸ºå‡†ï¼Œä¸€ä¼šä»¥RTT2ä¸ºå‡†ï¼Œé‚£ä¹ˆTCPåè®®å¦‚ä½•æ­£ç¡®çš„è®¡ç®—å‡ºRTTå‘¢ï¼Ÿ ä½¿ç”¨Timestampæ–¹å¼è®¡ç®—RTTä¹‹å‰çš„æ–‡ç« ä¸­åœ¨ä»‹ç»TCPè¶…æ—¶ä¸é‡ä¼ çš„ç¬”è®°ä¸­æœ‰ä»‹ç»é€šè¿‡ä½¿ç”¨Timtstampçš„æ–¹å¼æ¥åŒºåˆ†ç›¸åŒSeqåºåˆ—å·çš„ä¸åŒæŠ¥æ–‡ï¼Œå…¶å®åœ¨TCPæŠ¥æ–‡é¦–éƒ¨å­˜å‚¨Timestampçš„æ—¶å€™ï¼Œä¼šå­˜å‚¨æŠ¥æ–‡çš„å‘é€æ—¶é—´å’Œç¡®è®¤æ—¶é—´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å¦‚ä½•è®¡ç®—RTOï¼Ÿä¸Šé¢ğŸ‘†è¯´åˆ°äº†RTTå¦‚ä½•è®¡ç®—ï¼Œé‚£ä¸ªRTOå’ŒRTTæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ RTOçš„å–å€¼å°†ä¼šå½±å“åˆ°TCPçš„ä¼ è¾“æ•ˆç‡ä»¥åŠç½‘ç»œçš„ååé‡ï¼› s é€šå¸¸æ¥è¯´RTOåº”è¯¥ç•¥å¤§äºRTTï¼Œå¦‚æœRTOå°äºRTTï¼Œåˆ™ä¼šé€ æˆå‘é€ç«¯é¢‘ç¹é‡å‘ï¼Œå¯èƒ½ä¼šé€ æˆç½‘ç»œé˜»å¡ï¼›å¦‚æœRTOè®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™æ¥å—ç«¯å·²ç»æ”¶åˆ°ç¡®è®¤æŠ¥æ–‡ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…ä»ç„¶ä¸èƒ½å‘é€å…¶ä»–æŠ¥æ–‡ï¼Œä¼šé€ æˆä¸¤ç«¯æ€§èƒ½çš„æµªè´¹å’Œç½‘ç»œååé‡çš„ä¸‹é™ï¼› å¹³æ»‘RTOç½‘ç»œçš„RTTæ˜¯ä¸æ–­çš„å˜åŒ–çš„ï¼Œæ‰€ä»¥è®¡ç®—RTOçš„æ—¶å€™ï¼Œåº”å½“è€ƒè™‘RTOçš„å¹³æ»‘æ€§ï¼Œå°½é‡é¿å…RTTæ³¢åŠ¨å¸¦æ¥çš„å¹²æ‰°ï¼Œä»¥æŠµæŒ¡ç¬æ—¶å˜åŒ–ï¼› å¹³æ»‘RTOåœ¨æ–‡æ¡£RFC793å®šä¹‰ï¼Œç»™å‡ºå¦‚ä¸‹è®¡ç®—æ–¹å¼ï¼š SRTT (smoothed round-trip time) = ( Î± * SRTT ) + ((1 - Î±) * RTT) w Î± ä» 0åˆ° 1(RFC æ¨è 0.9)ï¼Œè¶Šå¤§è¶Šå¹³æ»‘ RTO = min[ UBOUND, max[ LBOUND, (Î² * SRTT) ] ] w å¦‚ UBOUNDä¸º1åˆ†é’Ÿï¼ŒLBOUNDä¸º 1 ç§’é’Ÿï¼Œ Î²ä» 1.3 åˆ° 2 ä¹‹é—´ è¿™ç§è®¡ç®—æ–¹å¼ä¸é€‚ç”¨äº RTT æ³¢åŠ¨å¤§(æ–¹å·®å¤§)çš„åœºæ™¯,å¦‚æœç½‘ç»œçš„RTTæ³¢åŠ¨å¾ˆå¤§ï¼Œä¼šé€ æˆRTOè°ƒæ•´ä¸åŠæ—¶ï¼› è¿½è¸ªRTTæ–¹å·®è®¡ç®—RTO i RFC6298(RFC2988)ï¼Œå…¶ä¸­Î± = 1/8ï¼Œ Î² = 1/4ï¼ŒK = 4ï¼ŒG ä¸ºæœ€å°æ—¶é—´é¢—ç²’: é¦–æ¬¡è®¡ç®— RTOï¼ŒRä¸ºç¬¬ 1 æ¬¡æµ‹é‡å‡ºçš„ RTT123SRTT(smoothed round-trip time) = RRTTVAR(round-trip time variation) = R/2RTO = SRTT + max (G, K*RTTVAR) åç»­è®¡ç®— RTOï¼ŒRâ€™ä¸ºæœ€æ–°æµ‹é‡å‡ºçš„ RTT123SRTT= (1-Î±)*SRTT+Î±*Râ€™RTTVAR=(1-Î²)*RTTVAR+Î²*|SRTT-Râ€™|RTO = SRTT + max (G, K*RTTVAR)","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPè¶…æ—¶ä¸é‡ä¼ ","date":"2021-07-04T08:32:08.000Z","path":"wiki/TCPè¶…æ—¶ä¸é‡ä¼ /","text":"èƒŒæ™¯ å¦‚ä¸Šå›¾ğŸ‘†æ‰€ç¤ºï¼Œè®¾å¤‡Aå‘è®¾å¤‡Bå‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯åœ¨ç½‘ç»œä¸­ä¼šç”±äºå„ç§å„æ ·çš„é—®é¢˜å¯¼è‡´ä¸¢å¤±ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿ é‡‡ç”¨å®šæ—¶å™¨é‡ä¼  i PARï¼šPositive Acknowledgment with Retransmission æœ€ç®€å•çš„æ€è·¯æ˜¯åœ¨å‘é€æ–¹è®¾ç½®ã€Œ å®šæ—¶å™¨ ã€ï¼š å½“è®¾å¤‡Aå‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹åï¼Œåœ¨å®šæ—¶å™¨è§„å®šçš„æ—¶é—´å†…ï¼Œå¦‚æœæ”¶åˆ°è®¾å¤‡Bçš„ç¡®è®¤æŠ¥æ–‡ï¼Œåˆ™è®¾å¤‡Aç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡ï¼ŒåŒæ—¶å®šæ—¶å™¨å¤ä½ï¼› å¦‚æœç¬¬ä¸€æ¡æ¶ˆæ¯å‘é€æ—¶é—´è¶…å‡ºäº†å®šæ—¶å™¨è§„å®šçš„æ—¶é—´ï¼Œåˆ™è®¾å¤‡Aå°†é‡æ–°å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼ŒåŒæ—¶é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼› è¿™ç§æ–¹å¼æ˜¯ä¸²å‹å‘é€çš„ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ¶ˆæ¯å‘é€æˆåŠŸä¹‹åï¼Œæ‰å¯ä»¥å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œã€Œ æ•ˆç‡æå·® ã€ï¼› å¹¶å‘èƒ½åŠ›PAR i åŸºäºä¸Šè¿°PARæ•ˆç‡ä½ä¸‹çš„æ–¹å¼è¿›è¡Œæ”¹é€ ï¼Œåœ¨å‘é€ç«¯é‡‡ç”¨å¹¶å‘+å®šæ—¶å™¨çš„æ–¹å¼è¿›è¡Œæ•°æ®å‘é€ï¼› é¦–å…ˆè®¾å¤‡Aå¯ä»¥åŒæ—¶å‘é€å¤šä¸ªæ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µå…·æœ‰ä¸€ä¸ªæ ‡å¿—å­—æ®µã€#XXã€‘å»æ ‡å¿—å”¯ä¸€ï¼Œæ¯ä¸ªæŠ¥æ–‡æ®µè¿æ¥å…·æœ‰è‡ªå·±çš„å®šæ—¶å™¨ï¼› è®¾å¤‡Bè§„å®šæ—¶é—´å†…æ”¶åˆ°è®¾å¤‡Aå‘é€çš„æ•°æ®ä¹‹åå¹¶ä¸”è®¾å¤‡Aå¾—åˆ°è®¾å¤‡Bçš„ç¡®è®¤ä¹‹åï¼Œè®¾å¤‡Aå°†å®šæ—¶å™¨æ¸…é™¤ åŒPARä¸€æ ·ï¼Œè®¾å¤‡Bæ²¡æœ‰åœ¨è§„å®šçš„æ—¶é—´å†…å‘é€ç¡®è®¤æŠ¥æ–‡ï¼Œè®¾å¤‡Aå°†è¿™ä¸ªæŠ¥æ–‡æ‰€å¯¹åº”çš„å®šæ—¶å™¨å¤ä½ï¼Œé‡æ–°å‘é€è¿™ä¸ªæŠ¥æ–‡ å¹¶å‘å‘é€å¸¦æ¥çš„é—®é¢˜é‡‡ç”¨å¹¶å‘çš„æ–¹å¼å‘é€æ¶ˆæ¯æˆ–è€…æŠ¥æ–‡æ®µå›ºç„¶æå‡äº†å‘é€ç«¯çš„æ€§èƒ½ï¼Œä½†æ˜¯å‘é€ç«¯å‘é€çš„æ¶ˆæ¯å¯èƒ½æ¥å—ç«¯ä¸èƒ½å®Œå…¨å¤„ç†ï¼Œè¿™æ˜¯åŒæ–¹æŠ¥æ–‡å¤„ç†é€Ÿåº¦æˆ–è€…æ•ˆç‡ä¸ä¸€è‡´çš„é—®é¢˜ï¼› æ‰€ä»¥å¯¹äºæ¥æ”¶ç«¯è®¾å¤‡Bï¼Œåº”è¯¥æ˜ç¡®è‡ªå·±å¯èƒ½æ¥å—çš„æ•°æ®é‡ï¼Œå¹¶ä¸”åœ¨ç¡®è®¤æŠ¥æ–‡ä¸­åŒæ­¥åˆ°å‘é€ç«¯è®¾å¤‡Aï¼Œè®¾å¤‡Aæ ¹æ®è®¾å¤‡Bçš„å¤„ç†èƒ½åŠ›æ¥è°ƒæ•´å‘é€æ•°æ®çš„å¤§å°ï¼›ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„ã€Œ limitã€ï¼› ç»§ç»­å»¶ä¼¸Sequmentåºåˆ—å·å’ŒAckåºåˆ—å·çš„è®¾è®¡ç†å¿µæˆ–è€…è®¾è®¡åˆè¡·æ˜¯ã€Œ è§£å†³åº”ç”¨å±‚å­—èŠ‚æµçš„å¯é å‘é€ ã€ è·Ÿè¸ªã€Œåº”ç”¨å±‚ã€çš„å‘é€ç«¯æ•°æ®æ˜¯å¦é€è¾¾ ç¡®å®šã€Œæ¥æ”¶ç«¯æœ‰åºçš„ã€æ¥æ”¶åˆ°ã€Œå­—èŠ‚æµã€ åºåˆ—å·çš„å€¼é’ˆå¯¹çš„æ˜¯å­—èŠ‚è€Œä¸æ˜¯æŠ¥æ–‡ âš ï¸âš ï¸âš ï¸ i TCPçš„å®šä½å°±æ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ TCPåºåˆ—å·å¦‚ä½•è®¾è®¡çš„ é€šè¿‡TCPæŠ¥æ–‡å¤´æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒSequmentåºåˆ—å·åŒ…æ‹¬32ä½é•¿åº¦ï¼›ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªSequmentå¯ä»¥å‘é€2çš„32æ¬¡æ–¹ä¸ªå­—èŠ‚ï¼Œå¤§çº¦4Gçš„æ•°é‡ï¼ŒSequmentå°±æ— æ³•è¡¨ç¤ºäº†ï¼Œå½“ä¼ è¾“çš„æ•°æ®è¶…è¿‡â€œ4Gâ€ä¹‹åï¼Œå¦‚æœè¿™ä¸ªè¿æ¥ä¾ç„¶è¦ä½¿ç”¨çš„è¯ï¼ŒSequmentä¼šé‡æ–°å¤ç”¨ï¼›Sequmentå¤ç”¨ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åºåˆ—å·å›ç»•ï¼›ğŸ‘‡ åºåˆ—å·å›ç»• i åºåˆ—å·å›ç»• (Protect Against Wrapped Sequence numbers) å½“ä¸€ä¸ªè¿æ¥è¦å‘é€6Gçš„æ•°æ®æ˜¯ï¼ŒAã€Bã€Cã€Dåˆ†åˆ«å‘é€1Gçš„æ•°æ®ï¼Œå¦‚æœç»§ç»­ä½¿ç”¨æ­¤è¿æ¥ï¼ŒEä¸‹ä¸€æ¬¡å‘é€æ•°æ®1Gï¼ŒSeqåºåˆ—å·å¤ç”¨ï¼ŒEæŠ¥æ–‡æ®µçš„åºåˆ—å·å’ŒAæŠ¥æ–‡æ®µçš„åºåˆ—å·è¡¨ç¤ºç›¸åŒ æŒ‰ç…§ä¸Šé¢çš„é€»è¾‘ç»§ç»­å‘é€æ•°æ®ï¼ŒFæŠ¥æ–‡æ®µçš„Seqæ ‡å¿—å’ŒBæŠ¥æ–‡æ®µçš„æ˜¯ä¸€æ ·çš„ï¼› åŠ å…¥BæŠ¥æ–‡æ®µåœ¨å‘é€è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ï¼Œç›´åˆ°æ¥å—ç«¯æ¥æ”¶äº†FæŠ¥æ–‡æ®µçš„åŒæ—¶BæŠ¥æ–‡æ®µåˆ°è¾¾æ¥å—ç«¯ï¼Œæ¥å—ç«¯è¯¥å¦‚ä½•åŒºåˆ†ç›¸åŒSeqåºåˆ—å·ä¸åŒæ•°æ®çš„æŠ¥æ–‡æ®µå‘¢ï¼Ÿ å…¶å®TCPè§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªæŠ¥æ–‡æ®µä¸Šæ·»åŠ Tcp Timestampæ—¶é—´æˆ³ï¼Œç±»ä¼¼äºç‰ˆæœ¬å·çš„ç†å¿µï¼› æ¥æ”¶ç«¯æ”¶åˆ°ç›¸åŒSeqåºåˆ—å·çš„æŠ¥æ–‡æ®µæ˜¯å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ¥è¿›è¡ŒåŒºåˆ†ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰","date":"2021-07-04T08:31:56.000Z","path":"wiki/TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰/","text":"MSSäº§ç”Ÿçš„èƒŒæ™¯æˆ‘ä»¬éƒ½çŸ¥é“TCPåè®®æ˜¯è¿è¾“åœ¨ä¼ è¾“å±‚çš„åè®®ï¼Œå®ƒæ˜¯é¢å‘ã€å­—èŠ‚æµã€‘çš„ä¼ è¾“åè®®ï¼›å®ƒçš„ä¸Šå±‚ï¼Œåº”ç”¨å±‚ä¼ è¾“çš„æ•°æ®æ˜¯æ— é™åˆ¶çš„ï¼Œä½†æ˜¯å®ƒçš„ä¸‹å±‚ä¹Ÿå°±æ˜¯ç½‘ç»œå±‚å’Œé“¾è·¯å±‚ç”±äºè·¯ç”±ç­‰è½¬å‘è®¾å¤‡æœ‰å†…å­˜ç­‰é™åˆ¶æ˜¯ä¸å¯èƒ½æ— é™åˆ¶ä¼ è¾“ä»»ä½•å¤§å°çš„æŠ¥æ–‡çš„ï¼Œå®ƒä»¬ä¸€å®šä¼šé™åˆ¶æŠ¥æ–‡çš„é•¿åº¦ï¼Œå› æ­¤ TCPåè®®è¦å®Œæˆçš„å·¥ä½œæ˜¯å°†ä»åº”ç”¨å±‚æ¥å—åˆ°çš„ä»»æ„é•¿åº¦æ•°æ®ï¼Œåˆ‡å‰²æˆå¤šä¸ªæŠ¥æ–‡æ®µï¼ŒMSSå°±æ˜¯å¦‚ä½•åˆ‡å‰²æŠ¥æ–‡æ®µçš„ä¾æ®ã€‚ ä»€ä¹ˆæ˜¯MSSMSSï¼ˆMax Segment Sizeï¼‰ï¼šä»…æŒ‡ TCP æ‰¿è½½æ•°æ®ï¼Œä¸åŒ…å« TCP å¤´éƒ¨çš„å¤§å°ï¼Œå‚è§ RFC879 MSS é€‰æ‹©ç›®çš„ å°½é‡æ¯ä¸ª Segment æŠ¥æ–‡æ®µæºå¸¦æ›´å¤šçš„æ•°æ®ï¼Œä»¥å‡å°‘å¤´éƒ¨ç©ºé—´å ç”¨æ¯”ç‡ é˜²æ­¢ Segment è¢«æŸä¸ªè®¾å¤‡çš„ IP å±‚åŸºäº MTU æ‹†åˆ† s IPå±‚åŸºäºMTUçš„æ•°æ®æ‹†åˆ†æ˜¯æ•ˆç‡æå·®çš„ï¼Œä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±ï¼Œæ‰€æœ‰çš„æŠ¥æ–‡æ®µéƒ½è¦é‡ä¼  MSSé»˜è®¤å¤§å° s é»˜è®¤ MSS:536 å­—èŠ‚(é»˜è®¤ MTU576 å­—èŠ‚ï¼Œ20 å­—èŠ‚ IP å¤´éƒ¨ï¼Œ20 å­—èŠ‚ TCP å¤´éƒ¨) MSSåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ s æ¡æ‰‹é˜¶æ®µåå•† MSS è¿™ä¸ªåœ¨TCPä¸‰æ¬¡æ¡æ‰‹çš„æ–‡ç« ä¸­å·²ç»æåŠè¿‡äº†ï¼ MSS åˆ†ç±» å‘é€æ–¹æœ€å¤§æŠ¥æ–‡æ®µ: SMSS:SENDER MAXIMUM SEGMENT SIZE æ¥æ”¶æ–¹æœ€å¤§æŠ¥æ–‡æ®µ: RMSS:RECEIVER MAXIMUM SEGMENT SIZE åœ¨TCPå¸¸ç”¨é€‰é¡¹ä¸­å¯ä»¥çœ‹åˆ°ã€MSSã€‘çš„é€‰é¡¹ TCPæµä¸æŠ¥æ–‡æ®µåœ¨æ•°æ®ä¼ è¾“ä¸­çš„çŠ¶æ€ ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå·¦è¾¹å®¢æˆ·ç«¯åœ¨å‘é€å­—èŠ‚æµæ•°æ®ç»™åˆ°å³è¾¹å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚æµï¼Œä¼šåœ¨TCPå±‚æŒ‰ç…§MSSå¤§å°è§„å®šè¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªå°çš„æŠ¥æ–‡æ®µï¼Œåˆ†åˆ«ä¼ é€åˆ°å¦ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–è€…å…¶ä»–çš„æ¥æ”¶ç«¯ï¼›","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPä¸‰æ¬¡æ¡æ‰‹","date":"2021-07-04T08:31:42.000Z","path":"wiki/TCPä¸‰æ¬¡æ¡æ‰‹/","text":"æ¡æ‰‹ğŸ¤çš„ç›®çš„ åŒæ­¥Sequenceåºåˆ—å· i åˆå§‹åŒ–åºåˆ—å·ISN ï¼ˆInital Sequence Numberï¼‰ äº¤æ¢TCPé€šè®¯çš„å‚æ•° i æ¯”å¦‚æœ€å¤§æŠ¥æ–‡æ®µå‚æ•°ï¼ˆMSSï¼‰ã€çª—å£æ¯”ä¾‹å› å­ï¼ˆWindowï¼‰ã€é€‰æ‹©æ€§ç¡®è®¤ï¼ˆSACKï¼‰ã€åˆ¶å®šæ ¡éªŒå’Œç®—æ³•ï¼› ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹è¿‡ç¨‹ TCPä¸‰æ¬¡æ¡æ‰‹çš„å¤§è‡´æµç¨‹å›¾å¦‚ä¸ŠğŸ‘† ä½¿ç”¨tcpdumpæŠ“åŒ…åˆ†æä¸‰æ¬¡ğŸ¤æ¡æ‰‹æŠ¥æ–‡ä¸­Seqå’ŒAckçš„å˜åŒ– 1tcpdump port 80 -c 3 -S ç¬¬ä¸€æ¬¡æ¡æ‰‹ğŸ¤1IP upay.60734 &gt; 100.100.15.23.http: Flags [S], seq 3800409106, win 29200, options [mss 1460,sackOK,TS val 839851765 ecr 0,nop,wscale 7], length 0 å®¢æˆ·ç«¯upayè®¿é—®æœåŠ¡ç«¯80ç«¯å£ï¼Œå‘é€ä¸€ä¸ªã€Œ seq=3800409106 ã€ ï¼ŒåŒæ—¶æ ‡å¿—ä½SYN=1ï¼Œå£°æ˜æ­¤æ¬¡æ¡æ‰‹æ˜¯è¦å»ºç«‹è¿æ¥ï¼› ç¬¬äºŒæ¬¡æ¡æ‰‹ğŸ¤1IP 100.100.15.23.http &gt; upay.60734: Flags [S.], seq 1981710286, ack 3800409107, win 14600, options [mss 1440,nop,nop,sackOK,nop,wscale 7], length 0 ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„ç”³è¯·è¿æ¥å¼ºæ±‚ï¼ˆSYN=1ï¼‰ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯è‡ªå·±å‡†å¤‡å¥½çš„æƒ…å†µä¸‹ï¼Œç»™å®¢æˆ·ç«¯å‘é€ ã€Œ ACK=1 SYN=1 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼ŒSYN=1åŒæ ·ä¹Ÿæ˜¯å£°æ˜æ­¤æ¬¡æŠ¥æ–‡æ˜¯å»ºç«‹è¿æ¥çš„æŠ¥æ–‡è¯·æ±‚ï¼› ack= 3800409107 ä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å‘ç»™æœåŠ¡ç«¯çš„seq+1ï¼ˆackæ˜¯æ¥æ”¶æ–¹ä¸‹æ¬¡æœŸæœ›æ¥å£æŠ¥æ–‡çš„å¼€å§‹ä½ç½®ï¼‰ ç¬¬ä¸‰æ¬¡æ¡æ‰‹æ¡æ‰‹1IP upay.60734 &gt; 100.100.15.23.http: Flags [.], ack 1981710287, win 229, length 0 å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ç¡®è®¤æŠ¥æ–‡ï¼Œç¡®è®¤å¯ä»¥è¿›è¡Œè¿æ¥ï¼Œå‘é€ã€Œ ack = 1981710287 ã€çš„ç¡®è®¤æŠ¥æ–‡ï¼Œä¹‹åå°±å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCPçš„è¿æ¥å°±åˆ›å»ºæˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥åŒæ–¹å°±å¯ä»¥å‘é€æ•°æ®æŠ¥äº†ï¼› TCPè¿æ¥åˆ›å»ºæ„æˆä¸­çŠ¶æ€çš„å˜æ›´ é¦–å…ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ˜¯ã€CLOSEDã€‘çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ä¹‹åï¼Œè¿›å…¥ã€SYN-SENTã€‘çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç»´æŒçš„æ—¶é—´å¾ˆçŸ­ï¼Œæˆ‘ä»¬ä½¿ç”¨netstatå»æŸ¥çœ‹tcpè¿æ¥çŠ¶æ€çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¸ä¼šçœ‹åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œè€ŒæœåŠ¡ç«¯æ˜¯åœ¨ã€LISTENã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼› æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒSYN ACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶æœåŠ¡ç«¯è¿›å…¥ã€SYN-RECEIVEDã€‘çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡ï¼› å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„åŒæ­¥ç¡®è®¤è¯·æ±‚ä¹‹åï¼Œå‘é€ã€ŒACKã€ç¡®è®¤æŠ¥æ–‡ï¼ŒåŒæ—¶è¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œå‡†å¤‡åç»­çš„æ•°æ®ä¼ è¾“ï¼› æœåŠ¡ç«¯æ”¶åˆ°ä¸‰æ¬¡æ¡æ‰‹æœ€åçš„ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªTCPè¿æ¥ç®—æ˜¯å»ºç«‹å®Œæˆäº†ï¼Œåé¢å°±æ˜¯åŒæ–¹çš„é€šä¿¡äº†ï¼› TCBï¼ˆTransmission Control Blockï¼‰ i ä¿å­˜è¿æ¥ä½¿ç”¨çš„æºç«¯å£ã€ç›®çš„ç«¯å£ã€ç›®çš„ ipã€åºå·ã€ åº”ç­”åºå·ã€å¯¹æ–¹çª—å£å¤§å°ã€å·±æ–¹çª—å£å¤§å°ã€tcp çŠ¶æ€ã€tcp è¾“å…¥/è¾“å‡ºé˜Ÿåˆ—ã€åº”ç”¨å±‚è¾“å‡ºé˜Ÿ åˆ—ã€tcp çš„é‡ä¼ æœ‰å…³å˜é‡ç­‰ TCPæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é—®é¢˜ æ­£å¦‚æˆ‘ä»¬äº†è§£çš„TCPä¸‰æ¬¡æ¡æ‰‹ğŸ¤çš„æµç¨‹ï¼Œå½“æœ‰å¤§é‡SYNè¯·æ±‚åˆ°è¾¾æœåŠ¡ç«¯æ—¶ï¼Œä¼šè¿›å…¥åˆ°ã€SYNé˜Ÿåˆ—ã€‘ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°ç¬¬äºŒæ¬¡ç¡®è®¤æŠ¥æ–‡ä¹‹åï¼Œä¼šè¿›å…¥ã€ESTABLISHEDã€‘çŠ¶æ€ï¼ŒæœåŠ¡ç«¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¼šå°†è¿æ¥æ”¾å…¥åˆ°ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­ï¼Œå½“Nginxæˆ–è€…Tomcatè¿™äº›åº”ç”¨ç¨‹åºåœ¨è°ƒç”¨acceptï¼ˆè®¿é—®å†…æ ¸ï¼‰çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨ã€ACCEPTã€‘é˜Ÿåˆ—ä¸­å–å‡ºè¿æ¥è¿›è¡Œå¤„ç†ï¼› w ç”±æ­¤å¯è§ï¼Œã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘æ˜¯ä¼šå½±å“æœåŠ¡å™¨è¿æ¥æ€§èƒ½çš„é‡è¦å› ç´ ï¼Œæ‰€ä»¥å¯¹äºé«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸¤ä¸ªé˜Ÿåˆ—ä¸€å®šæ˜¯è¦è®¾ç½®çš„æ¯”è¾ƒå¤§çš„ï¼› å¦‚ä½•è®¾ç½®SYNé˜Ÿåˆ—å¤§å°æœåŠ¡å™¨ç«¯ SYN_RCV çŠ¶æ€ net.ipv4.tcp_max_syn_backlog:SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•° net.ipv4.tcp_synack_retries:è¢«åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘SYN/ACKçš„é‡è¯•æ¬¡æ•° å®¢æˆ·ç«¯ SYN_SENT çŠ¶æ€ï¼ˆæœåŠ¡ç«¯ä½œä¸ºå®¢æˆ·ç«¯ï¼Œæ¯”å¦‚Ngnixè½¬å‘ç­‰ï¼‰ net.ipv4.tcp_syn_retries = 6 ä¸»åŠ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå‘ SYN çš„é‡è¯•æ¬¡æ•° net.ipv4.ip_local_port_range = 32768 60999 å»ºç«‹è¿æ¥æ—¶çš„æœ¬åœ°ç«¯å£å¯ç”¨èŒƒå›´ Fast Openæœºåˆ¶ TCPå¦‚ä½•å¯¹è¿æ¥çš„æ¬¡æ•°ä»¥åŠè¿æ¥æ—¶é—´è¿›è¡Œä¼˜åŒ–çš„å‘¢ï¼Ÿè¿™é‡Œæåˆ°Fast Openæœºåˆ¶ï¼›æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªHttp Getè¯·æ±‚ï¼Œæ­£å¸¸çš„ä¸‰æ¬¡æ¡æ‰‹ğŸ¤åˆ°æ”¶åˆ°æœåŠ¡ç«¯æ•°æ®éœ€è¦2ä¸ªRTTçš„æ—¶é—´ï¼›FastOpenåšå‡ºå¦‚ä¸‹ä¼˜åŒ–ï¼š ç¬¬ä¸€æ¬¡åˆ›å»ºè¿æ¥çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è¦ç»å†2ä¸ªRTTæ—¶é—´ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯å‘é€ç¡®è®¤æŠ¥æ–‡çš„æ—¶å€™ï¼Œåœ¨æŠ¥æ–‡ä¸­æ·»åŠ ä¸€ä¸ªcookieï¼› ç­‰åˆ°ä¸‹æ¬¡å®¢æˆ·ç«¯å†éœ€è¦åˆ›å»ºè¯·æ±‚çš„æ—¶å€™ï¼Œç›´æ¥å°†ã€SYNã€‘å’Œcookieä¸€å¹¶å¸¦ä¸Šï¼Œå¯ä»¥ä¸€æ¬¡å°±åˆ›å»ºè¿æ¥ï¼Œç»è¿‡ä¸€ä¸ªRTTå®¢æˆ·ç«¯å°±å¯ä»¥æ”¶åˆ°æœåŠ¡ç«¯çš„æ•°æ®ï¼› å¦‚ä½•Linuxä¸Šæ‰“å¼€TCP Fast Open net.ipv4.tcp_fastopen:ç³»ç»Ÿå¼€å¯ TFO åŠŸèƒ½ 0:å…³é—­ 1:ä½œä¸ºå®¢æˆ·ç«¯æ—¶å¯ä»¥ä½¿ç”¨ TFO 2:ä½œä¸ºæœåŠ¡å™¨æ—¶å¯ä»¥ä½¿ç”¨ TFO 3:æ— è®ºä½œä¸ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ TFO SYNæ”»å‡»ä»€ä¹ˆæ˜¯SYNæ”»å‡»ï¼Ÿ æ­£å¸¸çš„æœåŠ¡é€šè®¯éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„è¯·æ±‚æŠ¥æ–‡æ¥åˆ›å»ºè¿æ¥çš„ï¼Œä½†æ˜¯ï¼Œå¯ä»¥äººä¸ºä¼ªé€ å¤§é‡ä¸åŒIPåœ°å€çš„SYNæŠ¥æ–‡ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢ğŸ‘†çŠ¶æ€å˜æ›´å›¾ä¸­çš„SYNè¯·æ±‚ï¼Œä½†æ˜¯æ”¶åˆ°æœåŠ¡ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œå´ä¸å‘é€å¯¹äºæœåŠ¡ç«¯çš„ACKè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡å¤„äºã€SYN-RECEIVEDã€‘çŠ¶æ€çš„TCPè¿æ¥å ç”¨å¤§é‡æœåŠ¡ç«¯èµ„æºï¼Œå¯¼è‡´æ­£å¸¸çš„è¿æ¥æ— æ³•åˆ›å»ºï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿå´©åï¼› SYNæ”»å‡»å¦‚ä½•æŸ¥çœ‹1netstat -nap | grep SYN_RECV w å¦‚æœå­˜åœ¨å¤§é‡ã€SYN-RECEIVEDã€‘çš„è¿æ¥ï¼Œå°±æ˜¯å‘ç”ŸSYNæ”»å‡»äº†ï¼› å¦‚ä½•è§„é¿SYNæ”»å‡»ï¼Ÿ net.core.netdev_max_backlog æ¥æ”¶è‡ªç½‘å¡ã€ä½†æœªè¢«å†…æ ¸åè®®æ ˆå¤„ç†çš„æŠ¥æ–‡é˜Ÿåˆ—é•¿åº¦ net.ipv4.tcp_max_syn_backlog SYN_RCVD çŠ¶æ€è¿æ¥çš„æœ€å¤§ä¸ªæ•° net.ipv4.tcp_abort_on_overflow è¶…å‡ºå¤„ç†èƒ½åŠ›æ—¶ï¼Œå¯¹æ–°æ¥çš„ SYN ç›´æ¥å›åŒ… RSTï¼Œä¸¢å¼ƒè¿æ¥ è®¾ç½®SYN Timeout ç”±äºSYN Floodæ”»å‡»çš„æ•ˆæœå–å†³äºæœåŠ¡å™¨ä¸Šä¿æŒçš„SYNåŠè¿æ¥æ•°ï¼Œè¿™ä¸ªå€¼=SYNæ”»å‡»çš„é¢‘åº¦ x SYN Timeoutï¼Œæ‰€ä»¥é€šè¿‡ç¼©çŸ­ä»æ¥æ”¶åˆ°SYNæŠ¥æ–‡åˆ°ç¡®å®šè¿™ä¸ªæŠ¥æ–‡æ— æ•ˆå¹¶ä¸¢å¼ƒæ”¹è¿æ¥çš„æ—¶é—´ï¼Œä¾‹å¦‚è®¾ç½®ä¸º20ç§’ä»¥ä¸‹ï¼Œå¯ä»¥æˆå€çš„é™ä½æœåŠ¡å™¨çš„è´Ÿè·ã€‚ä½†è¿‡ä½çš„SYN Timeoutè®¾ç½®å¯èƒ½ä¼šå½±å“å®¢æˆ·çš„æ­£å¸¸è®¿é—®ã€‚ è®¾ç½®SYN Cookie (net.ipv4.tcp_syncookies = 1) å°±æ˜¯ç»™æ¯ä¸€ä¸ªè¯·æ±‚è¿æ¥çš„IPåœ°å€åˆ†é…ä¸€ä¸ªCookieï¼Œå¦‚æœçŸ­æ—¶é—´å†…è¿ç»­å—åˆ°æŸä¸ªIPçš„é‡å¤SYNæŠ¥æ–‡ï¼Œå°±è®¤å®šæ˜¯å—åˆ°äº†æ”»å‡»ï¼Œå¹¶è®°å½•åœ°å€ä¿¡æ¯ï¼Œä»¥åä»è¿™ä¸ªIPåœ°å€æ¥çš„åŒ…ä¼šè¢«ä¸€æ¦‚ä¸¢å¼ƒã€‚è¿™æ ·åšçš„ç»“æœä¹Ÿå¯èƒ½ä¼šå½±å“åˆ°æ­£å¸¸ç”¨æˆ·çš„è®¿é—®ã€‚ å½“ SYN é˜Ÿåˆ—æ»¡åï¼Œæ–°çš„ SYN ä¸è¿›å…¥é˜Ÿåˆ—ï¼Œè®¡ç®—å‡º cookie å† ä»¥ SYN+ACK ä¸­çš„åºåˆ—å·è¿”å›å®¢æˆ·ç«¯ï¼Œæ­£å¸¸å®¢æˆ·ç«¯å‘æŠ¥æ–‡æ—¶ï¼Œ æœåŠ¡å™¨æ ¹æ®æŠ¥æ–‡ä¸­æºå¸¦çš„ cookie é‡æ–°æ¢å¤è¿æ¥ w ç”±äº cookie å ç”¨åºåˆ—å·ç©ºé—´ï¼Œå¯¼è‡´æ­¤æ—¶æ‰€æœ‰ TCP å¯é€‰ åŠŸèƒ½å¤±æ•ˆï¼Œä¾‹å¦‚æ‰©å……çª—å£ã€æ—¶é—´æˆ³ç­‰ TCP_DEFER_ACCEPTè¿™ä¸ªæ˜¯åšä»€ä¹ˆå‘¢ï¼Ÿ æ­£å¦‚ä¸Šé¢ğŸ‘†æ“ä½œç³»ç»Ÿå†…æ ¸å±•ç¤ºå›¾æ‰€ç¤ºï¼Œå†…æ ¸ä¸­ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ã€SYNã€‘é˜Ÿåˆ—å’Œã€ACCEPTã€‘é˜Ÿåˆ—ï¼Œåªæœ‰å½“æ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡ä¹‹åï¼Œè¿æ¥ä¼šè¿›å…¥åˆ°ã€ACCEPTã€‘ï¼ŒåŒæ—¶æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯ã€ESTABLISHEDã€‘çŠ¶æ€ï¼Œæ­¤æ—¶æ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šå»æ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼ŒçŸ¥é“æ”¶åˆ°çœŸæ­£çš„dataåˆ†ç»„ä¹‹åï¼Œæ‰ä¼šæ¿€æ´»åº”ç”¨è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸ºäº†æé«˜åº”ç”¨è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œé¿å…åº”ç”¨è¿›ç¨‹çš„ç­‰å¾…ï¼› i TCPä¸‰æ¬¡æ¡æ‰‹ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯ä¸¤æ¬¡æˆ–è€…å››æ¬¡ å‚è§æ–‡ç« ï¼šæ•–ä¸™ç”¨è¿‘ 40 å¼ å›¾è§£è¢«é—®åƒç™¾éçš„ TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹é¢è¯•é¢˜","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPå¤´éƒ¨","date":"2021-07-04T08:31:22.000Z","path":"wiki/TCPå¤´éƒ¨/","text":"å¸¦ç€é—®é¢˜å­¦ä¹  å¦‚ä½•æ ¡éªŒæŠ¥æ–‡æ®µæ˜¯å¦æŸåï¼Ÿ å¦‚ä½•CRCæ ¡éªŒ seqå’Œackæ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ tcpæ ¡éªŒä½éƒ½æœ‰é‚£äº›ï¼Ÿ 6ä¸ª åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ tcpå¦‚ä½•è®¡ç®—é¦–éƒ¨é•¿åº¦ï¼Ÿ åç§»é‡ TCP Retransmission é‡ä¼ ï¼Ÿ tcp spurious retransmission åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ tcp dup ack æ˜¯ä»€ä¹ˆï¼Ÿ ackä¸ACKæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ TCPå¤´éƒ¨ç»“æ„ å­¦ä¹ TCPåè®®é¦–å…ˆè¦çœ‹ä¸€ä¸‹å®ƒçš„æŠ¥æ–‡æ®µæ˜¯å¦‚ä½•ç»„æˆçš„ï¼›TCPæŠ¥æ–‡æ®µç»„æˆç”±ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ¥æ–‡å¤´éƒ¨ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ•°æ®éƒ¨åˆ†ï¼› å…ˆçœ‹ä¸€ä¸‹æŠ¥æ–‡å¤´ï¼Œä¹Ÿå°±æ˜¯TCPé¦–éƒ¨çš„ç»„æˆï¼› 16ä½ç«¯å£16ä½ç«¯å£å·ï¼šå‘ŠçŸ¥ä¸»æœºè¯¥æŠ¥æ–‡æ®µæ˜¯æ¥è‡ªå“ªé‡Œï¼ˆæºç«¯å£Source Portï¼‰ä»¥åŠä¼ ç»™å“ªä¸ªä¸Šå±‚åè®®æˆ–åº”ç”¨ç¨‹åºï¼ˆç›®çš„ç«¯å£Destination Portï¼‰çš„ã€‚è¿›è¡ŒTCPé€šä¿¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©çš„ä¸´æ—¶ç«¯å£å·ï¼Œè€ŒæœåŠ¡å™¨åˆ™ä½¿ç”¨çŸ¥åæœåŠ¡ç«¯å£å·ï¼ˆæ¯”å¦‚DNSåè®®å¯¹åº”ç«¯å£53ï¼ŒHTTPåè®®å¯¹åº”80ï¼Œè¿™äº›ç«¯å£å·å¯åœ¨/etc/servicesæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼‰ã€‚ åºåˆ—å·ï¼ˆSeqï¼‰å 32ä½ï¼Œä¹Ÿå°±æ˜¯4å­—èŠ‚é•¿åº¦ï¼Œåºå·èŒƒå›´è‡ªç„¶ä¹Ÿæ˜¯æ˜¯0~2^32-1ã€‚TCPæ˜¯é¢å‘å­—èŠ‚æµçš„ï¼ŒTCPè¿æ¥ä¸­ä¼ é€çš„å­—èŠ‚æµä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æŒ‰é¡ºåºç¼–å·ã€‚æ•´ä¸ªè¦ä¼ é€çš„å­—èŠ‚æµçš„èµ·å§‹åºå·å¿…é¡»è¦åœ¨è¿æ¥å»ºç«‹æ—¶è®¾ç½®ã€‚é¦–éƒ¨ä¸­çš„åºå·å­—æ®µå€¼æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ TCPç”¨åºåˆ—å·å¯¹æ•°æ®åŒ…è¿›è¡Œæ ‡è®°ï¼Œä»¥ä¾¿åœ¨åˆ°è¾¾ç›®çš„åœ°åé‡æ–°é‡è£…ï¼Œå‡è®¾å½“å‰çš„åºåˆ—å·ä¸º sï¼Œå‘é€æ•°æ®é•¿åº¦ä¸º lï¼Œåˆ™ä¸‹æ¬¡å‘é€æ•°æ®æ—¶çš„åºåˆ—å·ä¸º s + lã€‚åœ¨å»ºç«‹è¿æ¥æ—¶é€šå¸¸ç”±è®¡ç®—æœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä½œä¸ºåºåˆ—å·çš„åˆå§‹å€¼ã€‚ **è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç–‘é—®ï¼Œç¬¬ä¸€æ¬¡å»ºç«‹TCPè¿æ¥çš„æ—¶å€™ï¼Œç½‘ä¸Šä¸€äº›åšå®¢ä¸Šè¯´seqæ˜¯clientéšæœºç”Ÿæˆçš„ï¼Œä¹Ÿæœ‰çš„åšå®¢è¯´æ˜¯seq=1ï¼› è¿™é‡Œç»è¿‡æˆ‘æŠ“åŒ…åï¼Œçœ‹åˆ°ç¬¬ä¸€æ¬¡åˆ›å»ºTCPè¿æ¥çš„æ—¶å€™ï¼Œç¡®å®æ˜¯1; ** ç¡®è®¤åº”ç­”å·ï¼ˆAckï¼‰Ackå 32ä½ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦ï¼Œè¡¨ç¤ºæœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å€¼ã€‚ ç”¨ä½œå¯¹å¦ä¸€æ–¹å‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„å“åº”ã€‚å…¶å€¼æ˜¯æ”¶åˆ°çš„TCPæŠ¥æ–‡æ®µçš„åºå·å€¼åŠ 1ã€‚å‡è®¾ä¸»æœºAå’Œä¸»æœºBè¿›è¡ŒTCPé€šä¿¡ï¼Œé‚£ä¹ˆAå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¸ä»…æºå¸¦è‡ªå·±çš„åºå·ï¼Œè€Œä¸”åŒ…å«å¯¹Bå‘é€æ¥çš„TCPæŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚åä¹‹ï¼ŒBå‘é€å‡ºçš„TCPæŠ¥æ–‡æ®µä¹ŸåŒæ—¶æºå¸¦è‡ªå·±çš„åºå·å’Œå¯¹Aå‘é€æ¥çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤å·ã€‚TCPçš„å¯é æ€§ï¼Œæ˜¯å»ºç«‹åœ¨ã€Œæ¯ä¸€ä¸ªæ•°æ®æŠ¥æ–‡éƒ½éœ€è¦ç¡®è®¤æ”¶åˆ°ã€çš„åŸºç¡€ä¹‹ä¸Šçš„ã€‚ å°±æ˜¯è¯´ï¼Œé€šè®¯çš„ä»»ä½•ä¸€æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„ä¸€ä¸ªæŠ¥æ–‡ä¹‹åï¼Œéƒ½è¦å‘é€ä¸€ä¸ªç›¸å¯¹åº”çš„ã€Œç¡®è®¤æŠ¥æ–‡ã€ï¼Œæ¥è¡¨è¾¾ç¡®è®¤æ”¶åˆ°ã€‚ é‚£ä¹ˆï¼Œç¡®è®¤æŠ¥æ–‡ï¼Œå°±ä¼šåŒ…å«ç¡®è®¤å·ã€‚ è‹¥ç¡®è®¤å·=Nï¼Œåˆ™è¡¨æ˜ï¼šåˆ°åºå·N-1ä¸ºæ­¢çš„æ‰€æœ‰æ•°æ®éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚ æ•°æ®åç§» Offsetå  0.5 ä¸ªå­—èŠ‚ (4 ä½)ã€‚ è¿™ä¸ªå­—æ®µå®é™…ä¸Šæ˜¯æŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„é¦–éƒ¨é•¿åº¦ ï¼Œå®ƒæŒ‡å‡ºäº†TCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡çš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚ æ³¨æ„æ•°æ®èµ·å§‹å¤„å’ŒæŠ¥æ–‡èµ·å§‹å¤„çš„æ„æ€ï¼Œä¸Šé¢ğŸ‘†å·²ç»å†™åˆ°ï¼ŒTCPæŠ¥æ–‡æ®µçš„ç»„æˆæœ‰ä¸¤éƒ¨åˆ†ï¼ŒTCPæŠ¥æ–‡é¦–éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œåç§»é‡è®°å½•çš„æ˜¯æŠ¥æ–‡æ®µå¼€å§‹å’Œæ•°æ®å¼€å§‹çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æŠ¥æ–‡é¦–éƒ¨çš„é•¿åº¦ï¼› ä¸€ä¸ªæ•°æ®åç§»é‡ = 4 byteï¼Œç”±äº4ä½äºŒè¿›åˆ¶æ•°èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°å­—æ˜¯ 15ï¼Œå› æ­¤æ•°æ®åç§»çš„æœ€å¤§å€¼æ˜¯ 60 byteï¼Œè¿™ä¹Ÿä¾§é¢é™åˆ¶äº†TCPé¦–éƒ¨çš„æœ€å¤§é•¿åº¦ã€‚ ä¿ç•™Reservedå  0.75 ä¸ªå­—èŠ‚ (6 ä½)ã€‚ ä¿ç•™ä¸ºä»Šåä½¿ç”¨ï¼Œä½†ç›®å‰åº”ç½®ä¸º 0ã€‚ æ ‡å¿—ä½ TCP Flagsæ ‡å¿—ä½ï¼Œä¸€å…±æœ‰6ä¸ªï¼Œåˆ†åˆ«å 1ä½ï¼Œå…±6ä½ã€‚ æ¯ä¸€ä½çš„å€¼åªæœ‰ 0 å’Œ 1ï¼Œåˆ†åˆ«è¡¨è¾¾ä¸åŒæ„æ€ã€‚ å¦‚ä¸Šå›¾æ˜¯ä½¿ç”¨wireshardæŠ“åŒ…å±•ç¤ºæˆªå›¾ï¼› ACK(Acknowlegemt) ï¼šç¡®è®¤åºå·æœ‰æ•ˆ å½“ ACK = 1 çš„æ—¶å€™ï¼Œç¡®è®¤å·ï¼ˆAcknowledgemt Numberï¼‰æœ‰æ•ˆã€‚ ä¸€èˆ¬ç§°æºå¸¦ ACK æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œç¡®è®¤æŠ¥æ–‡æ®µã€ã€‚ä¸º0è¡¨ç¤ºæ•°æ®æ®µä¸åŒ…å«ç¡®è®¤ä¿¡æ¯ï¼Œç¡®è®¤å·è¢«å¿½ç•¥ã€‚TCP è§„å®šï¼Œåœ¨è¿æ¥å»ºç«‹åæ‰€æœ‰ä¼ é€çš„æŠ¥æ–‡æ®µéƒ½å¿…é¡»æŠŠ ACK è®¾ç½®ä¸º 1ã€‚ RST(Reset)ï¼šé‡ç½®è¿æ¥ å½“ RST = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤º TCP è¿æ¥ä¸­å‡ºç°ä¸¥é‡é”™è¯¯ï¼Œéœ€è¦é‡Šæ”¾å¹¶é‡æ–°å»ºç«‹è¿æ¥ã€‚ ä¸€èˆ¬ç§°æºå¸¦ RST æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€Œå¤ä½æŠ¥æ–‡æ®µã€ã€‚ SYN(SYNchronization)ï¼šå‘èµ·äº†ä¸€ä¸ªæ–°è¿æ¥ å½“ SYN = 1 çš„æ—¶å€™ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªè¯·æ±‚è¿æ¥æŠ¥æ–‡æ®µã€‚ ä¸€èˆ¬ç§°æºå¸¦ SYN æ ‡å¿—çš„ TCP æŠ¥æ–‡æ®µä¸ºã€ŒåŒæ­¥æŠ¥æ–‡æ®µã€ã€‚ åœ¨ TCP ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡å°±æ˜¯åŒæ­¥æŠ¥æ–‡æ®µï¼Œåœ¨è¿æ¥å»ºç«‹æ—¶ç”¨æ¥åŒæ­¥åºå·ã€‚å¯¹æ–¹è‹¥åŒæ„å»ºç«‹è¿æ¥ï¼Œåˆ™åº”åœ¨å“åº”çš„æŠ¥æ–‡æ®µä¸­ä½¿ SYN = 1 å’Œ ACK = 1ã€‚ PSH (Push): æ¨é€ å½“ PSH = 1 çš„æ—¶å€™ï¼Œè¡¨ç¤ºè¯¥æŠ¥æ–‡æ®µé«˜ä¼˜å…ˆçº§ï¼Œæ¥æ”¶æ–¹ TCP åº”è¯¥å°½å¿«æ¨é€ç»™æ¥æ”¶åº”ç”¨ç¨‹åºï¼Œè€Œä¸ç”¨ç­‰åˆ°æ•´ä¸ª TCP ç¼“å­˜éƒ½å¡«æ»¡äº†åå†äº¤ä»˜ã€‚ FINï¼šé‡Šæ”¾ä¸€ä¸ªè¿æ¥ å½“ FIN = 1 æ—¶ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µçš„å‘é€æ–¹çš„æ•°æ®å·²ç»å‘é€å®Œæ¯•ï¼Œå¹¶è¦æ±‚é‡Šæ”¾ TCP è¿æ¥ã€‚ä¸€èˆ¬ç§°æºå¸¦ FIN çš„æŠ¥æ–‡æ®µä¸ºã€Œç»“æŸæŠ¥æ–‡æ®µã€ã€‚åœ¨ TCP å››æ¬¡æŒ¥æ‰‹é‡Šæ”¾è¿æ¥çš„æ—¶å€™ï¼Œå°±ä¼šç”¨åˆ°è¯¥æ ‡å¿—ã€‚ çª—å£å¤§å° Window Sizeå 16ä½ã€‚è¯¥å­—æ®µæ˜ç¡®æŒ‡å‡ºäº†ç°åœ¨å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå®ƒå‘Šè¯‰å¯¹æ–¹æœ¬ç«¯çš„ TCP æ¥æ”¶ç¼“å†²åŒºè¿˜èƒ½å®¹çº³å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œè¿™æ ·å¯¹æ–¹å°±å¯ä»¥æ§åˆ¶å‘é€æ•°æ®çš„é€Ÿåº¦ã€‚ çª—å£å¤§å°çš„å€¼æ˜¯æŒ‡ï¼Œä»æœ¬æŠ¥æ–‡æ®µé¦–éƒ¨ä¸­çš„ç¡®è®¤å·ç®—èµ·ï¼Œæ¥æ”¶æ–¹ç›®å‰å…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ã€‚ ä¾‹å¦‚ï¼Œå‡å¦‚ç¡®è®¤å·æ˜¯701ï¼Œçª—å£å­—æ®µæ˜¯ 1000ã€‚è¿™å°±è¡¨æ˜ï¼Œä» 701 å·ç®—èµ·ï¼Œå‘é€æ­¤æŠ¥æ–‡æ®µçš„ä¸€æ–¹è¿˜æœ‰æ¥æ”¶ 1000 ï¼ˆå­—èŠ‚åºå·æ˜¯ 701 ~ 1700ï¼‰ ä¸ªå­—èŠ‚çš„æ•°æ®çš„æ¥æ”¶ç¼“å­˜ç©ºé—´ã€‚ æ ¡éªŒå’Œ TCP Checksumå 16ä½ã€‚ ç”±å‘é€ç«¯å¡«å……ï¼Œæ¥æ”¶ç«¯å¯¹TCPæŠ¥æ–‡æ®µæ‰§è¡Œã€CRCç®—æ³•ã€‘ï¼Œä»¥æ£€éªŒTCPæŠ¥æ–‡æ®µåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦æŸåï¼Œå¦‚æœæŸåè¿™ä¸¢å¼ƒã€‚ æ£€éªŒèŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ï¼Œè¿™ä¹Ÿæ˜¯ TCP å¯é ä¼ è¾“çš„ä¸€ä¸ªé‡è¦ä¿éšœã€‚ ç´§æ€¥æŒ‡é’ˆ Urgent Pointerå  2 ä¸ªå­—èŠ‚ã€‚ ä»…åœ¨ URG = 1 æ—¶æ‰æœ‰æ„ä¹‰ï¼Œå®ƒæŒ‡å‡ºæœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„å­—èŠ‚æ•°ã€‚ å½“ URG = 1 æ—¶ï¼Œå‘é€æ–¹ TCP å°±æŠŠç´§æ€¥æ•°æ®æ’å…¥åˆ°æœ¬æŠ¥æ–‡æ®µæ•°æ®çš„æœ€å‰é¢ï¼Œè€Œåœ¨ç´§æ€¥æ•°æ®åé¢çš„æ•°æ®ä»æ˜¯æ™®é€šæ•°æ®ã€‚ å› æ­¤ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºäº†ç´§æ€¥æ•°æ®çš„æœ«å°¾åœ¨æŠ¥æ–‡æ®µä¸­çš„ä½ç½®ã€‚ é€‰é¡¹ æ¯ä¸ªé€‰é¡¹å¼€å§‹æ˜¯1å­—èŠ‚kindå­—æ®µï¼Œè¯´æ˜é€‰é¡¹çš„ç±»å‹ kindä¸º0å’Œ1çš„é€‰é¡¹ï¼Œåªå ä¸€ä¸ªå­—èŠ‚ å…¶ä»–kindåæœ‰ä¸€å­—èŠ‚lenï¼Œè¡¨ç¤ºè¯¥é€‰é¡¹æ€»é•¿åº¦ï¼ˆåŒ…æ‹¬kindå’Œlenï¼‰ kindä¸º11ï¼Œ12ï¼Œ13è¡¨ç¤ºtcpäº‹åŠ¡ ä¸‹é¢æ˜¯å¸¸ç”¨é€‰é¡¹ï¼š MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰æ˜¯ã€é“¾è·¯å±‚ã€‘ä¸­çš„ç½‘ç»œå¯¹æ•°æ®å¸§çš„ä¸€ä¸ªé™åˆ¶ï¼Œä»¥ä»¥å¤ªç½‘ä¸ºä¾‹ï¼ŒMTU ä¸º 1500 ä¸ªå­—èŠ‚ã€‚ä¸€ä¸ªIP æ•°æ®æŠ¥åœ¨ä»¥å¤ªç½‘ä¸­ä¼ è¾“ï¼Œå¦‚æœå®ƒçš„é•¿åº¦å¤§äºè¯¥ MTU å€¼ï¼Œå°±è¦è¿›è¡Œåˆ†ç‰‡ä¼ è¾“ï¼Œä½¿å¾—æ¯ç‰‡æ•°æ®æŠ¥çš„é•¿åº¦å°äºMTUã€‚åˆ†ç‰‡ä¼ è¾“çš„ IP æ•°æ®æŠ¥ä¸ä¸€å®šæŒ‰åºåˆ°è¾¾ï¼Œä½† IP é¦–éƒ¨ä¸­çš„ä¿¡æ¯èƒ½è®©è¿™äº›æ•°æ®æŠ¥ç‰‡æŒ‰åºç»„è£…ã€‚IP æ•°æ®æŠ¥çš„åˆ†ç‰‡ä¸é‡ç»„æ˜¯åœ¨ç½‘ç»œå±‚è¿›å®Œæˆçš„ã€‚ MSS ï¼ˆæœ€å¤§åˆ†æ®µå¤§å°ï¼‰MSS æ˜¯ TCP é‡Œçš„ä¸€ä¸ªæ¦‚å¿µï¼ˆé¦–éƒ¨çš„é€‰é¡¹å­—æ®µä¸­ï¼‰ã€‚MSS æ˜¯ TCP æ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åˆ†æ®µï¼ŒTCP æŠ¥æ–‡æ®µçš„é•¿åº¦å¤§äº MSS æ—¶ï¼Œè¦è¿›è¡Œåˆ†æ®µä¼ è¾“ã€‚TCP åè®®åœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„ MSS å€¼ï¼Œæ¯ä¸€æ–¹éƒ½æœ‰ç”¨äºé€šå‘Šå®ƒæœŸæœ›æ¥æ”¶çš„ MSS é€‰é¡¹ï¼ˆMSS é€‰é¡¹åªå‡ºç°åœ¨ SYN æŠ¥æ–‡æ®µä¸­ï¼Œå³ TCP ä¸‰æ¬¡æ¡æ‰‹çš„å‰ä¸¤æ¬¡ï¼‰ã€‚MSS çš„å€¼ä¸€èˆ¬ä¸º MTU å€¼å‡å»ä¸¤ä¸ªé¦–éƒ¨å¤§å°ï¼ˆéœ€è¦å‡å» IP æ•°æ®åŒ…åŒ…å¤´çš„å¤§å° 20Bytes å’Œ TCP æ•°æ®æ®µçš„åŒ…å¤´ 20Bytesï¼‰æ‰€ä»¥å¦‚æœç”¨é“¾è·¯å±‚ä»¥å¤ªç½‘ï¼ŒMSS çš„å€¼å¾€å¾€ä¸º 1460ã€‚è€Œ Internet ä¸Šæ ‡å‡†çš„ MTU ä¸º 576ï¼Œé‚£ä¹ˆå¦‚æœä¸è®¾ç½®ï¼Œåˆ™MSSçš„é»˜è®¤å€¼å°±ä¸º 536 ä¸ªå­—èŠ‚ã€‚TCPæŠ¥æ–‡æ®µçš„åˆ†æ®µä¸é‡ç»„æ˜¯åœ¨è¿è¾“å±‚å®Œæˆçš„ã€‚ seqå’Œackçš„è®¡ç®—é€»è¾‘ CRCæ ¡éªŒå‚è€ƒèµ„æ–™TCPåè®®ä¸­çš„seq/ackåºå·æ˜¯å¦‚ä½•å˜åŒ–çš„ï¼ŸTCPåè®®è¯¦è§£TCPåè®®è¯¦è§£ï¼ˆä¸€ï¼‰ï¼šTCPå¤´éƒ¨ç»“æ„TCPå’ŒUDPæŠ¥æ–‡å¤´æ ¼å¼TCPåè®®è¯¦è§£åƒé€TCPåè®®","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"TCPåè®®","date":"2021-07-04T08:30:55.000Z","path":"wiki/TCPåè®®/","text":"TCPåè®®å­¦ä¹ ç¬”è®°ğŸ“’ w ä¸‹é¢æ˜¯æœ¬äººåœ¨å­¦ä¹ TCPåè®®çš„è¿‡ç¨‹ä¸­ï¼Œè®°å½•çš„ç¬”è®°ï¼ŒæŒ‰ç…§å­¦ä¹ çš„è¿‡ç¨‹ä»å‰åˆ°åæ•´ç†åœ¨è¿™é‡Œï¼å¯èƒ½ä¼šæœ‰å¾ˆå¤šçš„çŸ¥è¯†æ²¡æœ‰ç½—åˆ—ï¼Œåªæ˜¯è®°å½•çš„å¤§æ¦‚æ¡†æ¶ï¼Œå¦‚æœæœ‰é—®é¢˜æˆ–é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼ 1ã€TCPæŠ¥æ–‡å¤´éƒ¨2ã€TCPä¸‰æ¬¡æ¡æ‰‹3ã€TCPæœ€å¤§æŠ¥æ–‡æ®µï¼ˆMSSï¼‰4ã€TCPè¶…æ—¶ä¸é‡ä¼ 5ã€RTOé‡ä¼ è®¡æ—¶å™¨çš„è®¡ç®—6ã€æ»‘åŠ¨çª—å£7ã€æå‡ç½‘ç»œæ•ˆç‡8ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ…¢å¯åŠ¨9ã€TCPæ‹¥å¡æ§åˆ¶ä¹‹æ‹¥å¡é¿å…10ã€å¿«é€Ÿé‡ä¼ ä¸å¿«é€Ÿæ¢å¤11ã€å››æ¬¡æŒ¥æ‰‹ å­¦ä¹ èµ„æ–™ i æ•–ä¸™Githubæ•´ç†çš„ç¬”è®° æœ‰å¤§æ¦‚10ç¯‡å·¦å³çš„æ–‡ç« ï¼Œéƒ½æ˜¯é«˜è´¨é‡çš„ï¼ŒåŸåœ°å€è¯·ç‚¹å‡»ç€ğŸ‘‰ ã€Githubã€‘ i æå®¢æ—¶é—´ã€ŠWebåè®®è¯¦è§£ä¸æŠ“åŒ…å®æˆ˜ã€‹â€“ é™¶è¾‰è€å¸ˆ è¿™é—¨è¯¾ç¨‹ä¸“é—¨è®²è§£ç½‘ç»œåè®®çš„ï¼ŒåŒ…æ‹¬Http/Https,TLSåè®®ï¼ŒTCPåè®®ï¼ŒIPåè®®ç­‰ï¼› i ã€Šè®¡ç®—æœºç½‘ç»œ è‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ç¬¬7ç‰ˆ å¾ˆå¤šåæ ¡è®¡ç®—æœºç½‘ç»œè¯¾ç¨‹åœ¨ä½¿ç”¨çš„æ•™æï¼Œéå¸¸æƒå¨ï¼","tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}],"categories":[{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"}]},{"title":"Welcome to GeekIBLi","date":"2021-07-04T07:44:33.000Z","path":"wiki/index/","text":"I am geekibli; I come from HBU. I like code. ğŸ˜„ ğŸ˜„ ğŸ˜„ ğŸ˜„ ä¸é”™çš„å­¦ä¹ ç½‘ç«™æ¨è æ˜é‡‘ åšå®¢https://www.codingdict.com/æå®¢æ—¶é—´ æŠ€æœ¯å›¢é˜Ÿæ¨è å°ç±³ä¿¡æ¯éƒ¨æŠ€æœ¯å›¢é˜Ÿæœ‰èµæŠ€æœ¯å›¢é˜Ÿç¾å›¢æŠ€æœ¯å›¢é˜Ÿ ä¸¤å¹´å­¦è¯´è¯ ä¸€ç”Ÿå­¦é—­å˜´","tags":[],"categories":[{"name":"Overview","slug":"Overview","permalink":"http://example.com/categories/Overview/"}]}],"categories":[{"name":"Elasticsearch","slug":"Elasticsearch","permalink":"http://example.com/categories/Elasticsearch/"},{"name":"åŸºæœ¬æœç´¢","slug":"Elasticsearch/åŸºæœ¬æœç´¢","permalink":"http://example.com/categories/Elasticsearch/%E5%9F%BA%E6%9C%AC%E6%90%9C%E7%B4%A2/"},{"name":"DataBase","slug":"DataBase","permalink":"http://example.com/categories/DataBase/"},{"name":"MySQl","slug":"DataBase/MySQl","permalink":"http://example.com/categories/DataBase/MySQl/"},{"name":"Apache Flink","slug":"Apache-Flink","permalink":"http://example.com/categories/Apache-Flink/"},{"name":"Computer Network","slug":"Computer-Network","permalink":"http://example.com/categories/Computer-Network/"},{"name":"TCP","slug":"Computer-Network/TCP","permalink":"http://example.com/categories/Computer-Network/TCP/"},{"name":"Overview","slug":"Overview","permalink":"http://example.com/categories/Overview/"}],"tags":[{"name":"elasticsearch","slug":"elasticsearch","permalink":"http://example.com/tags/elasticsearch/"},{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"},{"name":"flink","slug":"flink","permalink":"http://example.com/tags/flink/"},{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}]}